(function(){"use strict";var n;(function(s){s.LOAD="LOAD",s.EXEC="EXEC",s.FFPROBE="FFPROBE",s.WRITE_FILE="WRITE_FILE",s.READ_FILE="READ_FILE",s.DELETE_FILE="DELETE_FILE",s.RENAME="RENAME",s.CREATE_DIR="CREATE_DIR",s.LIST_DIR="LIST_DIR",s.DELETE_DIR="DELETE_DIR",s.ERROR="ERROR",s.DOWNLOAD="DOWNLOAD",s.PROGRESS="PROGRESS",s.LOG="LOG",s.MOUNT="MOUNT",s.UNMOUNT="UNMOUNT"})(n||(n={}));const D=(()=>{let s=0;return()=>s++})(),O=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),L=new Error("called FFmpeg.terminate()");class m{#t=null;#a={};#s={};#n=[];#o=[];loaded=!1;#r=()=>{this.#t&&(this.#t.onmessage=({data:{id:e,type:t,data:a}})=>{switch(t){case n.LOAD:this.loaded=!0,this.#a[e](a);break;case n.MOUNT:case n.UNMOUNT:case n.EXEC:case n.FFPROBE:case n.WRITE_FILE:case n.READ_FILE:case n.DELETE_FILE:case n.RENAME:case n.CREATE_DIR:case n.LIST_DIR:case n.DELETE_DIR:this.#a[e](a);break;case n.LOG:this.#n.forEach(o=>o(a));break;case n.PROGRESS:this.#o.forEach(o=>o(a));break;case n.ERROR:this.#s[e](a);break}delete this.#a[e],delete this.#s[e]})};#e=({type:e,data:t},a=[],o)=>this.#t?new Promise((l,i)=>{const r=D();this.#t&&this.#t.postMessage({id:r,type:e,data:t},a),this.#a[r]=l,this.#s[r]=i,o?.addEventListener("abort",()=>{i(new DOMException(`Message # ${r} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(O);on(e,t){e==="log"?this.#n.push(t):e==="progress"&&this.#o.push(t)}off(e,t){e==="log"?this.#n=this.#n.filter(a=>a!==t):e==="progress"&&(this.#o=this.#o.filter(a=>a!==t))}load=({classWorkerURL:e,...t}={},{signal:a}={})=>(this.#t||(this.#t=e?new Worker(new URL(e,self.location.href),{type:"module"}):new Worker(new URL(""+new URL("worker-BAOIWoxA.js",self.location.href).href,self.location.href),{type:"module"}),this.#r()),this.#e({type:n.LOAD,data:t},void 0,a));exec=(e,t=-1,{signal:a}={})=>this.#e({type:n.EXEC,data:{args:e,timeout:t}},void 0,a);ffprobe=(e,t=-1,{signal:a}={})=>this.#e({type:n.FFPROBE,data:{args:e,timeout:t}},void 0,a);terminate=()=>{const e=Object.keys(this.#s);for(const t of e)this.#s[t](L),delete this.#s[t],delete this.#a[t];this.#t&&(this.#t.terminate(),this.#t=null,this.loaded=!1)};writeFile=(e,t,{signal:a}={})=>{const o=[];return t instanceof Uint8Array&&o.push(t.buffer),this.#e({type:n.WRITE_FILE,data:{path:e,data:t}},o,a)};mount=(e,t,a)=>{const o=[];return this.#e({type:n.MOUNT,data:{fsType:e,options:t,mountPoint:a}},o)};unmount=e=>{const t=[];return this.#e({type:n.UNMOUNT,data:{mountPoint:e}},t)};readFile=(e,t="binary",{signal:a}={})=>this.#e({type:n.READ_FILE,data:{path:e,encoding:t}},void 0,a);deleteFile=(e,{signal:t}={})=>this.#e({type:n.DELETE_FILE,data:{path:e}},void 0,t);rename=(e,t,{signal:a}={})=>this.#e({type:n.RENAME,data:{oldPath:e,newPath:t}},void 0,a);createDir=(e,{signal:t}={})=>this.#e({type:n.CREATE_DIR,data:{path:e}},void 0,t);listDir=(e,{signal:t}={})=>this.#e({type:n.LIST_DIR,data:{path:e}},void 0,t);deleteDir=(e,{signal:t}={})=>this.#e({type:n.DELETE_DIR,data:{path:e}},void 0,t)}var g;(function(s){s.MEMFS="MEMFS",s.NODEFS="NODEFS",s.NODERAWFS="NODERAWFS",s.IDBFS="IDBFS",s.WORKERFS="WORKERFS",s.PROXYFS="PROXYFS"})(g||(g={}));const w=new Error("failed to get response body reader"),I=new Error("failed to complete download"),_="Content-Length",A=async(s,e)=>{const t=await fetch(s);let a;try{const o=parseInt(t.headers.get(_)||"-1"),l=t.body?.getReader();if(!l)throw w;const i=[];let r=0;for(;;){const{done:c,value:R}=await l.read(),h=R?R.length:0;if(c){if(o!=-1&&o!==r)throw I;e&&e({url:s,total:o,received:r,delta:h,done:c});break}i.push(R),r+=h,e&&e({url:s,total:o,received:r,delta:h,done:c})}const d=new Uint8Array(r);let u=0;for(const c of i)d.set(c,u),u+=c.length;a=d.buffer}catch(o){console.log("failed to send download progress event: ",o),a=await t.arrayBuffer()}return a},p=async(s,e,t=!1,a)=>{const o=t?await A(s,a):await(await fetch(s)).arrayBuffer(),l=new Blob([o],{type:e});return URL.createObjectURL(l)};let E=null,f=null;async function N(){return f||(f=(async()=>{E=new m,E.on("log",({message:e})=>{self.postMessage({type:"log",message:e})}),E.on("progress",({progress:e,time:t})=>{self.postMessage({type:"progress",stage:"encoding",progress:e*100,time:t})}),self.postMessage({type:"progress",stage:"loading",message:"Loading FFmpeg..."});const s="https://unpkg.com/@ffmpeg/core@0.12.6/dist/esm";await E.load({coreURL:await p(`${s}/ffmpeg-core.js`,"text/javascript"),wasmURL:await p(`${s}/ffmpeg-core.wasm`,"application/wasm")})})(),f)}self.onmessage=async s=>{const{audioData:e,args:t=[],output:a={name:"output",mime:"application/octet-stream"},encodeStartMessage:o="Encoding...",encodeEndMessage:l="Finalizing..."}=s.data;try{await N(),self.postMessage({type:"progress",stage:"encoding",message:o});try{await E.writeFile("input",new Uint8Array(e));const i=["-i","input",...t,a.name];self.postMessage({type:"log",message:`Running with args: ${i.join(" ")}`}),await E.exec(i),self.postMessage({type:"progress",stage:"finalizing",message:l});const r=await E.readFile(a.name),d=new Blob([r],{type:a.mime});self.postMessage({type:"complete",blob:d})}finally{try{await E.deleteFile("input")}catch{}try{await E.deleteFile(a.name)}catch{}}}catch(i){self.postMessage({type:"error",message:i.message})}}})();
