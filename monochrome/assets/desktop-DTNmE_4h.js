import c from"./neutralino-bridge-BEOSBy1d.js";import{P as u,Q as m}from"./index-RhTXoZal.js";import"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";import"https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";function g(e){const n="js.neutralino.discordrpc";function a(o,r=!1){if(!o)return;let s="monochrome";o.album?.cover&&(s=`https://resources.tidal.com/images/${o.album.cover.replace(/-/g,"/")}/320x320.jpg`);const i={details:m(o),state:u(o),largeImageKey:s,largeImageText:o.album?.title||"Monochrome",smallImageKey:r?"pause":"play",smallImageText:r?"Paused":"Playing",instance:!1};if(!r&&o.duration){const t=Date.now(),d=e.audio.currentTime*1e3,l=(o.duration-e.audio.currentTime)*1e3;i.startTimestamp=Math.floor((t-d)/1e3),i.endTimestamp=Math.floor((t+l)/1e3)}Neutralino.events.broadcast("discord:update",i).catch(t=>console.error("Broadcast failed",t)),Neutralino.extensions.dispatch(n,"discord:update",i).catch(t=>console.error("Dispatch failed",t))}e.audio.addEventListener("play",()=>{a(e.currentTrack)}),e.audio.addEventListener("pause",()=>{a(e.currentTrack,!0)}),e.audio.addEventListener("loadedmetadata",()=>{e.audio.paused||a(e.currentTrack)}),e.currentTrack?a(e.currentTrack,e.audio.paused):Neutralino.events.broadcast("discord:update",{details:"Idling",state:"Monochrome",largeImageKey:"monochrome",largeImageText:"Monochrome",smallImageKey:"pause",smallImageText:"Paused"}).catch(()=>{})}async function v(e){console.log("[Desktop] Initializing desktop features..."),window.Neutralino=c;try{await c.init(),console.log("[Desktop] Neutralino initialized."),e&&(console.log("[Desktop] Starting Discord RPC..."),g(e))}catch(n){console.error("[Desktop] Failed to initialize desktop environment:",n)}}export{v as initDesktop};
