const i=typeof window<"u"&&(window.NL_MODE||window.location.search.includes("mode=neutralino")||window.parent!==window),d=new Map;i&&window.addEventListener("message",e=>{if(e.data?.type==="NL_EVENT"){const{eventName:s,detail:a}=e.data;d.has(s)&&d.get(s).forEach(n=>{try{n(a)}catch(r){console.error("[Bridge] Error in event handler:",r)}})}});const w=async()=>{i&&window.parent.postMessage({type:"NL_INIT"},"*")},p={on:(e,s)=>{i&&(d.has(e)||d.set(e,[]),d.get(e).push(s))},off:(e,s)=>{if(!i||!d.has(e))return;const a=d.get(e),n=a.indexOf(s);n>-1&&a.splice(n,1)},broadcast:async(e,s)=>{i&&window.parent.postMessage({type:"NL_BROADCAST",eventName:e,data:s},"*")}},c={dispatch:async(e,s,a)=>{i&&window.parent.postMessage({type:"NL_EXTENSION",extensionId:e,eventName:s,data:a},"*")}},g={exit:async()=>{i&&window.parent.postMessage({type:"NL_APP_EXIT"},"*")}},y={open:async e=>{i&&window.parent.postMessage({type:"NL_OS_OPEN",url:e},"*")},showSaveDialog:async(e,s)=>{if(i)return new Promise(a=>{const n=Math.random().toString(36).substring(7),r=t=>{t.data?.type==="NL_RESPONSE"&&t.data.id===n&&(window.removeEventListener("message",r),a(t.data.result))};window.addEventListener("message",r),window.parent.postMessage({type:"NL_OS_SHOW_SAVE_DIALOG",id:n,title:e,options:s},"*")})},showFolderDialog:async(e,s)=>{if(i)return new Promise(a=>{const n=Math.random().toString(36).substring(7),r=t=>{t.data?.type==="NL_RESPONSE"&&t.data.id===n&&(window.removeEventListener("message",r),a(t.data.result))};window.addEventListener("message",r),window.parent.postMessage({type:"NL_OS_SHOW_FOLDER_DIALOG",id:n,title:e,options:s},"*")})}},_={readBinaryFile:async e=>{if(i)return new Promise((s,a)=>{const n=Math.random().toString(36).substring(7),r=t=>{t.data?.type==="NL_RESPONSE"&&t.data.id===n&&(window.removeEventListener("message",r),t.data.error?a(t.data.error):s(t.data.result))};window.addEventListener("message",r),window.parent.postMessage({type:"NL_FS_READ_BINARY",id:n,path:e},"*")})},readDirectory:async e=>{if(i)return new Promise((s,a)=>{const n=Math.random().toString(36).substring(7),r=t=>{t.data?.type==="NL_RESPONSE"&&t.data.id===n&&(window.removeEventListener("message",r),t.data.error?a(t.data.error):s(t.data.result))};window.addEventListener("message",r),window.parent.postMessage({type:"NL_FS_READ_DIR",id:n,path:e},"*")})},getStats:async e=>{if(i)return new Promise((s,a)=>{const n=Math.random().toString(36).substring(7),r=t=>{t.data?.type==="NL_RESPONSE"&&t.data.id===n&&(window.removeEventListener("message",r),t.data.error?a(t.data.error):s(t.data.result))};window.addEventListener("message",r),window.parent.postMessage({type:"NL_FS_STATS",id:n,path:e},"*")})},writeBinaryFile:async(e,s)=>{if(i)return new Promise((a,n)=>{const r=Math.random().toString(36).substring(7),t=o=>{o.data?.type==="NL_RESPONSE"&&o.data.id===r&&(window.removeEventListener("message",t),o.data.error?n(o.data.error):a(o.data.result))};window.addEventListener("message",t),window.parent.postMessage({type:"NL_FS_WRITE_BINARY",id:r,path:e,buffer:s},"*",[s])})},appendBinaryFile:async(e,s)=>{if(i)return new Promise((a,n)=>{const r=Math.random().toString(36).substring(7),t=o=>{o.data?.type==="NL_RESPONSE"&&o.data.id===r&&(window.removeEventListener("message",t),o.data.error?n(o.data.error):a(o.data.result))};window.addEventListener("message",t),window.parent.postMessage({type:"NL_FS_APPEND_BINARY",id:r,path:e,buffer:s},"*",[s])})}},u={minimize:async()=>{i&&window.parent.postMessage({type:"NL_WINDOW_MIN"},"*")},maximize:async()=>{i&&window.parent.postMessage({type:"NL_WINDOW_MAX"},"*")},show:async()=>{i&&window.parent.postMessage({type:"NL_WINDOW_SHOW"},"*")},hide:async()=>{i&&window.parent.postMessage({type:"NL_WINDOW_HIDE"},"*")},isVisible:async()=>!0,setTitle:async e=>{i&&window.parent.postMessage({type:"NL_WINDOW_SET_TITLE",title:e},"*")}},N={init:w,events:p,extensions:c,app:g,os:y,filesystem:_,window:u};export{u as _window,g as app,N as default,p as events,c as extensions,_ as filesystem,w as init,y as os,u as window};
