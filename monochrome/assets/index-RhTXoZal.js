const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./desktop-DTNmE_4h.js","./neutralino-bridge-BEOSBy1d.js"])))=>i.map(i=>d[i]);
import{initializeApp as Cg}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";import{getAuth as Lg,GoogleAuthProvider as Pg,onAuthStateChanged as Ng,getRedirectResult as Mg,signInWithPopup as Dg,signInWithRedirect as Og,signInWithEmailAndPassword as zg,createUserWithEmailAndPassword as Ug,sendPasswordResetEmail as Bg,signOut as Fg}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";import{getDatabase as qg}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();const jg="modulepreload",Hg=function(o,e){return new URL(o,e).href},ed={},ta=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){let g=function(y){return Promise.all(y.map(u=>Promise.resolve(u).then(l=>({status:"fulfilled",value:l}),l=>({status:"rejected",reason:l}))))};const c=document.getElementsByTagName("link"),h=document.querySelector("meta[property=csp-nonce]"),f=h?.nonce||h?.getAttribute("nonce");r=g(t.map(y=>{if(y=Hg(y,n),y in ed)return;ed[y]=!0;const u=y.endsWith(".css"),l=u?'[rel="stylesheet"]':"";if(n)for(let m=c.length-1;m>=0;m--){const E=c[m];if(E.href===y&&(!u||E.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${y}"]${l}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":jg,u||(d.as="script"),d.crossOrigin="",d.href=y,f&&d.setAttribute("nonce",f),document.head.appendChild(d),u)return new Promise((m,E)=>{d.addEventListener("load",m),d.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${y}`)))})}))}function i(c){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=c,window.dispatchEvent(h),!h.defaultPrevented)throw c}return r.then(c=>{for(const h of c||[])h.status==="rejected"&&i(h.reason);return e().catch(i)})},ol={STORAGE_KEY:"monochrome-api-instances-v9",INSTANCES_URLS:["https://tidal-uptime.jiffy-puffs-1j.workers.dev/","https://tidal-uptime.props-76styles.workers.dev/"],defaultInstances:{api:[],streaming:[]},instancesLoaded:!1,_loadPromise:null,async loadInstancesFromGitHub(){return this.instancesLoaded?this.defaultInstances:this._loadPromise?this._loadPromise:(this._loadPromise=(async()=>{const o=localStorage.getItem(this.STORAGE_KEY);if(o)try{const i=JSON.parse(o),c=Date.now();if(i.timestamp&&c-i.timestamp<900*1e3)return this.defaultInstances=i.data,this.instancesLoaded=!0,this._loadPromise=null,this.defaultInstances}catch(i){console.warn("Failed to parse cached instances:",i)}let e=null,t=null;const n=[...this.INSTANCES_URLS].sort(()=>Math.random()-.5);for(const i of n)try{const c=await fetch(i);if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);e=await c.json();break}catch(c){console.warn(`Failed to fetch from ${i}:`,c),t=c}if(!e)return console.error("Failed to load instances from all uptime APIs:",t),this.defaultInstances={api:[{url:"https://eu-central.monochrome.tf",version:"2.4"},{url:"https://us-west.monochrome.tf",version:"2.4"},{url:"https://arran.monochrome.tf",version:"2.4"},{url:"https://triton.squid.wtf",version:"2.4"},{url:"https://api.monochrome.tf",version:"2.3"},{url:"https://monochrome-api.samidy.com",version:"2.3"},{url:"https://maus.qqdl.site",version:"2.2"},{url:"https://vogel.qqdl.site",version:"2.2"},{url:"https://katze.qqdl.site",version:"2.2"},{url:"https://hund.qqdl.site",version:"2.2"},{url:"https://tidal.kinoplus.online",version:"2.2"},{url:"https://wolf.qqdl.site",version:"2.2"}],streaming:[{url:"https://arran.monochrome.tf",version:"2.4"},{url:"https://triton.squid.wtf",version:"2.4"},{url:"https://maus.qqdl.site",version:"2.2"},{url:"https://vogel.qqdl.site",version:"2.2"},{url:"https://katze.qqdl.site",version:"2.2"},{url:"https://hund.qqdl.site",version:"2.2"},{url:"https://wolf.qqdl.site",version:"2.2"}]},this.instancesLoaded=!0,this._loadPromise=null,this.defaultInstances;let r={api:[],streaming:[]};e.api&&Array.isArray(e.api)&&(r.api=e.api.filter(i=>!i.url.includes("spotisaver.net"))),e.streaming&&Array.isArray(e.streaming)?r.streaming=e.streaming.filter(i=>!i.url.includes("spotisaver.net")):r.api.length>0&&(r.streaming=[...r.api]),this.defaultInstances=r,this.instancesLoaded=!0;try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify({timestamp:Date.now(),data:r}))}catch(i){console.warn("Failed to cache instances:",i)}return this._loadPromise=null,r})(),this._loadPromise)},async getInstances(o="api",e=!1){let t;t=await this.loadInstancesFromGitHub();const n=t[o]||t.api||[];return n.length===0?[]:n},async refreshInstances(){const o=await this.loadInstancesFromGitHub(),e=t=>{for(let n=t.length-1;n>0;n--){const r=Math.floor(Math.random()*(n+1));[t[n],t[r]]=[t[r],t[n]]}return t};return o.api&&o.api.length&&(o.api=e([...o.api])),o.streaming&&o.streaming.length&&(o.streaming=e([...o.streaming])),this.saveInstances(o),this.getInstances("api")},saveInstances(o,e){if(e)try{const t=localStorage.getItem(this.STORAGE_KEY);let n=t?JSON.parse(t):{api:[],streaming:[]};n[e]=o,localStorage.setItem(this.STORAGE_KEY,JSON.stringify(n))}catch(t){console.error("Failed to save instances:",t)}else localStorage.setItem(this.STORAGE_KEY,JSON.stringify(o))}},Nr={STORAGE_KEY:"monochrome-recent-activity",LIMIT:10,_get(){try{const o=localStorage.getItem(this.STORAGE_KEY),e=o?JSON.parse(o):{artists:[],albums:[],playlists:[],mixes:[]};return e.playlists||(e.playlists=[]),e.mixes||(e.mixes=[]),e}catch{return{artists:[],albums:[],playlists:[],mixes:[]}}},_save(o){localStorage.setItem(this.STORAGE_KEY,JSON.stringify(o))},getRecents(){return this._get()},_add(o,e){const t=this._get();t[o]=t[o].filter(n=>n.id!==e.id),t[o].unshift(e),t[o]=t[o].slice(0,this.LIMIT),this._save(t)},clear(){this._save({artists:[],albums:[],playlists:[],mixes:[]})},addArtist(o){this._add("artists",o)},addAlbum(o){this._add("albums",o)},addPlaylist(o){this._add("playlists",o)},addMix(o){this._add("mixes",o)}},Rs={STORAGE_KEY:"monochrome-theme",CUSTOM_THEME_KEY:"monochrome-custom-theme",defaultThemes:{light:{},dark:{},monochrome:{},ocean:{},purple:{},forest:{},mocha:{},macchiato:{},frappe:{},latte:{}},getTheme(){try{return localStorage.getItem(this.STORAGE_KEY)||"system"}catch{return"system"}},setTheme(o){if(localStorage.setItem(this.STORAGE_KEY,o),o==="system"){const e=window.matchMedia("(prefers-color-scheme: dark)").matches;document.documentElement.setAttribute("data-theme",e?"monochrome":"white")}else document.documentElement.setAttribute("data-theme",o);if(o!=="custom"){const e=document.documentElement;["background","foreground","primary","secondary","muted","border","highlight"].forEach(t=>{e.style.removeProperty(`--${t}`)})}else{const e=this.getCustomTheme();e&&this.applyCustomTheme(e)}window.dispatchEvent(new CustomEvent("theme-changed",{detail:{theme:o}}))},getCustomTheme(){try{const o=localStorage.getItem(this.CUSTOM_THEME_KEY);return o?JSON.parse(o):null}catch{return null}},setCustomTheme(o){localStorage.setItem(this.CUSTOM_THEME_KEY,JSON.stringify(o)),this.applyCustomTheme(o),this.setTheme("custom")},applyCustomTheme(o){const e=document.documentElement;for(const[t,n]of Object.entries(o))e.style.setProperty(`--${t}`,n)}};function td(o){return o?btoa(o.split("").reverse().join("")):""}function nd(o){if(!o)return"";try{return atob(o).split("").reverse().join("")}catch{return""}}const Xa={STORAGE_KEY:"lastfm-enabled",LOVE_ON_LIKE_KEY:"lastfm-love-on-like",SCROBBLE_PERCENTAGE_KEY:"lastfm-scrobble-percentage",CUSTOM_API_KEY:"lastfm-custom-api-key",CUSTOM_API_SECRET:"lastfm-custom-api-secret",USE_CUSTOM_CREDENTIALS_KEY:"lastfm-use-custom-credentials",isEnabled(){try{return localStorage.getItem(this.STORAGE_KEY)==="true"}catch{return!1}},setEnabled(o){localStorage.setItem(this.STORAGE_KEY,o?"true":"false")},shouldLoveOnLike(){try{return localStorage.getItem(this.LOVE_ON_LIKE_KEY)==="true"}catch{return!1}},setLoveOnLike(o){localStorage.setItem(this.LOVE_ON_LIKE_KEY,o?"true":"false")},getScrobblePercentage(){try{const o=localStorage.getItem(this.SCROBBLE_PERCENTAGE_KEY);return o?parseInt(o,10):75}catch{return 75}},setScrobblePercentage(o){const e=Math.max(1,Math.min(100,parseInt(o,10)||75));localStorage.setItem(this.SCROBBLE_PERCENTAGE_KEY,e.toString())},useCustomCredentials(){try{return localStorage.getItem(this.USE_CUSTOM_CREDENTIALS_KEY)==="true"}catch{return!1}},setUseCustomCredentials(o){localStorage.setItem(this.USE_CUSTOM_CREDENTIALS_KEY,o?"true":"false")},getCustomApiKey(){try{const o=localStorage.getItem(this.CUSTOM_API_KEY);return nd(o)||""}catch{return""}},setCustomApiKey(o){localStorage.setItem(this.CUSTOM_API_KEY,td(o))},getCustomApiSecret(){try{const o=localStorage.getItem(this.CUSTOM_API_SECRET);return nd(o)||""}catch{return""}},setCustomApiSecret(o){localStorage.setItem(this.CUSTOM_API_SECRET,td(o))},clearCustomCredentials(){localStorage.removeItem(this.CUSTOM_API_KEY),localStorage.removeItem(this.CUSTOM_API_SECRET),localStorage.removeItem(this.USE_CUSTOM_CREDENTIALS_KEY)}},Nd={STORAGE_KEY:"now-playing-mode",getMode(){try{return localStorage.getItem(this.STORAGE_KEY)||"cover"}catch{return"cover"}},setMode(o){localStorage.setItem(this.STORAGE_KEY,o)}},ni={DOWNLOAD_WITH_TRACKS:"lyrics-download-with-tracks",shouldDownloadLyrics(){try{return localStorage.getItem(this.DOWNLOAD_WITH_TRACKS)==="true"}catch{return!1}},setDownloadLyrics(o){localStorage.setItem(this.DOWNLOAD_WITH_TRACKS,o?"true":"false")}},Di={STORAGE_KEY:"album-background-enabled",isEnabled(){try{return localStorage.getItem(this.STORAGE_KEY)!=="false"}catch{return!0}},setEnabled(o){localStorage.setItem(this.STORAGE_KEY,o?"true":"false")}},Md={STORAGE_KEY:"dynamic-color-enabled",isEnabled(){try{return localStorage.getItem(this.STORAGE_KEY)!=="false"}catch{return!0}},setEnabled(o){localStorage.setItem(this.STORAGE_KEY,o?"true":"false")}},Mr={COMPACT_ARTIST_KEY:"card-compact-artist",COMPACT_ALBUM_KEY:"card-compact-album",isCompactArtist(){try{const o=localStorage.getItem(this.COMPACT_ARTIST_KEY);return o===null?!0:o==="true"}catch{return!0}},setCompactArtist(o){localStorage.setItem(this.COMPACT_ARTIST_KEY,o?"true":"false")},isCompactAlbum(){try{return localStorage.getItem(this.COMPACT_ALBUM_KEY)==="true"}catch{return!1}},setCompactAlbum(o){localStorage.setItem(this.COMPACT_ALBUM_KEY,o?"true":"false")}},qo={STORAGE_KEY_MODE:"replay-gain-mode",STORAGE_KEY_PREAMP:"replay-gain-preamp",getMode(){return localStorage.getItem(this.STORAGE_KEY_MODE)||"track"},setMode(o){localStorage.setItem(this.STORAGE_KEY_MODE,o)},getPreamp(){const o=parseFloat(localStorage.getItem(this.STORAGE_KEY_PREAMP));return isNaN(o)?3:o},setPreamp(o){localStorage.setItem(this.STORAGE_KEY_PREAMP,o)}},Ja={STORAGE_KEY:"download-quality",getQuality(){try{return localStorage.getItem(this.STORAGE_KEY)||"HI_RES_LOSSLESS"}catch{return"HI_RES_LOSSLESS"}},setQuality(o){localStorage.setItem(this.STORAGE_KEY,o)}},Dd={STORAGE_KEY:"cover-art-size",getSize(){try{return localStorage.getItem(this.STORAGE_KEY)||"1280"}catch{return"1280"}},setSize(o){localStorage.setItem(this.STORAGE_KEY,o)}},Od={STORAGE_KEY:"waveform-seekbar-enabled",isEnabled(){try{return localStorage.getItem(this.STORAGE_KEY)==="true"}catch{return!1}},setEnabled(o){localStorage.setItem(this.STORAGE_KEY,o?"true":"false")}},zd={STORAGE_KEY:"smooth-scrolling-enabled",isEnabled(){try{return localStorage.getItem(this.STORAGE_KEY)==="true"}catch{return!1}},setEnabled(o){localStorage.setItem(this.STORAGE_KEY,o?"true":"false")}},Ud={STORAGE_KEY:"show-quality-badges",isEnabled(){try{const o=localStorage.getItem(this.STORAGE_KEY);return o===null?!0:o==="true"}catch{return!0}},setEnabled(o){localStorage.setItem(this.STORAGE_KEY,o?"true":"false")}},Ds={STORAGE_KEY:"use-album-release-year",useAlbumYear(){try{const o=localStorage.getItem(this.STORAGE_KEY);return o===null?!0:o==="true"}catch{return!0}},setUseAlbumYear(o){localStorage.setItem(this.STORAGE_KEY,o?"true":"false")}},xs={STORAGE_KEY:"force-individual-downloads",shouldForceIndividual(){try{return localStorage.getItem(this.STORAGE_KEY)==="true"}catch{return!1}},setForceIndividual(o){localStorage.setItem(this.STORAGE_KEY,o?"true":"false")}},na={M3U_KEY:"playlist-generate-m3u",M3U8_KEY:"playlist-generate-m3u8",CUE_KEY:"playlist-generate-cue",NFO_KEY:"playlist-generate-nfo",JSON_KEY:"playlist-generate-json",RELATIVE_PATHS_KEY:"playlist-relative-paths",SEPARATE_DISCS_KEY:"playlist-separate-discs-in-zip",shouldGenerateM3U(){try{const o=localStorage.getItem(this.M3U_KEY);return o===null?!0:o==="true"}catch{return!0}},shouldGenerateM3U8(){try{return localStorage.getItem(this.M3U8_KEY)==="true"}catch{return!1}},shouldGenerateCUE(){try{return localStorage.getItem(this.CUE_KEY)==="true"}catch{return!1}},shouldGenerateNFO(){try{return localStorage.getItem(this.NFO_KEY)==="true"}catch{return!1}},shouldGenerateJSON(){try{return localStorage.getItem(this.JSON_KEY)==="true"}catch{return!1}},shouldUseRelativePaths(){try{const o=localStorage.getItem(this.RELATIVE_PATHS_KEY);return o===null?!0:o==="true"}catch{return!0}},shouldSeparateDiscsInZip(){try{const o=localStorage.getItem(this.SEPARATE_DISCS_KEY);return o===null?!0:o==="true"}catch{return!0}},setGenerateM3U(o){localStorage.setItem(this.M3U_KEY,o?"true":"false")},setGenerateM3U8(o){localStorage.setItem(this.M3U8_KEY,o?"true":"false")},setGenerateCUE(o){localStorage.setItem(this.CUE_KEY,o?"true":"false")},setGenerateNFO(o){localStorage.setItem(this.NFO_KEY,o?"true":"false")},setGenerateJSON(o){localStorage.setItem(this.JSON_KEY,o?"true":"false")},setUseRelativePaths(o){localStorage.setItem(this.RELATIVE_PATHS_KEY,o?"true":"false")},setSeparateDiscsInZip(o){localStorage.setItem(this.SEPARATE_DISCS_KEY,o?"true":"false")}},br={SENSITIVITY_KEY:"visualizer-sensitivity",SMART_INTENSITY_KEY:"visualizer-smart-intensity",ENABLED_KEY:"visualizer-enabled",MODE_KEY:"visualizer-mode",PRESET_KEY:"visualizer-preset",BUTTERCHURN_CYCLE_KEY:"butterchurn-cycle-duration",getPreset(){try{return localStorage.getItem(this.PRESET_KEY)||"butterchurn"}catch{return"butterchurn"}},setPreset(o){localStorage.setItem(this.PRESET_KEY,o)},isEnabled(){try{const o=localStorage.getItem(this.ENABLED_KEY);return o===null?!0:o==="true"}catch{return!0}},setEnabled(o){localStorage.setItem(this.ENABLED_KEY,o)},getMode(){try{return localStorage.getItem(this.MODE_KEY)||"solid"}catch{return"solid"}},setMode(o){localStorage.setItem(this.MODE_KEY,o)},getSensitivity(){try{const o=localStorage.getItem(this.SENSITIVITY_KEY);return o===null?1:parseFloat(o)}catch{return 1}},setSensitivity(o){localStorage.setItem(this.SENSITIVITY_KEY,o)},isSmartIntensityEnabled(){try{const o=localStorage.getItem(this.SMART_INTENSITY_KEY);return o===null?!0:o==="true"}catch{return!0}},setSmartIntensity(o){localStorage.setItem(this.SMART_INTENSITY_KEY,o)},getButterchurnCycleDuration(){try{const o=localStorage.getItem(this.BUTTERCHURN_CYCLE_KEY);return o?parseInt(o,10):30}catch{return 30}},setButterchurnCycleDuration(o){localStorage.setItem(this.BUTTERCHURN_CYCLE_KEY,o.toString())},isButterchurnCycleEnabled(){try{return localStorage.getItem("butterchurn-cycle-enabled")!=="false"}catch{return!0}},setButterchurnCycleEnabled(o){localStorage.setItem("butterchurn-cycle-enabled",o)},isButterchurnRandomizeEnabled(){try{return localStorage.getItem("butterchurn-randomize-enabled")!=="false"}catch{return!0}},setButterchurnRandomizeEnabled(o){localStorage.setItem("butterchurn-randomize-enabled",o)}},aa={ENABLED_KEY:"equalizer-enabled",GAINS_KEY:"equalizer-gains",PRESET_KEY:"equalizer-preset",CUSTOM_PRESETS_KEY:"equalizer-custom-presets",BAND_COUNT_KEY:"equalizer-band-count",RANGE_MIN_KEY:"equalizer-range-min",RANGE_MAX_KEY:"equalizer-range-max",FREQ_MIN_KEY:"equalizer-freq-min",FREQ_MAX_KEY:"equalizer-freq-max",PREAMP_KEY:"equalizer-preamp",DEFAULT_BAND_COUNT:16,MIN_BANDS:3,MAX_BANDS:32,DEFAULT_RANGE_MIN:-30,DEFAULT_RANGE_MAX:30,ABSOLUTE_MIN:-60,ABSOLUTE_MAX:60,DEFAULT_FREQ_MIN:20,DEFAULT_FREQ_MAX:2e4,ABSOLUTE_FREQ_MIN:10,ABSOLUTE_FREQ_MAX:96e3,DEFAULT_PREAMP:0,PREAMP_MIN:-20,PREAMP_MAX:20,isEnabled(){try{return localStorage.getItem(this.ENABLED_KEY)==="true"}catch{return!1}},setEnabled(o){localStorage.setItem(this.ENABLED_KEY,o?"true":"false")},getBandCount(){try{const o=localStorage.getItem(this.BAND_COUNT_KEY);if(o){const e=parseInt(o,10);if(!isNaN(e)&&e>=this.MIN_BANDS&&e<=this.MAX_BANDS)return e}}catch{}return this.DEFAULT_BAND_COUNT},setBandCount(o){const e=Math.max(this.MIN_BANDS,Math.min(this.MAX_BANDS,parseInt(o,10)||this.DEFAULT_BAND_COUNT));localStorage.setItem(this.BAND_COUNT_KEY,e.toString())},getRangeMin(){try{const o=localStorage.getItem(this.RANGE_MIN_KEY);if(o){const e=parseInt(o,10);if(!isNaN(e)&&e>=this.ABSOLUTE_MIN&&e<0)return e}}catch{}return this.DEFAULT_RANGE_MIN},setRangeMin(o){const e=parseInt(o,10);return!isNaN(e)&&e>=this.ABSOLUTE_MIN&&e<0?(localStorage.setItem(this.RANGE_MIN_KEY,e.toString()),!0):!1},getRangeMax(){try{const o=localStorage.getItem(this.RANGE_MAX_KEY);if(o){const e=parseInt(o,10);if(!isNaN(e)&&e>0&&e<=this.ABSOLUTE_MAX)return e}}catch{}return this.DEFAULT_RANGE_MAX},setRangeMax(o){const e=parseInt(o,10);return!isNaN(e)&&e>0&&e<=this.ABSOLUTE_MAX?(localStorage.setItem(this.RANGE_MAX_KEY,e.toString()),!0):!1},getRange(){return{min:this.getRangeMin(),max:this.getRangeMax()}},setRange(o,e){const t=this.setRangeMin(o),n=this.setRangeMax(e);return t&&n},getFreqMin(){try{const o=localStorage.getItem(this.FREQ_MIN_KEY);if(o){const e=parseInt(o,10);if(!isNaN(e)&&e>=this.ABSOLUTE_FREQ_MIN&&e<this.ABSOLUTE_FREQ_MAX)return e}}catch{}return this.DEFAULT_FREQ_MIN},setFreqMin(o){const e=parseInt(o,10);let t=this.DEFAULT_FREQ_MAX;try{const n=localStorage.getItem(this.FREQ_MAX_KEY);if(n){const r=parseInt(n,10);!isNaN(r)&&r>this.ABSOLUTE_FREQ_MIN&&r<=this.ABSOLUTE_FREQ_MAX&&(t=r)}}catch{}return!isNaN(e)&&e>=this.ABSOLUTE_FREQ_MIN&&e<t?(localStorage.setItem(this.FREQ_MIN_KEY,e.toString()),!0):!1},getFreqMax(){try{const o=localStorage.getItem(this.FREQ_MAX_KEY);if(o){const e=parseInt(o,10);if(!isNaN(e)&&e>this.ABSOLUTE_FREQ_MIN&&e<=this.ABSOLUTE_FREQ_MAX){try{const t=localStorage.getItem(this.FREQ_MIN_KEY);if(t){const n=parseInt(t,10);if(!isNaN(n)&&e<=n)return this.DEFAULT_FREQ_MAX}}catch{}return e}}}catch{}return this.DEFAULT_FREQ_MAX},setFreqMax(o){const e=parseInt(o,10);if(!isNaN(e)&&e>this.ABSOLUTE_FREQ_MIN&&e<=this.ABSOLUTE_FREQ_MAX){try{const t=localStorage.getItem(this.FREQ_MIN_KEY);if(t){const n=parseInt(t,10);if(!isNaN(n)&&e<=n)return!1}}catch{}return localStorage.setItem(this.FREQ_MAX_KEY,e.toString()),!0}return!1},getFreqRange(){return{min:this.getFreqMin(),max:this.getFreqMax()}},setFreqRange(o,e){const t=this.setFreqMax(e);return this.setFreqMin(o)&&t},getPreamp(){try{const o=localStorage.getItem(this.PREAMP_KEY);if(o){const e=parseFloat(o);if(!isNaN(e)&&e>=this.PREAMP_MIN&&e<=this.PREAMP_MAX)return e}}catch{}return this.DEFAULT_PREAMP},setPreamp(o){const e=parseFloat(o);return!isNaN(e)&&e>=this.PREAMP_MIN&&e<=this.PREAMP_MAX?(localStorage.setItem(this.PREAMP_KEY,e.toString()),!0):!1},getGains(o){const e=o||this.getBandCount();try{const t=localStorage.getItem(this.GAINS_KEY);if(t){const n=JSON.parse(t);if(Array.isArray(n)){if(n.length===e)return n;if(n.length>0)return this._interpolateGains(n,e)}}}catch{}return new Array(e).fill(0)},setGains(o){try{Array.isArray(o)&&o.length>=this.MIN_BANDS&&o.length<=this.MAX_BANDS&&localStorage.setItem(this.GAINS_KEY,JSON.stringify(o))}catch(e){console.warn("[EQ] Failed to save gains:",e)}},_interpolateGains(o,e){if(o.length===e)return[...o];const t=[];for(let n=0;n<e;n++){const r=n/(e-1)*(o.length-1),i=Math.floor(r),c=Math.min(Math.ceil(r),o.length-1),h=r-i,f=o[i]||0,g=o[c]||0,y=f+(g-f)*h;t.push(Math.round(y*10)/10)}return t},getPreset(){try{return localStorage.getItem(this.PRESET_KEY)||"flat"}catch{return"flat"}},setPreset(o){localStorage.setItem(this.PRESET_KEY,o)},getCustomPresets(){try{const o=localStorage.getItem(this.CUSTOM_PRESETS_KEY);if(o){const e=JSON.parse(o);if(typeof e=="object"&&e!==null)return e}}catch{}return{}},saveCustomPreset(o,e){try{if(!o||!Array.isArray(e)||e.length<this.MIN_BANDS||e.length>this.MAX_BANDS)return console.warn("[EQ] Invalid preset data"),!1;const t=o.trim().substring(0,50).replace(/[^\w\s-]/g,"");if(!t)return console.warn("[EQ] Invalid preset name"),!1;const n=this.getCustomPresets(),r="custom_"+Date.now();return n[r]={name:t,gains:e.map(i=>Math.round(i*10)/10),bandCount:e.length,createdAt:Date.now()},localStorage.setItem(this.CUSTOM_PRESETS_KEY,JSON.stringify(n)),r}catch(t){return console.warn("[EQ] Failed to save custom preset:",t),!1}},deleteCustomPreset(o){try{const e=this.getCustomPresets();return e[o]?(delete e[o],localStorage.setItem(this.CUSTOM_PRESETS_KEY,JSON.stringify(e)),!0):!1}catch(e){return console.warn("[EQ] Failed to delete custom preset:",e),!1}},updateCustomPreset(o,e,t){try{const n=this.getCustomPresets();if(!n[o])return!1;if(e!==void 0){const r=e.trim().substring(0,50).replace(/[^\w\s-]/g,"");r&&(n[o].name=r)}return Array.isArray(t)&&t.length===this.DEFAULT_BAND_COUNT&&(n[o].gains=t.map(r=>Math.round(r*10)/10),n[o].updatedAt=Date.now()),localStorage.setItem(this.CUSTOM_PRESETS_KEY,JSON.stringify(n)),!0}catch(n){return console.warn("[EQ] Failed to update custom preset:",n),!1}}},jo={STORAGE_KEY:"mono-audio-enabled",isEnabled(){try{return localStorage.getItem(this.STORAGE_KEY)==="true"}catch{return!1}},setEnabled(o){localStorage.setItem(this.STORAGE_KEY,o?"true":"false")}},Bd={STORAGE_KEY:"exponential-volume-enabled",isEnabled(){try{return localStorage.getItem(this.STORAGE_KEY)==="true"}catch{return!1}},setEnabled(o){localStorage.setItem(this.STORAGE_KEY,o?"true":"false")},applyCurve(o){return this.isEnabled()?Math.pow(o,3):o},inverseCurve(o){return this.isEnabled()?Math.cbrt(o):o}},Ho={SPEED_KEY:"audio-effects-speed",getSpeed(){try{const o=parseFloat(localStorage.getItem(this.SPEED_KEY));return isNaN(o)?1:Math.max(.01,Math.min(100,o))}catch{return 1}},setSpeed(o){const e=Math.max(.01,Math.min(100,parseFloat(o)||1));localStorage.setItem(this.SPEED_KEY,e.toString())}},Gg={ACTIVE_TAB_KEY:"settings-active-tab",getActiveTab(){try{return localStorage.getItem(this.ACTIVE_TAB_KEY)||"appearance"}catch{return"appearance"}},setActiveTab(o){localStorage.setItem(this.ACTIVE_TAB_KEY,o)}},Go={STORAGE_KEY:"monochrome-queue",getQueue(){try{const o=localStorage.getItem(this.STORAGE_KEY);return o?JSON.parse(o):null}catch{return null}},saveQueue(o){try{const e={queue:o.queue,shuffledQueue:o.shuffledQueue,originalQueueBeforeShuffle:o.originalQueueBeforeShuffle,currentQueueIndex:o.currentQueueIndex,shuffleActive:o.shuffleActive,repeatMode:o.repeatMode};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}catch(e){console.warn("Failed to save queue to localStorage:",e)}}},Yo={STORAGE_KEY:"monochrome-sidebar-collapsed",isCollapsed(){try{return localStorage.getItem(this.STORAGE_KEY)==="true"}catch{return!1}},setCollapsed(o){localStorage.setItem(this.STORAGE_KEY,o?"true":"false")},restoreState(){if(this.isCollapsed()){document.body.classList.add("sidebar-collapsed");const e=document.getElementById("sidebar-toggle");e&&(e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>')}}},Oi={ENABLED_KEY:"listenbrainz-enabled",TOKEN_KEY:"listenbrainz-token",CUSTOM_URL_KEY:"listenbrainz-custom-url",isEnabled(){try{return localStorage.getItem(this.ENABLED_KEY)==="true"}catch{return!1}},setEnabled(o){localStorage.setItem(this.ENABLED_KEY,o?"true":"false")},getToken(){try{return localStorage.getItem(this.TOKEN_KEY)||""}catch{return""}},setToken(o){localStorage.setItem(this.TOKEN_KEY,o)},getCustomUrl(){try{return localStorage.getItem(this.CUSTOM_URL_KEY)||""}catch{return""}},setCustomUrl(o){localStorage.setItem(this.CUSTOM_URL_KEY,o)}},zi={ENABLED_KEY:"maloja-enabled",TOKEN_KEY:"maloja-token",CUSTOM_URL_KEY:"maloja-custom-url",isEnabled(){try{return localStorage.getItem(this.ENABLED_KEY)==="true"}catch{return!1}},setEnabled(o){localStorage.setItem(this.ENABLED_KEY,o?"true":"false")},getToken(){try{return localStorage.getItem(this.TOKEN_KEY)||""}catch{return""}},setToken(o){localStorage.setItem(this.TOKEN_KEY,o)},getCustomUrl(){try{return localStorage.getItem(this.CUSTOM_URL_KEY)||""}catch{return""}},setCustomUrl(o){localStorage.setItem(this.CUSTOM_URL_KEY,o)}},Cs={ENABLED_KEY:"librefm-enabled",LOVE_ON_LIKE_KEY:"librefm-love-on-like",isEnabled(){try{return localStorage.getItem(this.ENABLED_KEY)==="true"}catch{return!1}},setEnabled(o){localStorage.setItem(this.ENABLED_KEY,o?"true":"false")},shouldLoveOnLike(){try{return localStorage.getItem(this.LOVE_ON_LIKE_KEY)==="true"}catch{return!1}},setLoveOnLike(o){localStorage.setItem(this.LOVE_ON_LIKE_KEY,o?"true":"false")}},Vr={SHOW_RECOMMENDED_SONGS_KEY:"home-show-recommended-songs",SHOW_RECOMMENDED_ALBUMS_KEY:"home-show-recommended-albums",SHOW_RECOMMENDED_ARTISTS_KEY:"home-show-recommended-artists",SHOW_JUMP_BACK_IN_KEY:"home-show-jump-back-in",shouldShowRecommendedSongs(){try{const o=localStorage.getItem(this.SHOW_RECOMMENDED_SONGS_KEY);return o===null?!0:o==="true"}catch{return!0}},setShowRecommendedSongs(o){localStorage.setItem(this.SHOW_RECOMMENDED_SONGS_KEY,o?"true":"false")},shouldShowRecommendedAlbums(){try{const o=localStorage.getItem(this.SHOW_RECOMMENDED_ALBUMS_KEY);return o===null?!0:o==="true"}catch{return!0}},setShowRecommendedAlbums(o){localStorage.setItem(this.SHOW_RECOMMENDED_ALBUMS_KEY,o?"true":"false")},shouldShowRecommendedArtists(){try{const o=localStorage.getItem(this.SHOW_RECOMMENDED_ARTISTS_KEY);return o===null?!0:o==="true"}catch{return!0}},setShowRecommendedArtists(o){localStorage.setItem(this.SHOW_RECOMMENDED_ARTISTS_KEY,o?"true":"false")},shouldShowJumpBackIn(){try{const o=localStorage.getItem(this.SHOW_JUMP_BACK_IN_KEY);return o===null?!0:o==="true"}catch{return!0}},setShowJumpBackIn(o){localStorage.setItem(this.SHOW_JUMP_BACK_IN_KEY,o?"true":"false")},SHOW_EDITORS_PICKS_KEY:"home-show-editors-picks",shouldShowEditorsPicks(){try{const o=localStorage.getItem(this.SHOW_EDITORS_PICKS_KEY);return o===null?!0:o==="true"}catch{return!0}},setShowEditorsPicks(o){localStorage.setItem(this.SHOW_EDITORS_PICKS_KEY,o?"true":"false")},SHUFFLE_EDITORS_PICKS_KEY:"home-shuffle-editors-picks",shouldShuffleEditorsPicks(){try{const o=localStorage.getItem(this.SHUFFLE_EDITORS_PICKS_KEY);return o===null?!0:o==="true"}catch{return!0}},setShuffleEditorsPicks(o){localStorage.setItem(this.SHUFFLE_EDITORS_PICKS_KEY,o?"true":"false")}},Fd={ENABLED_KEY:"analytics-enabled",isEnabled(){try{const o=localStorage.getItem(this.ENABLED_KEY);return o===null?!0:o==="true"}catch{return!0}},setEnabled(o){localStorage.setItem(this.ENABLED_KEY,o?"true":"false")}},Yg={SHOW_HOME_KEY:"sidebar-show-home",SHOW_LIBRARY_KEY:"sidebar-show-library",SHOW_RECENT_KEY:"sidebar-show-recent",SHOW_UNRELEASED_KEY:"sidebar-show-unreleased",SHOW_DONATE_KEY:"sidebar-show-donate",SHOW_SETTINGS_KEY:"sidebar-show-settings",SHOW_ABOUT_KEY:"sidebar-show-about",SHOW_DOWNLOAD_KEY:"sidebar-show-download",SHOW_DISCORD_KEY:"sidebar-show-discord",ORDER_KEY:"sidebar-menu-order",DEFAULT_ORDER:["sidebar-nav-home","sidebar-nav-library","sidebar-nav-recent","sidebar-nav-unreleased","sidebar-nav-donate","sidebar-nav-settings","sidebar-nav-about-bottom","sidebar-nav-download-bottom","sidebar-nav-discordbtn"],getBottomNavIds(){const o=document.querySelector(".sidebar-nav.bottom ul");return o?Array.from(o.children).map(e=>e.id):[]},shouldShowHome(){try{const o=localStorage.getItem(this.SHOW_HOME_KEY);return o===null?!0:o==="true"}catch{return!0}},setShowHome(o){localStorage.setItem(this.SHOW_HOME_KEY,o?"true":"false")},shouldShowLibrary(){try{const o=localStorage.getItem(this.SHOW_LIBRARY_KEY);return o===null?!0:o==="true"}catch{return!0}},setShowLibrary(o){localStorage.setItem(this.SHOW_LIBRARY_KEY,o?"true":"false")},shouldShowRecent(){try{const o=localStorage.getItem(this.SHOW_RECENT_KEY);return o===null?!0:o==="true"}catch{return!0}},setShowRecent(o){localStorage.setItem(this.SHOW_RECENT_KEY,o?"true":"false")},shouldShowUnreleased(){try{const o=localStorage.getItem(this.SHOW_UNRELEASED_KEY);return o===null?!0:o==="true"}catch{return!0}},setShowUnreleased(o){localStorage.setItem(this.SHOW_UNRELEASED_KEY,o?"true":"false")},shouldShowDonate(){try{const o=localStorage.getItem(this.SHOW_DONATE_KEY);return o===null?!0:o==="true"}catch{return!0}},setShowDonate(o){localStorage.setItem(this.SHOW_DONATE_KEY,o?"true":"false")},shouldShowSettings(){return!0},setShowSettings(o){o?localStorage.setItem(this.SHOW_SETTINGS_KEY,"true"):localStorage.removeItem(this.SHOW_SETTINGS_KEY)},shouldShowAbout(){try{const o=localStorage.getItem(this.SHOW_ABOUT_KEY);return o===null?!0:o==="true"}catch{return!0}},setShowAbout(o){localStorage.setItem(this.SHOW_ABOUT_KEY,o?"true":"false")},shouldShowDownload(){try{const o=localStorage.getItem(this.SHOW_DOWNLOAD_KEY);return o===null?!0:o==="true"}catch{return!0}},setShowDownload(o){localStorage.setItem(this.SHOW_DOWNLOAD_KEY,o?"true":"false")},shouldShowDiscord(){try{const o=localStorage.getItem(this.SHOW_DISCORD_KEY);return o===null?!0:o==="true"}catch{return!0}},setShowDiscord(o){localStorage.setItem(this.SHOW_DISCORD_KEY,o?"true":"false")},normalizeOrder(o){const e=this.DEFAULT_ORDER,t=Array.isArray(o)?o.filter(i=>e.includes(i)):[],n=[...new Set(t)],r=e.filter(i=>!n.includes(i));return[...n,...r]},getOrder(){try{const o=localStorage.getItem(this.ORDER_KEY);if(o)return this.normalizeOrder(JSON.parse(o))}catch{}return this.normalizeOrder([])},setOrder(o){const e=this.normalizeOrder(o);localStorage.setItem(this.ORDER_KEY,JSON.stringify(e))},applySidebarOrder(){const o=document.querySelector(".sidebar-nav.main ul"),e=document.querySelector(".sidebar-nav.bottom ul");if(!o)return;const t=this.getOrder(),n=this.getBottomNavIds(),r=t.filter(c=>!n.includes(c)),i=t.filter(c=>n.includes(c));r.forEach(c=>{const h=document.getElementById(c);h&&o.appendChild(h)}),e&&i.forEach(c=>{const h=document.getElementById(c);h&&e.appendChild(h)})},applySidebarVisibility(){this.applySidebarOrder(),[{id:"sidebar-nav-home",check:this.shouldShowHome()},{id:"sidebar-nav-library",check:this.shouldShowLibrary()},{id:"sidebar-nav-recent",check:this.shouldShowRecent()},{id:"sidebar-nav-unreleased",check:this.shouldShowUnreleased()},{id:"sidebar-nav-donate",check:this.shouldShowDonate()},{id:"sidebar-nav-settings",check:this.shouldShowSettings()},{id:"sidebar-nav-about-bottom",check:this.shouldShowAbout()},{id:"sidebar-nav-download-bottom",check:this.shouldShowDownload()},{id:"sidebar-nav-discordbtn",check:this.shouldShowDiscord()}].forEach(({id:e,check:t})=>{const n=document.getElementById(e);n&&(n.style.display=t?"":"none")})}};typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>{Rs.getTheme()==="system"&&document.documentElement.setAttribute("data-theme",o.matches?"monochrome":"white")});const ll={STORAGE_KEY:"monochrome-font-config-v2",CUSTOM_FONTS_KEY:"monochrome-custom-fonts",FONT_SIZE_KEY:"monochrome-font-size",FONT_LINK_ID:"monochrome-dynamic-font",FONT_FACE_ID:"monochrome-dynamic-fontface",getDefaultConfig(){return{type:"preset",family:"Inter",fallback:"sans-serif",weights:[400,500,600,700,800]}},getDefaultFontSize(){return 100},getFontSize(){try{const o=localStorage.getItem(this.FONT_SIZE_KEY);if(o){const e=parseInt(o,10);if(!isNaN(e)&&e>=50&&e<=200)return e}}catch{}return this.getDefaultFontSize()},setFontSize(o){const e=Math.max(50,Math.min(200,parseInt(o,10)||100));return localStorage.setItem(this.FONT_SIZE_KEY,e.toString()),this.applyFontSize(),e},applyFontSize(){const o=this.getFontSize();document.documentElement.style.setProperty("--font-size-scale",`${o}%`)},resetFontSize(){return localStorage.removeItem(this.FONT_SIZE_KEY),this.applyFontSize(),this.getDefaultFontSize()},getConfig(){try{const o=localStorage.getItem(this.STORAGE_KEY);if(o)return JSON.parse(o)}catch{}return this.getDefaultConfig()},setConfig(o){localStorage.setItem(this.STORAGE_KEY,JSON.stringify(o))},parseGoogleFontsUrl(o){try{if(o.includes("fonts.google.com/specimen/")){const e=o.match(/specimen\/([^/?]+)/);if(e)return decodeURIComponent(e[1]).replace(/\+/g," ")}if(o.includes("fonts.googleapis.com/css")){const e=o.match(/family=([^&:]+)/);if(e)return decodeURIComponent(e[1]).replace(/\+/g," ").split(":")[0]}}catch{}return null},async loadGoogleFont(o){if(!o||typeof o!="string")return;const e=o.replace(/[^a-zA-Z0-9\s\-_,.]/g,"");if(!e)return;const n=`https://fonts.googleapis.com/css2?family=${encodeURIComponent(e)}:wght@100;200;300;400;500;600;700;800;900&display=swap`;let r=document.getElementById(this.FONT_LINK_ID);r||(r=document.createElement("link"),r.id=this.FONT_LINK_ID,r.rel="stylesheet",document.head.appendChild(r)),r.href=n,this.setConfig({type:"google",family:o,fallback:"sans-serif",weights:[100,200,300,400,500,600,700,800,900]}),document.documentElement.style.setProperty("--font-family",`'${o}', sans-serif`)},async loadFontFromUrl(o,e){const t=[100,200,300,400,500,600,700,800,900],n=this.FONT_FACE_ID;let r=document.getElementById(n);r||(r=document.createElement("style"),r.id=n,document.head.appendChild(r));const i=this.getFontFormat(o),c=e||"CustomFont";r.textContent=`
            @font-face {
                font-family: '${c}';
                src: url('${o}') format('${i}');
                font-weight: 100 900;
                font-style: normal;
                font-display: swap;
            }
        `,this.setConfig({type:"url",family:c,url:o,fallback:"sans-serif",weights:t}),document.documentElement.style.setProperty("--font-family",`'${c}', sans-serif`)},getFontFormat(o){const e=o.split(".").pop().toLowerCase();return{woff2:"woff2",woff:"woff",ttf:"truetype",otf:"opentype"}[e]||"woff2"},async saveUploadedFont(o){return new Promise((e,t)=>{const n=new FileReader;n.onload=r=>{const i=r.target.result,c="uploaded-"+Date.now(),h=this.getCustomFonts();h[c]={name:o.name.replace(/\.[^/.]+$/,""),base64:i,format:this.getFontFormat(o.name),size:o.size,uploadedAt:Date.now()},localStorage.setItem(this.CUSTOM_FONTS_KEY,JSON.stringify(h)),e({id:c,...h[c]})},n.onerror=t,n.readAsDataURL(o)})},getCustomFonts(){try{const o=localStorage.getItem(this.CUSTOM_FONTS_KEY);return o?JSON.parse(o):{}}catch{return{}}},async loadUploadedFont(o){const t=this.getCustomFonts()[o];if(!t)throw new Error("Font not found");const n=t.name||"UploadedFont",r=this.FONT_FACE_ID;let i=document.getElementById(r);i||(i=document.createElement("style"),i.id=r,document.head.appendChild(i)),i.textContent=`
            @font-face {
                font-family: '${n}';
                src: url('${t.base64}') format('${t.format}');
                font-weight: 100 900;
                font-style: normal;
                font-display: swap;
            }
        `,this.setConfig({type:"uploaded",family:n,fontId:o,fallback:"sans-serif",weights:[100,200,300,400,500,600,700,800,900]}),document.documentElement.style.setProperty("--font-family",`'${n}', sans-serif`)},deleteUploadedFont(o){const e=this.getCustomFonts();delete e[o],localStorage.setItem(this.CUSTOM_FONTS_KEY,JSON.stringify(e))},loadPresetFont(o,e="sans-serif"){let t=document.getElementById(this.FONT_LINK_ID);t&&t.remove();let n=document.getElementById(this.FONT_FACE_ID);n&&n.remove(),this.setConfig({type:"preset",family:o,fallback:e,weights:[400,500,600,700,800]});const r=o==="monospace"?"monospace":`'${o}', ${e}`;document.documentElement.style.setProperty("--font-family",r)},loadAppleMusicFont(){const o="monochrome-apple-font";let e=document.getElementById(this.FONT_LINK_ID);e&&e.remove();let t=document.getElementById(this.FONT_FACE_ID);t&&t.remove();let n=document.getElementById(o);n||(n=document.createElement("link"),n.id=o,n.rel="stylesheet",n.href="/fonts/apple/sf-pro-display.css",document.head.appendChild(n)),this.setConfig({type:"preset",family:"Apple Music",fallback:"sans-serif",weights:[400,500,600,700]}),document.documentElement.style.setProperty("--font-family","'SF Pro Display', sans-serif")},applyFont(){const o=this.getConfig();switch(o.type){case"google":this.loadGoogleFont(o.family);break;case"url":this.loadFontFromUrl(o.url,o.family);break;case"uploaded":this.loadUploadedFont(o.fontId);break;default:o.family==="Apple Music"?this.loadAppleMusicFont():this.loadPresetFont(o.family,o.fallback);break}},getUploadedFontList(){const o=this.getCustomFonts();return Object.entries(o).map(([e,t])=>({id:e,name:t.name,size:t.size,uploadedAt:t.uploadedAt}))}},qd={STORAGE_KEY:"pwa-auto-update-enabled",isAutoUpdateEnabled(){try{return localStorage.getItem(this.STORAGE_KEY)!=="false"}catch{return!0}},setAutoUpdateEnabled(o){localStorage.setItem(this.STORAGE_KEY,o?"true":"false")}},jd={STORAGE_KEY:"music-provider",getProvider(){try{return localStorage.getItem(this.STORAGE_KEY)||"tidal"}catch{return"tidal"}},setProvider(o){localStorage.setItem(this.STORAGE_KEY,o)}},gi={STORAGE_KEY:"close-modals-on-navigation",INTERCEPT_BACK_KEY:"intercept-back-to-close-modals",shouldCloseOnNavigation(){try{const o=localStorage.getItem(this.STORAGE_KEY);return o===null?!1:o==="true"}catch{return!1}},setCloseOnNavigation(o){localStorage.setItem(this.STORAGE_KEY,o?"true":"false")},shouldInterceptBackToClose(){try{const o=localStorage.getItem(this.INTERCEPT_BACK_KEY);return o===null?!1:o==="true"}catch{return!1}},setInterceptBackToClose(o){localStorage.setItem(this.INTERCEPT_BACK_KEY,o?"true":"false")},hasOpenModalsOrPanels(){const o=document.getElementById("side-panel");if(o&&o.classList.contains("active")||document.querySelector(".modal.active")||document.querySelector(".modal-overlay"))return!0;const e=["playlist-modal","folder-modal","playlist-select-modal","shortcuts-modal","missing-tracks-modal","sleep-timer-modal","discography-download-modal","custom-db-modal","tracker-modal","epilepsy-warning-modal"];for(const t of e){const n=document.getElementById(t);if(n&&n.classList.contains("active"))return!0}return!1},closeAllModals(){document.querySelectorAll(".modal-overlay").forEach(e=>{e.remove()}),document.querySelectorAll(".modal.active").forEach(e=>{e.classList.remove("active")}),["playlist-modal","folder-modal","playlist-select-modal","shortcuts-modal","missing-tracks-modal","sleep-timer-modal","discography-download-modal","custom-db-modal","tracker-modal","epilepsy-warning-modal"].forEach(e=>{const t=document.getElementById(e);t&&t.classList.remove("active")})}},or={BLOCKED_ARTISTS_KEY:"blocked-artists",BLOCKED_TRACKS_KEY:"blocked-tracks",BLOCKED_ALBUMS_KEY:"blocked-albums",getBlockedArtists(){try{const o=localStorage.getItem(this.BLOCKED_ARTISTS_KEY);return o?JSON.parse(o):[]}catch{return[]}},setBlockedArtists(o){localStorage.setItem(this.BLOCKED_ARTISTS_KEY,JSON.stringify(o))},isArtistBlocked(o){return o?this.getBlockedArtists().some(e=>e.id===o):!1},blockArtist(o){if(!o||!o.id)return;const e=this.getBlockedArtists();e.some(t=>t.id===o.id)||(e.push({id:o.id,name:o.name||"Unknown Artist",blockedAt:Date.now()}),this.setBlockedArtists(e))},unblockArtist(o){const e=this.getBlockedArtists().filter(t=>t.id!==o);this.setBlockedArtists(e)},getBlockedTracks(){try{const o=localStorage.getItem(this.BLOCKED_TRACKS_KEY);return o?JSON.parse(o):[]}catch{return[]}},setBlockedTracks(o){localStorage.setItem(this.BLOCKED_TRACKS_KEY,JSON.stringify(o))},isTrackBlocked(o){return o?this.getBlockedTracks().some(e=>e.id===o):!1},blockTrack(o){if(!o||!o.id)return;const e=this.getBlockedTracks();e.some(t=>t.id===o.id)||(e.push({id:o.id,title:o.title||"Unknown Track",artist:o.artist?.name||o.artist||"Unknown Artist",blockedAt:Date.now()}),this.setBlockedTracks(e))},unblockTrack(o){const e=this.getBlockedTracks().filter(t=>t.id!==o);this.setBlockedTracks(e)},getBlockedAlbums(){try{const o=localStorage.getItem(this.BLOCKED_ALBUMS_KEY);return o?JSON.parse(o):[]}catch{return[]}},setBlockedAlbums(o){localStorage.setItem(this.BLOCKED_ALBUMS_KEY,JSON.stringify(o))},isAlbumBlocked(o){return o?this.getBlockedAlbums().some(e=>e.id===o):!1},blockAlbum(o){if(!o||!o.id)return;const e=this.getBlockedAlbums();e.some(t=>t.id===o.id)||(e.push({id:o.id,title:o.title||"Unknown Album",artist:o.artist?.name||o.artist||"Unknown Artist",blockedAt:Date.now()}),this.setBlockedAlbums(e))},unblockAlbum(o){const e=this.getBlockedAlbums().filter(t=>t.id!==o);this.setBlockedAlbums(e)},shouldHideTrack(o){return!!(!o||this.isTrackBlocked(o.id)||o.artist?.id&&this.isArtistBlocked(o.artist.id)||o.artists?.some(e=>this.isArtistBlocked(e.id))||o.album?.id&&this.isAlbumBlocked(o.album.id))},shouldHideAlbum(o){return!!(!o||this.isAlbumBlocked(o.id)||o.artist?.id&&this.isArtistBlocked(o.artist.id)||o.artists?.some(e=>this.isArtistBlocked(e.id)))},shouldHideArtist(o){return o?this.isArtistBlocked(o.id):!0},filterTracks(o){return o.filter(e=>!this.shouldHideTrack(e))},filterAlbums(o){return o.filter(e=>!this.shouldHideAlbum(e))},filterArtists(o){return o.filter(e=>!this.shouldHideArtist(e))},getTotalBlockedCount(){return this.getBlockedArtists().length+this.getBlockedTracks().length+this.getBlockedAlbums().length},clearAllBlocked(){localStorage.removeItem(this.BLOCKED_ARTISTS_KEY),localStorage.removeItem(this.BLOCKED_TRACKS_KEY),localStorage.removeItem(this.BLOCKED_ALBUMS_KEY)}},ya=Object.freeze(Object.defineProperty({__proto__:null,analyticsSettings:Fd,apiSettings:ol,audioEffectsSettings:Ho,backgroundSettings:Di,bulkDownloadSettings:xs,cardSettings:Mr,contentBlockingSettings:or,coverArtSizeSettings:Dd,downloadQualitySettings:Ja,dynamicColorSettings:Md,equalizerSettings:aa,exponentialVolumeSettings:Bd,fontSettings:ll,homePageSettings:Vr,lastFMStorage:Xa,libreFmSettings:Cs,listenBrainzSettings:Oi,lyricsSettings:ni,malojaSettings:zi,modalSettings:gi,monoAudioSettings:jo,musicProviderSettings:jd,nowPlayingSettings:Nd,playlistSettings:na,pwaUpdateSettings:qd,qualityBadgeSettings:Ud,queueManager:Go,recentActivityManager:Nr,replayGainSettings:qo,settingsUiState:Gg,sidebarSectionSettings:Yg,sidebarSettings:Yo,smoothScrollingSettings:zd,themeManager:Rs,trackDateSettings:Ds,visualizerSettings:br,waveformSettings:Od},Symbol.toStringTag,{value:"Module"})),xa={OFF:0,ALL:1,ONE:2},Kg=["HI_RES_LOSSLESS","LOSSLESS","HIGH","LOW"],$g={HI_RES_LOSSLESS:["HI_RES_LOSSLESS","HIRES_LOSSLESS","HIRESLOSSLESS","HIFI_PLUS","HI_RES_FLAC","HI_RES","HIRES","MASTER","MASTER_QUALITY","MQA"],LOSSLESS:["LOSSLESS","HIFI"],HIGH:["HIGH","HIGH_QUALITY"],LOW:["LOW","LOW_QUALITY"]},Hd="Too Many Requests. Please wait a moment and try again.",cr='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><polygon points="7 3 21 12 7 21 7 3"></polygon></svg>',Vg='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>',Gd='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>',Yd='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></svg>',Ui='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>',Ls='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>',yr='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="heart-icon"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>',Os='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>',Kd='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>',Ma=o=>{if(isNaN(o))return"0:00";const e=Math.floor(o/60),t=Math.floor(o%60);return`${e}:${String(t).padStart(2,"0")}`},Ko=o=>{const t=Ds.useAlbumYear()?o?.album?.releaseDate||o?.streamStartDate:o?.streamStartDate||o?.album?.releaseDate;if(!t)return"";const n=new Date(t);return isNaN(n.getTime())?"":` â€¢ ${n.getFullYear()}`},Kn=(o,e=!1)=>`<div class="placeholder-text ${e?"loading":""}">${o}</div>`,Hn=new WeakMap,Gn=o=>o?o.replace(/[\\/:*?"<>|]/g,"_").replace(/\s+/g," ").trim():"Unknown",$d=(o,e="")=>o.byteLength>=4&&o.getUint8(0)===102&&o.getUint8(1)===76&&o.getUint8(2)===97&&o.getUint8(3)===67?"flac":o.byteLength>=8&&o.getUint8(4)===102&&o.getUint8(5)===116&&o.getUint8(6)===121&&o.getUint8(7)===112?"mp4":o.byteLength>=3&&o.getUint8(0)===73&&o.getUint8(1)===68&&o.getUint8(2)===51||o.byteLength>=2&&o.getUint8(0)===255&&(o.getUint8(1)&224)===224?"mp3":e==="audio/flac"?"flac":e==="audio/mp4"||e==="audio/x-m4a"?"mp4":e==="audio/mp3"||e==="audio/mpeg"?"mp3":null,Vd=async o=>{const e=await o.slice(0,12).arrayBuffer(),t=new DataView(e),n=$d(t,o.type);return n==="mp4"?"m4a":n||"flac"},Wg=o=>{switch(o){case"LOW":case"HIGH":return"m4a";case"MP3_320":return"mp3";default:return"flac"}},ai=(o,e,t=null)=>{const n=localStorage.getItem("filename-template")||"{trackNumber} - {artist} - {title}",r=t||Wg(e),i=o.artist?.name||o.artists?.[0]?.name||"Unknown Artist",c={trackNumber:o.trackNumber,artist:i,title:Ca(o),album:o.album?.title};return zs(n,c)+"."+r},Qg=o=>o?o.trim().toUpperCase().replace(/[^A-Z0-9]+/g,"_"):"",Wd=o=>{if(!o)return null;const e=Qg(o);for(const[t,n]of Object.entries($g))if(n.includes(e))return t;return null},Or=o=>Ud.isEnabled()&&Xd(o)==="HI_RES_LOSSLESS"?'<span class="quality-badge quality-hires" title="Hi-Res Lossless">HD</span>':"",ad=o=>{if(!Array.isArray(o))return null;const e=[];for(const t of o){if(typeof t!="string")continue;const n=Wd(t);n&&!e.includes(n)&&e.push(n)}return Qd(e)},Qd=o=>{let e=null,t=1/0;for(const n of o){if(!n)continue;const r=Kg.indexOf(n),i=r===-1?1/0:r;i<t&&(e=n,t=i)}return e},Xd=o=>{if(!o)return null;const e=[ad(o.mediaMetadata?.tags),ad(o.album?.mediaMetadata?.tags),Wd(o.audioQuality)];return Qd(e)},rd=o=>new Promise(e=>setTimeout(e,o)),xi=o=>o?.explicit===!0||o?.explicitLyrics===!0,Xg=o=>o?o.isLocal?!1:o.allowStreaming===!1||o.streamReady===!1||o.title==="Unavailable":!0,cl=(o,e)=>{let t;return function(...r){const i=()=>{clearTimeout(t),o(...r)};clearTimeout(t),t=setTimeout(i,e)}},en=o=>typeof o!="string"?o:o.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),Ca=(o,{fallback:e="Unknown Title"}={})=>o?.title?o?.version?`${o.title} (${o.version})`:o.title:e,wa=(o={},{fallback:e="Unknown Artist"}={})=>o?.artists?.length?o.artists.map(t=>t?.name).join(", "):e,Ps=(o={},{fallback:e="Unknown Artist"}={})=>o?.artists?.length?o.artists.map(t=>{const n=en(t.name||"Unknown Artist"),r=en(t.id||"");return(o.isTracker||o.id&&String(o.id).startsWith("tracker-"))&&o.trackerInfo?.sheetId?`<span class="artist-link tracker-artist-link" data-tracker-sheet-id="${en(o.trackerInfo.sheetId)}">${n}</span>`:`<span class="artist-link" data-artist-id="${r}">${n}</span>`}).join(", "):e,zs=(o,e)=>{let t=o;return t=t.replace(/\{trackNumber\}/g,e.trackNumber?String(e.trackNumber).padStart(2,"0"):"00"),t=t.replace(/\{artist\}/g,Gn(e.artist||"Unknown Artist")),t=t.replace(/\{title\}/g,Gn(e.title||"Unknown Title")),t=t.replace(/\{album\}/g,Gn(e.album||"Unknown Album")),t=t.replace(/\{albumArtist\}/g,Gn(e.albumArtist||"Unknown Artist")),t=t.replace(/\{albumTitle\}/g,Gn(e.albumTitle||"Unknown Album")),t=t.replace(/\{year\}/g,e.year||"Unknown"),t},Ci=o=>!Array.isArray(o)||o.length===0?0:o.reduce((e,t)=>e+(t.duration||0),0),Li=o=>{if(!o||isNaN(o))return"0 min";const e=Math.floor(o/3600),t=Math.floor(o%3600/60);return e>0?`${e} hr ${t} min`:`${t} min`},Lo=new Map;function Jg(o,e){return new Promise((t,n)=>{const r=new Image,i=URL.createObjectURL(o);r.onload=()=>{URL.revokeObjectURL(i);const c=document.createElement("canvas");c.width=e,c.height=e;const h=c.getContext("2d");h.imageSmoothingEnabled=!0,h.imageSmoothingQuality="high",h.drawImage(r,0,0,e,e),c.toBlob(f=>{f?t(f):n(new Error("Canvas toBlob failed"))},o.type||"image/jpeg",.9)},r.onerror=c=>{URL.revokeObjectURL(i),n(c)},r.src=i})}async function bi(o,e){if(!e)return null;let t=Dd.getSize();t.includes("x")&&(t=t.split("x")[0]);let n=parseInt(t,10);(isNaN(n)||n<=0)&&(n=1280);const r=`${e}-${n}`;if(Lo.has(r))return Lo.get(r);const i=[80,160,320,640,1280];let c=1280;const h=i.find(y=>y>=n);h&&(c=h);const f=async y=>{try{const u=`https://corsproxy.io/?${encodeURIComponent(y)}`,l=await fetch(u);if(l.ok)return await l.blob()}catch(u){console.warn("Proxy fetch failed:",u)}return null};let g=null;try{const y=o.getCoverUrl(e,c.toString()),u=await fetch(y);u.ok?g=await u.blob():g=await f(y)}catch{const y=o.getCoverUrl(e,c.toString());g=await f(y)}if(g){if(c!==n)try{g=await Jg(g,n)}catch(y){console.warn("Failed to resize cover art, using original size:",y)}return Lo.set(r,g),g}return null}function Bi(o,e,t,n=null){o.style.visibility="hidden",o.style.display="block",o.style.maxHeight="",o.style.overflowY="";const r=o.offsetWidth,i=o.offsetHeight,c=window.innerWidth,h=window.innerHeight;let f=e,g=t;n?(f+r>c-10&&(f=Math.max(10,n.right-r)),g+i>h-10&&(g=Math.max(10,n.top-i-5))):(f+r>c-10&&(f=Math.max(10,c-r-10)),g+i>h-10&&(g=Math.max(10,t-i))),f<10&&(f=10),g<10&&(g=10);const y=o.offsetHeight;g+y>h-10&&(o.style.maxHeight=`${h-g-10}px`,o.style.overflowY="auto"),o.style.top=`${g}px`,o.style.left=`${f}px`,o.style.visibility="visible"}const Ns=o=>{const e=window.NL_MODE?"https://monochrome.tf":window.location.origin,t=o.startsWith("/")?o:`/${o}`;return`${e}${t}`};class Zg{constructor(e={}){this.memoryCache=new Map,this.maxSize=e.maxSize||200,this.ttl=e.ttl||1e3*60*30,this.dbName="monochrome-cache",this.dbVersion=1,this.db=null,this.initDB()}async initDB(){if(!(typeof indexedDB>"u"))return new Promise((e,t)=>{const n=indexedDB.open(this.dbName,this.dbVersion);n.onerror=()=>t(n.error),n.onsuccess=()=>{this.db=n.result,e(this.db)},n.onupgradeneeded=r=>{const i=r.target.result;i.objectStoreNames.contains("responses")||i.createObjectStore("responses",{keyPath:"key"}).createIndex("timestamp","timestamp",{unique:!1})}})}generateKey(e,t){const n=typeof t=="object"?JSON.stringify(t):String(t);return`${e}:${n}`}async get(e,t){const n=this.generateKey(e,t);if(this.memoryCache.has(n)){const r=this.memoryCache.get(n);if(Date.now()-r.timestamp<this.ttl)return r.data;this.memoryCache.delete(n)}if(this.db)try{const r=await this.getFromIndexedDB(n);if(r&&Date.now()-r.timestamp<this.ttl)return this.memoryCache.set(n,r),r.data}catch(r){console.log("IndexedDB read error:",r)}return null}async set(e,t,n){const r=this.generateKey(e,t),i={key:r,data:n,timestamp:Date.now()};if(this.memoryCache.set(r,i),this.memoryCache.size>this.maxSize){const c=this.memoryCache.keys().next().value;this.memoryCache.delete(c)}if(this.db)try{await this.setInIndexedDB(i)}catch(c){console.log("IndexedDB write error:",c)}}getFromIndexedDB(e){return new Promise((t,n)=>{if(!this.db){t(null);return}const c=this.db.transaction(["responses"],"readonly").objectStore("responses").get(e);c.onsuccess=()=>t(c.result||null),c.onerror=()=>n(c.error)})}setInIndexedDB(e){return new Promise((t,n)=>{if(!this.db){t();return}const c=this.db.transaction(["responses"],"readwrite").objectStore("responses").put(e);c.onsuccess=()=>t(),c.onerror=()=>n(c.error)})}async clear(){if(this.memoryCache.clear(),this.db)return new Promise((e,t)=>{const i=this.db.transaction(["responses"],"readwrite").objectStore("responses").clear();i.onsuccess=()=>e(),i.onerror=()=>t(i.error)})}async clearExpired(){const e=Date.now(),t=[];for(const[n,r]of this.memoryCache.entries())e-r.timestamp>=this.ttl&&t.push(n);if(t.forEach(n=>this.memoryCache.delete(n)),this.db)try{const i=this.db.transaction(["responses"],"readwrite").objectStore("responses").index("timestamp"),c=IDBKeyRange.upperBound(e-this.ttl),h=i.openCursor(c);h.onsuccess=f=>{const g=f.target.result;g&&(g.delete(),g.continue())}}catch(n){console.log("Failed to clear expired IndexedDB entries:",n)}}getCacheStats(){return{memoryEntries:this.memoryCache.size,maxSize:this.maxSize,ttl:this.ttl}}}async function ep(o,e,t=null){const n=[];e.title&&n.push(gr("TIT2",e.title));const r=e.artist?.name||e.artists?.[0]?.name;r&&n.push(gr("TPE1",r)),e.album?.title&&n.push(gr("TALB",e.album.title));const i=e.album?.artist?.name||e.artist?.name||e.artists?.[0]?.name;if(i&&n.push(gr("TPE2",i)),e.trackNumber&&n.push(gr("TRCK",e.trackNumber.toString())),e.album?.releaseDate){const c=new Date(e.album.releaseDate).getFullYear();!Number.isNaN(c)&&Number.isFinite(c)&&n.push(gr("TYER",c.toString()))}return e.isrc&&n.push(gr("TSRC",e.isrc)),e.copyright&&n.push(gr("TCOP",e.copyright)),n.push(gr("TENC","Monochrome")),t&&n.push(await tp(t)),np(o,n)}function gr(o,e){const t=new Uint8Array([255,254]),n=new Uint8Array(e.length*2);for(let h=0;h<e.length;h++){const f=e.charCodeAt(h);n[h*2]=f&255,n[h*2+1]=f>>8&255}const r=1+t.length+n.length,i=new Uint8Array(10+r),c=new DataView(i.buffer);for(let h=0;h<4;h++)i[h]=o.charCodeAt(h);return c.setUint32(4,r,!1),i[10]=1,i.set(t,11),i.set(n,11+t.length),i}async function tp(o){const e=new Uint8Array(await o.arrayBuffer()),t=o.type||"image/jpeg",n=new TextEncoder().encode(t),r=1+n.length+1+1+1+e.length,i=new Uint8Array(10+r),c=new DataView(i.buffer);for(let f=0;f<4;f++)i[f]="APIC".charCodeAt(f);c.setUint32(4,r,!1);let h=10;return i[h++]=0,i.set(n,h),h+=n.length,i[h++]=0,i[h++]=3,i[h++]=0,i.set(e,h),i}function np(o,e){const t=new Uint8Array(e.reduce((c,h)=>c+h.length,0));let n=0;for(const c of e)t.set(c,n),n+=c.length;const r=t.length,i=new Uint8Array(10);return i[0]=73,i[1]=68,i[2]=51,i[3]=3,i[4]=0,i[5]=0,i[6]=r>>21&127,i[7]=r>>14&127,i[8]=r>>7&127,i[9]=r&127,new Blob([i,t,o],{type:"audio/mpeg"})}async function ap(o,e,t){try{let n=null;if(e.album?.cover)try{n=await bi(t,e.album.cover)}catch(r){console.warn("Failed to fetch album art for MP3:",r)}return await ep(o,e,n)}catch(n){return console.error("Failed to add MP3 metadata:",n),o}}const rp="Monochrome",ip="Unknown Title",id="Unknown Artist",sp="Unknown Album";function Jd(o){const e=Array.isArray(o.artists)&&o.artists.length>0?o.artists.map(r=>(typeof r=="string"?r:r.name)||"").filter(Boolean):o.artist?.name?[o.artist.name]:[],t=/\(\s*(?:feat\.?|ft\.?|with)\s+(.+?)\s*\)/gi,n=[...o.title?.matchAll(t)??[]].flatMap(r=>r[1].split(/\s*[,&]\s*/).map(i=>i.trim()).filter(Boolean));if(n.length>0){const r=new Set(e.map(i=>i.toLowerCase()));for(const i of n)r.has(i.toLowerCase())||(e.push(i),r.add(i.toLowerCase()))}return e.join("; ")||null}async function ul(o,e,t,n){const r=await o.slice(0,12).arrayBuffer(),i=new DataView(r);switch($d(i,o.type)){case"flac":return await fp(o,e,t);case"mp4":return await pp(o,e,t);case"mp3":return await ap(o,e,t);default:return console.warn(`Unknown audio format (mime: ${o.type}), returning original blob`),o}}async function op(o,e=[]){const t={title:o.name.replace(/\.[^/.]+$/,""),artists:[],artist:{name:"Unknown Artist"},album:{title:"Unknown Album",cover:"assets/appicon.png",releaseDate:null},duration:0,isrc:null,copyright:null,isLocal:!0,file:o,id:`local-${o.name}-${o.lastModified}`};try{o.type==="audio/flac"||o.name.endsWith(".flac")?await lp(o,t):o.type==="audio/mp4"||o.name.endsWith(".m4a")?await cp(o,t):(o.type==="audio/mpeg"||o.name.endsWith(".mp3"))&&await up(o,t)}catch(n){console.warn("Error reading metadata for",o.name,n)}if(t.artists.length>0&&(t.artist=t.artists[0]),t.album.cover==="assets/appicon.png"&&e.length>0){const n=o.name.substring(0,o.name.lastIndexOf(".")),r=[".jpg",".jpeg",".png",".webp"],i=e.find(c=>{const h=c.name,f=h.lastIndexOf(".");if(f===-1)return!1;const g=h.substring(0,f),y=h.substring(f).toLowerCase();return g===n&&r.includes(y)});i&&(t.album.cover=URL.createObjectURL(i))}return t}async function lp(o,e){const t=await o.arrayBuffer(),n=new DataView(t);if(!$o(n))return;const r=Vo(n),i=r.find(f=>f.type===4),c=r.find(f=>f.type===6),h=[];if(i){const f=i.offset,g=n.getUint32(f,!0);let y=f+4+g;const u=n.getUint32(y,!0);y+=4;for(let l=0;l<u;l++){const d=n.getUint32(y,!0);y+=4;const m=new TextDecoder().decode(new Uint8Array(t,y,d));y+=d;const E=m.indexOf("=");if(E>-1){const S=m.substring(0,E),_=m.substring(E+1),M=S.toUpperCase();M==="TITLE"&&(e.title=_),(M==="ARTIST"||M==="ALBUMARTIST")&&h.push(_),M==="ALBUM"&&(e.album.title=_),M==="ISRC"&&(e.isrc=_),M==="COPYRIGHT"&&(e.copyright=_)}}}if(h.length>0&&(e.artists=h.flatMap(f=>f.split(/; |\/|\\/)).map(f=>({name:f.trim()}))),c)try{let f=c.offset;f+=4;const g=n.getUint32(f,!1);f+=4;const y=new TextDecoder().decode(new Uint8Array(t,f,g));f+=g;const u=n.getUint32(f,!1);f+=4,f+=u,f+=16;const l=n.getUint32(f,!1);f+=4;const d=new Uint8Array(t,f,l),m=new Blob([d],{type:y});e.album.cover=URL.createObjectURL(m)}catch(f){console.warn("Error parsing FLAC picture:",f)}}async function cp(o,e){try{const t=Math.min(o.size,5242880),n=await o.slice(0,t).arrayBuffer(),r=new DataView(n),c=Dr(r).find(Ae=>Ae.type==="moov");if(!c)return;const h=c.offset+8,f=c.size-8,g=new DataView(r.buffer,h,f),u=Dr(g).find(Ae=>Ae.type==="udta");if(!u)return;const l=h+u.offset+8,d=u.size-8,m=new DataView(r.buffer,l,d),S=Dr(m).find(Ae=>Ae.type==="meta");if(!S)return;const _=l+S.offset+12,M=S.size-12,R=new DataView(r.buffer,_,M),fe=Dr(R).find(Ae=>Ae.type==="ilst");if(!fe)return;const ye=_+fe.offset+8,Y=fe.size-8,j=new DataView(r.buffer,ye,Y),se=Dr(j);let Te=null;for(const Ae of se){const ze=ye+Ae.offset+8,de=Ae.size-8,we=new DataView(r.buffer,ze,de),ce=Dr(we).find(he=>he.type==="data");if(ce){const he=ce.size-16,Pe=ze+ce.offset+16;if(Ae.type==="Â©nam")e.title=new TextDecoder().decode(new Uint8Array(r.buffer,Pe,he));else if(Ae.type==="Â©ART")Te=new TextDecoder().decode(new Uint8Array(r.buffer,Pe,he));else if(Ae.type==="Â©alb")e.album.title=new TextDecoder().decode(new Uint8Array(r.buffer,Pe,he));else if(Ae.type==="ISRC")e.isrc=new TextDecoder().decode(new Uint8Array(r.buffer,Pe,he));else if(Ae.type==="cprt")e.copyright=new TextDecoder().decode(new Uint8Array(r.buffer,Pe,he));else if(Ae.type==="covr"){const $e=new Uint8Array(r.buffer,Pe,he),He=dp($e),et=new Blob([$e],{type:He});e.album.cover=URL.createObjectURL(et)}}}Te&&(e.artists=Te.split(/; |\/|\\/).map(Ae=>({name:Ae.trim()})))}catch(t){console.warn("Error parsing M4A:",t)}}async function up(o,e){let t=await o.slice(0,10).arrayBuffer(),n=new DataView(t);if(n.getUint8(0)===73&&n.getUint8(1)===68&&n.getUint8(2)===51){const r=n.getUint8(3),c=Po(n,6)+10;t=await o.slice(0,c).arrayBuffer(),n=new DataView(t);let h=10;if((n.getUint8(5)&64)!==0){const u=Po(n,h);h+=u}let f=null,g=null;for(;h<n.byteLength;){let u,l;if(r===3)u=new TextDecoder().decode(new Uint8Array(t,h,4)),l=n.getUint32(h+4,!1),h+=10;else if(r===4)u=new TextDecoder().decode(new Uint8Array(t,h,4)),l=Po(n,h+4),h+=10;else break;if(u.charCodeAt(0)===0||h+l>n.byteLength)break;const d=new DataView(t,h,l);if(u==="TIT2"&&(e.title=$r(d)),u==="TPE1"&&(f=$r(d)),u==="TPE2"&&(g=$r(d)),u==="TALB"&&(e.album.title=$r(d)),u==="TSRC"&&(e.isrc=$r(d)),u==="TCOP"&&(e.copyright=$r(d)),u==="TYER"||u==="TDRC"){const m=$r(d);m&&(e.album.releaseDate=m)}if(u==="APIC")try{const m=d.getUint8(0);let E="",S=1;for(;S<d.byteLength&&d.getUint8(S)!==0;)E+=String.fromCharCode(d.getUint8(S)),S++;S++,S++;let _=m===1||m===2?2:1;for(;S<d.byteLength;){if(d.getUint8(S)===0){if(_===1){S++;break}else if(S+1<d.byteLength&&d.getUint8(S+1)===0){S+=2;break}}S++}const M=new Uint8Array(t,h+S,l-S),R=new Blob([M],{type:E||"image/jpeg"});e.album.cover=URL.createObjectURL(R)}catch(m){console.warn("Error parsing APIC:",m)}h+=l}const y=f||g;y&&(e.artists=y.split("/").map(u=>({name:u.trim()})))}if(o.size>128){const r=await o.slice(o.size-128).arrayBuffer();if(new TextDecoder().decode(new Uint8Array(r,0,3))==="TAG"){const c=new TextDecoder().decode(new Uint8Array(r,3,30)).replace(/\0/g,"").trim(),h=new TextDecoder().decode(new Uint8Array(r,33,30)).replace(/\0/g,"").trim(),f=new TextDecoder().decode(new Uint8Array(r,63,30)).replace(/\0/g,"").trim();c&&(e.title=c),h&&e.artists.length===0&&(e.artists=[{name:h}]),f&&(e.album.title=f)}}}function Po(o,e){return(o.getUint8(e)&127)<<21|(o.getUint8(e+1)&127)<<14|(o.getUint8(e+2)&127)<<7|o.getUint8(e+3)&127}function $r(o){const e=o.getUint8(0),t=o.buffer.slice(o.byteOffset+1,o.byteOffset+o.byteLength);let n;return e===0?n=new TextDecoder("iso-8859-1"):e===1?n=new TextDecoder("utf-16"):e===2?n=new TextDecoder("utf-16be"):n=new TextDecoder("utf-8"),n.decode(t).replace(/\0/g,"")}function dp(o){return o.length>=2&&o[0]===255&&o[1]===216?"image/jpeg":o.length>=8&&o[0]===137&&o[1]===80&&o[2]===78&&o[3]===71?"image/png":"image/jpeg"}async function fp(o,e,t){try{const n=await o.arrayBuffer(),r=new DataView(n);if(!$o(r))return console.warn("Not a valid FLAC file, returning original"),o;const i=Vo(r);if(!i||i.length===0||i.audioDataOffset===void 0)return console.warn("Failed to parse FLAC blocks, returning original"),o;if(i[0].type!==0)return console.warn("FLAC file missing STREAMINFO block, returning original"),o;const c=hp(e);let h=null;if(e.album?.cover)try{h=await mp(e.album.cover,t)}catch(u){console.warn("Failed to embed album art:",u)}let f;try{f=gp(r,i,c,h)}catch(u){return console.error("Failed to rebuild FLAC structure:",u),o}const g=new DataView(f.buffer);if(!$o(g))return console.error("Rebuilt FLAC has invalid signature, returning original"),o;const y=Vo(g);return!y||y.length===0||y.audioDataOffset===void 0?(console.error("Rebuilt FLAC has invalid block structure, returning original"),o):new Blob([f],{type:"audio/flac"})}catch(n){return console.error("Failed to add FLAC metadata:",n),o}}function $o(o){return o.byteLength>=4&&o.getUint8(0)===102&&o.getUint8(1)===76&&o.getUint8(2)===97&&o.getUint8(3)===67}function Vo(o){const e=[];let t=4;for(;t+4<=o.byteLength;){const n=o.getUint8(t),r=(n&128)!==0,i=n&127;if(i===127){console.warn("Encountered invalid block type 127, stopping parse");break}const c=o.getUint8(t+1)<<16|o.getUint8(t+2)<<8|o.getUint8(t+3);if(c<0||t+4+c>o.byteLength){console.warn(`Invalid block size ${c} at offset ${t}, stopping parse`);break}if(e.push({type:i,isLast:r,size:c,offset:t+4,headerOffset:t}),t+=4+c,r){e.audioDataOffset=t;break}}if(e.audioDataOffset===void 0&&e.length>0){const n=e[e.length-1];e.audioDataOffset=n.headerOffset+4+n.size,console.warn("No last-block marker found, estimated audio offset:",e.audioDataOffset)}return e}function hp(o){const e=[],t=o.volumeNumber??o.discNumber;o.title&&e.push(["TITLE",o.title]);const n=Jd(o);n&&e.push(["ARTIST",n]),o.album?.title&&e.push(["ALBUM",o.album.title]);const r=o.album?.artist?.name||o.artist?.name;r&&e.push(["ALBUMARTIST",r]),o.trackNumber&&e.push(["TRACKNUMBER",String(o.trackNumber)]),t&&e.push(["DISCNUMBER",String(t)]),o.album?.numberOfTracks&&e.push(["TRACKTOTAL",String(o.album.numberOfTracks)]);const i=o.album?.releaseDate||(o.streamStartDate?o.streamStartDate.split("T")[0]:"");if(i)try{const m=new Date(i).getFullYear();isNaN(m)||e.push(["DATE",String(m)])}catch{}o.copyright&&e.push(["COPYRIGHT",o.copyright]),o.isrc&&e.push(["ISRC",o.isrc]);const c=rp,h=new TextEncoder().encode(c);let f=4+h.length+4;const g=e.map(([m,E])=>{const S=`${m}=${E}`,_=new TextEncoder().encode(S);return f+=4+_.length,_}),y=new ArrayBuffer(f),u=new DataView(y),l=new Uint8Array(y);let d=0;u.setUint32(d,h.length,!0),d+=4,l.set(h,d),d+=h.length,u.setUint32(d,e.length,!0),d+=4;for(const m of g)u.setUint32(d,m.length,!0),d+=4,l.set(m,d),d+=m.length;return l}async function mp(o,e){try{const t=await bi(e,o);if(!t)throw new Error("Failed to fetch album art");const n=new Uint8Array(await t.arrayBuffer()),r=t.type||"image/jpeg",i=new TextEncoder().encode(r),h=new TextEncoder().encode(""),f=8+i.length+4+h.length+4+4+4+4+4+n.length,g=new ArrayBuffer(f),y=new DataView(g),u=new Uint8Array(g);let l=0;return y.setUint32(l,3,!1),l+=4,y.setUint32(l,i.length,!1),l+=4,u.set(i,l),l+=i.length,y.setUint32(l,h.length,!1),l+=4,h.length>0&&(u.set(h,l),l+=h.length),y.setUint32(l,0,!1),l+=4,y.setUint32(l,0,!1),l+=4,y.setUint32(l,0,!1),l+=4,y.setUint32(l,0,!1),l+=4,y.setUint32(l,n.length,!1),l+=4,u.set(n,l),u}catch(t){return console.error("Failed to create FLAC picture block:",t),null}}function gp(o,e,t,n){const r=new Uint8Array(o.buffer),i=e.filter(m=>m.type!==4&&m.type!==6);let c=4;for(const m of i)c+=4+m.size;c+=4+t.length,n&&(c+=4+n.length);const h=e.audioDataOffset;if(h===void 0)throw new Error("Invalid FLAC file structure: unable to locate audio data stream");const f=o.byteLength-h;c+=f;const g=new Uint8Array(c);let y=0;g[y++]=102,g[y++]=76,g[y++]=97,g[y++]=67;for(let m=0;m<i.length;m++){const E=i[m],S=0|E.type;g[y++]=S,g[y++]=E.size>>16&255,g[y++]=E.size>>8&255,g[y++]=E.size&255,g.set(r.subarray(E.offset,E.offset+E.size),y),y+=E.size}const u=y,l=4;g[y++]=l,g[y++]=t.length>>16&255,g[y++]=t.length>>8&255,g[y++]=t.length&255,g.set(t,y),y+=t.length;let d=u;if(n){const m=y,E=6;g[y++]=E,g[y++]=n.length>>16&255,g[y++]=n.length>>8&255,g[y++]=n.length&255,g.set(n,y),y+=n.length,d=m}return g[d]|=128,f>0&&g.set(r.subarray(h,h+f),y),g}async function pp(o,e,t){try{const n=await o.arrayBuffer(),r=new DataView(n),i=Dr(r),c=yp(e);if(e.album?.cover)try{const f=await bi(t,e.album.cover);if(f){const g=new Uint8Array(await f.arrayBuffer());c.cover={type:"covr",data:g}}}catch(f){console.warn("Failed to embed album art in M4A:",f)}const h=bp(r,i,c);return new Blob([h],{type:"audio/mp4"})}catch(n){return console.error("Failed to add M4A metadata:",n),o}}function Dr(o){const e=[];let t=0;for(;t+8<=o.byteLength;){let n=o.getUint32(t,!1);if(n===0)n=o.byteLength-t;else if(n===1){if(t+16>o.byteLength)break;const i=o.getUint32(t+8,!1),c=o.getUint32(t+12,!1);if(i!==0){console.warn("64-bit MP4 atoms larger than 4GB are not supported - file may be processed incompletely");break}n=c}if(n<8||t+n>o.byteLength)break;const r=String.fromCharCode(o.getUint8(t+4),o.getUint8(t+5),o.getUint8(t+6),o.getUint8(t+7));e.push({type:r,offset:t,size:n}),t+=n}return e}function yp(o){const e={"Â©nam":o.title||ip,"Â©ART":Jd(o)||id,"Â©alb":o.album?.title||sp,aART:o.album?.artist?.name||o.artist?.name||id};o.isrc&&(e.ISRC=o.isrc),o.copyright&&(e.cprt=o.copyright),o.trackNumber&&(e.trkn={current:o.trackNumber,total:o.album?.numberOfTracks});const t=o.volumeNumber??o.discNumber;t&&(e.disk={current:t,total:0});const n=o.album?.releaseDate||(o.streamStartDate?o.streamStartDate.split("T")[0]:"");if(n)try{const r=new Date(n).getFullYear();isNaN(r)||(e["Â©day"]=String(r))}catch{}return{tags:e}}function bp(o,e,t){const n=new Uint8Array(o.buffer),r=e.find(_=>_.type==="moov");if(!r)return console.warn("No moov atom found in M4A file"),n;const i=Ep(t),h=Dr(new DataView(n.buffer,r.offset+8,r.size-8)).filter(_=>_.type!=="udta");let f=8;for(const _ of h)f+=_.size;f+=i.length;const g=f-r.size,y=n.length+g,u=new Uint8Array(y);let l=0,d=0;const m=e.filter(_=>_.offset<r.offset);for(const _ of m)u.set(n.subarray(_.offset,_.offset+_.size),l),l+=_.size,d+=_.size;u[l++]=f>>24&255,u[l++]=f>>16&255,u[l++]=f>>8&255,u[l++]=f&255,u[l++]=109,u[l++]=111,u[l++]=111,u[l++]=118;for(const _ of h){const M=r.offset+8+_.offset;u.set(n.subarray(M,M+_.size),l),l+=_.size}u.set(i,l),l+=i.length,d=r.offset+r.size;const E=e.find(_=>_.type==="mdat");return E&&r.offset<E.offset&&_p(u,l-f,f,g),d<n.length&&u.set(n.subarray(d),l),u}function Ep(o){const{tags:e,cover:t}=o,n=[];for(const[S,_]of Object.entries(e))S==="trkn"||S==="disk"?n.push(Tp(S,_)):n.push(vp(S,_));t&&n.push(wp(t.data));const r=8+n.reduce((S,_)=>S+_.length,0),i=new Uint8Array(r);let c=0;Za(i,c,r,"ilst"),c+=8;for(const S of n)i.set(S,c),c+=S.length;const h=12+r,f=new Uint8Array(h);c=0,Za(f,c,h,"meta"),c+=8,f[c++]=0,f[c++]=0,f[c++]=0,f[c++]=0,f.set(i,c);const g=new Uint8Array([0,0,0,0,0,0,0,0,109,100,105,114,97,112,112,108,0,0,0,0,0,0,0,0,0,0]),y=8+g.length,u=new Uint8Array(y);Za(u,0,y,"hdlr"),u.set(g,8);const l=12+y+r,d=new Uint8Array(l);c=0,Za(d,c,l,"meta"),c+=8,d[c++]=0,d[c++]=0,d[c++]=0,d[c++]=0,d.set(u,c),c+=y,d.set(i,c);const m=8+l,E=new Uint8Array(m);return Za(E,0,m,"udta"),E.set(d,8),E}function vp(o,e){const t=new TextEncoder().encode(e),n=16+t.length,r=8+n,i=new Uint8Array(r);let c=0;return Za(i,c,r,o),c+=8,Za(i,c,n,"data"),c+=8,i[c++]=0,i[c++]=0,i[c++]=0,i[c++]=1,i[c++]=0,i[c++]=0,i[c++]=0,i[c++]=0,i.set(t,c),i}function Tp(o,e){const r=new Uint8Array(32);let i=0;Za(r,i,32,o),i+=8,Za(r,i,24,"data"),i+=8,r[i++]=0,r[i++]=0,r[i++]=0,r[i++]=0,r[i++]=0,r[i++]=0,r[i++]=0,r[i++]=0;const c=typeof e=="object"?e.current:e,h=typeof e=="object"?e.total:0;r[i++]=0,r[i++]=0;const f=parseInt(c,10)||0;r[i++]=f>>8&255,r[i++]=f&255;const g=parseInt(h,10)||0;return r[i++]=g>>8&255,r[i++]=g&255,r[i++]=0,r[i++]=0,r}function wp(o){const e=16+o.length,t=8+e,n=new Uint8Array(t);let r=0;Za(n,r,t,"covr"),r+=8,Za(n,r,e,"data"),r+=8;let i=13;return o[0]===137&&o[1]===80&&(i=14),n[r++]=0,n[r++]=0,n[r++]=0,n[r++]=i,n[r++]=0,n[r++]=0,n[r++]=0,n[r++]=0,n.set(o,r),n}function Za(o,e,t,n){o[e++]=t>>24&255,o[e++]=t>>16&255,o[e++]=t>>8&255,o[e++]=t&255;for(let r=0;r<4;r++)o[e++]=n.charCodeAt(r)}function _p(o,e,t,n){const r=new DataView(o.buffer,o.byteOffset,o.byteLength);let i=e+8;const c=e+t;Zd(r,i,c,n)}function Zd(o,e,t,n){let r=e;for(;r+8<=t;){const i=o.getUint32(r,!1),c=String.fromCharCode(o.getUint8(r+4),o.getUint8(r+5),o.getUint8(r+6),o.getUint8(r+7));if(i<8)break;if(c==="trak"||c==="mdia"||c==="minf"||c==="stbl")Zd(o,r+8,r+i,n);else if(c==="stco"){const h=o.getUint32(r+12,!1);for(let f=0;f<h;f++){const g=r+16+f*4,y=o.getUint32(g,!1);o.setUint32(g,y+n,!1)}}else if(c==="co64"){const h=o.getUint32(r+12,!1);for(let f=0;f<h;f++){const g=r+16+f*8,y=o.getUint32(g,!1);let l=o.getUint32(g+4,!1)+n,d=0;l>4294967295&&(d=Math.floor(l/4294967296),l=l>>>0);const m=y+d;o.setUint32(g,m,!1),o.setUint32(g+4,l,!1)}}r+=i}}const Ap=Object.freeze(Object.defineProperty({__proto__:null,addMetadataToAudio:ul,readTrackMetadata:op},Symbol.toStringTag,{value:"Module"}));class ef{constructor(){}async downloadDashStream(e,t={}){const{onProgress:n,signal:r}=t,c=await(await fetch(e)).text(),h=this.parseManifest(c);if(!h)throw new Error("Failed to parse DASH manifest");const f=this.generateSegmentUrls(h),g=h.mimeType||"audio/mp4",y=[];let u=0;const l=f.length;for(let d=0;d<f.length;d++){if(r?.aborted)throw new Error("AbortError");const m=f[d],E=await fetch(m,{signal:r});if(E.ok){const S=await E.arrayBuffer();y.push(S),u+=S.byteLength}else{console.warn(`Failed to fetch segment ${d}, retrying...`),await new Promise(M=>setTimeout(M,1e3));const S=await fetch(m,{signal:r});if(!S.ok)throw new Error(`Failed to fetch segment ${d}: ${S.status}`);const _=await S.arrayBuffer();y.push(_),u+=_.byteLength}n&&n({stage:"downloading",receivedBytes:u,totalBytes:void 0,currentSegment:d+1,totalSegments:l})}return new Blob(y,{type:g})}parseManifest(e){const r=new DOMParser().parseFromString(e,"text/xml").querySelector("MPD");if(!r)throw new Error("Invalid DASH manifest: No MPD tag");const i=r.querySelector("Period");if(!i)throw new Error("Invalid DASH manifest: No Period tag");const c=Array.from(i.querySelectorAll("AdaptationSet"));c.sort((R,W)=>{const fe=ye=>{const Y=Array.from(ye.querySelectorAll("Representation"));return Y.length?Math.max(...Y.map(j=>parseInt(j.getAttribute("bandwidth")||"0",10))):0};return fe(W)-fe(R)});let h=c.find(R=>R.getAttribute("mimeType")?.startsWith("audio"));if(!h&&c.length>0&&(h=c[0]),!h)throw new Error("No AdaptationSet found");const f=Array.from(h.querySelectorAll("Representation")).sort((R,W)=>{const fe=parseInt(R.getAttribute("bandwidth")||"0");return parseInt(W.getAttribute("bandwidth")||"0")-fe});if(f.length===0)throw new Error("No Representation found");const g=f[0],y=g.getAttribute("id"),u=g.querySelector("SegmentTemplate")||h.querySelector("SegmentTemplate");if(!u)throw new Error("No SegmentTemplate found");const l=u.getAttribute("initialization"),d=u.getAttribute("media"),m=parseInt(u.getAttribute("startNumber")||"1",10),E=g.querySelector("BaseURL")||h.querySelector("BaseURL")||i.querySelector("BaseURL")||r.querySelector("BaseURL"),S=E?E.textContent.trim():"",_=u.querySelector("SegmentTimeline"),M=[];if(_){const R=_.querySelectorAll("S");let W=0,fe=m;R.forEach(ye=>{const Y=ye.getAttribute("t");Y&&(W=parseInt(Y,10));const j=parseInt(ye.getAttribute("d"),10),se=parseInt(ye.getAttribute("r")||"0",10);M.push({number:fe,time:W}),W+=j,fe++;for(let Te=0;Te<se;Te++)M.push({number:fe,time:W}),W+=j,fe++})}return{baseUrl:S,initialization:l,media:d,segments:M,repId:y,mimeType:h.getAttribute("mimeType")}}generateSegmentUrls(e){const{baseUrl:t,initialization:n,media:r,segments:i,repId:c}=e,h=[],f=(y,u,l)=>y.replace(/\$RepresentationID\$/g,c).replace(/\$Number(?:%0([0-9]+)d)?\$/g,(d,m)=>m?u.toString().padStart(parseInt(m),"0"):u).replace(/\$Time(?:%0([0-9]+)d)?\$/g,(d,m)=>m?l.toString().padStart(parseInt(m),"0"):l),g=(y,u)=>!y||u.startsWith("http")?u:y.endsWith("/")?y+u:y+"/"+u;if(n){const y=f(n,0,0);h.push(g(t,y))}return i&&i.length>0&&i.forEach(y=>{const u=f(r,y.number,y.time);h.push(g(t,u))}),h}}class As extends Error{constructor(e){super(e),this.name="FfmpegError",this.code="FFMPEG_FAILED"}}async function Sp(o,e={},t="output",n="application/octet-stream",r=null,i=null){const c=await o.arrayBuffer();return new Promise((h,f)=>{const g=new Worker(new URL(""+new URL("ffmpeg.worker-Cz2UznRr.js",import.meta.url).href,import.meta.url),{type:"module"}),y=()=>{g.terminate(),f(new As("FFMPEG aborted"))};if(i){if(i.aborted){y();return}i.addEventListener("abort",y)}g.onmessage=u=>{const{type:l,blob:d,message:m,stage:E,progress:S}=u.data;l==="complete"?(i&&i.removeEventListener("abort",y),g.terminate(),h(d)):l==="error"?(i&&i.removeEventListener("abort",y),g.terminate(),f(new As(m))):l==="progress"&&r?r({stage:E,message:m,progress:S}):l==="log"&&console.log("[FFmpeg]",m)},g.onerror=u=>{i&&i.removeEventListener("abort",y),g.terminate(),f(new As("Worker failed: "+u.message))},g.postMessage({audioData:c,...e,output:{name:t,mime:n}},[c])})}async function kp(o,e={},t="output",n="application/octet-stream",r=null,i=null){try{if(typeof Worker<"u")return await Sp(o,e,t,n,r,i);throw new As("Web Workers are required for FFMPEG")}catch(c){throw console.error("FFMPEG failed:",c),c}}class Wo extends Error{constructor(e){super(e),this.name="MP3EncodingError",this.code="MP3_ENCODING_FAILED"}}async function tf(o,e=null,t=null){try{if(typeof Worker<"u")return await kp(o,{args:["-map_metadata","-1","-c:a","libmp3lame","-b:a","320k","-ar","44100"]},"output.mp3","audio/mpeg",e,t);throw new Wo("Web Workers are required for MP3 encoding")}catch(n){throw console.error("MP3 encoding failed:",n),new Wo(n?.message??n)}}const Ip="txNoH4kkV41MfH25";class Rp{constructor(e){this.settings=e,this.cache=new Zg({maxSize:200,ttl:1e3*60*30}),this.streamCache=new Map,setInterval(()=>{this.cache.clearExpired(),this.pruneStreamCache()},1e3*60*5)}pruneStreamCache(){if(this.streamCache.size>50){const e=Array.from(this.streamCache.entries());e.slice(0,e.length-50).forEach(([n])=>this.streamCache.delete(n))}}async fetchWithRetry(e,t={}){const n=t.type||"api";let r=await this.settings.getInstances(n);if(r.length===0)throw new Error(`No API instances configured for type: ${n}`);if(t.minVersion&&(r=r.filter(f=>f.version?parseFloat(f.version)>=parseFloat(t.minVersion):!1),r.length===0))throw new Error(`No API instances configured for type: ${n} with minVersion: ${t.minVersion}`);const i=r.length*2;let c=null,h=Math.floor(Math.random()*r.length);for(let f=1;f<=i;f++){const g=r[h%r.length],y=typeof g=="string"?g:g.url,u=y.endsWith("/")?`${y}${e.substring(1)}`:`${y}${e}`;try{const l=await fetch(u,{signal:t.signal});if(l.status===429){console.warn(`Rate limit hit on ${y}. Trying next instance...`),h++,await rd(500);continue}if(l.ok)return l;if(l.status===401&&(await l.clone().json())?.subStatus===11002){console.warn(`Auth failed on ${y}. Trying next instance...`),h++;continue}if(l.status>=500){console.warn(`Server error ${l.status} on ${y}. Trying next instance...`),h++;continue}c=new Error(`Request failed with status ${l.status}`),h++}catch(l){if(l.name==="AbortError")throw l;c=l,console.warn(`Network error on ${y}: ${l.message}. Trying next instance...`),h++,await rd(200)}}throw c||new Error(`All API instances failed for: ${e}`)}findSearchSection(e,t,n){if(!(!e||typeof e!="object")){if(Array.isArray(e)){for(const r of e){const i=this.findSearchSection(r,t,n);if(i)return i}return}if(!n.has(e)){if(n.add(e),"items"in e&&Array.isArray(e.items))return e;if(t in e){const r=this.findSearchSection(e[t],t,n);if(r)return r}for(const r of Object.values(e)){const i=this.findSearchSection(r,t,n);if(i)return i}}}}buildSearchResponse(e){const t=e?.items??[];return{items:t,limit:e?.limit??t.length,offset:e?.offset??0,totalNumberOfItems:e?.totalNumberOfItems??t.length}}normalizeSearchResponse(e,t){const n=this.findSearchSection(e,t,new Set);return this.buildSearchResponse(n)}prepareTrack(e){let t=e;!e.artist&&Array.isArray(e.artists)&&e.artists.length>0&&(t={...e,artist:e.artists[0]});const n=Xd(t);return n&&t.audioQuality!==n&&(t={...t,audioQuality:n}),t.isUnavailable=Xg(t),t}prepareAlbum(e){return!e.artist&&Array.isArray(e.artists)&&e.artists.length>0?{...e,artist:e.artists[0]}:e}preparePlaylist(e){return e}prepareArtist(e){return!e.type&&Array.isArray(e.artistTypes)&&e.artistTypes.length>0?{...e,type:e.artistTypes[0]}:e}async enrichTracksWithAlbumDates(e,t=20){if(!Ds.useAlbumYear())return e;const n=[];for(const h of e)!h.album?.releaseDate&&h.album?.id&&!n.includes(h.album.id)&&n.push(h.album.id);if(n.length===0)return e;const r=n.slice(0,t);n.length>t&&console.warn(`[Enrich] Too many albums to fetch (${n.length}). limiting to ${t}.`);const i=new Map,c=5;for(let h=0;h<r.length;h+=c){const f=r.slice(h,h+c),g=await Promise.allSettled(f.map(y=>this.getAlbum(y)));for(let y=0;y<g.length;y++){const u=g[y],l=f[y];u.status==="fulfilled"&&u.value.album?.releaseDate&&i.set(l,u.value.album.releaseDate)}}return e.map(h=>!h.album?.releaseDate&&h.album?.id&&i.has(h.album.id)?{...h,album:{...h.album,releaseDate:i.get(h.album.id)}}:h)}parseTrackLookup(e){const t=Array.isArray(e)?e:[e];let n,r,i;for(const c of t)if(!(!c||typeof c!="object")){if(!n&&"duration"in c){n=c;continue}if(!r&&"manifest"in c){r=c;continue}if(!i&&"OriginalTrackUrl"in c){const h=c.OriginalTrackUrl;typeof h=="string"&&(i=h)}}if(!n||!r)throw new Error("Malformed track response");return{track:n,info:r,originalTrackUrl:i}}extractStreamUrlFromManifest(e){try{const t=atob(e);if(t.includes("<MPD")){const n=new Blob([t],{type:"application/dash+xml"});return URL.createObjectURL(n)}try{const n=JSON.parse(t);if(n?.urls?.[0])return n.urls[0]}catch{const n=t.match(/https?:\/\/[\w\-.~:?#[@!$&'()*+,;=%/]+/);return n?n[0]:null}}catch(t){return console.error("Failed to decode manifest:",t),null}}deduplicateAlbums(e){const t=new Map;for(const n of e){const r=JSON.stringify([n.title,n.numberOfTracks||0]);if(t.has(r)){const i=t.get(r);if(n.explicit&&!i.explicit){t.set(r,n);continue}if(!n.explicit&&i.explicit)continue;const c=i.mediaMetadata?.tags?.length||0;(n.mediaMetadata?.tags?.length||0)>c&&t.set(r,n)}else t.set(r,n)}return Array.from(t.values())}async searchTracks(e,t={}){const n=await this.cache.get("search_tracks",e);if(n)return n;try{const i=await(await this.fetchWithRetry(`/search/?s=${encodeURIComponent(e)}`,t)).json(),c=this.normalizeSearchResponse(i,"tracks"),h=c.items.map(g=>this.prepareTrack(g)),f={...c,items:h};return await this.cache.set("search_tracks",e,f),f}catch(r){if(r.name==="AbortError")throw r;return console.error("Track search failed:",r),{items:[],limit:0,offset:0,totalNumberOfItems:0}}}async searchArtists(e,t={}){const n=await this.cache.get("search_artists",e);if(n)return n;try{const i=await(await this.fetchWithRetry(`/search/?a=${encodeURIComponent(e)}`,t)).json(),c=this.normalizeSearchResponse(i,"artists"),h={...c,items:c.items.map(f=>this.prepareArtist(f))};return await this.cache.set("search_artists",e,h),h}catch(r){if(r.name==="AbortError")throw r;return console.error("Artist search failed:",r),{items:[],limit:0,offset:0,totalNumberOfItems:0}}}async searchAlbums(e,t={}){const n=await this.cache.get("search_albums",e);if(n)return n;try{const i=await(await this.fetchWithRetry(`/search/?al=${encodeURIComponent(e)}`,t)).json(),c=this.normalizeSearchResponse(i,"albums"),h=c.items.map(g=>this.prepareAlbum(g)),f={...c,items:this.deduplicateAlbums(h)};return await this.cache.set("search_albums",e,f),f}catch(r){if(r.name==="AbortError")throw r;return console.error("Album search failed:",r),{items:[],limit:0,offset:0,totalNumberOfItems:0}}}async searchPlaylists(e,t={}){const n=await this.cache.get("search_playlists",e);if(n)return n;try{const i=await(await this.fetchWithRetry(`/search/?p=${encodeURIComponent(e)}`,t)).json(),c=this.normalizeSearchResponse(i,"playlists"),h={...c,items:c.items.map(f=>this.preparePlaylist(f))};return await this.cache.set("search_playlists",e,h),h}catch(r){if(r.name==="AbortError")throw r;return console.error("Playlist search failed:",r),{items:[],limit:0,offset:0,totalNumberOfItems:0}}}async getAlbum(e){const t=await this.cache.get("album",e);if(t)return t;const r=await(await this.fetchWithRetry(`/album/?id=${e}`)).json(),i=r.data||r;let c,h;if(i&&typeof i=="object"&&!Array.isArray(i)&&(("numberOfTracks"in i||"title"in i)&&(c=this.prepareAlbum(i)),"items"in i&&(h=i,!c&&i.items&&i.items.length>0))){const y=i.items[0],u=y.item||y;u&&u.album&&(c=this.prepareAlbum(u.album))}if(!c)throw new Error("Album not found");if(!c.artist&&h?.items&&h.items.length>0){const y=h.items[0],u=y.item||y;u&&u.artist&&(c={...c,artist:u.artist})}if(!c.releaseDate&&h?.items&&h.items.length>0){const y=h.items[0],u=y.item||y;u&&(u.album&&u.album.releaseDate?c={...c,releaseDate:u.album.releaseDate}:u.streamStartDate&&(c={...c,releaseDate:u.streamStartDate.split("T")[0]}))}let f=(h?.items||[]).map(y=>this.prepareTrack(y.item||y));if(c&&c.numberOfTracks>f.length){let y=f.length;const u=1e4;for(;f.length<c.numberOfTracks&&f.length<u;)try{const d=await(await this.fetchWithRetry(`/album/?id=${e}&offset=${y}&limit=500`)).json(),m=d.data||d;let E=[];if(m.items)E=m.items;else if(Array.isArray(m)){for(const _ of m)if(_&&typeof _=="object"&&"items"in _&&Array.isArray(_.items)){E=_.items;break}}if(!E||E.length===0)break;const S=E.map(_=>this.prepareTrack(_.item||_));if(S.length===0||f.length>0&&S[0].id===f[0].id)break;f.length>0&&(S[0].id,f[f.length-1].id),f=f.concat(S),y+=S.length}catch(l){console.error(`Error fetching album tracks at offset ${y}:`,l);break}}c?.releaseDate&&(f=f.map(y=>y.album&&!y.album.releaseDate?{...y,album:{...y.album,releaseDate:c.releaseDate}}:y));const g={album:c,tracks:f};return await this.cache.set("album",e,g),g}async getPlaylist(e){const t=await this.cache.get("playlist",e);if(t)return t;const r=await(await this.fetchWithRetry(`/playlist/?id=${e}`)).json(),i=r.data||r;let c=null,h=null;if(i.playlist&&(c=i.playlist),i.items&&(h={items:i.items}),!c||!h){const y=Array.isArray(i)?i:[i];for(const u of y)!u||typeof u!="object"||(!c&&("uuid"in u||"numberOfTracks"in u||"title"in u&&"id"in u)&&(c=u),!h&&"items"in u&&(h=u))}if(!c&&Array.isArray(i)){for(const y of i)if(y&&typeof y=="object"&&("uuid"in y||"numberOfTracks"in y)){c=y;break}}if(!c)throw new Error("Playlist not found");let f=(h?.items||[]).map(y=>this.prepareTrack(y.item||y));if(c.numberOfTracks>f.length){let y=f.length;const u=1e4;for(;f.length<c.numberOfTracks&&f.length<u;)try{const d=await(await this.fetchWithRetry(`/playlist/?id=${e}&offset=${y}`)).json(),m=d.data||d;let E=[];if(m.items)E=m.items;else if(Array.isArray(m)){for(const _ of m)if(_&&typeof _=="object"&&"items"in _&&Array.isArray(_.items)){E=_.items;break}}if(!E||E.length===0)break;const S=E.map(_=>this.prepareTrack(_.item||_));if(S.length===0||f.length>0&&S[0].id===f[0].id)break;f=f.concat(S),y+=S.length}catch(l){console.error(`Error fetching playlist tracks at offset ${y}:`,l);break}}const g={playlist:c,tracks:f};return await this.cache.set("playlist",e,g),g}async getMix(e){const t=await this.cache.get("mix",e);if(t)return t;const r=await(await this.fetchWithRetry(`/mix/?id=${e}`,{type:"api",minVersion:"2.3"})).json(),i=r.mix,c=r.items||[];if(!i)throw new Error("Mix metadata not found");let h=c.map(y=>this.prepareTrack(y.item||y));h=await this.enrichTracksWithAlbumDates(h,10);const g={mix:{id:i.id,title:i.title,subTitle:i.subTitle,description:i.description,mixType:i.mixType,cover:i.images?.LARGE?.url||i.images?.MEDIUM?.url||i.images?.SMALL?.url||null},tracks:h};return await this.cache.set("mix",e,g),g}async getArtistSocials(e){const t=`artist_socials_${e}`,n=await this.cache.get("artist",t);if(n)return n;try{const r=`https://musicbrainz.org/ws/2/artist/?query=artist:${encodeURIComponent(e)}&fmt=json`,c=await(await fetch(r,{headers:{"User-Agent":"Monochrome/2.0.0 ( https://github.com/monochrome-music/monochrome )"}})).json();if(!c.artists||c.artists.length===0)return[];const g=`https://musicbrainz.org/ws/2/artist/${c.artists[0].id}?inc=url-rels&fmt=json`,u=await(await fetch(g,{headers:{"User-Agent":"Monochrome/2.0.0 ( https://github.com/monochrome-music/monochrome )"}})).json(),l=[];if(u.relations)for(const d of u.relations)["social network","streaming","official homepage","youtube","soundcloud","bandcamp"].includes(d.type)&&l.push({type:d.type,url:d.url.resource});return await this.cache.set("artist",t,l),l}catch(r){return console.warn("Failed to fetch artist socials:",r),[]}}async getArtist(e,t={}){const n=t.lightweight?`artist_${e}_light`:`artist_${e}`;if(!t.skipCache){const se=await this.cache.get("artist",n);if(se)return se}const[r,i]=await Promise.all([this.fetchWithRetry(`/artist/?id=${e}`),this.fetchWithRetry(`/artist/?f=${e}&skip_tracks=true`)]),c=await r.json();let h=c.data||c;const f=h.artist||(Array.isArray(h)?h[0]:h);if(!f)throw new Error("Primary artist details not found.");const g={...this.prepareArtist(f),picture:f.picture||h.cover||null,name:f.name||"Unknown Artist"},y=await i.json(),u=y.data||y,l=Array.isArray(u)?u:[u],d=new Map,m=new Map,E=se=>se?.id&&se.duration&&se.album,S=se=>se?.id&&"numberOfTracks"in se,_=(se,Te=new Set)=>{if(!se||typeof se!="object"||Te.has(se))return;if(Te.add(se),Array.isArray(se)){se.forEach(ze=>_(ze,Te));return}const Ae=se.item||se;S(Ae)&&d.set(Ae.id,this.prepareAlbum(Ae)),E(Ae)&&m.set(Ae.id,this.prepareTrack(Ae)),Object.values(se).forEach(ze=>_(ze,Te))};if(l.forEach(se=>_(se)),!t.lightweight)try{const se=await this.searchAlbums(g.name);if(se&&se.items){const Te=Number(e);for(const Ae of se.items)(Ae.artist?.id===Te||Array.isArray(Ae.artists)&&Ae.artists.some(we=>we.id===Te))&&!d.has(Ae.id)&&d.set(Ae.id,Ae)}}catch(se){console.warn("Failed to fetch additional albums via search:",se)}const M=Array.from(d.values()),R=this.deduplicateAlbums(M).sort((se,Te)=>new Date(Te.releaseDate||0)-new Date(se.releaseDate||0)),W=R.filter(se=>se.type==="EP"||se.type==="SINGLE"),fe=R.filter(se=>!W.includes(se)),ye=Array.from(m.values()).sort((se,Te)=>(Te.popularity||0)-(se.popularity||0)).slice(0,15),Y=t.lightweight?ye:await this.enrichTracksWithAlbumDates(ye),j={...g,albums:fe,eps:W,tracks:Y};return await this.cache.set("artist",n,j),j}async getSimilarArtists(e){const t=await this.cache.get("similar_artists",e);if(t)return t;try{const r=await(await this.fetchWithRetry(`/artist/similar/?id=${e}`,{type:"api",minVersion:"2.3"})).json(),c=(r.artists||r.items||r.data||(Array.isArray(r)?r:[])).map(h=>this.prepareArtist(h));return await this.cache.set("similar_artists",e,c),c}catch(n){return console.warn("Failed to fetch similar artists:",n),[]}}async getArtistBiography(e){const t=`artist_bio_v1_${e}`,n=await this.cache.get("artist",t);if(n)return n;try{const r=`https://api.tidal.com/v1/artists/${e}/bio?locale=en_US&countryCode=GB`,i=await fetch(r,{headers:{"X-Tidal-Token":Ip}});if(i.ok){const c=await i.json();if(c&&c.text){const h={text:c.text,source:c.source||"Tidal"};return await this.cache.set("artist",t,h),h}}}catch(r){console.warn("Failed to fetch Tidal biography:",r)}return null}async getSimilarAlbums(e){const t=await this.cache.get("similar_albums",e);if(t)return t;try{const r=await(await this.fetchWithRetry(`/album/similar/?id=${e}`,{type:"api",minVersion:"2.3"})).json(),c=(r.items||r.albums||r.data||(Array.isArray(r)?r:[])).map(h=>this.prepareAlbum(h));return await this.cache.set("similar_albums",e,c),c}catch(n){return console.warn("Failed to fetch similar albums:",n),[]}}async getRecommendedTracksForPlaylist(e,t=20,n={}){const r=new Map;for(const d of e)if(d.artist&&d.artist.id&&r.set(d.artist.id,d.artist),d.artists&&Array.isArray(d.artists))for(const m of d.artists)m.id&&r.set(m.id,m);if(r.size<3){console.log("Not enough artists from stored data, trying search approach...");for(const d of e.slice(0,5))try{const m=`"${d.title}" ${d.artist?.name||""}`.trim(),E=await this.searchTracks(m,{signal:AbortSignal.timeout(5e3)});if(E.items&&E.items.length>0){const S=E.items[0];if(S.artist&&S.artist.id&&r.set(S.artist.id,S.artist),S.artists&&Array.isArray(S.artists))for(const _ of S.artists)_.id&&r.set(_.id,_)}}catch(m){console.warn(`Search failed for track "${d.title}":`,m)}}const i=Array.from(r.values());if(console.log(`Found ${i.length} unique artists from ${e.length} tracks`),i.length===0)return console.log("No artists found, cannot generate recommendations"),[];const c=[],h=new Set(e.map(d=>d.id));let f=i;n.refresh&&(f=[...i].sort(()=>Math.random()-.5));const y=f.slice(0,Math.min(5,f.length)).map(async d=>{try{console.log(`Fetching tracks for artist: ${d.name} (ID: ${d.id})`);const m=await this.getArtist(d.id,{lightweight:!0,skipCache:n.refresh});if(m&&m.tracks&&m.tracks.length>0){const E=m.tracks.filter(_=>!h.has(_.id));return(n.refresh?E.sort(()=>Math.random()-.5):E).slice(0,4)}else return console.warn(`No tracks found for artist ${d.name}`),[]}catch(m){return console.warn(`Failed to get tracks for artist ${d.name}:`,m),[]}});return(await Promise.all(y)).forEach(d=>{d.length>0&&(c.push(...d),h.add(...d.map(m=>m.id)))}),c.sort(()=>.5-Math.random()).slice(0,t)}normalizeTrackResponse(e){if(!e||typeof e!="object")return e;const t=e.data??e;return[{duration:t.duration??0,id:t.trackId??null},t]}async getTrackMetadata(e){const t=`meta_${e}`,n=await this.cache.get("track",t);if(n)return n;const i=await(await this.fetchWithRetry(`/info/?id=${e}`,{type:"api"})).json(),c=i.data||i;let h;const g=(Array.isArray(c)?c:[c]).find(y=>y.id==e||y.item&&y.item.id==e);if(g)return h=this.prepareTrack(g.item||g),await this.cache.set("track",t,h),h;throw new Error("Track metadata not found")}async getTrackRecommendations(e){const t=await this.cache.get("recommendations",e);if(t)return t;try{const r=await(await this.fetchWithRetry(`/recommendations/?id=${e}`,{type:"api",minVersion:"2.4"})).json(),h=((r.data||r).items||[]).map(f=>this.prepareTrack(f.track||f));return await this.cache.set("recommendations",e,h),h}catch(n){return console.error("Failed to fetch recommendations:",n),[]}}async getTrack(e,t="HI_RES_LOSSLESS"){const n=`${e}_${t}`,r=await this.cache.get("track",n);if(r)return r;const c=await(await this.fetchWithRetry(`/track/?id=${e}&quality=${t}`,{type:"streaming"})).json(),h=this.parseTrackLookup(this.normalizeTrackResponse(c));return await this.cache.set("track",n,h),h}async getStreamUrl(e,t="HI_RES_LOSSLESS"){const n=`stream_${e}_${t}`;if(this.streamCache.has(n))return this.streamCache.get(n);const r=await this.getTrack(e,t);let i;if(r.originalTrackUrl)i=r.originalTrackUrl;else if(i=this.extractStreamUrlFromManifest(r.info.manifest),!i)throw new Error("Could not resolve stream URL");return this.streamCache.set(n,i),i}async downloadTrack(e,t="HI_RES_LOSSLESS",n,r={}){const{onProgress:i,track:c}=r;try{const h=t==="MP3_320"?"LOSSLESS":t,f=await this.getTrack(e,h);let g,y;if(f.originalTrackUrl)g=f.originalTrackUrl;else if(g=this.extractStreamUrlFromManifest(f.info.manifest),!g)throw new Error("Could not resolve stream URL");if(g.startsWith("blob:"))try{y=await new ef().downloadDashStream(g,{signal:r.signal,onProgress:r.onProgress})}catch(m){if(console.error("DASH download failed:",m),h!=="LOSSLESS")return console.warn("Falling back to LOSSLESS (16-bit) download."),this.downloadTrack(e,"LOSSLESS",n,r);throw m}else{const m=await fetch(g,{cache:"no-store",signal:r.signal});if(!m.ok)throw new Error(`Fetch failed: ${m.status}`);const E=m.headers.get("Content-Length"),S=E?parseInt(E,10):0;let _=0;if(m.body&&i){const M=m.body.getReader(),R=[];for(;;){const{done:W,value:fe}=await M.read();if(W)break;fe&&(R.push(fe),_+=fe.byteLength,i({stage:"downloading",receivedBytes:_,totalBytes:S||void 0}))}y=new Blob(R,{type:m.headers.get("Content-Type")||"audio/flac"})}else y=await m.blob(),i&&i({stage:"downloading",receivedBytes:y.size,totalBytes:y.size})}if(t==="MP3_320")try{y=await tf(y,i,r.signal)}catch(m){throw i&&i({stage:"error",message:`Encoding failed: ${m.message}`}),m}c&&(i&&i({stage:"processing",message:"Adding metadata..."}),y=await ul(y,c,this,t));const u=await Vd(y);let l=n;const d=n.split(".").pop()?.toLowerCase();d&&d!==u&&(l=n.replace(/\.[^.]+$/,`.${u}`)),this.triggerDownload(y,l)}catch(h){throw h.name==="AbortError"||(console.error("Download failed:",h),h instanceof Wo||h.code==="MP3_ENCODING_FAILED")||h.message===Hd?h:new Error("Download failed. The stream may require a proxy.")}}triggerDownload(e,t){const n=URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}getCoverUrl(e,t="320"){return e?typeof e=="string"&&(e.startsWith("http")||e.startsWith("blob:")||e.startsWith("assets/"))?e:`https://resources.tidal.com/images/${e.replace(/-/g,"/")}/${t}x${t}.jpg`:`https://picsum.photos/seed/${Math.random()}/${t}`}getVideoCoverUrl(e,t="1280"){if(!e)return null;const n=e.split("-");return n.length!==5?null:`https://resources.tidal.com/videos/${n[0]}/${n[1]}/${n[2]}/${n[3]}/${n[4]}/${t}x${t}.mp4`}getArtistPictureUrl(e,t="320"){return e?typeof e=="string"&&(e.startsWith("blob:")||e.startsWith("assets/"))?e:`https://resources.tidal.com/images/${e.replace(/-/g,"/")}/${t}x${t}.jpg`:`https://picsum.photos/seed/${Math.random()}/${t}`}async clearCache(){await this.cache.clear(),this.streamCache.clear()}getCacheStats(){return{...this.cache.getCacheStats(),streamUrls:this.streamCache.size}}}const xp="https://qobuz.squid.wtf/api";class Cp{constructor(){this.baseUrl=xp}async fetchWithRetry(e,t={}){const n=`${this.baseUrl}${e}`;try{const r=await fetch(n,{signal:t.signal});if(!r.ok)throw new Error(`Request failed with status ${r.status}`);return await r.json()}catch(r){throw r.name==="AbortError"||console.error("Qobuz API request failed:",r),r}}async searchTracks(e,t={}){try{const n=t.offset||0,r=t.limit||10,i=await this.fetchWithRetry(`/get-music?q=${encodeURIComponent(e)}&offset=${n}&limit=${r}`);if(!i.success||!i.data)return{items:[],limit:0,offset:0,totalNumberOfItems:0};const c=(i.data.tracks?.items||[]).map(h=>this.transformTrack(h));return{items:c,limit:i.data.tracks?.limit||c.length,offset:i.data.tracks?.offset||0,totalNumberOfItems:i.data.tracks?.total||c.length}}catch(n){if(n.name==="AbortError")throw n;return console.error("Qobuz track search failed:",n),{items:[],limit:0,offset:0,totalNumberOfItems:0}}}async searchAlbums(e,t={}){try{const n=t.offset||0,r=t.limit||10,i=await this.fetchWithRetry(`/get-music?q=${encodeURIComponent(e)}&offset=${n}&limit=${r}`);if(!i.success||!i.data)return{items:[],limit:0,offset:0,totalNumberOfItems:0};const c=(i.data.albums?.items||[]).map(h=>this.transformAlbum(h));return{items:c,limit:i.data.albums?.limit||c.length,offset:i.data.albums?.offset||0,totalNumberOfItems:i.data.albums?.total||c.length}}catch(n){if(n.name==="AbortError")throw n;return console.error("Qobuz album search failed:",n),{items:[],limit:0,offset:0,totalNumberOfItems:0}}}async searchArtists(e,t={}){try{const n=t.offset||0,r=t.limit||10,i=await this.fetchWithRetry(`/get-music?q=${encodeURIComponent(e)}&offset=${n}&limit=${r}`);if(!i.success||!i.data)return{items:[],limit:0,offset:0,totalNumberOfItems:0};const c=(i.data.artists?.items||[]).map(h=>this.transformArtist(h));return{items:c,limit:i.data.artists?.limit||c.length,offset:i.data.artists?.offset||0,totalNumberOfItems:i.data.artists?.total||c.length}}catch(n){if(n.name==="AbortError")throw n;return console.error("Qobuz artist search failed:",n),{items:[],limit:0,offset:0,totalNumberOfItems:0}}}async getTrack(e){throw new Error("Qobuz getTrack not implemented - use getStreamUrl for playback")}async getAlbum(e){try{const t=await this.fetchWithRetry(`/get-album?album_id=${encodeURIComponent(e)}`);if(!t.success||!t.data)throw new Error("Album not found");const n=this.transformAlbum(t.data),r=(t.data.tracks?.items||[]).map(i=>this.transformTrack(i,t.data));return{album:n,tracks:r}}catch(t){throw console.error("Qobuz getAlbum failed:",t),t}}async getArtist(e){try{const t=await this.fetchWithRetry(`/get-artist?artist_id=${encodeURIComponent(e)}`);if(!t.success||!t.data)throw new Error("Artist not found");const n=t.data.artist||t.data;if(!n)throw new Error("Artist info not found in response");const r=this.transformArtist(n);let i=[],c=[];if(Array.isArray(t.data.releases)){const f=t.data.releases.find(y=>y.type==="album");f?.items&&(i=f.items.map(y=>this.transformAlbum(y)));const g=t.data.releases.find(y=>y.type==="epSingle");g?.items&&(c=g.items.map(y=>this.transformAlbum(y)))}let h=[];return Array.isArray(t.data.top_tracks)&&(h=t.data.top_tracks.map(f=>this.transformTrack(f))),{...r,albums:i,eps:c,tracks:h}}catch(t){throw console.error("Qobuz getArtist failed:",t),t}}transformTrack(e,t=null){const n=e.performer||e.artist,r=e.artists||(n?[n]:[]);return{id:`q:${e.id}`,title:e.title,duration:e.duration,artist:n?this.transformArtist(n):null,artists:r.map(i=>this.transformArtist(i)),album:t?this.transformAlbum(t):e.album?this.transformAlbum(e.album):null,audioQuality:this.mapQuality(e.streaming_quality),explicit:e.parental_warning||!1,trackNumber:e.track_number,volumeNumber:e.media_number||1,isrc:e.isrc,provider:"qobuz",originalId:e.id}}transformAlbum(e){const t=e.artist||e.artists?.[0];return{id:`q:${e.id}`,title:e.title,artist:t?this.transformArtist(t):null,artists:e.artists?e.artists.map(n=>this.transformArtist(n)):t?[this.transformArtist(t)]:[],numberOfTracks:e.tracks_count||0,releaseDate:e.release_date_original||e.release_date,cover:e.image?.large||e.image?.medium||e.image?.small,explicit:e.parental_warning||!1,type:e.album_type==="ep"?"EP":e.album_type==="single"?"SINGLE":"ALBUM",provider:"qobuz",originalId:e.id}}transformArtist(e){if(!e)return{id:"q:unknown",name:"Unknown Artist",picture:null,provider:"qobuz",originalId:null};const t=typeof e.name=="string"?e.name:e.name?.display||"Unknown Artist",n=e.image?.large||e.image?.medium||e.image?.small||e.picture||(e.images?.portrait?`https://static.qobuz.com/images/artists/covers/large/${e.images.portrait.hash}.${e.images.portrait.format}`:null);return{id:`q:${e.id}`,name:t,picture:n,provider:"qobuz",originalId:e.id}}mapQuality(e){return{MP3:"HIGH",FLAC:"LOSSLESS",HiRes:"HI_RES_LOSSLESS"}[e]||"LOSSLESS"}getCoverUrl(e,t="320"){return e?(typeof e=="string"&&e.startsWith("http"),e):`https://picsum.photos/seed/${Math.random()}/${t}`}getArtistPictureUrl(e,t="320"){return e?(typeof e=="string"&&e.startsWith("http"),e):`https://picsum.photos/seed/${Math.random()}/${t}`}async getStreamUrl(e,t="27"){try{const n=e.replace(/^q:/,""),i={LOW:"27",HIGH:"27",LOSSLESS:"7",HI_RES:"6",HI_RES_LOSSLESS:"5"}[t]||t||"27",c=await this.fetchWithRetry(`/download-music?track_id=${encodeURIComponent(n)}&quality=${i}`);if(!c.success||!c.data?.url)throw new Error("Stream URL not available");return c.data.url}catch(n){throw console.error("Qobuz getStreamUrl failed:",n),n}}async getSimilarArtists(e){return[]}async getSimilarAlbums(e){return[]}async search(e,t={}){const n=t.offset||0,r=t.limit||10;try{const i=await this.fetchWithRetry(`/get-music?q=${encodeURIComponent(e)}&offset=${n}&limit=${r}`);if(!i.success||!i.data)return{tracks:{items:[],limit:0,offset:0,totalNumberOfItems:0},albums:{items:[],limit:0,offset:0,totalNumberOfItems:0},artists:{items:[],limit:0,offset:0,totalNumberOfItems:0}};const c=(i.data.tracks?.items||[]).map(g=>this.transformTrack(g)),h=(i.data.albums?.items||[]).map(g=>this.transformAlbum(g)),f=(i.data.artists?.items||[]).map(g=>this.transformArtist(g));return{tracks:{items:c,limit:i.data.tracks?.limit||c.length,offset:i.data.tracks?.offset||0,totalNumberOfItems:i.data.tracks?.total||c.length},albums:{items:h,limit:i.data.albums?.limit||h.length,offset:i.data.albums?.offset||0,totalNumberOfItems:i.data.albums?.total||h.length},artists:{items:f,limit:i.data.artists?.limit||f.length,offset:i.data.artists?.offset||0,totalNumberOfItems:i.data.artists?.total||f.length}}}catch(i){if(i.name==="AbortError")throw i;return console.error("Qobuz search failed:",i),{tracks:{items:[],limit:0,offset:0,totalNumberOfItems:0},albums:{items:[],limit:0,offset:0,totalNumberOfItems:0},artists:{items:[],limit:0,offset:0,totalNumberOfItems:0}}}}getNextPage(e,t,n){const r=e+t;return r<n?r:null}getPreviousPage(e,t){const n=e-t;return n>=0?n:null}}class nf{constructor(e){this.tidalAPI=new Rp(e),this.qobuzAPI=new Cp,this._settings=e}getCurrentProvider(){return jd.getProvider()}getAPI(e=null){return(e||this.getCurrentProvider())==="qobuz"?this.qobuzAPI:this.tidalAPI}async searchTracks(e,t={}){const n=t.provider||this.getCurrentProvider();return this.getAPI(n).searchTracks(e,t)}async searchArtists(e,t={}){const n=t.provider||this.getCurrentProvider();return this.getAPI(n).searchArtists(e,t)}async searchAlbums(e,t={}){const n=t.provider||this.getCurrentProvider();return this.getAPI(n).searchAlbums(e,t)}async searchPlaylists(e,t={}){return(t.provider||this.getCurrentProvider())==="qobuz"?{items:[],limit:0,offset:0,totalNumberOfItems:0}:this.tidalAPI.searchPlaylists(e,t)}async getTrack(e,t,n=null){const r=n||this.getProviderFromId(e)||this.getCurrentProvider(),i=this.getAPI(r),c=this.stripProviderPrefix(e);return i.getTrack(c,t)}async getTrackMetadata(e,t=null){const n=t||this.getProviderFromId(e)||this.getCurrentProvider(),r=this.getAPI(n),i=this.stripProviderPrefix(e);return r.getTrackMetadata(i)}async getAlbum(e,t=null){const n=t||this.getProviderFromId(e)||this.getCurrentProvider(),r=this.getAPI(n),i=this.stripProviderPrefix(e);return r.getAlbum(i)}async getArtist(e,t=null){const n=t||this.getProviderFromId(e)||this.getCurrentProvider(),r=this.getAPI(n),i=this.stripProviderPrefix(e);return r.getArtist(i)}async getArtistBiography(e,t=null){const n=t||this.getProviderFromId(e)||this.getCurrentProvider();if(n!=="tidal")return null;const r=this.getAPI(n),i=this.stripProviderPrefix(e);return typeof r.getArtistBiography=="function"?r.getArtistBiography(i):null}async getArtistSocials(e){return this.tidalAPI.getArtistSocials(e)}async getPlaylist(e,t=null){return this.tidalAPI.getPlaylist(e)}async getMix(e,t=null){return this.tidalAPI.getMix(e)}async getTrackRecommendations(e){const t=this.getProviderFromId(e)||this.getCurrentProvider(),n=this.getAPI(t),r=this.stripProviderPrefix(e);return typeof n.getTrackRecommendations=="function"?n.getTrackRecommendations(r):[]}async getStreamUrl(e,t,n=null){const r=n||this.getProviderFromId(e)||this.getCurrentProvider(),i=this.getAPI(r),c=this.stripProviderPrefix(e);return i.getStreamUrl(c,t)}getCoverUrl(e,t="320"){return typeof e=="string"&&e.startsWith("blob:")?e:typeof e=="string"&&e.startsWith("q:")?this.qobuzAPI.getCoverUrl(e.slice(2),t):this.tidalAPI.getCoverUrl(e,t)}getVideoCoverUrl(e,t,n="1280"){if(e){const r=this.tidalAPI.getVideoCoverUrl(e,n);if(r)return r}return this.getCoverUrl(t,n)}getArtistPictureUrl(e,t="320"){return typeof e=="string"&&e.startsWith("q:")?this.qobuzAPI.getArtistPictureUrl(e.slice(2),t):this.tidalAPI.getArtistPictureUrl(e,t)}extractStreamUrlFromManifest(e){return this.tidalAPI.extractStreamUrlFromManifest(e)}getProviderFromId(e){if(typeof e=="string"){if(e.startsWith("q:"))return"qobuz";if(e.startsWith("t:"))return"tidal"}return null}stripProviderPrefix(e){return typeof e=="string"&&(e.startsWith("q:")||e.startsWith("t:"))?e.slice(2):e}async downloadTrack(e,t,n,r={}){const i=this.getProviderFromId(e)||this.getCurrentProvider(),c=this.getAPI(i),h=this.stripProviderPrefix(e);return c.downloadTrack(h,t,n,r)}async getSimilarArtists(e){const t=this.getProviderFromId(e)||this.getCurrentProvider(),n=this.getAPI(t),r=this.stripProviderPrefix(e);return n.getSimilarArtists(r)}async getSimilarAlbums(e){const t=this.getProviderFromId(e)||this.getCurrentProvider(),n=this.getAPI(t),r=this.stripProviderPrefix(e);return n.getSimilarAlbums(r)}async getRecommendedTracksForPlaylist(e,t=20,n={}){return this.tidalAPI.getRecommendedTracksForPlaylist(e,t,n)}async clearCache(){await this.tidalAPI.clearCache()}getCacheStats(){return this.tidalAPI.getCacheStats()}get settings(){return this._settings}}function Us(o,e,t=!0,n=null,r="flac"){let i=`#EXTM3U
`;o.title&&(i+=`#PLAYLIST:${Gn(o.title)}
`),o.artist&&(i+=`#ARTIST:${o.artist}
`);const c=new Date().toISOString().split("T")[0];return i+=`#DATE:${c}

`,e.forEach((h,f)=>{const g=Math.round(h.duration||0),y=ti(h),u=h.title||"Unknown Title",l=`${y} - ${u}`;i+=`#EXTINF:${g},${l}
`;const d=af(h,f+1,r),m=typeof n=="function"?n(h,d,f):d;i+=`${m}

`}),i}function Bs(o,e,t=!0,n=null,r="flac"){let i=`#EXTM3U
`;i+=`#EXT-X-VERSION:3
`,i+=`#EXT-X-PLAYLIST-TYPE:VOD
`;const c=Math.max(...e.map(f=>Math.round(f.duration||0)));i+=`#EXT-X-TARGETDURATION:${c}
`,o.title&&(i+=`#PLAYLIST:${Gn(o.title)}
`),o.artist&&(i+=`#ARTIST:${o.artist}
`);const h=new Date().toISOString().split("T")[0];return i+=`#DATE:${h}

`,e.forEach((f,g)=>{const y=Math.round(f.duration||0),u=ti(f),l=f.title||"Unknown Title",d=`${u} - ${l}`;i+=`#EXTINF:${y}.000,${d}
`;const m=af(f,g+1,r),E=typeof n=="function"?n(f,m,g):m;i+=`${E}

`}),i+=`#EXT-X-ENDLIST
`,i}function Fs(o,e,t){const n=o.artist?.name||o.artist||"Unknown Artist",r=o.title||"Unknown Album";let i=`PERFORMER "${n}"
`;i+=`TITLE "${r}"
`;const c=t.split(".").pop().toUpperCase();i+=`FILE "${t}" ${c}
`;let h=0;return e.forEach((f,g)=>{const y=String(f.trackNumber||g+1).padStart(2,"0"),u=f.title||"Unknown Track",l=f.artist?.name||ti(f)||n,d=f.duration||0;i+=`  TRACK ${y} AUDIO
`,i+=`    TITLE "${u}"
`,i+=`    PERFORMER "${l}"
`;const m=Math.floor(h/60),E=Math.floor(h%60),S=Math.floor(h%1*75);i+=`    INDEX 01 ${String(m).padStart(2,"0")}:${String(E).padStart(2,"0")}:${String(S).padStart(2,"0")}
`,h+=d}),i}function qs(o,e,t="playlist"){const n=new Date().toISOString();let r=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
`;return t==="album"?(r+=`<album>
`,r+=`  <title>${pr(o.title||"Unknown Album")}</title>
`,r+=`  <artist>${pr(o.artist?.name||o.artist||"Unknown Artist")}</artist>
`,o.releaseDate&&(r+=`  <year>${new Date(o.releaseDate).getFullYear()}</year>
`),r+=`  <musicbrainzalbumid>${o.id||""}</musicbrainzalbumid>
`,r+=`  <dateadded>${n}</dateadded>
`,e.forEach((i,c)=>{r+=`  <track>
`,r+=`    <position>${c+1}</position>
`,r+=`    <title>${pr(i.title||"")}</title>
`,r+=`    <artist>${pr(ti(i)||"")}</artist>
`,r+=`    <duration>${Math.round(i.duration||0)}</duration>
`,i.trackNumber&&(r+=`    <track>${i.trackNumber}</track>
`),r+=`    <musicbrainztrackid>${i.id||""}</musicbrainztrackid>
`,r+=`  </track>
`}),r+=`</album>
`):(r+=`<musicplaylist>
`,r+=`  <title>${pr(o.title||"Unknown Playlist")}</title>
`,r+=`  <artist>${pr(o.artist||"Various Artists")}</artist>
`,r+=`  <dateadded>${n}</dateadded>
`,e.forEach((i,c)=>{r+=`  <track>
`,r+=`    <position>${c+1}</position>
`,r+=`    <title>${pr(i.title||"")}</title>
`,r+=`    <artist>${pr(ti(i)||"")}</artist>
`,r+=`    <album>${pr(i.album?.title||"")}</album>
`,r+=`    <duration>${Math.round(i.duration||0)}</duration>
`,r+=`    <musicbrainztrackid>${i.id||""}</musicbrainztrackid>
`,r+=`  </track>
`}),r+=`</musicplaylist>
`),r}function js(o,e,t="playlist"){const n={format:"monochrome-playlist",version:"1.0",type:t,generated:new Date().toISOString(),playlist:{title:o.title||"Unknown",artist:o.artist||"Various Artists",id:o.id||o.uuid||null},tracks:e.map((r,i)=>({position:i+1,id:r.id||null,title:r.title||"Unknown Title",artist:ti(r)||"Unknown Artist",album:r.album?.title||null,albumArtist:r.album?.artist?.name||null,trackNumber:r.trackNumber||null,duration:Math.round(r.duration||0),isrc:r.isrc||null,releaseDate:r.album?.releaseDate||null}))};return t==="album"&&(n.playlist.releaseDate=o.releaseDate||null,n.playlist.numberOfTracks=e.length,n.playlist.cover=o.cover||null),JSON.stringify(n,null,2)}function ti(o){return o.artists&&o.artists.length>0?o.artists.map(e=>e.name).join(", "):o.artist?.name||"Unknown Artist"}function af(o,e=1,t="flac"){const n=String(e).padStart(2,"0"),r=ti(o),i=o.title||"Unknown Title",c=Gn(r),h=Gn(i);return`${n} - ${c} - ${h}.${t}`}function pr(o){return o?o.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):""}const ji=new Map,Ur=new Map,No=new Set;let Na=null;async function Hi(){try{return await ta(()=>import("https://cdn.jsdelivr.net/npm/client-zip@2.4.5/+esm"),[],import.meta.url)}catch(o){throw console.error("Failed to load client-zip:",o),new Error("Failed to load ZIP library")}}function Lp(o){const e=parseInt(o,10);return Number.isFinite(e)&&e>0?e:null}function sd(o){const e=[o?.volumeNumber,o?.discNumber,o?.mediaNumber,o?.media_number,o?.volume,o?.disc,o?.volume?.number,o?.disc?.number,o?.media?.number,o?.disc,o?.disc_no,o?.discNo,o?.disc_number,o?.mediaMetadata?.discNumber];for(const t of e){const n=Lp(t);if(n)return n}return null}async function Hs(o,e){if(!na.shouldSeparateDiscsInZip())return{separateByDisc:!1,resolveDiscNumber:()=>1};const t=o.map(c=>sd(c));if(new Set(t.filter(Boolean)).size>1)return{separateByDisc:!0,resolveDiscNumber:c=>t[c]||1};const r=await Promise.all(o.map(async(c,h)=>{if(t[h])return t[h];try{const f=await e.getTrackMetadata(c.id);return sd(f)}catch{return null}}));return new Set(r.filter(Boolean)).size>1?{separateByDisc:!0,resolveDiscNumber:c=>r[c]||t[c]||1}:{separateByDisc:!1,resolveDiscNumber:()=>1}}function $i(o){return`Disc ${o}`}function Br(o,e,t,n=1){return t?`${o}/${$i(n)}/${e}`:`${o}/${e}`}function Gs(o){return o==="LOW"||o==="HIGH"?"m4a":"flac"}function dl(){return Na||(Na=document.createElement("div"),Na.id="download-notifications",document.body.appendChild(Na)),Na}function Dn(o){const e=dl(),t=document.createElement("div");t.className="download-task";const n=document.createElement("div");n.style.display="flex",n.style.alignItems="start",n.textContent=o,t.appendChild(n),e.appendChild(t),setTimeout(()=>{t.style.animation="slide-out 0.3s ease forwards",setTimeout(()=>t.remove(),300)},1500)}function rf(o,e,t,n,r){const i=dl(),c=document.createElement("div");c.className="download-task",c.dataset.trackId=o;const h=Ca(e),f=wa(e);return c.innerHTML=`
        <div style="display: flex; align-items: start; gap: 0.75rem;">
            <img src="${n.getCoverUrl(e.album?.cover)}"
                 style="width: 40px; height: 40px; border-radius: 4px; flex-shrink: 0;">
            <div style="flex: 1; min-width: 0;">
                <div style="font-weight: 500; font-size: 0.9rem; margin-bottom: 0.25rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${h}</div>
                <div style="font-size: 0.8rem; color: var(--muted-foreground); margin-bottom: 0.5rem;">${f}</div>
                <div class="download-progress-bar" style="height: 4px; background: var(--secondary); border-radius: 2px; overflow: hidden;">
                    <div class="download-progress-fill" style="width: 0%; height: 100%; background: var(--highlight); transition: width 0.2s;"></div>
                </div>
                <div class="download-status" style="font-size: 0.75rem; color: var(--muted-foreground); margin-top: 0.25rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Starting...</div>
            </div>
            <button class="download-cancel" style="background: transparent; border: none; color: var(--muted-foreground); cursor: pointer; padding: 4px; border-radius: 4px; transition: all 0.2s;">
                ${Os}
            </button>
        </div>
    `,i.appendChild(c),ji.set(o,{taskEl:c,abortController:r}),c.querySelector(".download-cancel").addEventListener("click",()=>{r.abort(),Ss(o)}),{taskEl:c,abortController:r}}function sf(o,e){const t=ji.get(o);if(!t)return;const{taskEl:n}=t,r=n.querySelector(".download-progress-fill"),i=n.querySelector(".download-status");if(e.stage==="downloading"){const c=e.totalBytes?Math.round(e.receivedBytes/e.totalBytes*100):0;r.style.width=`${c}%`;const h=(e.receivedBytes/(1024*1024)).toFixed(1),f=e.totalBytes?(e.totalBytes/(1024*1024)).toFixed(1):"?";i.textContent=`Downloading: ${h}MB / ${f}MB (${c}%)`}}function Qo(o,e=!0,t=null){const n=ji.get(o);if(!n)return;const{taskEl:r}=n,i=r.querySelector(".download-progress-fill"),c=r.querySelector(".download-status"),h=r.querySelector(".download-cancel");e?(i.style.width="100%",i.style.background="#10b981",c.textContent="âœ“ Downloaded",c.style.color="#10b981",h.remove(),setTimeout(()=>Ss(o),3e3)):(i.style.background="#ef4444",c.textContent=t||"âœ— Download failed",c.style.color="#ef4444",h.innerHTML=`
            ${Os}
        `,h.onclick=()=>Ss(o),setTimeout(()=>Ss(o),5e3))}function Ss(o){const e=ji.get(o);if(!e)return;const{taskEl:t}=e;t.style.animation="slide-out 0.3s ease forwards",setTimeout(()=>{t.remove(),ji.delete(o),Na&&Na.children.length===0&&(Na.remove(),Na=null)},300)}function Ys(o){Ur.get(o)&&(o.style.animation="slide-out 0.3s ease forwards",setTimeout(()=>{o.remove(),Ur.delete(o),Na&&Na.children.length===0&&(Na.remove(),Na=null)},300))}async function Ei(o,e,t,n=null,r=null){let i={...o,artist:o.artist||(o.artists&&o.artists.length>0?o.artists[0]:null)};const c=e==="MP3_320"?"LOSSLESS":e;try{const u=await t.getTrackMetadata(o.id);u&&(i={...u,...i,artist:i.artist||u.artist,album:{...u.album||{},...i.album||{}},discNumber:i.discNumber??u.discNumber,volumeNumber:i.volumeNumber??u.volumeNumber})}catch{}if(i.album&&(!i.album.title||!i.album.artist)&&i.album.id)try{const u=await t.getAlbum(i.album.id);u.album&&(i.album={...i.album,...u.album})}catch(u){console.warn("Failed to fetch album data for metadata:",u)}const h=await t.getTrack(o.id,c);let f;if(h.originalTrackUrl)f=h.originalTrackUrl;else if(f=t.extractStreamUrlFromManifest(h.info.manifest),!f)throw new Error("Could not resolve stream URL");let g;if(f.startsWith("blob:"))try{g=await new ef().downloadDashStream(f,{signal:r})}catch(u){if(console.error("DASH download failed:",u),c!=="LOSSLESS")return console.warn("Falling back to LOSSLESS (16-bit) download."),Ei(o,"LOSSLESS",t,n,r);throw u}else{const u=await fetch(f,{signal:r});if(!u.ok)throw new Error(`Failed to fetch track: ${u.status}`);g=await u.blob()}e==="MP3_320"&&(g=await tf(g,()=>{},r));const y=await Vd(g);return g=await ul(g,i,t),{blob:g,extension:y}}function Ms(o,e){const t=URL.createObjectURL(o),n=document.createElement("a");n.href=t,n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)}async function of(o,e,t,n,r){const{abortController:i}=Ur.get(r),c=i.signal;for(let h=0;h<o.length&&!c.aborted;h++){const f=o[h],g=Ca(f);yi(r,h,o.length,g);try{const{blob:y,extension:u}=await Ei(f,t,e,null,c),l=ai(f,t,u);if(Ms(y,l),n&&ni.shouldDownloadLyrics())try{const d=await n.fetchLyrics(f.id,f);if(d){const m=n.generateLRCContent(d,f);if(m){const E=l.replace(/\.[^.]+$/,".lrc"),S=new Blob([m],{type:"text/plain"});Ms(S,E)}}}catch{}}catch(y){if(y.name==="AbortError")throw y;console.error(`Failed to download track ${g}:`,y)}}}async function Pp(o,e,t,n,r,i,c,h=null,f="playlist",g=null){const{abortController:y}=Ur.get(i),u=y.signal,{downloadZip:l}=await Hi(),d=await c.createWritable();async function*m(){h&&(yield{name:`${e}/cover.jpg`,lastModified:new Date,input:h});const E=na.shouldUseRelativePaths(),S=Gs(n),_=await Hs(o,t),M=_.separateByDisc,R=M?(W,fe,ye)=>`${$i(_.resolveDiscNumber(ye))}/${fe}`:null;if(na.shouldGenerateM3U()){const W=Us(g||{title:e},o,E,R,S);yield{name:`${e}/${Gn(e)}.m3u`,lastModified:new Date,input:W}}if(na.shouldGenerateM3U8()){const W=Bs(g||{title:e},o,E,R,S);yield{name:`${e}/${Gn(e)}.m3u8`,lastModified:new Date,input:W}}if(na.shouldGenerateNFO()){const W=qs(g||{title:e},o,f);yield{name:`${e}/${Gn(e)}.nfo`,lastModified:new Date,input:W}}if(na.shouldGenerateJSON()){const W=js(g||{title:e},o,f);yield{name:`${e}/${Gn(e)}.json`,lastModified:new Date,input:W}}if(f==="album"&&na.shouldGenerateCUE()){const W=`${Gn(e)}.flac`,fe=Fs(g,o,W);yield{name:`${e}/${Gn(e)}.cue`,lastModified:new Date,input:fe}}for(let W=0;W<o.length&&!u.aborted;W++){const fe=o[W],ye=Ca(fe);yi(i,W,o.length,ye);try{const{blob:Y,extension:j}=await Ei(fe,n,t,null,u),se=ai(fe,n,j),Te=_.resolveDiscNumber(W);if(yield{name:Br(e,se,M,Te),lastModified:new Date,input:Y},r&&ni.shouldDownloadLyrics())try{const Ae=await r.fetchLyrics(fe.id,fe);if(Ae){const ze=r.generateLRCContent(Ae,fe);if(ze){const de=se.replace(/\.[^.]+$/,".lrc");yield{name:Br(e,de,M,Te),lastModified:new Date,input:ze}}}}catch{}}catch(Y){if(Y.name==="AbortError")throw Y;console.error(`Failed to download track ${ye}:`,Y)}}}try{await l(m()).body.pipeTo(d)}catch(E){if(E.name==="AbortError")return;throw E}}async function Np(o,e,t,n,r,i,c=null,h="playlist",f=null){const{abortController:g}=Ur.get(i),y=g.signal,{downloadZip:u}=await Hi();async function*l(){c&&(yield{name:`${e}/cover.jpg`,lastModified:new Date,input:c});const d=na.shouldUseRelativePaths(),m=Gs(n),E=await Hs(o,t),S=E.separateByDisc,_=S?(M,R,W)=>`${$i(E.resolveDiscNumber(W))}/${R}`:null;if(na.shouldGenerateM3U()){const M=Us(f||{title:e},o,d,_,m);yield{name:`${e}/${Gn(e)}.m3u`,lastModified:new Date,input:M}}if(na.shouldGenerateM3U8()){const M=Bs(f||{title:e},o,d,_,m);yield{name:`${e}/${Gn(e)}.m3u8`,lastModified:new Date,input:M}}if(na.shouldGenerateNFO()){const M=qs(f||{title:e},o,h);yield{name:`${e}/${Gn(e)}.nfo`,lastModified:new Date,input:M}}if(na.shouldGenerateJSON()){const M=js(f||{title:e},o,h);yield{name:`${e}/${Gn(e)}.json`,lastModified:new Date,input:M}}if(h==="album"&&na.shouldGenerateCUE()){const M=`${Gn(e)}.flac`,R=Fs(f,o,M);yield{name:`${e}/${Gn(e)}.cue`,lastModified:new Date,input:R}}for(let M=0;M<o.length&&!y.aborted;M++){const R=o[M],W=Ca(R);yi(i,M,o.length,W);try{const{blob:fe,extension:ye}=await Ei(R,n,t,null,y),Y=ai(R,n,ye),j=E.resolveDiscNumber(M);if(yield{name:Br(e,Y,S,j),lastModified:new Date,input:fe},r&&ni.shouldDownloadLyrics())try{const se=await r.fetchLyrics(R.id,R);if(se){const Te=r.generateLRCContent(se,R);if(Te){const Ae=Y.replace(/\.[^.]+$/,".lrc");yield{name:Br(e,Ae,S,j),lastModified:new Date,input:Te}}}}catch{}}catch(fe){if(fe.name==="AbortError")throw fe;console.error(`Failed to download track ${W}:`,fe)}}}try{const m=await u(l()).blob();Ms(m,`${e}.zip`)}catch(d){if(d.name==="AbortError")return;throw d}}async function Mp(o,e,t,n,r,i,c=null,h="playlist",f=null){const{abortController:g}=Ur.get(i),y=g.signal,{downloadZip:u}=await Hi();async function*l(){c&&(yield{name:`${e}/cover.jpg`,lastModified:new Date,input:c});const d=na.shouldUseRelativePaths(),m=Gs(n),E=await Hs(o,t),S=E.separateByDisc,_=S?(M,R,W)=>`${$i(E.resolveDiscNumber(W))}/${R}`:null;if(na.shouldGenerateM3U()){const M=Us(f||{title:e},o,d,_,m);yield{name:`${e}/${Gn(e)}.m3u`,lastModified:new Date,input:M}}if(na.shouldGenerateM3U8()){const M=Bs(f||{title:e},o,d,_,m);yield{name:`${e}/${Gn(e)}.m3u8`,lastModified:new Date,input:M}}if(na.shouldGenerateNFO()){const M=qs(f||{title:e},o,h);yield{name:`${e}/${Gn(e)}.nfo`,lastModified:new Date,input:M}}if(na.shouldGenerateJSON()){const M=js(f||{title:e},o,h);yield{name:`${e}/${Gn(e)}.json`,lastModified:new Date,input:M}}if(h==="album"&&na.shouldGenerateCUE()){const M=`${Gn(e)}.flac`,R=Fs(f,o,M);yield{name:`${e}/${Gn(e)}.cue`,lastModified:new Date,input:R}}for(let M=0;M<o.length&&!y.aborted;M++){const R=o[M],W=Ca(R);yi(i,M,o.length,W);try{const{blob:fe,extension:ye}=await Ei(R,n,t,null,y),Y=ai(R,n,ye),j=E.resolveDiscNumber(M);if(yield{name:Br(e,Y,S,j),lastModified:new Date,input:fe},r&&ni.shouldDownloadLyrics())try{const se=await r.fetchLyrics(R.id,R);if(se){const Te=r.generateLRCContent(se,R);if(Te){const Ae=Y.replace(/\.[^.]+$/,".lrc");yield{name:Br(e,Ae,S,j),lastModified:new Date,input:Te}}}}catch{}}catch(fe){if(fe.name==="AbortError")throw fe;console.error(`Failed to download track ${W}:`,fe)}}}try{const d=await ta(()=>import("./neutralino-bridge-BEOSBy1d.js"),[],import.meta.url),m=await d.os.showSaveDialog(`Select save location for ${e}.zip`,{defaultPath:`${e}.zip`,filters:[{name:"ZIP Archive",extensions:["zip"]}]});if(!m){Ys(i);return}const E=u(l());if(await d.filesystem.writeBinaryFile(m,new ArrayBuffer(0)),!E.body)throw new Error("ZIP response body is null");const S=E.body.getReader();let _=0;for(;;){const{done:M,value:R}=await S.read();if(M)break;const W=R.buffer.slice(R.byteOffset,R.byteOffset+R.byteLength);await d.filesystem.appendBinaryFile(m,W),_+=R.length}console.log(`[ZIP] Download complete. Total size: ${_} bytes.`),Er(i,!0)}catch(d){if(d.name==="AbortError")return;throw d}}async function Ks(o,e,t,n,r,i,c,h=null,f=null){const g=df(i,c,o.length);try{const y=window.NL_MODE===!0,u="showSaveFilePicker"in window&&"createWritable"in FileSystemFileHandle.prototype,l=xs.shouldForceIndividual(),d=u&&!l,m=!u&&!l;if(y)await Mp(o,e,t,n,r,g,h,i,f);else if(d)try{const E=await window.showSaveFilePicker({suggestedName:`${e}.zip`,types:[{description:"ZIP Archive",accept:{"application/zip":[".zip"]}}]});await Pp(o,e,t,n,r,g,E,h,i,f),Er(g,!0)}catch(E){if(E.name==="AbortError"){Ys(g);return}throw E}else m?(await Np(o,e,t,n,r,g,h,i,f),Er(g,!0)):(await of(o,t,n,r,g),Er(g,!0))}catch(y){console.error("Bulk download failed:",y),Er(g,!1,y.message)}}async function lf(o,e,t,n=null){const r=`Queue - ${new Date().toISOString().slice(0,10)}`;await Ks(o,r,e,t,n,"queue","Queue",null,{title:"Queue"})}async function cf(o,e,t,n,r=null){const i=o.releaseDate||(e[0]?.streamStartDate?e[0].streamStartDate.split("T")[0]:""),c=i?new Date(i):null,h=c&&!isNaN(c.getTime())?c.getFullYear():"",f=zs(localStorage.getItem("zip-folder-template")||"{albumTitle} - {albumArtist}",{albumTitle:o.title,albumArtist:o.artist?.name,year:h}),g=await bi(t,o.cover||o.album?.cover||o.coverId);await Ks(e,f,t,n,r,"album",o.title,g,o)}async function uf(o,e,t,n,r=null){const i=zs(localStorage.getItem("zip-folder-template")||"{albumTitle} - {albumArtist}",{albumTitle:o.title,albumArtist:"Playlist",year:new Date().getFullYear()}),c=e.find(f=>f.album?.cover),h=await bi(t,c?.album?.cover);await Ks(e,i,t,n,r,"playlist",o.title,h,o)}async function Dp(o,e,t,n,r=null){const i=`${Gn(o.name)} discography`,c=df("discography",o.name,e.length),{abortController:h}=Ur.get(c),f=h.signal,g="showSaveFilePicker"in window&&"createWritable"in FileSystemFileHandle.prototype,y=g&&!xs.shouldForceIndividual(),u=!g&&!xs.shouldForceIndividual();async function*l(){for(let d=0;d<e.length&&!f.aborted;d++){const m=e[d];yi(c,d,e.length,m.title);try{const{album:E,tracks:S}=await t.getAlbum(m.id),_=await bi(t,E.cover||m.cover),M=E.releaseDate||(S[0]?.streamStartDate?S[0].streamStartDate.split("T")[0]:""),R=M?new Date(M):null,W=R&&!isNaN(R.getTime())?R.getFullYear():"",fe=zs(localStorage.getItem("zip-folder-template")||"{albumTitle} - {albumArtist}",{albumTitle:E.title,albumArtist:E.artist?.name,year:W}),ye=`${i}/${fe}`;_&&(yield{name:`${ye}/cover.jpg`,lastModified:new Date,input:_});const Y=na.shouldUseRelativePaths(),j=Gs(n),se=await Hs(S,t),Te=se.separateByDisc,Ae=Te?(ze,de,we)=>`${$i(se.resolveDiscNumber(we))}/${de}`:null;if(na.shouldGenerateM3U()){const ze=Us(E,S,Y,Ae,j);yield{name:`${ye}/${Gn(E.title)}.m3u`,lastModified:new Date,input:ze}}if(na.shouldGenerateM3U8()){const ze=Bs(E,S,Y,Ae,j);yield{name:`${ye}/${Gn(E.title)}.m3u8`,lastModified:new Date,input:ze}}if(na.shouldGenerateNFO()){const ze=qs(E,S,"album");yield{name:`${ye}/${Gn(E.title)}.nfo`,lastModified:new Date,input:ze}}if(na.shouldGenerateJSON()){const ze=js(E,S,"album");yield{name:`${ye}/${Gn(E.title)}.json`,lastModified:new Date,input:ze}}if(na.shouldGenerateCUE()){const ze=`${Gn(E.title)}.flac`,de=Fs(E,S,ze);yield{name:`${ye}/${Gn(E.title)}.cue`,lastModified:new Date,input:de}}for(let ze=0;ze<S.length;ze++){const de=S[ze];if(f.aborted)break;try{const{blob:we,extension:ce}=await Ei(de,n,t,null,f),he=ai(de,n,ce),Pe=se.resolveDiscNumber(ze);if(yield{name:Br(ye,he,Te,Pe),lastModified:new Date,input:we},r&&ni.shouldDownloadLyrics())try{const $e=await r.fetchLyrics(de.id,de);if($e){const He=r.generateLRCContent($e,de);if(He){const et=he.replace(/\.[^.]+$/,".lrc");yield{name:Br(ye,et,Te,Pe),lastModified:new Date,input:He}}}}catch{}}catch(we){if(we.name==="AbortError")throw we;console.error(`Failed to download track ${de.title}:`,we)}}}catch(E){if(E.name==="AbortError")throw E;console.error(`Failed to download album ${m.title}:`,E)}}}try{if(y){const m=await(await window.showSaveFilePicker({suggestedName:`${i}.zip`,types:[{description:"ZIP Archive",accept:{"application/zip":[".zip"]}}]})).createWritable(),{downloadZip:E}=await Hi();await E(l()).body.pipeTo(m),Er(c,!0)}else if(u){const{downloadZip:d}=await Hi(),E=await d(l()).blob();Ms(E,`${i}.zip`),Er(c,!0)}else{for(let d=0;d<e.length&&!f.aborted;d++){const m=e[d];yi(c,d,e.length,m.title);const{tracks:E}=await t.getAlbum(m.id);await of(E,t,n,r,c)}Er(c,!0)}}catch(d){if(d.name==="AbortError"){Ys(c);return}Er(c,!1,d.message)}}function df(o,e,t){const n=dl(),r=document.createElement("div");r.className="download-task bulk-download",r.dataset.bulkType=o,r.dataset.bulkName=e;const i=o==="album"?"Album":o==="playlist"?"Playlist":o==="liked"?"Liked Tracks":o==="queue"?"Queue":"Discography";r.innerHTML=`
        <div style="display: flex; align-items: start; gap: 0.75rem;">
            <div style="flex: 1; min-width: 0;">
                <div style="font-weight: 600; font-size: 0.95rem; margin-bottom: 0.25rem;">
                    Downloading ${i}
                </div>
                <div style="font-size: 0.85rem; color: var(--muted-foreground); margin-bottom: 0.5rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${en(e)}</div>
                <div class="download-progress-bar" style="height: 4px; background: var(--secondary); border-radius: 2px; overflow: hidden;">
                    <div class="download-progress-fill" style="width: 0%; height: 100%; background: var(--highlight); transition: width 0.2s;"></div>
                </div>
                <div class="download-status" style="font-size: 0.75rem; color: var(--muted-foreground); margin-top: 0.25rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Starting...</div>
            </div>
            <button class="download-cancel" style="background: transparent; border: none; color: var(--muted-foreground); cursor: pointer; padding: 4px; border-radius: 4px; transition: all 0.2s;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>
    `,n.appendChild(r);const c=new AbortController;return Ur.set(r,{abortController:c}),r.querySelector(".download-cancel").addEventListener("click",()=>{c.abort(),Ys(r)}),r}function yi(o,e,t,n){const r=o.querySelector(".download-progress-fill"),i=o.querySelector(".download-status"),c=t>0?Math.round(e/t*100):0;r.style.width=`${c}%`,i.textContent=`${e}/${t} - ${n}`}function Er(o,e=!0,t=null){const n=o.querySelector(".download-progress-fill"),r=o.querySelector(".download-status");e?(n.style.width="100%",n.style.background="#10b981",r.textContent="âœ“ Download complete",r.style.color="#10b981",setTimeout(()=>{o.style.animation="slide-out 0.3s ease forwards",setTimeout(()=>o.remove(),300)},3e3)):(n.style.background="#ef4444",r.textContent=t||"âœ— Download failed",r.style.color="#ef4444",setTimeout(()=>{o.style.animation="slide-out 0.3s ease forwards",setTimeout(()=>o.remove(),300)},5e3))}async function ff(o,e,t,n=null,r=null){if(!o){alert("No track is currently playing");return}const i=`track-${o.id}`;if(No.has(i)){Dn("This track is already being downloaded");return}let c={...o,artist:o.artist||(o.artists&&o.artists.length>0?o.artists[0]:null)};try{const g=await t.getTrackMetadata(o.id);g&&(c={...g,...c,artist:c.artist||g.artist,album:{...g.album||{},...c.album||{}},discNumber:c.discNumber??g.discNumber,volumeNumber:c.volumeNumber??g.volumeNumber})}catch{}if(c.album&&(!c.album.title||!c.album.artist)&&c.album.id)try{const g=await t.getAlbum(c.album.id);g.album&&(c.album={...c.album,...g.album})}catch(g){console.warn("Failed to fetch album data for metadata:",g)}const h=ai(c,e),f=r||new AbortController;No.add(i);try{if(rf(o.id,c,h,t,f),await t.downloadTrack(o.id,e,h,{signal:f.signal,track:c,onProgress:g=>{sf(o.id,g)}}),Qo(o.id,!0),n&&ni.shouldDownloadLyrics())try{const g=await n.fetchLyrics(o.id,o);g&&n.downloadLRC(g,o)}catch{console.log("Could not download lyrics for track")}}catch(g){if(g.name!=="AbortError"){const y=g.message===Hd?g.message:"Download failed. Please try again.";Qo(o.id,!1,y)}}finally{No.delete(i)}}async function Op(o,e,t,n=null){const r=`Liked Tracks - ${new Date().toISOString().slice(0,10)}`;await Ks(o,r,e,t,n,"liked","Liked Tracks")}const zp=Object.freeze(Object.defineProperty({__proto__:null,addDownloadTask:rf,completeDownloadTask:Qo,downloadAlbumAsZip:cf,downloadDiscography:Dp,downloadLikedTracks:Op,downloadPlaylistAsZip:uf,downloadTrackWithMetadata:ff,downloadTracks:lf,showNotification:Dn,updateDownloadProgress:sf},Symbol.toStringTag,{value:"Module"}));function hf(){return Fd.isEnabled()}function bn(o,e={}){if(hf()&&window.plausible)try{window.plausible(o,{props:e})}catch{}}function od(o){bn("pageview",{path:o})}function Up(o){bn("Play Track",{track_id:o?.id||"unknown",track_title:o?.title||"Unknown",artist_id:o?.artist?.id||o?.artists?.[0]?.id||"unknown",artist:o?.artist?.name||o?.artists?.[0]?.name||"Unknown",album_id:o?.album?.id||"unknown",album:o?.album?.title||"Unknown",duration:o?.duration||0,quality:o?.audioQuality||o?.quality||"Unknown",is_local:o?.isLocal||!1,is_explicit:o?.explicit||!1,track_number:o?.trackNumber||0,year:o?.album?.releaseYear||o?.album?.releaseDate||"unknown"})}function Bp(o){bn("Pause Track",{track_id:o?.id||"unknown",track_title:o?.title||"Unknown",artist_id:o?.artist?.id||o?.artists?.[0]?.id||"unknown",artist:o?.artist?.name||o?.artists?.[0]?.name||"Unknown",album_id:o?.album?.id||"unknown",album:o?.album?.title||"Unknown"})}function ld(o,e){bn("Skip Track",{track_id:o?.id||"unknown",track_title:o?.title||"Unknown",artist_id:o?.artist?.id||o?.artists?.[0]?.id||"unknown",artist:o?.artist?.name||o?.artists?.[0]?.name||"Unknown",album_id:o?.album?.id||"unknown",album:o?.album?.title||"Unknown",direction:e})}function Fp(o){bn("Toggle Shuffle",{enabled:o})}function qp(o){bn("Toggle Repeat",{mode:o})}function jp(o,e){bn("Search",{query_length:o?.length||0,has_results:e>0,results_count:e})}function Hp(o){bn("Search Tab Change",{tab:o})}function Gp(o){bn("Sidebar Navigation",{item:o})}function Yp(o){bn("Like Track",{track_id:o?.id||"unknown",track_title:o?.title||"Unknown",artist_id:o?.artist?.id||o?.artists?.[0]?.id||"unknown",artist:o?.artist?.name||o?.artists?.[0]?.name||"Unknown",album_id:o?.album?.id||"unknown",album:o?.album?.title||"Unknown"})}function Kp(o){bn("Unlike Track",{track_id:o?.id||"unknown",track_title:o?.title||"Unknown",artist_id:o?.artist?.id||o?.artists?.[0]?.id||"unknown",artist:o?.artist?.name||o?.artists?.[0]?.name||"Unknown",album_id:o?.album?.id||"unknown"})}function $p(o){bn("Like Album",{album_title:o?.title||"Unknown",artist:o?.artist?.name||"Unknown"})}function Vp(o){bn("Unlike Album",{album_title:o?.title||"Unknown"})}function Wp(o){bn("Like Artist",{artist_name:o?.name||"Unknown"})}function Qp(o){bn("Unlike Artist",{artist_name:o?.name||"Unknown"})}function Xp(o){bn("Like Playlist",{playlist_name:o?.title||o?.name||"Unknown"})}function Jp(o){bn("Unlike Playlist",{playlist_name:o?.title||o?.name||"Unknown"})}function Zp(o,e){bn("Create Playlist",{playlist_name:o?.name||"Unknown",track_count:o?.tracks?.length||0,is_public:o?.isPublic||!1,source:e||"manual"})}function ey(o){bn("Create Folder",{folder_name:o?.name||"Unknown"})}function ty(o,e){bn("Download Track",{track_id:o?.id||"unknown",track_title:o?.title||"Unknown",artist_id:o?.artist?.id||o?.artists?.[0]?.id||"unknown",artist:o?.artist?.name||o?.artists?.[0]?.name||"Unknown",album_id:o?.album?.id||"unknown",quality:e||"Unknown"})}function ny(o,e){bn("Add to Queue",{track_id:o?.id||"unknown",track_title:o?.title||"Unknown",artist_id:o?.artist?.id||o?.artists?.[0]?.id||"unknown",artist:o?.artist?.name||o?.artists?.[0]?.name||"Unknown",album_id:o?.album?.id||"unknown",position:e})}function ay(o){bn("Play Next",{track_id:o?.id||"unknown",track_title:o?.title||"Unknown",artist_id:o?.artist?.id||o?.artists?.[0]?.id||"unknown",artist:o?.artist?.name||o?.artists?.[0]?.name||"Unknown",album_id:o?.album?.id||"unknown"})}function ry(o,e,t){bn("Context Menu Action",{action:o,item_type:e,item_name:t?.title||t?.name||"Unknown"})}function iy(o){bn("Block Track",{track_id:o?.id||"unknown",track_title:o?.title||"Unknown",artist_id:o?.artist?.id||o?.artists?.[0]?.id||"unknown",artist:o?.artist?.name||o?.artists?.[0]?.name||"Unknown",album_id:o?.album?.id||"unknown"})}function sy(o){bn("Unblock Track",{track_id:o?.id||"unknown",track_title:o?.title||"Unknown"})}function oy(o){bn("Block Album",{album_id:o?.id||"unknown",album_title:o?.title||"Unknown",artist_id:o?.artist?.id||"unknown"})}function ly(o){bn("Unblock Album",{album_id:o?.id||"unknown",album_title:o?.title||"Unknown"})}function cy(o){bn("Block Artist",{artist_id:o?.id||"unknown",artist_name:o?.name||"Unknown"})}function uy(o){bn("Unblock Artist",{artist_id:o?.id||"unknown",artist_name:o?.name||"Unknown"})}function dy(o,e){bn("Copy Link",{type:o,id:e})}function fy(o,e){bn("Open in New Tab",{type:o,id:e})}function hy(o){bn("Open Lyrics",{track_title:o?.title||"Unknown",artist:o?.artist?.name||o?.artists?.[0]?.name||"Unknown"})}function mf(o){bn("Close Lyrics",{track_title:o?.title||"Unknown"})}function my(o){bn("Open Fullscreen Cover",{track_title:o?.title||"Unknown"})}function cd(){bn("Close Fullscreen Cover")}function gy(o){bn("Select Local Folder",{file_count:o})}function py(){bn("Change Local Folder")}function ud(o,e,t){bn("Import CSV",{playlist_name:o,track_count:e,missing_count:t})}function yy(o,e,t,n){bn("Import JSPF",{playlist_name:o,track_count:e,missing_count:t,source:n})}function by(o,e,t){bn("Import XSPF",{playlist_name:o,track_count:e,missing_count:t})}function Ey(o,e,t){bn("Import XML",{playlist_name:o,track_count:e,missing_count:t})}function vy(o,e,t){bn("Import M3U",{playlist_name:o,track_count:e,missing_count:t})}function Ty(o){bn("Set Sleep Timer",{minutes:o})}function dd(){bn("Cancel Sleep Timer")}function Ra(o){bn("Keyboard Shortcut",{key:o})}function wy(){bn("Close Side Panel")}function _y(){bn("Open Queue")}function Ay(){bn("Close Queue")}function Sy(o,e){bn("Start Mix",{source_type:o,source_name:e?.title||e?.name||"Unknown"})}function fd(){bn("PWA Update")}function ky(){bn("Dismiss Update")}function Iy(o){bn("Change Sort",{sort_type:o})}function hd(o){bn("Open Modal",{modal_name:o})}function md(o){bn("Close Modal",{modal_name:o})}function Ry(){bn("Session Start",{user_agent:navigator.userAgent,screen_width:window.screen.width,screen_height:window.screen.height,language:navigator.language})}function xy(){if(!hf())return;od(window.location.pathname),Ry();let o=window.location.pathname;setInterval(()=>{const e=window.location.pathname;e!==o&&(od(e),o=e)},500),window.addEventListener("online",()=>bn("Go Online")),window.addEventListener("offline",()=>bn("Go Offline")),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?bn("App Background"):bn("App Foreground")})}class Cy{constructor(){this.panel=document.getElementById("side-panel"),this.titleElement=document.getElementById("side-panel-title"),this.controlsElement=document.getElementById("side-panel-controls"),this.contentElement=document.getElementById("side-panel-content"),this.currentView=null}open(e,t,n,r,i=!1){if(!i&&this.currentView===e&&this.panel.classList.contains("active")){this.close();return}this.currentView=e,this.panel.dataset.view=e,this.titleElement.textContent=t,this.controlsElement.innerHTML="",this.contentElement.innerHTML="",n&&n(this.controlsElement),r&&r(this.contentElement),this.panel.classList.add("active")}close(){if(this.currentView){if(wy(),this.currentView==="queue")Ay();else if(this.currentView==="lyrics"){const e=document.getElementById("audio-player");e&&e._currentTrack&&mf(e._currentTrack)}}this.panel.classList.remove("active"),this.currentView=null,setTimeout(()=>{this.panel.classList.contains("active")||(this.controlsElement.innerHTML="",this.contentElement.innerHTML="")},300)}isActive(e){return this.currentView===e&&this.panel.classList.contains("active")}refresh(e,t,n){this.isActive(e)&&(t&&(this.controlsElement.innerHTML="",t(this.controlsElement)),n&&(this.contentElement.innerHTML="",n(this.contentElement)))}updateContent(e,t){this.isActive(e)&&(this.contentElement.innerHTML="",t(this.contentElement))}}const ea=new Cy,gd='<svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M12 24c6.627 0 12-5.373 12-12S18.627 0 12 0 0 5.373 0 12s5.373 12 12 12z" fill="#ffff64"/><path d="M6.3 6.3h11.4v11.4H6.3z" fill="#000"/></svg>';function Xo(o){return o?/[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FFF\u3400-\u4DBF\uAC00-\uD7AF\u1100-\u11FF\u3130-\u318F]/.test(o):!1}function gf(o){if(!o)return!1;const e=o.title||"",t=wa(o)||"";return Xo(e)||Xo(t)}const pd='<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="opacity: 0.7;"><path d="M12 24c6.627 0 12-5.373 12-12S18.627 0 12 0 0 5.373 0 12s5.373 12 12 12z" /><path d="M6.3 6.3h11.4v11.4H6.3z" fill="var(--card)"/></svg>';class Ly{constructor(){this.cache=new Map,this.loading=!1}getToken(){return"QmS9OvsS-7ifRBKx_ochIPQU7oejIS9Eo_z5iWHmCPyhwLVQID3pYTHJmJTa6z8z"}async searchTrack(e,t){const n=e.split("(")[0].split("-")[0].trim(),r=encodeURIComponent(`${n} ${t}`),i=this.getToken(),c=`https://api.genius.com/search?q=${r}&access_token=${i}`,h=await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(c)}`);if(!h.ok)throw new Error("Failed to search Genius");const f=await h.json();if(f.response.hits.length===0)return null;const g=l=>l.toLowerCase().replace(/[^\p{L}\p{N}]/gu,""),y=g(t),u=f.response.hits.find(l=>{const d=g(l.result.primary_artist.name);return d.includes(y)||y.includes(d)});return u?u.result:f.response.hits[0].result}async getReferents(e){const t=this.getToken(),n=`https://api.genius.com/referents?song_id=${e}&text_format=plain&per_page=50&access_token=${t}`,r=await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(n)}`);if(!r.ok)throw new Error("Failed to fetch annotations");return(await r.json()).response.referents}async getDataForTrack(e){if(this.cache.has(e.id))return this.cache.get(e.id);try{this.loading=!0;const t=Array.isArray(e.artists)?e.artists[0].name:e.artist.name,n=await this.searchTrack(e.title,t);if(!n)return this.loading=!1,null;const r=await this.getReferents(n.id),i={song:n,referents:r};return this.cache.set(e.id,i),this.loading=!1,i}catch(t){throw console.error("Genius Error:",t),this.loading=!1,t}}findAnnotations(e,t){if(!t||!e)return[];const n=h=>h.toLowerCase().replace(/[^\p{L}\p{N}\s]/gu,"").replace(/\s+/g," ").trim(),r=n(e),i=h=>new Set(h.split(" ").filter(f=>f.length>0)),c=i(r);return t.filter(h=>{const f=n(h.fragment);if(r.includes(f)||f.includes(r))return!0;const g=i(f);if(g.size===0||c.size===0)return!1;let y=0;return g.forEach(u=>{c.has(u)&&y++}),y/Math.min(g.size,c.size)>.6})}}class pf{constructor(e){this.api=e,this.currentLyrics=null,this.syncedLyrics=[],this.lyricsCache=new Map,this.componentLoaded=!1,this.amLyricsElement=null,this.animationFrameId=null,this.currentTrackId=null,this.mutationObserver=null,this.romajiObserver=null,this.isRomajiMode=!1,this.originalLyricsData=null,this.kuroshiroLoaded=!1,this.kuroshiroLoading=!1,this.romajiTextCache=new Map,this.convertedTracksCache=new Set,this.geniusManager=new Ly,this.isGeniusMode=!1,this.currentGeniusData=null,this.timingOffset=0}getTimingOffset(e){try{const t=`lyrics-offset-${e}`,n=localStorage.getItem(t);return n?parseInt(n,10):0}catch{return 0}}setTimingOffset(e,t){try{const n=`lyrics-offset-${e}`;localStorage.setItem(n,t.toString())}catch(n){console.warn("Failed to save lyrics timing offset:",n)}}resetTimingOffset(e){this.setTimingOffset(e,0)}getOffsetDisplayString(e){const t=e>=0?"+":"",n=Math.abs(e)/1e3;return`${t}${n.toFixed(1)}s`}async loadKuroshiro(){if(this.kuroshiroLoaded)return!0;if(this.kuroshiroLoading)return new Promise(e=>{const t=setInterval(()=>{this.kuroshiroLoading||(clearInterval(t),e(this.kuroshiroLoaded))},100)});this.kuroshiroLoading=!0;try{window._originalXHROpen||(window._originalXHROpen=XMLHttpRequest.prototype.open,XMLHttpRequest.prototype.open=function(n,r,...i){const c=r.toString();if(c.includes("/dict/")&&c.includes(".dat.gz")){const f=`https://cdn.jsdelivr.net/npm/kuromoji@0.1.2/dict/${c.split("/").pop()}`;return window._originalXHROpen.call(this,n,f,...i)}return window._originalXHROpen.call(this,n,r,...i)}),window._originalFetch||(window._originalFetch=window.fetch,window.fetch=async(n,r)=>{const i=n.toString();if(i.includes("/dict/")&&i.includes(".dat.gz")){const c=i.split("/").pop(),h=`https://cdn.jsdelivr.net/npm/kuromoji@0.1.2/dict/${c}`;return console.log(`Redirecting dict fetch: ${c} -> CDN`),window._originalFetch(h,r)}return window._originalFetch(n,r)}),window.Kuroshiro||await this.loadScript("https://unpkg.com/kuroshiro@1.2.0/dist/kuroshiro.min.js"),window.KuromojiAnalyzer||await this.loadScript("https://unpkg.com/kuroshiro-analyzer-kuromoji@1.1.0/dist/kuroshiro-analyzer-kuromoji.min.js");const e=window.Kuroshiro.default||window.Kuroshiro,t=window.KuromojiAnalyzer.default||window.KuromojiAnalyzer;return this.kuroshiro=new e,await this.kuroshiro.init(new t({dictPath:"/dict/"})),this.kuroshiroLoaded=!0,this.kuroshiroLoading=!1,console.log("âœ“ Kuroshiro loaded and initialized successfully"),!0}catch(e){return console.error("âœ— Failed to load Kuroshiro:",e),this.kuroshiroLoaded=!1,this.kuroshiroLoading=!1,!1}}loadScript(e){return new Promise((t,n)=>{if(document.querySelector(`script[src="${e}"]`)){t();return}const r=document.createElement("script");r.src=e,r.onload=t,r.onerror=()=>n(new Error(`Failed to load script: ${e}`)),document.head.appendChild(r)})}containsJapanese(e){return e?/[\u3040-\u30FF\u31F0-\u9FFF]/.test(e):!1}async convertToRomaji(e){if(!e)return e;if(this.romajiTextCache.has(e))return this.romajiTextCache.get(e);if(!Xo(e))return e;if(!this.kuroshiroLoaded&&!await this.loadKuroshiro()||!this.kuroshiro)return console.warn("Kuroshiro not available, skipping conversion"),e;try{const t=await this.kuroshiro.convert(e,{to:"romaji",mode:"spaced",romajiSystem:"hepburn"});return this.romajiTextCache.set(e,t),t}catch(t){return console.warn("Romaji conversion failed for text:",e.substring(0,30),t),e}}setRomajiMode(e){this.isRomajiMode=e;try{localStorage.setItem("lyricsRomajiMode",e?"true":"false")}catch(t){console.warn("Failed to save Romaji mode preference:",t)}}getRomajiMode(){try{return localStorage.getItem("lyricsRomajiMode")==="true"}catch{return!1}}async ensureComponentLoaded(){if(!this.componentLoaded){if(typeof customElements<"u"&&customElements.get("am-lyrics")){this.componentLoaded=!0;return}return new Promise((e,t)=>{const n=document.createElement("script");n.type="module",n.src="https://cdn.jsdelivr.net/npm/@uimaxbai/am-lyrics/dist/src/am-lyrics.min.js",n.onload=()=>{typeof customElements<"u"?customElements.whenDefined("am-lyrics").then(()=>{this.componentLoaded=!0,e()}).catch(t):e()},n.onerror=()=>t(new Error("Failed to load lyrics component")),document.head.appendChild(n)})}}async fetchLyrics(e,t=null){if(t){if(this.lyricsCache.has(e))return this.lyricsCache.get(e);try{const n=Array.isArray(t.artists)?t.artists.map(g=>g.name||g).join(", "):t.artist?.name||"",r=t.title||"",i=t.album?.title||"",c=t.duration?Math.round(t.duration):null;if(!r||!n)return console.warn("Missing required fields for LRCLIB"),null;const h=new URLSearchParams({track_name:r,artist_name:n});i&&h.append("album_name",i),c&&h.append("duration",c.toString());const f=await fetch(`https://lrclib.net/api/get?${h.toString()}`);if(f.ok){const g=await f.json();if(g.syncedLyrics){const y={subtitles:g.syncedLyrics,lyricsProvider:"LRCLIB"};return this.lyricsCache.set(e,y),y}}}catch(n){console.warn("LRCLIB fetch failed:",n)}}return null}parseSyncedLyrics(e){return e?e.split(`
`).filter(n=>n.trim()).map(n=>{const r=n.match(/\[(\d+):(\d+)\.(\d+)\]\s*(.+)/);if(r){const[,i,c,h,f]=r;return{time:parseInt(i)*60+parseInt(c)+parseInt(h)/100,text:f.trim()}}return null}).filter(Boolean):[]}generateLRCContent(e,t){if(!e||!e.subtitles)return null;const n=Ca(t),r=wa(t);let i=`[ti:${n}]
`;return i+=`[ar:${r}]
`,i+=`[al:${t.album?.title||"Unknown Album"}]
`,i+=`[by:${e.lyricsProvider||"Unknown"}]
`,i+=`
`,i+=e.subtitles,i}downloadLRC(e,t){const n=this.generateLRCContent(e,t);if(!n){alert("No synced lyrics available for this track");return}const r=new Blob([n],{type:"application/octet-stream"}),i=URL.createObjectURL(r),c=document.createElement("a");c.href=i,c.download=ai(t,"LOSSLESS").replace(/\.flac$/,".lrc"),document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(i)}getCurrentLine(e){if(!this.syncedLyrics||this.syncedLyrics.length===0)return-1;let t=-1;for(let n=0;n<this.syncedLyrics.length&&e>=this.syncedLyrics[n].time;n++)t=n;return t}setupLyricsObserver(e){if(this.stopLyricsObserver(),!e)return;const t=e.shadowRoot||e;this.romajiObserver=new MutationObserver(n=>{n.some(i=>{if(i.type==="childList"){let c=!1;if(i.addedNodes.length>0){for(const h of i.addedNodes)if(!(h.nodeType===Node.ELEMENT_NODE&&h.classList.contains("genius-indicator"))){c=!0;break}}if(!c&&i.removedNodes.length>0){for(const h of i.removedNodes)if(!(h.nodeType===Node.ELEMENT_NODE&&h.classList.contains("genius-indicator"))){c=!0;break}}return c}return i.type==="characterData"})&&(this.observerTimeout&&clearTimeout(this.observerTimeout),this.observerTimeout=setTimeout(async()=>{this.isRomajiMode&&await this.convertLyricsContent(e),this.isGeniusMode&&this.currentGeniusData&&this.applyGeniusAnnotations(e,this.currentGeniusData.referents)},100))}),this.romajiObserver.observe(t,{childList:!0,subtree:!0,characterData:!0,attributes:!1}),this.isRomajiMode&&this.convertLyricsContent(e),this.isGeniusMode&&this.currentGeniusData&&this.applyGeniusAnnotations(e,this.currentGeniusData.referents)}async convertLyricsContent(e){if(!e||!this.isRomajiMode)return;const t=e.shadowRoot||e;if(!this.kuroshiroLoaded&&!await this.loadKuroshiro()){console.warn("Cannot convert lyrics - Kuroshiro load failed");return}const n=[],r=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1);let i;for(;i=r.nextNode();)n.push(i);for(const c of n){if(!c.parentElement)continue;const h=c.parentElement.tagName?.toLowerCase(),f=String(c.parentElement.className||"");if(["script","style","code","input","textarea","time"].includes(h))continue;const y=c.textContent;if(!(f.includes("progress")&&!f.includes("progress-text")||f.includes("time")&&!f.includes("progress-text")||f.includes("timestamp"))&&!(!y||y.trim().length===0)&&this.containsJapanese(y)){const u=await this.convertToRomaji(y);u&&u!==y&&(c.textContent=u)}}this.currentTrackId&&this.convertedTracksCache.add(this.currentTrackId)}stopLyricsObserver(){this.romajiObserver&&(this.romajiObserver.disconnect(),this.romajiObserver=null),this.observerTimeout&&(clearTimeout(this.observerTimeout),this.observerTimeout=null)}async toggleRomajiMode(e){return this.isRomajiMode=!this.isRomajiMode,this.setRomajiMode(this.isRomajiMode),e&&(this.isRomajiMode?(this.setupLyricsObserver(e),await this.convertLyricsContent(e)):this.stopLyricsObserver()),this.isRomajiMode}async applyGeniusAnnotations(e,t){if(!e||!t)return;const n=e.shadowRoot||e,r=Array.from(n.querySelectorAll("p, .line, .lyric-line, .lrc-line"));if(r.length===0)return;r.forEach(c=>{c.classList.remove("genius-annotated","genius-multi-start","genius-multi-end","genius-multi-mid"),delete c.__geniusAnnotations});const i=c=>c.toLowerCase().replace(/[^\p{L}\p{N}\s]/gu,"").replace(/\s+/g," ").trim();t.forEach(c=>{const h=i(c.fragment);if(h)for(let f=0;f<r.length;f++){let g="",y=[];for(let u=f;u<r.length;u++){const l=r[u],d=l.cloneNode(!0);d.querySelectorAll('.time, .timestamp, [class*="time"], .genius-indicator').forEach(E=>E.remove());const m=i(d.textContent||"");if(m){if(y.length>0&&(g+=" "),g+=m,y.push(l),g.includes(h)){y.forEach((E,S)=>{if(E.classList.add("genius-annotated"),E.__geniusAnnotations||(E.__geniusAnnotations=[]),E.__geniusAnnotations.some(_=>_.id===c.id)||E.__geniusAnnotations.push(c),y.length>1&&(S===0?E.classList.add("genius-multi-start"):S===y.length-1?E.classList.add("genius-multi-end"):E.classList.add("genius-multi-mid")),!E.querySelector(".genius-indicator")){const _=document.createElement("span");_.className="genius-indicator",_.textContent=" â˜º",_.style.color="#ffff64",_.style.marginLeft="0.5em",E.appendChild(_)}});break}if(g.length>h.length+50)break}}}})}}function ks(o,e,t,n=!1){const r=t||new pf;r.getRomajiMode()&&gf(o)&&!r.kuroshiroLoaded&&!r.kuroshiroLoading&&r.loadKuroshiro().catch(f=>{console.warn("Failed to load Kuroshiro for Romaji conversion:",f)}),r.timingOffset=r.getTimingOffset(o.id);const c=f=>{const g=r.getRomajiMode();r.isRomajiMode=g;const y=r.isGeniusMode,u=r.getOffsetDisplayString(r.timingOffset);f.innerHTML=`
            <button id="close-side-panel-btn" class="btn-icon" title="Close">
                ${Os}
            </button>
            <div class="lyrics-timing-controls">
                <button id="lyrics-timing-minus-btn" class="btn-icon" title="Decrease delay (lyrics earlier) -0.5s">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M5 12h14"/>
                    </svg>
                </button>
                <span id="lyrics-timing-display" class="lyrics-timing-display" title="Current timing offset">${u}</span>
                <button id="lyrics-timing-plus-btn" class="btn-icon" title="Increase delay (lyrics later) +0.5s">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M5 12h14M12 5v14"/>
                    </svg>
                </button>
                <button id="lyrics-timing-reset-btn" class="btn-icon" title="Reset timing offset">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                        <path d="M3 3v5h5"/>
                    </svg>
                </button>
            </div>
            <button id="romaji-toggle-btn" class="btn-icon" title="Toggle Romaji (Japanese to Latin)" data-enabled="${g}" style="color: ${g?"var(--primary)":""}">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                </svg>
            </button>
            <button id="genius-toggle-btn" class="btn-icon ${y?"active-genius":""}" title="Genius Mode" style="${y?"color: #ffff64;":""}">
                ${y?gd:pd}
            </button>
        `,f.querySelector("#close-side-panel-btn").addEventListener("click",()=>{ea.close(),Gi(e,ea.panel)});const l=()=>{const E=f.querySelector("#lyrics-timing-display");E&&(E.textContent=r.getOffsetDisplayString(r.timingOffset))};f.querySelector("#lyrics-timing-minus-btn")?.addEventListener("click",()=>{r.timingOffset-=500,r.setTimingOffset(o.id,r.timingOffset),l()}),f.querySelector("#lyrics-timing-plus-btn")?.addEventListener("click",()=>{r.timingOffset+=500,r.setTimingOffset(o.id,r.timingOffset),l()}),f.querySelector("#lyrics-timing-reset-btn")?.addEventListener("click",()=>{r.timingOffset=0,r.resetTimingOffset(o.id),l()});const d=f.querySelector("#romaji-toggle-btn");if(d){const E=()=>{const S=r.isRomajiMode;d.setAttribute("data-enabled",S),d.style.color=S?"var(--primary)":""};E(),d.addEventListener("click",async()=>{const S=ea.panel.querySelector("am-lyrics");S&&(await r.toggleRomajiMode(S),E())})}const m=f.querySelector("#genius-toggle-btn");m&&m.addEventListener("click",async()=>{r.isGeniusMode=!r.isGeniusMode;const E=r.isGeniusMode;if(m.classList.toggle("active-genius",E),m.style.color=E?"#ffff64":"",m.innerHTML=E?gd:pd,E)try{m.style.opacity="0.5",await r.geniusManager.getDataForTrack(o),r.currentGeniusData=r.geniusManager.cache.get(o.id);const S=ea.panel.querySelector("am-lyrics");S&&r.applyGeniusAnnotations(S,r.geniusManager.cache.get(o.id)?.referents)}catch(S){alert(S.message),r.isGeniusMode=!1,m.classList.remove("active-genius"),m.style.color=""}finally{m.style.opacity="1"}else{const S=ea.panel.querySelector("am-lyrics");if(S){const M=S.shadowRoot||S;Array.from(M.querySelectorAll(".genius-annotated")).forEach(W=>{W.classList.remove("genius-annotated","genius-multi-start","genius-multi-end","genius-multi-mid"),delete W.__geniusAnnotations})}const _=document.querySelector(".genius-annotation-modal");_&&_.remove()}})},h=async f=>{Gi(e,ea.panel),await My(f,o,e,r),f.lyricsCleanup&&(ea.panel.lyricsCleanup=f.lyricsCleanup,ea.panel.lyricsManager=f.lyricsManager)};ea.open("lyrics","Lyrics",c,h,n)}function yf(){return getComputedStyle(document.documentElement).colorScheme==="light"?"#000":"#fff"}function Py(){const o=yf();document.querySelectorAll("am-lyrics").forEach(e=>{e.setAttribute("highlight-color",o)})}const Ny=new MutationObserver(()=>{Py()});Ny.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme","style"]});async function My(o,e,t,n){o.innerHTML='<div class="lyrics-loading">Loading lyrics...</div>';try{await n.ensureComponentLoaded(),n.isRomajiMode=n.getRomajiMode(),n.currentTrackId=e.id;const r=e.title,i=wa(e),c=e.album?.title,h=e.duration?Math.round(e.duration*1e3):void 0,f=e.isrc||"";o.innerHTML="";const g=document.createElement("am-lyrics");g.setAttribute("song-title",r),g.setAttribute("song-artist",i),c&&g.setAttribute("song-album",c),h&&g.setAttribute("song-duration",h),g.setAttribute("query",`${r} ${i}`.trim()),f&&g.setAttribute("isrc",f),g.setAttribute("highlight-color",yf()),g.setAttribute("hover-background-color","rgba(59, 130, 246, 0.14)"),g.setAttribute("autoscroll",""),g.setAttribute("interpolate",""),g.style.height="100%",g.style.width="100%",o.appendChild(g),n.setupLyricsObserver(g),n.isRomajiMode&&gf(e)&&!n.kuroshiroLoaded&&await n.loadKuroshiro(),n.fetchLyrics(e.id,e).then(async()=>{if(n.isGeniusMode)try{const l=await n.geniusManager.getDataForTrack(e);l&&(n.currentGeniusData=l,n.applyGeniusAnnotations(g,l.referents))}catch(l){console.warn("Genius auto-load failed",l)}}).catch(l=>console.warn("Background lyrics fetch failed",l)),await new Promise(l=>{const d=()=>g.querySelector(".lyric-line, [class*='lyric']")||g.shadowRoot&&g.shadowRoot.querySelector("[class*='lyric']")||g.textContent&&g.textContent.length>50;if(d()){l();return}let m=0;const E=25,S=setInterval(()=>{m++,(d()||m>=E)&&(clearInterval(S),l())},200)}),n.isRomajiMode&&(await n.convertLyricsContent(g),setTimeout(()=>n.convertLyricsContent(g),500)),n.isGeniusMode&&n.currentGeniusData&&n.applyGeniusAnnotations(g,n.currentGeniusData.referents);const u=Dy(e,t,g,n);return o.lyricsCleanup=u,o.lyricsManager=n,g}catch(r){return console.error("Failed to load lyrics:",r),o.innerHTML='<div class="lyrics-error">Failed to load lyrics</div>',null}}function Dy(o,e,t,n){let r=0,i=performance.now(),c=null;const h=()=>n?.timingOffset||0,f=()=>{const d=e.currentTime*1e3;r=d,i=performance.now(),t.currentTime=d-h()},g=()=>{if(!e.paused){const m=performance.now()-i,E=r+m;t.currentTime=E-h(),c=requestAnimationFrame(g)}},y=()=>{r=e.currentTime*1e3,i=performance.now(),g()},u=()=>{c&&(cancelAnimationFrame(c),c=null)},l=d=>{if(d.detail&&d.detail.timestamp!==void 0){const m=n||ea.panel.lyricsManager;if(m&&m.isGeniusMode){const E=d.detail.timestamp/1e3,S=m.lyricsCache.get(o.id);if(S&&S.subtitles){const M=m.parseSyncedLyrics(S.subtitles).find(R=>Math.abs(R.time-E)<1);if(M&&M.text&&m.currentGeniusData){const R=m.geniusManager.findAnnotations(M.text,m.currentGeniusData.referents);Oy(R,M.text)}}return}e.currentTime=d.detail.timestamp/1e3,e.play()}};return e.addEventListener("timeupdate",f),e.addEventListener("play",y),e.addEventListener("pause",u),e.addEventListener("seeked",f),t.addEventListener("line-click",l),e.paused||g(),()=>{c&&cancelAnimationFrame(c),e.removeEventListener("timeupdate",f),e.removeEventListener("play",y),e.removeEventListener("pause",u),e.removeEventListener("seeked",f),t.removeEventListener("line-click",l)}}function Oy(o,e){const t=document.querySelector(".genius-annotation-modal");t&&t.remove();const n=document.createElement("div");n.className="genius-annotation-modal";let r=`
        <div class="genius-modal-content">
            <div class="genius-header">
                <span class="genius-line">"${e}"</span>
                <button class="close-genius">Ã—</button>
            </div>
            <div class="genius-body">
    `;o.length===0?r+=`
            <div class="annotation-item">
                <div class="annotation-text" style="color: var(--muted-foreground); font-style: italic;">No Genius annotation found for this line.</div>
            </div>
        `:o.forEach(i=>{const c=i.annotations[0].body.plain;r+=`
                <div class="annotation-item">
                    <div class="annotation-text">${c.replace(/\n/g,"<br>")}</div>
                </div>
            `}),r+="</div></div>",n.innerHTML=r,document.body.appendChild(n),n.querySelector(".close-genius").addEventListener("click",()=>n.remove()),n.addEventListener("click",i=>{i.target===n&&n.remove()})}function Gi(o,e){e&&e.lyricsCleanup&&(e.lyricsCleanup(),e.lyricsCleanup=null),e&&e.lyricsManager&&e.lyricsManager.stopLyricsObserver()}class zy{constructor(){this.dbName="MonochromeDB",this.version=8,this.db=null}async open(){return this.db?this.db:new Promise((e,t)=>{const n=indexedDB.open(this.dbName,this.version);n.onerror=r=>{console.error("Database error:",r.target.error),t(r.target.error)},n.onsuccess=r=>{this.db=r.target.result,e(this.db)},n.onupgradeneeded=r=>{const i=r.target.result;i.objectStoreNames.contains("favorites_tracks")||i.createObjectStore("favorites_tracks",{keyPath:"id"}).createIndex("addedAt","addedAt",{unique:!1}),i.objectStoreNames.contains("favorites_albums")||i.createObjectStore("favorites_albums",{keyPath:"id"}).createIndex("addedAt","addedAt",{unique:!1}),i.objectStoreNames.contains("favorites_artists")||i.createObjectStore("favorites_artists",{keyPath:"id"}).createIndex("addedAt","addedAt",{unique:!1}),i.objectStoreNames.contains("favorites_playlists")||i.createObjectStore("favorites_playlists",{keyPath:"uuid"}).createIndex("addedAt","addedAt",{unique:!1}),i.objectStoreNames.contains("favorites_mixes")||i.createObjectStore("favorites_mixes",{keyPath:"id"}).createIndex("addedAt","addedAt",{unique:!1}),i.objectStoreNames.contains("history_tracks")||i.createObjectStore("history_tracks",{keyPath:"timestamp"}).createIndex("timestamp","timestamp",{unique:!0}),i.objectStoreNames.contains("user_playlists")||i.createObjectStore("user_playlists",{keyPath:"id"}).createIndex("createdAt","createdAt",{unique:!1}),i.objectStoreNames.contains("user_folders")||i.createObjectStore("user_folders",{keyPath:"id"}).createIndex("createdAt","createdAt",{unique:!1}),i.objectStoreNames.contains("settings")||i.createObjectStore("settings"),i.objectStoreNames.contains("pinned_items")||i.createObjectStore("pinned_items",{keyPath:"id"}).createIndex("pinnedAt","pinnedAt",{unique:!1})}})}async performTransaction(e,t,n){const r=await this.open();return new Promise((i,c)=>{const h=r.transaction(e,t),f=h.objectStore(e),g=n(f);h.oncomplete=()=>{i(g?.result)},h.onerror=y=>{c(y.target.error)}})}async addToHistory(e){const t="history_tracks",n=this._minifyItem("track",e),r=Date.now(),i={...n,timestamp:r},c=await this.open();return new Promise((h,f)=>{const g=c.transaction(t,"readwrite"),y=g.objectStore(t),l=y.index("timestamp").openCursor(null,"prev");l.onsuccess=d=>{const m=d.target.result;m&&m.value.id===e.id&&y.delete(m.primaryKey),y.put(i)},l.onerror=d=>{y.put(i)},g.oncomplete=()=>h(i),g.onerror=d=>f(d.target.error)})}async getHistory(){const e="history_tracks",t=await this.open();return new Promise((n,r)=>{const f=t.transaction(e,"readonly").objectStore(e).index("timestamp").getAll();f.onsuccess=()=>{n(f.result.reverse())},f.onerror=()=>r(f.error)})}async clearHistory(){const e="history_tracks",t=await this.open();return new Promise((n,r)=>{const h=t.transaction(e,"readwrite").objectStore(e).clear();h.onsuccess=()=>n(),h.onerror=()=>r(h.error)})}async toggleFavorite(e,t){const r=`favorites_${e==="mix"?"mixes":`${e}s`}`,i=e==="playlist"?t.uuid:t.id;if(await this.isFavorite(e,i))return await this.performTransaction(r,"readwrite",h=>h.delete(i)),!1;{const f={...this._minifyItem(e,t),addedAt:Date.now()};return await this.performTransaction(r,"readwrite",g=>g.put(f)),!0}}async isFavorite(e,t){const r=`favorites_${e==="mix"?"mixes":`${e}s`}`;try{return!!await this.performTransaction(r,"readonly",c=>c.get(t))}catch{return!1}}async getFavorites(e){const n=`favorites_${e==="mix"?"mixes":`${e}s`}`,r=await this.open();return new Promise((i,c)=>{const g=r.transaction(n,"readonly").objectStore(n).getAll();g.onsuccess=()=>{const y=g.result;y.sort((u,l)=>{const d=u.addedAt||0;return(l.addedAt||0)-d}),i(y)},g.onerror=()=>c(g.error)})}_minifyItem(e,t){if(!t)return t;const n={id:t.id,addedAt:t.addedAt||null};return e==="track"?{...n,title:t.title||null,duration:t.duration||null,explicit:t.explicit||!1,artist:t.artist||(t.artists&&t.artists.length>0?t.artists[0]:null)||null,artists:t.artists?.map(r=>({id:r.id,name:r.name||null}))||[],album:t.album?{id:t.album.id,title:t.album.title||null,cover:t.album.cover||null,releaseDate:t.album.releaseDate||null,vibrantColor:t.album.vibrantColor||null,artist:t.album.artist||null,numberOfTracks:t.album.numberOfTracks||null,mediaMetadata:t.album.mediaMetadata?{tags:t.album.mediaMetadata.tags}:null}:null,copyright:t.copyright||null,isrc:t.isrc||null,trackNumber:t.trackNumber||null,streamStartDate:t.streamStartDate||null,version:t.version||null,mixes:t.mixes||null,isTracker:t.isTracker||t.id&&String(t.id).startsWith("tracker-"),trackerInfo:t.trackerInfo||null,audioUrl:t.remoteUrl||t.audioUrl||null,remoteUrl:t.remoteUrl||null,audioQuality:t.audioQuality||null,mediaMetadata:t.mediaMetadata?{tags:t.mediaMetadata.tags}:null}:e==="album"?{...n,title:t.title||null,cover:t.cover||null,releaseDate:t.releaseDate||null,explicit:t.explicit||!1,artist:t.artist?{name:t.artist.name||null,id:t.artist.id}:t.artists?.[0]?{name:t.artists[0].name||null,id:t.artists[0].id}:null,type:t.type||null,numberOfTracks:t.numberOfTracks||null}:e==="artist"?{...n,name:t.name||null,picture:t.picture||t.image||null}:e==="playlist"?{uuid:t.uuid||t.id,addedAt:t.addedAt||t.createdAt||null,title:t.title||t.name||null,image:t.image||t.squareImage||t.cover||null,numberOfTracks:t.numberOfTracks||(t.tracks?t.tracks.length:0),user:t.user?{name:t.user.name||null}:null}:e==="mix"?{id:t.id,addedAt:t.addedAt,title:t.title,subTitle:t.subTitle,description:t.description,mixType:t.mixType,cover:t.cover}:t}_minifyPinnedItem(e,t){if(!e)return null;const n=e.id||e.uuid;let r,i,c,h;switch(t){case"album":r=e.title,i=e.cover,c=`/album/${n}`;break;case"artist":r=e.name,i=e.picture,c=`/artist/${n}`;break;case"playlist":r=e.title||e.name,i=e.image||e.cover,c=`/playlist/${n}`;break;case"user-playlist":r=e.name,i=e.cover,h=e.images,c=`/userplaylist/${n}`;break;default:return null}return{id:n,type:t,name:r,cover:i,images:h,href:c}}async togglePinned(e,t){const n="pinned_items",r=this._minifyPinnedItem(e,t);if(!r)return;const i=r.id;if(await this.isPinned(i))return await this.performTransaction(n,"readwrite",h=>h.delete(i)),!1;{const h=await this.getPinned();if(h.length>=3){const g=h.sort((y,u)=>y.pinnedAt-u.pinnedAt)[0];await this.performTransaction(n,"readwrite",y=>y.delete(g.id))}const f={...r,pinnedAt:Date.now()};return await this.performTransaction(n,"readwrite",g=>g.put(f)),!0}}async isPinned(e){const t="pinned_items";try{return!!await this.performTransaction(t,"readonly",r=>r.get(e))}catch{return!1}}async exportData(){const e=await this.getFavorites("track"),t=await this.getFavorites("album"),n=await this.getFavorites("artist"),r=await this.getFavorites("playlist"),i=await this.getFavorites("mix"),c=await this.getHistory(),h=await this.getPlaylists(!0),f=await this.getFolders();return{favorites_tracks:e.map(y=>this._minifyItem("track",y)),favorites_albums:t.map(y=>this._minifyItem("album",y)),favorites_artists:n.map(y=>this._minifyItem("artist",y)),favorites_playlists:r.map(y=>this._minifyItem("playlist",y)),favorites_mixes:i.map(y=>this._minifyItem("mix",y)),history_tracks:c.map(y=>this._minifyItem("track",y)),user_playlists:h,user_folders:f}}async importData(e,t=!1){const n=await this.open(),r=async(c,h)=>{if(h===void 0)return!1;let f=Array.isArray(h)?h:Object.values(h||{});return console.log(`Importing to ${c}: ${f.length} items`),f.length===0?t?new Promise((g,y)=>{const u=n.transaction(c,"readwrite"),l=u.objectStore(c),d=l.count();d.onsuccess=()=>{d.result>0&&l.clear()},u.oncomplete=()=>{g(d.result>0)},u.onerror=()=>y(u.error)}):!1:new Promise((g,y)=>{const u=n.transaction(c,"readwrite"),l=u.objectStore(c);console.log(`Clearing ${c} to Make Sure Everythings Good`),l.clear(),f.forEach(d=>{d.id&&typeof d.id=="string"&&!isNaN(d.id)&&(d.id=parseInt(d.id,10)),d.album?.id&&typeof d.album.id=="string"&&!isNaN(d.album.id)&&(d.album.id=parseInt(d.album.id,10)),d.artists&&d.artists.forEach(E=>{E.id&&typeof E.id=="string"&&!isNaN(E.id)&&(E.id=parseInt(E.id,10))});const m=l.keyPath;m&&!d[m]&&(console.warn(`Item missing keyPath "${m}" in ${c}, generating fallback.`),m==="uuid"?d.uuid=crypto.randomUUID():m==="id"?d.id=d.trackId||d.albumId||d.artistId||Date.now()+Math.random():m==="timestamp"&&(d.timestamp=Date.now()+Math.random())),l.put(d)}),u.oncomplete=()=>{console.log(`${c}: Imported ${f.length} items`),g(!0)},u.onerror=d=>{console.error(`${c}: Transaction error:`,d.target.error),y(u.error)}})};console.log("Starting import with data:",{tracks:e.favorites_tracks?.length||0,albums:e.favorites_albums?.length||0,artists:e.favorites_artists?.length||0,playlists:e.favorites_playlists?.length||0,mixes:e.favorites_mixes?.length||0,history:e.history_tracks?.length||0,userPlaylists:e.user_playlists?.length||0,user_folders:e.user_folders?.length||0});const i=await Promise.all([r("favorites_tracks",e.favorites_tracks),r("favorites_albums",e.favorites_albums),r("favorites_artists",e.favorites_artists),r("favorites_playlists",e.favorites_playlists),r("favorites_mixes",e.favorites_mixes),r("history_tracks",e.history_tracks),e.user_playlists?r("user_playlists",e.user_playlists):Promise.resolve(!1),e.user_folders?r("user_folders",e.user_folders):Promise.resolve(!1)]);return console.log("Import results:",i),i.some(c=>c)}_updatePlaylistMetadata(e){if(e.numberOfTracks=e.tracks?e.tracks.length:0,!e.cover){const t=[],n=new Set,r=e.tracks||[];for(const i of r){const c=i.album?.cover;if(c&&!n.has(c)&&(n.add(c),t.push(c),t.length>=4))break}e.images=t}return e}_dispatchPlaylistSync(e,t){window.dispatchEvent(new CustomEvent("sync-playlist-change",{detail:{action:e,playlist:t}}))}async createPlaylist(e,t=[],n="",r=""){const c={id:crypto.randomUUID(),name:e,tracks:t.map(h=>this._minifyItem("track",{...h,addedAt:Date.now()})),cover:n,description:r,createdAt:Date.now(),updatedAt:Date.now(),numberOfTracks:t.length,images:[]};return this._updatePlaylistMetadata(c),await this.performTransaction("user_playlists","readwrite",h=>h.put(c)),this._dispatchPlaylistSync("create",c),c}async addTrackToPlaylist(e,t){const n=await this.performTransaction("user_playlists","readonly",c=>c.get(e));if(!n)throw new Error("Playlist not found");n.tracks=n.tracks||[];const r={...t,addedAt:Date.now()},i=this._minifyItem("track",r);if(!n.tracks.some(c=>c.id===t.id))return n.tracks.push(i),n.updatedAt=Date.now(),this._updatePlaylistMetadata(n),await this.performTransaction("user_playlists","readwrite",c=>c.put(n)),this._dispatchPlaylistSync("update",n),n}async addTracksToPlaylist(e,t){const n=await this.performTransaction("user_playlists","readonly",i=>i.get(e));if(!n)throw new Error("Playlist not found");n.tracks=n.tracks||[];let r=0;for(const i of t)if(!n.tracks.some(c=>c.id===i.id)){const c={...i,addedAt:Date.now()};n.tracks.push(this._minifyItem("track",c)),r++}return r>0&&(n.updatedAt=Date.now(),this._updatePlaylistMetadata(n),await this.performTransaction("user_playlists","readwrite",i=>i.put(n)),this._dispatchPlaylistSync("update",n)),n}async removeTrackFromPlaylist(e,t){const n=await this.performTransaction("user_playlists","readonly",r=>r.get(e));if(!n)throw new Error("Playlist not found");return n.tracks=n.tracks||[],n.tracks=n.tracks.filter(r=>r.id!=t),n.updatedAt=Date.now(),this._updatePlaylistMetadata(n),await this.performTransaction("user_playlists","readwrite",r=>r.put(n)),this._dispatchPlaylistSync("update",n),n}async deletePlaylist(e){await this.performTransaction("user_playlists","readwrite",t=>t.delete(e)),this._dispatchPlaylistSync("delete",{id:e})}async getPlaylist(e){return await this.performTransaction("user_playlists","readonly",t=>t.get(e))}async updatePlaylist(e){return e.updatedAt=Date.now(),this._updatePlaylistMetadata(e),await this.performTransaction("user_playlists","readwrite",t=>t.put(e)),this._dispatchPlaylistSync("update",e),e}async addPlaylistToFolder(e,t){const n=await this.getFolder(e);if(!n)throw new Error("Folder not found");return n.playlists=n.playlists||[],n.playlists.includes(t)||(n.playlists.push(t),n.updatedAt=Date.now(),await this.performTransaction("user_folders","readwrite",r=>r.put(n))),n}async createFolder(e,t=""){const r={id:crypto.randomUUID(),name:e,cover:t,playlists:[],createdAt:Date.now(),updatedAt:Date.now()};return await this.performTransaction("user_folders","readwrite",i=>i.put(r)),r}async getFolders(){const e=await this.open();return new Promise((t,n)=>{const h=e.transaction("user_folders","readonly").objectStore("user_folders").index("createdAt").getAll();h.onsuccess=()=>t(h.result.reverse()),h.onerror=()=>n(h.error)})}async getFolder(e){return await this.performTransaction("user_folders","readonly",t=>t.get(e))}async deleteFolder(e){await this.performTransaction("user_folders","readwrite",t=>t.delete(e))}async getPinned(){const e="pinned_items",t=await this.open();return new Promise((n,r)=>{const h=t.transaction(e,"readonly").objectStore(e).getAll();h.onsuccess=()=>{const f=h.result;f.sort((g,y)=>y.pinnedAt-g.pinnedAt),n(f)},h.onerror=()=>r(h.error)})}async getPlaylists(e=!1){const t=await this.open();return new Promise((n,r)=>{const c=t.transaction("user_playlists","readwrite").objectStore("user_playlists"),f=c.index("createdAt").getAll();f.onsuccess=()=>{const y=f.result.reverse().map(u=>{let l=!1;if(typeof u.numberOfTracks>"u"&&(u.numberOfTracks=u.tracks?u.tracks.length:0,l=!0),!u.cover&&(!u.images||u.images.length===0)&&(this._updatePlaylistMetadata(u),l=!0),l)try{c.put(u)}catch(E){console.warn("Failed to update playlist metadata",E)}if(e)return u;const{tracks:d,...m}=u;return m});n(y)},f.onerror=()=>r(f.error)})}async updatePlaylistName(e,t){const n=await this.performTransaction("user_playlists","readonly",r=>r.get(e));if(!n)throw new Error("Playlist not found");return n.name=t,n.updatedAt=Date.now(),await this.performTransaction("user_playlists","readwrite",r=>r.put(n)),n}async updatePlaylistDescription(e,t){const n=await this.performTransaction("user_playlists","readonly",r=>r.get(e));if(!n)throw new Error("Playlist not found");return n.description=t,n.updatedAt=Date.now(),await this.performTransaction("user_playlists","readwrite",r=>r.put(n)),this._dispatchPlaylistSync("update",n),n}async updatePlaylistTracks(e,t){const n=await this.open();return new Promise((r,i)=>{const c=n.transaction("user_playlists","readwrite"),h=c.objectStore("user_playlists"),f=h.get(e);f.onsuccess=()=>{const g=f.result;if(!g){i(new Error("Playlist not found"));return}g.tracks=t,g.updatedAt=Date.now(),this._updatePlaylistMetadata(g);const y=h.put(g);y.onsuccess=()=>{r(g)},y.onerror=()=>{i(y.error)}},f.onerror=()=>{i(f.error)},c.onerror=g=>{i(g.target.error)}})}async saveSetting(e,t){await this.performTransaction("settings","readwrite",n=>n.put(t,e))}async getSetting(e){return await this.performTransaction("settings","readonly",t=>t.get(e))}}const nn=new zy;function yd(o,e,t){o/=255,e/=255,t/=255;const n=Math.max(o,e,t),r=Math.min(o,e,t);let i,c,h=(n+r)/2;if(n===r)i=c=0;else{const f=n-r;switch(c=h>.5?f/(2-n-r):f/(n+r),n){case o:i=(e-t)/f+(e<t?6:0);break;case e:i=(t-o)/f+2;break;case t:i=(o-e)/f+4;break}i/=6}return[i,c,h]}function Uy(o,e,t){let n,r,i;if(e===0)n=r=i=t;else{const h=(y,u,l)=>(l<0&&(l+=1),l>1&&(l-=1),l<.16666666666666666?y+(u-y)*6*l:l<.5?u:l<.6666666666666666?y+(u-y)*(.6666666666666666-l)*6:y),f=t<.5?t*(1+e):t+e-t*e,g=2*t-f;n=h(g,f,o+1/3),r=h(g,f,o),i=h(g,f,o-1/3)}const c=h=>{const f=Math.round(h*255).toString(16);return f.length===1?"0"+f:f};return`#${c(n)}${c(r)}${c(i)}`}function By(o){const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)return null;const n=64;let r=o.naturalWidth||o.width,i=o.naturalHeight||o.height;if(r>n||i>n){const y=Math.min(n/r,n/i);r=Math.floor(r*y),i=Math.floor(i*y)}e.width=r,e.height=i,t.drawImage(o,0,0,r,i);const h=t.getImageData(0,0,r,i).data,f=[];for(let y=0;y<h.length;y+=4){const u=h[y],l=h[y+1],d=h[y+2];if(h[y+3]<125)continue;const[E,S,_]=yd(u,l,d);S>=.3&&_>=.3&&_<=.8&&f.push({r:u,g:l,b:d,h:E,s:S,l:_})}if(f.length===0)for(let y=0;y<h.length;y+=4){const u=h[y],l=h[y+1],d=h[y+2];if(h[y+3]<125)continue;const[E,S,_]=yd(u,l,d);_>.1&&_<.95&&f.push({r:u,g:l,b:d,h:E,s:S,l:_})}if(f.length===0)return null;f.sort((y,u)=>u.s-y.s||.5-Math.abs(y.l-.5)-(.5-Math.abs(u.l-.5)));const g=f[0];return Uy(g.h,g.s,g.l)}class Ta extends Error{constructor(e){super("ClientResponseError"),this.url="",this.status=0,this.response={},this.isAbort=!1,this.originalError=null,Object.setPrototypeOf(this,Ta.prototype),e!==null&&typeof e=="object"&&(this.originalError=e.originalError,this.url=typeof e.url=="string"?e.url:"",this.status=typeof e.status=="number"?e.status:0,this.isAbort=!!e.isAbort||e.name==="AbortError"||e.message==="Aborted",e.response!==null&&typeof e.response=="object"?this.response=e.response:e.data!==null&&typeof e.data=="object"?this.response=e.data:this.response={}),this.originalError||e instanceof Ta||(this.originalError=e),this.name="ClientResponseError "+this.status,this.message=this.response?.message,this.message||(this.isAbort?this.message="The request was aborted (most likely autocancelled; you can find more info in https://github.com/pocketbase/js-sdk#auto-cancellation).":this.originalError?.cause?.message?.includes("ECONNREFUSED ::1")?this.message="Failed to connect to the PocketBase server. Try changing the SDK URL from localhost to 127.0.0.1 (https://github.com/pocketbase/js-sdk/issues/21).":this.message="Something went wrong."),this.cause=this.originalError}get data(){return this.response}toJSON(){return{...this}}}const ys=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function Fy(o,e){const t={};if(typeof o!="string")return t;const n=Object.assign({},{}).decode||qy;let r=0;for(;r<o.length;){const i=o.indexOf("=",r);if(i===-1)break;let c=o.indexOf(";",r);if(c===-1)c=o.length;else if(c<i){r=o.lastIndexOf(";",i-1)+1;continue}const h=o.slice(r,i).trim();if(t[h]===void 0){let f=o.slice(i+1,c).trim();f.charCodeAt(0)===34&&(f=f.slice(1,-1));try{t[h]=n(f)}catch{t[h]=f}}r=c+1}return t}function bd(o,e,t){const n=Object.assign({},t||{}),r=n.encode||jy;if(!ys.test(o))throw new TypeError("argument name is invalid");const i=r(e);if(i&&!ys.test(i))throw new TypeError("argument val is invalid");let c=o+"="+i;if(n.maxAge!=null){const h=n.maxAge-0;if(isNaN(h)||!isFinite(h))throw new TypeError("option maxAge is invalid");c+="; Max-Age="+Math.floor(h)}if(n.domain){if(!ys.test(n.domain))throw new TypeError("option domain is invalid");c+="; Domain="+n.domain}if(n.path){if(!ys.test(n.path))throw new TypeError("option path is invalid");c+="; Path="+n.path}if(n.expires){if(!(function(f){return Object.prototype.toString.call(f)==="[object Date]"||f instanceof Date})(n.expires)||isNaN(n.expires.valueOf()))throw new TypeError("option expires is invalid");c+="; Expires="+n.expires.toUTCString()}if(n.httpOnly&&(c+="; HttpOnly"),n.secure&&(c+="; Secure"),n.priority)switch(typeof n.priority=="string"?n.priority.toLowerCase():n.priority){case"low":c+="; Priority=Low";break;case"medium":c+="; Priority=Medium";break;case"high":c+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(n.sameSite)switch(typeof n.sameSite=="string"?n.sameSite.toLowerCase():n.sameSite){case!0:c+="; SameSite=Strict";break;case"lax":c+="; SameSite=Lax";break;case"strict":c+="; SameSite=Strict";break;case"none":c+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return c}function qy(o){return o.indexOf("%")!==-1?decodeURIComponent(o):o}function jy(o){return encodeURIComponent(o)}const Hy=typeof navigator<"u"&&navigator.product==="ReactNative"||typeof global<"u"&&global.HermesInternal;let bf;function pi(o){if(o)try{const e=decodeURIComponent(bf(o.split(".")[1]).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join(""));return JSON.parse(e)||{}}catch{}return{}}function Ef(o,e=0){let t=pi(o);return!(Object.keys(t).length>0&&(!t.exp||t.exp-e>Date.now()/1e3))}bf=typeof atob!="function"||Hy?o=>{let e=String(o).replace(/=+$/,"");if(e.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,n,r=0,i=0,c="";n=e.charAt(i++);~n&&(t=r%4?64*t+n:n,r++%4)?c+=String.fromCharCode(255&t>>(-2*r&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return c}:atob;const Ed="pb_auth";class fl{constructor(){this.baseToken="",this.baseModel=null,this._onChangeCallbacks=[]}get token(){return this.baseToken}get record(){return this.baseModel}get model(){return this.baseModel}get isValid(){return!Ef(this.token)}get isSuperuser(){let e=pi(this.token);return e.type=="auth"&&(this.record?.collectionName=="_superusers"||!this.record?.collectionName&&e.collectionId=="pbc_3142635823")}get isAdmin(){return console.warn("Please replace pb.authStore.isAdmin with pb.authStore.isSuperuser OR simply check the value of pb.authStore.record?.collectionName"),this.isSuperuser}get isAuthRecord(){return console.warn("Please replace pb.authStore.isAuthRecord with !pb.authStore.isSuperuser OR simply check the value of pb.authStore.record?.collectionName"),pi(this.token).type=="auth"&&!this.isSuperuser}save(e,t){this.baseToken=e||"",this.baseModel=t||null,this.triggerChange()}clear(){this.baseToken="",this.baseModel=null,this.triggerChange()}loadFromCookie(e,t=Ed){const n=Fy(e||"")[t]||"";let r={};try{r=JSON.parse(n),(typeof r===null||typeof r!="object"||Array.isArray(r))&&(r={})}catch{}this.save(r.token||"",r.record||r.model||null)}exportToCookie(e,t=Ed){const n={secure:!0,sameSite:!0,httpOnly:!0,path:"/"},r=pi(this.token);n.expires=r?.exp?new Date(1e3*r.exp):new Date("1970-01-01"),e=Object.assign({},n,e);const i={token:this.token,record:this.record?JSON.parse(JSON.stringify(this.record)):null};let c=bd(t,JSON.stringify(i),e);const h=typeof Blob<"u"?new Blob([c]).size:c.length;if(i.record&&h>4096){i.record={id:i.record?.id,email:i.record?.email};const f=["collectionId","collectionName","verified"];for(const g in this.record)f.includes(g)&&(i.record[g]=this.record[g]);c=bd(t,JSON.stringify(i),e)}return c}onChange(e,t=!1){return this._onChangeCallbacks.push(e),t&&e(this.token,this.record),()=>{for(let n=this._onChangeCallbacks.length-1;n>=0;n--)if(this._onChangeCallbacks[n]==e)return delete this._onChangeCallbacks[n],void this._onChangeCallbacks.splice(n,1)}}triggerChange(){for(const e of this._onChangeCallbacks)e&&e(this.token,this.record)}}class Gy extends fl{constructor(e="pocketbase_auth"){super(),this.storageFallback={},this.storageKey=e,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get record(){const e=this._storageGet(this.storageKey)||{};return e.record||e.model||null}get model(){return this.record}save(e,t){this._storageSet(this.storageKey,{token:e,record:t}),super.save(e,t)}clear(){this._storageRemove(this.storageKey),super.clear()}_storageGet(e){if(typeof window<"u"&&window?.localStorage){const t=window.localStorage.getItem(e)||"";try{return JSON.parse(t)}catch{return t}}return this.storageFallback[e]}_storageSet(e,t){if(typeof window<"u"&&window?.localStorage){let n=t;typeof t!="string"&&(n=JSON.stringify(t)),window.localStorage.setItem(e,n)}else this.storageFallback[e]=t}_storageRemove(e){typeof window<"u"&&window?.localStorage&&window.localStorage?.removeItem(e),delete this.storageFallback[e]}_bindStorageEvent(){typeof window<"u"&&window?.localStorage&&window.addEventListener&&window.addEventListener("storage",(e=>{if(e.key!=this.storageKey)return;const t=this._storageGet(this.storageKey)||{};super.save(t.token||"",t.record||t.model||null)}))}}class Tr{constructor(e){this.client=e}}class Yy extends Tr{async getAll(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/settings",e)}async update(e,t){return t=Object.assign({method:"PATCH",body:e},t),this.client.send("/api/settings",t)}async testS3(e="storage",t){return t=Object.assign({method:"POST",body:{filesystem:e}},t),this.client.send("/api/settings/test/s3",t).then((()=>!0))}async testEmail(e,t,n,r){return r=Object.assign({method:"POST",body:{email:t,template:n,collection:e}},r),this.client.send("/api/settings/test/email",r).then((()=>!0))}async generateAppleClientSecret(e,t,n,r,i,c){return c=Object.assign({method:"POST",body:{clientId:e,teamId:t,keyId:n,privateKey:r,duration:i}},c),this.client.send("/api/settings/apple/generate-client-secret",c)}}const Ky=["requestKey","$cancelKey","$autoCancel","fetch","headers","body","query","params","cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","signal","window"];function hl(o){if(o){o.query=o.query||{};for(let e in o)Ky.includes(e)||(o.query[e]=o[e],delete o[e])}}function ml(o){const e=[];for(const t in o){const n=encodeURIComponent(t),r=Array.isArray(o[t])?o[t]:[o[t]];for(let i of r)i=$y(i),i!==null&&e.push(n+"="+i)}return e.join("&")}function $y(o){return o==null?null:o instanceof Date?encodeURIComponent(o.toISOString().replace("T"," ")):encodeURIComponent(typeof o=="object"?JSON.stringify(o):o)}class vf extends Tr{constructor(){super(...arguments),this.clientId="",this.eventSource=null,this.subscriptions={},this.lastSentSubscriptions=[],this.maxConnectTimeout=15e3,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.predefinedReconnectIntervals=[200,300,500,1e3,1200,1500,2e3],this.pendingConnects=[]}get isConnected(){return!!this.eventSource&&!!this.clientId&&!this.pendingConnects.length}async subscribe(e,t,n){if(!e)throw new Error("topic must be set.");let r=e;if(n){hl(n=Object.assign({},n));const c="options="+encodeURIComponent(JSON.stringify({query:n.query,headers:n.headers}));r+=(r.includes("?")?"&":"?")+c}const i=function(c){const h=c;let f;try{f=JSON.parse(h?.data)}catch{}t(f||{})};return this.subscriptions[r]||(this.subscriptions[r]=[]),this.subscriptions[r].push(i),this.isConnected?this.subscriptions[r].length===1?await this.submitSubscriptions():this.eventSource?.addEventListener(r,i):await this.connect(),async()=>this.unsubscribeByTopicAndListener(e,i)}async unsubscribe(e){let t=!1;if(e){const n=this.getSubscriptionsByTopic(e);for(let r in n)if(this.hasSubscriptionListeners(r)){for(let i of this.subscriptions[r])this.eventSource?.removeEventListener(r,i);delete this.subscriptions[r],t||(t=!0)}}else this.subscriptions={};this.hasSubscriptionListeners()?t&&await this.submitSubscriptions():this.disconnect()}async unsubscribeByPrefix(e){let t=!1;for(let n in this.subscriptions)if((n+"?").startsWith(e)){t=!0;for(let r of this.subscriptions[n])this.eventSource?.removeEventListener(n,r);delete this.subscriptions[n]}t&&(this.hasSubscriptionListeners()?await this.submitSubscriptions():this.disconnect())}async unsubscribeByTopicAndListener(e,t){let n=!1;const r=this.getSubscriptionsByTopic(e);for(let i in r){if(!Array.isArray(this.subscriptions[i])||!this.subscriptions[i].length)continue;let c=!1;for(let h=this.subscriptions[i].length-1;h>=0;h--)this.subscriptions[i][h]===t&&(c=!0,delete this.subscriptions[i][h],this.subscriptions[i].splice(h,1),this.eventSource?.removeEventListener(i,t));c&&(this.subscriptions[i].length||delete this.subscriptions[i],n||this.hasSubscriptionListeners(i)||(n=!0))}this.hasSubscriptionListeners()?n&&await this.submitSubscriptions():this.disconnect()}hasSubscriptionListeners(e){if(this.subscriptions=this.subscriptions||{},e)return!!this.subscriptions[e]?.length;for(let t in this.subscriptions)if(this.subscriptions[t]?.length)return!0;return!1}async submitSubscriptions(){if(this.clientId)return this.addAllSubscriptionListeners(),this.lastSentSubscriptions=this.getNonEmptySubscriptionKeys(),this.client.send("/api/realtime",{method:"POST",body:{clientId:this.clientId,subscriptions:this.lastSentSubscriptions},requestKey:this.getSubscriptionsCancelKey()}).catch((e=>{if(!e?.isAbort)throw e}))}getSubscriptionsCancelKey(){return"realtime_"+this.clientId}getSubscriptionsByTopic(e){const t={};e=e.includes("?")?e:e+"?";for(let n in this.subscriptions)(n+"?").startsWith(e)&&(t[n]=this.subscriptions[n]);return t}getNonEmptySubscriptionKeys(){const e=[];for(let t in this.subscriptions)this.subscriptions[t].length&&e.push(t);return e}addAllSubscriptionListeners(){if(this.eventSource){this.removeAllSubscriptionListeners();for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.addEventListener(e,t)}}removeAllSubscriptionListeners(){if(this.eventSource)for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.removeEventListener(e,t)}async connect(){if(!(this.reconnectAttempts>0))return new Promise(((e,t)=>{this.pendingConnects.push({resolve:e,reject:t}),this.pendingConnects.length>1||this.initConnect()}))}initConnect(){this.disconnect(!0),clearTimeout(this.connectTimeoutId),this.connectTimeoutId=setTimeout((()=>{this.connectErrorHandler(new Error("EventSource connect took too long."))}),this.maxConnectTimeout),this.eventSource=new EventSource(this.client.buildURL("/api/realtime")),this.eventSource.onerror=e=>{this.connectErrorHandler(new Error("Failed to establish realtime connection."))},this.eventSource.addEventListener("PB_CONNECT",(e=>{const t=e;this.clientId=t?.lastEventId,this.submitSubscriptions().then((async()=>{let n=3;for(;this.hasUnsentSubscriptions()&&n>0;)n--,await this.submitSubscriptions()})).then((()=>{for(let r of this.pendingConnects)r.resolve();this.pendingConnects=[],this.reconnectAttempts=0,clearTimeout(this.reconnectTimeoutId),clearTimeout(this.connectTimeoutId);const n=this.getSubscriptionsByTopic("PB_CONNECT");for(let r in n)for(let i of n[r])i(e)})).catch((n=>{this.clientId="",this.connectErrorHandler(n)}))}))}hasUnsentSubscriptions(){const e=this.getNonEmptySubscriptionKeys();if(e.length!=this.lastSentSubscriptions.length)return!0;for(const t of e)if(!this.lastSentSubscriptions.includes(t))return!0;return!1}connectErrorHandler(e){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),!this.clientId&&!this.reconnectAttempts||this.reconnectAttempts>this.maxReconnectAttempts){for(let n of this.pendingConnects)n.reject(new Ta(e));return this.pendingConnects=[],void this.disconnect()}this.disconnect(!0);const t=this.predefinedReconnectIntervals[this.reconnectAttempts]||this.predefinedReconnectIntervals[this.predefinedReconnectIntervals.length-1];this.reconnectAttempts++,this.reconnectTimeoutId=setTimeout((()=>{this.initConnect()}),t)}disconnect(e=!1){if(this.clientId&&this.onDisconnect&&this.onDisconnect(Object.keys(this.subscriptions)),clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),this.removeAllSubscriptionListeners(),this.client.cancelRequest(this.getSubscriptionsCancelKey()),this.eventSource?.close(),this.eventSource=null,this.clientId="",!e){this.reconnectAttempts=0;for(let t of this.pendingConnects)t.resolve();this.pendingConnects=[]}}}class Tf extends Tr{decode(e){return e}async getFullList(e,t){if(typeof e=="number")return this._getFullList(e,t);let n=1e3;return(t=Object.assign({},e,t)).batch&&(n=t.batch,delete t.batch),this._getFullList(n,t)}async getList(e=1,t=30,n){return(n=Object.assign({method:"GET"},n)).query=Object.assign({page:e,perPage:t},n.query),this.client.send(this.baseCrudPath,n).then((r=>(r.items=r.items?.map((i=>this.decode(i)))||[],r)))}async getFirstListItem(e,t){return(t=Object.assign({requestKey:"one_by_filter_"+this.baseCrudPath+"_"+e},t)).query=Object.assign({filter:e,skipTotal:1},t.query),this.getList(1,1,t).then((n=>{if(!n?.items?.length)throw new Ta({status:404,response:{code:404,message:"The requested resource wasn't found.",data:{}}});return n.items[0]}))}async getOne(e,t){if(!e)throw new Ta({url:this.client.buildURL(this.baseCrudPath+"/"),status:404,response:{code:404,message:"Missing required record id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then((n=>this.decode(n)))}async create(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send(this.baseCrudPath,t).then((n=>this.decode(n)))}async update(e,t,n){return n=Object.assign({method:"PATCH",body:t},n),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),n).then((r=>this.decode(r)))}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then((()=>!0))}_getFullList(e=1e3,t){(t=t||{}).query=Object.assign({skipTotal:1},t.query);let n=[],r=async i=>this.getList(i,e||1e3,t).then((c=>{const h=c.items;return n=n.concat(h),h.length==c.perPage?r(i+1):n}));return r(1)}}function Pr(o,e,t,n){const r=n!==void 0;return r||t!==void 0?r?(console.warn(o),e.body=Object.assign({},e.body,t),e.query=Object.assign({},e.query,n),e):Object.assign(e,t):e}function Mo(o){o._resetAutoRefresh?.()}class Vy extends Tf{constructor(e,t){super(e),this.collectionIdOrName=t}get baseCrudPath(){return this.baseCollectionPath+"/records"}get baseCollectionPath(){return"/api/collections/"+encodeURIComponent(this.collectionIdOrName)}get isSuperusers(){return this.collectionIdOrName=="_superusers"||this.collectionIdOrName=="_pbc_2773867675"}async subscribe(e,t,n){if(!e)throw new Error("Missing topic.");if(!t)throw new Error("Missing subscription callback.");return this.client.realtime.subscribe(this.collectionIdOrName+"/"+e,t,n)}async unsubscribe(e){return e?this.client.realtime.unsubscribe(this.collectionIdOrName+"/"+e):this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)}async getFullList(e,t){if(typeof e=="number")return super.getFullList(e,t);const n=Object.assign({},e,t);return super.getFullList(n)}async getList(e=1,t=30,n){return super.getList(e,t,n)}async getFirstListItem(e,t){return super.getFirstListItem(e,t)}async getOne(e,t){return super.getOne(e,t)}async create(e,t){return super.create(e,t)}async update(e,t,n){return super.update(e,t,n).then((r=>{if(this.client.authStore.record?.id===r?.id&&(this.client.authStore.record?.collectionId===this.collectionIdOrName||this.client.authStore.record?.collectionName===this.collectionIdOrName)){let i=Object.assign({},this.client.authStore.record.expand),c=Object.assign({},this.client.authStore.record,r);i&&(c.expand=Object.assign(i,r.expand)),this.client.authStore.save(this.client.authStore.token,c)}return r}))}async delete(e,t){return super.delete(e,t).then((n=>(!n||this.client.authStore.record?.id!==e||this.client.authStore.record?.collectionId!==this.collectionIdOrName&&this.client.authStore.record?.collectionName!==this.collectionIdOrName||this.client.authStore.clear(),n)))}authResponse(e){const t=this.decode(e?.record||{});return this.client.authStore.save(e?.token,t),Object.assign({},e,{token:e?.token||"",record:t})}async listAuthMethods(e){return e=Object.assign({method:"GET",fields:"mfa,otp,password,oauth2"},e),this.client.send(this.baseCollectionPath+"/auth-methods",e)}async authWithPassword(e,t,n){let r;n=Object.assign({method:"POST",body:{identity:e,password:t}},n),this.isSuperusers&&(r=n.autoRefreshThreshold,delete n.autoRefreshThreshold,n.autoRefresh||Mo(this.client));let i=await this.client.send(this.baseCollectionPath+"/auth-with-password",n);return i=this.authResponse(i),r&&this.isSuperusers&&(function(h,f,g,y){Mo(h);const u=h.beforeSend,l=h.authStore.record,d=h.authStore.onChange(((m,E)=>{(!m||E?.id!=l?.id||(E?.collectionId||l?.collectionId)&&E?.collectionId!=l?.collectionId)&&Mo(h)}));h._resetAutoRefresh=function(){d(),h.beforeSend=u,delete h._resetAutoRefresh},h.beforeSend=async(m,E)=>{const S=h.authStore.token;if(E.query?.autoRefresh)return u?u(m,E):{url:m,sendOptions:E};let _=h.authStore.isValid;if(_&&Ef(h.authStore.token,f))try{await g()}catch{_=!1}_||await y();const M=E.headers||{};for(let R in M)if(R.toLowerCase()=="authorization"&&S==M[R]&&h.authStore.token){M[R]=h.authStore.token;break}return E.headers=M,u?u(m,E):{url:m,sendOptions:E}}})(this.client,r,(()=>this.authRefresh({autoRefresh:!0})),(()=>this.authWithPassword(e,t,Object.assign({autoRefresh:!0},n)))),i}async authWithOAuth2Code(e,t,n,r,i,c,h){let f={method:"POST",body:{provider:e,code:t,codeVerifier:n,redirectURL:r,createData:i}};return f=Pr("This form of authWithOAuth2Code(provider, code, codeVerifier, redirectURL, createData?, body?, query?) is deprecated. Consider replacing it with authWithOAuth2Code(provider, code, codeVerifier, redirectURL, createData?, options?).",f,c,h),this.client.send(this.baseCollectionPath+"/auth-with-oauth2",f).then((g=>this.authResponse(g)))}authWithOAuth2(...e){if(e.length>1||typeof e?.[0]=="string")return console.warn("PocketBase: This form of authWithOAuth2() is deprecated and may get removed in the future. Please replace with authWithOAuth2Code() OR use the authWithOAuth2() realtime form as shown in https://pocketbase.io/docs/authentication/#oauth2-integration."),this.authWithOAuth2Code(e?.[0]||"",e?.[1]||"",e?.[2]||"",e?.[3]||"",e?.[4]||{},e?.[5]||{},e?.[6]||{});const t=e?.[0]||{};let n=null;t.urlCallback||(n=vd(void 0));const r=new vf(this.client);function i(){n?.close(),r.unsubscribe()}const c={},h=t.requestKey;return h&&(c.requestKey=h),this.listAuthMethods(c).then((f=>{const g=f.oauth2.providers.find((u=>u.name===t.provider));if(!g)throw new Ta(new Error(`Missing or invalid provider "${t.provider}".`));const y=this.client.buildURL("/api/oauth2-redirect");return new Promise((async(u,l)=>{const d=h?this.client.cancelControllers?.[h]:void 0;d&&(d.signal.onabort=()=>{i(),l(new Ta({isAbort:!0,message:"manually cancelled"}))}),r.onDisconnect=m=>{m.length&&l&&(i(),l(new Ta(new Error("realtime connection interrupted"))))};try{await r.subscribe("@oauth2",(async _=>{const M=r.clientId;try{if(!_.state||M!==_.state)throw new Error("State parameters don't match.");if(_.error||!_.code)throw new Error("OAuth2 redirect error or missing code: "+_.error);const R=Object.assign({},t);delete R.provider,delete R.scopes,delete R.createData,delete R.urlCallback,d?.signal?.onabort&&(d.signal.onabort=null);const W=await this.authWithOAuth2Code(g.name,_.code,g.codeVerifier,y,t.createData,R);u(W)}catch(R){l(new Ta(R))}i()}));const m={state:r.clientId};t.scopes?.length&&(m.scope=t.scopes.join(" "));const E=this._replaceQueryParams(g.authURL+y,m);await(t.urlCallback||function(_){n?n.location.href=_:n=vd(_)})(E)}catch(m){d?.signal?.onabort&&(d.signal.onabort=null),i(),l(new Ta(m))}}))})).catch((f=>{throw i(),f}))}async authRefresh(e,t){let n={method:"POST"};return n=Pr("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",n,e,t),this.client.send(this.baseCollectionPath+"/auth-refresh",n).then((r=>this.authResponse(r)))}async requestPasswordReset(e,t,n){let r={method:"POST",body:{email:e}};return r=Pr("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",r,t,n),this.client.send(this.baseCollectionPath+"/request-password-reset",r).then((()=>!0))}async confirmPasswordReset(e,t,n,r,i){let c={method:"POST",body:{token:e,password:t,passwordConfirm:n}};return c=Pr("This form of confirmPasswordReset(token, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(token, password, passwordConfirm, options?).",c,r,i),this.client.send(this.baseCollectionPath+"/confirm-password-reset",c).then((()=>!0))}async requestVerification(e,t,n){let r={method:"POST",body:{email:e}};return r=Pr("This form of requestVerification(email, body?, query?) is deprecated. Consider replacing it with requestVerification(email, options?).",r,t,n),this.client.send(this.baseCollectionPath+"/request-verification",r).then((()=>!0))}async confirmVerification(e,t,n){let r={method:"POST",body:{token:e}};return r=Pr("This form of confirmVerification(token, body?, query?) is deprecated. Consider replacing it with confirmVerification(token, options?).",r,t,n),this.client.send(this.baseCollectionPath+"/confirm-verification",r).then((()=>{const i=pi(e),c=this.client.authStore.record;return c&&!c.verified&&c.id===i.id&&c.collectionId===i.collectionId&&(c.verified=!0,this.client.authStore.save(this.client.authStore.token,c)),!0}))}async requestEmailChange(e,t,n){let r={method:"POST",body:{newEmail:e}};return r=Pr("This form of requestEmailChange(newEmail, body?, query?) is deprecated. Consider replacing it with requestEmailChange(newEmail, options?).",r,t,n),this.client.send(this.baseCollectionPath+"/request-email-change",r).then((()=>!0))}async confirmEmailChange(e,t,n,r){let i={method:"POST",body:{token:e,password:t}};return i=Pr("This form of confirmEmailChange(token, password, body?, query?) is deprecated. Consider replacing it with confirmEmailChange(token, password, options?).",i,n,r),this.client.send(this.baseCollectionPath+"/confirm-email-change",i).then((()=>{const c=pi(e),h=this.client.authStore.record;return h&&h.id===c.id&&h.collectionId===c.collectionId&&this.client.authStore.clear(),!0}))}async listExternalAuths(e,t){return this.client.collection("_externalAuths").getFullList(Object.assign({},t,{filter:this.client.filter("recordRef = {:id}",{id:e})}))}async unlinkExternalAuth(e,t,n){const r=await this.client.collection("_externalAuths").getFirstListItem(this.client.filter("recordRef = {:recordId} && provider = {:provider}",{recordId:e,provider:t}));return this.client.collection("_externalAuths").delete(r.id,n).then((()=>!0))}async requestOTP(e,t){return t=Object.assign({method:"POST",body:{email:e}},t),this.client.send(this.baseCollectionPath+"/request-otp",t)}async authWithOTP(e,t,n){return n=Object.assign({method:"POST",body:{otpId:e,password:t}},n),this.client.send(this.baseCollectionPath+"/auth-with-otp",n).then((r=>this.authResponse(r)))}async impersonate(e,t,n){(n=Object.assign({method:"POST",body:{duration:t}},n)).headers=n.headers||{},n.headers.Authorization||(n.headers.Authorization=this.client.authStore.token);const r=new wf(this.client.baseURL,new fl,this.client.lang),i=await r.send(this.baseCollectionPath+"/impersonate/"+encodeURIComponent(e),n);return r.authStore.save(i?.token,this.decode(i?.record||{})),r}_replaceQueryParams(e,t={}){let n=e,r="";e.indexOf("?")>=0&&(n=e.substring(0,e.indexOf("?")),r=e.substring(e.indexOf("?")+1));const i={},c=r.split("&");for(const h of c){if(h=="")continue;const f=h.split("=");i[decodeURIComponent(f[0].replace(/\+/g," "))]=decodeURIComponent((f[1]||"").replace(/\+/g," "))}for(let h in t)t.hasOwnProperty(h)&&(t[h]==null?delete i[h]:i[h]=t[h]);r="";for(let h in i)i.hasOwnProperty(h)&&(r!=""&&(r+="&"),r+=encodeURIComponent(h.replace(/%20/g,"+"))+"="+encodeURIComponent(i[h].replace(/%20/g,"+")));return r!=""?n+"?"+r:n}}function vd(o){if(typeof window>"u"||!window?.open)throw new Ta(new Error("Not in a browser context - please pass a custom urlCallback function."));let e=1024,t=768,n=window.innerWidth,r=window.innerHeight;e=e>n?n:e,t=t>r?r:t;let i=n/2-e/2,c=r/2-t/2;return window.open(o,"popup_window","width="+e+",height="+t+",top="+c+",left="+i+",resizable,menubar=no")}class Wy extends Tf{get baseCrudPath(){return"/api/collections"}async import(e,t=!1,n){return n=Object.assign({method:"PUT",body:{collections:e,deleteMissing:t}},n),this.client.send(this.baseCrudPath+"/import",n).then((()=>!0))}async getScaffolds(e){return e=Object.assign({method:"GET"},e),this.client.send(this.baseCrudPath+"/meta/scaffolds",e)}async truncate(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/truncate",t).then((()=>!0))}}class Qy extends Tr{async getList(e=1,t=30,n){return(n=Object.assign({method:"GET"},n)).query=Object.assign({page:e,perPage:t},n.query),this.client.send("/api/logs",n)}async getOne(e,t){if(!e)throw new Ta({url:this.client.buildURL("/api/logs/"),status:404,response:{code:404,message:"Missing required log id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send("/api/logs/"+encodeURIComponent(e),t)}async getStats(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/logs/stats",e)}}class Xy extends Tr{async check(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/health",e)}}class Jy extends Tr{getUrl(e,t,n={}){return console.warn("Please replace pb.files.getUrl() with pb.files.getURL()"),this.getURL(e,t,n)}getURL(e,t,n={}){if(!t||!e?.id||!e?.collectionId&&!e?.collectionName)return"";const r=[];r.push("api"),r.push("files"),r.push(encodeURIComponent(e.collectionId||e.collectionName)),r.push(encodeURIComponent(e.id)),r.push(encodeURIComponent(t));let i=this.client.buildURL(r.join("/"));n.download===!1&&delete n.download;const c=ml(n);return c&&(i+=(i.includes("?")?"&":"?")+c),i}async getToken(e){return e=Object.assign({method:"POST"},e),this.client.send("/api/files/token",e).then((t=>t?.token||""))}}class Zy extends Tr{async getFullList(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/backups",e)}async create(e,t){return t=Object.assign({method:"POST",body:{name:e}},t),this.client.send("/api/backups",t).then((()=>!0))}async upload(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send("/api/backups/upload",t).then((()=>!0))}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}`,t).then((()=>!0))}async restore(e,t){return t=Object.assign({method:"POST"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}/restore`,t).then((()=>!0))}getDownloadUrl(e,t){return console.warn("Please replace pb.backups.getDownloadUrl() with pb.backups.getDownloadURL()"),this.getDownloadURL(e,t)}getDownloadURL(e,t){return this.client.buildURL(`/api/backups/${encodeURIComponent(t)}?token=${encodeURIComponent(e)}`)}}class eb extends Tr{async getFullList(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/crons",e)}async run(e,t){return t=Object.assign({method:"POST"},t),this.client.send(`/api/crons/${encodeURIComponent(e)}`,t).then((()=>!0))}}function Jo(o){return typeof Blob<"u"&&o instanceof Blob||typeof File<"u"&&o instanceof File||o!==null&&typeof o=="object"&&o.uri&&(typeof navigator<"u"&&navigator.product==="ReactNative"||typeof global<"u"&&global.HermesInternal)}function Zo(o){return o&&(o.constructor?.name==="FormData"||typeof FormData<"u"&&o instanceof FormData)}function Td(o){for(const e in o){const t=Array.isArray(o[e])?o[e]:[o[e]];for(const n of t)if(Jo(n))return!0}return!1}const tb=/^[\-\.\d]+$/;function wd(o){if(typeof o!="string")return o;if(o=="true")return!0;if(o=="false")return!1;if((o[0]==="-"||o[0]>="0"&&o[0]<="9")&&tb.test(o)){let e=+o;if(""+e===o)return e}return o}class nb extends Tr{constructor(){super(...arguments),this.requests=[],this.subs={}}collection(e){return this.subs[e]||(this.subs[e]=new ab(this.requests,e)),this.subs[e]}async send(e){const t=new FormData,n=[];for(let r=0;r<this.requests.length;r++){const i=this.requests[r];if(n.push({method:i.method,url:i.url,headers:i.headers,body:i.json}),i.files)for(let c in i.files){const h=i.files[c]||[];for(let f of h)t.append("requests."+r+"."+c,f)}}return t.append("@jsonPayload",JSON.stringify({requests:n})),e=Object.assign({method:"POST",body:t},e),this.client.send("/api/batch",e)}}class ab{constructor(e,t){this.requests=[],this.requests=e,this.collectionIdOrName=t}upsert(e,t){t=Object.assign({body:e||{}},t);const n={method:"PUT",url:"/api/collections/"+encodeURIComponent(this.collectionIdOrName)+"/records"};this.prepareRequest(n,t),this.requests.push(n)}create(e,t){t=Object.assign({body:e||{}},t);const n={method:"POST",url:"/api/collections/"+encodeURIComponent(this.collectionIdOrName)+"/records"};this.prepareRequest(n,t),this.requests.push(n)}update(e,t,n){n=Object.assign({body:t||{}},n);const r={method:"PATCH",url:"/api/collections/"+encodeURIComponent(this.collectionIdOrName)+"/records/"+encodeURIComponent(e)};this.prepareRequest(r,n),this.requests.push(r)}delete(e,t){t=Object.assign({},t);const n={method:"DELETE",url:"/api/collections/"+encodeURIComponent(this.collectionIdOrName)+"/records/"+encodeURIComponent(e)};this.prepareRequest(n,t),this.requests.push(n)}prepareRequest(e,t){if(hl(t),e.headers=t.headers,e.json={},e.files={},t.query!==void 0){const r=ml(t.query);r&&(e.url+=(e.url.includes("?")?"&":"?")+r)}let n=t.body;Zo(n)&&(n=(function(i){let c={};return i.forEach(((h,f)=>{if(f==="@jsonPayload"&&typeof h=="string")try{let g=JSON.parse(h);Object.assign(c,g)}catch(g){console.warn("@jsonPayload error:",g)}else c[f]!==void 0?(Array.isArray(c[f])||(c[f]=[c[f]]),c[f].push(wd(h))):c[f]=wd(h)})),c})(n));for(const r in n){const i=n[r];if(Jo(i))e.files[r]=e.files[r]||[],e.files[r].push(i);else if(Array.isArray(i)){const c=[],h=[];for(const f of i)Jo(f)?c.push(f):h.push(f);if(c.length>0&&c.length==i.length){e.files[r]=e.files[r]||[];for(let f of c)e.files[r].push(f)}else if(e.json[r]=h,c.length>0){let f=r;r.startsWith("+")||r.endsWith("+")||(f+="+"),e.files[f]=e.files[f]||[];for(let g of c)e.files[f].push(g)}}else e.json[r]=i}}}class wf{get baseUrl(){return this.baseURL}set baseUrl(e){this.baseURL=e}constructor(e="/",t,n="en-US"){this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseURL=e,this.lang=n,t?this.authStore=t:typeof window<"u"&&window.Deno?this.authStore=new fl:this.authStore=new Gy,this.collections=new Wy(this),this.files=new Jy(this),this.logs=new Qy(this),this.settings=new Yy(this),this.realtime=new vf(this),this.health=new Xy(this),this.backups=new Zy(this),this.crons=new eb(this)}get admins(){return this.collection("_superusers")}createBatch(){return new nb(this)}collection(e){return this.recordServices[e]||(this.recordServices[e]=new Vy(this,e)),this.recordServices[e]}autoCancellation(e){return this.enableAutoCancellation=!!e,this}cancelRequest(e){return this.cancelControllers[e]&&(this.cancelControllers[e].abort(),delete this.cancelControllers[e]),this}cancelAllRequests(){for(let e in this.cancelControllers)this.cancelControllers[e].abort();return this.cancelControllers={},this}filter(e,t){if(!t)return e;for(let n in t){let r=t[n];switch(typeof r){case"boolean":case"number":r=""+r;break;case"string":r="'"+r.replace(/'/g,"\\'")+"'";break;default:r=r===null?"null":r instanceof Date?"'"+r.toISOString().replace("T"," ")+"'":"'"+JSON.stringify(r).replace(/'/g,"\\'")+"'"}e=e.replaceAll("{:"+n+"}",r)}return e}getFileUrl(e,t,n={}){return console.warn("Please replace pb.getFileUrl() with pb.files.getURL()"),this.files.getURL(e,t,n)}buildUrl(e){return console.warn("Please replace pb.buildUrl() with pb.buildURL()"),this.buildURL(e)}buildURL(e){let t=this.baseURL;return typeof window>"u"||!window.location||t.startsWith("https://")||t.startsWith("http://")||(t=window.location.origin?.endsWith("/")?window.location.origin.substring(0,window.location.origin.length-1):window.location.origin||"",this.baseURL.startsWith("/")||(t+=window.location.pathname||"/",t+=t.endsWith("/")?"":"/"),t+=this.baseURL),e&&(t+=t.endsWith("/")?"":"/",t+=e.startsWith("/")?e.substring(1):e),t}async send(e,t){t=this.initSendOptions(e,t);let n=this.buildURL(e);if(this.beforeSend){const r=Object.assign({},await this.beforeSend(n,t));r.url!==void 0||r.options!==void 0?(n=r.url||n,t=r.options||t):Object.keys(r).length&&(t=r,console?.warn&&console.warn("Deprecated format of beforeSend return: please use `return { url, options }`, instead of `return options`."))}if(t.query!==void 0){const r=ml(t.query);r&&(n+=(n.includes("?")?"&":"?")+r),delete t.query}return this.getHeader(t.headers,"Content-Type")=="application/json"&&t.body&&typeof t.body!="string"&&(t.body=JSON.stringify(t.body)),(t.fetch||fetch)(n,t).then((async r=>{let i={};try{i=await r.json()}catch(c){if(t.signal?.aborted||c?.name=="AbortError"||c?.message=="Aborted")throw c}if(this.afterSend&&(i=await this.afterSend(r,i,t)),r.status>=400)throw new Ta({url:r.url,status:r.status,data:i});return i})).catch((r=>{throw new Ta(r)}))}initSendOptions(e,t){if((t=Object.assign({method:"GET"},t)).body=(function(r){if(typeof FormData>"u"||r===void 0||typeof r!="object"||r===null||Zo(r)||!Td(r))return r;const i=new FormData;for(const c in r){const h=r[c];if(h!==void 0)if(typeof h!="object"||Td({data:h})){const f=Array.isArray(h)?h:[h];for(let g of f)i.append(c,g)}else{let f={};f[c]=h,i.append("@jsonPayload",JSON.stringify(f))}}return i})(t.body),hl(t),t.query=Object.assign({},t.params,t.query),t.requestKey===void 0&&(t.$autoCancel===!1||t.query.$autoCancel===!1?t.requestKey=null:(t.$cancelKey||t.query.$cancelKey)&&(t.requestKey=t.$cancelKey||t.query.$cancelKey)),delete t.$autoCancel,delete t.query.$autoCancel,delete t.$cancelKey,delete t.query.$cancelKey,this.getHeader(t.headers,"Content-Type")!==null||Zo(t.body)||(t.headers=Object.assign({},t.headers,{"Content-Type":"application/json"})),this.getHeader(t.headers,"Accept-Language")===null&&(t.headers=Object.assign({},t.headers,{"Accept-Language":this.lang})),this.authStore.token&&this.getHeader(t.headers,"Authorization")===null&&(t.headers=Object.assign({},t.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&t.requestKey!==null){const n=t.requestKey||(t.method||"GET")+e;delete t.requestKey,this.cancelRequest(n);const r=new AbortController;this.cancelControllers[n]=r,t.signal=r.signal}return t}getHeader(e,t){e=e||{},t=t.toLowerCase();for(let n in e)if(n.toLowerCase()==t)return e[n];return null}}let Do=null,Ea=null,rb=null,el=null;const gl="monochrome-firebase-config",ib={apiKey:"AIzaSyDPU-unAjuLtQJt4IkGS5faG50UCF7lYyA",authDomain:"monochrome-database.firebaseapp.com",projectId:"monochrome-database",storageBucket:"monochrome-database.firebasestorage.app",messagingSenderId:"895657412760",appId:"1:895657412760:web:e81c5044c7f4e9b799e8ed"};function sb(){try{const o=localStorage.getItem(gl);return o?JSON.parse(o):null}catch(o){return console.warn("Failed to parse Firebase config from storage",o),null}}const _f=sb(),_d=window.__FIREBASE_CONFIG__||_f||ib;if(_d)try{Do=Cg(_d),Ea=Lg(Do),rb=qg(Do),el=new Pg,console.log("Firebase initialized from "+(_f?"saved":"default")+" config")}catch(o){console.error("Error initializing Firebase:",o)}else console.log("No Firebase config found.");function ZE(o){o&&localStorage.setItem(gl,JSON.stringify(o))}function ev(){localStorage.removeItem(gl)}class ob{constructor(){this.user=null,this.unsubscribe=null,this.authListeners=[],this.init()}init(){Ea&&(this.unsubscribe=Ng(Ea,e=>{this.user=e,this.updateUI(e),this.authListeners.forEach(t=>t(e))}),Mg(Ea).catch(e=>{console.error("Redirect Login failed:",e),alert(`Login failed: ${e.message}`)}))}onAuthStateChanged(e){this.authListeners.push(e),this.user!==null&&e(this.user)}async signInWithGoogle(){if(!Ea){alert("Firebase is not configured. Please check console.");return}try{const e=await Dg(Ea,el);if(e.user)return console.log("Login successful:",e.user.email),this.user=e.user,this.updateUI(e.user),this.authListeners.forEach(t=>t(e.user)),e.user}catch(e){if(console.error("Login failed:",e),e.code==="auth/popup-blocked"||e.code==="auth/cancelled-popup-request"){if(confirm("The login popup was blocked or failed to communicate. Would you like to try a redirect instead? Note: This may reload the application."))try{await Og(Ea,el);return}catch(t){console.error("Redirect fallback failed:",t),alert(`Login failed: ${t.message}`)}}else alert(`Login failed: ${e.message}`);throw e}}async signInWithEmail(e,t){if(!Ea){alert("Firebase is not configured.");return}try{return(await zg(Ea,e,t)).user}catch(n){throw console.error("Email Login failed:",n),alert(`Login failed: ${n.message}`),n}}async signUpWithEmail(e,t){if(!Ea){alert("Firebase is not configured.");return}try{return(await Ug(Ea,e,t)).user}catch(n){throw console.error("Sign Up failed:",n),alert(`Sign Up failed: ${n.message}`),n}}async sendPasswordReset(e){if(!Ea){alert("Firebase is not configured.");return}try{await Bg(Ea,e),alert(`Password reset email sent to ${e}`)}catch(t){throw console.error("Password reset failed:",t),alert(`Failed to send reset email: ${t.message}`),t}}async signOut(){if(Ea)try{if(await Fg(Ea),window.__AUTH_GATE__){try{await fetch("/api/auth/logout",{method:"POST"})}catch{}window.location.href="/login"}}catch(e){throw console.error("Logout failed:",e),e}}updateUI(e){const t=document.getElementById("firebase-connect-btn"),n=document.getElementById("firebase-clear-cloud-btn"),r=document.getElementById("firebase-status"),i=document.getElementById("email-auth-container"),c=document.getElementById("toggle-email-auth-btn");if(t){if(window.__AUTH_GATE__){t.textContent="Sign Out",t.classList.add("danger"),t.onclick=()=>this.signOut(),n&&(n.style.display="none"),i&&(i.style.display="none"),c&&(c.style.display="none"),r&&(r.textContent=e?`Signed in as ${e.email}`:"Signed in");const h=document.getElementById("page-account");if(h){const g=h.querySelector(".section-title");g&&(g.textContent="Account"),h.querySelectorAll(".account-content > p, .account-content > div").forEach(y=>{y.id!=="firebase-status"&&y.id!=="auth-buttons-container"&&(y.style.display="none")})}const f=document.getElementById("custom-db-btn");if(f){const g=!!window.__FIREBASE_CONFIG__,y=!!window.__POCKETBASE_URL__;if(g&&y){const u=f.closest(".setting-item");u&&(u.style.display="none")}}return}e?(t.textContent="Sign Out",t.classList.add("danger"),t.onclick=()=>this.signOut(),n&&(n.style.display="block"),i&&(i.style.display="none"),c&&(c.style.display="none"),r&&(r.textContent=`Signed in as ${e.email}`)):(t.textContent="Connect with Google",t.classList.remove("danger"),t.onclick=()=>this.signInWithGoogle(),n&&(n.style.display="none"),c&&(c.style.display="inline-block"),r&&(r.textContent="Sync your library across devices"))}}}const la=new ob,hi="public_playlists",lb="https://monodb.samidy.com",Af=localStorage.getItem("monochrome-pocketbase-url")||lb;console.log("[PocketBase] Using URL:",Af);const pl=new wf(Af);pl.autoCancellation(!1);const On={pb:pl,_userRecordCache:null,_isSyncing:!1,async _getUserRecord(o){if(!o)return null;if(this._userRecordCache&&this._userRecordCache.firebase_id===o)return this._userRecordCache;try{const e=await this.pb.collection("DB_users").getFirstListItem(`firebase_id="${o}"`,{f_id:o});return this._userRecordCache=e,e}catch(e){if(e.status===404)try{const t=await this.pb.collection("DB_users").create({firebase_id:o,library:{},history:[],user_playlists:{},user_folders:{}},{f_id:o});return this._userRecordCache=t,t}catch(t){return console.error("[PocketBase] Failed to create user:",t),null}return console.error("[PocketBase] Failed to get user:",e),null}},async getUserData(){const o=la.user;if(!o)return null;const e=await this._getUserRecord(o.uid);if(!e)return null;const t=this.safeParseInternal(e.library,"library",{}),n=this.safeParseInternal(e.history,"history",[]),r=this.safeParseInternal(e.user_playlists,"user_playlists",{}),i=this.safeParseInternal(e.user_folders,"user_folders",{}),c=this.safeParseInternal(e.favorite_albums,"favorite_albums",[]),h={username:e.username,display_name:e.display_name,avatar_url:e.avatar_url,banner:e.banner,status:e.status,about:e.about,website:e.website,privacy:this.safeParseInternal(e.privacy,"privacy",{playlists:"public",lastfm:"public"}),lastfm_username:e.lastfm_username,favorite_albums:c};return{library:t,history:n,userPlaylists:r,userFolders:i,profile:h}},async _updateUserJSON(o,e,t){const n=await this._getUserRecord(o);if(!n){console.error("Cannot update: no user record found");return}try{const r=typeof t=="string"?t:JSON.stringify(t),i=await this.pb.collection("DB_users").update(n.id,{[e]:r},{f_id:o});this._userRecordCache=i}catch(r){console.error(`Failed to sync ${e} to PocketBase:`,r)}},safeParseInternal(o,e,t){if(!o)return t;if(typeof o!="string")return o;try{return JSON.parse(o)}catch{try{const n=o.replace(/(:\s*")(.+?)("(?=\s*[,}\n\r]))/g,(r,i,c,h)=>{const f=c.replace(new RegExp('(?<!\\\\)"',"g"),'\\"');return i+f+h});return JSON.parse(n)}catch{try{if(o.includes("'")||o.includes("True")||o.includes("False")){const n=o.replace(/\bTrue\b/g,"true").replace(/\bFalse\b/g,"false").replace(/\bNone\b/g,"null");if((n.trim().startsWith("[")||n.trim().startsWith("{"))&&!n.match(/function|=>|window|document|alert|eval/))return new Function("return "+n)()}}catch(n){console.log(n)}return t}}},async syncLibraryItem(o,e,t){const n=la.user;if(!n)return;const r=await this._getUserRecord(n.uid);if(!r)return;let i=this.safeParseInternal(r.library,"library",{});const c=o==="mix"?"mixes":`${o}s`,h=o==="playlist"?e.uuid:e.id;i[c]||(i[c]={}),t?i[c][h]=this._minifyItem(o,e):delete i[c][h],await this._updateUserJSON(n.uid,"library",i)},_minifyItem(o,e){if(!e)return e;const t={id:e.id,addedAt:e.addedAt||Date.now()};return o==="track"?{...t,title:e.title||null,duration:e.duration||null,explicit:e.explicit||!1,artist:e.artist||(e.artists&&e.artists.length>0?e.artists[0]:null)||null,artists:e.artists?.map(n=>({id:n.id,name:n.name||null}))||[],album:e.album?{id:e.album.id,title:e.album.title||null,cover:e.album.cover||null,releaseDate:e.album.releaseDate||null,vibrantColor:e.album.vibrantColor||null,artist:e.album.artist||null,numberOfTracks:e.album.numberOfTracks||null}:null,copyright:e.copyright||null,isrc:e.isrc||null,trackNumber:e.trackNumber||null,streamStartDate:e.streamStartDate||null,version:e.version||null,mixes:e.mixes||null}:o==="album"?{...t,title:e.title||null,cover:e.cover||null,releaseDate:e.releaseDate||null,explicit:e.explicit||!1,artist:e.artist?{name:e.artist.name||null,id:e.artist.id}:e.artists?.[0]?{name:e.artists[0].name||null,id:e.artists[0].id}:null,type:e.type||null,numberOfTracks:e.numberOfTracks||null}:o==="artist"?{...t,name:e.name||null,picture:e.picture||e.image||null}:o==="playlist"?{uuid:e.uuid||e.id,addedAt:e.addedAt||Date.now(),title:e.title||e.name||null,image:e.image||e.squareImage||e.cover||null,numberOfTracks:e.numberOfTracks||(e.tracks?e.tracks.length:0),user:e.user?{name:e.user.name||null}:null}:o==="mix"?{id:e.id,addedAt:e.addedAt||Date.now(),title:e.title,subTitle:e.subTitle,mixType:e.mixType,cover:e.cover}:e},async syncHistoryItem(o){const e=la.user;if(!e)return;const t=await this._getUserRecord(e.uid);if(!t)return;let n=this.safeParseInternal(t.history,"history",[]);const r=[o,...n].slice(0,100);await this._updateUserJSON(e.uid,"history",r)},async syncUserPlaylist(o,e){const t=la.user;if(!t)return;const n=await this._getUserRecord(t.uid);if(!n)return;let r=this.safeParseInternal(n.user_playlists,"user_playlists",{});e==="delete"?(delete r[o.id],await this.unpublishPlaylist(o.id)):(r[o.id]={id:o.id,name:o.name,cover:o.cover||null,tracks:o.tracks?o.tracks.map(i=>this._minifyItem("track",i)):[],createdAt:o.createdAt||Date.now(),updatedAt:o.updatedAt||Date.now(),numberOfTracks:o.tracks?o.tracks.length:0,images:o.images||[],isPublic:o.isPublic||!1},o.isPublic&&await this.publishPlaylist(o)),await this._updateUserJSON(t.uid,"user_playlists",r)},async syncUserFolder(o,e){const t=la.user;if(!t)return;const n=await this._getUserRecord(t.uid);if(!n)return;let r=this.safeParseInternal(n.user_folders,"user_folders",{});e==="delete"?delete r[o.id]:r[o.id]={id:o.id,name:o.name,cover:o.cover||null,playlists:o.playlists||[],createdAt:o.createdAt||Date.now(),updatedAt:o.updatedAt||Date.now()},await this._updateUserJSON(t.uid,"user_folders",r)},async getPublicPlaylist(o){try{const e=await this.pb.collection(hi).getFirstListItem(`uuid="${o}"`,{p_id:o});let t=e.image||e.cover||e.playlist_cover||"",n=this.safeParseInternal(e.data,"data",{});!t&&n&&typeof n=="object"&&(t=n.cover||n.image||"");let r=t;t&&!t.startsWith("http")&&!t.startsWith("data:")&&(r=this.pb.files.getUrl(e,t));let i=[],c=this.safeParseInternal(e.tracks,"tracks",[]);if(!r&&c&&c.length>0){const g=[],y=new Set;for(const u of c){const l=u.album?.cover;if(l&&!y.has(l)&&(y.add(l),g.push(l),g.length>=4))break}i=g}let h=e.title||e.name||e.playlist_name;!h&&n&&typeof n=="object"&&(h=n.title||n.name),h||(h="Untitled Playlist");let f=e.description||"";return!f&&n&&typeof n=="object"&&(f=n.description||""),{...e,id:e.uuid,name:h,title:h,description:f,cover:r,image:r,tracks:c,images:i,numberOfTracks:c.length,type:"user-playlist",isPublic:!0,user:{name:"Community Playlist"}}}catch(e){if(e.status===404)return null;throw console.error("Failed to fetch public playlist:",e),e}},async publishPlaylist(o){if(!o||!o.id)return;const e=la.user?.uid;if(!e)return;const t={uuid:o.id,uid:e,firebase_id:e,title:o.name,name:o.name,playlist_name:o.name,image:o.cover,cover:o.cover,playlist_cover:o.cover,description:o.description||"",tracks:JSON.stringify(o.tracks||[]),isPublic:!0,data:{title:o.name,cover:o.cover,description:o.description||""}};try{const n=await this.pb.collection(hi).getList(1,1,{filter:`uuid="${o.id}"`,p_id:o.id});n.items.length>0?await this.pb.collection(hi).update(n.items[0].id,t,{f_id:e}):await this.pb.collection(hi).create(t,{f_id:e})}catch(n){console.error("Failed to publish playlist:",n)}},async unpublishPlaylist(o){const e=la.user?.uid;if(e)try{const t=await this.pb.collection(hi).getList(1,1,{filter:`uuid="${o}"`,p_id:o});t.items&&t.items.length>0&&await this.pb.collection(hi).delete(t.items[0].id,{p_id:o,f_id:e})}catch(t){console.error("Failed to unpublish playlist:",t)}},async getProfile(o){try{const e=await this.pb.collection("DB_users").getFirstListItem(`username="${o}"`,{fields:"username,display_name,avatar_url,banner,status,about,website,lastfm_username,privacy,user_playlists,favorite_albums"});return{...e,privacy:this.safeParseInternal(e.privacy,"privacy",{playlists:"public",lastfm:"public"}),user_playlists:this.safeParseInternal(e.user_playlists,"user_playlists",{}),favorite_albums:this.safeParseInternal(e.favorite_albums,"favorite_albums",[])}}catch{return null}},async updateProfile(o){const e=la.user;if(!e)return;const t=await this._getUserRecord(e.uid);if(!t)return;const n={...o};n.privacy&&(n.privacy=JSON.stringify(n.privacy)),await this.pb.collection("DB_users").update(t.id,n,{f_id:e.uid}),this._userRecordCache&&(this._userRecordCache={...this._userRecordCache,...n})},async isUsernameTaken(o){try{return(await this.pb.collection("DB_users").getList(1,1,{filter:`username="${o}"`})).totalItems>0}catch{return!1}},async clearCloudData(){const o=la.user;if(o)try{const e=await this._getUserRecord(o.uid);e&&(await this.pb.collection("DB_users").delete(e.id,{f_id:o.uid}),this._userRecordCache=null,alert("Cloud data cleared successfully."))}catch(e){console.error("Failed to clear cloud data!",e),alert("Failed to clear cloud data! :( Check console for details.")}},async onAuthStateChanged(o){if(o){if(this._isSyncing)return;this._isSyncing=!0;try{const e=await this.getUserData();if(e){let t=nn;typeof t=="function"?t=await t():t=await t;const n=async l=>t&&typeof t.getAll=="function"?t.getAll(l):t&&t.db&&typeof t.db.getAll=="function"?t.db.getAll(l):[],r={tracks:await n("favorites_tracks")||[],albums:await n("favorites_albums")||[],artists:await n("favorites_artists")||[],playlists:await n("favorites_playlists")||[],mixes:await n("favorites_mixes")||[],history:await n("history_tracks")||[],userPlaylists:await n("user_playlists")||[],userFolders:await n("user_folders")||[]};let{library:i,history:c,userPlaylists:h,userFolders:f}=e,g=!1;i||(i={}),i.tracks||(i.tracks={}),i.albums||(i.albums={}),i.artists||(i.artists={}),i.playlists||(i.playlists={}),i.mixes||(i.mixes={}),h||(h={}),f||(f={}),c||(c=[]);const y=(l,d,m)=>{const E=m==="playlist"&&d.uuid||d.id;l[E]||(l[E]=this._minifyItem(m,d),g=!0)};r.tracks.forEach(l=>y(i.tracks,l,"track")),r.albums.forEach(l=>y(i.albums,l,"album")),r.artists.forEach(l=>y(i.artists,l,"artist")),r.playlists.forEach(l=>y(i.playlists,l,"playlist")),r.mixes.forEach(l=>y(i.mixes,l,"mix")),r.userPlaylists.forEach(l=>{h[l.id]||(h[l.id]={id:l.id,name:l.name,cover:l.cover||null,tracks:l.tracks?l.tracks.map(d=>this._minifyItem("track",d)):[],createdAt:l.createdAt||Date.now(),updatedAt:l.updatedAt||Date.now(),numberOfTracks:l.tracks?l.tracks.length:0,images:l.images||[],isPublic:l.isPublic||!1},g=!0)}),r.userFolders.forEach(l=>{f[l.id]||(f[l.id]={id:l.id,name:l.name,cover:l.cover||null,playlists:l.playlists||[],createdAt:l.createdAt||Date.now(),updatedAt:l.updatedAt||Date.now()},g=!0)}),c.length===0&&r.history.length>0&&(c=r.history,g=!0),g&&(await this._updateUserJSON(o.uid,"library",i),await this._updateUserJSON(o.uid,"user_playlists",h),await this._updateUserJSON(o.uid,"user_folders",f),await this._updateUserJSON(o.uid,"history",c));const u={favorites_tracks:Object.values(i.tracks).filter(l=>l&&typeof l=="object"),favorites_albums:Object.values(i.albums).filter(l=>l&&typeof l=="object"),favorites_artists:Object.values(i.artists).filter(l=>l&&typeof l=="object"),favorites_playlists:Object.values(i.playlists).filter(l=>l&&typeof l=="object"),favorites_mixes:Object.values(i.mixes).filter(l=>l&&typeof l=="object"),history_tracks:c,user_playlists:Object.values(h).filter(l=>l&&typeof l=="object"),user_folders:Object.values(f).filter(l=>l&&typeof l=="object")};await t.importData(u),await new Promise(l=>setTimeout(l,300)),window.dispatchEvent(new CustomEvent("library-changed")),window.dispatchEvent(new CustomEvent("history-changed")),window.dispatchEvent(new HashChangeEvent("hashchange")),console.log("[PocketBase] âœ“ Sync completed")}}catch(e){console.error("[PocketBase] Sync error:",e)}finally{this._isSyncing=!1}}else this._userRecordCache=null,this._isSyncing=!1}};pl&&la.onAuthStateChanged(On.onAuthStateChanged.bind(On));class cb{constructor(){this.name="LCD Pixels",this.gridCols=48,this.maxVol=100,this.volDecay=.995,this.prevData=new Float32Array(this.gridCols).fill(0),this.peakData=new Float32Array(this.gridCols).fill(0),this.primaryColor="#ffffff",this.disableShake=!1,this.glCanvas=null,this.gl=null,this.glProgram=null,this.glInitialized=!1}initWebGL(e,t){if(this.glInitialized)return;this.glCanvas=document.createElement("canvas"),this.glCanvas.width=e,this.glCanvas.height=t,this.glCanvas.style.cssText="position:absolute;top:0;left:0;pointer-events:none;mix-blend-mode:multiply;";const n=this.glCanvas.getContext("webgl",{alpha:!0,premultipliedAlpha:!1});if(!n){console.warn("WebGL not available for grid overlay");return}this.gl=n;const r=`
            attribute vec2 a_position;
            varying vec2 v_uv;
            void main() {
                v_uv = a_position * 0.5 + 0.5;
                gl_Position = vec4(a_position, 0.0, 1.0);
            }
        `,i=`
            precision highp float;
            varying vec2 v_uv;
            uniform vec2 u_resolution;
            uniform float u_time;
            
            float hash(vec2 p) {
                return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453);
            }
            
            void main() {
                vec2 uv = v_uv;
                float aspect = u_resolution.x / u_resolution.y;
                
                // Skew transform
                vec2 centered = uv - 0.5;
                mat2 skewMatrix = mat2(1.0, 0.0, 0.20, 1.0);
                vec2 skewed = skewMatrix * centered + 0.5;
                
                // Perspective: shrink towards right
                float perspT = skewed.x;
                float perspScale = mix(1.0, 0.5, perspT);
                
                // Tilt-shift: focus at 25%, blur both near (left) and far (right)
                float focusPoint = 0.25;
                float distFromFocus = abs(perspT - focusPoint);
                float blurAmount = smoothstep(0.0, 0.6, distFromFocus);
                
                // Apply perspective
                vec2 pUV = skewed;
                pUV.y = (pUV.y - 0.5) * perspScale + 0.5;
                pUV.x *= aspect;
                
                // Dot matrix grid
                float cellSize = 0.0078 * perspScale;
                vec2 gridUV = pUV / cellSize;
                vec2 gv = fract(gridUV) - 0.5;
                vec2 id = floor(gridUV);
                
                float d = length(gv);
                float dotRadius = 0.35;
                
                // Dot edge with blur (pattern stays visible)
                float sharpness = mix(0.08, 0.25, blurAmount);
                float dotEdge = smoothstep(dotRadius - sharpness, dotRadius + sharpness * 0.3, d);
                
                // Per-cell noise
                float noise = hash(id);
                dotEdge *= 0.75 + noise * 0.25;
                
                // Subtle grain
                float grain = hash(uv * u_resolution + u_time) * 0.015;
                
                // Output
                float alpha = clamp(dotEdge * 0.5 + grain, 0.0, 0.5);
                gl_FragColor = vec4(0.0, 0.0, 0.0, alpha);
            }
        `,c=this.compileShader(n,n.VERTEX_SHADER,r),h=this.compileShader(n,n.FRAGMENT_SHADER,i);if(!c||!h)return;const f=n.createProgram();if(n.attachShader(f,c),n.attachShader(f,h),n.linkProgram(f),!n.getProgramParameter(f,n.LINK_STATUS)){console.error("Shader program failed to link");return}this.glProgram=f;const g=new Float32Array([-1,-1,1,-1,-1,1,1,1]),y=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,y),n.bufferData(n.ARRAY_BUFFER,g,n.STATIC_DRAW);const u=n.getAttribLocation(f,"a_position");n.enableVertexAttribArray(u),n.vertexAttribPointer(u,2,n.FLOAT,!1,0,0),this.uResolution=n.getUniformLocation(f,"u_resolution"),this.uTime=n.getUniformLocation(f,"u_time"),n.useProgram(f),n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),this.startTime=performance.now(),this.glInitialized=!0}compileShader(e,t,n){const r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)?r:(console.error("Shader compile error:",e.getShaderInfoLog(r)),e.deleteShader(r),null)}renderHoneycomb(e,t){if(!this.gl||!this.glProgram)return;const n=this.gl;(this.glCanvas.width!==e||this.glCanvas.height!==t)&&(this.glCanvas.width=e,this.glCanvas.height=t,n.viewport(0,0,e,t)),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.uniform2f(this.uResolution,e,t),n.uniform1f(this.uTime,(performance.now()-this.startTime)/1e3),n.drawArrays(n.TRIANGLE_STRIP,0,4)}resize(){}draw(e,t,n,r,i){const{width:c,height:h}=t,{kick:f,primaryColor:g,mode:y}=i;this.primaryColor=g;const u=document.documentElement.getAttribute("data-theme")!=="white";e.clearRect(0,0,c,h),y!=="blended"&&(e.fillStyle=u?"#050505":"#e6e6e6",e.fillRect(0,0,c,h));const l=this.processAudio(r,n),d=c/2,m=h*.35,E=c*.05,_=c*.95-E,M=h,R=2,W=.05;if(e.save(),e.translate(d,m),e.transform(1,-.08,.2,1,0,0),e.translate(-d,-m),!this.disableShake&&f>.1){const ye=f*8;e.translate((Math.random()-.5)*2*ye,(Math.random()-.5)*ye)}const fe=_/this.gridCols*.7;for(let ye=0;ye<this.gridCols;ye++){const Y=ye/(this.gridCols-1),j=R+(W-R)*Y,se=W-R,Te=R*Y+.5*se*Y*Y,Ae=R+.5*se,ze=Te/Ae,de=E+ze*_,we=fe*j,ce=l[ye];if(ce<.01)continue;const he=ce*M*j;if(he<1)continue;const Pe=.75+Math.abs(Math.sin(ye*127.1))*.25;e.fillStyle=this.adjustBrightness(g,Pe),e.shadowBlur=30+ce*50,e.shadowColor=g,this.drawCapsule(e,de,m,we,he)}e.restore(),this.glInitialized||(this.initWebGL(c,h),this.glCanvas&&t.parentElement&&(t.parentElement.style.position="relative",t.parentElement.appendChild(this.glCanvas))),this.renderHoneycomb(c,h)}processAudio(e,t){const n=new Float32Array(this.gridCols),r=Math.floor(this.gridCols/2),i=e.length;let c=0;const f=(t?.context?.sampleRate||48e3)/(i*2),g=40,y=22e3;for(let l=0;l<r;l++){const d=l/(r-1),m=g*Math.pow(y/g,d),E=(l+1)/(r-1),S=g*Math.pow(y/g,E),_=Math.max(1,Math.floor(m/f)),M=Math.max(_+1,Math.floor(S/f));let R=0,W=0;for(let Te=_;Te<M&&Te<i;Te++)R+=e[Te],W++;let fe=W>0?R/W:0;W===0&&_<i&&(fe=e[_]),fe*=1+d*1.8,fe>c&&(c=fe);const ye=r-1-l,Y=r+l,j=.25,se=.08;for(const Te of[ye,Y]){const Ae=this.prevData[Te],ze=fe;this.prevData[Te]=Ae+(ze-Ae)*(ze>Ae?j:se)}}this.maxVol=Math.max(this.maxVol*this.volDecay,c,40);const u=200/this.maxVol;for(let l=0;l<this.gridCols;l++){let d=this.prevData[l]*u/255;const m=.5;d<m?d=0:d=(d-m)/(1-m),d=Math.pow(Math.min(1,d),2.2),n[l]=d}return n}drawCapsule(e,t,n,r,i){if(i<r){e.beginPath(),e.arc(t,n,Math.max(.5,i/2),0,Math.PI*2),e.fill();return}const c=i/2,h=r/2;e.beginPath(),e.arc(t,n-c+h,h,Math.PI,0),e.lineTo(t+h,n+c-h),e.arc(t,n+c-h,h,0,Math.PI),e.lineTo(t-h,n-c+h),e.closePath(),e.fill()}adjustBrightness(e,t){const n=parseInt(e.slice(1,3),16),r=parseInt(e.slice(3,5),16),i=parseInt(e.slice(5,7),16),c=h=>Math.min(255,Math.max(0,Math.round(h*t)));return`rgb(${c(n)},${c(r)},${c(i)})`}destroy(){if(this.glCanvas&&(this.glCanvas.remove(),this.glCanvas=null),this.gl){const e=this.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this.gl=null}this.glInitialized=!1,this.glProgram=null}}class ub{constructor(){this.name="Particles",this.particles=[],this.particleCount=180}resize(e,t){}destroy(){}draw(e,t,n,r,i){const{width:c,height:h}=t,{kick:f,intensity:g,primaryColor:y,mode:u}=i,l=i.sensitivity||1,d=document.documentElement.getAttribute("data-theme")!=="white";if(e.clearRect(0,0,c,h),u!=="blended"&&(e.fillStyle=d?"#050505":"#e6e6e6",e.fillRect(0,0,c,h)),this.particles.length!==this.particleCount){this.particles=[];for(let M=0;M<this.particleCount;M++)this.particles.push({x:Math.random()*c,y:Math.random()*h,vx:(Math.random()-.5)*2,vy:(Math.random()-.5)*2,baseSize:Math.random()*3+1})}e.save();let m=0,E=0;if(f>.1){const M=f*8*l;m=(Math.random()-.5)*M,E=(Math.random()-.5)*M}e.translate(m,E),e.fillStyle=y,e.strokeStyle=y;const S=150+g*50+f*50*l,_=S*S;for(let M=0;M<this.particles.length;M++){let R=this.particles[M];const W=1+g*2+f*8*l;R.x+=R.vx*W,R.y+=R.vy*W,f>.3&&(R.x+=(Math.random()-.5)*f*2*l,R.y+=(Math.random()-.5)*f*2*l),R.x<0&&(R.x=c),R.x>c&&(R.x=0),R.y<0&&(R.y=h),R.y>h&&(R.y=0);const fe=R.baseSize*(1+g*.5+f*.8*l);e.globalAlpha=.4+g*.2+f*.15*l,e.beginPath(),e.arc(R.x,R.y,fe,0,Math.PI*2),e.fill();for(let ye=M+1;ye<this.particles.length;ye++){const Y=this.particles[ye],j=R.x-Y.x,se=R.y-Y.y;if(Math.abs(j)>S)continue;const Te=j*j+se*se;if(Te<_){const Ae=Math.sqrt(Te);e.beginPath(),e.lineWidth=(1-Ae/S)*(1+f*1.5*l),e.globalAlpha=(1-Ae/S)*(.3+g*.2+f*.3*l),e.moveTo(R.x,R.y),e.lineTo(Y.x,Y.y),e.stroke()}}}e.restore()}}class qi{static PROPAGATION_SPEED=.7;static GLOW_INTENSITY=5;static NOISE_STRENGTH=.04;constructor(){this.name="Unknown Pleasures",this.contextType="webgl",this.historySize=25,this.dataPoints=96,this.history=[],this.writeIndex=0,this.pLookup=new Float32Array(this.dataPoints),this.xLookup=new Float32Array(this.dataPoints),this.gl=null,this.lineProgram=null,this.glowProgram=null,this.quadBuffer=null,this.framebuffer=null,this.sceneTexture=null,this._paletteColor="",this._paletteRGB=null,this.rotationAngle=Math.PI/6,this._cos=Math.cos(this.rotationAngle),this._sin=Math.sin(this.rotationAngle),this._propagationAccum=0,this.reset(),this._precompute()}reset(){this.history.length=0;for(let e=0;e<this.historySize;e++)this.history.push(new Float32Array(this.dataPoints));this.writeIndex=0}resize(e,t){this.gl&&this.sceneTexture&&this._resizeFramebuffer(this.gl,e,t)}destroy(){this.history.length=0,this.gl&&(this.lineProgram&&this.gl.deleteProgram(this.lineProgram),this.glowProgram&&this.gl.deleteProgram(this.glowProgram),this.quadBuffer&&this.gl.deleteBuffer(this.quadBuffer),this.framebuffer&&this.gl.deleteFramebuffer(this.framebuffer),this.sceneTexture&&this.gl.deleteTexture(this.sceneTexture)),this.gl=null,this.lineProgram=null,this.glowProgram=null}_precompute(){const e=this.dataPoints,t=1/(e-1);for(let n=0;n<e;n++){const r=Math.abs(n*t-.5)*2;this.pLookup[n]=1-r*r*r,this.xLookup[n]=n*t}}_createBuffers(){this.quadBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.quadBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),this.gl.STATIC_DRAW),this.lineBuffer=this.gl.createBuffer();const e=this.historySize*this.dataPoints*6;this.vertexBuffer=new Float32Array(e*3)}_initGL(e,t,n){if(this.lineProgram)return;this.gl=e;const r=`
            attribute vec3 a_posEdge; // xy = position, z = edge distance (-1 to +1)
            varying float v_edge;
            
            void main() {
                gl_Position = vec4(a_posEdge.xy, 0.0, 1.0);
                v_edge = a_posEdge.z;
            }
        `,i=`
            precision mediump float;
            uniform vec3 u_color;
            varying float v_edge;
            
            void main() {
                // Smooth antialiasing at edges
                float edge = abs(v_edge);
                float aa = 1.0 - smoothstep(0.6, 1.0, edge);
                gl_FragColor = vec4(u_color * aa, aa);
            }
        `;if(this.lineProgram=this._createProgram(e,r,i),!this.lineProgram)return;this.line_a_posEdge=e.getAttribLocation(this.lineProgram,"a_posEdge"),this.line_u_color=e.getUniformLocation(this.lineProgram,"u_color");const c=`
            attribute vec2 a_position;
            varying vec2 v_uv;
            
            void main() {
                v_uv = a_position * 0.5 + 0.5;
                gl_Position = vec4(a_position, 0.0, 1.0);
            }
        `,h=`
            precision mediump float;
            varying vec2 v_uv;
            uniform sampler2D u_texture;
            uniform float u_threshold;
            uniform float u_isDarkTheme;
            
            void main() {
                // Since Pass 1 now clears to transparent, the scene texture only contains the isolated lines.
                // We don't need to extract brightness by darkening the background anymore.
                // Just pass the lines through so they can be blurred.
                gl_FragColor = texture2D(u_texture, v_uv);
            }
        `;if(this.brightnessProgram=this._createProgram(e,c,h),!this.brightnessProgram)return;this.brightness_a_position=e.getAttribLocation(this.brightnessProgram,"a_position"),this.brightness_u_texture=e.getUniformLocation(this.brightnessProgram,"u_texture"),this.brightness_u_threshold=e.getUniformLocation(this.brightnessProgram,"u_threshold"),this.brightness_u_isDarkTheme=e.getUniformLocation(this.brightnessProgram,"u_isDarkTheme");const f=`
            attribute vec2 a_position;
            varying vec2 v_uv;
            
            void main() {
                v_uv = a_position * 0.5 + 0.5;
                gl_Position = vec4(a_position, 0.0, 1.0);
            }
        `,g=`
            precision mediump float;
            varying vec2 v_uv;
            uniform sampler2D u_texture;
            uniform vec2 u_resolution;
            uniform vec2 u_direction;
            uniform float u_spread; // Used instead of u_radius
            
            // 9-tap Gaussian with expanding offsets
            void main() {
                // Expanding offsets for stronger glow (Thread Ripper Style)
                vec2 off1 = vec2(1.3846153846) * u_direction * u_spread;
                vec2 off2 = vec2(3.2307692308) * u_direction * u_spread;
                
                vec4 color = texture2D(u_texture, v_uv) * 0.2270270270;
                color += texture2D(u_texture, v_uv + (off1 / u_resolution)) * 0.3162162162;
                color += texture2D(u_texture, v_uv - (off1 / u_resolution)) * 0.3162162162;
                color += texture2D(u_texture, v_uv + (off2 / u_resolution)) * 0.0702702703;
                color += texture2D(u_texture, v_uv - (off2 / u_resolution)) * 0.0702702703;
                
                gl_FragColor = color;
            }
        `;if(this.blurProgram=this._createProgram(e,f,g),!this.blurProgram)return;this.blur_a_position=e.getAttribLocation(this.blurProgram,"a_position"),this.blur_u_texture=e.getUniformLocation(this.blurProgram,"u_texture"),this.blur_u_resolution=e.getUniformLocation(this.blurProgram,"u_resolution"),this.blur_u_direction=e.getUniformLocation(this.blurProgram,"u_direction"),this.blur_u_spread=e.getUniformLocation(this.blurProgram,"u_spread");const y=`
            precision mediump float;
            varying vec2 v_uv;
            uniform sampler2D u_scene;
            uniform sampler2D u_blur;
            uniform float u_glowStrength;
            uniform float u_noiseStrength;
            uniform float u_isDarkTheme; // Kept for compatibility but unused in logic below
            uniform float u_time;
            
            float rand(vec2 co) {
                return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
            }

            void main() {
                vec4 original = texture2D(u_scene, v_uv);
                vec4 blur = texture2D(u_blur, v_uv);
                
                // Additive glow on top of original lines
                vec3 rgb = original.rgb + blur.rgb * u_glowStrength;
                
                // Vignette: blur edges for depth
                float dist = distance(v_uv, vec2(0.5));
                float vignette = smoothstep(0.4, 0.8, dist);
                // We handle scaling in the final mix later to avoid breaking the HDR mapping above.
                // The rgb here is the base scene before the final exponential glow math.

                float noise = rand(v_uv * 10.0); 
                float noiseStrength = 0.06; 
                rgb += (noise - 0.5) * noiseStrength;

                // In light mode (u_isDarkTheme == 0.0), the additive glow effect naturally appears weaker 
                // against the bright background. We apply a 1.5x perceptual boost to match dark mode intensity.
                float themeBoost = mix(1.5, 1.0, u_isDarkTheme);
                // Using 1.0 - exp(-x) gives butter-smooth HDR-like falloff, eliminating harsh banding.
                // We square the intensity (gamma 2.0) to dramatically increase the "core" opacity of the glow
                // making it much more visible while preserving the smooth edges.
                vec3 rawGlow = blur.rgb * (u_glowStrength * themeBoost);
                float glowIntensity = max(rawGlow.r, max(rawGlow.g, rawGlow.b));
                
                // Boost density significantly before applying HDR curve
                float density = glowIntensity * glowIntensity * 1.5;
                float smoothGlowAlpha = 1.0 - exp(-density);
                
                // Keep the color strictly within valid premultiplied alpha bounds (rgb <= alpha)
                vec3 safeGlowRgb = glowIntensity > 0.0 ? (rawGlow / glowIntensity) * smoothGlowAlpha : vec3(0.0);
                
                // Additive over the core lines
                rgb = original.rgb + safeGlowRgb;

                // Final alpha is the line's alpha plus the glow's alpha
                float finalAlpha = clamp(original.a + smoothGlowAlpha, 0.0, 1.0);

                // Output RGB and Alpha for PREMULTIPLIED alpha blending
                gl_FragColor = vec4(rgb, finalAlpha); 
            }
        `;this.compositeProgram=this._createProgram(e,f,y),this.compositeProgram&&(this.composite_a_position=e.getAttribLocation(this.compositeProgram,"a_position"),this.composite_u_scene=e.getUniformLocation(this.compositeProgram,"u_scene"),this.composite_u_blur=e.getUniformLocation(this.compositeProgram,"u_blur"),this.composite_u_glowStrength=e.getUniformLocation(this.compositeProgram,"u_glowStrength"),this.composite_u_noiseStrength=e.getUniformLocation(this.compositeProgram,"u_noiseStrength"),this.composite_u_isDarkTheme=e.getUniformLocation(this.compositeProgram,"u_isDarkTheme"),this.composite_u_time=e.getUniformLocation(this.compositeProgram,"u_time"),this._createBuffers(),this._createFramebuffer(e,t,n),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA))}_createProgram(e,t,n){const r=this._compileShader(e,e.VERTEX_SHADER,t),i=this._compileShader(e,e.FRAGMENT_SHADER,n);if(!r||!i)return null;const c=e.createProgram();return e.attachShader(c,r),e.attachShader(c,i),e.linkProgram(c),e.getProgramParameter(c,e.LINK_STATUS)?c:(console.error("WebGL program link failed:",e.getProgramInfoLog(c)),null)}_compileShader(e,t,n){const r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)?r:(console.error("Shader compile error:",e.getShaderInfoLog(r)),e.deleteShader(r),null)}_createFramebuffer(e,t,n){this.framebuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer),this.sceneTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.sceneTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,n,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.sceneTexture,0);const r=Math.max(1,t>>1),i=Math.max(1,n>>1);this.blurFramebuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.blurFramebuffer),this.blurTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.blurTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r,i,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.blurTexture,0),this.blurFinalFramebuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.blurFinalFramebuffer),this.blurFinalTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.blurFinalTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r,i,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.blurFinalTexture,0),e.bindFramebuffer(e.FRAMEBUFFER,null)}_resizeFramebuffer(e,t,n){const r=Math.max(1,t>>1),i=Math.max(1,n>>1);e.bindTexture(e.TEXTURE_2D,this.sceneTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,n,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindTexture(e.TEXTURE_2D,this.blurTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r,i,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindTexture(e.TEXTURE_2D,this.blurFinalTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r,i,0,e.RGBA,e.UNSIGNED_BYTE,null)}_buildPalette(e){const t=parseInt(e.slice(1,3),16),n=parseInt(e.slice(3,5),16),r=parseInt(e.slice(5,7),16),i=.299*t+.587*n+.114*r;this._paletteRGB=[];for(let c=0;c<this.historySize;c++){const f=3-2*(c/(this.historySize-1)),g=Math.max(0,Math.min(255,i+(t-i)*f|0))/255,y=Math.max(0,Math.min(255,i+(n-i)*f|0))/255,u=Math.max(0,Math.min(255,i+(r-i)*f|0))/255;this._paletteRGB.push([g,y,u])}this._paletteColor=e}_generateLineQuads(e,t,n,r,i,c){if(e.length<2)return 0;const h=e.length;let f=c;const g=2/n,y=2/r;for(let u=0;u<h-1;u++){const l=e[u],d=e[u+1];let m=d.x-l.x,E=d.y-l.y,S=Math.sqrt(m*m+E*E),_,M;S<.001?(_=0,M=-1):(_=-E/S,M=m/S);let R=_,W=M;if(u>0){const Ve=e[u-1],Et=l.x-Ve.x,Nt=l.y-Ve.y,$t=Math.sqrt(Et*Et+Nt*Nt);$t>=.001&&(R=-Nt/$t,W=Et/$t)}let fe=_+R,ye=M+W,Y=Math.sqrt(fe*fe+ye*ye);Y>.001&&(fe/=Y,ye/=Y);let j=_,se=M;if(u<h-2){const Ve=e[u+2],Et=Ve.x-d.x,Nt=Ve.y-d.y,$t=Math.sqrt(Et*Et+Nt*Nt);$t>=.001&&(j=-Nt/$t,se=Et/$t)}let Te=_+j,Ae=M+se,ze=Math.sqrt(Te*Te+Ae*Ae);ze>.001&&(Te/=ze,Ae/=ze);const de=(l.x-fe*t)*g-1,we=1-(l.y-ye*t)*y,ce=(l.x+fe*t)*g-1,he=1-(l.y+ye*t)*y,Pe=(d.x-Te*t)*g-1,$e=1-(d.y-Ae*t)*y,He=(d.x+Te*t)*g-1,et=1-(d.y+Ae*t)*y;i[f++]=de,i[f++]=we,i[f++]=-1,i[f++]=ce,i[f++]=he,i[f++]=1,i[f++]=Pe,i[f++]=$e,i[f++]=-1,i[f++]=ce,i[f++]=he,i[f++]=1,i[f++]=He,i[f++]=et,i[f++]=1,i[f++]=Pe,i[f++]=$e,i[f++]=-1}return f-c}draw(e,t,n,r,i){const c=e,{width:h,height:f}=t,g=document.documentElement.getAttribute("data-theme")!=="white";if(t.style.mixBlendMode="normal",this.lineProgram||this._initGL(c,h,f),this.history.length===0&&this.reset(),!i.paused){this._propagationAccum+=qi.PROPAGATION_SPEED;const he=this.dataPoints;if(this._propagationAccum>=1){this._propagationAccum-=1;const $e=n.context.sampleRate/2,et=Math.min(1,22e3/$e),Ve=Math.floor(r.length*et),Et=this.history[this.writeIndex];if(Et)for(let Nt=0;Nt<he;Nt++)Et[Nt]=r[this.xLookup[Nt]*Ve|0]/255*this.pLookup[Nt];this.writeIndex=(this.writeIndex+1)%this.historySize}}this._paletteColor!==i.primaryColor&&this._buildPalette(i.primaryColor),c.bindFramebuffer(c.FRAMEBUFFER,this.framebuffer),c.viewport(0,0,h,f),c.clearColor(0,0,0,0),c.clear(c.COLOR_BUFFER_BIT);const y=Math.max(Math.abs(h*this._cos)+Math.abs(f*this._sin),Math.abs(h*this._sin)+Math.abs(f*this._cos))*1.15,u=y*.05,l=y*.9,d=2,E=(l-u)/(1-1/(1+d)),S=l-E;let _=0;const M=[];this._tempPoints||(this._tempPoints=[]);const R=this._tempPoints,W=this.dataPoints,fe=h/2,ye=f/2,Y=this._cos,j=this._sin,se=-y/2,Te=-y/2;for(let he=this.historySize-1;he>=0;he--){const Pe=(this.writeIndex+he)%this.historySize,$e=this.history[Pe],et=1+(1-he/(this.historySize-1))*d,Ve=1/et,Et=S+E/et,Nt=y*Ve*1.5,$t=(y-Nt)*.5,Ie=200*Ve,pe=Math.max(1,8*Ve+i.kick*3);R.length=0;for(let O=0;O<W;O++){const z=$t+this.xLookup[O]*Nt,k=Et-$e[O]*Ie,L=z+se,ne=k+Te;R.push({x:L*Y-ne*j+fe,y:L*j+ne*Y+ye})}const Be=this._generateLineQuads(R,pe/2,h,f,this.vertexBuffer,_);Be>0&&(M.push({start:_/3,count:Be/3,colorIndex:he}),_+=Be)}c.bindBuffer(c.ARRAY_BUFFER,this.lineBuffer),c.bufferData(c.ARRAY_BUFFER,this.vertexBuffer.subarray(0,_),c.DYNAMIC_DRAW),c.enableVertexAttribArray(this.line_a_posEdge),c.vertexAttribPointer(this.line_a_posEdge,3,c.FLOAT,!1,0,0),c.useProgram(this.lineProgram),c.enable(c.BLEND),g?c.blendFunc(c.ONE,c.ONE):c.blendFunc(c.ONE,c.ONE_MINUS_SRC_ALPHA);for(const he of M){const Pe=this._paletteRGB[he.colorIndex]||[1,1,1];c.uniform3f(this.line_u_color,Pe[0],Pe[1],Pe[2]),c.drawArrays(c.TRIANGLES,he.start,he.count)}c.disable(c.BLEND);const Ae=Math.max(1,h>>1),ze=Math.max(1,f>>1);c.bindFramebuffer(c.FRAMEBUFFER,this.blurFramebuffer),c.viewport(0,0,Ae,ze),c.clearColor(0,0,0,0),c.clear(c.COLOR_BUFFER_BIT),c.useProgram(this.brightnessProgram),c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,this.sceneTexture),c.uniform1i(this.brightness_u_texture,0),c.uniform1f(this.brightness_u_threshold,0),c.uniform1f(this.brightness_u_isDarkTheme,g?1:0),c.bindBuffer(c.ARRAY_BUFFER,this.quadBuffer),c.enableVertexAttribArray(this.brightness_a_position),c.vertexAttribPointer(this.brightness_a_position,2,c.FLOAT,!1,0,0),c.drawArrays(c.TRIANGLES,0,6),c.useProgram(this.blurProgram);const de=4;let we=!0;for(let he=0;he<de*2;he++){const Pe=we?this.blurFinalFramebuffer:this.blurFramebuffer,$e=we?this.blurTexture:this.blurFinalTexture,He=1+he*.75;c.bindFramebuffer(c.FRAMEBUFFER,Pe),c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,$e),c.uniform1i(this.blur_u_texture,0),c.uniform2f(this.blur_u_resolution,Ae,ze),c.uniform2f(this.blur_u_direction,we?1:0,we?0:1),c.uniform1f(this.blur_u_spread,He),c.drawArrays(c.TRIANGLES,0,6),we=!we}if(c.bindFramebuffer(c.FRAMEBUFFER,null),c.viewport(0,0,h,f),i.mode!=="blended"){const he=g?[.02,.02,.02,1]:[.9,.9,.9,1];c.clearColor(he[0],he[1],he[2],he[3])}else g?c.clearColor(0,0,0,.4):c.clearColor(.95,.95,.95,.4);c.clear(c.COLOR_BUFFER_BIT),c.enable(c.BLEND),c.blendFunc(c.ONE,c.ONE_MINUS_SRC_ALPHA),c.useProgram(this.compositeProgram),c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,this.sceneTexture),c.uniform1i(this.composite_u_scene,0),c.activeTexture(c.TEXTURE1),c.bindTexture(c.TEXTURE_2D,we?this.blurTexture:this.blurFinalTexture),c.uniform1i(this.composite_u_blur,1);const ce=1+i.kick;c.uniform1f(this.composite_u_glowStrength,qi.GLOW_INTENSITY*ce),c.uniform1f(this.composite_u_noiseStrength,qi.NOISE_STRENGTH),c.uniform1f(this.composite_u_isDarkTheme,g?1:0),c.uniform1f(this.composite_u_time,performance.now()/1e3),c.bindBuffer(c.ARRAY_BUFFER,this.quadBuffer),c.enableVertexAttribArray(this.composite_a_position),c.vertexAttribPointer(this.composite_a_position,2,c.FLOAT,!1,0,0),c.drawArrays(c.TRIANGLES,0,6)}}function db(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Oo={exports:{}},Ad;function fb(){return Ad||(Ad=1,(function(o,e){(function(n,r){o.exports=r()})(window,function(){return(function(t){var n={};function r(i){if(n[i])return n[i].exports;var c=n[i]={i,l:!1,exports:{}};return t[i].call(c.exports,c,c.exports,r),c.l=!0,c.exports}return r.m=t,r.c=n,r.d=function(i,c,h){r.o(i,c)||Object.defineProperty(i,c,{enumerable:!0,get:h})},r.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},r.t=function(i,c){if(c&1&&(i=r(i)),c&8||c&4&&typeof i=="object"&&i&&i.__esModule)return i;var h=Object.create(null);if(r.r(h),Object.defineProperty(h,"default",{enumerable:!0,value:i}),c&2&&typeof i!="string")for(var f in i)r.d(h,f,(function(g){return i[g]}).bind(null,f));return h},r.n=function(i){var c=i&&i.__esModule?function(){return i.default}:function(){return i};return r.d(c,"a",c),c},r.o=function(i,c){return Object.prototype.hasOwnProperty.call(i,c)},r.p="",r(r.s="./src/index.js")})({"./node_modules/ecma-proposal-math-extensions/reference-implementation/index.js":(function(t,n,r){{const i=(h,f)=>{var g=typeof f=="function",y=typeof f=="function",u=typeof f=="function";Object.defineProperty(Math,h,{configurable:g,enumerable:u,writable:y,value:f})};i("DEG_PER_RAD",Math.PI/180),i("RAD_PER_DEG",180/Math.PI);const c=new Float32Array(1);i("scale",function(f,g,y,u,l){return arguments.length===0?NaN:Number.isNaN(f)||Number.isNaN(g)||Number.isNaN(y)||Number.isNaN(u)||Number.isNaN(l)?NaN:f===1/0||f===-1/0?f:(f-g)*(l-u)/(y-g)+u}),i("fscale",function(f,g,y,u,l){return c[0]=Math.scale(f,g,y,u,l),c[0]}),i("clamp",function(f,g,y){return Math.min(y,Math.max(g,f))}),i("radians",function(f){return f*Math.DEG_PER_RAD}),i("degrees",function(f){return f*Math.RAD_PER_DEG})}}),"./src/audio/audioLevels.js":(function(t,n,r){r.r(n),r.d(n,"default",function(){return f});function i(g,y){if(!(g instanceof y))throw new TypeError("Cannot call a class as a function")}function c(g,y){for(var u=0;u<y.length;u++){var l=y[u];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(g,l.key,l)}}function h(g,y,u){return y&&c(g.prototype,y),u&&c(g,u),g}var f=(function(){function g(y){i(this,g),this.audio=y;var u;this.audio.audioContext?u=this.audio.audioContext.sampleRate:u=44100;var l=u/this.audio.fftSize,d=Math.clamp(Math.round(20/l)-1,0,this.audio.numSamps-1),m=Math.clamp(Math.round(320/l)-1,0,this.audio.numSamps-1),E=Math.clamp(Math.round(2800/l)-1,0,this.audio.numSamps-1),S=Math.clamp(Math.round(11025/l)-1,0,this.audio.numSamps-1);this.starts=[d,m,E],this.stops=[m,E,S],this.val=new Float32Array(3),this.imm=new Float32Array(3),this.att=new Float32Array(3),this.avg=new Float32Array(3),this.longAvg=new Float32Array(3),this.att.fill(1),this.avg.fill(1),this.longAvg.fill(1)}return h(g,[{key:"updateAudioLevels",value:function(u,l){if(this.audio.freqArray.length>0){var d=u;!g.isFiniteNumber(d)||d<15?d=15:d>144&&(d=144),this.imm.fill(0);for(var m=0;m<3;m++)for(var E=this.starts[m];E<this.stops[m];E++)this.imm[m]+=this.audio.freqArray[E];for(var S=0;S<3;S++){var _=void 0;this.imm[S]>this.avg[S]?_=.2:_=.5,_=g.adjustRateToFPS(_,30,d),this.avg[S]=this.avg[S]*_+this.imm[S]*(1-_),l<50?_=.9:_=.992,_=g.adjustRateToFPS(_,30,d),this.longAvg[S]=this.longAvg[S]*_+this.imm[S]*(1-_),this.longAvg[S]<.001?(this.val[S]=1,this.att[S]=1):(this.val[S]=this.imm[S]/this.longAvg[S],this.att[S]=this.avg[S]/this.longAvg[S])}}}},{key:"bass",get:function(){return this.val[0]}},{key:"bass_att",get:function(){return this.att[0]}},{key:"mid",get:function(){return this.val[1]}},{key:"mid_att",get:function(){return this.att[1]}},{key:"treb",get:function(){return this.val[2]}},{key:"treb_att",get:function(){return this.att[2]}}],[{key:"isFiniteNumber",value:function(u){return Number.isFinite(u)&&!Number.isNaN(u)}},{key:"adjustRateToFPS",value:function(u,l,d){return Math.pow(u,l/d)}}]),g})()}),"./src/audio/audioProcessor.js":(function(t,n,r){r.r(n),r.d(n,"default",function(){return g});var i=r("./src/audio/fft.js");function c(y,u){if(!(y instanceof u))throw new TypeError("Cannot call a class as a function")}function h(y,u){for(var l=0;l<u.length;l++){var d=u[l];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(y,d.key,d)}}function f(y,u,l){return u&&h(y.prototype,u),y}var g=(function(){function y(u){c(this,y),this.numSamps=512,this.fftSize=this.numSamps*2,this.fft=new i.default(this.fftSize,512,!0),u&&(this.audioContext=u,this.audible=u.createDelay(),this.analyser=u.createAnalyser(),this.analyser.smoothingTimeConstant=0,this.analyser.fftSize=this.fftSize,this.audible.connect(this.analyser),this.analyserL=u.createAnalyser(),this.analyserL.smoothingTimeConstant=0,this.analyserL.fftSize=this.fftSize,this.analyserR=u.createAnalyser(),this.analyserR.smoothingTimeConstant=0,this.analyserR.fftSize=this.fftSize,this.splitter=u.createChannelSplitter(2),this.audible.connect(this.splitter),this.splitter.connect(this.analyserL,0),this.splitter.connect(this.analyserR,1)),this.timeByteArray=new Uint8Array(this.fftSize),this.timeByteArrayL=new Uint8Array(this.fftSize),this.timeByteArrayR=new Uint8Array(this.fftSize),this.timeArray=new Int8Array(this.fftSize),this.timeByteArraySignedL=new Int8Array(this.fftSize),this.timeByteArraySignedR=new Int8Array(this.fftSize),this.tempTimeArrayL=new Int8Array(this.fftSize),this.tempTimeArrayR=new Int8Array(this.fftSize),this.timeArrayL=new Int8Array(this.numSamps),this.timeArrayR=new Int8Array(this.numSamps)}return f(y,[{key:"sampleAudio",value:function(){this.analyser.getByteTimeDomainData(this.timeByteArray),this.analyserL.getByteTimeDomainData(this.timeByteArrayL),this.analyserR.getByteTimeDomainData(this.timeByteArrayR),this.processAudio()}},{key:"updateAudio",value:function(l,d,m){this.timeByteArray.set(l),this.timeByteArrayL.set(d),this.timeByteArrayR.set(m),this.processAudio()}},{key:"processAudio",value:function(){for(var l=0,d=0,m=0;l<this.fftSize;l++)this.timeArray[l]=this.timeByteArray[l]-128,this.timeByteArraySignedL[l]=this.timeByteArrayL[l]-128,this.timeByteArraySignedR[l]=this.timeByteArrayR[l]-128,this.tempTimeArrayL[l]=.5*(this.timeByteArraySignedL[l]+this.timeByteArraySignedL[m]),this.tempTimeArrayR[l]=.5*(this.timeByteArraySignedR[l]+this.timeByteArraySignedR[m]),l%2===0&&(this.timeArrayL[d]=this.tempTimeArrayL[l],this.timeArrayR[d]=this.tempTimeArrayR[l],d+=1),m=l;this.freqArray=this.fft.timeToFrequencyDomain(this.timeArray),this.freqArrayL=this.fft.timeToFrequencyDomain(this.timeByteArraySignedL),this.freqArrayR=this.fft.timeToFrequencyDomain(this.timeByteArraySignedR)}},{key:"connectAudio",value:function(l){l.connect(this.audible)}},{key:"disconnectAudio",value:function(l){l.disconnect(this.audible)}}]),y})()}),"./src/audio/fft.js":(function(t,n,r){r.r(n),r.d(n,"default",function(){return f});function i(g,y){if(!(g instanceof y))throw new TypeError("Cannot call a class as a function")}function c(g,y){for(var u=0;u<y.length;u++){var l=y[u];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(g,l.key,l)}}function h(g,y,u){return y&&c(g.prototype,y),g}var f=(function(){function g(y,u){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;i(this,g),this.samplesIn=y,this.samplesOut=u,this.equalize=l,this.NFREQ=u*2,this.equalize&&this.initEqualizeTable(),this.initBitRevTable(),this.initCosSinTable()}return h(g,[{key:"initEqualizeTable",value:function(){this.equalizeArr=new Float32Array(this.samplesOut);for(var u=1/this.samplesOut,l=0;l<this.samplesOut;l++)this.equalizeArr[l]=-.02*Math.log((this.samplesOut-l)*u)}},{key:"initBitRevTable",value:function(){this.bitrevtable=new Uint16Array(this.NFREQ);for(var u=0;u<this.NFREQ;u++)this.bitrevtable[u]=u;for(var l=0,d=0;d<this.NFREQ;d++){if(l>d){var m=this.bitrevtable[d];this.bitrevtable[d]=this.bitrevtable[l],this.bitrevtable[l]=m}for(var E=this.NFREQ>>1;E>=1&&l>=E;)l-=E,E>>=1;l+=E}}},{key:"initCosSinTable",value:function(){for(var u=2,l=0;u<=this.NFREQ;)l+=1,u<<=1;this.cossintable=[new Float32Array(l),new Float32Array(l)],u=2;for(var d=0;u<=this.NFREQ;){var m=-2*Math.PI/u;this.cossintable[0][d]=Math.cos(m),this.cossintable[1][d]=Math.sin(m),d+=1,u<<=1}}},{key:"timeToFrequencyDomain",value:function(u){for(var l=new Float32Array(this.NFREQ),d=new Float32Array(this.NFREQ),m=0;m<this.NFREQ;m++){var E=this.bitrevtable[m];E<this.samplesIn?l[m]=u[E]:l[m]=0,d[m]=0}for(var S=2,_=0;S<=this.NFREQ;){for(var M=this.cossintable[0][_],R=this.cossintable[1][_],W=1,fe=0,ye=S>>1,Y=0;Y<ye;Y++){for(var j=Y;j<this.NFREQ;j+=S){var se=j+ye,Te=W*l[se]-fe*d[se],Ae=W*d[se]+fe*l[se];l[se]=l[j]-Te,d[se]=d[j]-Ae,l[j]+=Te,d[j]+=Ae}var ze=W;W=ze*M-fe*R,fe=fe*M+ze*R}S<<=1,_+=1}var de=new Float32Array(this.samplesOut);if(this.equalize)for(var we=0;we<this.samplesOut;we++)de[we]=this.equalizeArr[we]*Math.sqrt(l[we]*l[we]+d[we]*d[we]);else for(var ce=0;ce<this.samplesOut;ce++)de[ce]=Math.sqrt(l[ce]*l[ce]+d[ce]*d[ce]);return de}}]),g})()}),"./src/blankPreset.js":(function(t,n,r){var i,c;i=[],c=(function(){"use strict;";var h={baseVals:{gammaadj:1.25,wave_g:.5,mv_x:12,warpscale:1,brighten:0,mv_y:9,wave_scale:1,echo_alpha:0,additivewave:0,sx:1,sy:1,warp:.01,red_blue:0,wave_mode:0,wave_brighten:0,wrap:0,zoomexp:1,fshader:0,wave_r:.5,echo_zoom:1,wave_smoothing:.75,warpanimspeed:1,wave_dots:0,wave_x:.5,wave_y:.5,zoom:1,solarize:0,modwavealphabyvolume:0,dx:0,cx:.5,dy:0,darken_center:0,cy:.5,invert:0,bmotionvectorson:0,rot:0,modwavealphaend:.95,wave_mystery:-.2,decay:.9,wave_a:1,wave_b:.5,rating:5,modwavealphastart:.75,darken:0,echo_orient:0,ib_r:.5,ib_g:.5,ib_b:.5,ib_a:0,ib_size:0,ob_r:.5,ob_g:.5,ob_b:.5,ob_a:0,ob_size:0,mv_dx:0,mv_dy:0,mv_a:0,mv_r:.5,mv_g:.5,mv_b:.5,mv_l:0},init_eqs:function(){var g={};return g},frame_eqs:function(g){return g.rkeys=["warp"],g.zoom=1.01+.02*g.treb_att,g.warp=.15+.25*g.bass_att,g},pixel_eqs:function(g){return g.warp=g.warp+g.rad*.15,g},waves:[{baseVals:{a:1,enabled:0,b:1,g:1,scaling:1,samples:512,additive:0,usedots:0,spectrum:0,r:1,smoothing:.5,thick:0,sep:0},init_eqs:function(g){return g.rkeys=[],g},frame_eqs:function(g){return g},point_eqs:""},{baseVals:{a:1,enabled:0,b:1,g:1,scaling:1,samples:512,additive:0,usedots:0,spectrum:0,r:1,smoothing:.5,thick:0,sep:0},init_eqs:function(g){return g.rkeys=[],g},frame_eqs:function(g){return g},point_eqs:""},{baseVals:{a:1,enabled:0,b:1,g:1,scaling:1,samples:512,additive:0,usedots:0,spectrum:0,r:1,smoothing:.5,thick:0,sep:0},init_eqs:function(g){return g.rkeys=[],g},frame_eqs:function(g){return g},point_eqs:""},{baseVals:{a:1,enabled:0,b:1,g:1,scaling:1,samples:512,additive:0,usedots:0,spectrum:0,r:1,smoothing:.5,thick:0,sep:0},init_eqs:function(g){return g.rkeys=[],g},frame_eqs:function(g){return g},point_eqs:""}],shapes:[{baseVals:{r2:0,a:1,enabled:0,b:0,tex_ang:0,thickoutline:0,g:0,textured:0,g2:1,tex_zoom:1,additive:0,border_a:.1,border_b:1,b2:0,a2:0,r:1,border_g:1,rad:.1,x:.5,y:.5,ang:0,sides:4,border_r:1},init_eqs:function(g){return g.rkeys=[],g},frame_eqs:function(g){return g}},{baseVals:{r2:0,a:1,enabled:0,b:0,tex_ang:0,thickoutline:0,g:0,textured:0,g2:1,tex_zoom:1,additive:0,border_a:.1,border_b:1,b2:0,a2:0,r:1,border_g:1,rad:.1,x:.5,y:.5,ang:0,sides:4,border_r:1},init_eqs:function(g){return g.rkeys=[],g},frame_eqs:function(g){return g}},{baseVals:{r2:0,a:1,enabled:0,b:0,tex_ang:0,thickoutline:0,g:0,textured:0,g2:1,tex_zoom:1,additive:0,border_a:.1,border_b:1,b2:0,a2:0,r:1,border_g:1,rad:.1,x:.5,y:.5,ang:0,sides:4,border_r:1},init_eqs:function(g){return g.rkeys=[],g},frame_eqs:function(g){return g}},{baseVals:{r2:0,a:1,enabled:0,b:0,tex_ang:0,thickoutline:0,g:0,textured:0,g2:1,tex_zoom:1,additive:0,border_a:.1,border_b:1,b2:0,a2:0,r:1,border_g:1,rad:.1,x:.5,y:.5,ang:0,sides:4,border_r:1},init_eqs:function(g){return g.rkeys=[],g},frame_eqs:function(g){return g}}],warp:`shader_body {
ret = texture2D(sampler_main, uv).rgb;
ret -= 0.004;
}
`,comp:`shader_body {
ret = texture2D(sampler_main, uv).rgb;
ret *= hue_shader;
}
`};return h}).apply(n,i),c!==void 0&&(t.exports=c)}),"./src/equations/presetEquationRunner.js":(function(t,n,r){r.r(n),r.d(n,"default",function(){return g});var i=r("./src/utils.js");function c(y,u){if(!(y instanceof u))throw new TypeError("Cannot call a class as a function")}function h(y,u){for(var l=0;l<u.length;l++){var d=u[l];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(y,d.key,d)}}function f(y,u,l){return u&&h(y.prototype,u),y}var g=(function(){function y(u,l,d){c(this,y),this.preset=u,this.texsizeX=d.texsizeX,this.texsizeY=d.texsizeY,this.mesh_width=d.mesh_width,this.mesh_height=d.mesh_height,this.aspectx=d.aspectx,this.aspecty=d.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty,this.qs=i.default.range(1,33).map(function(m){return"q".concat(m)}),this.ts=i.default.range(1,9).map(function(m){return"t".concat(m)}),this.regs=i.default.range(100).map(function(m){return m<10?"reg0".concat(m):"reg".concat(m)}),this.initializeEquations(l)}return f(y,[{key:"initializeEquations",value:function(l){this.runVertEQs=this.preset.pixel_eqs!=="",this.mdVSQInit=null,this.mdVSRegs=null,this.mdVSFrame=null,this.mdVSUserKeys=null,this.mdVSFrameMap=null,this.mdVSShapes=null,this.mdVSUserKeysShapes=null,this.mdVSFrameMapShapes=null,this.mdVSWaves=null,this.mdVSUserKeysWaves=null,this.mdVSFrameMapWaves=null,this.mdVSQAfterFrame=null,this.gmegabuf=new Array(1048576).fill(0);var d={frame:l.frame,time:l.time,fps:l.fps,bass:l.bass,bass_att:l.bass_att,mid:l.mid,mid_att:l.mid_att,treb:l.treb,treb_att:l.treb_att,meshx:this.mesh_width,meshy:this.mesh_height,aspectx:this.invAspectx,aspecty:this.invAspecty,pixelsx:this.texsizeX,pixelsy:this.texsizeY,gmegabuf:this.gmegabuf};this.mdVS=Object.assign({},this.preset.baseVals,d),this.mdVS.megabuf=new Array(1048576).fill(0),this.mdVS.rand_start=new Float32Array([Math.random(),Math.random(),Math.random(),Math.random()]),this.mdVS.rand_preset=new Float32Array([Math.random(),Math.random(),Math.random(),Math.random()]);var m=this.qs.concat(this.regs,Object.keys(this.mdVS)),E=this.preset.init_eqs(i.default.cloneVars(this.mdVS));this.mdVSQInit=i.default.pick(E,this.qs),this.mdVSRegs=i.default.pick(E,this.regs);var S=i.default.pick(E,Object.keys(i.default.omit(E,m)));if(S.megabuf=E.megabuf,S.gmegabuf=E.gmegabuf,this.mdVSFrame=this.preset.frame_eqs(Object.assign({},this.mdVS,this.mdVSQInit,this.mdVSRegs,S)),this.mdVSUserKeys=Object.keys(i.default.omit(this.mdVSFrame,m)),this.mdVSFrameMap=i.default.pick(this.mdVSFrame,this.mdVSUserKeys),this.mdVSQAfterFrame=i.default.pick(this.mdVSFrame,this.qs),this.mdVSRegs=i.default.pick(this.mdVSFrame,this.regs),this.mdVSWaves=[],this.mdVSTWaveInits=[],this.mdVSUserKeysWaves=[],this.mdVSFrameMapWaves=[],this.preset.waves&&this.preset.waves.length>0)for(var _=0;_<this.preset.waves.length;_++){var M=this.preset.waves[_],R=M.baseVals;if(R.enabled!==0){var W=Object.assign({},R,d),fe=this.qs.concat(this.ts,this.regs,Object.keys(W));Object.assign(W,this.mdVSQAfterFrame,this.mdVSRegs),W.megabuf=new Array(1048576).fill(0),M.init_eqs&&(W=M.init_eqs(W),this.mdVSRegs=i.default.pick(W,this.regs),Object.assign(W,R)),this.mdVSWaves.push(W),this.mdVSTWaveInits.push(i.default.pick(W,this.ts)),this.mdVSUserKeysWaves.push(Object.keys(i.default.omit(W,fe))),this.mdVSFrameMapWaves.push(i.default.pick(W,this.mdVSUserKeysWaves[_]))}else this.mdVSWaves.push({}),this.mdVSTWaveInits.push({}),this.mdVSUserKeysWaves.push([]),this.mdVSFrameMapWaves.push({})}if(this.mdVSShapes=[],this.mdVSTShapeInits=[],this.mdVSUserKeysShapes=[],this.mdVSFrameMapShapes=[],this.preset.shapes&&this.preset.shapes.length>0)for(var ye=0;ye<this.preset.shapes.length;ye++){var Y=this.preset.shapes[ye],j=Y.baseVals;if(j.enabled!==0){var se=Object.assign({},j,d),Te=this.qs.concat(this.ts,this.regs,Object.keys(se));Object.assign(se,this.mdVSQAfterFrame,this.mdVSRegs),se.megabuf=new Array(1048576).fill(0),Y.init_eqs&&(se=Y.init_eqs(se),this.mdVSRegs=i.default.pick(se,this.regs),Object.assign(se,j)),this.mdVSShapes.push(se),this.mdVSTShapeInits.push(i.default.pick(se,this.ts)),this.mdVSUserKeysShapes.push(Object.keys(i.default.omit(se,Te))),this.mdVSFrameMapShapes.push(i.default.pick(se,this.mdVSUserKeysShapes[ye]))}else this.mdVSShapes.push({}),this.mdVSTShapeInits.push({}),this.mdVSUserKeysShapes.push([]),this.mdVSFrameMapShapes.push({})}}},{key:"updatePreset",value:function(l,d){this.preset=l,this.initializeEquations(d)}},{key:"updateGlobals",value:function(l){this.texsizeX=l.texsizeX,this.texsizeY=l.texsizeY,this.mesh_width=l.mesh_width,this.mesh_height=l.mesh_height,this.aspectx=l.aspectx,this.aspecty=l.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty}},{key:"runFrameEquations",value:function(l){this.mdVSFrame=Object.assign({},this.mdVS,this.mdVSQInit,this.mdVSFrameMap,l),this.mdVSFrame=this.preset.frame_eqs(this.mdVSFrame),this.mdVSFrameMap=i.default.pick(this.mdVSFrame,this.mdVSUserKeys),this.mdVSQAfterFrame=i.default.pick(this.mdVSFrame,this.qs)}}]),y})()}),"./src/image/imageTextures.js":(function(t,n,r){r.r(n),r.d(n,"default",function(){return f});function i(g,y){if(!(g instanceof y))throw new TypeError("Cannot call a class as a function")}function c(g,y){for(var u=0;u<y.length;u++){var l=y[u];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(g,l.key,l)}}function h(g,y,u){return y&&c(g.prototype,y),g}var f=(function(){function g(y){var u=this;i(this,g),this.gl=y,this.anisoExt=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.samplers={},this.clouds2Image=new Image,this.clouds2Image.onload=function(){u.samplers.clouds2=u.gl.createTexture(),u.bindTexture(u.samplers.clouds2,u.clouds2Image,128,128)},this.clouds2Image.src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/4RP+RXhpZgAASUkqAAgAAAAJAA8BAgAGAAAAegAAABABAgAVAAAAgAAAABIBAwABAAAAAQAAABoBBQABAAAAoAAAABsBBQABAAAAqAAAACgBAwABAAAAAgAAADIBAgAUAAAAsAAAABMCAwABAAAAAQAAAGmHBAABAAAAxAAAAGYFAABDYW5vbgBDYW5vbiBQb3dlclNob3QgUzExMAAAAAAAAAAAAAAAAEgAAAABAAAASAAAAAEAAAAyMDAyOjAxOjE5IDE3OjMzOjIwABsAmoIFAAEAAABWAwAAnYIFAAEAAABeAwAAAJAHAAQAAAAwMjEwA5ACABQAAAAOAgAABJACABQAAAAiAgAAAZEHAAQAAAABAgMAApEFAAEAAAA+AwAAAZIKAAEAAABGAwAAApIFAAEAAABOAwAABJIKAAEAAABmAwAABZIFAAEAAABuAwAABpIFAAEAAAB2AwAAB5IDAAEAAAAFAAAACZIDAAEAAAAAAAAACpIFAAEAAAB+AwAAfJIHAJoBAACGAwAAhpIHAAgBAAA2AgAAAKAHAAQAAAAwMTAwAaADAAEAAAABAAAAAqAEAAEAAACAAAAAA6AEAAEAAACAAAAABaAEAAEAAAAwBQAADqIFAAEAAAAgBQAAD6IFAAEAAAAoBQAAEKIDAAEAAAACAAAAF6IDAAEAAAACAAAAAKMHAAEAAAADAAAAAAAAADIwMDI6MDE6MTkgMTc6MzM6MjAAMjAwMjowMToxOSAxNzozMzoyMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAQAAACoBAAAgAAAAuAAAACAAAAABAAAAgAIAAEgAAAAKAAAA/////wMAAACK+AIAAAABAL8BAADoAwAArQAAACAAAAAMAAEAAwAmAAAAHAQAAAIAAwAEAAAAaAQAAAMAAwAEAAAAcAQAAAQAAwAaAAAAeAQAAAAAAwAGAAAArAQAAAAAAwAEAAAAuAQAAAYAAgAgAAAAwAQAAAcAAgAYAAAA4AQAAAgABAABAAAAkc4UAAkAAgAgAAAA+AQAABAABAABAAAAAAAJAQ0AAwAEAAAAGAUAAAAAAABMAAIAAAAFAAAAAAAAAAQAAAABAAAAAQAAAAAAAAAAAAAAAwABAAEwAAD/////WgGtACAAYgC4AP//AAAAAAAAAAAAAP//SABABkAGAgCtANMAngAAAAAAAAAAADQAAACPAEYBtQAqAfT/AgABAAEAAAAAAAAAAAAEMAAAAAAAAAAAvwEAALgAJwEAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAElNRzpQb3dlclNob3QgUzExMCBKUEVHAAAAAAAAAAAARmlybXdhcmUgVmVyc2lvbiAxLjAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAMgAuQC5AABqGADOAAAAgE8SAJsAAAAEAAEAAgAEAAAAUjk4AAIABwAEAAAAMDEwMAEQAwABAAAAQAYAAAIQAwABAAAAsAQAAAAAAAAGAAMBAwABAAAABgAAABoBBQABAAAAtAUAABsBBQABAAAAvAUAACgBAwABAAAAAgAAAAECBAABAAAA9AUAAAICBAABAAAAuA0AAAAAAAC0AAAAAQAAALQAAAABAAAAaM5qp6ps7vXbS52etpVdo/tuYZ2wtrDFXnrx1HK+braKpineV1+3VFWVteo72Poc/9j/2wCEAAkGBggGBQkIBwgKCQkLDRYPDQwMDRwTFRAWIR0jIiEcIB8kKTQsJCcxJx4fLT0tMTY3Ojo6Iio/RD44QjM3OTYBCQkJDAoMFAwMFA8KCgoPGhoKChoaTxoaGhoaT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT//AABEIAHgAoAMBIQACEQEDEQH/xAGiAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgsQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+gEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoLEQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/AOdCcU4R11HMSLHTxFTAXy6PLxQIUJTglIDo9KtbWzjScNvnK/gtao1FkycjaO1ebWvOWvyR307RjZfM5zXoraacTW3DtkyD1PrWathui39q66cmoK+60OacU5O2xA8ZQlT2qBkrdfmYsiZMUwpxVCImXNRMntTERlaaRg0CN5Y8iniOszUlWOniOgQhj5o2UwDZS7KBFmAuoCnIAq69wUjIHPHWuaok5HTBtIqrbzXCMyAEDqCarPvGV6Yqlbb+Xch337kBTOd1RNHxgCrc+xKgNWAPxyD2qCWMAY7g81UJ83yJlGxCy4qJlzWqMyMpTClAjoxCUbDCniP2rK5qOVKkEdMA8ummPmgA2Vd0m1S4vMTIXjUEtjtUzdotrdLQcFeSXQfcQqJ2y/GaZL5fkhE5Y9TXPFt2Zu7K6IUinVWVW+XvjvSNCsceScsa0k1067kRT69NisY8mnC2YoWA4qL2KtcglyjcVVdd78daqnK3zImr/IheFgTkdKiZK6ou6MJKxGyUwrTJOxmjaS2WYqwjLHbnp9KBaeeB5MbZxzXLGVlfotzpcdbdXsQiKniOtSBfLppjoTE0NMdPiYxElSRmiSurAnZiSMTzmmKSDmpUdCpS1NvT0TUoHEjpGQcYC8n3qM6MJdxgYuF46VyyfI2ui6nQlzJPq+hDPo0qcKNz/wB0U54Es7co/wAzkcgdAamU01ZbtjUWnrsjDn+dzxiqpjYHK1aZDHJGQmM9ahe2zk+lbU5WZlOOhWZKjKV1nOddYTPLpptjztbcB2NTBXibaSUOOma4IWt+h2y3/Uj8rmlEdbJmLQpTjpTNlNCYnl00x1RI0x00x4oARd6tmPIPtW1o+uf2fGd+GORlcdffNZVaaqRt1NKc+R36HQxWsWoqbmGQ/MMkg4rL1bSdi5UV5fM4ys9LHfZNXXU599Lkd+FNMbSzGPmHNb85lyFaS32HgUx8pGcqK2g72M5aGY8fPSomSvRRwndafZfYtRCzL8rHFaPiPTTHKlxHGEjKhTj1ryKU/wB4uzR6dSPuPujF2YIzTxHxXamtuxyNPfuIY+KYY6okDHg4pHQIMsQKLhYhV0dtq8mr6aQ8loZRy390DNZVKqgr92aQpczKcd8+nXefLHAwVI6028nt7mTzIY/KJ5IB4qI3UuZO6fxIuSTjy21WzLmjXs9rKFidgM/dzxXTJeRECC5ZN5XPWscVTTlePxM0oS0s9kUriaIEiIKAPzrFup/3uBzmopU3fUqc0isTEQWftVWZ0dPlWuqNNr0RhKafqzOlh6mq7x12RZytHqssMcwSfy0wwyDuxRq2oCew8gxjdx1HT3rx6Uby9GenUdkc/wCSpPzdaV4WVeFJru226nLv8iFVc/eXFKYsCqi7omSIjHzS3EKSRZBJbHNOWwRMp4WjO/O0Z4NWUubuGParnafSsXFS0ZonYRo/Pwzcmk8gL0FbQgkjOUncfFK9sSU4JpkkzO+7Jz9atRV7mbk7WHpczAcOT9aUqzgu3Ud6lxSd1oylJvRkMgDZJJzVSTK9KqKJbIGJqJlzWiViG7nfW1/ZK8XJUDqT0q9q08V2sRiL5HAG35SD3Bryaalzps9KduWyKt1pjWoXzG2uRnkcCs+8ee2YKJUbIzx0Iq/bXemiRPs7IY15Ey7m+TA5BrPuNUDIyCMDnhs81rz3SsZ8tmXbFDe2DTKVzHwyk8n6Vl3944Zo04A7jvT9pp5oOTX1Mp5GVsnmtG21aEQKkikFRj604SFKJOmpWrHAYr9RUjMGXKcg9xW0WmYyTREwNN281qZkqphQRwacCMYPHvUPUpCPGhXORmqU0fNEXqEkV2j9qjKVoQa+GAALE47VPDezRYUOdo7V5CkelY0pb+eayOJt4PG1uSKxpEkQkkmp0T9StX8hnm5GCM1GUBzVXsIj+deFYge1NMTueuapyJURr2jMvTmqclq4PK4ohMJRIhGwNadgLolUjDMvcVtz217GfLc2PsuSQQdw7Uw2pU/MCK6FU6eWhg4afmWLeKFkZJcg9mFRzac8MSyMRhumKnns7PZvQOS6utLblaRMLyR9KhkhVVBDZzV21TFeysVXWoiK1MjttV8O/YWyXVgegFZRsTu4FeHdp2e63PWSvqupZtrbadpHFPnst4xgVDlqUkUX03ax7VEbNd3ByapSbFYDYKw4PPpTv7LdT0wRVq703J0XkBtlU7Sy7qje1yMMtJpoaaZWbTCZOB+FdVo+n/ZrRXaEh/pwacptxEo2ZZfRBLmQNskY8g1lXmm3VsS4IZaaxDvZ9NifZK35mUZbp7odD6jGK3jcotogmgUrWsp3tZ2sTGO+nqZr3Flco6JEEdc7eetLDoElxEH81Vz0FbQrOEby9530MZUlJ+7ppqOOgRxDMrqcdumaqz6Xa55YJnphqaxE5PRadgdGKWr17nd+cl4VFzGHAq0NEspRuRNp9K5vYxm3e6b2ZvzuK027CroNsPvLz6iql7oICFkOQO1RPCuMbp3a3Q41ruzWj2MG604xZJrInQoSVHPrXPB3NZEYlm6bM0gup0+SQttPXmt42W25DuRTW7ht6qXX1qxZSSSttZcqPWrjJPfXuiWrbGgFiADHBxW9p1z5dv8AvW3J2B7VbUeXuQnK/kM+0SyTt5GSg/ic8VUv7xpodrDn26Gs5wj0+LqXGT67dDFWLEhfkGo5nklyrE4qlC9vwJcrFRbJVl3GtO1njhTqQR61u4StYyU1civ7sSLtAJ981kSLnPJrelHlRhVlzM7yLTdTtJuu9Qe3NdBbGUorMFJxz2NcFPnUrWO2XK4lsdKCARg13bmBSurCGU4aMtn0qjJ4Xt3YnP0GK4pYbmk+X3bGyq2WvvFKTw5IpIRAR61Fc+Gttvvfn1GOlYeynHVq1uprzxfzKcCW1mdroXU8YIqQR2KA7AxPUgDGKiz3TKutjPnjic74jtB9TzT4p58Bc7yOm6tItrfoQ0mWEubtZf367l7DtUqq1w24gKg6kDpW0FFrm7Gc207dynKqqzAoOehFVmhLdFJ/CumKtuYN9gGnzuPlibmoXs5VJBXkH1qlVjtdEezlvYimtJEXLow/CqErIDWkZp7WZEotbnrsTkjrmphz1rGDutdToloxaK0EMkU9VGSKRDIQd4A9MVm+ZS0+F7selvPoNDuHw3T2oJWUlWH50r3Vn1HtqjG1LSmVS6DdzxxWQ+nTSTcghjXBKPs3Z/I6IvmV/vK7aWYptsp2jua0LG3tllLQZkK8dO9C95227g9FfcmuFnnUrtyF9BUthHhfLkjO0n14zXToo2WhiruV2JqFtFGNyxoSPUVztzrdzBJhdoVewFZJ8zs3dLY0a5dVu9yCTxLKUPyDd2NZE+tXDyF84J74rSMEiJSbKFxqFxMpDyuQe2azpN3dj+dbRlbYzkr7nvCJkYxsP95eDUqxyA584t7EVnTi+j5fLoaSa66+ZOM45orqMgooAYwqNhis5DQ0yMBio2Zm7ZrNu+5VrDNizPsdFI9CKjNrDCuEiCZ6kcVlKEd7fMtSe34DY2jV8YKknvzTLqUQcs+PwqJuyuVHU5TWtVeaX5coq/dGaxpLxpUw4zjvRFKwSepAF85SUGcdRVeaJh/DiqvZ2JsZ86sDz0qBo2xu/hq0yLHvy9KeK2pkvcdRWogpM0AIaYwqJAhNq1FcPKoHlIHHesZNqPu6vsWtXrou5HuK5YLzjjNZ1/c3YiIUZX+8vauec36LqbRivV9DNivriYlWOdo6HmrxleWIBgDx3HSpaugvZmDqFuWYgwKSPQVlsjxIym3BUgjmoXa+xT7lSOzd3PkAq3YZpby8vVASeNendBzWukt+nUz22Jo7S2v4A3lFGxzg1Rm0l4m+UMVPqKlSa03Q2k9T/9n4qqwQ2C6FUcJKhVwpbQ1vCsihOUlK0km1lS0VoSE2qiF4TrpDJE0aZJK5EgBF7pQGeoyWHrHyLxlrwklpeaZbWWmyFkkIa43/2P/bAEMAAgEBAQEBAgEBAQICAgICBAMCAgICBQQEAwQGBQYGBgUGBgYHCQgGBwkHBgYICwgJCgoKCgoGCAsMCwoMCQoKCv/bAEMBAgICAgICBQMDBQoHBgcKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCv/AABEIAIAAgAMBIgACEQEDEQH/xAAeAAACAwEAAwEBAAAAAAAAAAAGBwQFCAMBAgkACv/EADcQAAEDAwMDAgUDAgYCAwAAAAECAwQFBhEAEiEHMUETUQgiMmFxFIGRFaEjQlKxwdEW8ReCov/EABsBAAICAwEAAAAAAAAAAAAAAAUGAwQBAgcA/8QAMREAAgEDAwMCBQMDBQAAAAAAAQIDAAQRBRIhMUFRE3EiYYGRwaHR4QYU8BUjMnKx/9oADAMBAAIRAxEAPwDNEamJCR8v9tT4dJ3Zwn+2rSHStzaVBvOrSDShnBTpvDYpbIBqsi0QKRn0+QO2uwpJQQCjRFEpR8D+2uj1LIXjb/bWwfmtNvFDqaWE/LsHfXZFNB/y6uVU75uUjj7a6NwMfMEfjWd3Fa0f/DB0mtK7KpIum8KgUxqQ+0pmE2EqMlzOQFA/5MgZ/J1q2L1glUxsPtIbbitNpW80EgbwSO+PGsWWjUqhRZy/0Tqkh1OFgH78aaKLzm0i28SnlLddYwk+wGdJH9QafJd3QLtkdh4802aNeRwWxCjBHU+aA/iosex//ktysdPnN8SpAOymM/M1IUo7/wD6k8jS8uTpxPthCJL3yuJSFKGOwPY50wavS7gnU3+vro7i4QXkyA3naoc86FrhnVGqpQl1SvTI5QVZzycHR6zkmiiSMvkLwSevtQe7WJ5HcLyeRS/q0BHqLc9NIKjyB50Pz6cEkkj+2j2qUlDRWfrJSQEgdjqqRbKKkVMJe2uBO5KSngn20SW9t1OC1DjaTsMhaBKhBCWt23A841QVGnBaiQ3n86O67TGWigR1bsg7hjkHPnVFNiJSgpIyc8DRBDxVRhjigmVAAP041CcaW2rcgYI9tE82n5PCedVkqAUkgJ1uQDUXfFaZplIUMsqb2kHke2rGNSylf0g8+2j2rWvRZtbjvxXY7EV14tuymdxzknCiD9hnge+oU+110+WtoLS4hKylDiBwoe/+2gkVysgB80akhZCQao4lMCk528jXRykKJ3bfxq8jUopABT31KXSRn6NS7sVFjihNVM+Y5T24zr1FPIVt26I3aUoEkA9+2uCqaUuDKdShs1oQM0bVvpPAtizaDUKLKVIVUYaZcxTrQSpl4jBQPOE/7k6rK1QUU213PUmJVLeWG4zTSgoff8Ht/Op1239WbjjNqqMgKDLKW0hCQkAJAHYceNC8aprVNbW+nKErG7nxnnGlyG3vJcvIckHP8f4KNyz20QCxjqP4rlFq98KoZs5ptxmKuQQ4kZBK/PPtjx21U3NbopREMhKlgfOQex9taAhdK3uofT7/AMo6eUh2PBElXqOyn0bFKT9XJOQRuHccg6BKn0RvByUUyqI+pxbZWnCchSQcZyOMZxzqs97E5IwFweR3z86nS0dFByWyOD2x8qULduuOOfIwVcZOBquqaEUV9t1EMBQz3HjTz6c9OpUibLl1aKGIsMelIekfKncoHAB8nj9tK/qfDpiqu9Hp3KWyQCR3++q7XStcel4FSiAiLf5pTVmEhcl1aOQok8e+h2bTVBZJGD99HAYnQZKxCYSXHRt3LQFAZ+x17XBbjT0VpLURKNqcFwJ5Ufvpms9VUuEfvQC609gpZaWMqAcnjzxqslQwBx+2jGr0ZyI6WHmsKx/OqaXTu4KfxjxpgBDDNBDuU1t2HUKReHSW0yqB6D9NEhh+Q0jIWvcFBC/bgkhX3I8al1mQ5ULdj0gUeKw2zIW6hbKDuJICeSSf9I0c/Bn0Pi3xcL1o1iSmP6chKz6qcjaPlPB78Ej99D9etp63K1OtySfUMSU4zuAwCUqIz++Nc70q8huB6SHLJz9yaeNQt3hbe3Rhj7AUJMUc8fJru5S0+n9HI99EcOkFxO5ScY9hr2k0hIbPy+PbTCX3UEA2mg1ym7gfl51Hk0rCdwbOilVLUkkFGvC6SVEkI/IOrAkAqBlNBbkJQQQnODxqK7TFIPKNGTtFZS4d+AAMnOvU2dPqEN6bAhuuMxwPWdbbJSjPbJ8aw9xFEMk4FeSOSQ4UZqNY/V26LLpj1qR5CjT5K8uhP1oJKclJJ4+ka2DZLVgdROlbVDtKII9wohsKeDxG8Mn/AD4BI2naPPdWsxdOennSm511K27kulcCqlgKpUpxQ9FSwPpV7A++ovTq+Lw6IdUGJcSWmQuG56DjbUrc082T9IUONvn/AI0rana2msB1tjtlX4vG79x2/wDaYLO4udM2mcZjbjzinj1f6PXNEtfDtIYjts8+nETj1FEY3qz3JwNZJvGw566u4n0FbiTu419Ird6o2r18oaWnIiYr8mKlT0dXdteSCArGCMAY/wCNKq8ehtl2tMcl1LY8+SpSGkjsOcE/9aRrbULm0maKZfiHamiW1huI1dDxWGHOmU9tkPyIpSM5STqGKHBTIEea2VJB5GtFXzCob812AkIbUjgADHGgWo9OY7Sf1jrjYDhJQpRxxpktbidjlxig08MSjC81nbqPSKe3Wj/Twop9IbwrsFew0HzaeE8lPfTav+22WqissELUSd2DxjQRVKQGx8qPyddMsJA1qgz2pDvEK3LH519dunnRiPZfXiDc8OoxUU1x8IdUy6NqwrIBx3wSM6B/jNsG2aZ1fdlW5LbWJ0Rtx5pAyW1425J7HIAOmjYxrN8yqTb9UoEanKXT0h+ey8lTrxGcKScZRn2PnzpWdXKVKYvqo0559+U7EfLSJMiOW3HAnspSTnx57Ec65F/TyYuid3IGDjx710nV2zAo28Z/X2pVU+2JMJrZIVk9xrg6xDkLWww8lS0n5kA8jRo7NtiAwpF0SVNEK+YIQdwGq9u16ImOzWqO8l1qWne24MHI/wCD9jpvhugGEakEDrzS/Lb7gXYYJ+VCS6c5HUHkJ+dJyCR2OudJpEya86zGirce27m/TTnGOSSPbV7dM2FRkw0uOMqEuQWfkeSVIUMd0jkdxqM4HqK8qR6oZ9MEOlRxgeQdXBcJIp2HmqZt3jcFhxShvufX6ZWQuS84SlZJaSOMZ9tMzpz8RVmUmy5do120UuNPJBSyklG5eACSR3yB2++ll1F6rW69WZKItHTIUUFDD7rpGxefqwO478atrNtyFeVoR6o84gPeotC1NEDJB4PbQie3W/X02PGc9aKRTf2R3gVUXJRH59xuVSgRzGZcXuQ2CcIB8DXWHClMOIdlLKlA5yfHPfRk1bbkOElp9e5aBtzjwO2qmpNMxspTjPuPGjVnZpGB5FCLq7eQkY4o+HXyRYtowaBY4ALMlt5ySpeVhSQNwPH0nAI9hka6TPiakXWt2Rcqn23HUkrDaApJXwMjz7/zpRyWSpzcPOplOghLaHZLSi2VYCgNYk0PT2G5kyx79+awurXoOA3HjtVjWqgqq1FdVUVqbWCGyDhQOPOhK6KnV3VoVJdWG0AhAHkaNJUQrpbcVLSAVnd6iOVHuMaFrnp0tpKv1BJUgYIOpLeKFTtA6cVFNNKRknrzQLV5sV1agWjz/mPfQjVYSFLUWxx4zorqsBwun5cA6qJEEkH7edGIY1iHw0NkdpDzWvLB+KW9rXr0OpN1x55tbXpTQtsbkoOAQkqBwQBweccadHTfrT0wrFz1K5ruuWfOcl00x4s2SylTsde0JCl+OEgpBHP2GsvVG0ajCfUw7CIKDjKRqw6eyKjb9cbdMcPNKc2vMujhSc9jri6Tw+myrhdwwSPFdSaNyyk84OaPut/WO1oTkuzG6PFmul8LYrDBO5SMHIVu5UVcfg9u+l1Gvup0+lLRb0v/AA8ENtvEkNk8naNEd4dNl1J1+tNx0oU4srS0Owz4GfGltMo1VgTDGfWpKEqzwO+orW8WIARtgit5oC+d65BoaqIqqpSprkle71crKlHg50fdVevFq31ZdPt+NbyoU+PT249RloUNstaCT6pAAwo55P2Gh1+lSnt7CmS5nJScarUWstThbciFWOT8vYaIJqWcFjyPzVVrME4A4oErdLE1tamV5JOQfY6pqZeN22Sp1mkVd5lLowtKF8HTjh2HBfaSEIBJByPbQ/cnRhLzS5cTJOSSlQ7a2ttYEUmCaxNp5kTIFD1rfEHekScluoTjKaUseo2/yQnzg+NNinTqPdba36FN9cJA9RJGFJJ5wRpNW/02nTa81SGYpLrrwQkbfJONao6f/C3UunPTxd5Sn1LefdQlUb0+R3IP8aY7bW0jnRC3/LigdxpfqRMwHSl2/RH23Ni2SD7EauaRa1RlUaRLjxS4iMAp7YeQCcZx5AP8Z0aVyg0RgNvSZxafWfodSBzjjj+PxrzRK43aFX/Rwq9CccqLKmlNMvhRJIKcKT7j799GG1ZJIvhI3ePahY0x1k+LO3zS+juvtOBpvCcqHJAONV931CVP+R2GhWVY3oRjb/Gn51R6ET0Uin1i0LUHomIgyW2RvWF4PJH1DPck+4xxxpS3ZR61Zlddi16gNtnaU+m4nKT9xrW3vYL0BoSN3jIzxWJbSazOJQdv1xSlrFLbSokg5OqWRBSXDuIH50dVKmVCrOLMOEpz8J7aoa9Z1w0Vaf6tRZLBcA9NLjJG7PI/9aPRyDAVjzQhkJOQOK+lfxU/DzTVXM2enFkf4D6C4+7FbKxu85OcD8AaTUH4erjaeLrNGcSsKwpBbP8AbWtOiV5zKnVG00SptyUrOFpS8FA/YjPGnW3QrdrITOcpLaXQQTubwQR7++uKLok12zehIBz0I4x8iD+mK6h/qKQKokQnjrnmsCu9MJ8ajpZqNLWktpwoKTpe3TZtDZlrUI+1e3JCm+M6+md1dN7VuuCqPPpTW8NkNrQkAg447ayz1t6Ff0FMh5qlrKjnZhPnGhGqaZe6RIDL8St0I/Pir9nfW98pAGCOx/FZFbpkB2oKQ5BbbU2rAUrhK/tqxj2pa8qQp+tPMw1hISyMEpd57HGcHnPtgak3h0/uKbP/AEkeI6CFH6UEYOqef0lvNcb1XZDoWk7kJUrnOtreSHgsRXnVyOBXpd67Jst8xKdHMtfqAKLY+VQ8lKh3/OuUe2oVxRjPpAzv5LDn1t/Y++ulF6e1y9YZtp9paKgw5hlwpJ9XOePznU/p70tvqgXO8K3EfZEMFBTggLXgkDH7dtEi9hM2w4WqoFzGu5cmudk9B4NWvmImcoRGluBTkoJ4SnI5/OtnMdO2rdZgVKt1mNJgtsJERQQPTkYCRtxyO2SSeTu1nqk3TETV4dKVFTGUtwpkGQsJSnHPCjxp41S9alWbWVY1syI7UVhLf6mXJeAbYHOTvP8AqHAAz286llsrV1TEmfwKhW5uFZspj8mqjq58PfTe6KC7Vo8KNGU2hS1ORlggr5OMDkcax3UulMFfUVuO5MUhppe5DxPbHOONa2u2NVKBSlMUCVNkMuR0plPvpAaWvn6M4OPzpL1C3pcOovOymwXSFbVBOdufI/71pY288UpEDllPT81m5nieMGVQDUTqj1OrNm2221bF3PrdRGLLxaePJ5899DvTLqJROq9VpznVGC++mG2WnGwCQ8rOAT5z7/jXpUbcW+46mpI3kqyk9+NelvvtWe4h2nx0ZQ4CpJT3HnTFp2n3CpvHXnnoaDXt/AW2k8ccdRTerNsdGbepiq7SbPZSQz6qmxFUSkHt4IHP99KK7OtdlxnltsUKS4VEpfadOAMdsfcHVldvVKtVOkriQ3VRy4r/ABdijhQHYY8aUldil1TinkBSl87jotpmj78tdkk/9iaGX+rCMhbYAD2FfTe1PgzqHT+7UXJatwF6M1IC22ivDm0HI5Hn99Puh0+RTssKqLzzeMpTJBKk/bJ1CtaWzMbJizUOBBIWE5BB/BAP76vmySnn++hul6faxH14iefnkfT5e+aLXl1O/wDtv2+VedVdx04TlMtoajFS1FCvXZ3ZSe+PY41aaj1GK7LjlEd703ByheOx0VuohNAVxmqcTbJAaD698P3TisQZDDVDbZfeOQ+ngpP/AFoJY+Du3xUkzKrLalsDOWcFOD+f402Y9MqzVLdaqNS9V8kltxJIIGOBqPGl1OBGcDzO9RPClL57HQKXR9JkZXaDZx24+4HFEEvrxAVWTPv+M1k7qf03c6UXG5Kt+2W3S0slmSpsgd+/PfA/31VT+rw5XV7Tgxqi9HLzsh5IWXMA4wk8Jz/61qfqf0ypfUSkqnMtgzWo69iSTySOBrOVT+Fy8H6k2xVqTIbS4fmf2ZShOlG+0xrOUqyZU9CBnj+KN214J1BBwR1FI+5axbN0SRL9L0pTqgXGkNYQhWPA0QWv0pvrqJRAqgz5amow/wAJv1fkGMnsfHJ0Vv8ASGj9La+5Vbzt+XLisglpLUc7XecABXj8nTHoTFTdsaIbcguUlh0BSWW1J3ZcAyFecD/nWbRTI/pxnbjz+1YuJPTTe4z7UtbWoF2XPOYtepy1L/TIUpwOOhKUJQMq559j/Oqu+qXW4tYcRS6bMQzKQENMrQcqTjgcDkeR9tN+2enl4Wncypj8OO+AMu5SpaCnIzyPOrvrrU6bS7f/AFKKm1FfWgpSoqSTvxnA9iNMM+orZlSoDADH17mg8Nm90DklST+nYVmdfQq/6q4hX9CDKXRu3PvISEjPcjOf7Z1X3T0BlW/SHKtU7jhD0nQhxDIUoJ9yTjxnwNBV/dYep9r3K8+xXpYCuEoWtQBTnjH2Ol31P+IPqddDCI8utO7UIx6bR2p/cDv++rKanqbspVlA9v3qBtPsVBDBif8APFMWtWPSqdTnahIuultpwfSbmv8ApKUARhQye2Of20lbs6o2bDkriqrsJWxW0rbVuSr99ANzXLXZ29dSlur+XlS3CdLyvRW1rWsOg55I76MWupyoT6jbvpihtxp8LD4Bj61/RJHoRq8ZmNWFvJWyrcxIjultxP7juNXdEoJouRFqT7rSvqTJXuOffOvaIT6YBJOBxnU9ogpwBjVbTrSDAkxyMc9/5q7NcSOSvbxXtr9r9r920ZqrXhYBSQdQJjQIJx+dTVup7ajSNqknPtqCcAx1lTg5qllPvxcltwj8agSnqpIQSEuqB7nB51dqYjlRLo75BP2xquu+ZckWnoNqw0StqgH2lOYUUeQPzoHM/pRM7E4HYDJ+1EEw7hRxnueB96rabFcqrkmPJa9UNoBLK+x+bng9+NU9woj0+Utb1vtObAMteiR6ae+5I8du+plWqFah0t5VKbEV1xW4uuIO5IA4Bz986z71mvbqpRbmTUaqX429sNhyO4r03BnIWOfIxn8aA3N9CsigDnyen3olFayFDk0665W4Eq1v69HlyC00raWmlBSkKzwSPtwceQdYw+L3rDWLhqggJQ41FiI2RcnBWc/MtQAABJ8eO2tAWXcl2/p3WX3S4pwpVuWySl3I/wD1pQ9erfrM2c+0i3I8sFBcQtMTkI7c7e3PvoZNcPHcCQjj371aiCPGUB5rLNfviqyKYiTU2VrbQdiXHBnIz21CqNq1WpwUzaPDMhtxsLCmkZwD747aOLwgXNHt522avZjQiLWHEEp+dsDcBt9uSM/jVFRLZ6vWBSZF2dNHZSIzzKm5jbRStSRzwUkHgZznHfVxLkyLxgH9DVdo1j6nIpK31QaoylfqMEEDCgBoHl0OU7HVUm2VpS3wpvGc8d9ak6WVGL1IdnW51Ht6NMmuO+ozMGGHMEYKSBhJAPIOO5OfGqC//h1doNVcnUOnThGUopKS0HAoc9iO/wDHjUqak0bGNxz+lQtbK3xrX//Z",this.emptyImage=new Image,this.emptyImage.onload=function(){u.samplers.empty=u.gl.createTexture(),u.bindTexture(u.samplers.empty,u.emptyImage,1,1)},this.emptyImage.src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs="}return h(g,[{key:"bindTexture",value:function(u,l,d,m){if(this.gl.bindTexture(this.gl.TEXTURE_2D,u),this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,1),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,d,m,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,l),this.gl.generateMipmap(this.gl.TEXTURE_2D),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.anisoExt){var E=this.gl.getParameter(this.anisoExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT);this.gl.texParameterf(this.gl.TEXTURE_2D,this.anisoExt.TEXTURE_MAX_ANISOTROPY_EXT,E)}}},{key:"loadExtraImages",value:function(u){var l=this;Object.keys(u).forEach(function(d){var m=u[d],E=m.data,S=m.width,_=m.height;if(!l.samplers[d]){var M=new Image;M.onload=function(){l.samplers[d]=l.gl.createTexture(),l.bindTexture(l.samplers[d],M,S,_)},M.src=E}})}},{key:"getTexture",value:function(u){var l=this.samplers[u];return l||this.samplers.clouds2}}]),g})()}),"./src/index.js":(function(t,n,r){r.r(n),r.d(n,"default",function(){return g}),r("./node_modules/ecma-proposal-math-extensions/reference-implementation/index.js"),r("./src/presetBase.js");var i=r("./src/visualizer.js");function c(y,u){if(!(y instanceof u))throw new TypeError("Cannot call a class as a function")}function h(y,u){for(var l=0;l<u.length;l++){var d=u[l];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(y,d.key,d)}}function f(y,u,l){return l&&h(y,l),y}var g=(function(){function y(){c(this,y)}return f(y,null,[{key:"createVisualizer",value:function(l,d,m){return new i.default(l,d,m)}}]),y})()}),"./src/noise/noise.js":(function(t,n,r){r.r(n),r.d(n,"default",function(){return f});function i(g,y){if(!(g instanceof y))throw new TypeError("Cannot call a class as a function")}function c(g,y){for(var u=0;u<y.length;u++){var l=y[u];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(g,l.key,l)}}function h(g,y,u){return y&&c(g.prototype,y),u&&c(g,u),g}var f=(function(){function g(y){i(this,g),this.gl=y,this.anisoExt=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.noiseTexLQ=this.gl.createTexture(),this.noiseTexLQLite=this.gl.createTexture(),this.noiseTexMQ=this.gl.createTexture(),this.noiseTexHQ=this.gl.createTexture(),this.noiseTexVolLQ=this.gl.createTexture(),this.noiseTexVolHQ=this.gl.createTexture(),this.nTexArrLQ=g.createNoiseTex(256,1),this.nTexArrLQLite=g.createNoiseTex(32,1),this.nTexArrMQ=g.createNoiseTex(256,4),this.nTexArrHQ=g.createNoiseTex(256,8),this.nTexArrVolLQ=g.createNoiseVolTex(32,1),this.nTexArrVolHQ=g.createNoiseVolTex(32,4),this.bindTexture(this.noiseTexLQ,this.nTexArrLQ,256,256),this.bindTexture(this.noiseTexLQLite,this.nTexArrLQLite,32,32),this.bindTexture(this.noiseTexMQ,this.nTexArrMQ,256,256),this.bindTexture(this.noiseTexHQ,this.nTexArrHQ,256,256),this.bindTexture3D(this.noiseTexVolLQ,this.nTexArrVolLQ,32,32,32),this.bindTexture3D(this.noiseTexVolHQ,this.nTexArrVolHQ,32,32,32),this.noiseTexPointLQ=this.gl.createSampler(),y.samplerParameteri(this.noiseTexPointLQ,y.TEXTURE_MIN_FILTER,y.NEAREST_MIPMAP_NEAREST),y.samplerParameteri(this.noiseTexPointLQ,y.TEXTURE_MAG_FILTER,y.NEAREST),y.samplerParameteri(this.noiseTexPointLQ,y.TEXTURE_WRAP_S,y.REPEAT),y.samplerParameteri(this.noiseTexPointLQ,y.TEXTURE_WRAP_T,y.REPEAT)}return h(g,[{key:"bindTexture",value:function(u,l,d,m){if(this.gl.bindTexture(this.gl.TEXTURE_2D,u),this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,1),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,d,m,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,l),this.gl.generateMipmap(this.gl.TEXTURE_2D),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.anisoExt){var E=this.gl.getParameter(this.anisoExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT);this.gl.texParameterf(this.gl.TEXTURE_2D,this.anisoExt.TEXTURE_MAX_ANISOTROPY_EXT,E)}}},{key:"bindTexture3D",value:function(u,l,d,m,E){if(this.gl.bindTexture(this.gl.TEXTURE_3D,u),this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,1),this.gl.texImage3D(this.gl.TEXTURE_3D,0,this.gl.RGBA,d,m,E,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,l),this.gl.generateMipmap(this.gl.TEXTURE_3D),this.gl.texParameteri(this.gl.TEXTURE_3D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_3D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_3D,this.gl.TEXTURE_WRAP_R,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_3D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_LINEAR),this.gl.texParameteri(this.gl.TEXTURE_3D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.anisoExt){var S=this.gl.getParameter(this.anisoExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT);this.gl.texParameterf(this.gl.TEXTURE_3D,this.anisoExt.TEXTURE_MAX_ANISOTROPY_EXT,S)}}}],[{key:"fCubicInterpolate",value:function(u,l,d,m,E){var S=E*E,_=E*S,M=m-d-u+l,R=u-l-M,W=d-u,fe=l;return M*_+R*S+W*E+fe}},{key:"dwCubicInterpolate",value:function(u,l,d,m,E){for(var S=[],_=0;_<4;_++){var M=g.fCubicInterpolate(u[_]/255,l[_]/255,d[_]/255,m[_]/255,E);M=Math.clamp(M,0,1),S[_]=M*255}return S}},{key:"createNoiseVolTex",value:function(u,l){for(var d=u*u*u,m=new Uint8Array(d*4),E=l>1?216:256,S=E*.5,_=0;_<d;_++)m[_*4+0]=Math.floor(Math.random()*E+S),m[_*4+1]=Math.floor(Math.random()*E+S),m[_*4+2]=Math.floor(Math.random()*E+S),m[_*4+3]=Math.floor(Math.random()*E+S);var M=u*u,R=u;if(l>1){for(var W=0;W<u;W+=l)for(var fe=0;fe<u;fe+=l)for(var ye=0;ye<u;ye++)if(ye%l!==0){for(var Y=Math.floor(ye/l)*l+u,j=W*M+fe*R,se=[],Te=[],Ae=[],ze=[],de=0;de<4;de++)se[de]=m[j*4+(Y-l)%u*4+de],Te[de]=m[j*4+Y%u*4+de],Ae[de]=m[j*4+(Y+l)%u*4+de],ze[de]=m[j*4+(Y+l*2)%u*4+de];for(var we=ye%l/l,ce=g.dwCubicInterpolate(se,Te,Ae,ze,we),he=0;he<4;he++){var Pe=ye*4+he;m[W*M*4+fe*R*4+Pe]=ce[he]}}for(var $e=0;$e<u;$e+=l)for(var He=0;He<u;He++)for(var et=0;et<u;et++)if(et%l!==0){for(var Ve=Math.floor(et/l)*l+u,Et=$e*M,Nt=[],$t=[],Ie=[],pe=[],Be=0;Be<4;Be++){var O=He*4+Et*4+Be;Nt[Be]=m[(Ve-l)%u*R*4+O],$t[Be]=m[Ve%u*R*4+O],Ie[Be]=m[(Ve+l)%u*R*4+O],pe[Be]=m[(Ve+l*2)%u*R*4+O]}for(var z=et%l/l,k=g.dwCubicInterpolate(Nt,$t,Ie,pe,z),L=0;L<4;L++){var ne=He*4+Et*4+L;m[et*R*4+ne]=k[L]}}for(var H=0;H<u;H++)for(var De=0;De<u;De++)for(var Ye=0;Ye<u;Ye++)if(Ye%l!==0){for(var qe=De*R,Fe=Math.floor(Ye/l)*l+u,Ue=[],Ke=[],tt=[],nt=[],dt=0;dt<4;dt++){var Gt=H*4+qe*4+dt;Ue[dt]=m[(Fe-l)%u*M*4+Gt],Ke[dt]=m[Fe%u*M*4+Gt],tt[dt]=m[(Fe+l)%u*M*4+Gt],nt[dt]=m[(Fe+l*2)%u*M*4+Gt]}for(var vt=De%l/l,Tt=g.dwCubicInterpolate(Ue,Ke,tt,nt,vt),yt=0;yt<4;yt++){var Zt=H*4+qe*4+yt;m[Ye*M*4+Zt]=Tt[yt]}}}return m}},{key:"createNoiseTex",value:function(u,l){for(var d=u*u,m=new Uint8Array(d*4),E=l>1?216:256,S=E*.5,_=0;_<d;_++)m[_*4+0]=Math.floor(Math.random()*E+S),m[_*4+1]=Math.floor(Math.random()*E+S),m[_*4+2]=Math.floor(Math.random()*E+S),m[_*4+3]=Math.floor(Math.random()*E+S);if(l>1){for(var M=0;M<u;M+=l)for(var R=0;R<u;R++)if(R%l!==0){for(var W=Math.floor(R/l)*l+u,fe=M*u,ye=[],Y=[],j=[],se=[],Te=0;Te<4;Te++)ye[Te]=m[fe*4+(W-l)%u*4+Te],Y[Te]=m[fe*4+W%u*4+Te],j[Te]=m[fe*4+(W+l)%u*4+Te],se[Te]=m[fe*4+(W+l*2)%u*4+Te];for(var Ae=R%l/l,ze=g.dwCubicInterpolate(ye,Y,j,se,Ae),de=0;de<4;de++)m[M*u*4+R*4+de]=ze[de]}for(var we=0;we<u;we++)for(var ce=0;ce<u;ce++)if(ce%l!==0){for(var he=Math.floor(ce/l)*l+u,Pe=[],$e=[],He=[],et=[],Ve=0;Ve<4;Ve++)Pe[Ve]=m[(he-l)%u*u*4+we*4+Ve],$e[Ve]=m[he%u*u*4+we*4+Ve],He[Ve]=m[(he+l)%u*u*4+we*4+Ve],et[Ve]=m[(he+l*2)%u*u*4+we*4+Ve];for(var Et=ce%l/l,Nt=g.dwCubicInterpolate(Pe,$e,He,et,Et),$t=0;$t<4;$t++)m[ce*u*4+we*4+$t]=Nt[$t]}}return m}}]),g})()}),"./src/presetBase.js":(function(t,n){var r=1e-5;window.sqr=function(h){return h*h},window.sqrt=function(h){return Math.sqrt(Math.abs(h))},window.log10=function(h){return Math.log(h)*Math.LOG10E},window.sign=function(h){return h>0?1:h<0?-1:0},window.rand=function(h){var f=Math.floor(h);return f<1?Math.random():Math.random()*f},window.randint=function(h){return Math.floor(rand(h))},window.bnot=function(h){return Math.abs(h)<r?1:0};function i(c){return isFinite(c)&&!isNaN(c)}window.pow=function(h,f){var g=Math.pow(h,f);return i(g)?g:0},window.div=function(h,f){return f===0?0:h/f},window.mod=function(h,f){if(f===0)return 0;var g=Math.floor(h)%Math.floor(f);return g},window.bitor=function(h,f){var g=Math.floor(h)|Math.floor(f);return g},window.bitand=function(h,f){var g=Math.floor(h)&Math.floor(f);return g},window.sigmoid=function(h,f){var g=1+Math.exp(-h*f);return Math.abs(g)>r?1/g:0},window.bor=function(h,f){return Math.abs(h)>r||Math.abs(f)>r?1:0},window.band=function(h,f){return Math.abs(h)>r&&Math.abs(f)>r?1:0},window.equal=function(h,f){return Math.abs(h-f)<r?1:0},window.above=function(h,f){return h>f?1:0},window.below=function(h,f){return h<f?1:0},window.ifcond=function(h,f,g){return Math.abs(h)>r?f:g},window.memcpy=function(h,f,g,y){var u=f,l=g,d=y;return l<0&&(d+=l,u-=l,l=0),u<0&&(d+=u,l-=u,u=0),d>0&&h.copyWithin(u,l,d),f}}),"./src/rendering/blendPattern.js":(function(t,n,r){r.r(n),r.d(n,"default",function(){return f});function i(g,y){if(!(g instanceof y))throw new TypeError("Cannot call a class as a function")}function c(g,y){for(var u=0;u<y.length;u++){var l=y[u];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(g,l.key,l)}}function h(g,y,u){return y&&c(g.prototype,y),u&&c(g,u),g}var f=(function(){function g(y){i(this,g),this.mesh_width=y.mesh_width,this.mesh_height=y.mesh_height,this.aspectx=y.aspectx,this.aspecty=y.aspecty,this.vertInfoA=new Float32Array((this.mesh_width+1)*(this.mesh_height+1)),this.vertInfoC=new Float32Array((this.mesh_width+1)*(this.mesh_height+1)),this.createBlendPattern()}return h(g,[{key:"updateGlobals",value:function(u){var l=this.mesh_width,d=this.mesh_height;this.mesh_width=u.mesh_width,this.mesh_height=u.mesh_height,this.aspectx=u.aspectx,this.aspecty=u.aspecty,(this.mesh_width!==l||this.mesh_height!==d)&&(this.vertInfoA=g.resizeMatrixValues(this.vertInfoA,l,d,this.mesh_width,this.mesh_height),this.vertInfoC=g.resizeMatrixValues(this.vertInfoC,l,d,this.mesh_width,this.mesh_height))}},{key:"genPlasma",value:function(u,l,d,m,E){var S=Math.floor((u+l)/2),_=Math.floor((d+m)/2),M=this.vertInfoC[d*(this.mesh_width+1)+u],R=this.vertInfoC[d*(this.mesh_width+1)+l],W=this.vertInfoC[m*(this.mesh_width+1)+u],fe=this.vertInfoC[m*(this.mesh_width+1)+l];m-d>=2&&(u===0&&(this.vertInfoC[_*(this.mesh_width+1)+u]=.5*(M+W)+(Math.random()*2-1)*E*this.aspecty),this.vertInfoC[_*(this.mesh_width+1)+l]=.5*(R+fe)+(Math.random()*2-1)*E*this.aspecty),l-u>=2&&(d===0&&(this.vertInfoC[d*(this.mesh_width+1)+S]=.5*(M+R)+(Math.random()*2-1)*E*this.aspectx),this.vertInfoC[m*(this.mesh_width+1)+S]=.5*(W+fe)+(Math.random()*2-1)*E*this.aspectx),m-d>=2&&l-u>=2&&(M=this.vertInfoC[_*(this.mesh_width+1)+u],R=this.vertInfoC[_*(this.mesh_width+1)+l],W=this.vertInfoC[d*(this.mesh_width+1)+S],fe=this.vertInfoC[m*(this.mesh_width+1)+S],this.vertInfoC[_*(this.mesh_width+1)+S]=.25*(W+fe+M+R)+(Math.random()*2-1)*E,this.genPlasma(u,S,d,_,E*.5),this.genPlasma(S,l,d,_,E*.5),this.genPlasma(u,S,_,m,E*.5),this.genPlasma(S,l,_,m,E*.5))}},{key:"createBlendPattern",value:function(){var u=1+Math.floor(Math.random()*3);if(u===0)for(var l=0,d=0;d<=this.mesh_height;d++)for(var m=0;m<=this.mesh_width;m++)this.vertInfoA[l]=1,this.vertInfoC[l]=0,l+=1;else if(u===1)for(var E=Math.random()*6.28,S=Math.cos(E),_=Math.sin(E),M=.1+.2*Math.random(),R=1/M,W=0,fe=0;fe<=this.mesh_height;fe++)for(var ye=fe/this.mesh_height*this.aspecty,Y=0;Y<=this.mesh_width;Y++){var j=Y/this.mesh_width*this.aspectx,se=(j-.5)*S+(ye-.5)*_+.5;se=(se-.5)/Math.sqrt(2)+.5,this.vertInfoA[W]=R*(1+M),this.vertInfoC[W]=-R+R*se,W+=1}else if(u===2){var Te=.12+.13*Math.random(),Ae=1/Te;this.vertInfoC[0]=Math.random(),this.vertInfoC[this.mesh_width]=Math.random(),this.vertInfoC[this.mesh_height*(this.mesh_width+1)]=Math.random(),this.vertInfoC[this.mesh_height*(this.mesh_width+1)+this.mesh_width]=Math.random(),this.genPlasma(0,this.mesh_width,0,this.mesh_height,.25);for(var ze=this.vertInfoC[0],de=this.vertInfoC[0],we=0,ce=0;ce<=this.mesh_height;ce++)for(var he=0;he<=this.mesh_width;he++)ze>this.vertInfoC[we]&&(ze=this.vertInfoC[we]),de<this.vertInfoC[we]&&(de=this.vertInfoC[we]),we+=1;var Pe=1/(de-ze);we=0;for(var $e=0;$e<=this.mesh_height;$e++)for(var He=0;He<=this.mesh_width;He++){var et=(this.vertInfoC[we]-ze)*Pe;this.vertInfoA[we]=Ae*(1+Te),this.vertInfoC[we]=-Ae+Ae*et,we+=1}}else if(u===3)for(var Ve=.02+.14*Math.random()+.34*Math.random(),Et=1/Ve,Nt=Math.floor(Math.random()*2)*2-1,$t=0,Ie=0;Ie<=this.mesh_height;Ie++)for(var pe=(Ie/this.mesh_height-.5)*this.aspecty,Be=0;Be<=this.mesh_width;Be++){var O=(Be/this.mesh_width-.5)*this.aspectx,z=Math.sqrt(O*O+pe*pe)*1.41421;Nt===-1&&(z=1-z),this.vertInfoA[$t]=Et*(1+Ve),this.vertInfoC[$t]=-Et+Et*z,$t+=1}}}],[{key:"resizeMatrixValues",value:function(u,l,d,m,E){for(var S=new Float32Array((m+1)*(E+1)),_=0,M=0;M<E+1;M++)for(var R=0;R<m+1;R++){var W=R/E,fe=M/m;W*=l+1,fe*=d+1,W=Math.clamp(W,0,l-1),fe=Math.clamp(fe,0,d-1);var ye=Math.floor(W),Y=Math.floor(fe),j=W-ye,se=fe-Y,Te=u[Y*(l+1)+ye],Ae=u[Y*(l+1)+(ye+1)],ze=u[(Y+1)*(l+1)+ye],de=u[(Y+1)*(l+1)+(ye+1)];S[_]=Te*(1-j)*(1-se)+Ae*j*(1-se)+ze*(1-j)*se+de*j*se,_+=1}return S}}]),g})()}),"./src/rendering/motionVectors/motionVectors.js":(function(t,n,r){r.r(n),r.d(n,"default",function(){return g});var i=r("./src/rendering/shaders/shaderUtils.js");function c(y,u){if(!(y instanceof u))throw new TypeError("Cannot call a class as a function")}function h(y,u){for(var l=0;l<u.length;l++){var d=u[l];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(y,d.key,d)}}function f(y,u,l){return u&&h(y.prototype,u),y}var g=(function(){function y(u,l){c(this,y),this.gl=u,this.maxX=64,this.maxY=48,this.positions=new Float32Array(this.maxX*this.maxY*2*3),this.texsizeX=l.texsizeX,this.texsizeY=l.texsizeY,this.mesh_width=l.mesh_width,this.mesh_height=l.mesh_height,this.positionVertexBuf=this.gl.createBuffer(),this.floatPrecision=i.default.getFragmentFloatPrecision(this.gl),this.createShader()}return f(y,[{key:"updateGlobals",value:function(l){this.texsizeX=l.texsizeX,this.texsizeY=l.texsizeY,this.mesh_width=l.mesh_width,this.mesh_height=l.mesh_height}},{key:"createShader",value:function(){this.shaderProgram=this.gl.createProgram();var l=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(l,`#version 300 es
                                      in vec3 aPos;
                                      void main(void) {
                                        gl_Position = vec4(aPos, 1.0);
                                      }`),this.gl.compileShader(l);var d=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(d,`#version 300 es
                                      precision `.concat(this.floatPrecision,` float;
                                      precision highp int;
                                      precision mediump sampler2D;
                                      out vec4 fragColor;
                                      uniform vec4 u_color;
                                      void main(void) {
                                        fragColor = u_color;
                                      }`)),this.gl.compileShader(d),this.gl.attachShader(this.shaderProgram,l),this.gl.attachShader(this.shaderProgram,d),this.gl.linkProgram(this.shaderProgram),this.aPosLoc=this.gl.getAttribLocation(this.shaderProgram,"aPos"),this.colorLoc=this.gl.getUniformLocation(this.shaderProgram,"u_color")}},{key:"getMotionDir",value:function(l,d,m){var E=Math.floor(m*this.mesh_height),S=m*this.mesh_height-E,_=Math.floor(d*this.mesh_width),M=d*this.mesh_width-_,R=_+1,W=E+1,fe=this.mesh_width+1,ye,Y;return ye=l[(E*fe+_)*2+0]*(1-M)*(1-S),Y=l[(E*fe+_)*2+1]*(1-M)*(1-S),ye+=l[(E*fe+R)*2+0]*M*(1-S),Y+=l[(E*fe+R)*2+1]*M*(1-S),ye+=l[(W*fe+_)*2+0]*(1-M)*S,Y+=l[(W*fe+_)*2+1]*(1-M)*S,ye+=l[(W*fe+R)*2+0]*M*S,Y+=l[(W*fe+R)*2+1]*M*S,[ye,1-Y]}},{key:"generateMotionVectors",value:function(l,d){var m=l.mv_a,E=Math.floor(l.mv_x),S=Math.floor(l.mv_y);if(m>.001&&E>0&&S>0){var _=l.mv_x-E,M=l.mv_y-S;E>this.maxX&&(E=this.maxX,_=0),S>this.maxY&&(S=this.maxY,M=0);var R=l.mv_dx,W=l.mv_dy,fe=l.mv_l,ye=1/this.texsizeX;this.numVecVerts=0;for(var Y=0;Y<S;Y++){var j=(Y+.25)/(S+M+.25-1);if(j-=W,j>1e-4&&j<.9999)for(var se=0;se<E;se++){var Te=(se+.25)/(E+_+.25-1);if(Te+=R,Te>1e-4&&Te<.9999){var Ae=this.getMotionDir(d,Te,j),ze=Ae[0],de=Ae[1],we=ze-Te,ce=de-j;we*=fe,ce*=fe;var he=Math.sqrt(we*we+ce*ce);he<ye&&he>1e-8?(he=ye/he,we*=he,ce*=he):(we=ye,we=ye),ze=Te+we,de=j+ce;var Pe=2*Te-1,$e=2*j-1,He=2*ze-1,et=2*de-1;this.positions[this.numVecVerts*3+0]=Pe,this.positions[this.numVecVerts*3+1]=$e,this.positions[this.numVecVerts*3+2]=0,this.positions[(this.numVecVerts+1)*3+0]=He,this.positions[(this.numVecVerts+1)*3+1]=et,this.positions[(this.numVecVerts+1)*3+2]=0,this.numVecVerts+=2}}}if(this.numVecVerts>0)return this.color=[l.mv_r,l.mv_g,l.mv_b,m],!0}return!1}},{key:"drawMotionVectors",value:function(l,d){this.generateMotionVectors(l,d)&&(this.gl.useProgram(this.shaderProgram),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.positions,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.aPosLoc,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aPosLoc),this.gl.uniform4fv(this.colorLoc,this.color),this.gl.lineWidth(1),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.drawArrays(this.gl.LINES,0,this.numVecVerts))}}]),y})()}),"./src/rendering/renderer.js":(function(t,n,r){r.r(n),r.d(n,"default",function(){return ze});var i=r("./src/audio/audioLevels.js"),c=r("./src/blankPreset.js"),h=r.n(c),f=r("./src/equations/presetEquationRunner.js"),g=r("./src/rendering/waves/basicWaveform.js"),y=r("./src/rendering/waves/customWaveform.js"),u=r("./src/rendering/shapes/customShape.js"),l=r("./src/rendering/sprites/border.js"),d=r("./src/rendering/sprites/darkenCenter.js"),m=r("./src/rendering/motionVectors/motionVectors.js"),E=r("./src/rendering/shaders/warp.js"),S=r("./src/rendering/shaders/comp.js"),_=r("./src/rendering/shaders/output.js"),M=r("./src/rendering/shaders/resample.js"),R=r("./src/rendering/shaders/blur/blur.js"),W=r("./src/noise/noise.js"),fe=r("./src/image/imageTextures.js"),ye=r("./src/rendering/text/titleText.js"),Y=r("./src/rendering/blendPattern.js"),j=r("./src/utils.js");function se(de,we){if(!(de instanceof we))throw new TypeError("Cannot call a class as a function")}function Te(de,we){for(var ce=0;ce<we.length;ce++){var he=we[ce];he.enumerable=he.enumerable||!1,he.configurable=!0,"value"in he&&(he.writable=!0),Object.defineProperty(de,he.key,he)}}function Ae(de,we,ce){return we&&Te(de.prototype,we),ce&&Te(de,ce),de}var ze=(function(){function de(we,ce,he){se(this,de),this.gl=we,this.audio=ce,this.frameNum=0,this.fps=30,this.time=0,this.presetTime=0,this.lastTime=performance.now(),this.timeHist=[0],this.timeHistMax=120,this.blending=!1,this.blendStartTime=0,this.blendProgress=0,this.blendDuration=0,this.width=he.width||1200,this.height=he.height||900,this.mesh_width=he.meshWidth||48,this.mesh_height=he.meshHeight||36,this.pixelRatio=he.pixelRatio||window.devicePixelRatio||1,this.textureRatio=he.textureRatio||1,this.outputFXAA=he.outputFXAA||!1,this.texsizeX=this.width*this.pixelRatio*this.textureRatio,this.texsizeY=this.height*this.pixelRatio*this.textureRatio,this.aspectx=this.texsizeY>this.texsizeX?this.texsizeX/this.texsizeY:1,this.aspecty=this.texsizeX>this.texsizeY?this.texsizeY/this.texsizeX:1,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty,this.qs=j.default.range(1,33).map(function(He){return"q".concat(He)}),this.ts=j.default.range(1,9).map(function(He){return"t".concat(He)}),this.regs=j.default.range(0,100).map(function(He){return He<10?"reg0".concat(He):"reg".concat(He)}),this.blurRatios=[[.5,.25],[.125,.125],[.0625,.0625]],this.audioLevels=new i.default(this.audio),this.prevFrameBuffer=this.gl.createFramebuffer(),this.targetFrameBuffer=this.gl.createFramebuffer(),this.prevTexture=this.gl.createTexture(),this.targetTexture=this.gl.createTexture(),this.compFrameBuffer=this.gl.createFramebuffer(),this.compTexture=this.gl.createTexture(),this.anisoExt=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.bindFrameBufferTexture(this.prevFrameBuffer,this.prevTexture),this.bindFrameBufferTexture(this.targetFrameBuffer,this.targetTexture),this.bindFrameBufferTexture(this.compFrameBuffer,this.compTexture);var Pe={pixelRatio:this.pixelRatio,textureRatio:this.textureRatio,texsizeX:this.texsizeX,texsizeY:this.texsizeY,mesh_width:this.mesh_width,mesh_height:this.mesh_height,aspectx:this.aspectx,aspecty:this.aspecty};this.noise=new W.default(we),this.image=new fe.default(we),this.warpShader=new E.default(we,this.noise,this.image,Pe),this.compShader=new S.default(we,this.noise,this.image,Pe),this.outputShader=new _.default(we,Pe),this.prevWarpShader=new E.default(we,this.noise,this.image,Pe),this.prevCompShader=new S.default(we,this.noise,this.image,Pe),this.numBlurPasses=0,this.blurShader1=new R.default(0,this.blurRatios,we,Pe),this.blurShader2=new R.default(1,this.blurRatios,we,Pe),this.blurShader3=new R.default(2,this.blurRatios,we,Pe),this.blurTexture1=this.blurShader1.blurVerticalTexture,this.blurTexture2=this.blurShader2.blurVerticalTexture,this.blurTexture3=this.blurShader3.blurVerticalTexture,this.basicWaveform=new g.default(we,Pe),this.customWaveforms=j.default.range(4).map(function(He){return new y.default(He,we,Pe)}),this.customShapes=j.default.range(4).map(function(He){return new u.default(He,we,Pe)}),this.prevCustomWaveforms=j.default.range(4).map(function(He){return new y.default(He,we,Pe)}),this.prevCustomShapes=j.default.range(4).map(function(He){return new u.default(He,we,Pe)}),this.darkenCenter=new d.default(we,Pe),this.innerBorder=new l.default(we,Pe),this.outerBorder=new l.default(we,Pe),this.motionVectors=new m.default(we,Pe),this.titleText=new ye.default(we,Pe),this.blendPattern=new Y.default(Pe),this.resampleShader=new M.default(we),this.supertext={startTime:-1},this.warpUVs=new Float32Array((this.mesh_width+1)*(this.mesh_height+1)*2),this.warpColor=new Float32Array((this.mesh_width+1)*(this.mesh_height+1)*4),this.gl.clearColor(0,0,0,1),this.blankPreset=h.a;var $e={frame:0,time:0,fps:45,bass:1,bass_att:1,mid:1,mid_att:1,treb:1,treb_att:1};this.preset=h.a,this.prevPreset=this.preset,this.presetEquationRunner=new f.default(this.preset,$e,Pe),this.prevPresetEquationRunner=new f.default(this.prevPreset,$e,Pe),this.regVars=this.presetEquationRunner.mdVSRegs}return Ae(de,[{key:"loadPreset",value:function(ce,he){this.blendPattern.createBlendPattern(),this.blending=!0,this.blendStartTime=this.time,this.blendDuration=he,this.blendProgress=0,this.prevPresetEquationRunner=this.presetEquationRunner,this.prevPreset=this.preset,this.preset=ce,this.preset.baseVals.old_wave_mode=this.prevPreset.baseVals.wave_mode,this.presetTime=this.time;var Pe={frame:this.frameNum,time:this.time,fps:this.fps,bass:this.audioLevels.bass,bass_att:this.audioLevels.bass_att,mid:this.audioLevels.mid,mid_att:this.audioLevels.mid_att,treb:this.audioLevels.treb,treb_att:this.audioLevels.treb_att},$e={pixelRatio:this.pixelRatio,textureRatio:this.textureRatio,texsizeX:this.texsizeX,texsizeY:this.texsizeY,mesh_width:this.mesh_width,mesh_height:this.mesh_height,aspectx:this.aspectx,aspecty:this.aspecty};this.presetEquationRunner=new f.default(this.preset,Pe,$e),this.regVars=this.presetEquationRunner.mdVSRegs;var He=this.prevWarpShader;this.prevWarpShader=this.warpShader,this.warpShader=He;var et=this.prevCompShader;this.prevCompShader=this.compShader,this.compShader=et;var Ve=this.preset.warp.trim(),Et=this.preset.comp.trim();this.warpShader.updateShader(Ve),this.compShader.updateShader(Et),Ve.length===0?this.numBlurPasses=0:this.numBlurPasses=de.getHighestBlur(Ve),Et.length!==0&&(this.numBlurPasses=Math.max(this.numBlurPasses,de.getHighestBlur(Et)))}},{key:"loadExtraImages",value:function(ce){this.image.loadExtraImages(ce)}},{key:"setRendererSize",value:function(ce,he,Pe){var $e=this.texsizeX,He=this.texsizeY;if(this.width=ce,this.height=he,this.mesh_width=Pe.meshWidth||this.mesh_width,this.mesh_height=Pe.meshHeight||this.mesh_height,this.pixelRatio=Pe.pixelRatio||this.pixelRatio,this.textureRatio=Pe.textureRatio||this.textureRatio,this.texsizeX=ce*this.pixelRatio*this.textureRatio,this.texsizeY=he*this.pixelRatio*this.textureRatio,this.aspectx=this.texsizeY>this.texsizeX?this.texsizeX/this.texsizeY:1,this.aspecty=this.texsizeX>this.texsizeY?this.texsizeY/this.texsizeX:1,this.texsizeX!==$e||this.texsizeY!==He){var et=this.gl.createTexture();this.bindFrameBufferTexture(this.targetFrameBuffer,et),this.bindFrambufferAndSetViewport(this.targetFrameBuffer,this.texsizeX,this.texsizeY),this.resampleShader.renderQuadTexture(this.targetTexture),this.targetTexture=et,this.bindFrameBufferTexture(this.prevFrameBuffer,this.prevTexture),this.bindFrameBufferTexture(this.compFrameBuffer,this.compTexture)}this.updateGlobals(),this.frameNum>0&&this.renderToScreen()}},{key:"setInternalMeshSize",value:function(ce,he){this.mesh_width=ce,this.mesh_height=he,this.updateGlobals()}},{key:"setOutputAA",value:function(ce){this.outputFXAA=ce}},{key:"updateGlobals",value:function(){var ce={pixelRatio:this.pixelRatio,textureRatio:this.textureRatio,texsizeX:this.texsizeX,texsizeY:this.texsizeY,mesh_width:this.mesh_width,mesh_height:this.mesh_height,aspectx:this.aspectx,aspecty:this.aspecty};this.presetEquationRunner.updateGlobals(ce),this.prevPresetEquationRunner.updateGlobals(ce),this.warpShader.updateGlobals(ce),this.prevWarpShader.updateGlobals(ce),this.compShader.updateGlobals(ce),this.prevCompShader.updateGlobals(ce),this.outputShader.updateGlobals(ce),this.blurShader1.updateGlobals(ce),this.blurShader2.updateGlobals(ce),this.blurShader3.updateGlobals(ce),this.basicWaveform.updateGlobals(ce),this.customWaveforms.forEach(function(he){return he.updateGlobals(ce)}),this.customShapes.forEach(function(he){return he.updateGlobals(ce)}),this.prevCustomWaveforms.forEach(function(he){return he.updateGlobals(ce)}),this.prevCustomShapes.forEach(function(he){return he.updateGlobals(ce)}),this.darkenCenter.updateGlobals(ce),this.innerBorder.updateGlobals(ce),this.outerBorder.updateGlobals(ce),this.motionVectors.updateGlobals(ce),this.titleText.updateGlobals(ce),this.blendPattern.updateGlobals(ce),this.warpUVs=new Float32Array((this.mesh_width+1)*(this.mesh_height+1)*2),this.warpColor=new Float32Array((this.mesh_width+1)*(this.mesh_height+1)*4)}},{key:"calcTimeAndFPS",value:function(ce){var he;if(ce)he=ce;else{var Pe=performance.now();he=(Pe-this.lastTime)/1e3,(he>1||he<0||this.frame<2)&&(he=1/30),this.lastTime=Pe}this.time+=1/this.fps,this.blending&&(this.blendProgress=(this.time-this.blendStartTime)/this.blendDuration,this.blendProgress>1&&(this.blending=!1));var $e=this.timeHist[this.timeHist.length-1]+he;this.timeHist.push($e),this.timeHist.length>this.timeHistMax&&this.timeHist.shift();var He=this.timeHist.length/($e-this.timeHist[0]);if(Math.abs(He-this.fps)>3&&this.frame>this.timeHistMax)this.fps=He;else{var et=.93;this.fps=et*this.fps+(1-et)*He}}},{key:"runPixelEquations",value:function(ce,he,Pe,$e){for(var He=this.mesh_width,et=this.mesh_height,Ve=He+1,Et=et+1,Nt=this.time*he.warpanimspeed,$t=1/he.warpscale,Ie=11.68+4*Math.cos(Nt*1.413+10),pe=8.77+3*Math.cos(Nt*1.113+7),Be=10.54+3*Math.cos(Nt*1.233+3),O=11.49+4*Math.cos(Nt*.933+5),z=0/this.texsizeX,k=0/this.texsizeY,L=this.aspectx,ne=this.aspecty,H=j.default.cloneVars(he),De=0,Ye=0,qe=0;qe<Et;qe++)for(var Fe=0;Fe<Ve;Fe++){var Ue=Fe/He*2-1,Ke=qe/et*2-1,tt=Math.sqrt(Ue*Ue*L*L+Ke*Ke*ne*ne);if(Pe){var nt=void 0;qe===et/2&&Fe===He/2?nt=0:nt=j.default.atan2(Ke*ne,Ue*L),H.x=Ue*.5*L+.5,H.y=Ke*-.5*ne+.5,H.rad=tt,H.ang=nt,H.zoom=he.zoom,H.zoomexp=he.zoomexp,H.rot=he.rot,H.warp=he.warp,H.cx=he.cx,H.cy=he.cy,H.dx=he.dx,H.dy=he.dy,H.sx=he.sx,H.sy=he.sy,H=ce.pixel_eqs(H)}var dt=H.warp,Gt=H.zoom,vt=H.zoomexp,Tt=H.cx,yt=H.cy,Zt=H.sx,_n=H.sy,An=H.dx,Sn=H.dy,wn=H.rot,Rn=Math.pow(Gt,Math.pow(vt,tt*2-1)),mt=1/Rn,st=Ue*.5*L*mt+.5,it=-Ke*.5*ne*mt+.5;st=(st-Tt)/Zt+Tt,it=(it-yt)/_n+yt,dt!==0&&(st+=dt*.0035*Math.sin(Nt*.333+$t*(Ue*Ie-Ke*O)),it+=dt*.0035*Math.cos(Nt*.375-$t*(Ue*Be+Ke*pe)),st+=dt*.0035*Math.cos(Nt*.753-$t*(Ue*pe-Ke*Be)),it+=dt*.0035*Math.sin(Nt*.825+$t*(Ue*Ie+Ke*O)));var lt=st-Tt,ft=it-yt,kt=Math.cos(wn),Ot=Math.sin(wn);if(st=lt*kt-ft*Ot+Tt,it=lt*Ot+ft*kt+yt,st-=An,it-=Sn,st=(st-.5)/L+.5,it=(it-.5)/ne+.5,st+=z,it+=k,!$e)this.warpUVs[De]=st,this.warpUVs[De+1]=it,this.warpColor[Ye+0]=1,this.warpColor[Ye+1]=1,this.warpColor[Ye+2]=1,this.warpColor[Ye+3]=1;else{var Ft=this.blendPattern.vertInfoA[De/2]*this.blendProgress+this.blendPattern.vertInfoC[De/2];Ft=Math.clamp(Ft,0,1),this.warpUVs[De]=this.warpUVs[De]*Ft+st*(1-Ft),this.warpUVs[De+1]=this.warpUVs[De+1]*Ft+it*(1-Ft),this.warpColor[Ye+0]=1,this.warpColor[Ye+1]=1,this.warpColor[Ye+2]=1,this.warpColor[Ye+3]=Ft}De+=2,Ye+=4}this.mdVSVertex=H}},{key:"bindFrambufferAndSetViewport",value:function(ce,he,Pe){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,ce),this.gl.viewport(0,0,he,Pe)}},{key:"bindFrameBufferTexture",value:function(ce,he){if(this.gl.bindTexture(this.gl.TEXTURE_2D,he),this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,1),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.texsizeX,this.texsizeY,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,new Uint8Array(this.texsizeX*this.texsizeY*4)),this.gl.generateMipmap(this.gl.TEXTURE_2D),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.anisoExt){var Pe=this.gl.getParameter(this.anisoExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT);this.gl.texParameterf(this.gl.TEXTURE_2D,this.anisoExt.TEXTURE_MAX_ANISOTROPY_EXT,Pe)}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,ce),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,he,0)}},{key:"render",value:function(){var ce=this,he=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Pe=he.audioLevels,$e=he.elapsedTime;this.calcTimeAndFPS($e),this.frameNum+=1,Pe?this.audio.updateAudio(Pe.timeByteArray,Pe.timeByteArrayL,Pe.timeByteArrayR):this.audio.sampleAudio(),this.audioLevels.updateAudioLevels(this.fps,this.frameNum);var He={frame:this.frameNum,time:this.time,fps:this.fps,bass:this.audioLevels.bass,bass_att:this.audioLevels.bass_att,mid:this.audioLevels.mid,mid_att:this.audioLevels.mid_att,treb:this.audioLevels.treb,treb_att:this.audioLevels.treb_att,meshx:this.mesh_width,meshy:this.mesh_height,aspectx:this.invAspectx,aspecty:this.invAspecty,pixelsx:this.texsizeX,pixelsy:this.texsizeY},et=Object.assign({},He);et.gmegabuf=this.prevPresetEquationRunner.gmegabuf,He.gmegabuf=this.presetEquationRunner.gmegabuf,Object.assign(He,this.regVars),this.presetEquationRunner.runFrameEquations(He);var Ve=this.presetEquationRunner.mdVSFrame;this.runPixelEquations(this.presetEquationRunner.preset,Ve,this.presetEquationRunner.runVertEQs,!1),Object.assign(this.regVars,j.default.pick(this.mdVSVertex,this.regs)),Object.assign(He,this.regVars);var Et;this.blending?(this.prevPresetEquationRunner.runFrameEquations(et),this.runPixelEquations(this.prevPresetEquationRunner.preset,this.prevPresetEquationRunner.mdVSFrame,this.prevPresetEquationRunner.runVertEQs,!0),Et=de.mixFrameEquations(this.blendProgress,Ve,this.prevPresetEquationRunner.mdVSFrame)):Et=Ve;var Nt=this.targetTexture;this.targetTexture=this.prevTexture,this.prevTexture=Nt;var $t=this.targetFrameBuffer;this.targetFrameBuffer=this.prevFrameBuffer,this.prevFrameBuffer=$t,this.gl.bindTexture(this.gl.TEXTURE_2D,this.prevTexture),this.gl.generateMipmap(this.gl.TEXTURE_2D),this.bindFrambufferAndSetViewport(this.targetFrameBuffer,this.texsizeX,this.texsizeY),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.enable(this.gl.BLEND),this.gl.blendEquation(this.gl.FUNC_ADD),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA);var Ie=de.getBlurValues(Et),pe=Ie.blurMins,Be=Ie.blurMaxs;this.blending?(this.prevWarpShader.renderQuadTexture(!1,this.prevTexture,this.blurTexture1,this.blurTexture2,this.blurTexture3,pe,Be,this.prevPresetEquationRunner.mdVSFrame,this.warpUVs,this.warpColor),this.warpShader.renderQuadTexture(!0,this.prevTexture,this.blurTexture1,this.blurTexture2,this.blurTexture3,pe,Be,Et,this.warpUVs,this.warpColor)):this.warpShader.renderQuadTexture(!1,this.prevTexture,this.blurTexture1,this.blurTexture2,this.blurTexture3,pe,Be,Ve,this.warpUVs,this.warpColor),this.numBlurPasses>0&&(this.blurShader1.renderBlurTexture(this.targetTexture,Ve,pe,Be),this.numBlurPasses>1&&(this.blurShader2.renderBlurTexture(this.blurTexture1,Ve,pe,Be),this.numBlurPasses>2&&this.blurShader3.renderBlurTexture(this.blurTexture2,Ve,pe,Be)),this.bindFrambufferAndSetViewport(this.targetFrameBuffer,this.texsizeX,this.texsizeY)),this.motionVectors.drawMotionVectors(Et,this.warpUVs),this.preset.shapes&&this.preset.shapes.length>0&&this.customShapes.forEach(function(L,ne){L.drawCustomShape(ce.blending?ce.blendProgress:1,He,ce.presetEquationRunner,ce.preset.shapes[ne],ce.prevTexture)}),this.preset.waves&&this.preset.waves.length>0&&this.customWaveforms.forEach(function(L,ne){L.drawCustomWaveform(ce.blending?ce.blendProgress:1,ce.audio.timeArrayL,ce.audio.timeArrayR,ce.audio.freqArrayL,ce.audio.freqArrayR,He,ce.presetEquationRunner,ce.preset.waves[ne])}),this.blending&&(this.prevPreset.shapes&&this.prevPreset.shapes.length>0&&this.prevCustomShapes.forEach(function(L,ne){L.drawCustomShape(1-ce.blendProgress,et,ce.prevPresetEquationRunner,ce.prevPreset.shapes[ne],ce.prevTexture)}),this.prevPreset.waves&&this.prevPreset.waves.length>0&&this.prevCustomWaveforms.forEach(function(L,ne){L.drawCustomWaveform(1-ce.blendProgress,ce.audio.timeArrayL,ce.audio.timeArrayR,ce.audio.freqArrayL,ce.audio.freqArrayR,et,ce.prevPresetEquationRunner,ce.prevPreset.waves[ne])})),this.basicWaveform.drawBasicWaveform(this.blending,this.blendProgress,this.audio.timeArrayL,this.audio.timeArrayR,Et),this.darkenCenter.drawDarkenCenter(Et);var O=[Et.ob_r,Et.ob_g,Et.ob_b,Et.ob_a];this.outerBorder.drawBorder(O,Et.ob_size,0);var z=[Et.ib_r,Et.ib_g,Et.ib_b,Et.ib_a];if(this.innerBorder.drawBorder(z,Et.ib_size,Et.ob_size),this.supertext.startTime>=0){var k=(this.time-this.supertext.startTime)/this.supertext.duration;k>=1&&this.titleText.renderTitle(k,!0,He)}this.globalVars=He,this.mdVSFrame=Ve,this.mdVSFrameMixed=Et,this.renderToScreen()}},{key:"renderToScreen",value:function(){this.outputFXAA?this.bindFrambufferAndSetViewport(this.compFrameBuffer,this.texsizeX,this.texsizeY):this.bindFrambufferAndSetViewport(null,this.width,this.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.enable(this.gl.BLEND),this.gl.blendEquation(this.gl.FUNC_ADD),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA);var ce=de.getBlurValues(this.mdVSFrameMixed),he=ce.blurMins,Pe=ce.blurMaxs;if(this.blending?(this.prevCompShader.renderQuadTexture(!1,this.targetTexture,this.blurTexture1,this.blurTexture2,this.blurTexture3,he,Pe,this.prevPresetEquationRunner.mdVSFrame,this.warpColor),this.compShader.renderQuadTexture(!0,this.targetTexture,this.blurTexture1,this.blurTexture2,this.blurTexture3,he,Pe,this.mdVSFrameMixed,this.warpColor)):this.compShader.renderQuadTexture(!1,this.targetTexture,this.blurTexture1,this.blurTexture2,this.blurTexture3,he,Pe,this.mdVSFrame,this.warpColor),this.supertext.startTime>=0){var $e=(this.time-this.supertext.startTime)/this.supertext.duration;this.titleText.renderTitle($e,!1,this.globalVars),$e>=1&&(this.supertext.startTime=-1)}this.outputFXAA&&(this.gl.bindTexture(this.gl.TEXTURE_2D,this.compTexture),this.gl.generateMipmap(this.gl.TEXTURE_2D),this.bindFrambufferAndSetViewport(null,this.width,this.height),this.outputShader.renderQuadTexture(this.compTexture))}},{key:"launchSongTitleAnim",value:function(ce){this.supertext={startTime:this.time,duration:1.7},this.titleText.generateTitleTexture(ce)}},{key:"toDataURL",value:function(){var ce=this,he=new Uint8Array(this.texsizeX*this.texsizeY*4),Pe=this.gl.createFramebuffer(),$e=this.gl.createTexture();this.bindFrameBufferTexture(Pe,$e);var He=de.getBlurValues(this.mdVSFrameMixed),et=He.blurMins,Ve=He.blurMaxs;this.compShader.renderQuadTexture(!1,this.targetTexture,this.blurTexture1,this.blurTexture2,this.blurTexture3,et,Ve,this.mdVSFrame,this.warpColor),this.gl.readPixels(0,0,this.texsizeX,this.texsizeY,this.gl.RGBA,this.gl.UNSIGNED_BYTE,he),Array.from({length:this.texsizeY},function(Ie,pe){return he.slice(pe*ce.texsizeX*4,(pe+1)*ce.texsizeX*4)}).forEach(function(Ie,pe){return he.set(Ie,(ce.texsizeY-pe-1)*ce.texsizeX*4)});var Et=document.createElement("canvas");Et.width=this.texsizeX,Et.height=this.texsizeY;var Nt=Et.getContext("2d"),$t=Nt.createImageData(this.texsizeX,this.texsizeY);return $t.data.set(he),Nt.putImageData($t,0,0),this.gl.deleteTexture($e),this.gl.deleteFramebuffer(Pe),Et.toDataURL()}},{key:"warpBufferToDataURL",value:function(){var ce=new Uint8Array(this.texsizeX*this.texsizeY*4);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.targetFrameBuffer),this.gl.readPixels(0,0,this.texsizeX,this.texsizeY,this.gl.RGBA,this.gl.UNSIGNED_BYTE,ce);var he=document.createElement("canvas");he.width=this.texsizeX,he.height=this.texsizeY;var Pe=he.getContext("2d"),$e=Pe.createImageData(this.texsizeX,this.texsizeY);return $e.data.set(ce),Pe.putImageData($e,0,0),he.toDataURL()}}],[{key:"getHighestBlur",value:function(ce){return/sampler_blur3/.test(ce)?3:/sampler_blur2/.test(ce)?2:/sampler_blur1/.test(ce)?1:0}},{key:"mixFrameEquations",value:function(ce,he,Pe){var $e=.5-.5*Math.cos(ce*Math.PI),He=1-$e,et=.5,Ve=j.default.cloneVars(he);return Ve.decay=$e*he.decay+He*Pe.decay,Ve.wave_a=$e*he.wave_a+He*Pe.wave_a,Ve.wave_r=$e*he.wave_r+He*Pe.wave_r,Ve.wave_g=$e*he.wave_g+He*Pe.wave_g,Ve.wave_b=$e*he.wave_b+He*Pe.wave_b,Ve.wave_x=$e*he.wave_x+He*Pe.wave_x,Ve.wave_y=$e*he.wave_y+He*Pe.wave_y,Ve.wave_mystery=$e*he.wave_mystery+He*Pe.wave_mystery,Ve.ob_size=$e*he.ob_size+He*Pe.ob_size,Ve.ob_r=$e*he.ob_r+He*Pe.ob_r,Ve.ob_g=$e*he.ob_g+He*Pe.ob_g,Ve.ob_b=$e*he.ob_b+He*Pe.ob_b,Ve.ob_a=$e*he.ob_a+He*Pe.ob_a,Ve.ib_size=$e*he.ib_size+He*Pe.ib_size,Ve.ib_r=$e*he.ib_r+He*Pe.ib_r,Ve.ib_g=$e*he.ib_g+He*Pe.ib_g,Ve.ib_b=$e*he.ib_b+He*Pe.ib_b,Ve.ib_a=$e*he.ib_a+He*Pe.ib_a,Ve.mv_x=$e*he.mv_x+He*Pe.mv_x,Ve.mv_y=$e*he.mv_y+He*Pe.mv_y,Ve.mv_dx=$e*he.mv_dx+He*Pe.mv_dx,Ve.mv_dy=$e*he.mv_dy+He*Pe.mv_dy,Ve.mv_l=$e*he.mv_l+He*Pe.mv_l,Ve.mv_r=$e*he.mv_r+He*Pe.mv_r,Ve.mv_g=$e*he.mv_g+He*Pe.mv_g,Ve.mv_b=$e*he.mv_b+He*Pe.mv_b,Ve.mv_a=$e*he.mv_a+He*Pe.mv_a,Ve.echo_zoom=$e*he.echo_zoom+He*Pe.echo_zoom,Ve.echo_alpha=$e*he.echo_alpha+He*Pe.echo_alpha,Ve.echo_orient=$e*he.echo_orient+He*Pe.echo_orient,Ve.wave_dots=$e<et?Pe.wave_dots:he.wave_dots,Ve.wave_thick=$e<et?Pe.wave_thick:he.wave_thick,Ve.additivewave=$e<et?Pe.additivewave:he.additivewave,Ve.wave_brighten=$e<et?Pe.wave_brighten:he.wave_brighten,Ve.darken_center=$e<et?Pe.darken_center:he.darken_center,Ve.gammaadj=$e<et?Pe.gammaadj:he.gammaadj,Ve.wrap=$e<et?Pe.wrap:he.wrap,Ve.invert=$e<et?Pe.invert:he.invert,Ve.brighten=$e<et?Pe.brighten:he.brighten,Ve.darken=$e<et?Pe.darken:he.darken,Ve.solarize=$e<et?Pe.brighten:he.solarize,Ve.b1n=$e*he.b1n+He*Pe.b1n,Ve.b2n=$e*he.b2n+He*Pe.b2n,Ve.b3n=$e*he.b3n+He*Pe.b3n,Ve.b1x=$e*he.b1x+He*Pe.b1x,Ve.b2x=$e*he.b2x+He*Pe.b2x,Ve.b3x=$e*he.b3x+He*Pe.b3x,Ve.b1ed=$e*he.b1ed+He*Pe.b1ed,Ve}},{key:"getBlurValues",value:function(ce){var he=ce.b1n,Pe=ce.b2n,$e=ce.b3n,He=ce.b1x,et=ce.b2x,Ve=ce.b3x,Et=.1;if(He-he<Et){var Nt=(he+He)*.5;he=Nt-Et*.5,He=Nt-Et*.5}if(et=Math.min(He,et),Pe=Math.max(he,Pe),et-Pe<Et){var $t=(Pe+et)*.5;Pe=$t-Et*.5,et=$t-Et*.5}if(Ve=Math.min(et,Ve),$e=Math.max(Pe,$e),Ve-$e<Et){var Ie=($e+Ve)*.5;$e=Ie-Et*.5,Ve=Ie-Et*.5}return{blurMins:[he,Pe,$e],blurMaxs:[He,et,Ve]}}}]),de})()}),"./src/rendering/shaders/blur/blur.js":(function(t,n,r){r.r(n),r.d(n,"default",function(){return y});var i=r("./src/rendering/shaders/blur/blurVertical.js"),c=r("./src/rendering/shaders/blur/blurHorizontal.js");function h(u,l){if(!(u instanceof l))throw new TypeError("Cannot call a class as a function")}function f(u,l){for(var d=0;d<l.length;d++){var m=l[d];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(u,m.key,m)}}function g(u,l,d){return l&&f(u.prototype,l),u}var y=(function(){function u(l,d,m){var E=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};h(this,u),this.blurLevel=l,this.blurRatios=d,this.gl=m,this.texsizeX=E.texsizeX,this.texsizeY=E.texsizeY,this.anisoExt=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.blurHorizontalFrameBuffer=this.gl.createFramebuffer(),this.blurVerticalFrameBuffer=this.gl.createFramebuffer(),this.blurHorizontalTexture=this.gl.createTexture(),this.blurVerticalTexture=this.gl.createTexture(),this.setupFrameBufferTextures(),this.blurHorizontal=new c.default(m,this.blurLevel,E),this.blurVertical=new i.default(m,this.blurLevel,E)}return g(u,[{key:"updateGlobals",value:function(d){this.texsizeX=d.texsizeX,this.texsizeY=d.texsizeY,this.setupFrameBufferTextures()}},{key:"getTextureSize",value:function(d){var m=Math.max(this.texsizeX*d,16);m=Math.floor((m+3)/16)*16;var E=Math.max(this.texsizeY*d,16);return E=Math.floor((E+3)/4)*4,[m,E]}},{key:"setupFrameBufferTextures",value:function(){var d=this.blurLevel>0?this.blurRatios[this.blurLevel-1]:[1,1],m=this.blurRatios[this.blurLevel],E=this.getTextureSize(d[1]),S=this.getTextureSize(m[0]);this.bindFrameBufferTexture(this.blurHorizontalFrameBuffer,this.blurHorizontalTexture,S);var _=S,M=this.getTextureSize(m[1]);this.bindFrameBufferTexture(this.blurVerticalFrameBuffer,this.blurVerticalTexture,M),this.horizontalTexsizes=[E,S],this.verticalTexsizes=[_,M]}},{key:"bindFrambufferAndSetViewport",value:function(d,m){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,d),this.gl.viewport(0,0,m[0],m[1])}},{key:"bindFrameBufferTexture",value:function(d,m,E){if(this.gl.bindTexture(this.gl.TEXTURE_2D,m),this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,1),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,E[0],E[1],0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,new Uint8Array(E[0]*E[1]*4)),this.gl.generateMipmap(this.gl.TEXTURE_2D),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.anisoExt){var S=this.gl.getParameter(this.anisoExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT);this.gl.texParameterf(this.gl.TEXTURE_2D,this.anisoExt.TEXTURE_MAX_ANISOTROPY_EXT,S)}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,d),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,m,0)}},{key:"renderBlurTexture",value:function(d,m,E,S){this.bindFrambufferAndSetViewport(this.blurHorizontalFrameBuffer,this.horizontalTexsizes[1]),this.blurHorizontal.renderQuadTexture(d,m,E,S,this.horizontalTexsizes[0]),this.gl.bindTexture(this.gl.TEXTURE_2D,this.blurHorizontalTexture),this.gl.generateMipmap(this.gl.TEXTURE_2D),this.bindFrambufferAndSetViewport(this.blurVerticalFrameBuffer,this.verticalTexsizes[1]),this.blurVertical.renderQuadTexture(this.blurHorizontalTexture,m,this.verticalTexsizes[0]),this.gl.bindTexture(this.gl.TEXTURE_2D,this.blurVerticalTexture),this.gl.generateMipmap(this.gl.TEXTURE_2D)}}]),u})()}),"./src/rendering/shaders/blur/blurHorizontal.js":(function(t,n,r){r.r(n),r.d(n,"default",function(){return g});var i=r("./src/rendering/shaders/shaderUtils.js");function c(y,u){if(!(y instanceof u))throw new TypeError("Cannot call a class as a function")}function h(y,u){for(var l=0;l<u.length;l++){var d=u[l];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(y,d.key,d)}}function f(y,u,l){return u&&h(y.prototype,u),y}var g=(function(){function y(u,l){c(this,y),this.gl=u,this.blurLevel=l;var d=[4,3.8,3.5,2.9,1.9,1.2,.7,.3],m=d[0]+d[1],E=d[2]+d[3],S=d[4]+d[5],_=d[6]+d[7],M=0+2*d[1]/m,R=2+2*d[3]/E,W=4+2*d[5]/S,fe=6+2*d[7]/_;this.ws=new Float32Array([m,E,S,_]),this.ds=new Float32Array([M,R,W,fe]),this.wDiv=.5/(m+E+S+_),this.positions=new Float32Array([-1,-1,1,-1,-1,1,1,1]),this.vertexBuf=this.gl.createBuffer(),this.floatPrecision=i.default.getFragmentFloatPrecision(this.gl),this.createShader()}return f(y,[{key:"createShader",value:function(){this.shaderProgram=this.gl.createProgram();var l=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(l,`#version 300 es
                                      const vec2 halfmad = vec2(0.5);
                                      in vec2 aPos;
                                      out vec2 uv;
                                      void main(void) {
                                        gl_Position = vec4(aPos, 0.0, 1.0);
                                        uv = aPos * halfmad + halfmad;
                                      }`),this.gl.compileShader(l);var d=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(d,`#version 300 es
       precision `.concat(this.floatPrecision,` float;
       precision highp int;
       precision mediump sampler2D;

       in vec2 uv;
       out vec4 fragColor;
       uniform sampler2D uTexture;
       uniform vec4 texsize;
       uniform float scale;
       uniform float bias;
       uniform vec4 ws;
       uniform vec4 ds;
       uniform float wdiv;

       void main(void) {
         float w1 = ws[0];
         float w2 = ws[1];
         float w3 = ws[2];
         float w4 = ws[3];
         float d1 = ds[0];
         float d2 = ds[1];
         float d3 = ds[2];
         float d4 = ds[3];

         vec2 uv2 = uv.xy;

         vec3 blur =
           ( texture(uTexture, uv2 + vec2( d1 * texsize.z,0.0) ).xyz
           + texture(uTexture, uv2 + vec2(-d1 * texsize.z,0.0) ).xyz) * w1 +
           ( texture(uTexture, uv2 + vec2( d2 * texsize.z,0.0) ).xyz
           + texture(uTexture, uv2 + vec2(-d2 * texsize.z,0.0) ).xyz) * w2 +
           ( texture(uTexture, uv2 + vec2( d3 * texsize.z,0.0) ).xyz
           + texture(uTexture, uv2 + vec2(-d3 * texsize.z,0.0) ).xyz) * w3 +
           ( texture(uTexture, uv2 + vec2( d4 * texsize.z,0.0) ).xyz
           + texture(uTexture, uv2 + vec2(-d4 * texsize.z,0.0) ).xyz) * w4;

         blur.xyz *= wdiv;
         blur.xyz = blur.xyz * scale + bias;

         fragColor = vec4(blur, 1.0);
       }`)),this.gl.compileShader(d),this.gl.attachShader(this.shaderProgram,l),this.gl.attachShader(this.shaderProgram,d),this.gl.linkProgram(this.shaderProgram),this.positionLocation=this.gl.getAttribLocation(this.shaderProgram,"aPos"),this.textureLoc=this.gl.getUniformLocation(this.shaderProgram,"uTexture"),this.texsizeLocation=this.gl.getUniformLocation(this.shaderProgram,"texsize"),this.scaleLoc=this.gl.getUniformLocation(this.shaderProgram,"scale"),this.biasLoc=this.gl.getUniformLocation(this.shaderProgram,"bias"),this.wsLoc=this.gl.getUniformLocation(this.shaderProgram,"ws"),this.dsLocation=this.gl.getUniformLocation(this.shaderProgram,"ds"),this.wdivLoc=this.gl.getUniformLocation(this.shaderProgram,"wdiv")}},{key:"getScaleAndBias",value:function(l,d){var m=[1,1,1],E=[0,0,0],S,_;return m[0]=1/(d[0]-l[0]),E[0]=-l[0]*m[0],S=(l[1]-l[0])/(d[0]-l[0]),_=(d[1]-l[0])/(d[0]-l[0]),m[1]=1/(_-S),E[1]=-S*m[1],S=(l[2]-l[1])/(d[1]-l[1]),_=(d[2]-l[1])/(d[1]-l[1]),m[2]=1/(_-S),E[2]=-S*m[2],{scale:m[this.blurLevel],bias:E[this.blurLevel]}}},{key:"renderQuadTexture",value:function(l,d,m,E,S){this.gl.useProgram(this.shaderProgram),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.positions,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.positionLocation,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,l),this.gl.uniform1i(this.textureLoc,0);var _=this.getScaleAndBias(m,E),M=_.scale,R=_.bias;this.gl.uniform4fv(this.texsizeLocation,[S[0],S[1],1/S[0],1/S[1]]),this.gl.uniform1f(this.scaleLoc,M),this.gl.uniform1f(this.biasLoc,R),this.gl.uniform4fv(this.wsLoc,this.ws),this.gl.uniform4fv(this.dsLocation,this.ds),this.gl.uniform1f(this.wdivLoc,this.wDiv),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}}]),y})()}),"./src/rendering/shaders/blur/blurVertical.js":(function(t,n,r){r.r(n),r.d(n,"default",function(){return g});var i=r("./src/rendering/shaders/shaderUtils.js");function c(y,u){if(!(y instanceof u))throw new TypeError("Cannot call a class as a function")}function h(y,u){for(var l=0;l<u.length;l++){var d=u[l];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(y,d.key,d)}}function f(y,u,l){return u&&h(y.prototype,u),y}var g=(function(){function y(u,l){c(this,y),this.gl=u,this.blurLevel=l;var d=[4,3.8,3.5,2.9,1.9,1.2,.7,.3],m=d[0]+d[1]+d[2]+d[3],E=d[4]+d[5]+d[6]+d[7],S=0+2*((d[2]+d[3])/m),_=2+2*((d[6]+d[7])/E);this.wds=new Float32Array([m,E,S,_]),this.wDiv=1/((m+E)*2),this.positions=new Float32Array([-1,-1,1,-1,-1,1,1,1]),this.vertexBuf=this.gl.createBuffer(),this.floatPrecision=i.default.getFragmentFloatPrecision(this.gl),this.createShader()}return f(y,[{key:"createShader",value:function(){this.shaderProgram=this.gl.createProgram();var l=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(l,`#version 300 es
                                      const vec2 halfmad = vec2(0.5);
                                      in vec2 aPos;
                                      out vec2 uv;
                                      void main(void) {
                                        gl_Position = vec4(aPos, 0.0, 1.0);
                                        uv = aPos * halfmad + halfmad;
                                      }`),this.gl.compileShader(l);var d=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(d,`#version 300 es
       precision `.concat(this.floatPrecision,` float;
       precision highp int;
       precision mediump sampler2D;

       in vec2 uv;
       out vec4 fragColor;
       uniform sampler2D uTexture;
       uniform vec4 texsize;
       uniform float ed1;
       uniform float ed2;
       uniform float ed3;
       uniform vec4 wds;
       uniform float wdiv;

       void main(void) {
         float w1 = wds[0];
         float w2 = wds[1];
         float d1 = wds[2];
         float d2 = wds[3];

         vec2 uv2 = uv.xy;

         vec3 blur =
           ( texture(uTexture, uv2 + vec2(0.0, d1 * texsize.w) ).xyz
           + texture(uTexture, uv2 + vec2(0.0,-d1 * texsize.w) ).xyz) * w1 +
           ( texture(uTexture, uv2 + vec2(0.0, d2 * texsize.w) ).xyz
           + texture(uTexture, uv2 + vec2(0.0,-d2 * texsize.w) ).xyz) * w2;

         blur.xyz *= wdiv;

         float t = min(min(uv.x, uv.y), 1.0 - max(uv.x, uv.y));
         t = sqrt(t);
         t = ed1 + ed2 * clamp(t * ed3, 0.0, 1.0);
         blur.xyz *= t;

         fragColor = vec4(blur, 1.0);
       }`)),this.gl.compileShader(d),this.gl.attachShader(this.shaderProgram,l),this.gl.attachShader(this.shaderProgram,d),this.gl.linkProgram(this.shaderProgram),this.positionLocation=this.gl.getAttribLocation(this.shaderProgram,"aPos"),this.textureLoc=this.gl.getUniformLocation(this.shaderProgram,"uTexture"),this.texsizeLocation=this.gl.getUniformLocation(this.shaderProgram,"texsize"),this.ed1Loc=this.gl.getUniformLocation(this.shaderProgram,"ed1"),this.ed2Loc=this.gl.getUniformLocation(this.shaderProgram,"ed2"),this.ed3Loc=this.gl.getUniformLocation(this.shaderProgram,"ed3"),this.wdsLocation=this.gl.getUniformLocation(this.shaderProgram,"wds"),this.wdivLoc=this.gl.getUniformLocation(this.shaderProgram,"wdiv")}},{key:"renderQuadTexture",value:function(l,d,m){this.gl.useProgram(this.shaderProgram),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.positions,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.positionLocation,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,l),this.gl.uniform1i(this.textureLoc,0);var E=this.blurLevel===0?d.b1ed:0;this.gl.uniform4fv(this.texsizeLocation,[m[0],m[1],1/m[0],1/m[1]]),this.gl.uniform1f(this.ed1Loc,1-E),this.gl.uniform1f(this.ed2Loc,E),this.gl.uniform1f(this.ed3Loc,5),this.gl.uniform4fv(this.wdsLocation,this.wds),this.gl.uniform1f(this.wdivLoc,this.wDiv),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}}]),y})()}),"./src/rendering/shaders/comp.js":(function(t,n,r){r.r(n),r.d(n,"default",function(){return g});var i=r("./src/rendering/shaders/shaderUtils.js");function c(y,u){if(!(y instanceof u))throw new TypeError("Cannot call a class as a function")}function h(y,u){for(var l=0;l<u.length;l++){var d=u[l];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(y,d.key,d)}}function f(y,u,l){return u&&h(y.prototype,u),l&&h(y,l),y}var g=(function(){function y(u,l,d){var m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};c(this,y),this.gl=u,this.noise=l,this.image=d,this.mesh_width=m.mesh_width,this.mesh_height=m.mesh_height,this.texsizeX=m.texsizeX,this.texsizeY=m.texsizeY,this.aspectx=m.aspectx,this.aspecty=m.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty,this.compWidth=32,this.compHeight=24,this.buildPositions(),this.indexBuf=u.createBuffer(),this.positionVertexBuf=this.gl.createBuffer(),this.compColorVertexBuf=this.gl.createBuffer(),this.floatPrecision=i.default.getFragmentFloatPrecision(this.gl),this.createShader(),this.mainSampler=this.gl.createSampler(),this.mainSamplerFW=this.gl.createSampler(),this.mainSamplerFC=this.gl.createSampler(),this.mainSamplerPW=this.gl.createSampler(),this.mainSamplerPC=this.gl.createSampler(),u.samplerParameteri(this.mainSampler,u.TEXTURE_MIN_FILTER,u.LINEAR_MIPMAP_LINEAR),u.samplerParameteri(this.mainSampler,u.TEXTURE_MAG_FILTER,u.LINEAR),u.samplerParameteri(this.mainSampler,u.TEXTURE_WRAP_S,u.REPEAT),u.samplerParameteri(this.mainSampler,u.TEXTURE_WRAP_T,u.REPEAT),u.samplerParameteri(this.mainSamplerFW,u.TEXTURE_MIN_FILTER,u.LINEAR_MIPMAP_LINEAR),u.samplerParameteri(this.mainSamplerFW,u.TEXTURE_MAG_FILTER,u.LINEAR),u.samplerParameteri(this.mainSamplerFW,u.TEXTURE_WRAP_S,u.REPEAT),u.samplerParameteri(this.mainSamplerFW,u.TEXTURE_WRAP_T,u.REPEAT),u.samplerParameteri(this.mainSamplerFC,u.TEXTURE_MIN_FILTER,u.LINEAR_MIPMAP_LINEAR),u.samplerParameteri(this.mainSamplerFC,u.TEXTURE_MAG_FILTER,u.LINEAR),u.samplerParameteri(this.mainSamplerFC,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.samplerParameteri(this.mainSamplerFC,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.samplerParameteri(this.mainSamplerPW,u.TEXTURE_MIN_FILTER,u.NEAREST_MIPMAP_NEAREST),u.samplerParameteri(this.mainSamplerPW,u.TEXTURE_MAG_FILTER,u.NEAREST),u.samplerParameteri(this.mainSamplerPW,u.TEXTURE_WRAP_S,u.REPEAT),u.samplerParameteri(this.mainSamplerPW,u.TEXTURE_WRAP_T,u.REPEAT),u.samplerParameteri(this.mainSamplerPC,u.TEXTURE_MIN_FILTER,u.NEAREST_MIPMAP_NEAREST),u.samplerParameteri(this.mainSamplerPC,u.TEXTURE_MAG_FILTER,u.NEAREST),u.samplerParameteri(this.mainSamplerPC,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.samplerParameteri(this.mainSamplerPC,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE)}return f(y,[{key:"buildPositions",value:function(){for(var l=2,d=2,m=l/2,E=d/2,S=this.compWidth,_=this.compHeight,M=S+1,R=_+1,W=l/S,fe=d/_,ye=[],Y=0;Y<R;Y++)for(var j=Y*fe-E,se=0;se<M;se++){var Te=se*W-m;ye.push(Te,-j,0)}for(var Ae=[],ze=0;ze<_;ze++)for(var de=0;de<S;de++){var we=de+M*ze,ce=de+M*(ze+1),he=de+1+M*(ze+1),Pe=de+1+M*ze;Ae.push(we,ce,Pe),Ae.push(ce,he,Pe)}this.vertices=new Float32Array(ye),this.indices=new Uint16Array(Ae)}},{key:"updateGlobals",value:function(l){this.mesh_width=l.mesh_width,this.mesh_height=l.mesh_height,this.texsizeX=l.texsizeX,this.texsizeY=l.texsizeY,this.aspectx=l.aspectx,this.aspecty=l.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty,this.buildPositions()}},{key:"createShader",value:function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",d,m;if(l.length===0)d=`float orient_horiz = mod(echo_orientation, 2.0);
                        float orient_x = (orient_horiz != 0.0) ? -1.0 : 1.0;
                        float orient_y = (echo_orientation >= 2.0) ? -1.0 : 1.0;
                        vec2 uv_echo = ((uv - 0.5) *
                                        (1.0 / echo_zoom) *
                                        vec2(orient_x, orient_y)) + 0.5;

                        ret = mix(texture(sampler_main, uv).rgb,
                                  texture(sampler_main, uv_echo).rgb,
                                  echo_alpha);

                        ret *= gammaAdj;

                        if(fShader >= 1.0) {
                          ret *= hue_shader;
                        } else if(fShader > 0.001) {
                          ret *= (1.0 - fShader) + (fShader * hue_shader);
                        }

                        if(brighten != 0) ret = sqrt(ret);
                        if(darken != 0) ret = ret*ret;
                        if(solarize != 0) ret = ret * (1.0 - ret) * 4.0;
                        if(invert != 0) ret = 1.0 - ret;`,m="";else{var E=i.default.getShaderParts(l);m=E[0],d=E[1]}d=d.replace(/texture2D/g,"texture"),d=d.replace(/texture3D/g,"texture"),this.userTextures=i.default.getUserSamplers(m),this.shaderProgram=this.gl.createProgram();var S=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(S,`#version 300 es
                                      const vec2 halfmad = vec2(0.5);
                                      in vec2 aPos;
                                      in vec4 aCompColor;
                                      out vec2 vUv;
                                      out vec4 vColor;
                                      void main(void) {
                                        gl_Position = vec4(aPos, 0.0, 1.0);
                                        vUv = aPos * halfmad + halfmad;
                                        vColor = aCompColor;
                                      }`),this.gl.compileShader(S);var _=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(_,`#version 300 es
                                      precision `.concat(this.floatPrecision,` float;
                                      precision highp int;
                                      precision mediump sampler2D;
                                      precision mediump sampler3D;

                                      vec3 lum(vec3 v){
                                          return vec3(dot(v, vec3(0.32,0.49,0.29)));
                                      }

                                      in vec2 vUv;
                                      in vec4 vColor;
                                      out vec4 fragColor;
                                      uniform sampler2D sampler_main;
                                      uniform sampler2D sampler_fw_main;
                                      uniform sampler2D sampler_fc_main;
                                      uniform sampler2D sampler_pw_main;
                                      uniform sampler2D sampler_pc_main;
                                      uniform sampler2D sampler_blur1;
                                      uniform sampler2D sampler_blur2;
                                      uniform sampler2D sampler_blur3;
                                      uniform sampler2D sampler_noise_lq;
                                      uniform sampler2D sampler_noise_lq_lite;
                                      uniform sampler2D sampler_noise_mq;
                                      uniform sampler2D sampler_noise_hq;
                                      uniform sampler2D sampler_pw_noise_lq;
                                      uniform sampler3D sampler_noisevol_lq;
                                      uniform sampler3D sampler_noisevol_hq;

                                      uniform float time;
                                      uniform float gammaAdj;
                                      uniform float echo_zoom;
                                      uniform float echo_alpha;
                                      uniform float echo_orientation;
                                      uniform int invert;
                                      uniform int brighten;
                                      uniform int darken;
                                      uniform int solarize;
                                      uniform vec2 resolution;
                                      uniform vec4 aspect;
                                      uniform vec4 texsize;
                                      uniform vec4 texsize_noise_lq;
                                      uniform vec4 texsize_noise_mq;
                                      uniform vec4 texsize_noise_hq;
                                      uniform vec4 texsize_noise_lq_lite;
                                      uniform vec4 texsize_noisevol_lq;
                                      uniform vec4 texsize_noisevol_hq;

                                      uniform float bass;
                                      uniform float mid;
                                      uniform float treb;
                                      uniform float vol;
                                      uniform float bass_att;
                                      uniform float mid_att;
                                      uniform float treb_att;
                                      uniform float vol_att;

                                      uniform float frame;
                                      uniform float fps;

                                      uniform vec4 _qa;
                                      uniform vec4 _qb;
                                      uniform vec4 _qc;
                                      uniform vec4 _qd;
                                      uniform vec4 _qe;
                                      uniform vec4 _qf;
                                      uniform vec4 _qg;
                                      uniform vec4 _qh;

                                      #define q1 _qa.x
                                      #define q2 _qa.y
                                      #define q3 _qa.z
                                      #define q4 _qa.w
                                      #define q5 _qb.x
                                      #define q6 _qb.y
                                      #define q7 _qb.z
                                      #define q8 _qb.w
                                      #define q9 _qc.x
                                      #define q10 _qc.y
                                      #define q11 _qc.z
                                      #define q12 _qc.w
                                      #define q13 _qd.x
                                      #define q14 _qd.y
                                      #define q15 _qd.z
                                      #define q16 _qd.w
                                      #define q17 _qe.x
                                      #define q18 _qe.y
                                      #define q19 _qe.z
                                      #define q20 _qe.w
                                      #define q21 _qf.x
                                      #define q22 _qf.y
                                      #define q23 _qf.z
                                      #define q24 _qf.w
                                      #define q25 _qg.x
                                      #define q26 _qg.y
                                      #define q27 _qg.z
                                      #define q28 _qg.w
                                      #define q29 _qh.x
                                      #define q30 _qh.y
                                      #define q31 _qh.z
                                      #define q32 _qh.w

                                      uniform vec4 slow_roam_cos;
                                      uniform vec4 roam_cos;
                                      uniform vec4 slow_roam_sin;
                                      uniform vec4 roam_sin;

                                      uniform float blur1_min;
                                      uniform float blur1_max;
                                      uniform float blur2_min;
                                      uniform float blur2_max;
                                      uniform float blur3_min;
                                      uniform float blur3_max;

                                      uniform float scale1;
                                      uniform float scale2;
                                      uniform float scale3;
                                      uniform float bias1;
                                      uniform float bias2;
                                      uniform float bias3;

                                      uniform vec4 rand_frame;
                                      uniform vec4 rand_preset;

                                      uniform float fShader;

                                      float PI = `).concat(Math.PI,`;

                                      `).concat(m,`

                                      void main(void) {
                                        vec3 ret;
                                        vec2 uv = vUv;
                                        vec2 uv_orig = vUv;
                                        uv.y = 1.0 - uv.y;
                                        uv_orig.y = 1.0 - uv_orig.y;
                                        float rad = length(uv - 0.5);
                                        float ang = atan(uv.x - 0.5, uv.y - 0.5);
                                        vec3 hue_shader = vColor.rgb;

                                        `).concat(d,`

                                        fragColor = vec4(ret, vColor.a);
                                      }`)),this.gl.compileShader(_),this.gl.attachShader(this.shaderProgram,S),this.gl.attachShader(this.shaderProgram,_),this.gl.linkProgram(this.shaderProgram),this.positionLocation=this.gl.getAttribLocation(this.shaderProgram,"aPos"),this.compColorLocation=this.gl.getAttribLocation(this.shaderProgram,"aCompColor"),this.textureLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_main"),this.textureFWLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_fw_main"),this.textureFCLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_fc_main"),this.texturePWLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_pw_main"),this.texturePCLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_pc_main"),this.blurTexture1Loc=this.gl.getUniformLocation(this.shaderProgram,"sampler_blur1"),this.blurTexture2Loc=this.gl.getUniformLocation(this.shaderProgram,"sampler_blur2"),this.blurTexture3Loc=this.gl.getUniformLocation(this.shaderProgram,"sampler_blur3"),this.noiseLQLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_noise_lq"),this.noiseMQLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_noise_mq"),this.noiseHQLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_noise_hq"),this.noiseLQLiteLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_noise_lq_lite"),this.noisePointLQLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_pw_noise_lq"),this.noiseVolLQLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_noisevol_lq"),this.noiseVolHQLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_noisevol_hq"),this.timeLoc=this.gl.getUniformLocation(this.shaderProgram,"time"),this.gammaAdjLoc=this.gl.getUniformLocation(this.shaderProgram,"gammaAdj"),this.echoZoomLoc=this.gl.getUniformLocation(this.shaderProgram,"echo_zoom"),this.echoAlphaLoc=this.gl.getUniformLocation(this.shaderProgram,"echo_alpha"),this.echoOrientationLoc=this.gl.getUniformLocation(this.shaderProgram,"echo_orientation"),this.invertLoc=this.gl.getUniformLocation(this.shaderProgram,"invert"),this.brightenLoc=this.gl.getUniformLocation(this.shaderProgram,"brighten"),this.darkenLoc=this.gl.getUniformLocation(this.shaderProgram,"darken"),this.solarizeLoc=this.gl.getUniformLocation(this.shaderProgram,"solarize"),this.texsizeLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize"),this.texsizeNoiseLQLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize_noise_lq"),this.texsizeNoiseMQLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize_noise_mq"),this.texsizeNoiseHQLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize_noise_hq"),this.texsizeNoiseLQLiteLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize_noise_lq_lite"),this.texsizeNoiseVolLQLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize_noisevol_lq"),this.texsizeNoiseVolHQLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize_noisevol_hq"),this.resolutionLoc=this.gl.getUniformLocation(this.shaderProgram,"resolution"),this.aspectLoc=this.gl.getUniformLocation(this.shaderProgram,"aspect"),this.bassLoc=this.gl.getUniformLocation(this.shaderProgram,"bass"),this.midLoc=this.gl.getUniformLocation(this.shaderProgram,"mid"),this.trebLoc=this.gl.getUniformLocation(this.shaderProgram,"treb"),this.volLoc=this.gl.getUniformLocation(this.shaderProgram,"vol"),this.bassAttLoc=this.gl.getUniformLocation(this.shaderProgram,"bass_att"),this.midAttLoc=this.gl.getUniformLocation(this.shaderProgram,"mid_att"),this.trebAttLoc=this.gl.getUniformLocation(this.shaderProgram,"treb_att"),this.volAttLoc=this.gl.getUniformLocation(this.shaderProgram,"vol_att"),this.frameLoc=this.gl.getUniformLocation(this.shaderProgram,"frame"),this.fpsLoc=this.gl.getUniformLocation(this.shaderProgram,"fps"),this.blur1MinLoc=this.gl.getUniformLocation(this.shaderProgram,"blur1_min"),this.blur1MaxLoc=this.gl.getUniformLocation(this.shaderProgram,"blur1_max"),this.blur2MinLoc=this.gl.getUniformLocation(this.shaderProgram,"blur2_min"),this.blur2MaxLoc=this.gl.getUniformLocation(this.shaderProgram,"blur2_max"),this.blur3MinLoc=this.gl.getUniformLocation(this.shaderProgram,"blur3_min"),this.blur3MaxLoc=this.gl.getUniformLocation(this.shaderProgram,"blur3_max"),this.scale1Loc=this.gl.getUniformLocation(this.shaderProgram,"scale1"),this.scale2Loc=this.gl.getUniformLocation(this.shaderProgram,"scale2"),this.scale3Loc=this.gl.getUniformLocation(this.shaderProgram,"scale3"),this.bias1Loc=this.gl.getUniformLocation(this.shaderProgram,"bias1"),this.bias2Loc=this.gl.getUniformLocation(this.shaderProgram,"bias2"),this.bias3Loc=this.gl.getUniformLocation(this.shaderProgram,"bias3"),this.randPresetLoc=this.gl.getUniformLocation(this.shaderProgram,"rand_preset"),this.randFrameLoc=this.gl.getUniformLocation(this.shaderProgram,"rand_frame"),this.fShaderLoc=this.gl.getUniformLocation(this.shaderProgram,"fShader"),this.qaLoc=this.gl.getUniformLocation(this.shaderProgram,"_qa"),this.qbLoc=this.gl.getUniformLocation(this.shaderProgram,"_qb"),this.qcLoc=this.gl.getUniformLocation(this.shaderProgram,"_qc"),this.qdLoc=this.gl.getUniformLocation(this.shaderProgram,"_qd"),this.qeLoc=this.gl.getUniformLocation(this.shaderProgram,"_qe"),this.qfLoc=this.gl.getUniformLocation(this.shaderProgram,"_qf"),this.qgLoc=this.gl.getUniformLocation(this.shaderProgram,"_qg"),this.qhLoc=this.gl.getUniformLocation(this.shaderProgram,"_qh"),this.slowRoamCosLoc=this.gl.getUniformLocation(this.shaderProgram,"slow_roam_cos"),this.roamCosLoc=this.gl.getUniformLocation(this.shaderProgram,"roam_cos"),this.slowRoamSinLoc=this.gl.getUniformLocation(this.shaderProgram,"slow_roam_sin"),this.roamSinLoc=this.gl.getUniformLocation(this.shaderProgram,"roam_sin");for(var M=0;M<this.userTextures.length;M++){var R=this.userTextures[M];R.textureLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_".concat(R.sampler))}}},{key:"updateShader",value:function(l){this.createShader(l)}},{key:"bindBlurVals",value:function(l,d){var m=l[0],E=l[1],S=l[2],_=d[0],M=d[1],R=d[2],W=_-m,fe=m,ye=M-E,Y=E,j=R-S,se=S;this.gl.uniform1f(this.blur1MinLoc,m),this.gl.uniform1f(this.blur1MaxLoc,_),this.gl.uniform1f(this.blur2MinLoc,E),this.gl.uniform1f(this.blur2MaxLoc,M),this.gl.uniform1f(this.blur3MinLoc,S),this.gl.uniform1f(this.blur3MaxLoc,R),this.gl.uniform1f(this.scale1Loc,W),this.gl.uniform1f(this.scale2Loc,ye),this.gl.uniform1f(this.scale3Loc,j),this.gl.uniform1f(this.bias1Loc,fe),this.gl.uniform1f(this.bias2Loc,Y),this.gl.uniform1f(this.bias3Loc,se)}},{key:"generateCompColors",value:function(l,d,m){for(var E=y.generateHueBase(d),S=this.compWidth+1,_=this.compHeight+1,M=new Float32Array(S*_*4),R=0,W=0;W<_;W++)for(var fe=0;fe<S;fe++){for(var ye=fe/this.compWidth,Y=W/this.compHeight,j=[1,1,1],se=0;se<3;se++)j[se]=E[0+se]*ye*Y+E[3+se]*(1-ye)*Y+E[6+se]*ye*(1-Y)+E[9+se]*(1-ye)*(1-Y);var Te=1;if(l){ye*=this.mesh_width+1,Y*=this.mesh_height+1,ye=Math.clamp(ye,0,this.mesh_width-1),Y=Math.clamp(Y,0,this.mesh_height-1);var Ae=Math.floor(ye),ze=Math.floor(Y),de=ye-Ae,we=Y-ze,ce=m[(ze*(this.mesh_width+1)+Ae)*4+3],he=m[(ze*(this.mesh_width+1)+(Ae+1))*4+3],Pe=m[((ze+1)*(this.mesh_width+1)+Ae)*4+3],$e=m[((ze+1)*(this.mesh_width+1)+(Ae+1))*4+3];Te=ce*(1-de)*(1-we)+he*de*(1-we)+Pe*(1-de)*we+$e*de*we}M[R+0]=j[0],M[R+1]=j[1],M[R+2]=j[2],M[R+3]=Te,R+=4}return M}},{key:"renderQuadTexture",value:function(l,d,m,E,S,_,M,R,W){var fe=this.generateCompColors(l,R,W);this.gl.useProgram(this.shaderProgram),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.indexBuf),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.indices,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertices,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.positionLocation,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.compColorVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,fe,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.compColorLocation,4,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.compColorLocation);var ye=R.wrap!==0?this.gl.REPEAT:this.gl.CLAMP_TO_EDGE;this.gl.samplerParameteri(this.mainSampler,this.gl.TEXTURE_WRAP_S,ye),this.gl.samplerParameteri(this.mainSampler,this.gl.TEXTURE_WRAP_T,ye),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,d),this.gl.bindSampler(0,this.mainSampler),this.gl.uniform1i(this.textureLoc,0),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,d),this.gl.bindSampler(1,this.mainSamplerFW),this.gl.uniform1i(this.textureFWLoc,1),this.gl.activeTexture(this.gl.TEXTURE2),this.gl.bindTexture(this.gl.TEXTURE_2D,d),this.gl.bindSampler(2,this.mainSamplerFC),this.gl.uniform1i(this.textureFCLoc,2),this.gl.activeTexture(this.gl.TEXTURE3),this.gl.bindTexture(this.gl.TEXTURE_2D,d),this.gl.bindSampler(3,this.mainSamplerPW),this.gl.uniform1i(this.texturePWLoc,3),this.gl.activeTexture(this.gl.TEXTURE4),this.gl.bindTexture(this.gl.TEXTURE_2D,d),this.gl.bindSampler(4,this.mainSamplerPC),this.gl.uniform1i(this.texturePCLoc,4),this.gl.activeTexture(this.gl.TEXTURE5),this.gl.bindTexture(this.gl.TEXTURE_2D,m),this.gl.uniform1i(this.blurTexture1Loc,5),this.gl.activeTexture(this.gl.TEXTURE6),this.gl.bindTexture(this.gl.TEXTURE_2D,E),this.gl.uniform1i(this.blurTexture2Loc,6),this.gl.activeTexture(this.gl.TEXTURE7),this.gl.bindTexture(this.gl.TEXTURE_2D,S),this.gl.uniform1i(this.blurTexture3Loc,7),this.gl.activeTexture(this.gl.TEXTURE8),this.gl.bindTexture(this.gl.TEXTURE_2D,this.noise.noiseTexLQ),this.gl.uniform1i(this.noiseLQLoc,8),this.gl.activeTexture(this.gl.TEXTURE9),this.gl.bindTexture(this.gl.TEXTURE_2D,this.noise.noiseTexMQ),this.gl.uniform1i(this.noiseMQLoc,9),this.gl.activeTexture(this.gl.TEXTURE10),this.gl.bindTexture(this.gl.TEXTURE_2D,this.noise.noiseTexHQ),this.gl.uniform1i(this.noiseHQLoc,10),this.gl.activeTexture(this.gl.TEXTURE11),this.gl.bindTexture(this.gl.TEXTURE_2D,this.noise.noiseTexLQLite),this.gl.uniform1i(this.noiseLQLiteLoc,11),this.gl.activeTexture(this.gl.TEXTURE12),this.gl.bindTexture(this.gl.TEXTURE_2D,this.noise.noiseTexLQ),this.gl.bindSampler(12,this.noise.noiseTexPointLQ),this.gl.uniform1i(this.noisePointLQLoc,12),this.gl.activeTexture(this.gl.TEXTURE13),this.gl.bindTexture(this.gl.TEXTURE_3D,this.noise.noiseTexVolLQ),this.gl.uniform1i(this.noiseVolLQLoc,13),this.gl.activeTexture(this.gl.TEXTURE14),this.gl.bindTexture(this.gl.TEXTURE_3D,this.noise.noiseTexVolHQ),this.gl.uniform1i(this.noiseVolHQLoc,14);for(var Y=0;Y<this.userTextures.length;Y++){var j=this.userTextures[Y];this.gl.activeTexture(this.gl.TEXTURE15+Y),this.gl.bindTexture(this.gl.TEXTURE_2D,this.image.getTexture(j.sampler)),this.gl.uniform1i(j.textureLoc,15+Y)}this.gl.uniform1f(this.timeLoc,R.time),this.gl.uniform1f(this.gammaAdjLoc,R.gammaadj),this.gl.uniform1f(this.echoZoomLoc,R.echo_zoom),this.gl.uniform1f(this.echoAlphaLoc,R.echo_alpha),this.gl.uniform1f(this.echoOrientationLoc,R.echo_orient),this.gl.uniform1i(this.invertLoc,R.invert),this.gl.uniform1i(this.brightenLoc,R.brighten),this.gl.uniform1i(this.darkenLoc,R.darken),this.gl.uniform1i(this.solarizeLoc,R.solarize),this.gl.uniform2fv(this.resolutionLoc,[this.texsizeX,this.texsizeY]),this.gl.uniform4fv(this.aspectLoc,[this.aspectx,this.aspecty,this.invAspectx,this.invAspecty]),this.gl.uniform4fv(this.texsizeLoc,new Float32Array([this.texsizeX,this.texsizeY,1/this.texsizeX,1/this.texsizeY])),this.gl.uniform4fv(this.texsizeNoiseLQLoc,[256,256,1/256,1/256]),this.gl.uniform4fv(this.texsizeNoiseMQLoc,[256,256,1/256,1/256]),this.gl.uniform4fv(this.texsizeNoiseHQLoc,[256,256,1/256,1/256]),this.gl.uniform4fv(this.texsizeNoiseLQLiteLoc,[32,32,1/32,1/32]),this.gl.uniform4fv(this.texsizeNoiseVolLQLoc,[32,32,1/32,1/32]),this.gl.uniform4fv(this.texsizeNoiseVolHQLoc,[32,32,1/32,1/32]),this.gl.uniform1f(this.bassLoc,R.bass),this.gl.uniform1f(this.midLoc,R.mid),this.gl.uniform1f(this.trebLoc,R.treb),this.gl.uniform1f(this.volLoc,(R.bass+R.mid+R.treb)/3),this.gl.uniform1f(this.bassAttLoc,R.bass_att),this.gl.uniform1f(this.midAttLoc,R.mid_att),this.gl.uniform1f(this.trebAttLoc,R.treb_att),this.gl.uniform1f(this.volAttLoc,(R.bass_att+R.mid_att+R.treb_att)/3),this.gl.uniform1f(this.frameLoc,R.frame),this.gl.uniform1f(this.fpsLoc,R.fps),this.gl.uniform4fv(this.randPresetLoc,R.rand_preset),this.gl.uniform4fv(this.randFrameLoc,new Float32Array([Math.random(),Math.random(),Math.random(),Math.random()])),this.gl.uniform1f(this.fShaderLoc,R.fshader),this.gl.uniform4fv(this.qaLoc,new Float32Array([R.q1||0,R.q2||0,R.q3||0,R.q4||0])),this.gl.uniform4fv(this.qbLoc,new Float32Array([R.q5||0,R.q6||0,R.q7||0,R.q8||0])),this.gl.uniform4fv(this.qcLoc,new Float32Array([R.q9||0,R.q10||0,R.q11||0,R.q12||0])),this.gl.uniform4fv(this.qdLoc,new Float32Array([R.q13||0,R.q14||0,R.q15||0,R.q16||0])),this.gl.uniform4fv(this.qeLoc,new Float32Array([R.q17||0,R.q18||0,R.q19||0,R.q20||0])),this.gl.uniform4fv(this.qfLoc,new Float32Array([R.q21||0,R.q22||0,R.q23||0,R.q24||0])),this.gl.uniform4fv(this.qgLoc,new Float32Array([R.q25||0,R.q26||0,R.q27||0,R.q28||0])),this.gl.uniform4fv(this.qhLoc,new Float32Array([R.q29||0,R.q30||0,R.q31||0,R.q32||0])),this.gl.uniform4fv(this.slowRoamCosLoc,[.5+.5*Math.cos(R.time*.005),.5+.5*Math.cos(R.time*.008),.5+.5*Math.cos(R.time*.013),.5+.5*Math.cos(R.time*.022)]),this.gl.uniform4fv(this.roamCosLoc,[.5+.5*Math.cos(R.time*.3),.5+.5*Math.cos(R.time*1.3),.5+.5*Math.cos(R.time*5),.5+.5*Math.cos(R.time*20)]),this.gl.uniform4fv(this.slowRoamSinLoc,[.5+.5*Math.sin(R.time*.005),.5+.5*Math.sin(R.time*.008),.5+.5*Math.sin(R.time*.013),.5+.5*Math.sin(R.time*.022)]),this.gl.uniform4fv(this.roamSinLoc,[.5+.5*Math.sin(R.time*.3),.5+.5*Math.sin(R.time*1.3),.5+.5*Math.sin(R.time*5),.5+.5*Math.sin(R.time*20)]),this.bindBlurVals(_,M),l?this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA):this.gl.disable(this.gl.BLEND),this.gl.drawElements(this.gl.TRIANGLES,this.indices.length,this.gl.UNSIGNED_SHORT,0),l||this.gl.enable(this.gl.BLEND)}}],[{key:"generateHueBase",value:function(l){for(var d=new Float32Array([1,1,1,1,1,1,1,1,1,1,1,1]),m=0;m<4;m++){d[m*3+0]=.6+.3*Math.sin(l.time*30*.0143+3+m*21+l.rand_start[3]),d[m*3+1]=.6+.3*Math.sin(l.time*30*.0107+1+m*13+l.rand_start[1]),d[m*3+2]=.6+.3*Math.sin(l.time*30*.0129+6+m*9+l.rand_start[2]);for(var E=Math.max(d[m*3],d[m*3+1],d[m*3+2]),S=0;S<3;S++)d[m*3+S]=d[m*3+S]/E,d[m*3+S]=.5+.5*d[m*3+S]}return d}}]),y})()}),"./src/rendering/shaders/output.js":(function(t,n,r){r.r(n),r.d(n,"default",function(){return g});var i=r("./src/rendering/shaders/shaderUtils.js");function c(y,u){if(!(y instanceof u))throw new TypeError("Cannot call a class as a function")}function h(y,u){for(var l=0;l<u.length;l++){var d=u[l];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(y,d.key,d)}}function f(y,u,l){return u&&h(y.prototype,u),y}var g=(function(){function y(u,l){c(this,y),this.gl=u,this.textureRatio=l.textureRatio,this.texsizeX=l.texsizeX,this.texsizeY=l.texsizeY,this.positions=new Float32Array([-1,-1,1,-1,-1,1,1,1]),this.vertexBuf=this.gl.createBuffer(),this.floatPrecision=i.default.getFragmentFloatPrecision(this.gl),this.useFXAA()?this.createFXAAShader():this.createShader()}return f(y,[{key:"useFXAA",value:function(){return this.textureRatio<=1}},{key:"updateGlobals",value:function(l){this.textureRatio=l.textureRatio,this.texsizeX=l.texsizeX,this.texsizeY=l.texsizeY,this.gl.deleteProgram(this.shaderProgram),this.useFXAA()?this.createFXAAShader():this.createShader()}},{key:"createFXAAShader",value:function(){this.shaderProgram=this.gl.createProgram();var l=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(l,`#version 300 es
       const vec2 halfmad = vec2(0.5);
       in vec2 aPos;
       out vec2 v_rgbM;
       out vec2 v_rgbNW;
       out vec2 v_rgbNE;
       out vec2 v_rgbSW;
       out vec2 v_rgbSE;
       uniform vec4 texsize;
       void main(void) {
         gl_Position = vec4(aPos, 0.0, 1.0);

         v_rgbM = aPos * halfmad + halfmad;
         v_rgbNW = v_rgbM + (vec2(-1.0, -1.0) * texsize.zx);
         v_rgbNE = v_rgbM + (vec2(1.0, -1.0) * texsize.zx);
         v_rgbSW = v_rgbM + (vec2(-1.0, 1.0) * texsize.zx);
         v_rgbSE = v_rgbM + (vec2(1.0, 1.0) * texsize.zx);
       }`),this.gl.compileShader(l);var d=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(d,`#version 300 es
       precision `.concat(this.floatPrecision,` float;
       precision highp int;
       precision mediump sampler2D;

       in vec2 v_rgbM;
       in vec2 v_rgbNW;
       in vec2 v_rgbNE;
       in vec2 v_rgbSW;
       in vec2 v_rgbSE;
       out vec4 fragColor;
       uniform vec4 texsize;
       uniform sampler2D uTexture;

       #ifndef FXAA_REDUCE_MIN
         #define FXAA_REDUCE_MIN   (1.0/ 128.0)
       #endif
       #ifndef FXAA_REDUCE_MUL
         #define FXAA_REDUCE_MUL   (1.0 / 8.0)
       #endif
       #ifndef FXAA_SPAN_MAX
         #define FXAA_SPAN_MAX     8.0
       #endif

       void main(void) {
         vec4 color;
         vec3 rgbNW = textureLod(uTexture, v_rgbNW, 0.0).xyz;
         vec3 rgbNE = textureLod(uTexture, v_rgbNE, 0.0).xyz;
         vec3 rgbSW = textureLod(uTexture, v_rgbSW, 0.0).xyz;
         vec3 rgbSE = textureLod(uTexture, v_rgbSE, 0.0).xyz;
         vec3 rgbM  = textureLod(uTexture, v_rgbM, 0.0).xyz;
         vec3 luma = vec3(0.299, 0.587, 0.114);
         float lumaNW = dot(rgbNW, luma);
         float lumaNE = dot(rgbNE, luma);
         float lumaSW = dot(rgbSW, luma);
         float lumaSE = dot(rgbSE, luma);
         float lumaM  = dot(rgbM,  luma);
         float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
         float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

         mediump vec2 dir;
         dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
         dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

         float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                               (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

         float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
         dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
                   max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                   dir * rcpDirMin)) * texsize.zw;

         vec3 rgbA = 0.5 * (
             textureLod(uTexture, v_rgbM + dir * (1.0 / 3.0 - 0.5), 0.0).xyz +
             textureLod(uTexture, v_rgbM + dir * (2.0 / 3.0 - 0.5), 0.0).xyz);
         vec3 rgbB = rgbA * 0.5 + 0.25 * (
             textureLod(uTexture, v_rgbM + dir * -0.5, 0.0).xyz +
             textureLod(uTexture, v_rgbM + dir * 0.5, 0.0).xyz);

         float lumaB = dot(rgbB, luma);
         if ((lumaB < lumaMin) || (lumaB > lumaMax))
           color = vec4(rgbA, 1.0);
         else
           color = vec4(rgbB, 1.0);

         fragColor = color;
       }`)),this.gl.compileShader(d),this.gl.attachShader(this.shaderProgram,l),this.gl.attachShader(this.shaderProgram,d),this.gl.linkProgram(this.shaderProgram),this.positionLocation=this.gl.getAttribLocation(this.shaderProgram,"aPos"),this.textureLoc=this.gl.getUniformLocation(this.shaderProgram,"uTexture"),this.texsizeLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize")}},{key:"createShader",value:function(){this.shaderProgram=this.gl.createProgram();var l=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(l,`#version 300 es
       const vec2 halfmad = vec2(0.5);
       in vec2 aPos;
       out vec2 uv;
       void main(void) {
         gl_Position = vec4(aPos, 0.0, 1.0);
         uv = aPos * halfmad + halfmad;
       }`),this.gl.compileShader(l);var d=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(d,`#version 300 es
       precision `.concat(this.floatPrecision,` float;
       precision highp int;
       precision mediump sampler2D;

       in vec2 uv;
       out vec4 fragColor;
       uniform sampler2D uTexture;

       void main(void) {
         fragColor = vec4(texture(uTexture, uv).rgb, 1.0);
       }`)),this.gl.compileShader(d),this.gl.attachShader(this.shaderProgram,l),this.gl.attachShader(this.shaderProgram,d),this.gl.linkProgram(this.shaderProgram),this.positionLocation=this.gl.getAttribLocation(this.shaderProgram,"aPos"),this.textureLoc=this.gl.getUniformLocation(this.shaderProgram,"uTexture")}},{key:"renderQuadTexture",value:function(l){this.gl.useProgram(this.shaderProgram),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.positions,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.positionLocation,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,l),this.gl.uniform1i(this.textureLoc,0),this.useFXAA()&&this.gl.uniform4fv(this.texsizeLoc,new Float32Array([this.texsizeX,this.texsizeY,1/this.texsizeX,1/this.texsizeY])),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}}]),y})()}),"./src/rendering/shaders/resample.js":(function(t,n,r){r.r(n),r.d(n,"default",function(){return g});var i=r("./src/rendering/shaders/shaderUtils.js");function c(y,u){if(!(y instanceof u))throw new TypeError("Cannot call a class as a function")}function h(y,u){for(var l=0;l<u.length;l++){var d=u[l];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(y,d.key,d)}}function f(y,u,l){return u&&h(y.prototype,u),y}var g=(function(){function y(u){c(this,y),this.gl=u,this.positions=new Float32Array([-1,-1,1,-1,-1,1,1,1]),this.vertexBuf=this.gl.createBuffer(),this.floatPrecision=i.default.getFragmentFloatPrecision(this.gl),this.createShader()}return f(y,[{key:"createShader",value:function(){this.shaderProgram=this.gl.createProgram();var l=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(l,`#version 300 es
       const vec2 halfmad = vec2(0.5);
       in vec2 aPos;
       out vec2 uv;
       void main(void) {
         gl_Position = vec4(aPos, 0.0, 1.0);
         uv = aPos * halfmad + halfmad;
       }`),this.gl.compileShader(l);var d=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(d,`#version 300 es
       precision `.concat(this.floatPrecision,` float;
       precision highp int;
       precision mediump sampler2D;

       in vec2 uv;
       out vec4 fragColor;
       uniform sampler2D uTexture;

       void main(void) {
         fragColor = vec4(texture(uTexture, uv).rgb, 1.0);
       }`)),this.gl.compileShader(d),this.gl.attachShader(this.shaderProgram,l),this.gl.attachShader(this.shaderProgram,d),this.gl.linkProgram(this.shaderProgram),this.positionLocation=this.gl.getAttribLocation(this.shaderProgram,"aPos"),this.textureLoc=this.gl.getUniformLocation(this.shaderProgram,"uTexture")}},{key:"renderQuadTexture",value:function(l){this.gl.useProgram(this.shaderProgram),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.positions,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.positionLocation,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,l),this.gl.generateMipmap(this.gl.TEXTURE_2D),this.gl.uniform1i(this.textureLoc,0),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}}]),y})()}),"./src/rendering/shaders/shaderUtils.js":(function(t,n,r){r.r(n),r.d(n,"default",function(){return y});function i(u,l){if(!(u instanceof l))throw new TypeError("Cannot call a class as a function")}function c(u,l){for(var d=0;d<l.length;d++){var m=l[d];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(u,m.key,m)}}function h(u,l,d){return d&&c(u,d),u}var f=/uniform sampler2D sampler_(?:.+?);/g,g=/uniform sampler2D sampler_(.+?);/,y=(function(){function u(){i(this,u)}return h(u,null,[{key:"getShaderParts",value:function(d){var m=d.indexOf("shader_body");if(d&&m>-1){var E=d.substring(0,m),S=d.substring(m),_=S.indexOf("{"),M=S.lastIndexOf("}"),R=S.substring(_+1,M);return[E,R]}return["",d]}},{key:"getFragmentFloatPrecision",value:function(d){return d.getShaderPrecisionFormat(d.FRAGMENT_SHADER,d.HIGH_FLOAT).precision>0?"highp":d.getShaderPrecisionFormat(d.FRAGMENT_SHADER,d.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}},{key:"getUserSamplers",value:function(d){var m=[],E=d.match(f);if(E&&E.length>0)for(var S=0;S<E.length;S++){var _=E[S].match(g);if(_&&_.length>0){var M=_[1];m.push({sampler:M})}}return m}}]),u})()}),"./src/rendering/shaders/warp.js":(function(t,n,r){r.r(n),r.d(n,"default",function(){return g});var i=r("./src/rendering/shaders/shaderUtils.js");function c(y,u){if(!(y instanceof u))throw new TypeError("Cannot call a class as a function")}function h(y,u){for(var l=0;l<u.length;l++){var d=u[l];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(y,d.key,d)}}function f(y,u,l){return u&&h(y.prototype,u),y}var g=(function(){function y(u,l,d){var m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};c(this,y),this.gl=u,this.noise=l,this.image=d,this.texsizeX=m.texsizeX,this.texsizeY=m.texsizeY,this.mesh_width=m.mesh_width,this.mesh_height=m.mesh_height,this.aspectx=m.aspectx,this.aspecty=m.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty,this.buildPositions(),this.indexBuf=u.createBuffer(),this.positionVertexBuf=this.gl.createBuffer(),this.warpUvVertexBuf=this.gl.createBuffer(),this.warpColorVertexBuf=this.gl.createBuffer(),this.floatPrecision=i.default.getFragmentFloatPrecision(this.gl),this.createShader(),this.mainSampler=this.gl.createSampler(),this.mainSamplerFW=this.gl.createSampler(),this.mainSamplerFC=this.gl.createSampler(),this.mainSamplerPW=this.gl.createSampler(),this.mainSamplerPC=this.gl.createSampler(),u.samplerParameteri(this.mainSampler,u.TEXTURE_MIN_FILTER,u.LINEAR_MIPMAP_LINEAR),u.samplerParameteri(this.mainSampler,u.TEXTURE_MAG_FILTER,u.LINEAR),u.samplerParameteri(this.mainSampler,u.TEXTURE_WRAP_S,u.REPEAT),u.samplerParameteri(this.mainSampler,u.TEXTURE_WRAP_T,u.REPEAT),u.samplerParameteri(this.mainSamplerFW,u.TEXTURE_MIN_FILTER,u.LINEAR_MIPMAP_LINEAR),u.samplerParameteri(this.mainSamplerFW,u.TEXTURE_MAG_FILTER,u.LINEAR),u.samplerParameteri(this.mainSamplerFW,u.TEXTURE_WRAP_S,u.REPEAT),u.samplerParameteri(this.mainSamplerFW,u.TEXTURE_WRAP_T,u.REPEAT),u.samplerParameteri(this.mainSamplerFC,u.TEXTURE_MIN_FILTER,u.LINEAR_MIPMAP_LINEAR),u.samplerParameteri(this.mainSamplerFC,u.TEXTURE_MAG_FILTER,u.LINEAR),u.samplerParameteri(this.mainSamplerFC,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.samplerParameteri(this.mainSamplerFC,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.samplerParameteri(this.mainSamplerPW,u.TEXTURE_MIN_FILTER,u.NEAREST_MIPMAP_NEAREST),u.samplerParameteri(this.mainSamplerPW,u.TEXTURE_MAG_FILTER,u.NEAREST),u.samplerParameteri(this.mainSamplerPW,u.TEXTURE_WRAP_S,u.REPEAT),u.samplerParameteri(this.mainSamplerPW,u.TEXTURE_WRAP_T,u.REPEAT),u.samplerParameteri(this.mainSamplerPC,u.TEXTURE_MIN_FILTER,u.NEAREST_MIPMAP_NEAREST),u.samplerParameteri(this.mainSamplerPC,u.TEXTURE_MAG_FILTER,u.NEAREST),u.samplerParameteri(this.mainSamplerPC,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.samplerParameteri(this.mainSamplerPC,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE)}return f(y,[{key:"buildPositions",value:function(){for(var l=2,d=2,m=l/2,E=d/2,S=this.mesh_width,_=this.mesh_height,M=S+1,R=_+1,W=l/S,fe=d/_,ye=[],Y=0;Y<R;Y++)for(var j=Y*fe-E,se=0;se<M;se++){var Te=se*W-m;ye.push(Te,-j,0)}for(var Ae=[],ze=0;ze<_;ze++)for(var de=0;de<S;de++){var we=de+M*ze,ce=de+M*(ze+1),he=de+1+M*(ze+1),Pe=de+1+M*ze;Ae.push(we,ce,Pe),Ae.push(ce,he,Pe)}this.vertices=new Float32Array(ye),this.indices=new Uint16Array(Ae)}},{key:"updateGlobals",value:function(l){this.texsizeX=l.texsizeX,this.texsizeY=l.texsizeY,this.mesh_width=l.mesh_width,this.mesh_height=l.mesh_height,this.aspectx=l.aspectx,this.aspecty=l.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty,this.buildPositions()}},{key:"createShader",value:function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",d,m;if(l.length===0)d="ret = texture(sampler_main, uv).rgb * decay;",m="";else{var E=i.default.getShaderParts(l);m=E[0],d=E[1]}d=d.replace(/texture2D/g,"texture"),d=d.replace(/texture3D/g,"texture"),this.userTextures=i.default.getUserSamplers(m),this.shaderProgram=this.gl.createProgram();var S=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(S,`#version 300 es
                                      precision `.concat(this.floatPrecision,` float;
                                      const vec2 halfmad = vec2(0.5);
                                      in vec2 aPos;
                                      in vec2 aWarpUv;
                                      in vec4 aWarpColor;
                                      out vec2 uv;
                                      out vec2 uv_orig;
                                      out vec4 vColor;
                                      void main(void) {
                                        gl_Position = vec4(aPos, 0.0, 1.0);
                                        uv_orig = aPos * halfmad + halfmad;
                                        uv = aWarpUv;
                                        vColor = aWarpColor;
                                      }`)),this.gl.compileShader(S);var _=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(_,`#version 300 es
                                      precision `.concat(this.floatPrecision,` float;
                                      precision highp int;
                                      precision mediump sampler2D;
                                      precision mediump sampler3D;

                                      in vec2 uv;
                                      in vec2 uv_orig;
                                      in vec4 vColor;
                                      out vec4 fragColor;
                                      uniform sampler2D sampler_main;
                                      uniform sampler2D sampler_fw_main;
                                      uniform sampler2D sampler_fc_main;
                                      uniform sampler2D sampler_pw_main;
                                      uniform sampler2D sampler_pc_main;
                                      uniform sampler2D sampler_blur1;
                                      uniform sampler2D sampler_blur2;
                                      uniform sampler2D sampler_blur3;
                                      uniform sampler2D sampler_noise_lq;
                                      uniform sampler2D sampler_noise_lq_lite;
                                      uniform sampler2D sampler_noise_mq;
                                      uniform sampler2D sampler_noise_hq;
                                      uniform sampler2D sampler_pw_noise_lq;
                                      uniform sampler3D sampler_noisevol_lq;
                                      uniform sampler3D sampler_noisevol_hq;
                                      uniform float time;
                                      uniform float decay;
                                      uniform vec2 resolution;
                                      uniform vec4 aspect;
                                      uniform vec4 texsize;
                                      uniform vec4 texsize_noise_lq;
                                      uniform vec4 texsize_noise_mq;
                                      uniform vec4 texsize_noise_hq;
                                      uniform vec4 texsize_noise_lq_lite;
                                      uniform vec4 texsize_noisevol_lq;
                                      uniform vec4 texsize_noisevol_hq;

                                      uniform float bass;
                                      uniform float mid;
                                      uniform float treb;
                                      uniform float vol;
                                      uniform float bass_att;
                                      uniform float mid_att;
                                      uniform float treb_att;
                                      uniform float vol_att;

                                      uniform float frame;
                                      uniform float fps;

                                      uniform vec4 _qa;
                                      uniform vec4 _qb;
                                      uniform vec4 _qc;
                                      uniform vec4 _qd;
                                      uniform vec4 _qe;
                                      uniform vec4 _qf;
                                      uniform vec4 _qg;
                                      uniform vec4 _qh;

                                      #define q1 _qa.x
                                      #define q2 _qa.y
                                      #define q3 _qa.z
                                      #define q4 _qa.w
                                      #define q5 _qb.x
                                      #define q6 _qb.y
                                      #define q7 _qb.z
                                      #define q8 _qb.w
                                      #define q9 _qc.x
                                      #define q10 _qc.y
                                      #define q11 _qc.z
                                      #define q12 _qc.w
                                      #define q13 _qd.x
                                      #define q14 _qd.y
                                      #define q15 _qd.z
                                      #define q16 _qd.w
                                      #define q17 _qe.x
                                      #define q18 _qe.y
                                      #define q19 _qe.z
                                      #define q20 _qe.w
                                      #define q21 _qf.x
                                      #define q22 _qf.y
                                      #define q23 _qf.z
                                      #define q24 _qf.w
                                      #define q25 _qg.x
                                      #define q26 _qg.y
                                      #define q27 _qg.z
                                      #define q28 _qg.w
                                      #define q29 _qh.x
                                      #define q30 _qh.y
                                      #define q31 _qh.z
                                      #define q32 _qh.w

                                      uniform vec4 slow_roam_cos;
                                      uniform vec4 roam_cos;
                                      uniform vec4 slow_roam_sin;
                                      uniform vec4 roam_sin;

                                      uniform float blur1_min;
                                      uniform float blur1_max;
                                      uniform float blur2_min;
                                      uniform float blur2_max;
                                      uniform float blur3_min;
                                      uniform float blur3_max;

                                      uniform float scale1;
                                      uniform float scale2;
                                      uniform float scale3;
                                      uniform float bias1;
                                      uniform float bias2;
                                      uniform float bias3;

                                      uniform vec4 rand_frame;
                                      uniform vec4 rand_preset;

                                      float PI = `).concat(Math.PI,`;

                                      `).concat(m,`

                                      void main(void) {
                                        vec3 ret;
                                        float rad = length(uv_orig - 0.5);
                                        float ang = atan(uv_orig.x - 0.5, uv_orig.y - 0.5);

                                        `).concat(d,`

                                        fragColor = vec4(ret, 1.0) * vColor;
                                      }`)),this.gl.compileShader(_),this.gl.attachShader(this.shaderProgram,S),this.gl.attachShader(this.shaderProgram,_),this.gl.linkProgram(this.shaderProgram),this.positionLocation=this.gl.getAttribLocation(this.shaderProgram,"aPos"),this.warpUvLocation=this.gl.getAttribLocation(this.shaderProgram,"aWarpUv"),this.warpColorLocation=this.gl.getAttribLocation(this.shaderProgram,"aWarpColor"),this.textureLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_main"),this.textureFWLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_fw_main"),this.textureFCLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_fc_main"),this.texturePWLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_pw_main"),this.texturePCLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_pc_main"),this.blurTexture1Loc=this.gl.getUniformLocation(this.shaderProgram,"sampler_blur1"),this.blurTexture2Loc=this.gl.getUniformLocation(this.shaderProgram,"sampler_blur2"),this.blurTexture3Loc=this.gl.getUniformLocation(this.shaderProgram,"sampler_blur3"),this.noiseLQLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_noise_lq"),this.noiseMQLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_noise_mq"),this.noiseHQLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_noise_hq"),this.noiseLQLiteLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_noise_lq_lite"),this.noisePointLQLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_pw_noise_lq"),this.noiseVolLQLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_noisevol_lq"),this.noiseVolHQLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_noisevol_hq"),this.decayLoc=this.gl.getUniformLocation(this.shaderProgram,"decay"),this.texsizeLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize"),this.texsizeNoiseLQLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize_noise_lq"),this.texsizeNoiseMQLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize_noise_mq"),this.texsizeNoiseHQLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize_noise_hq"),this.texsizeNoiseLQLiteLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize_noise_lq_lite"),this.texsizeNoiseVolLQLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize_noisevol_lq"),this.texsizeNoiseVolHQLoc=this.gl.getUniformLocation(this.shaderProgram,"texsize_noisevol_hq"),this.resolutionLoc=this.gl.getUniformLocation(this.shaderProgram,"resolution"),this.aspectLoc=this.gl.getUniformLocation(this.shaderProgram,"aspect"),this.bassLoc=this.gl.getUniformLocation(this.shaderProgram,"bass"),this.midLoc=this.gl.getUniformLocation(this.shaderProgram,"mid"),this.trebLoc=this.gl.getUniformLocation(this.shaderProgram,"treb"),this.volLoc=this.gl.getUniformLocation(this.shaderProgram,"vol"),this.bassAttLoc=this.gl.getUniformLocation(this.shaderProgram,"bass_att"),this.midAttLoc=this.gl.getUniformLocation(this.shaderProgram,"mid_att"),this.trebAttLoc=this.gl.getUniformLocation(this.shaderProgram,"treb_att"),this.volAttLoc=this.gl.getUniformLocation(this.shaderProgram,"vol_att"),this.timeLoc=this.gl.getUniformLocation(this.shaderProgram,"time"),this.frameLoc=this.gl.getUniformLocation(this.shaderProgram,"frame"),this.fpsLoc=this.gl.getUniformLocation(this.shaderProgram,"fps"),this.blur1MinLoc=this.gl.getUniformLocation(this.shaderProgram,"blur1_min"),this.blur1MaxLoc=this.gl.getUniformLocation(this.shaderProgram,"blur1_max"),this.blur2MinLoc=this.gl.getUniformLocation(this.shaderProgram,"blur2_min"),this.blur2MaxLoc=this.gl.getUniformLocation(this.shaderProgram,"blur2_max"),this.blur3MinLoc=this.gl.getUniformLocation(this.shaderProgram,"blur3_min"),this.blur3MaxLoc=this.gl.getUniformLocation(this.shaderProgram,"blur3_max"),this.scale1Loc=this.gl.getUniformLocation(this.shaderProgram,"scale1"),this.scale2Loc=this.gl.getUniformLocation(this.shaderProgram,"scale2"),this.scale3Loc=this.gl.getUniformLocation(this.shaderProgram,"scale3"),this.bias1Loc=this.gl.getUniformLocation(this.shaderProgram,"bias1"),this.bias2Loc=this.gl.getUniformLocation(this.shaderProgram,"bias2"),this.bias3Loc=this.gl.getUniformLocation(this.shaderProgram,"bias3"),this.randPresetLoc=this.gl.getUniformLocation(this.shaderProgram,"rand_preset"),this.randFrameLoc=this.gl.getUniformLocation(this.shaderProgram,"rand_frame"),this.qaLoc=this.gl.getUniformLocation(this.shaderProgram,"_qa"),this.qbLoc=this.gl.getUniformLocation(this.shaderProgram,"_qb"),this.qcLoc=this.gl.getUniformLocation(this.shaderProgram,"_qc"),this.qdLoc=this.gl.getUniformLocation(this.shaderProgram,"_qd"),this.qeLoc=this.gl.getUniformLocation(this.shaderProgram,"_qe"),this.qfLoc=this.gl.getUniformLocation(this.shaderProgram,"_qf"),this.qgLoc=this.gl.getUniformLocation(this.shaderProgram,"_qg"),this.qhLoc=this.gl.getUniformLocation(this.shaderProgram,"_qh"),this.slowRoamCosLoc=this.gl.getUniformLocation(this.shaderProgram,"slow_roam_cos"),this.roamCosLoc=this.gl.getUniformLocation(this.shaderProgram,"roam_cos"),this.slowRoamSinLoc=this.gl.getUniformLocation(this.shaderProgram,"slow_roam_sin"),this.roamSinLoc=this.gl.getUniformLocation(this.shaderProgram,"roam_sin");for(var M=0;M<this.userTextures.length;M++){var R=this.userTextures[M];R.textureLoc=this.gl.getUniformLocation(this.shaderProgram,"sampler_".concat(R.sampler))}}},{key:"updateShader",value:function(l){this.createShader(l)}},{key:"bindBlurVals",value:function(l,d){var m=l[0],E=l[1],S=l[2],_=d[0],M=d[1],R=d[2],W=_-m,fe=m,ye=M-E,Y=E,j=R-S,se=S;this.gl.uniform1f(this.blur1MinLoc,m),this.gl.uniform1f(this.blur1MaxLoc,_),this.gl.uniform1f(this.blur2MinLoc,E),this.gl.uniform1f(this.blur2MaxLoc,M),this.gl.uniform1f(this.blur3MinLoc,S),this.gl.uniform1f(this.blur3MaxLoc,R),this.gl.uniform1f(this.scale1Loc,W),this.gl.uniform1f(this.scale2Loc,ye),this.gl.uniform1f(this.scale3Loc,j),this.gl.uniform1f(this.bias1Loc,fe),this.gl.uniform1f(this.bias2Loc,Y),this.gl.uniform1f(this.bias3Loc,se)}},{key:"renderQuadTexture",value:function(l,d,m,E,S,_,M,R,W,fe){this.gl.useProgram(this.shaderProgram),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.indexBuf),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.indices,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertices,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.positionLocation,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.warpUvVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,W,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.warpUvLocation,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.warpUvLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.warpColorVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,fe,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.warpColorLocation,4,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.warpColorLocation);var ye=R.wrap!==0?this.gl.REPEAT:this.gl.CLAMP_TO_EDGE;this.gl.samplerParameteri(this.mainSampler,this.gl.TEXTURE_WRAP_S,ye),this.gl.samplerParameteri(this.mainSampler,this.gl.TEXTURE_WRAP_T,ye),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,d),this.gl.bindSampler(0,this.mainSampler),this.gl.uniform1i(this.textureLoc,0),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,d),this.gl.bindSampler(1,this.mainSamplerFW),this.gl.uniform1i(this.textureFWLoc,1),this.gl.activeTexture(this.gl.TEXTURE2),this.gl.bindTexture(this.gl.TEXTURE_2D,d),this.gl.bindSampler(2,this.mainSamplerFC),this.gl.uniform1i(this.textureFCLoc,2),this.gl.activeTexture(this.gl.TEXTURE3),this.gl.bindTexture(this.gl.TEXTURE_2D,d),this.gl.bindSampler(3,this.mainSamplerPW),this.gl.uniform1i(this.texturePWLoc,3),this.gl.activeTexture(this.gl.TEXTURE4),this.gl.bindTexture(this.gl.TEXTURE_2D,d),this.gl.bindSampler(4,this.mainSamplerPC),this.gl.uniform1i(this.texturePCLoc,4),this.gl.activeTexture(this.gl.TEXTURE5),this.gl.bindTexture(this.gl.TEXTURE_2D,m),this.gl.uniform1i(this.blurTexture1Loc,5),this.gl.activeTexture(this.gl.TEXTURE6),this.gl.bindTexture(this.gl.TEXTURE_2D,E),this.gl.uniform1i(this.blurTexture2Loc,6),this.gl.activeTexture(this.gl.TEXTURE7),this.gl.bindTexture(this.gl.TEXTURE_2D,S),this.gl.uniform1i(this.blurTexture3Loc,7),this.gl.activeTexture(this.gl.TEXTURE8),this.gl.bindTexture(this.gl.TEXTURE_2D,this.noise.noiseTexLQ),this.gl.uniform1i(this.noiseLQLoc,8),this.gl.activeTexture(this.gl.TEXTURE9),this.gl.bindTexture(this.gl.TEXTURE_2D,this.noise.noiseTexMQ),this.gl.uniform1i(this.noiseMQLoc,9),this.gl.activeTexture(this.gl.TEXTURE10),this.gl.bindTexture(this.gl.TEXTURE_2D,this.noise.noiseTexHQ),this.gl.uniform1i(this.noiseHQLoc,10),this.gl.activeTexture(this.gl.TEXTURE11),this.gl.bindTexture(this.gl.TEXTURE_2D,this.noise.noiseTexLQLite),this.gl.uniform1i(this.noiseLQLiteLoc,11),this.gl.activeTexture(this.gl.TEXTURE12),this.gl.bindTexture(this.gl.TEXTURE_2D,this.noise.noiseTexLQ),this.gl.bindSampler(12,this.noise.noiseTexPointLQ),this.gl.uniform1i(this.noisePointLQLoc,12),this.gl.activeTexture(this.gl.TEXTURE13),this.gl.bindTexture(this.gl.TEXTURE_3D,this.noise.noiseTexVolLQ),this.gl.uniform1i(this.noiseVolLQLoc,13),this.gl.activeTexture(this.gl.TEXTURE14),this.gl.bindTexture(this.gl.TEXTURE_3D,this.noise.noiseTexVolHQ),this.gl.uniform1i(this.noiseVolHQLoc,14);for(var Y=0;Y<this.userTextures.length;Y++){var j=this.userTextures[Y];this.gl.activeTexture(this.gl.TEXTURE15+Y),this.gl.bindTexture(this.gl.TEXTURE_2D,this.image.getTexture(j.sampler)),this.gl.uniform1i(j.textureLoc,15+Y)}this.gl.uniform1f(this.decayLoc,R.decay),this.gl.uniform2fv(this.resolutionLoc,[this.texsizeX,this.texsizeY]),this.gl.uniform4fv(this.aspectLoc,[this.aspectx,this.aspecty,this.invAspectx,this.invAspecty]),this.gl.uniform4fv(this.texsizeLoc,[this.texsizeX,this.texsizeY,1/this.texsizeX,1/this.texsizeY]),this.gl.uniform4fv(this.texsizeNoiseLQLoc,[256,256,1/256,1/256]),this.gl.uniform4fv(this.texsizeNoiseMQLoc,[256,256,1/256,1/256]),this.gl.uniform4fv(this.texsizeNoiseHQLoc,[256,256,1/256,1/256]),this.gl.uniform4fv(this.texsizeNoiseLQLiteLoc,[32,32,1/32,1/32]),this.gl.uniform4fv(this.texsizeNoiseVolLQLoc,[32,32,1/32,1/32]),this.gl.uniform4fv(this.texsizeNoiseVolHQLoc,[32,32,1/32,1/32]),this.gl.uniform1f(this.bassLoc,R.bass),this.gl.uniform1f(this.midLoc,R.mid),this.gl.uniform1f(this.trebLoc,R.treb),this.gl.uniform1f(this.volLoc,(R.bass+R.mid+R.treb)/3),this.gl.uniform1f(this.bassAttLoc,R.bass_att),this.gl.uniform1f(this.midAttLoc,R.mid_att),this.gl.uniform1f(this.trebAttLoc,R.treb_att),this.gl.uniform1f(this.volAttLoc,(R.bass_att+R.mid_att+R.treb_att)/3),this.gl.uniform1f(this.timeLoc,R.time),this.gl.uniform1f(this.frameLoc,R.frame),this.gl.uniform1f(this.fpsLoc,R.fps),this.gl.uniform4fv(this.randPresetLoc,R.rand_preset),this.gl.uniform4fv(this.randFrameLoc,new Float32Array([Math.random(),Math.random(),Math.random(),Math.random()])),this.gl.uniform4fv(this.qaLoc,new Float32Array([R.q1||0,R.q2||0,R.q3||0,R.q4||0])),this.gl.uniform4fv(this.qbLoc,new Float32Array([R.q5||0,R.q6||0,R.q7||0,R.q8||0])),this.gl.uniform4fv(this.qcLoc,new Float32Array([R.q9||0,R.q10||0,R.q11||0,R.q12||0])),this.gl.uniform4fv(this.qdLoc,new Float32Array([R.q13||0,R.q14||0,R.q15||0,R.q16||0])),this.gl.uniform4fv(this.qeLoc,new Float32Array([R.q17||0,R.q18||0,R.q19||0,R.q20||0])),this.gl.uniform4fv(this.qfLoc,new Float32Array([R.q21||0,R.q22||0,R.q23||0,R.q24||0])),this.gl.uniform4fv(this.qgLoc,new Float32Array([R.q25||0,R.q26||0,R.q27||0,R.q28||0])),this.gl.uniform4fv(this.qhLoc,new Float32Array([R.q29||0,R.q30||0,R.q31||0,R.q32||0])),this.gl.uniform4fv(this.slowRoamCosLoc,[.5+.5*Math.cos(R.time*.005),.5+.5*Math.cos(R.time*.008),.5+.5*Math.cos(R.time*.013),.5+.5*Math.cos(R.time*.022)]),this.gl.uniform4fv(this.roamCosLoc,[.5+.5*Math.cos(R.time*.3),.5+.5*Math.cos(R.time*1.3),.5+.5*Math.cos(R.time*5),.5+.5*Math.cos(R.time*20)]),this.gl.uniform4fv(this.slowRoamSinLoc,[.5+.5*Math.sin(R.time*.005),.5+.5*Math.sin(R.time*.008),.5+.5*Math.sin(R.time*.013),.5+.5*Math.sin(R.time*.022)]),this.gl.uniform4fv(this.roamSinLoc,[.5+.5*Math.sin(R.time*.3),.5+.5*Math.sin(R.time*1.3),.5+.5*Math.sin(R.time*5),.5+.5*Math.sin(R.time*20)]),this.bindBlurVals(_,M),l?this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA):this.gl.disable(this.gl.BLEND),this.gl.drawElements(this.gl.TRIANGLES,this.indices.length,this.gl.UNSIGNED_SHORT,0),l||this.gl.enable(this.gl.BLEND)}}]),y})()}),"./src/rendering/shapes/customShape.js":(function(t,n,r){r.r(n),r.d(n,"default",function(){return y});var i=r("./src/utils.js"),c=r("./src/rendering/shaders/shaderUtils.js");function h(u,l){if(!(u instanceof l))throw new TypeError("Cannot call a class as a function")}function f(u,l){for(var d=0;d<l.length;d++){var m=l[d];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(u,m.key,m)}}function g(u,l,d){return l&&f(u.prototype,l),u}var y=(function(){function u(l,d,m){h(this,u),this.index=l,this.gl=d;var E=101;this.positions=new Float32Array((E+2)*3),this.colors=new Float32Array((E+2)*4),this.uvs=new Float32Array((E+2)*2),this.borderPositions=new Float32Array((E+1)*3),this.texsizeX=m.texsizeX,this.texsizeY=m.texsizeY,this.mesh_width=m.mesh_width,this.mesh_height=m.mesh_height,this.aspectx=m.aspectx,this.aspecty=m.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty,this.positionVertexBuf=this.gl.createBuffer(),this.colorVertexBuf=this.gl.createBuffer(),this.uvVertexBuf=this.gl.createBuffer(),this.borderPositionVertexBuf=this.gl.createBuffer(),this.floatPrecision=c.default.getFragmentFloatPrecision(this.gl),this.createShader(),this.createBorderShader(),this.mainSampler=this.gl.createSampler(),d.samplerParameteri(this.mainSampler,d.TEXTURE_MIN_FILTER,d.LINEAR_MIPMAP_LINEAR),d.samplerParameteri(this.mainSampler,d.TEXTURE_MAG_FILTER,d.LINEAR),d.samplerParameteri(this.mainSampler,d.TEXTURE_WRAP_S,d.REPEAT),d.samplerParameteri(this.mainSampler,d.TEXTURE_WRAP_T,d.REPEAT)}return g(u,[{key:"updateGlobals",value:function(d){this.texsizeX=d.texsizeX,this.texsizeY=d.texsizeY,this.mesh_width=d.mesh_width,this.mesh_height=d.mesh_height,this.aspectx=d.aspectx,this.aspecty=d.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty}},{key:"createShader",value:function(){this.shaderProgram=this.gl.createProgram();var d=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(d,`#version 300 es
                                      in vec3 aPos;
                                      in vec4 aColor;
                                      in vec2 aUv;
                                      out vec4 vColor;
                                      out vec2 vUv;
                                      void main(void) {
                                        vColor = aColor;
                                        vUv = aUv;
                                        gl_Position = vec4(aPos, 1.0);
                                      }`),this.gl.compileShader(d);var m=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(m,`#version 300 es
                                      precision `.concat(this.floatPrecision,` float;
                                      precision highp int;
                                      precision mediump sampler2D;
                                      uniform sampler2D uTexture;
                                      uniform float uTextured;
                                      in vec4 vColor;
                                      in vec2 vUv;
                                      out vec4 fragColor;
                                      void main(void) {
                                        if (uTextured != 0.0) {
                                          fragColor = texture(uTexture, vUv) * vColor;
                                        } else {
                                          fragColor = vColor;
                                        }
                                      }`)),this.gl.compileShader(m),this.gl.attachShader(this.shaderProgram,d),this.gl.attachShader(this.shaderProgram,m),this.gl.linkProgram(this.shaderProgram),this.aPosLocation=this.gl.getAttribLocation(this.shaderProgram,"aPos"),this.aColorLocation=this.gl.getAttribLocation(this.shaderProgram,"aColor"),this.aUvLocation=this.gl.getAttribLocation(this.shaderProgram,"aUv"),this.texturedLoc=this.gl.getUniformLocation(this.shaderProgram,"uTextured"),this.textureLoc=this.gl.getUniformLocation(this.shaderProgram,"uTexture")}},{key:"createBorderShader",value:function(){this.borderShaderProgram=this.gl.createProgram();var d=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(d,`#version 300 es
                                      in vec3 aBorderPos;
                                      uniform vec2 thickOffset;
                                      void main(void) {
                                        gl_Position = vec4(aBorderPos +
                                                           vec3(thickOffset, 0.0), 1.0);
                                      }`),this.gl.compileShader(d);var m=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(m,`#version 300 es
                                      precision `.concat(this.floatPrecision,` float;
                                      precision highp int;
                                      precision mediump sampler2D;
                                      out vec4 fragColor;
                                      uniform vec4 uBorderColor;
                                      void main(void) {
                                        fragColor = uBorderColor;
                                      }`)),this.gl.compileShader(m),this.gl.attachShader(this.borderShaderProgram,d),this.gl.attachShader(this.borderShaderProgram,m),this.gl.linkProgram(this.borderShaderProgram),this.aBorderPosLoc=this.gl.getAttribLocation(this.borderShaderProgram,"aBorderPos"),this.uBorderColorLoc=this.gl.getUniformLocation(this.borderShaderProgram,"uBorderColor"),this.thickOffsetLoc=this.gl.getUniformLocation(this.shaderProgram,"thickOffset")}},{key:"drawCustomShape",value:function(d,m,E,S,_){if(S.baseVals.enabled!==0){this.setupShapeBuffers(E.mdVSFrame);for(var M=Object.assign({},E.mdVSShapes[this.index],E.mdVSFrameMapShapes[this.index],E.mdVSQAfterFrame,E.mdVSTShapeInits[this.index],m),R=i.default.cloneVars(M),W=Math.clamp(M.num_inst,1,1024),fe=0;fe<W;fe++){M.instance=fe,M.x=R.x,M.y=R.y,M.rad=R.rad,M.ang=R.ang,M.r=R.r,M.g=R.g,M.b=R.b,M.a=R.a,M.r2=R.r2,M.g2=R.g2,M.b2=R.b2,M.a2=R.a2,M.border_r=R.border_r,M.border_g=R.border_g,M.border_b=R.border_b,M.border_a=R.border_a,M.thickoutline=R.thickoutline,M.textured=R.textured,M.tex_zoom=R.tex_zoom,M.tex_ang=R.tex_ang,M.additive=R.additive;var ye=S.frame_eqs(M),Y=ye.sides;Y=Math.clamp(Y,3,100),Y=Math.floor(Y);var j=ye.rad,se=ye.ang,Te=ye.x*2-1,Ae=ye.y*-2+1,ze=ye.r,de=ye.g,we=ye.b,ce=ye.a,he=ye.r2,Pe=ye.g2,$e=ye.b2,He=ye.a2,et=ye.border_r,Ve=ye.border_g,Et=ye.border_b,Nt=ye.border_a;this.borderColor=[et,Ve,Et,Nt*d];var $t=ye.thickoutline,Ie=ye.textured,pe=ye.tex_zoom,Be=ye.tex_ang,O=ye.additive,z=this.borderColor[3]>0,k=Math.abs(Ie)>=1,L=Math.abs($t)>=1,ne=Math.abs(O)>=1;this.positions[0]=Te,this.positions[1]=Ae,this.positions[2]=0,this.colors[0]=ze,this.colors[1]=de,this.colors[2]=we,this.colors[3]=ce*d,k&&(this.uvs[0]=.5,this.uvs[1]=.5);for(var H=Math.PI*.25,De=1;De<=Y+1;De++){var Ye=(De-1)/Y,qe=Ye*2*Math.PI,Fe=qe+se+H;if(this.positions[De*3+0]=Te+j*Math.cos(Fe)*this.aspecty,this.positions[De*3+1]=Ae+j*Math.sin(Fe),this.positions[De*3+2]=0,this.colors[De*4+0]=he,this.colors[De*4+1]=Pe,this.colors[De*4+2]=$e,this.colors[De*4+3]=He*d,k){var Ue=qe+Be+H;this.uvs[De*2+0]=.5+.5*Math.cos(Ue)/pe*this.aspecty,this.uvs[De*2+1]=.5+.5*Math.sin(Ue)/pe}z&&(this.borderPositions[(De-1)*3+0]=this.positions[De*3+0],this.borderPositions[(De-1)*3+1]=this.positions[De*3+1],this.borderPositions[(De-1)*3+2]=this.positions[De*3+2])}this.mdVSShapeFrame=ye,this.drawCustomShapeInstance(_,Y,k,z,L,ne)}var Ke=E.mdVSUserKeysShapes[this.index],tt=i.default.pick(this.mdVSShapeFrame,Ke);E.mdVSFrameMapShapes[this.index]=tt}}},{key:"setupShapeBuffers",value:function(d){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.positions,this.gl.DYNAMIC_DRAW),this.gl.vertexAttribPointer(this.aPosLocation,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aPosLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.colorVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.colors,this.gl.DYNAMIC_DRAW),this.gl.vertexAttribPointer(this.aColorLocation,4,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aColorLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.uvVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.uvs,this.gl.DYNAMIC_DRAW),this.gl.vertexAttribPointer(this.aUvLocation,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aUvLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.borderPositionVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.borderPositions,this.gl.DYNAMIC_DRAW),this.gl.vertexAttribPointer(this.aBorderPosLoc,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aBorderPosLoc);var m=d.wrap!==0?this.gl.REPEAT:this.gl.CLAMP_TO_EDGE;this.gl.samplerParameteri(this.mainSampler,this.gl.TEXTURE_WRAP_S,m),this.gl.samplerParameteri(this.mainSampler,this.gl.TEXTURE_WRAP_T,m)}},{key:"drawCustomShapeInstance",value:function(d,m,E,S,_,M){this.gl.useProgram(this.shaderProgram);var R=new Float32Array(this.positions.buffer,0,(m+2)*3);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionVertexBuf),this.gl.bufferSubData(this.gl.ARRAY_BUFFER,0,R),this.gl.vertexAttribPointer(this.aPosLocation,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aPosLocation);var W=new Float32Array(this.colors.buffer,0,(m+2)*4);if(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.colorVertexBuf),this.gl.bufferSubData(this.gl.ARRAY_BUFFER,0,W),this.gl.vertexAttribPointer(this.aColorLocation,4,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aColorLocation),E){var fe=new Float32Array(this.uvs.buffer,0,(m+2)*2);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.uvVertexBuf),this.gl.bufferSubData(this.gl.ARRAY_BUFFER,0,fe),this.gl.vertexAttribPointer(this.aUvLocation,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aUvLocation)}if(this.gl.uniform1f(this.texturedLoc,E?1:0),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,d),this.gl.bindSampler(0,this.mainSampler),this.gl.uniform1i(this.textureLoc,0),M?this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE):this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.drawArrays(this.gl.TRIANGLE_FAN,0,m+2),S){this.gl.useProgram(this.borderShaderProgram);var ye=new Float32Array(this.borderPositions.buffer,0,(m+1)*3);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.borderPositionVertexBuf),this.gl.bufferSubData(this.gl.ARRAY_BUFFER,0,ye),this.gl.vertexAttribPointer(this.aBorderPosLoc,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aBorderPosLoc),this.gl.uniform4fv(this.uBorderColorLoc,this.borderColor);for(var Y=_?4:1,j=0;j<Y;j++){var se=2;j===0?this.gl.uniform2fv(this.thickOffsetLoc,[0,0]):j===1?this.gl.uniform2fv(this.thickOffsetLoc,[se/this.texsizeX,0]):j===2?this.gl.uniform2fv(this.thickOffsetLoc,[0,se/this.texsizeY]):j===3&&this.gl.uniform2fv(this.thickOffsetLoc,[se/this.texsizeX,se/this.texsizeY]),this.gl.drawArrays(this.gl.LINE_STRIP,0,m+1)}}}}]),u})()}),"./src/rendering/sprites/border.js":(function(t,n,r){r.r(n),r.d(n,"default",function(){return g});var i=r("./src/rendering/shaders/shaderUtils.js");function c(y,u){if(!(y instanceof u))throw new TypeError("Cannot call a class as a function")}function h(y,u){for(var l=0;l<u.length;l++){var d=u[l];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(y,d.key,d)}}function f(y,u,l){return u&&h(y.prototype,u),y}var g=(function(){function y(u){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};c(this,y),this.gl=u,this.positions=new Float32Array(72),this.aspectx=l.aspectx,this.aspecty=l.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty,this.floatPrecision=i.default.getFragmentFloatPrecision(this.gl),this.createShader(),this.vertexBuf=this.gl.createBuffer()}return f(y,[{key:"updateGlobals",value:function(l){this.aspectx=l.aspectx,this.aspecty=l.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty}},{key:"createShader",value:function(){this.shaderProgram=this.gl.createProgram();var l=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(l,`#version 300 es
                                      in vec3 aPos;
                                      void main(void) {
                                        gl_Position = vec4(aPos, 1.0);
                                      }`),this.gl.compileShader(l);var d=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(d,`#version 300 es
                                      precision `.concat(this.floatPrecision,` float;
                                      precision highp int;
                                      precision mediump sampler2D;
                                      out vec4 fragColor;
                                      uniform vec4 u_color;
                                      void main(void) {
                                        fragColor = u_color;
                                      }`)),this.gl.compileShader(d),this.gl.attachShader(this.shaderProgram,l),this.gl.attachShader(this.shaderProgram,d),this.gl.linkProgram(this.shaderProgram),this.aPosLoc=this.gl.getAttribLocation(this.shaderProgram,"aPos"),this.colorLoc=this.gl.getUniformLocation(this.shaderProgram,"u_color")}},{key:"addTriangle",value:function(l,d,m,E){this.positions[l+0]=d[0],this.positions[l+1]=d[1],this.positions[l+2]=d[2],this.positions[l+3]=m[0],this.positions[l+4]=m[1],this.positions[l+5]=m[2],this.positions[l+6]=E[0],this.positions[l+7]=E[1],this.positions[l+8]=E[2]}},{key:"generateBorder",value:function(l,d,m){if(d>0&&l[3]>0){var E=2,S=2,_=E/2,M=S/2,R=m/2,W=d/2+R,fe=R*E,ye=R*S,Y=W*E,j=W*S,se=[-_+fe,-M+j,0],Te=[-_+fe,M-j,0],Ae=[-_+Y,M-j,0],ze=[-_+Y,-M+j,0];return this.addTriangle(0,ze,Te,se),this.addTriangle(9,ze,Ae,Te),se=[_-fe,-M+j,0],Te=[_-fe,M-j,0],Ae=[_-Y,M-j,0],ze=[_-Y,-M+j,0],this.addTriangle(18,se,Te,ze),this.addTriangle(27,Te,Ae,ze),se=[-_+fe,-M+ye,0],Te=[-_+fe,j-M,0],Ae=[_-fe,j-M,0],ze=[_-fe,-M+ye,0],this.addTriangle(36,ze,Te,se),this.addTriangle(45,ze,Ae,Te),se=[-_+fe,M-ye,0],Te=[-_+fe,M-j,0],Ae=[_-fe,M-j,0],ze=[_-fe,M-ye,0],this.addTriangle(54,se,Te,ze),this.addTriangle(63,Te,Ae,ze),!0}return!1}},{key:"drawBorder",value:function(l,d,m){this.generateBorder(l,d,m)&&(this.gl.useProgram(this.shaderProgram),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.positions,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.aPosLoc,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aPosLoc),this.gl.uniform4fv(this.colorLoc,l),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.drawArrays(this.gl.TRIANGLES,0,this.positions.length/3))}}]),y})()}),"./src/rendering/sprites/darkenCenter.js":(function(t,n,r){r.r(n),r.d(n,"default",function(){return g});var i=r("./src/rendering/shaders/shaderUtils.js");function c(y,u){if(!(y instanceof u))throw new TypeError("Cannot call a class as a function")}function h(y,u){for(var l=0;l<u.length;l++){var d=u[l];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(y,d.key,d)}}function f(y,u,l){return u&&h(y.prototype,u),y}var g=(function(){function y(u,l){c(this,y),this.gl=u,this.aspectx=l.aspectx,this.aspecty=l.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty,this.generatePositions(),this.colors=new Float32Array([0,0,0,3/32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.positionVertexBuf=this.gl.createBuffer(),this.colorVertexBuf=this.gl.createBuffer(),this.floatPrecision=i.default.getFragmentFloatPrecision(this.gl),this.createShader()}return f(y,[{key:"updateGlobals",value:function(l){this.aspectx=l.aspectx,this.aspecty=l.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty,this.generatePositions()}},{key:"generatePositions",value:function(){var l=.05;this.positions=new Float32Array([0,0,0,-l*this.aspecty,0,0,0,-l,0,l*this.aspecty,0,0,0,l,0,-l*this.aspecty,0,0])}},{key:"createShader",value:function(){this.shaderProgram=this.gl.createProgram();var l=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(l,`#version 300 es
                                      in vec3 aPos;
                                      in vec4 aColor;
                                      out vec4 vColor;
                                      void main(void) {
                                        vColor = aColor;
                                        gl_Position = vec4(aPos, 1.0);
                                      }`),this.gl.compileShader(l);var d=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(d,`#version 300 es
                                      precision `.concat(this.floatPrecision,` float;
                                      precision highp int;
                                      precision mediump sampler2D;
                                      in vec4 vColor;
                                      out vec4 fragColor;
                                      void main(void) {
                                        fragColor = vColor;
                                      }`)),this.gl.compileShader(d),this.gl.attachShader(this.shaderProgram,l),this.gl.attachShader(this.shaderProgram,d),this.gl.linkProgram(this.shaderProgram),this.aPosLocation=this.gl.getAttribLocation(this.shaderProgram,"aPos"),this.aColorLocation=this.gl.getAttribLocation(this.shaderProgram,"aColor")}},{key:"drawDarkenCenter",value:function(l){l.darken_center!==0&&(this.gl.useProgram(this.shaderProgram),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.positions,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.aPosLocation,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aPosLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.colorVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.colors,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.aColorLocation,4,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aColorLocation),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.drawArrays(this.gl.TRIANGLE_FAN,0,this.positions.length/3))}}]),y})()}),"./src/rendering/text/titleText.js":(function(t,n,r){r.r(n),r.d(n,"default",function(){return g});var i=r("./src/rendering/shaders/shaderUtils.js");function c(y,u){if(!(y instanceof u))throw new TypeError("Cannot call a class as a function")}function h(y,u){for(var l=0;l<u.length;l++){var d=u[l];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(y,d.key,d)}}function f(y,u,l){return u&&h(y.prototype,u),y}var g=(function(){function y(u){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};c(this,y),this.gl=u,this.texsizeX=l.texsizeX,this.texsizeY=l.texsizeY,this.aspectx=l.aspectx,this.aspecty=l.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty,this.buildPositions(),this.textTexture=this.gl.createTexture(),this.indexBuf=u.createBuffer(),this.positionVertexBuf=this.gl.createBuffer(),this.vertexBuf=this.gl.createBuffer(),this.canvas=document.createElement("canvas"),this.canvas.width=this.texsizeX,this.canvas.height=this.texsizeY,this.context2D=this.canvas.getContext("2d"),this.floatPrecision=i.default.getFragmentFloatPrecision(this.gl),this.createShader()}return f(y,[{key:"generateTitleTexture",value:function(l){this.context2D.clearRect(0,0,this.texsizeX,this.texsizeY),this.fontSize=Math.floor(16*(this.texsizeX/256)),this.fontSize=Math.max(this.fontSize,6),this.context2D.font="italic ".concat(this.fontSize,"px Times New Roman");var d=l,m=this.context2D.measureText(d).width;if(m>this.texsizeX){var E=.91*(this.texsizeX/m);d="".concat(d.substring(0,Math.floor(d.length*E)),"..."),m=this.context2D.measureText(d).width}this.context2D.fillStyle="#FFFFFF",this.context2D.fillText(d,(this.texsizeX-m)/2,this.texsizeY/2);var S=new Uint8Array(this.context2D.getImageData(0,0,this.texsizeX,this.texsizeY).data.buffer);this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.texsizeX,this.texsizeY,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,S),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.generateMipmap(this.gl.TEXTURE_2D),this.gl.bindTexture(this.gl.TEXTURE_2D,null)}},{key:"updateGlobals",value:function(l){this.texsizeX=l.texsizeX,this.texsizeY=l.texsizeY,this.aspectx=l.aspectx,this.aspecty=l.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty,this.canvas.width=this.texsizeX,this.canvas.height=this.texsizeY}},{key:"buildPositions",value:function(){for(var l=2,d=2,m=l/2,E=d/2,S=15,_=7,M=S+1,R=_+1,W=l/S,fe=d/_,ye=[],Y=0;Y<R;Y++)for(var j=Y*fe-E,se=0;se<M;se++){var Te=se*W-m;ye.push(Te,-j,0)}for(var Ae=[],ze=0;ze<_;ze++)for(var de=0;de<S;de++){var we=de+M*ze,ce=de+M*(ze+1),he=de+1+M*(ze+1),Pe=de+1+M*ze;Ae.push(we,ce,Pe),Ae.push(ce,he,Pe)}this.vertices=new Float32Array(ye),this.indices=new Uint16Array(Ae)}},{key:"createShader",value:function(){this.shaderProgram=this.gl.createProgram();var l=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(l,`#version 300 es
       const vec2 halfmad = vec2(0.5);
       in vec2 aPos;
       in vec2 aUv;
       out vec2 uv_orig;
       out vec2 uv;
       void main(void) {
         gl_Position = vec4(aPos, 0.0, 1.0);
         uv_orig = aPos * halfmad + halfmad;
         uv = aUv;
       }`),this.gl.compileShader(l);var d=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(d,`#version 300 es
       precision `.concat(this.floatPrecision,` float;
       precision highp int;
       precision mediump sampler2D;

       in vec2 uv_orig;
       in vec2 uv;
       out vec4 fragColor;
       uniform sampler2D uTexture;
       uniform float textColor;

       void main(void) {
         fragColor = texture(uTexture, uv) * vec4(textColor);
       }`)),this.gl.compileShader(d),this.gl.attachShader(this.shaderProgram,l),this.gl.attachShader(this.shaderProgram,d),this.gl.linkProgram(this.shaderProgram),this.positionLocation=this.gl.getAttribLocation(this.shaderProgram,"aPos"),this.uvLocation=this.gl.getAttribLocation(this.shaderProgram,"aUv"),this.textureLoc=this.gl.getUniformLocation(this.shaderProgram,"uTexture"),this.textColorLoc=this.gl.getUniformLocation(this.shaderProgram,"textColor")}},{key:"generateUvs",value:function(l,d,m){for(var E=15,S=7,_=E+1,M=S+1,R=[],W=.75,fe=0;fe<M;fe++)for(var ye=0;ye<_;ye++){var Y=ye/E,j=(fe/S-.5)*W+.5,se=Y*2-1,Te=j*2-1;l>=1&&(Te+=1/this.texsizeY),R.push(se,d?Te:-Te)}for(var Ae=Math.max(0,1-l*1.5),ze=Math.pow(Ae,1.8)*1.3,de=0;de<M;de++)for(var we=0;we<_;we++){var ce=de*_+we;R[ce]+=ze*.07*Math.sin(m.time*.31+R[ce]*.39-R[ce+1]*1.94),R[ce]+=ze*.044*Math.sin(m.time*.81-R[ce]*1.91+R[ce+1]*.27),R[ce]+=ze*.061*Math.sin(m.time*1.31+R[ce]*.61+R[ce+1]*.74),R[ce+1]+=ze*.061*Math.sin(m.time*.37+R[ce]*1.83+R[ce+1]*.69),R[ce+1]+=ze*.07*Math.sin(m.time*.67+R[ce]*.42-R[ce+1]*1.39),R[ce+1]+=ze*.087*Math.sin(m.time*1.07+R[ce]*3.55+R[ce+1]*.89)}for(var he=1.01/(Math.pow(l,.21)+.01),Pe=0;Pe<R.length/2;Pe++)R[Pe*2]*=he,R[Pe*2+1]*=he*this.invAspecty,R[Pe*2]=(R[Pe*2]+1)/2,R[Pe*2+1]=(R[Pe*2+1]+1)/2;return new Float32Array(R)}},{key:"renderTitle",value:function(l,d,m){this.gl.useProgram(this.shaderProgram);var E=this.generateUvs(l,d,m);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.indexBuf),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.indices,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertices,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.positionLocation,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,E,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.uvLocation,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.uvLocation),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.textTexture),this.gl.uniform1i(this.textureLoc,0),this.gl.uniform1f(this.textColorLoc,Math.pow(l,.3)),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.drawElements(this.gl.TRIANGLES,this.indices.length,this.gl.UNSIGNED_SHORT,0)}}]),y})()}),"./src/rendering/waves/basicWaveform.js":(function(t,n,r){r.r(n),r.d(n,"default",function(){return y});var i=r("./src/rendering/shaders/shaderUtils.js"),c=r("./src/rendering/waves/waveUtils.js");function h(u,l){if(!(u instanceof l))throw new TypeError("Cannot call a class as a function")}function f(u,l){for(var d=0;d<l.length;d++){var m=l[d];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(u,m.key,m)}}function g(u,l,d){return l&&f(u.prototype,l),d&&f(u,d),u}var y=(function(){function u(l){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};h(this,u),this.gl=l;var m=512;this.positions=new Float32Array(m*3),this.positions2=new Float32Array(m*3),this.oldPositions=new Float32Array(m*3),this.oldPositions2=new Float32Array(m*3),this.smoothedPositions=new Float32Array((m*2-1)*3),this.smoothedPositions2=new Float32Array((m*2-1)*3),this.color=[0,0,0,1],this.texsizeX=d.texsizeX,this.texsizeY=d.texsizeY,this.aspectx=d.aspectx,this.aspecty=d.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty,this.floatPrecision=i.default.getFragmentFloatPrecision(this.gl),this.createShader(),this.vertexBuf=this.gl.createBuffer()}return g(u,[{key:"updateGlobals",value:function(d){this.texsizeX=d.texsizeX,this.texsizeY=d.texsizeY,this.aspectx=d.aspectx,this.aspecty=d.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty}},{key:"createShader",value:function(){this.shaderProgram=this.gl.createProgram();var d=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(d,`#version 300 es
                                      in vec3 aPos;
                                      uniform vec2 thickOffset;
                                      void main(void) {
                                        gl_Position = vec4(aPos + vec3(thickOffset, 0.0), 1.0);
                                      }`),this.gl.compileShader(d);var m=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(m,`#version 300 es
                                      precision `.concat(this.floatPrecision,` float;
                                      precision highp int;
                                      precision mediump sampler2D;
                                      out vec4 fragColor;
                                      uniform vec4 u_color;
                                      void main(void) {
                                        fragColor = u_color;
                                      }`)),this.gl.compileShader(m),this.gl.attachShader(this.shaderProgram,d),this.gl.attachShader(this.shaderProgram,m),this.gl.linkProgram(this.shaderProgram),this.aPosLoc=this.gl.getAttribLocation(this.shaderProgram,"aPos"),this.colorLoc=this.gl.getUniformLocation(this.shaderProgram,"u_color"),this.thickOffsetLoc=this.gl.getUniformLocation(this.shaderProgram,"thickOffset")}},{key:"generateWaveform",value:function(d,m,E,S,_){var M=_.wave_a,R=(_.bass+_.mid+_.treb)/3;if(R>-.01&&M>.001&&E.length>0){var W=u.processWaveform(E,_),fe=u.processWaveform(S,_),ye=Math.floor(_.wave_mode)%8,Y=Math.floor(_.old_wave_mode)%8,j=_.wave_x*2-1,se=_.wave_y*2-1;this.numVert=0,this.oldNumVert=0;for(var Te=d&&ye!==Y?2:1,Ae=0;Ae<Te;Ae++){var ze=Ae===0?ye:Y,de=_.wave_mystery;(ze===0||ze===1||ze===4)&&(de<-1||de>1)&&(de=de*.5+.5,de-=Math.floor(de),de=Math.abs(de),de=de*2-1);var we=void 0,ce=void 0,he=void 0;if(Ae===0?(ce=this.positions,he=this.positions2):(ce=this.oldPositions,he=this.oldPositions2),M=_.wave_a,ze===0){if(_.modwavealphabyvolume>0){var Pe=_.modwavealphaend-_.modwavealphastart;M*=(R-_.modwavealphastart)/Pe}M=Math.clamp(M,0,1),we=Math.floor(W.length/2)+1;for(var $e=1/(we-1),He=Math.floor((W.length-we)/2),et=0;et<we-1;et++){var Ve=.5+.4*fe[et+He]+de,Et=et*$e*2*Math.PI+_.time*.2;if(et<we/10){var Nt=et/(we*.1);Nt=.5-.5*Math.cos(Nt*Math.PI);var $t=.5+.4*fe[et+we+He]+de;Ve=(1-Nt)*$t+Ve*Nt}ce[et*3+0]=Ve*Math.cos(Et)*this.aspecty+j,ce[et*3+1]=Ve*Math.sin(Et)*this.aspectx+se,ce[et*3+2]=0}ce[(we-1)*3+0]=ce[0],ce[(we-1)*3+1]=ce[1],ce[(we-1)*3+2]=0}else if(ze===1){if(M*=1.25,_.modwavealphabyvolume>0){var Ie=_.modwavealphaend-_.modwavealphastart;M*=(R-_.modwavealphastart)/Ie}M=Math.clamp(M,0,1),we=Math.floor(W.length/2);for(var pe=0;pe<we;pe++){var Be=.53+.43*fe[pe]+de,O=W[pe+32]*.5*Math.PI+_.time*2.3;ce[pe*3+0]=Be*Math.cos(O)*this.aspecty+j,ce[pe*3+1]=Be*Math.sin(O)*this.aspectx+se,ce[pe*3+2]=0}}else if(ze===2){if(this.texsizeX<1024?M*=.09:this.texsizeX>=1024&&this.texsizeX<2048?M*=.11:M*=.13,_.modwavealphabyvolume>0){var z=_.modwavealphaend-_.modwavealphastart;M*=(R-_.modwavealphastart)/z}M=Math.clamp(M,0,1),we=W.length;for(var k=0;k<W.length;k++)ce[k*3+0]=fe[k]*this.aspecty+j,ce[k*3+1]=W[(k+32)%W.length]*this.aspectx+se,ce[k*3+2]=0}else if(ze===3){if(this.texsizeX<1024?M*=.15:this.texsizeX>=1024&&this.texsizeX<2048?M*=.22:M*=.33,M*=1.3,M*=_.treb*_.treb,_.modwavealphabyvolume>0){var L=_.modwavealphaend-_.modwavealphastart;M*=(R-_.modwavealphastart)/L}M=Math.clamp(M,0,1),we=W.length;for(var ne=0;ne<W.length;ne++)ce[ne*3+0]=fe[ne]*this.aspecty+j,ce[ne*3+1]=W[(ne+32)%W.length]*this.aspectx+se,ce[ne*3+2]=0}else if(ze===4){if(_.modwavealphabyvolume>0){var H=_.modwavealphaend-_.modwavealphastart;M*=(R-_.modwavealphastart)/H}M=Math.clamp(M,0,1),we=W.length,we>this.texsizeX/3&&(we=Math.floor(this.texsizeX/3));for(var De=1/we,Ye=Math.floor((W.length-we)/2),qe=.45+.5*(de*.5+.5),Fe=1-qe,Ue=0;Ue<we;Ue++){var Ke=2*Ue*De+(j-1)+fe[(Ue+25+Ye)%W.length]*.44,tt=W[Ue+Ye]*.47+se;Ue>1&&(Ke=Ke*Fe+qe*(ce[(Ue-1)*3+0]*2-ce[(Ue-2)*3+0]),tt=tt*Fe+qe*(ce[(Ue-1)*3+1]*2-ce[(Ue-2)*3+1])),ce[Ue*3+0]=Ke,ce[Ue*3+1]=tt,ce[Ue*3+2]=0}}else if(ze===5){if(this.texsizeX<1024?M*=.09:this.texsizeX>=1024&&this.texsizeX<2048?M*=.11:M*=.13,_.modwavealphabyvolume>0){var nt=_.modwavealphaend-_.modwavealphastart;M*=(R-_.modwavealphastart)/nt}M=Math.clamp(M,0,1);var dt=Math.cos(_.time*.3),Gt=Math.sin(_.time*.3);we=W.length;for(var vt=0;vt<W.length;vt++){var Tt=(vt+32)%W.length,yt=fe[vt]*W[Tt]+W[vt]*fe[Tt],Zt=fe[vt]*fe[vt]-W[Tt]*W[Tt];ce[vt*3+0]=(yt*dt-Zt*Gt)*(this.aspecty+j),ce[vt*3+1]=(yt*Gt+Zt*dt)*(this.aspectx+se),ce[vt*3+2]=0}}else if(ze===6||ze===7){if(_.modwavealphabyvolume>0){var _n=_.modwavealphaend-_.modwavealphastart;M*=(R-_.modwavealphastart)/_n}M=Math.clamp(M,0,1),we=Math.floor(W.length/2),we>this.texsizeX/3&&(we=Math.floor(this.texsizeX/3));for(var An=Math.floor((W.length-we)/2),Sn=Math.PI*.5*de,wn=Math.cos(Sn),Rn=Math.sin(Sn),mt=[j*Math.cos(Sn+Math.PI*.5)-wn*3,j*Math.cos(Sn+Math.PI*.5)+wn*3],st=[j*Math.sin(Sn+Math.PI*.5)-Rn*3,j*Math.sin(Sn+Math.PI*.5)+Rn*3],it=0;it<2;it++)for(var lt=0;lt<4;lt++){var ft=void 0,kt=!1;switch(lt){case 0:mt[it]>1.1&&(ft=(1.1-mt[1-it])/(mt[it]-mt[1-it]),kt=!0);break;case 1:mt[it]<-1.1&&(ft=(-1.1-mt[1-it])/(mt[it]-mt[1-it]),kt=!0);break;case 2:st[it]>1.1&&(ft=(1.1-st[1-it])/(st[it]-st[1-it]),kt=!0);break;case 3:st[it]<-1.1&&(ft=(-1.1-st[1-it])/(st[it]-st[1-it]),kt=!0);break}if(kt){var Ot=mt[it]-mt[1-it],Ft=st[it]-st[1-it];mt[it]=mt[1-it]+Ot*ft,st[it]=st[1-it]+Ft*ft}}wn=(mt[1]-mt[0])/we,Rn=(st[1]-st[0])/we;var It=Math.atan2(Rn,wn),Ct=Math.cos(It+Math.PI*.5),jt=Math.sin(It+Math.PI*.5);if(ze===6)for(var Yt=0;Yt<we;Yt++){var Mt=W[Yt+An];ce[Yt*3+0]=mt[0]+wn*Yt+Ct*.25*Mt,ce[Yt*3+1]=st[0]+Rn*Yt+jt*.25*Mt,ce[Yt*3+2]=0}else if(ze===7){for(var tn=Math.pow(se*.5+.5,2),hn=0;hn<we;hn++){var un=W[hn+An];ce[hn*3+0]=mt[0]+wn*hn+Ct*(.25*un+tn),ce[hn*3+1]=st[0]+Rn*hn+jt*(.25*un+tn),ce[hn*3+2]=0}for(var an=0;an<we;an++){var Pn=fe[an+An];he[an*3+0]=mt[0]+wn*an+Ct*(.25*Pn-tn),he[an*3+1]=st[0]+Rn*an+jt*(.25*Pn-tn),he[an*3+2]=0}}}Ae===0?(this.positions=ce,this.positions2=he,this.numVert=we,this.alpha=M):(this.oldPositions=ce,this.oldPositions2=he,this.oldNumVert=we,this.oldAlpha=M)}var Bt=.5-.5*Math.cos(m*Math.PI),ct=1-Bt;this.oldNumVert>0&&(M=Bt*this.alpha+ct*this.oldAlpha);var at=Math.clamp(_.wave_r,0,1),qt=Math.clamp(_.wave_g,0,1),Qt=Math.clamp(_.wave_b,0,1);if(_.wave_brighten!==0){var fn=Math.max(at,qt,Qt);fn>.01&&(at/=fn,qt/=fn,Qt/=fn)}if(this.color=[at,qt,Qt,M],this.oldNumVert>0)if(ye===7){for(var Nn=(this.oldNumVert-1)/(this.numVert*2),Mn=0;Mn<this.numVert;Mn++){var ra=Mn*Nn,qn=Math.floor(ra),Xn=ra-qn,Se=this.oldPositions[qn*3+0]*(1-Xn)+this.oldPositions[(qn+1)*3+0]*Xn,ia=this.oldPositions[qn*3+1]*(1-Xn)+this.oldPositions[(qn+1)*3+1]*Xn;this.positions[Mn*3+0]=this.positions[Mn*3+0]*Bt+Se*ct,this.positions[Mn*3+1]=this.positions[Mn*3+1]*Bt+ia*ct,this.positions[Mn*3+2]=0}for(var ca=0;ca<this.numVert;ca++){var Da=(ca+this.numVert)*Nn,sa=Math.floor(Da),Oa=Da-sa,da=this.oldPositions[sa*3+0]*(1-Oa)+this.oldPositions[(sa+1)*3+0]*Oa,Fr=this.oldPositions[sa*3+1]*(1-Oa)+this.oldPositions[(sa+1)*3+1]*Oa;this.positions2[ca*3+0]=this.positions2[ca*3+0]*Bt+da*ct,this.positions2[ca*3+1]=this.positions2[ca*3+1]*Bt+Fr*ct,this.positions2[ca*3+2]=0}}else if(Y===7){for(var tr=this.numVert/2,wr=(this.oldNumVert-1)/tr,La=0;La<tr;La++){var _r=La*wr,_a=Math.floor(_r),ur=_r-_a,Dt=this.oldPositions[_a*3+0]*(1-ur)+this.oldPositions[(_a+1)*3+0]*ur,Xt=this.oldPositions[_a*3+1]*(1-ur)+this.oldPositions[(_a+1)*3+1]*ur;this.positions[La*3+0]=this.positions[La*3+0]*Bt+Dt*ct,this.positions[La*3+1]=this.positions[La*3+1]*Bt+Xt*ct,this.positions[La*3+2]=0}for(var rn=0;rn<tr;rn++){var Ln=rn*wr,In=Math.floor(Ln),Un=Ln-In,$n=this.oldPositions2[In*3+0]*(1-Un)+this.oldPositions2[(In+1)*3+0]*Un,Fn=this.oldPositions2[In*3+1]*(1-Un)+this.oldPositions2[(In+1)*3+1]*Un;this.positions2[rn*3+0]=this.positions[(rn+tr)*3+0]*Bt+$n*ct,this.positions2[rn*3+1]=this.positions[(rn+tr)*3+1]*Bt+Fn*ct,this.positions2[rn*3+2]=0}}else for(var zn=(this.oldNumVert-1)/this.numVert,xn=0;xn<this.numVert;xn++){var Yn=xn*zn,ma=Math.floor(Yn),ga=Yn-ma,Pa=this.oldPositions[ma*3+0]*(1-ga)+this.oldPositions[(ma+1)*3+0]*ga,Ga=this.oldPositions[ma*3+1]*(1-ga)+this.oldPositions[(ma+1)*3+1]*ga;this.positions[xn*3+0]=this.positions[xn*3+0]*Bt+Pa*ct,this.positions[xn*3+1]=this.positions[xn*3+1]*Bt+Ga*ct,this.positions[xn*3+2]=0}for(var dr=0;dr<this.numVert;dr++)this.positions[dr*3+1]=-this.positions[dr*3+1];if(this.smoothedNumVert=this.numVert*2-1,c.default.smoothWave(this.positions,this.smoothedPositions,this.numVert),ye===7||Y===7){for(var za=0;za<this.numVert;za++)this.positions2[za*3+1]=-this.positions2[za*3+1];c.default.smoothWave(this.positions2,this.smoothedPositions2,this.numVert)}return!0}return!1}},{key:"drawBasicWaveform",value:function(d,m,E,S,_){if(this.generateWaveform(d,m,E,S,_)){this.gl.useProgram(this.shaderProgram),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.smoothedPositions,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.aPosLoc,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aPosLoc),this.gl.uniform4fv(this.colorLoc,this.color);var M=1;(_.wave_thick!==0||_.wave_dots!==0)&&(M=4),_.additivewave!==0?this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE):this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA);for(var R=_.wave_dots!==0?this.gl.POINTS:this.gl.LINE_STRIP,W=0;W<M;W++){var fe=2;W===0?this.gl.uniform2fv(this.thickOffsetLoc,[0,0]):W===1?this.gl.uniform2fv(this.thickOffsetLoc,[fe/this.texsizeX,0]):W===2?this.gl.uniform2fv(this.thickOffsetLoc,[0,fe/this.texsizeY]):W===3&&this.gl.uniform2fv(this.thickOffsetLoc,[fe/this.texsizeX,fe/this.texsizeY]),this.gl.drawArrays(R,0,this.smoothedNumVert)}var ye=Math.floor(_.wave_mode)%8;if(ye===7){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.smoothedPositions2,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.aPosLoc,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aPosLoc);for(var Y=0;Y<M;Y++){var j=2;Y===0?this.gl.uniform2fv(this.thickOffsetLoc,[0,0]):Y===1?this.gl.uniform2fv(this.thickOffsetLoc,[j/this.texsizeX,0]):Y===2?this.gl.uniform2fv(this.thickOffsetLoc,[0,j/this.texsizeY]):Y===3&&this.gl.uniform2fv(this.thickOffsetLoc,[j/this.texsizeX,j/this.texsizeY]),this.gl.drawArrays(R,0,this.smoothedNumVert)}}}}}],[{key:"processWaveform",value:function(d,m){var E=[],S=m.wave_scale/128,_=m.wave_smoothing,M=S*(1-_);E.push(d[0]*S);for(var R=1;R<d.length;R++)E.push(d[R]*M+E[R-1]*_);return E}}]),u})()}),"./src/rendering/waves/customWaveform.js":(function(t,n,r){r.r(n),r.d(n,"default",function(){return u});var i=r("./src/utils.js"),c=r("./src/rendering/shaders/shaderUtils.js"),h=r("./src/rendering/waves/waveUtils.js");function f(l,d){if(!(l instanceof d))throw new TypeError("Cannot call a class as a function")}function g(l,d){for(var m=0;m<d.length;m++){var E=d[m];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(l,E.key,E)}}function y(l,d,m){return d&&g(l.prototype,d),l}var u=(function(){function l(d,m,E){f(this,l),this.index=d,this.gl=m;var S=512;this.pointsData=[new Float32Array(S),new Float32Array(S)],this.positions=new Float32Array(S*3),this.colors=new Float32Array(S*4),this.smoothedPositions=new Float32Array((S*2-1)*3),this.smoothedColors=new Float32Array((S*2-1)*4),this.texsizeX=E.texsizeX,this.texsizeY=E.texsizeY,this.mesh_width=E.mesh_width,this.mesh_height=E.mesh_height,this.aspectx=E.aspectx,this.aspecty=E.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty,this.positionVertexBuf=this.gl.createBuffer(),this.colorVertexBuf=this.gl.createBuffer(),this.floatPrecision=c.default.getFragmentFloatPrecision(this.gl),this.createShader()}return y(l,[{key:"updateGlobals",value:function(m){this.texsizeX=m.texsizeX,this.texsizeY=m.texsizeY,this.mesh_width=m.mesh_width,this.mesh_height=m.mesh_height,this.aspectx=m.aspectx,this.aspecty=m.aspecty,this.invAspectx=1/this.aspectx,this.invAspecty=1/this.aspecty}},{key:"createShader",value:function(){this.shaderProgram=this.gl.createProgram();var m=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(m,`#version 300 es
                                      uniform float uSize;
                                      uniform vec2 thickOffset;
                                      in vec3 aPos;
                                      in vec4 aColor;
                                      out vec4 vColor;
                                      void main(void) {
                                        vColor = aColor;
                                        gl_PointSize = uSize;
                                        gl_Position = vec4(aPos + vec3(thickOffset, 0.0), 1.0);
                                      }`),this.gl.compileShader(m);var E=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(E,`#version 300 es
                                      precision `.concat(this.floatPrecision,` float;
                                      precision highp int;
                                      precision mediump sampler2D;
                                      in vec4 vColor;
                                      out vec4 fragColor;
                                      void main(void) {
                                        fragColor = vColor;
                                      }`)),this.gl.compileShader(E),this.gl.attachShader(this.shaderProgram,m),this.gl.attachShader(this.shaderProgram,E),this.gl.linkProgram(this.shaderProgram),this.aPosLocation=this.gl.getAttribLocation(this.shaderProgram,"aPos"),this.aColorLocation=this.gl.getAttribLocation(this.shaderProgram,"aColor"),this.sizeLoc=this.gl.getUniformLocation(this.shaderProgram,"uSize"),this.thickOffsetLoc=this.gl.getUniformLocation(this.shaderProgram,"thickOffset")}},{key:"generateWaveform",value:function(m,E,S,_,M,R,W,fe){if(W.baseVals.enabled!==0&&m.length>0){var ye=Object.assign({},R.mdVSWaves[this.index],R.mdVSFrameMapWaves[this.index],R.mdVSQAfterFrame,R.mdVSTWaveInits[this.index],M),Y=W.frame_eqs(ye),j=512;Object.prototype.hasOwnProperty.call(Y,"samples")?this.samples=Y.samples:this.samples=j,this.samples>j&&(this.samples=j),this.samples=Math.floor(this.samples);var se=Math.floor(Y.sep),Te=Y.scaling,Ae=Y.spectrum,ze=Y.smoothing,de=Y.usedots,we=Y.r,ce=Y.g,he=Y.b,Pe=Y.a,$e=R.mdVS.wave_scale;if(this.samples-=se,this.samples>=2||de!==0&&this.samples>=1){var He=Ae!==0,et=(He?.15:.004)*Te*$e,Ve=He?S:m,Et=He?_:E,Nt=He?0:Math.floor((j-this.samples)/2-se/2),$t=He?0:Math.floor((j-this.samples)/2+se/2),Ie=He?(j-se)/this.samples:1,pe=Math.pow(ze*.98,.5),Be=1-pe;this.pointsData[0][0]=Ve[Nt],this.pointsData[1][0]=Et[$t];for(var O=1;O<this.samples;O++){var z=Ve[Math.floor(O*Ie+Nt)],k=Et[Math.floor(O*Ie+$t)];this.pointsData[0][O]=z*Be+this.pointsData[0][O-1]*pe,this.pointsData[1][O]=k*Be+this.pointsData[1][O-1]*pe}for(var L=this.samples-2;L>=0;L--)this.pointsData[0][L]=this.pointsData[0][L]*Be+this.pointsData[0][L+1]*pe,this.pointsData[1][L]=this.pointsData[1][L]*Be+this.pointsData[1][L+1]*pe;for(var ne=0;ne<this.samples;ne++)this.pointsData[0][ne]*=et,this.pointsData[1][ne]*=et;for(var H=0;H<this.samples;H++){var De=this.pointsData[0][H],Ye=this.pointsData[1][H];Y.sample=H/(this.samples-1),Y.value1=De,Y.value2=Ye,Y.x=.5+De,Y.y=.5+Ye,Y.r=we,Y.g=ce,Y.b=he,Y.a=Pe,W.point_eqs!==""&&(Y=W.point_eqs(Y));var qe=(Y.x*2-1)*this.invAspectx,Fe=(Y.y*-2+1)*this.invAspecty,Ue=Y.r,Ke=Y.g,tt=Y.b,nt=Y.a;this.positions[H*3+0]=qe,this.positions[H*3+1]=Fe,this.positions[H*3+2]=0,this.colors[H*4+0]=Ue,this.colors[H*4+1]=Ke,this.colors[H*4+2]=tt,this.colors[H*4+3]=nt*fe}var dt=R.mdVSUserKeysWaves[this.index],Gt=i.default.pick(Y,dt);return R.mdVSFrameMapWaves[this.index]=Gt,this.mdVSWaveFrame=Y,de===0&&h.default.smoothWaveAndColor(this.positions,this.colors,this.smoothedPositions,this.smoothedColors,this.samples),!0}}return!1}},{key:"drawCustomWaveform",value:function(m,E,S,_,M,R,W,fe){if(fe&&this.generateWaveform(E,S,_,M,R,W,fe,m)){this.gl.useProgram(this.shaderProgram);var ye=this.mdVSWaveFrame.usedots!==0,Y=this.mdVSWaveFrame.thick!==0,j=this.mdVSWaveFrame.additive!==0,se,Te,Ae;ye?(se=this.positions,Te=this.colors,Ae=this.samples):(se=this.smoothedPositions,Te=this.smoothedColors,Ae=this.samples*2-1),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,se,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.aPosLocation,3,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aPosLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.colorVertexBuf),this.gl.bufferData(this.gl.ARRAY_BUFFER,Te,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.aColorLocation,4,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.aColorLocation);var ze=1;ye?Y?this.gl.uniform1f(this.sizeLoc,2+(this.texsizeX>=1024?1:0)):this.gl.uniform1f(this.sizeLoc,1+(this.texsizeX>=1024?1:0)):(this.gl.uniform1f(this.sizeLoc,1),Y&&(ze=4)),j?this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE):this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA);for(var de=ye?this.gl.POINTS:this.gl.LINE_STRIP,we=0;we<ze;we++){var ce=2;we===0?this.gl.uniform2fv(this.thickOffsetLoc,[0,0]):we===1?this.gl.uniform2fv(this.thickOffsetLoc,[ce/this.texsizeX,0]):we===2?this.gl.uniform2fv(this.thickOffsetLoc,[0,ce/this.texsizeY]):we===3&&this.gl.uniform2fv(this.thickOffsetLoc,[ce/this.texsizeX,ce/this.texsizeY]),this.gl.drawArrays(de,0,Ae)}}}}]),l})()}),"./src/rendering/waves/waveUtils.js":(function(t,n,r){r.r(n),r.d(n,"default",function(){return f});function i(g,y){if(!(g instanceof y))throw new TypeError("Cannot call a class as a function")}function c(g,y){for(var u=0;u<y.length;u++){var l=y[u];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(g,l.key,l)}}function h(g,y,u){return u&&c(g,u),g}var f=(function(){function g(){i(this,g)}return h(g,null,[{key:"smoothWave",value:function(u,l,d){for(var m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,E=-.15,S=1.15,_=1.15,M=-.15,R=1/(E+S+_+M),W=0,fe=0,ye,Y=1,j=0;j<d-1;j++){ye=Y,Y=Math.min(d-1,j+2);for(var se=0;se<3;se++)l[W*3+se]=u[j*3+se];if(m)for(var Te=0;Te<3;Te++)l[(W+1)*3+Te]=(E*u[fe*3+Te]+S*u[j*3+Te]+_*u[ye*3+Te]+M*u[Y*3+Te])*R;else{for(var Ae=0;Ae<2;Ae++)l[(W+1)*3+Ae]=(E*u[fe*3+Ae]+S*u[j*3+Ae]+_*u[ye*3+Ae]+M*u[Y*3+Ae])*R;l[(W+1)*3+2]=0}fe=j,W+=2}for(var ze=0;ze<3;ze++)l[W*3+ze]=u[(d-1)*3+ze]}},{key:"smoothWaveAndColor",value:function(u,l,d,m,E){for(var S=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1,_=-.15,M=1.15,R=1.15,W=-.15,fe=1/(_+M+R+W),ye=0,Y=0,j,se=1,Te=0;Te<E-1;Te++){j=se,se=Math.min(E-1,Te+2);for(var Ae=0;Ae<3;Ae++)d[ye*3+Ae]=u[Te*3+Ae];if(S)for(var ze=0;ze<3;ze++)d[(ye+1)*3+ze]=(_*u[Y*3+ze]+M*u[Te*3+ze]+R*u[j*3+ze]+W*u[se*3+ze])*fe;else{for(var de=0;de<2;de++)d[(ye+1)*3+de]=(_*u[Y*3+de]+M*u[Te*3+de]+R*u[j*3+de]+W*u[se*3+de])*fe;d[(ye+1)*3+2]=0}for(var we=0;we<4;we++)m[ye*4+we]=l[Te*4+we],m[(ye+1)*4+we]=l[Te*4+we];Y=Te,ye+=2}for(var ce=0;ce<3;ce++)d[ye*3+ce]=u[(E-1)*3+ce];for(var he=0;he<4;he++)m[ye*4+he]=l[(E-1)*4+he]}}]),g})()}),"./src/utils.js":(function(t,n,r){r.r(n),r.d(n,"default",function(){return l});function i(d){return f(d)||h(d)||c()}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function h(d){if(Symbol.iterator in Object(d)||Object.prototype.toString.call(d)==="[object Arguments]")return Array.from(d)}function f(d){if(Array.isArray(d)){for(var m=0,E=new Array(d.length);m<d.length;m++)E[m]=d[m];return E}}function g(d,m){if(!(d instanceof m))throw new TypeError("Cannot call a class as a function")}function y(d,m){for(var E=0;E<m.length;E++){var S=m[E];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(d,S.key,S)}}function u(d,m,E){return E&&y(d,E),d}var l=(function(){function d(){g(this,d)}return u(d,null,[{key:"atan2",value:function(E,S){var _=Math.atan2(E,S);return _<0&&(_+=2*Math.PI),_}},{key:"cloneVars",value:function(E){return Object.assign({},E)}},{key:"range",value:function(E,S){return S===void 0?i(Array(E).keys()):Array.from({length:S-E},function(_,M){return M+E})}},{key:"pick",value:function(E,S){for(var _={},M=0;M<S.length;M++){var R=S[M];_[R]=E[R]}return _}},{key:"omit",value:function(E,S){for(var _=Object.assign({},E),M=0;M<S.length;M++){var R=S[M];delete _[R]}return _}}]),d})()}),"./src/visualizer.js":(function(t,n,r){r.r(n),r.d(n,"default",function(){return y});var i=r("./src/audio/audioProcessor.js"),c=r("./src/rendering/renderer.js");function h(u,l){if(!(u instanceof l))throw new TypeError("Cannot call a class as a function")}function f(u,l){for(var d=0;d<l.length;d++){var m=l[d];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(u,m.key,m)}}function g(u,l,d){return l&&f(u.prototype,l),u}var y=(function(){function u(l,d,m){h(this,u),this.audio=new i.default(l);var E=d.getContext("webgl2",{alpha:!1,antialias:!1,depth:!1,stencil:!1,premultipliedAlpha:!1});this.baseValsDefaults={decay:.98,gammaadj:2,echo_zoom:2,echo_alpha:0,echo_orient:0,red_blue:0,brighten:0,darken:0,wrap:1,darken_center:0,solarize:0,invert:0,fshader:0,b1n:0,b2n:0,b3n:0,b1x:1,b2x:1,b3x:1,b1ed:.25,wave_mode:0,additivewave:0,wave_dots:0,wave_thick:0,wave_a:.8,wave_scale:1,wave_smoothing:.75,wave_mystery:0,modwavealphabyvolume:0,modwavealphastart:.75,modwavealphaend:.95,wave_r:1,wave_g:1,wave_b:1,wave_x:.5,wave_y:.5,wave_brighten:1,mv_x:12,mv_y:9,mv_dx:0,mv_dy:0,mv_l:.9,mv_r:1,mv_g:1,mv_b:1,mv_a:1,warpanimspeed:1,warpscale:1,zoomexp:1,zoom:1,rot:0,cx:.5,cy:.5,dx:0,dy:0,warp:1,sx:1,sy:1,ob_size:.01,ob_r:0,ob_g:0,ob_b:0,ob_a:0,ib_size:.01,ib_r:.25,ib_g:.25,ib_b:.25,ib_a:0},this.shapeBaseValsDefaults={enabled:0,sides:4,additive:0,thickoutline:0,textured:0,num_inst:1,tex_zoom:1,tex_ang:0,x:.5,y:.5,rad:.1,ang:0,r:1,g:0,b:0,a:1,r2:0,g2:1,b2:0,a2:0,border_r:1,border_g:1,border_b:1,border_a:.1},this.waveBaseValsDefaults={enabled:0,samples:512,sep:0,scaling:1,smoothing:.5,r:1,g:1,b:1,a:1,spectrum:0,usedots:0,thick:0,additive:0},this.renderer=new c.default(E,this.audio,m)}return g(u,[{key:"connectAudio",value:function(d){this.audioNode=d,this.audio.connectAudio(d)}},{key:"disconnectAudio",value:function(d){this.audio.disconnectAudio(d)}},{key:"loadPreset",value:function(d){var m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,E=Object.assign({},d);E.baseVals=Object.assign({},this.baseValsDefaults,E.baseVals);for(var S=0;S<E.shapes.length;S++)E.shapes[S].baseVals=Object.assign({},this.shapeBaseValsDefaults,E.shapes[S].baseVals);for(var _=0;_<E.waves.length;_++)E.waves[_].baseVals=Object.assign({},this.waveBaseValsDefaults,E.waves[_].baseVals);if(typeof E.init_eqs!="function"){E.init_eqs=new Function("a","".concat(E.init_eqs_str," return a;")),E.frame_eqs=new Function("a","".concat(E.frame_eqs_str," return a;")),E.pixel_eqs_str&&E.pixel_eqs_str!==""?E.pixel_eqs=new Function("a","".concat(E.pixel_eqs_str," return a;")):E.pixel_eqs="";for(var M=0;M<E.shapes.length;M++)E.shapes[M].baseVals.enabled!==0&&(E.shapes[M]=Object.assign({},E.shapes[M],{init_eqs:new Function("a","".concat(E.shapes[M].init_eqs_str," return a;")),frame_eqs:new Function("a","".concat(E.shapes[M].frame_eqs_str," return a;"))}));for(var R=0;R<E.waves.length;R++)if(E.waves[R].baseVals.enabled!==0){var W={init_eqs:new Function("a","".concat(E.waves[R].init_eqs_str," return a;")),frame_eqs:new Function("a","".concat(E.waves[R].frame_eqs_str," return a;"))};E.waves[R].point_eqs_str&&E.waves[R].point_eqs_str!==""?W.point_eqs=new Function("a","".concat(E.waves[R].point_eqs_str," return a;")):W.point_eqs="",E.waves[R]=Object.assign({},E.waves[R],W)}}this.renderer.loadPreset(E,m)}},{key:"loadExtraImages",value:function(d){this.renderer.loadExtraImages(d)}},{key:"setRendererSize",value:function(d,m){var E=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.renderer.setRendererSize(d,m,E)}},{key:"setInternalMeshSize",value:function(d,m){this.renderer.setInternalMeshSize(d,m)}},{key:"setOutputAA",value:function(d){this.renderer.setOutputAA(d)}},{key:"render",value:function(d){this.renderer.render(d)}},{key:"launchSongTitleAnim",value:function(d){this.renderer.launchSongTitleAnim(d)}},{key:"toDataURL",value:function(){return this.renderer.toDataURL()}},{key:"warpBufferToDataURL",value:function(){return this.renderer.warpBufferToDataURL()}}]),u})()})})})})(Oo)),Oo.exports}var hb=fb();const mb=db(hb);function bs(o,e=20,t=2e4){const n=[],r=Math.max(10,e),i=Math.min(96e3,t);for(let c=0;c<o;c++){const h=c/(o-1),f=r*Math.pow(i/r,h);n.push(Math.round(f))}return n}const Sf={flat:{name:"Flat",gains:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},bass_boost:{name:"Bass Boost",gains:[6,5,4.5,4,3,2,1,.5,0,0,0,0,0,0,0,0]},bass_reducer:{name:"Bass Reducer",gains:[-6,-5,-4,-3,-2,-1,0,0,0,0,0,0,0,0,0,0]},treble_boost:{name:"Treble Boost",gains:[0,0,0,0,0,0,0,0,0,1,2,3,4,5,5.5,6]},treble_reducer:{name:"Treble Reducer",gains:[0,0,0,0,0,0,0,0,0,-1,-2,-3,-4,-5,-5.5,-6]},vocal_boost:{name:"Vocal Boost",gains:[-2,-1,0,0,1,2,3,4,4,3,2,1,0,0,-1,-2]},loudness:{name:"Loudness",gains:[5,4,3,1,0,-1,-1,0,0,1,2,3,4,4.5,4,3]},rock:{name:"Rock",gains:[4,3.5,3,2,-1,-2,-1,1,2,3,3.5,4,4,3,2,1]},pop:{name:"Pop",gains:[-1,0,1,2,3,3,2,1,0,1,2,2,2,2,1,0]},classical:{name:"Classical",gains:[3,2,1,0,0,0,0,0,0,0,0,1,2,3,3,2]},jazz:{name:"Jazz",gains:[3,2,1,1,-1,-1,0,1,2,2,2,2,2,2,2,2]},electronic:{name:"Electronic",gains:[4,3.5,3,1,0,-1,0,1,2,3,3,2,2,3,4,3.5]},hip_hop:{name:"Hip-Hop",gains:[5,4.5,4,3,1,0,0,1,1,1,1,1,1,2,2,2]},r_and_b:{name:"R&B",gains:[3,5,4,2,1,0,1,1,1,1,2,2,2,1,1,1]},acoustic:{name:"Acoustic",gains:[3,2,1,1,2,2,1,0,0,1,1,2,3,3,2,1]},podcast:{name:"Podcast / Speech",gains:[-3,-2,-1,0,1,2,3,4,4,3,2,1,0,-1,-2,-3]}};function gb(o,e){if(e===16)return[...o];const t=[];for(let n=0;n<e;n++){const r=n/(e-1)*(o.length-1),i=Math.floor(r),c=Math.min(Math.ceil(r),o.length-1),h=r-i,f=o[i]||0,g=o[c]||0,y=f+(g-f)*h;t.push(Math.round(y*10)/10)}return t}function pb(o){const e={};for(const[t,n]of Object.entries(Sf))e[t]={name:n.name,gains:gb(n.gains,o)};return e}const tv=Sf;class yb{constructor(){this.audioContext=null,this.source=null,this.analyser=null,this.filters=[],this.outputNode=null,this.volumeNode=null,this.isInitialized=!1,this.isEQEnabled=!1,this.isMonoAudioEnabled=!1,this.monoMergerNode=null,this.audio=null,this.currentVolume=1,this.bandCount=aa.getBandCount(),this.freqRange=aa.getFreqRange(),this.frequencies=bs(this.bandCount,this.freqRange.min,this.freqRange.max),this.currentGains=new Array(this.bandCount).fill(0),this._graphChangeCallbacks=[],this._loadSettings()}setBandCount(e){const t=Math.max(aa.MIN_BANDS,Math.min(aa.MAX_BANDS,parseInt(e,10)||16));if(t===this.bandCount)return;aa.setBandCount(t),this.bandCount=t,this.frequencies=bs(t,this.freqRange.min,this.freqRange.max);const n=aa._interpolateGains(this.currentGains,t);this.currentGains=n,aa.setGains(n),this.isInitialized&&this.audioContext&&(this._destroyEQ(),this._createEQ(),this._connectGraph()),window.dispatchEvent(new CustomEvent("equalizer-band-count-changed",{detail:{bandCount:t,frequencies:this.frequencies}}))}setFreqRange(e,t){const n=Math.max(10,Math.min(96e3,parseInt(e,10)||20)),r=Math.max(10,Math.min(96e3,parseInt(t,10)||2e4));return n>=r?(console.warn("[AudioContext] Invalid frequency range: min must be less than max"),!1):(n===this.freqRange.min&&r===this.freqRange.max||(aa.setFreqRange(n,r),this.freqRange={min:n,max:r},this.frequencies=bs(this.bandCount,n,r),this.isInitialized&&this.audioContext&&(this._destroyEQ(),this._createEQ(),this._connectGraph()),window.dispatchEvent(new CustomEvent("equalizer-freq-range-changed",{detail:{min:n,max:r,frequencies:this.frequencies}}))),!0)}_destroyEQ(){if(this.filters&&this.filters.forEach(e=>{try{e.disconnect()}catch{}}),this.filters=[],this.preampNode){try{this.preampNode.disconnect()}catch{}this.preampNode=null}}_createEQ(){if(!this.audioContext)return;this.preampNode||(this.preampNode=this.audioContext.createGain());const e=this.preamp||0,t=Math.pow(10,e/20);this.preampNode.gain.value=t,this.filters=this.frequencies.map((n,r)=>{const i=this.audioContext.createBiquadFilter();return i.type="peaking",i.frequency.value=n,i.Q.value=this._calculateQ(r),i.gain.value=this.currentGains[r]||0,i}),this.volumeNode||(this.volumeNode=this.audioContext.createGain())}_calculateQ(e){return 2.5*Math.sqrt(16/this.bandCount)}onGraphChange(e){return this._graphChangeCallbacks.push(e),()=>{const t=this._graphChangeCallbacks.indexOf(e);t>-1&&this._graphChangeCallbacks.splice(t,1)}}_notifyGraphChange(){this._graphChangeCallbacks.forEach(e=>{try{e(this.source)}catch(t){console.warn("[AudioContext] Graph change callback failed:",t)}})}init(e){if(this.isInitialized||!e)return;if(this.audio=e,typeof window<"u"&&window.__IS_IOS__===!0){console.log("[AudioContext] Skipping Web Audio initialization on iOS for lock screen compatibility");return}try{const n=window.AudioContext||window.webkitAudioContext,r={sampleRate:192e3,latencyHint:"playback"};try{this.audioContext=new n(r),console.log(`[AudioContext] Created with high-res settings: ${this.audioContext.sampleRate}Hz`)}catch(i){console.warn("[AudioContext] 192kHz/playback init failed, falling back to system defaults:",i);try{this.audioContext=new n({latencyHint:"playback"}),console.log(`[AudioContext] Created with system default rate: ${this.audioContext.sampleRate}Hz`)}catch(c){console.warn("[AudioContext] Playback latency hint failed, using defaults:",c),this.audioContext=new n}}this.source=this.audioContext.createMediaElementSource(e),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=1024,this.analyser.smoothingTimeConstant=.7,this._createEQ(),this.outputNode=this.audioContext.createGain(),this.outputNode.gain.value=1,this.volumeNode=this.audioContext.createGain(),this.volumeNode.gain.value=this.currentVolume,this.monoMergerNode=this.audioContext.createChannelMerger(2),this._connectGraph(),this.isInitialized=!0,console.log(`[AudioContext] Initialized with ${this.bandCount}-band EQ`)}catch(n){console.warn("[AudioContext] Init failed:",n)}}_connectGraph(){if(!(!this.source||!this.audioContext))try{if(this.source.disconnect(),this.outputNode.disconnect(),this.volumeNode&&this.volumeNode.disconnect(),this.analyser.disconnect(),this.monoMergerNode)try{this.monoMergerNode.disconnect()}catch{}let e=this.source;if(this.isMonoAudioEnabled&&this.monoMergerNode){const t=this.audioContext.createGain();t.gain.value=.5,this.source.connect(t),t.connect(this.monoMergerNode,0,0),t.connect(this.monoMergerNode,0,1),e=this.monoMergerNode,console.log("[AudioContext] Mono audio enabled")}if(this.isEQEnabled&&this.filters.length>0){for(let t=0;t<this.filters.length-1;t++)this.filters[t].connect(this.filters[t+1]);this.preampNode?(e.connect(this.preampNode),this.preampNode.connect(this.filters[0])):e.connect(this.filters[0]),this.filters[this.filters.length-1].connect(this.outputNode),this.outputNode.connect(this.analyser),this.analyser.connect(this.volumeNode),this.volumeNode.connect(this.audioContext.destination),console.log("[AudioContext] EQ connected")}else e.connect(this.analyser),this.analyser.connect(this.volumeNode),this.volumeNode.connect(this.audioContext.destination);this._notifyGraphChange()}catch(e){console.warn("[AudioContext] Failed to connect graph:",e);try{this.source.connect(this.audioContext.destination)}catch{}}}async resume(){if(!this.audioContext)return!1;if(console.log("[AudioContext] Current state:",this.audioContext.state),this.audioContext.state==="suspended")try{await this.audioContext.resume(),console.log("[AudioContext] Resumed successfully, state:",this.audioContext.state)}catch(e){console.warn("[AudioContext] Failed to resume:",e)}return this.isInitialized&&this.audioContext.state==="running"&&this._connectGraph(),this.audioContext.state==="running"}getAnalyser(){return this.analyser}getAudioContext(){return this.audioContext}getSourceNode(){return this.source}isReady(){return this.isInitialized&&this.audioContext!==null}setVolume(e){if(this.currentVolume=Math.max(0,Math.min(1,e)),this.volumeNode&&this.audioContext){const t=this.audioContext.currentTime;this.volumeNode.gain.setTargetAtTime(this.currentVolume,t,.01)}}toggleEQ(e){return this.isEQEnabled=e,aa.setEnabled(e),this.isInitialized&&this._connectGraph(),this.isEQEnabled}isEQActive(){return this.isInitialized&&this.isEQEnabled}toggleMonoAudio(e){return this.isMonoAudioEnabled=e,jo.setEnabled(e),this.isInitialized&&this._connectGraph(),this.isMonoAudioEnabled}isMonoAudioActive(){return this.isInitialized&&this.isMonoAudioEnabled}getRange(){return aa.getRange()}_clampGain(e){const t=this.getRange();return Math.max(t.min,Math.min(t.max,e))}setBandGain(e,t){if(e<0||e>=this.bandCount)return;const n=this._clampGain(t);if(this.currentGains[e]=n,this.filters[e]&&this.audioContext){const r=this.audioContext.currentTime;this.filters[e].gain.setTargetAtTime(n,r,.01)}aa.setGains(this.currentGains)}setAllGains(e){if(!Array.isArray(e))return;let t=e;e.length!==this.bandCount&&(t=aa._interpolateGains(e,this.bandCount));const n=this.audioContext?.currentTime||0;t.forEach((r,i)=>{const c=this._clampGain(r);this.currentGains[i]=c,this.filters[i]&&this.filters[i].gain.setTargetAtTime(c,n,.01)}),aa.setGains(this.currentGains)}applyPreset(e){const n=pb(this.bandCount)[e];n&&(this.setAllGains(n.gains),aa.setPreset(e))}reset(){this.setAllGains(new Array(this.bandCount).fill(0)),aa.setPreset("flat")}getGains(){return[...this.currentGains]}getBandCount(){return this.bandCount}_loadSettings(){this.isEQEnabled=aa.isEnabled(),this.bandCount=aa.getBandCount(),this.freqRange=aa.getFreqRange(),this.frequencies=bs(this.bandCount,this.freqRange.min,this.freqRange.max),this.currentGains=aa.getGains(this.bandCount),this.isMonoAudioEnabled=jo.isEnabled(),this.preamp=aa.getPreamp()}setPreamp(e){const t=Math.max(-20,Math.min(20,parseFloat(e)||0));if(this.preamp=t,aa.setPreamp(t),this.preampNode&&this.audioContext){const n=Math.pow(10,t/20),r=this.audioContext.currentTime;this.preampNode.gain.setTargetAtTime(n,r,.01)}}getPreamp(){return this.preamp||0}exportEQToText(){const e=[],t=this.getPreamp();return e.push(`Preamp: ${t.toFixed(1)} dB`),this.frequencies.forEach((n,r)=>{const i=this.currentGains[r]||0,c=r+1;e.push(`Filter ${c}: ON PK Fc ${n} Hz Gain ${i.toFixed(1)} dB Q 0.71`)}),e.join(`
`)}importEQFromText(e){try{const t=e.split(`
`).map(h=>h.trim()).filter(h=>h),n=[];let r=0;for(const h of t){const f=h.match(/^Preamp:\s*([+-]?\d+\.?\d*)\s*dB$/i);if(f){r=parseFloat(f[1]);continue}const g=h.match(/^Filter\s*\d*:\s*ON\s+(\w+)\s+Fc\s+(\d+)\s+Hz\s+Gain\s*([+-]?\d+\.?\d*)\s*dB\s+Q\s+(\d+\.?\d*)/i);if(g){const y=g[1].toUpperCase(),u=parseInt(g[2],10),l=parseFloat(g[3]),d=parseFloat(g[4]);n.push({type:y,freq:u,gain:l,q:d})}}if(n.length===0)return console.warn("[AudioContext] No valid filters found in import text"),!1;if(this.setPreamp(r),n.length!==this.bandCount){const h=Math.max(aa.MIN_BANDS,Math.min(aa.MAX_BANDS,n.length));this.setBandCount(h)}const i=n.slice(0,this.bandCount).map(h=>h.gain);this.setAllGains(i);const c=n.slice(0,this.bandCount).map(h=>h.freq);return JSON.stringify(c)!==JSON.stringify(this.frequencies)&&aa.setFreqRange(c[0],c[c.length-1]),!0}catch(t){return console.warn("[AudioContext] Failed to import EQ settings:",t),!1}}}const Zn=new yb;let lr=null,sr=[],Es=!1,tl=[];async function bb(){if(!(lr||Es)){Es=!0;try{window.butterchurnPresets||await new Promise((n,r)=>{const i=document.createElement("script");i.src="/lib/butterchurnPresets.min.js",i.onload=n,i.onerror=r,document.head.appendChild(i)});const o=window.butterchurnPresets;if(console.log("[Butterchurn] Presets loaded, type:",typeof o),typeof o?.getPresets!="function"){console.error("[Butterchurn] butterchurnPresets.getPresets is not a function:",typeof o?.getPresets),Es=!1;return}lr=o.getPresets()||{},sr=Object.keys(lr);const t=["flexi","empty","test","_"];sr=sr.filter(n=>!t.some(r=>n.toLowerCase().includes(r))),sr.sort((n,r)=>n.toLowerCase().localeCompare(r.toLowerCase())),console.log("[Butterchurn] Module-level presets loaded:",sr.length),tl.forEach(n=>n(lr,sr)),tl=[],window.dispatchEvent(new CustomEvent("butterchurn-presets-loaded"))}catch(o){console.error("[Butterchurn] Failed to load presets:",o),lr={},sr=[]}finally{Es=!1}}}function nv(){return{presets:lr,keys:sr}}function Eb(o){lr?o(lr,sr):tl.push(o)}bb();class vb{constructor(){this.name="Butterchurn",this.contextType="webgl",this.visualizer=null,this.canvas=null,this.audioContext=null,this.currentPresetIndex=0,this.lastPresetChange=0,this.isInitialized=!1,this.presets=lr||{},this.presetKeys=sr||[],this.blendProgress=0,this.blendDuration=2.7,lr||Eb((e,t)=>{this.presets=e,this.presetKeys=t,window.dispatchEvent(new CustomEvent("butterchurn-presets-loaded")),this.isInitialized&&this.visualizer&&this.loadNextPreset()})}getPresetDuration(){return br.getButterchurnCycleDuration()*1e3}init(e,t,n,r){if(!this.isInitialized)try{this.canvas=e,this.audioContext=n,this.visualizer=mb.createVisualizer(n,e,{width:e.width,height:e.height,pixelRatio:window.devicePixelRatio||1,textureRatio:1}),r&&this.connectAudioWithDelay(r),this.loadNextPreset(),this.lastPresetChange=performance.now(),this.isInitialized=!0,Zn&&(this._unregisterGraphChange=Zn.onGraphChange(i=>{i&&this.isInitialized&&(console.log("[Butterchurn] Audio graph changed, reconnecting..."),this.connectAudioWithDelay(i))})),console.log("[Butterchurn] Initialized with",this.presetKeys.length,"presets")}catch(i){console.error("[Butterchurn] Initialization failed:",i)}}connectAudio(e){e&&this.connectAudioWithDelay(e)}connectAudioWithDelay(e){if(!(!this.audioContext||!this.visualizer))try{this.visualizer.connectAudio(e),console.log("[Butterchurn] Audio connected")}catch(t){console.warn("[Butterchurn] Failed to connect audio:",t)}}loadNextPreset(){if(!this.visualizer||this.presetKeys.length===0)return;br.isButterchurnRandomizeEnabled()?this.currentPresetIndex=Math.floor(Math.random()*this.presetKeys.length):this.currentPresetIndex=(this.currentPresetIndex+1)%this.presetKeys.length;const t=this.presetKeys[this.currentPresetIndex],n=this.presets[t];if(n)try{this.visualizer.loadPreset(n,this.blendDuration)}catch(r){console.warn("[Butterchurn] Failed to load preset:",t,r),this.presetKeys.length>1&&this.loadNextPreset()}}loadPreset(e){if(!this.visualizer||!this.presets)return;const t=this.presets[e];if(t){this.visualizer.loadPreset(t,this.blendDuration),console.log("[Butterchurn] Loaded preset:",e);const n=this.presetKeys.indexOf(e);n!==-1&&(this.currentPresetIndex=n)}}getPresetNames(){return this.presetKeys}getCurrentPresetName(){return this.presetKeys[this.currentPresetIndex]||"Unknown"}nextPreset(){this.loadNextPreset(),this.lastPresetChange=performance.now()}resize(e,t){this.visualizer&&this.visualizer.setRendererSize(e,t)}draw(e,t,n,r,i){if(!this.isInitialized||!this.visualizer)return;const{mode:c}=i,h=performance.now();if(br.isButterchurnCycleEnabled()){const g=this.getPresetDuration();g>0&&h-this.lastPresetChange>g&&(this.loadNextPreset(),this.lastPresetChange=h)}try{this.visualizer.render()}catch(g){console.warn("[Butterchurn] Render error:",g)}c==="blended"?(t.style.opacity="0.85",t.style.mixBlendMode="screen"):(t.style.opacity="1",t.style.mixBlendMode="normal")}lazyInit(e,t,n){if(!this.isInitialized&&e&&t){const r=e.getContext("webgl2",{alpha:!0,antialias:!0,preserveDrawingBuffer:!0})||e.getContext("webgl",{alpha:!0,antialias:!0,preserveDrawingBuffer:!0});r&&(this.init(e,r,t,null),n&&this.connectAudioWithDelay(n))}else this.isInitialized&&n&&this.connectAudioWithDelay(n)}destroy(){this._unregisterGraphChange&&(this._unregisterGraphChange(),this._unregisterGraphChange=null),this.visualizer&&(this.visualizer=null),this.isInitialized=!1,this.canvas=null,this.audioContext=null,console.log("[Butterchurn] Destroyed")}}class Tb{constructor(e,t){this.canvas=e,this.ctx=null,this.audio=t,this.audioContext=null,this.analyser=null,this.isActive=!1,this.animationId=null,this.presets={lcd:new cb,particles:new ub,"unknown-pleasures":new qi,butterchurn:new vb},this.activePresetKey=br.getPreset(),this.bufferLength=0,this.dataArray=null,this.stats={kick:0,intensity:0,energyAverage:.3,lastBeatTime:0,lastIntensity:0,upbeatSmoother:0,sensitivity:.5,primaryColor:"#ffffff",mode:""},this._lastPrimaryColor="",this._resizeBound=()=>this.resize()}get activePreset(){return this.presets[this.activePresetKey]||this.presets.lcd}init(){Zn.isReady()||Zn.init(this.audio),this.audioContext=Zn.getAudioContext(),this.analyser=Zn.getAnalyser(),this.analyser&&(this.bufferLength=this.analyser.frequencyBinCount,this.dataArray=new Uint8Array(this.bufferLength))}getAudioContext(){return this.audioContext}getSourceNode(){return Zn.getSourceNode()}initContext(){const t=this.activePreset.contextType||"2d",n=this._currentContextType;if(this.ctx&&n!==t){const r=this.canvas.parentElement,i=this.canvas.cloneNode(!0);r.replaceChild(i,this.canvas),this.canvas=i,this.ctx=null}this.ctx||(t==="webgl"?this.ctx=this.canvas.getContext("webgl2",{alpha:!0,antialias:!0,preserveDrawingBuffer:!0,premultipliedAlpha:!1})||this.canvas.getContext("webgl",{alpha:!0,antialias:!0,preserveDrawingBuffer:!0,premultipliedAlpha:!1}):this.ctx=this.canvas.getContext("2d"),this._currentContextType=t)}start(){if(!this.isActive&&(this.ctx||this.initContext(),this.audioContext||this.init(),!!this.analyser)){if(this.isActive=!0,this.audioContext.state==="suspended"&&this.audioContext.resume(),this.activePresetKey==="butterchurn"&&this.activePreset.lazyInit){const e=Zn.getSourceNode();this.activePreset.lazyInit(this.canvas,this.audioContext,e)}this.resize(),window.addEventListener("resize",this._resizeBound),this.canvas.style.display="block",this.animate()}}stop(){this.isActive=!1,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),window.removeEventListener("resize",this._resizeBound),this.ctx&&this.ctx.clearRect&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.style.display="none"}resize(){const e=window.innerWidth,t=window.innerHeight;this.canvas.width!==e&&(this.canvas.width=e),this.canvas.height!==t&&(this.canvas.height=t),this.activePreset?.resize&&this.activePreset.resize(e,t)}animate=()=>{if(!this.isActive)return;this.animationId=requestAnimationFrame(this.animate),this.analyser.getByteFrequencyData(this.dataArray);const e=10*Math.max(this.audio.volume,.1),t=this.audioContext.sampleRate/this.analyser.fftSize,n=1;let r=Math.floor(250/t);r<1&&(r=1);let i=0;for(let d=0;d<r&&n+d<this.dataArray.length;d++){const m=this.dataArray[n+d];m>i&&(i=m)}let c=i/255/e;const h=c*c*10,f=this.stats;f.energyAverage=f.energyAverage*.99+h*.01,f.upbeatSmoother=f.upbeatSmoother*.92+h*.08;let g=br.getSensitivity();br.isSmartIntensityEnabled()&&(f.energyAverage>.4?g=.7:f.energyAverage>.2?g=.1+(f.energyAverage-.2)/.2*.6:g=.1);const y=performance.now();let u=f.energyAverage<.3?.5+(.3-f.energyAverage)*2:.5;if(h>u*.7)if(h>f.lastIntensity+.03&&y-f.lastBeatTime>50)f.kick=1,f.lastBeatTime=y;else if(f.upbeatSmoother>.6&&f.energyAverage>.4){const d=(f.upbeatSmoother-.6)/.4;f.kick<d?f.kick=d:f.kick*=.95}else f.kick*=.9;else f.kick*=.95;f.lastIntensity=h,f.intensity=h,f.sensitivity=g;const l=getComputedStyle(document.documentElement).getPropertyValue("--primary").trim()||"#ffffff";l!==this._lastPrimaryColor&&(f.primaryColor=l,this._lastPrimaryColor=l),f.mode=br.getMode(),this.activePreset.draw(this.ctx,this.canvas,this.analyser,this.dataArray,f)};setPreset(e){if(this.presets[e]&&(this.activePreset?.destroy&&this.activePreset.destroy(),this.activePresetKey=e,this.initContext(),this.resize(),e==="butterchurn"&&this.presets[e].lazyInit&&this.audioContext)){const t=Zn.getSourceNode();this.presets[e].lazyInit(this.canvas,this.audioContext,t)}}}const wb=document.getElementById("page-profile"),yl=document.getElementById("edit-profile-modal"),nl=document.getElementById("profile-edit-btn"),kf=document.getElementById("view-my-profile-btn"),If=document.getElementById("edit-profile-username"),Rf=document.getElementById("edit-profile-display-name"),_b=document.getElementById("edit-profile-avatar"),Ab=document.getElementById("edit-profile-banner"),vr=document.getElementById("edit-profile-status-search"),$s=document.getElementById("edit-profile-status-json"),Wr=document.getElementById("status-search-results"),xf=document.getElementById("status-preview"),Sb=document.getElementById("clear-status-btn"),zo=document.getElementById("edit-favorite-albums-list"),Jr=document.getElementById("edit-favorite-albums-search"),Qr=document.getElementById("edit-favorite-albums-results"),Cf=document.getElementById("edit-profile-about"),Lf=document.getElementById("edit-profile-website"),Pf=document.getElementById("edit-profile-lastfm"),Nf=document.getElementById("privacy-playlists-toggle"),Mf=document.getElementById("privacy-lastfm-toggle"),Fi=document.getElementById("edit-profile-save"),kb=document.getElementById("edit-profile-cancel"),Pi=document.getElementById("username-error");let zr=[];const ba=new nf(ol);async function Ib(o){try{const e=new FormData;e.append("file",o);const t=await fetch("/upload",{method:"POST",body:e});if(!t.ok)throw new Error(`Upload failed: ${t.status}`);return(await t.json()).url}catch(e){throw console.error("Upload error:",e),e}}function Df(o){const e=document.getElementById(o),t=document.getElementById(o+"-file"),n=document.getElementById(o+"-upload-btn"),r=document.getElementById(o+"-toggle-btn"),i=document.getElementById(o+"-upload-status");if(!e||!t||!n||!r||!i)return()=>{};let c=!1;function h(){c?(n.style.display="none",e.style.display="block",r.textContent="Upload"):(n.style.display="flex",e.style.display="none",r.textContent="or URL")}return r.addEventListener("click",()=>{c=!c,h()}),n.addEventListener("click",()=>t.click()),t.addEventListener("change",async f=>{const g=f.target.files[0];if(g){if(!g.type.startsWith("image/")){alert("Please select an image file");return}i.style.display="block",i.textContent="Uploading...",i.style.color="var(--muted-foreground)",n.disabled=!0;try{const y=await Ib(g);e.value=y,i.textContent="Done!",i.style.color="#10b981",setTimeout(()=>{i.style.display="none"},2e3)}catch{i.textContent="Failed - try URL",i.style.color="#ef4444"}finally{n.disabled=!1,t.value=""}}}),f=>{e.value=f||"",c=!!f,h(),i.style.display="none"}}const Rb=Df("edit-profile-avatar"),xb=Df("edit-profile-banner");async function Of(o){document.querySelectorAll(".page").forEach(m=>m.classList.remove("active")),wb.classList.add("active"),document.getElementById("profile-banner").style.backgroundImage="",document.getElementById("profile-avatar").src="/assets/appicon.png",document.getElementById("profile-display-name").textContent="Loading...",document.getElementById("profile-username").textContent="@"+o,document.getElementById("profile-status").style.display="none",document.getElementById("profile-about").textContent="",document.getElementById("profile-website").style.display="none",document.getElementById("profile-lastfm").style.display="none",document.getElementById("profile-playlists-container").innerHTML="";const e=document.getElementById("profile-favorite-albums-section"),t=document.getElementById("profile-favorite-albums-container");e&&(e.style.display="none"),t&&(t.innerHTML="");const n=document.getElementById("profile-recent-scrobbles-section"),r=document.getElementById("profile-recent-scrobbles-container");n&&(n.style.display="none"),r&&(r.innerHTML="");const i=document.getElementById("profile-top-artists-section"),c=document.getElementById("profile-top-artists-container"),h=document.getElementById("profile-top-albums-section"),f=document.getElementById("profile-top-albums-container"),g=document.getElementById("profile-top-tracks-section"),y=document.getElementById("profile-top-tracks-container");i&&(i.style.display="none"),c&&(c.innerHTML=""),h&&(h.style.display="none"),f&&(f.innerHTML=""),g&&(g.style.display="none"),y&&(y.innerHTML=""),nl.style.display="none";const u=await On.getProfile(o);if(!u){document.getElementById("profile-display-name").textContent="User not found";return}if(document.getElementById("profile-display-name").textContent=u.display_name||o,u.banner&&(document.getElementById("profile-banner").style.backgroundImage=`url('${u.banner}')`),u.avatar_url&&(document.getElementById("profile-avatar").src=u.avatar_url),u.status){const m=document.getElementById("profile-status");try{const E=JSON.parse(u.status);m.innerHTML=`
                <span style="opacity: 0.7; margin-right: 0.25rem;">Listening to:</span>
                <img src="${E.image}" style="width: 20px; height: 20px; border-radius: 2px; vertical-align: middle; margin-right: 0.5rem;">
                <a href="${E.link}" class="status-link" style="color: inherit; text-decoration: none; font-weight: 500;">${E.text}</a>
            `,m.querySelector(".status-link").onclick=S=>{S.preventDefault(),Bn(E.link)}}catch{m.textContent=`Listening to: ${u.status}`}m.style.display="inline-flex"}if(u.about&&(document.getElementById("profile-about").textContent=u.about),u.website){const m=document.getElementById("profile-website");m.href=u.website,m.style.display="inline-block"}if(u.favorite_albums&&u.favorite_albums.length>0&&e&&t&&(e.style.display="block",t.innerHTML=u.favorite_albums.map(m=>{const E=ba.getCoverUrl(m.cover);return`
                    <div class="favorite-album-item" style="display: flex; gap: 1rem; margin-bottom: 1rem; background: var(--card); padding: 1rem; border-radius: var(--radius); border: 1px solid var(--border);">
                        <div class="card" style="width: 120px; flex-shrink: 0; padding: 0; border: none; background: transparent; cursor: pointer;" onclick="window.location.hash='/album/${m.id}'">
                            <div class="card-image-wrapper" style="margin-bottom: 0.5rem;">
                                <img src="${E}" class="card-image" loading="lazy" style="border-radius: var(--radius);">
                            </div>
                            <div class="card-info">
                                <div class="card-title" style="font-size: 0.9rem;">${en(m.title)}</div>
                                <div class="card-subtitle" style="font-size: 0.8rem;">${en(m.artist)}</div>
                            </div>
                        </div>
                        <div class="favorite-album-description" style="flex: 1; display: flex; flex-direction: column;">
                            <h4 style="margin: 0 0 0.5rem 0; font-size: 0.9rem; color: var(--muted-foreground); text-transform: uppercase; letter-spacing: 0.05em;">Why it's a favorite</h4>
                            <p style="margin: 0; line-height: 1.6; white-space: pre-wrap;">${en(m.description||"")}</p>
                        </div>
                    </div>
                `}).join("")),u.lastfm_username&&u.privacy?.lastfm!=="private"){const m=document.getElementById("profile-lastfm");m.href=`https://last.fm/user/${u.lastfm_username}`,m.style.display="inline-block"}u.lastfm_username&&u.privacy?.lastfm!=="private"&&(Ob(u.lastfm_username).then(async m=>{if(m.length>0){n.style.display="block",r.innerHTML=m.map((E,S)=>{const _=E["@attr"]?.nowplaying==="true";let M=vs(E.image);const R=!!M;M||(M="/assets/appicon.png"),E._imgId=`scrobble-img-${S}`,E._needsCover=!R;let W="";if(_)W="Scrobbling now";else if(E.date){const fe=new Date(E.date.uts*1e3);W=fe.toLocaleDateString()+" "+fe.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}return`
                        <div class="track-item lastfm-track" data-title="${en(E.name)}" data-artist="${en(E.artist?.["#text"]||E.artist?.name||"")}" style="grid-template-columns: 40px 1fr auto; cursor: pointer;">
                            <img id="${E._imgId}" src="${M}" class="track-item-cover" style="width: 40px; height: 40px; border-radius: 4px;" loading="lazy" onerror="this.src='/assets/appicon.png'">
                            <div class="track-item-info">
                                <div class="track-item-details">
                                    <div class="title">${E.name}</div>
                                    <div class="artist">${E.artist?.["#text"]||E.artist?.name||E.artist||"Unknown Artist"}</div>
                                </div>
                            </div>
                            <div class="track-item-duration" style="font-size: 0.8rem; min-width: auto;">${W}</div>
                        </div>
                    `}).join(""),r.querySelectorAll(".track-item").forEach(E=>{E.addEventListener("click",()=>Sd(E.dataset.title,E.dataset.artist)),E.addEventListener("contextmenu",S=>(S.preventDefault(),!1))});for(const E of m)E._needsCover&&kd(E.name,E.artist?.["#text"]||E.artist?.name,E._imgId)}}),zb(u.lastfm_username).then(async m=>{if(m.length>0&&i&&c){i.style.display="block",c.innerHTML=m.map((E,S)=>{let _=vs(E.image);const M=!!_;_||(_="/assets/appicon.png");const R=`top-artist-img-${S}`;return E._imgId=R,E._needsCover=!M,`
                        <div class="card artist lastfm-card" data-name="${en(E.name)}" style="cursor: pointer;">
                            <div class="card-image-wrapper">
                                <img id="${R}" src="${_}" class="card-image" loading="lazy" onerror="this.src='/assets/appicon.png'">
                            </div>
                            <div class="card-info">
                                <div class="card-title">${E.name}</div>
                                <div class="card-subtitle">${parseInt(E.playcount).toLocaleString()} plays</div>
                            </div>
                        </div>
                    `}).join(""),c.querySelectorAll(".card").forEach(E=>{E.addEventListener("click",()=>Nb(E.dataset.name)),E.addEventListener("contextmenu",S=>(S.preventDefault(),!1))});for(const E of m)E._needsCover&&Yi(E.name,E._imgId)}}),Ub(u.lastfm_username).then(async m=>{if(m.length>0&&h&&f){h.style.display="block",f.innerHTML=m.map((E,S)=>{let _=vs(E.image);const M=!!_;_||(_="/assets/appicon.png");const R=`top-album-img-${S}`;E._imgId=R,E._needsCover=!M;const W=E.artist?.name||E.artist?.["#text"]||(typeof E.artist=="string"?E.artist:"Unknown Artist");return E._artistName=W,`
                        <div class="card lastfm-card" data-name="${en(E.name)}" data-artist="${en(W)}" style="cursor: pointer;">
                            <div class="card-image-wrapper">
                                <img id="${R}" src="${_}" class="card-image" loading="lazy" onerror="this.src='/assets/appicon.png'">
                            </div>
                            <div class="card-info">
                                <div class="card-title">${E.name}</div>
                                <div class="card-subtitle">${W}</div>
                            </div>
                        </div>
                    `}).join(""),f.querySelectorAll(".card").forEach(E=>{E.addEventListener("click",()=>Mb(E.dataset.name,E.dataset.artist)),E.addEventListener("contextmenu",S=>(S.preventDefault(),!1))});for(const E of m)E._needsCover&&Db(E.name,E._artistName,E._imgId)}}),Bb(u.lastfm_username).then(async m=>{if(m.length>0&&g&&y){g.style.display="block",y.innerHTML=m.map((E,S)=>{let _=vs(E.image);const M=!!_;_||(_="/assets/appicon.png");const R=`top-track-img-${S}`;E._imgId=R,E._needsCover=!M;const W=E.artist?.name||E.artist?.["#text"]||(typeof E.artist=="string"?E.artist:"Unknown Artist");return E._artistName=W,`
                        <div class="track-item lastfm-track" data-title="${en(E.name)}" data-artist="${en(W)}" style="grid-template-columns: 40px 1fr auto; cursor: pointer;">
                            <img id="${R}" src="${_}" class="track-item-cover" style="width: 40px; height: 40px; border-radius: 4px;" loading="lazy" onerror="this.src='/assets/appicon.png'">
                            <div class="track-item-info">
                                <div class="track-item-details">
                                    <div class="title">${E.name}</div>
                                    <div class="artist">${W}</div>
                                </div>
                            </div>
                            <div class="track-item-duration" style="font-size: 0.8rem; min-width: auto;">${parseInt(E.playcount).toLocaleString()} plays</div>
                        </div>
                    `}).join(""),y.querySelectorAll(".track-item").forEach(E=>{E.addEventListener("click",()=>Sd(E.dataset.title,E.dataset.artist)),E.addEventListener("contextmenu",S=>(S.preventDefault(),!1))});for(const E of m)E._needsCover&&kd(E.name,E._artistName,E._imgId)}}));const l=await On.getUserData(),d=l&&l.profile&&l.profile.username===o;if(d&&(nl.style.display="inline-flex"),u.privacy?.playlists!=="private"||d){const m=document.getElementById("profile-playlists-container"),E=u.user_playlists||{};Object.values(E).forEach(S=>{if(!S.isPublic&&!d)return;const _=document.createElement("div");_.className="card",_.innerHTML=`
                <div class="card-image-wrapper">
                    <img src="${S.cover||"/assets/appicon.png"}" class="card-image" loading="lazy" alt="${S.name}">
                </div>
                <div class="card-info">
                    <div class="card-title">${S.name}</div>
                    <div class="card-subtitle">${S.numberOfTracks||0} tracks</div>
                </div>
            `,_.onclick=()=>{window.location.hash=`/userplaylist/${S.id}`},m.appendChild(_)}),m.children.length===0&&(m.innerHTML='<p style="color: var(--muted-foreground); grid-column: 1/-1; text-align: center;">No public playlists.</p>')}}function bl(){On.getUserData().then(o=>{if(!o||!o.profile)return;const e=o.profile;if(If.value=e.username||"",Rf.value=e.display_name||"",Rb(e.avatar_url),xb(e.banner),$s.value=e.status||"",vr.value="",e.status)try{const t=JSON.parse(e.status);zf(t)}catch{e.status.trim()&&(vr.value=e.status,al())}else al();zr=e.favorite_albums||[],El(),Jr.value="",Qr.style.display="none",Cf.value=e.about||"",Lf.value=e.website||"",Pf.value=e.lastfm_username||"",Nf.checked=e.privacy?.playlists!=="private",Mf.checked=e.privacy?.lastfm!=="private",yl.classList.add("active")})}async function Cb(){const o=If.value.trim();if(!o){Pi.textContent="Username cannot be empty",Pi.style.display="block";return}if((await On.getUserData()).profile.username!==o&&await On.isUsernameTaken(o)){Pi.textContent="Username is already taken",Pi.style.display="block";return}Pi.style.display="none",Fi.disabled=!0,Fi.textContent="Saving...";const t={username:o,display_name:Rf.value.trim(),avatar_url:_b.value.trim(),banner:Ab.value.trim(),status:$s.value.trim()||(vr.value.trim()?vr.value.trim():""),about:Cf.value.trim(),website:Lf.value.trim(),favorite_albums:zr,lastfm_username:Pf.value.trim(),privacy:{playlists:Nf.checked?"public":"private",lastfm:Mf.checked?"public":"private"}};try{await On.updateProfile(t),yl.classList.remove("active"),Of(o),window.location.pathname.includes("/user/@")&&window.history.replaceState(null,"",`/user/@${o}`)}catch(n){alert("Failed to save profile. See console."),console.error(n)}finally{Fi.disabled=!1,Fi.textContent="Save Profile"}}nl.addEventListener("click",bl);kb.addEventListener("click",()=>yl.classList.remove("active"));Fi.addEventListener("click",Cb);kf.addEventListener("click",async()=>{const o=await On.getUserData();o&&o.profile&&o.profile.username?Bn(`/user/@${o.profile.username}`):bl()});la.onAuthStateChanged(o=>{kf.style.display=o?"inline-block":"none"});function zf(o){document.getElementById("status-preview-img").src=o.image,document.getElementById("status-preview-title").textContent=o.title,document.getElementById("status-preview-subtitle").textContent=o.subtitle,xf.style.display="flex",vr.style.display="none"}function al(){xf.style.display="none",vr.style.display="block",$s.value=""}Sb.addEventListener("click",()=>{al(),vr.value="",vr.focus()});const Lb=cl(async o=>{if(!o){Wr.style.display="none";return}try{const[e,t]=await Promise.all([ba.searchTracks(o,{limit:3}),ba.searchAlbums(o,{limit:3})]);Wr.innerHTML="";const n=(r,i)=>{const c=document.createElement("div");c.className="search-result-item";const h=r.title,f=r.artist?.name||"Unknown Artist",g=ba.getCoverUrl(r.album?.cover||r.cover);return c.innerHTML=`
                <img src="${g}">
                <div class="search-result-info">
                    <div class="search-result-title">${h}</div>
                    <div class="search-result-subtitle">${i==="track"?"Song":"Album"} â€¢ ${f}</div>
                </div>
            `,c.onclick=()=>{const y={type:i,id:r.id,text:`${h} - ${f}`,title:h,subtitle:f,image:g,link:`/${i}/${r.id}`};$s.value=JSON.stringify(y),zf(y),Wr.style.display="none"},c};e.items.forEach(r=>Wr.appendChild(n(r,"track"))),t.items.forEach(r=>Wr.appendChild(n(r,"album"))),Wr.style.display=e.items.length||t.items.length?"block":"none"}catch(e){console.error("Status search failed",e)}},300);vr.addEventListener("input",o=>Lb(o.target.value.trim()));document.addEventListener("click",o=>{o.target.closest(".status-picker-container")||(Wr.style.display="none")});function El(){zo.innerHTML=zr.map((o,e)=>`
        <div class="edit-favorite-album-item" style="background: var(--secondary); padding: 0.5rem; border-radius: var(--radius); border: 1px solid var(--border);">
            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                <img src="${ba.getCoverUrl(o.cover)}" style="width: 40px; height: 40px; border-radius: 4px; object-fit: cover;">
                <div style="flex: 1; min-width: 0;">
                    <div style="font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${en(o.title)}</div>
                    <div style="font-size: 0.8rem; color: var(--muted-foreground);">${en(o.artist)}</div>
                </div>
                <button class="btn-icon remove-album-btn" data-index="${e}" style="color: var(--danger);">&times;</button>
            </div>
            <textarea class="template-input album-description-input" data-index="${e}" placeholder="Why is this a favorite?" style="min-height: 60px; font-size: 0.85rem; resize: vertical;">${en(o.description||"")}</textarea>
        </div>
    `).join(""),zo.querySelectorAll(".remove-album-btn").forEach(o=>{o.onclick=()=>{const e=parseInt(o.dataset.index);zr.splice(e,1),El()}}),zo.querySelectorAll(".album-description-input").forEach(o=>{o.oninput=()=>{const e=parseInt(o.dataset.index);zr[e].description=o.value}}),zr.length>=5?(Jr.disabled=!0,Jr.placeholder="Max 5 albums reached"):(Jr.disabled=!1,Jr.placeholder="Search for an album...")}const Pb=cl(async o=>{if(!o||zr.length>=5){Qr.style.display="none";return}try{const e=await ba.searchAlbums(o,{limit:5});if(Qr.innerHTML="",e.items.length===0){Qr.style.display="none";return}e.items.forEach(t=>{const n=document.createElement("div");n.className="search-result-item";const r=ba.getCoverUrl(t.cover);n.innerHTML=`
                <img src="${r}">
                <div class="search-result-info">
                    <div class="search-result-title">${t.title}</div>
                    <div class="search-result-subtitle">${t.artist?.name||"Unknown Artist"}</div>
                </div>
            `,n.onclick=()=>{zr.push({id:t.id,title:t.title,artist:t.artist?.name||"Unknown Artist",cover:t.cover,description:""}),El(),Jr.value="",Qr.style.display="none"},Qr.appendChild(n)}),Qr.style.display="block"}catch(e){console.error("Album search failed",e)}},300);Jr.addEventListener("input",o=>Pb(o.target.value.trim()));function vs(o){if(!o)return null;const e=Array.isArray(o)?o:[o],t=["extralarge","large","medium","small"],n=["2a96cbd8b46e442fc41c2b86b821562f","c6f59c1e5e7240a4c0d427abd71f3dbb"],r=c=>c?!n.some(h=>c.includes(h)):!1;for(const c of t){const h=e.find(f=>f.size===c);if(h&&h["#text"]&&r(h["#text"]))return h["#text"]}const i=e.find(c=>c["#text"]&&r(c["#text"]));return i?i["#text"]:null}async function Nb(o){try{const e=await ba.searchArtists(o,{limit:1});e.items.length>0?Bn(`/artist/${e.items[0].id}`):alert("Artist not found in library")}catch(e){console.error(e)}}async function Mb(o,e){try{const t=`${o} ${e}`,n=await ba.searchAlbums(t,{limit:1});n.items.length>0?Bn(`/album/${n.items[0].id}`):alert("Album not found in library")}catch(t){console.error(t)}}async function Sd(o,e){try{const t=`${o} ${e}`,n=await ba.searchTracks(t,{limit:1});if(n.items.length>0){const r=n.items[0];window.monochromePlayer&&(window.monochromePlayer.setQueue([r],0),window.monochromePlayer.playTrackFromQueue())}else alert("Track not found")}catch(t){console.error(t)}}async function kd(o,e,t){try{const n=`${o} ${e}`;await new Promise(c=>setTimeout(c,100));const r=await ba.searchTracks(n,{limit:5});let i=!1;if(r.items&&r.items.length>0){const c=r.items.find(h=>h.album?.cover);if(c){const h=ba.getCoverUrl(c.album.cover),f=document.getElementById(t);f&&(f.src=h,i=!0)}}i||await Yi(e,t)}catch{await Yi(e,t)}}async function Db(o,e,t){try{const n=`${o} ${e}`;await new Promise(c=>setTimeout(c,100));const r=await ba.searchAlbums(n,{limit:5});let i=!1;if(r.items&&r.items.length>0){const c=r.items.find(h=>h.cover);if(c){const h=ba.getCoverUrl(c.cover),f=document.getElementById(t);f&&(f.src=h,i=!0)}}i||await Yi(e,t)}catch{await Yi(e,t)}}async function Yi(o,e){try{await new Promise(n=>setTimeout(n,100));const t=await ba.searchArtists(o,{limit:3});if(t.items&&t.items.length>0){const n=t.items.find(r=>r.picture);if(n){const r=ba.getArtistPictureUrl(n.picture),i=document.getElementById(e);i&&(i.src=r)}}}catch{}}async function Ob(o){const t=`https://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user=${encodeURIComponent(o)}&api_key=85214f5abbc730e78770f27784b9bdf7&format=json&limit=5`;try{const i=(await(await fetch(t)).json()).recenttracks?.track;return i?Array.isArray(i)?i:[i]:[]}catch(n){return console.error("Failed to fetch Last.fm recent tracks",n),[]}}async function zb(o){const t=`https://ws.audioscrobbler.com/2.0/?method=user.gettopartists&user=${encodeURIComponent(o)}&api_key=85214f5abbc730e78770f27784b9bdf7&format=json&limit=6`;try{return(await(await fetch(t)).json()).topartists?.artist||[]}catch(n){return console.error("Failed to fetch Last.fm top artists",n),[]}}async function Ub(o){const t=`https://ws.audioscrobbler.com/2.0/?method=user.gettopalbums&user=${encodeURIComponent(o)}&api_key=85214f5abbc730e78770f27784b9bdf7&format=json&limit=6`;try{return(await(await fetch(t)).json()).topalbums?.album||[]}catch(n){return console.error("Failed to fetch Last.fm top albums",n),[]}}async function Bb(o){const t=`https://ws.audioscrobbler.com/2.0/?method=user.gettoptracks&user=${encodeURIComponent(o)}&api_key=85214f5abbc730e78770f27784b9bdf7&format=json&limit=5`;try{return(await(await fetch(t)).json()).toptracks?.track||[]}catch(n){return console.error("Failed to fetch Last.fm top tracks",n),[]}}function Bn(o){o!==window.location.pathname&&(window.history.pushState({},"",o),window.dispatchEvent(new PopStateEvent("popstate")))}function Fb(o){return async()=>{if(window.location.hash&&window.location.hash.length>1){const h=window.location.hash.substring(1);if(h.includes("/")){const f=h.startsWith("/")?h:"/"+h;window.history.replaceState(null,"",f)}}let t=window.location.pathname;t.startsWith("/")&&(t=t.substring(1)),t.endsWith("/")&&(t=t.substring(0,t.length-1)),(t===""||t==="index.html")&&(t="home");const n=t.split("/"),r=n[0],i=n.slice(1).join("/"),c=h=>h.startsWith("t/")?{provider:"tidal",id:h.slice(2)}:h.startsWith("q/")?{provider:"qobuz",id:h.slice(2)}:{provider:null,id:h};switch(r){case"search":await o.renderSearchPage(decodeURIComponent(i));break;case"album":{const{provider:h,id:f}=c(i);await o.renderAlbumPage(f,h);break}case"artist":{const{provider:h,id:f}=c(i);await o.renderArtistPage(f,h);break}case"playlist":{const{provider:h,id:f}=c(i);await o.renderPlaylistPage(f,"api",h);break}case"userplaylist":await o.renderPlaylistPage(i,"user");break;case"folder":await o.renderFolderPage(i);break;case"mix":{const{provider:h,id:f}=c(i);await o.renderMixPage(f,h);break}case"track":{const{provider:h,id:f}=c(i);f.startsWith("tracker-")?await o.renderTrackerTrackPage(f):await o.renderTrackPage(f,h);break}case"library":await o.renderLibraryPage();break;case"recent":await o.renderRecentPage();break;case"unreleased":if(i){const h=i.split("/"),f=h[0],g=h[1]?decodeURIComponent(h[1]):null;g?await o.renderTrackerProjectPage(f,g):await o.renderTrackerArtistPage(f)}else await o.renderUnreleasedPage();break;case"home":await o.renderHomePage();break;case"user":i&&i.startsWith("@")&&!i.includes("/")&&await Of(decodeURIComponent(i.slice(1)));break;default:o.showPage(r);break}}}function rl(o){if(o.currentTrack){const e=o.currentTrack;document.title=`${e.title} â€¢ ${wa(e)}`}else{const e=window.location.pathname;if(e.startsWith("/album/")||e.startsWith("/playlist/")||e.startsWith("/track/"))return;document.title="Monochrome Music"}}let er=[],il=new Map,ua=null;const Ki=new Map;let qb=new Map;function Uf(o){return o.toLowerCase().replace(/[^a-z0-9]/g,"")}function jb(o){return o?o.replace(/\s*[([]\s*prod\.?\s+[^)\]]+[)\]]/gi,"").replace(/\s*[([]\s*produced\s+by\s+[^)\]]+[)\]]/gi,"").replace(/\s+/g," ").trim():""}async function Bf(){try{const o=await fetch("https://trends.artistgrid.cx");if(!o.ok)return;const e=await o.json();e.results&&e.results.forEach((t,n)=>{const r=t.visitors*(1-n/e.results.length);il.set(t.name,r)})}catch(o){console.log("Could not load popularity data:",o)}}async function Vi(){try{const o=await fetch("https://sheets.artistgrid.cx/artists.ndjson");if(!o.ok)throw new Error("Network response was not ok");er=(await o.text()).trim().split(`
`).filter(t=>t.trim()).map(t=>{try{return JSON.parse(t)}catch{return null}}).filter(t=>t!==null),er.sort((t,n)=>{const r=il.get(t.name)||0;return(il.get(n.name)||0)-r}),Ki.clear(),er.forEach(t=>{const n=vl(t.url);n&&Ki.set(n,t)})}catch(o){console.error("Failed to load Artists List:",o)}}function vl(o){if(!o)return null;const e=o.match(/spreadsheets\/d\/([a-zA-Z0-9-_]+)/);return e?e[1]:null}async function Vs(o){try{const e=await fetch(`https://tracker.israeli.ovh/get/${o}`);return e.ok?await e.json():null}catch(e){return console.error("Failed to fetch tracker data",e),null}}function Hb(o){if(!o||o==="N/A")return 0;const e=o.split(":");return e.length===2?parseInt(e[0])*60+parseInt(e[1]):0}function Gb(o){if(!o)return null;if(o.includes("pillows.su/f/")){const n=o.match(/pillows\.su\/f\/([a-f0-9]+)/);if(n)return`https://api.pillows.su/api/download/${n[1]}`}else if(o.includes("music.froste.lol/song/")){const n=o.match(/music\.froste\.lol\/song\/([a-f0-9]+)/);if(n)return`https://music.froste.lol/song/${n[1]}/download`}return[".mp3",".m4a",".flac",".wav",".ogg",".aac"].some(n=>o.toLowerCase().includes(n))?o:null}function ei(o,e,t,n,r=""){const i=y=>y&&typeof y=="string"&&y.trim().length>0,c=(i(o.url)?o.url:null)||(o.urls?o.urls.find(i):null),h=Gb(c),f=Hb(o.track_length),g=jb(o.name);return{id:`tracker-${r}-${e.name}-${n}`,title:o.name,cleanTitle:g,artist:{name:t},artists:[{name:t}],album:{title:e.name,cover:e.image},duration:f,trackNumber:n+1,isTracker:!0,audioUrl:h,remoteUrl:h,explicit:!1,unavailable:!h,trackerInfo:{sheetId:r,timeline:e.timeline,description:o.desc||o.description||"",sourceUrl:c,category:o.category||""}}}function Yb(o,e){const t=o.unavailable,n=`<div class="track-number">${e+1}</div>`,r=t?"":`
        <button class="track-menu-btn" type="button" title="More options">
            ${Ls}
        </button>
    `;return`
        <div class="track-item ${t?"unavailable":""}" 
             data-track-id="${o.id}"
             ${t?'title="This track is currently unavailable"':""}>
            ${n}
            <div class="track-item-info">
                <div class="track-item-details">
                    <div class="title">${en(o.title)}</div>
                    <div class="artist">${en(o.artist.name)}</div>
                </div>
            </div>
            <div class="track-item-duration">${t?"--:--":Ma(o.duration)}</div>
            <div class="track-item-actions">
                ${r}
            </div>
        </div>
    `}function Tl(o,e){const t=document.createDocumentFragment(),n=document.createElement("div");n.innerHTML=`
        <div class="track-list-header">
            <span style="width: 40px; text-align: center;">#</span>
            <span>Title</span>
            <span class="duration-header">Duration</span>
            <span style="display: flex; justify-content: flex-end; opacity: 0.8;">Menu</span>
        </div>
    `;const r=e.map((i,c)=>Yb(i,c)).join("");for(n.insertAdjacentHTML("beforeend",r),Array.from(n.children).forEach((i,c)=>{if(c===0)return;const h=e[c-1];i&&h&&Hn.set(i,h)});n.firstChild;)t.appendChild(n.firstChild);o.innerHTML="",o.appendChild(t)}function Ws(o,e,t,n){const r=`
        <button class="play-btn card-play-btn" data-action="play-card" data-type="tracker-project" data-id="${encodeURIComponent(o.name)}" title="Play">
            ${cr}
        </button>
        <button class="card-menu-btn" data-action="card-menu" data-type="tracker-project" data-id="${encodeURIComponent(o.name)}" title="Menu">
            ${Ls}
        </button>
    `;return`
        <div class="card" data-tracker-project-id="${encodeURIComponent(o.name)}" data-sheet-id="${t}" style="cursor: pointer;">
            <div class="card-image-wrapper">
                <img src="${o.image||"assets/logo.svg"}" 
                     alt="${en(o.name)}" 
                     class="card-image" 
                     loading="lazy"
                     onerror="this.src='assets/logo.svg'">
                <button class="like-btn card-like-btn" data-action="toggle-like" data-type="tracker-project" title="Add to Liked">
                    ${yr}
                </button>
                ${r}
            </div>
            <div class="card-info">
                <h4 class="card-title">${en(o.name)}</h4>
                <p class="card-subtitle">${o.timeline||"Unreleased"} â€¢ ${n} tracks</p>
            </div>
        </div>
    `}async function Kb(o,e){er.length||await Vi();const t=Ki.get(o);if(!t){e.innerHTML='<p style="text-align: center; padding: 2rem;">Artist not found.</p>';return}const n=await Vs(o);if(!n||!n.eras){e.innerHTML='<p style="text-align: center; padding: 2rem;">Failed to load tracker data.</p>';return}qb.set(o,{artist:t,eras:n.eras});const r=Object.values(n.eras),i=document.getElementById("tracker-artist-detail-image"),c=document.getElementById("tracker-artist-detail-name"),h=document.getElementById("tracker-artist-detail-meta"),f=document.getElementById("tracker-artist-projects-container"),g=document.getElementById("play-tracker-artist-btn"),y=document.getElementById("download-tracker-artist-btn"),u=Uf(t.name);i.src=`https://assets.artistgrid.cx/${u}.webp`,i.onerror=function(){this.src="assets/logo.svg"},c.textContent=t.name,h.innerHTML=`<span>${r.length} unreleased projects</span>`,g&&(g.onclick=async()=>{let m=[];r.forEach(S=>{S.data&&Object.values(S.data).forEach(_=>{_&&_.length&&_.forEach(M=>{const R=ei(M,S,t.name,m.length,o);m.push(R)})})});const E=m.filter(S=>!S.unavailable);if(E.length>0){const S=[...E].sort(()=>Math.random()-.5);ua.setQueue(S,0),ua.playTrackFromQueue()}}),y&&(y.onclick=()=>{alert("Bulk download coming soon! You can download individual tracks from the project pages.")});let l=document.getElementById("unreleased-search-container");l||(l=document.createElement("div"),l.id="unreleased-search-container",l.style.cssText="margin: 1rem 0; padding: 0 1rem;",l.innerHTML=`
            <input type="text" 
                   id="unreleased-search-input" 
                   placeholder="Search all unreleased songs..." 
                   style="width: 100%; 
                          padding: 0.75rem 1rem; 
                          border-radius: var(--radius); 
                          border: 1px solid var(--border); 
                          background: var(--background); 
                          color: var(--foreground);
                          font-size: 1rem;
                          outline: none;
                          transition: border-color 0.2s;"
                   onfocus="this.style.borderColor='var(--primary)'" 
                   onblur="this.style.borderColor='var(--border)'">
        `,f.parentNode.insertBefore(l,f)),f.innerHTML="",f.className="card-grid",r.forEach(m=>{let E=0;if(m.data&&Object.values(m.data).forEach(M=>{M&&M.length&&(E+=M.length)}),E===0)return;const S=Ws(m,t,o,E);f.insertAdjacentHTML("beforeend",S);const _=f.lastElementChild;_._eraData=m,_._artistName=t.name,_._sheetId=o,_.onclick=M=>{if(M.target.closest(".card-play-btn")){M.stopPropagation();let R=[];m.data&&Object.values(m.data).forEach(fe=>{fe&&fe.length&&fe.forEach(ye=>{const Y=ei(ye,m,t.name,R.length,o);R.push(Y)})});const W=R.filter(fe=>!fe.unavailable);W.length>0&&(ua.setQueue(W,0),ua.playTrackFromQueue())}else M.target.closest(".card-menu-btn")?M.stopPropagation():Bn(`/unreleased/${o}/${encodeURIComponent(m.name)}`)}}),document.getElementById("unreleased-search-input").addEventListener("input",m=>{const E=m.target.value.toLowerCase().trim();if(!E){f.style.display="",document.getElementById("unreleased-search-results")?.remove();return}let S=[];r.forEach(M=>{M.data&&Object.values(M.data).forEach(R=>{R&&R.length&&R.forEach((W,fe)=>{W.name?.toLowerCase().includes(E)&&S.push({song:W,era:M,index:fe})})})}),f.style.display="none";let _=document.getElementById("unreleased-search-results");if(_||(_=document.createElement("div"),_.id="unreleased-search-results",f.parentNode.insertBefore(_,f.nextSibling)),S.length===0)_.innerHTML='<p style="text-align: center; padding: 2rem; color: var(--muted-foreground);">No songs found.</p>';else{_.innerHTML=`
                <h3 style="padding: 0 1rem; margin-bottom: 1rem;">Search Results (${S.length} songs)</h3>
                <div class="track-list" id="unreleased-search-tracklist"></div>
            `;const M=document.getElementById("unreleased-search-tracklist"),R=S.map((W,fe)=>ei(W.song,W.era,t.name,fe,o));Tl(M,R),M.querySelectorAll(".track-item").forEach(W=>{const fe=Hn.get(W);!fe||fe.unavailable||(W.onclick=ye=>{if(ye.target.closest(".track-menu-btn"))return;const Y=R.filter(se=>!se.unavailable),j=Y.findIndex(se=>se.id===fe.id);j>=0&&Y.length>0&&(ua.setQueue(Y,j),ua.playTrackFromQueue())})})}}),document.title=`${t.name} - Unreleased`}async function $b(o,e,t,n){er.length||await Vi();const r=Ki.get(o);if(!r){t.innerHTML='<p style="text-align: center; padding: 2rem;">Project not found.</p>';return}const i=await Vs(o);if(!i||!i.eras){t.innerHTML='<p style="text-align: center; padding: 2rem;">Failed to load project data.</p>';return}const c=Object.values(i.eras).find(Te=>Te.name===e);if(!c){t.innerHTML='<p style="text-align: center; padding: 2rem;">Project not found.</p>';return}let h=[];c.data&&Object.values(c.data).forEach(Te=>{Te&&Te.length&&Te.forEach(Ae=>{const ze=ei(Ae,c,r.name,h.length,o);h.push(ze)})});const f=h.filter(Te=>!Te.unavailable).length,g=document.getElementById("album-detail-image"),y=document.getElementById("album-detail-title"),u=document.getElementById("album-detail-meta"),l=document.getElementById("album-detail-producer"),d=document.getElementById("album-detail-tracklist"),m=document.getElementById("play-album-btn"),E=document.getElementById("shuffle-album-btn"),S=document.getElementById("download-album-btn"),_=document.getElementById("like-album-btn"),M=document.getElementById("album-mix-btn"),R=document.getElementById("add-album-to-playlist-btn");g.src=c.image||"assets/logo.svg",g.style.backgroundColor="",g.onerror=function(){this.src="assets/logo.svg"},y.textContent=c.name,u.innerHTML=`${c.timeline||"Unreleased"} â€¢ ${h.length} tracks â€¢ ${f} available`,l.innerHTML=`By <a href="/unreleased/${o}">${r.name}</a>`,m&&(m.innerHTML=`${cr}<span>Play Project</span>`,m.onclick=()=>{const Te=h.filter(Ae=>!Ae.unavailable);Te.length>0&&(ua.setQueue(Te,0),ua.playTrackFromQueue())}),E&&(E.onclick=()=>{const Te=h.filter(Ae=>!Ae.unavailable);if(Te.length>0){const Ae=[...Te].sort(()=>Math.random()-.5);ua.setQueue(Ae,0),ua.playTrackFromQueue()}}),S&&(S.innerHTML="<span>Download</span>",S.onclick=()=>{alert("Project download coming soon! You can download individual tracks from the menu.")}),_&&(_.style.display="none"),M&&(M.style.display="none"),R&&(R.style.display="none"),Tl(d,h),d.querySelectorAll(".track-item").forEach(Te=>{const Ae=Hn.get(Te);!Ae||Ae.unavailable||(Te.onclick=ze=>{if(ze.target.closest(".track-menu-btn"))return;const de=h.filter(ce=>!ce.unavailable),we=de.findIndex(ce=>ce.id===Ae.id);we>=0&&de.length>0&&(ua.setQueue(de,we),ua.playTrackFromQueue())})});const W=document.getElementById("album-section-more-albums"),fe=document.getElementById("album-detail-more-albums"),ye=document.getElementById("album-title-more-albums");if(W&&fe){const Te=Object.values(i.eras).filter(Ae=>Ae.name!==e);Te.length>0?(fe.innerHTML=Te.map(Ae=>{let ze=0;return Ae.data&&Object.values(Ae.data).forEach(de=>{de&&de.length&&(ze+=de.length)}),Ws(Ae,r,o,ze)}).join(""),ye&&(ye.textContent=`More unreleased from ${r.name}`),W.style.display="block",fe.querySelectorAll(".card").forEach(Ae=>{const ze=decodeURIComponent(Ae.dataset.trackerProjectId),de=i.eras[ze];de&&(Ae.onclick=we=>{if(we.target.closest(".card-play-btn")){we.stopPropagation();let ce=[];de.data&&Object.values(de.data).forEach(Pe=>{Pe&&Pe.length&&Pe.forEach($e=>{const He=ei($e,de,r.name,ce.length,o);ce.push(He)})});const he=ce.filter(Pe=>!Pe.unavailable);he.length>0&&(ua.setQueue(he,0),ua.playTrackFromQueue())}else we.target.closest(".card-menu-btn")?we.stopPropagation():Bn(`/unreleased/${o}/${encodeURIComponent(de.name)}`)})})):W.style.display="none"}const Y=document.getElementById("album-section-eps"),j=document.getElementById("album-section-similar-artists"),se=document.getElementById("album-section-similar-albums");Y&&(Y.style.display="none"),j&&(j.style.display="none"),se&&(se.style.display="none"),document.title=`${c.name} - ${r.name}`}async function Vb(o){o.innerHTML=`
        <h2 class="section-title">Unreleased Music</h2>
        <p style="color: var(--muted-foreground); margin-bottom: 1.5rem; font-size: 0.9rem;">
            Unreleased Songs & Info Provided By <a href="https://artistgrid.cx" target="_blank" style="text-decoration: underline;">ArtistGrid</a>. Consider Donating to Them.
        </p>
        <div style="margin-bottom: 1.5rem;">
            <input 
                type="text" 
                id="unreleased-search-input" 
                placeholder="Search artists..." 
                style="width: 100%; max-width: 400px; padding: 0.75rem 1rem; border-radius: 8px; border: 1px solid var(--border); background: var(--background); color: var(--foreground); font-size: 0.95rem;"
            />
        </div>
        <div id="unreleased-artists-grid" class="card-grid"></div>
        <div id="unreleased-no-results" style="display: none; text-align: center; padding: 2rem; color: var(--muted-foreground);">
            No artists found matching your search.
        </div>
    `;const e=document.getElementById("unreleased-artists-grid"),t=document.getElementById("unreleased-search-input"),n=document.getElementById("unreleased-no-results");let r=[];er.length===0&&(await Bf(),await Vi()),e.innerHTML="",r=[],er.forEach(i=>{const c=vl(i.url);if(!c||!i.name)return;const h=document.createElement("div");h.className="card",h.style.cursor="pointer",h.dataset.artistName=i.name.toLowerCase();const g=`https://assets.artistgrid.cx/${Uf(i.name)}.webp`;h.innerHTML=`
            <div class="card-image-wrapper">
                <img class="card-image" src="${g}" alt="${i.name}" loading="lazy" onerror="this.src='assets/logo.svg'">
            </div>
            <div class="card-info">
                <h4 class="card-title">${i.name}</h4>
                <p class="card-subtitle">Unreleased Music</p>
            </div>
        `,h.onclick=()=>{Bn(`/unreleased/${c}`)},e.appendChild(h),r.push(h)}),er.length===0&&(e.innerHTML='<p style="text-align: center; color: var(--muted-foreground);">No unreleased music data available.</p>'),t&&t.addEventListener("input",i=>{const c=i.target.value.toLowerCase().trim();let h=0;r.forEach(f=>{f.dataset.artistName.includes(c)?(f.style.display="",h++):f.style.display="none"}),n&&(n.style.display=h===0&&c?"block":"none")})}async function Wb(o,e,t){const n=o.split("-");if(n.length<4){e.innerHTML='<p style="text-align: center; padding: 2rem;">Invalid track ID.</p>';return}const r=n[1],i=decodeURIComponent(n.slice(2,-1).join("-")),c=parseInt(n[n.length-1]);er.length||await Vi();const h=Ki.get(r);if(!h){e.innerHTML='<p style="text-align: center; padding: 2rem;">Artist not found.</p>';return}const f=await Vs(r);if(!f||!f.eras){e.innerHTML='<p style="text-align: center; padding: 2rem;">Failed to load track data.</p>';return}const g=f.eras[i];if(!g||!g.data){e.innerHTML='<p style="text-align: center; padding: 2rem;">Track not found.</p>';return}let y=null,u=[];if(Object.values(g.data).forEach(we=>{we&&we.length&&we.forEach(ce=>{const he=ei(ce,g,h.name,u.length,r);u.push(he),u.length-1===c&&(y=he)})}),!y){e.innerHTML='<p style="text-align: center; padding: 2rem;">Track not found.</p>';return}const l=document.getElementById("album-detail-image"),d=document.getElementById("album-detail-title"),m=document.getElementById("album-detail-meta"),E=document.getElementById("album-detail-producer"),S=document.getElementById("album-detail-tracklist"),_=document.getElementById("play-album-btn");l.src=g.image||"assets/logo.svg",l.style.backgroundColor="",l.onerror=function(){this.src="assets/logo.svg"},d.textContent=y.title,m.innerHTML=`${g.timeline||"Unreleased"} â€¢ ${Ma(y.duration)}`,E.innerHTML=`By <a href="/unreleased/${r}">${h.name}</a> â€¢ From <a href="/unreleased/${r}/${encodeURIComponent(g.name)}">${g.name}</a>`,_&&(_.innerHTML=`${cr}<span>Play Track</span>`,_.onclick=()=>{const we=u.filter(he=>!he.unavailable),ce=we.findIndex(he=>he.id===y.id);ce>=0&&we.length>0&&(ua.setQueue(we,ce),ua.playTrackFromQueue())});const M=document.getElementById("shuffle-album-btn"),R=document.getElementById("download-album-btn"),W=document.getElementById("like-album-btn"),fe=document.getElementById("album-mix-btn"),ye=document.getElementById("add-album-to-playlist-btn");M&&(M.style.display="none"),R&&(R.style.display="none"),W&&(W.style.display="none"),fe&&(fe.style.display="none"),ye&&(ye.style.display="none"),Tl(S,[y]);const Y=S.querySelector(".track-item");Y&&!y.unavailable&&(Y.onclick=we=>{if(we.target.closest(".track-menu-btn"))return;const ce=u.filter(Pe=>!Pe.unavailable),he=ce.findIndex(Pe=>Pe.id===y.id);he>=0&&ce.length>0&&(ua.setQueue(ce,he),ua.playTrackFromQueue())});const j=document.getElementById("album-section-more-albums"),se=document.getElementById("album-detail-more-albums"),Te=document.getElementById("album-title-more-albums");if(j&&se){const we=Object.values(f.eras).filter(ce=>ce.name!==i);we.length>0?(se.innerHTML=we.map(ce=>{let he=0;return ce.data&&Object.values(ce.data).forEach(Pe=>{Pe&&Pe.length&&(he+=Pe.length)}),Ws(ce,h,r,he)}).join(""),Te&&(Te.textContent=`More unreleased from ${h.name}`),j.style.display="block"):j.style.display="none"}const Ae=document.getElementById("album-section-eps"),ze=document.getElementById("album-section-similar-artists"),de=document.getElementById("album-section-similar-albums");Ae&&(Ae.style.display="none"),ze&&(ze.style.display="none"),de&&(de.style.display="none"),document.title=`${y.title} - ${h.name}`}async function Qb(o){ua=o,await Promise.all([Bf(),Vi()])}function Ff(o){if(!o)return null;let e=er.find(n=>n.name?.toLowerCase()===o.toLowerCase());if(e)return e;const t=o.toLowerCase().replace(/[^a-z0-9]/g,"");return e=er.find(n=>{if(!n.name)return!1;const r=n.name.toLowerCase().replace(/[^a-z0-9]/g,"");return r===t||r.includes(t)||t.includes(r)}),e||null}async function Xb(o){const e=Ff(o);if(!e)return null;const t=vl(e.url);if(!t)return null;const n=await Vs(t);return!n||!n.eras?null:{artist:e,sheetId:t,eras:Object.values(n.eras)}}ll.applyFont();ll.applyFontSize();const Jb='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></svg>',Zb='<svg width="64px" height="64px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke=""><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path fill-rule="evenodd" clip-rule="evenodd" d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18ZM12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16Z" fill="#9E9E9E"></path> <path d="M18 5C17.4477 5 17 5.44772 17 6C17 6.55228 17.4477 7 18 7C18.5523 7 19 6.55228 19 6C19 5.44772 18.5523 5 18 5Z" fill="#9E9E9E"></path> <path fill-rule="evenodd" clip-rule="evenodd" d="M1.65396 4.27606C1 5.55953 1 7.23969 1 10.6V13.4C1 16.7603 1 18.4405 1.65396 19.7239C2.2292 20.8529 3.14708 21.7708 4.27606 22.346C5.55953 23 7.23969 23 10.6 23H13.4C16.7603 23 18.4405 23 19.7239 22.346C20.8529 21.7708 21.7708 20.8529 22.346 19.7239C23 18.4405 23 16.7603 23 13.4V10.6C23 7.23969 23 5.55953 22.346 4.27606C21.7708 3.14708 20.8529 2.2292 19.7239 1.65396C18.4405 1 16.7603 1 13.4 1H10.6C7.23969 1 5.55953 1 4.27606 1.65396C3.14708 2.2292 2.2292 3.14708 1.65396 4.27606ZM13.4 3H10.6C8.88684 3 7.72225 3.00156 6.82208 3.0751C5.94524 3.14674 5.49684 3.27659 5.18404 3.43597C4.43139 3.81947 3.81947 4.43139 3.43597 5.18404C3.27659 5.49684 3.14674 5.94524 3.0751 6.82208C3.00156 7.72225 3 8.88684 3 10.6V13.4C3 15.1132 3.00156 16.2777 3.0751 17.1779C3.14674 18.0548 3.27659 18.5032 3.43597 18.816C3.81947 19.5686 4.43139 20.1805 5.18404 20.564C5.49684 20.7234 5.94524 20.8533 6.82208 20.9249C7.72225 20.9984 8.88684 21 10.6 21H13.4C15.1132 21 16.2777 20.9984 17.1779 20.9249C18.0548 20.8533 18.5032 20.7234 18.816 20.564C19.5686 20.1805 20.1805 19.5686 20.564 18.816C20.7234 18.5032 20.8533 18.0548 20.9249 17.1779C20.9984 16.2777 21 15.1132 21 13.4V10.6C21 8.88684 20.9984 7.72225 20.9249 6.82208C20.8533 5.94524 20.7234 5.49684 20.564 5.18404C20.1805 4.43139 19.5686 3.81947 18.816 3.43597C18.5032 3.27659 18.0548 3.14674 17.1779 3.0751C16.2777 3.00156 15.1132 3 13.4 3Z" fill="#9E9E9E"></path> </g></svg>',eE='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/></svg>',tE='<svg viewBox="0 -3 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <title>youtube [#9E9E9E168]</title> <desc>Created with Sketch.</desc> <defs> </defs> <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <g id="Dribbble-Light-Preview" transform="translate(-300.000000, -7442.000000)" fill="#9E9E9E"> <g id="icons" transform="translate(56.000000, 160.000000)"> <path d="M251.988432,7291.58588 L251.988432,7285.97425 C253.980638,7286.91168 255.523602,7287.8172 257.348463,7288.79353 C255.843351,7289.62824 253.980638,7290.56468 251.988432,7291.58588 M263.090998,7283.18289 C262.747343,7282.73013 262.161634,7282.37809 261.538073,7282.26141 C259.705243,7281.91336 248.270974,7281.91237 246.439141,7282.26141 C245.939097,7282.35515 245.493839,7282.58153 245.111335,7282.93357 C243.49964,7284.42947 244.004664,7292.45151 244.393145,7293.75096 C244.556505,7294.31342 244.767679,7294.71931 245.033639,7294.98558 C245.376298,7295.33761 245.845463,7295.57995 246.384355,7295.68865 C247.893451,7296.0008 255.668037,7296.17532 261.506198,7295.73552 C262.044094,7295.64178 262.520231,7295.39147 262.895762,7295.02447 C264.385932,7293.53455 264.28433,7285.06174 263.090998,7283.18289" id="youtube-[#9E9E9E168]"> </path> </g> </g> </g> </g></svg>',nE='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z"/></svg>',aE='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>',rE='<svg fill="#9E9E9E" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve" stroke="#9E9E9E"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g id="5151e0c8492e5103c096af88a50061c5"> <path display="inline" d="M25.173,355.106c1.076,0,1.946-0.849,2.117-2.067l5.717-44.884l-5.717-45.889 c-0.171-1.22-1.041-2.061-2.117-2.061c-1.091,0-1.982,0.862-2.125,2.061c0,0.007-5.026,45.889-5.026,45.889l5.026,44.876 C23.191,354.229,24.083,355.106,25.173,355.106z M8.328,336.058c0,0,0,0,0,0.007l0,0V336.058z M6.274,338.047 c1.041,0,1.875-0.813,2.053-1.982l4.42-27.909l-4.42-28.395c-0.171-1.169-1.012-1.981-2.053-1.981 c-1.062,0-1.896,0.819-2.046,1.996L0.5,308.155l3.729,27.896C4.378,337.227,5.212,338.047,6.274,338.047z M47.808,253.712 c-0.157-1.454-1.233-2.51-2.56-2.51c-1.354,0-2.424,1.063-2.566,2.51l-4.762,54.45l4.762,52.455 c0.143,1.461,1.212,2.509,2.566,2.509c1.326,0,2.402-1.048,2.552-2.495l5.425-52.469L47.808,253.712z M65.487,365.236 c1.568,0,2.852-1.269,3.001-2.944l0,0l5.119-54.123l-5.119-55.947c-0.149-1.675-1.433-2.944-3.001-2.944 c-1.583,0-2.873,1.27-3.001,2.951l-4.513,55.94l4.513,54.123C62.614,363.968,63.904,365.236,65.487,365.236z M85.89,366.127 c1.825,0,3.301-1.461,3.436-3.386l-0.007,0.007l4.827-54.571l-4.827-51.913c-0.128-1.918-1.604-3.372-3.429-3.372 c-1.839,0-3.315,1.454-3.429,3.387l-4.256,51.898l4.256,54.564C82.575,364.666,84.051,366.127,85.89,366.127z M114.848,308.198 l-4.527-84.436c-0.114-2.152-1.811-3.828-3.864-3.828s-3.764,1.676-3.864,3.828l-4,84.436l4,54.564 c0.1,2.124,1.811,3.813,3.864,3.813s3.75-1.689,3.864-3.828v0.015L114.848,308.198z M127.195,366.677 c2.303,0,4.185-1.868,4.299-4.264v0.036l4.228-54.244l-4.228-103.74c-0.114-2.395-1.996-4.27-4.299-4.27 c-2.317,0-4.213,1.875-4.313,4.27c0,0.008-3.735,103.74-3.735,103.74l3.743,54.229 C122.982,364.809,124.878,366.677,127.195,366.677z M148.09,191.112c-2.574,0-4.655,2.067-4.748,4.705 c0,0.008-3.472,112.402-3.472,112.402l3.479,53.666c0.085,2.616,2.167,4.677,4.741,4.677c2.552,0,4.641-2.061,4.741-4.698v0.036 l3.928-53.681l-3.928-112.409C152.73,193.173,150.642,191.112,148.09,191.112z M169.156,366.669c2.809,0,5.083-2.26,5.175-5.14 v0.035l3.622-53.338l-3.622-116.188c-0.093-2.887-2.366-5.146-5.175-5.146c-2.823,0-5.097,2.26-5.183,5.146l-3.223,116.188 l3.223,53.331C164.059,364.409,166.333,366.669,169.156,366.669z M190.378,366.619c3.065,0,5.532-2.452,5.611-5.589v0.043 l3.336-52.84l-3.336-113.229c-0.079-3.129-2.546-5.582-5.611-5.582c-3.072,0-5.546,2.46-5.617,5.582l-2.958,113.229l2.965,52.825 C184.832,364.167,187.306,366.619,190.378,366.619z M220.848,308.248l-3.03-109.108c-0.071-3.372-2.73-6.017-6.045-6.017 c-3.329,0-5.988,2.645-6.053,6.024l-2.702,109.093l2.702,52.49c0.064,3.344,2.724,5.988,6.053,5.988 c3.314,0,5.974-2.645,6.045-6.023v0.043L220.848,308.248z M233.33,366.826c3.515,0,6.423-2.901,6.48-6.466v0.043l2.737-52.148 l-2.737-129.824c-0.058-3.558-2.966-6.459-6.48-6.459c-3.521,0-6.431,2.901-6.487,6.459l-2.445,129.781 c0,0.079,2.445,52.184,2.445,52.184C226.899,363.925,229.809,366.826,233.33,366.826z M254.788,159.767 c-3.771,0-6.872,3.108-6.93,6.908l-2.83,141.595l2.83,51.385c0.058,3.75,3.158,6.851,6.93,6.851c3.764,0,6.865-3.101,6.922-6.9 v0.057l3.08-51.392l-3.08-141.602C261.653,162.875,258.552,159.767,254.788,159.767z M274.428,366.861 c0.157,0.015,173.098,0.101,174.224,0.101c34.718,0,62.849-28.146,62.849-62.863s-28.131-62.849-62.849-62.849 c-8.618,0-16.824,1.74-24.31,4.877c-4.997-56.646-52.512-101.089-110.448-101.089c-14.179,0-28.002,2.795-40.207,7.521 c-4.74,1.832-6.01,3.729-6.052,7.386c0,0.007,0,199.488,0,199.488C267.685,363.283,270.671,366.491,274.428,366.861z"> </path> </g> </g></svg>',iE='<svg viewBox="-1.5 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <title>apple [#9E9E9E173]</title> <desc>Created with Sketch.</desc> <defs> </defs> <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <g id="Dribbble-Light-Preview" transform="translate(-102.000000, -7439.000000)" fill="#9E9E9E"> <g id="icons" transform="translate(56.000000, 160.000000)"> <path d="M57.5708873,7282.19296 C58.2999598,7281.34797 58.7914012,7280.17098 58.6569121,7279 C57.6062792,7279.04 56.3352055,7279.67099 55.5818643,7280.51498 C54.905374,7281.26397 54.3148354,7282.46095 54.4735932,7283.60894 C55.6455696,7283.69593 56.8418148,7283.03894 57.5708873,7282.19296 M60.1989864,7289.62485 C60.2283111,7292.65181 62.9696641,7293.65879 63,7293.67179 C62.9777537,7293.74279 62.562152,7295.10677 61.5560117,7296.51675 C60.6853718,7297.73474 59.7823735,7298.94772 58.3596204,7298.97372 C56.9621472,7298.99872 56.5121648,7298.17973 54.9134635,7298.17973 C53.3157735,7298.17973 52.8162425,7298.94772 51.4935978,7298.99872 C50.1203933,7299.04772 49.0738052,7297.68074 48.197098,7296.46676 C46.4032359,7293.98379 45.0330649,7289.44985 46.8734421,7286.3899 C47.7875635,7284.87092 49.4206455,7283.90793 51.1942837,7283.88393 C52.5422083,7283.85893 53.8153044,7284.75292 54.6394294,7284.75292 C55.4635543,7284.75292 57.0106846,7283.67793 58.6366882,7283.83593 C59.3172232,7283.86293 61.2283842,7284.09893 62.4549652,7285.8199 C62.355868,7285.8789 60.1747177,7287.09489 60.1989864,7289.62485" id="apple-[#9E9E9E173]"> </path> </g> </g> </g> </g></svg>';function Ts(o,e){if(e==="custom")return[...o];const t=[...o];switch(e){case"added-newest":return t.sort((n,r)=>(r.addedAt||0)-(n.addedAt||0));case"added-oldest":return t.sort((n,r)=>(n.addedAt||0)-(r.addedAt||0));case"title":return t.sort((n,r)=>(n.title||"").localeCompare(r.title||""));case"artist":return t.sort((n,r)=>{const i=n.artist?.name||n.artists?.[0]?.name||"",c=r.artist?.name||r.artists?.[0]?.name||"";return i.localeCompare(c)});case"album":return t.sort((n,r)=>{const i=n.album?.title||"",c=r.album?.title||"",h=i.localeCompare(c);if(h!==0)return h;const f=n.trackNumber||n.position||0,g=r.trackNumber||r.position||0;return f-g});default:return t}}class sE{constructor(e,t){this.api=e,this.player=t,this.currentTrack=null,this.searchAbortController=null,this.vibrantColorCache=new Map,this.visualizer=null,this.renderLock=!1,window.addEventListener("reset-dynamic-color",()=>{this.resetVibrantColor()}),window.addEventListener("theme-changed",()=>{this.updateGlobalTheme()})}createHeartIcon(e=!1){return e?yr.replace('class="heart-icon"','class="heart-icon filled"'):yr}async extractAndApplyColor(e){if(!e){this.resetVibrantColor();return}if(!Md.isEnabled()){this.resetVibrantColor();return}if(this.vibrantColorCache.has(e)){const r=this.vibrantColorCache.get(e);if(r){this.setVibrantColor(r);return}}const t=new Image;t.crossOrigin="Anonymous";const n=e.includes("?")?"&":"?";t.src=`${e}${n}not-from-cache-please`,t.onload=()=>{try{const r=By(t);r?(this.vibrantColorCache.set(e,r),this.setVibrantColor(r)):(this.vibrantColorCache.set(e,null),this.resetVibrantColor())}catch{this.vibrantColorCache.set(e,null),this.resetVibrantColor()}},t.onerror=()=>{this.vibrantColorCache.set(e,null),this.resetVibrantColor()}}async updateLikeState(e,t,n){const r=await nn.isFavorite(t,n),i=e.querySelector(".like-btn");i&&(i.innerHTML=this.createHeartIcon(r),i.classList.toggle("active",r),i.title=r?"Remove from Liked":"Add to Liked")}async renderPinnedItems(){const e=document.getElementById("pinned-items-nav"),t=document.getElementById("pinned-items-list");if(!e||!t)return;const n=await nn.getPinned();if(n.length===0){e.style.display="none";return}e.style.display="",t.innerHTML=n.map(r=>{let i;if(r.type==="user-playlist"&&!r.cover&&r.images&&r.images.length>0)i=`<div class="pinned-item-collage">${r.images.slice(0,4).map(f=>`<img src="${this.api.getCoverUrl(f)}" loading="lazy">`).join("")}</div>`;else{const c=r.type==="artist"?this.api.getArtistPictureUrl(r.cover):this.api.getCoverUrl(r.cover),h=r.type==="artist"?"artist":"";i=`<img src="${c}" class="pinned-item-cover ${h}" alt="${en(r.name)}" loading="lazy" onerror="this.src='assets/logo.svg'">`}return`
                <li class="nav-item">
                    <a href="${r.href}">
                        ${i}
                        <span class="pinned-item-name">${en(r.name)}</span>
                    </a>
                </li>
            `}).join("")}setCurrentTrack(e){this.currentTrack=e,this.updateGlobalTheme();const t=document.getElementById("now-playing-like-btn"),n=document.getElementById("now-playing-add-playlist-btn"),r=document.getElementById("mobile-add-playlist-btn"),i=document.getElementById("toggle-lyrics-btn"),c=document.getElementById("fs-like-btn"),h=document.getElementById("fs-add-playlist-btn");if(e){const f=e.isLocal,g=e.isTracker||e.id&&String(e.id).startsWith("tracker-"),y=f||g;t&&(y?t.style.display="none":(t.style.display="flex",this.updateLikeState(t.parentElement,"track",e.id))),n&&(f?n.style.setProperty("display","none","important"):(n.style.removeProperty("display"),n.style.display="flex")),r&&(f?r.style.setProperty("display","none","important"):(r.style.removeProperty("display"),r.style.display="flex")),i&&(f||g?i.style.display="none":i.style.removeProperty("display")),c&&(y?c.style.display="none":(c.style.display="flex",this.updateLikeState(c.parentElement,"track",e.id))),h&&(y?h.style.display="none":h.style.display="flex")}else t&&(t.style.display="none"),n&&n.style.setProperty("display","none","important"),r&&r.style.setProperty("display","none","important"),i&&(i.style.display="none"),c&&(c.style.display="none"),h&&(h.style.display="none")}updateGlobalTheme(){document.getElementById("page-album").classList.contains("active")||(Di.isEnabled()&&this.currentTrack?.album?.cover?this.extractAndApplyColor(this.api.getCoverUrl(this.currentTrack.album.cover,"80")):this.resetVibrantColor())}createExplicitBadge(){return'<span class="explicit-badge" title="Explicit">E</span>'}adjustTitleFontSize(e,t){e.classList.remove("long-title","very-long-title"),t&&(t.length>40?e.classList.add("very-long-title"):t.length>25&&e.classList.add("long-title"))}createTrackItemHTML(e,t,n=!1,r=!1,i=!1){const c=e.isUnavailable,h=or?.shouldHideTrack(e),f=n?this.getCoverHTML(e.album?.videoCover,e.album?.cover,"Track Cover","track-item-cover"):"";let g;r&&!n?g=`${e.volumeNumber??e.discNumber??1}-${e.trackNumber}`:i&&e.trackNumber?g=e.trackNumber:g=t+1;const y=`<div class="track-number">${n?f:g}</div>`,u=xi(e)?this.createExplicitBadge():"",l=Or(e),d=Ca(e),m=this.player?.currentTrack?.id===e.id;e.isLocal&&(!e.album?.cover||e.album.cover==="assets/appicon.png")&&(n=!1);const E=Ko(e),S=c?"":`
            <button class="track-menu-btn" type="button" title="More options" ${e.isLocal?'style="display:none"':""}>
                ${Ls}
            </button>
        `,_=h?`title="Blocked: ${or.isTrackBlocked(e.id)?"Track blocked":or.isArtistBlocked(e.artist?.id)?"Artist blocked":"Album blocked"}"`:"";return`
            <div class="${["track-item",m?"playing":"",c?"unavailable":"",h?"blocked":""].filter(Boolean).join(" ")}" 
                 data-track-id="${e.id}" 
                 ${e.isLocal?'data-is-local="true"':""}
                 ${c?'title="This track is currently unavailable"':""}
                 ${_}>
                ${y}
                <div class="track-item-info">
                    <div class="track-item-details">
                        <div class="title">
                            ${en(d)}
                            ${u}
                            ${l}
                        </div>
                        <div class="artist">${Ps(e)}${E}</div>
                    </div>
                </div>
                <div class="track-item-duration">${c||h?"--:--":e.duration?Ma(e.duration):"--:--"}</div>
                <div class="track-item-actions">
                    ${S}
                </div>
            </div>
        `}getCoverHTML(e,t,n,r="card-image",i="lazy"){const c=e?this.api.tidalAPI.getVideoCoverUrl(e):null;return c?`<video src="${c}" class="${r}" alt="${n}" autoplay loop muted playsinline></video>`:`<img src="${this.api.getCoverUrl(t)}" class="${r}" alt="${n}" loading="${i}">`}createBaseCardHTML({type:e,id:t,href:n,title:r,subtitle:i,imageHTML:c,actionButtonsHTML:h,isCompact:f,extraAttributes:g="",extraClasses:y=""}){const u=e!=="artist"?`
            <button class="play-btn card-play-btn" data-action="play-card" data-type="${e}" data-id="${t}" title="Play">
                ${cr}
            </button>
            <button class="card-menu-btn" data-action="card-menu" data-type="${e}" data-id="${t}" title="Menu">
                ${Ls}
            </button>
        `:"",l=`
            <div class="card-info">
                <h4 class="card-title">${r}</h4>
                ${i?`<p class="card-subtitle">${i}</p>`:""}
            </div>`;return`
            <div class="card ${y} ${f?"compact":""}" data-${e}-id="${t}" data-href="${n}" style="cursor: pointer;" ${g}>
                <div class="card-image-wrapper">
                    ${c}
                    ${h}
                    ${f?"":u}
                </div>
                ${l}
                ${f?u:""}
            </div>
        `}createPlaylistCardHTML(e){const t=e.squareImage||e.image||e.uuid,n=Mr.isCompactAlbum();return this.createBaseCardHTML({type:"playlist",id:e.uuid,href:`/playlist/${e.uuid}`,title:e.title,subtitle:`${e.numberOfTracks||0} tracks`,imageHTML:`<img src="${this.api.getCoverUrl(t)}" alt="${e.title}" class="card-image" loading="lazy">`,actionButtonsHTML:`
                <button class="like-btn card-like-btn" data-action="toggle-like" data-type="playlist" title="Add to Liked">
                    ${this.createHeartIcon(!1)}
                </button>
            `,isCompact:n})}createFolderCardHTML(e){const t=e.cover||"assets/folder.png",n=Mr.isCompactAlbum();return this.createBaseCardHTML({type:"folder",id:e.id,href:`/folder/${e.id}`,title:en(e.name),subtitle:`${e.playlists?e.playlists.length:0} playlists`,imageHTML:`<img src="${t}" alt="${en(e.name)}" class="card-image" loading="lazy" onerror="this.src='/assets/folder.png'">`,actionButtonsHTML:"",isCompact:n})}createMixCardHTML(e){const t=e.cover||"/assets/appicon.png",n=e.subTitle||e.description||"",r=Mr.isCompactAlbum();return this.createBaseCardHTML({type:"mix",id:e.id,href:`/mix/${e.id}`,title:e.title,subtitle:n,imageHTML:`<img src="${t}" alt="${e.title}" class="card-image" loading="lazy">`,actionButtonsHTML:`
                <button class="like-btn card-like-btn" data-action="toggle-like" data-type="mix" title="Add to Liked">
                    ${this.createHeartIcon(!1)}
                </button>
            `,isCompact:r})}createUserPlaylistCardHTML(e,t=null){let n="";if(e.cover)n=`<img src="${e.cover}" alt="${e.name}" class="card-image" loading="lazy">`;else{const c=e.tracks||[];let h=e.images||[];const f=new Set(h);if(h.length===0)for(const g of c){const y=g.album?.cover;if(y&&!f.has(y)&&(f.add(y),h.push(y),h.length>=4))break}if(h.length>=2){const g=Math.min(h.length,4),y=g<4?`items-${g}`:"",u=h.slice(0,4);n=`
                    <div class="card-image card-collage ${y}">
                        ${u.map(l=>`<img src="${this.api.getCoverUrl(l)}" alt="" loading="lazy">`).join("")}
                    </div>
                `}else h.length>0?n=`<img src="${this.api.getCoverUrl(h[0])}" alt="${e.name}" class="card-image" loading="lazy">`:n=`<img src="/assets/appicon.png" alt="${e.name}" class="card-image" loading="lazy">`}const r=Mr.isCompactAlbum(),i=t||`${e.tracks?e.tracks.length:e.numberOfTracks||0} tracks`;return this.createBaseCardHTML({type:"user-playlist",id:e.id,href:`/userplaylist/${e.id}`,title:en(e.name),subtitle:i,imageHTML:n,actionButtonsHTML:`
                <button class="edit-playlist-btn" data-action="edit-playlist" title="Edit Playlist">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                    </svg>
                </button>
                <button class="delete-playlist-btn" data-action="delete-playlist" title="Delete Playlist">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 6h18"/>
                        <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                        <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                        <line x1="10" y1="11" x2="10" y2="17"/>
                        <line x1="14" y1="11" x2="14" y2="17"/>
                    </svg>
                </button>
            `,isCompact:r,extraAttributes:'draggable="true"',extraClasses:"user-playlist"})}createAlbumCardHTML(e){const t=xi(e)?this.createExplicitBadge():"",n=Or(e),r=or?.shouldHideAlbum(e);let i="";if(e.releaseDate){const g=new Date(e.releaseDate);isNaN(g.getTime())||(i=`${g.getFullYear()}`)}let c="";e.type==="EP"?c=" â€¢ EP":e.type==="SINGLE"&&(c=" â€¢ Single");const h=Mr.isCompactAlbum();let f="";return e.artist?f=typeof e.artist=="string"?e.artist:e.artist.name:e.artists?.length&&(f=e.artists.map(g=>g.name).join(", ")),this.createBaseCardHTML({type:"album",id:e.id,href:`/album/${e.id}`,title:`${en(e.title)} ${t} ${n}`,subtitle:`${en(f)} â€¢ ${i}${c}`,imageHTML:this.getCoverHTML(e.videoCover,e.cover,en(e.title)),actionButtonsHTML:`
                <button class="like-btn card-like-btn" data-action="toggle-like" data-type="album" title="Add to Liked">
                    ${this.createHeartIcon(!1)}
                </button>
            `,isCompact:h,extraClasses:r?"blocked":"",extraAttributes:r?`title="Blocked: ${or.isAlbumBlocked(e.id)?"Album blocked":"Artist blocked"}"`:""})}createArtistCardHTML(e){const t=Mr.isCompactArtist(),n=or?.shouldHideArtist(e);return this.createBaseCardHTML({type:"artist",id:e.id,href:`/artist/${e.id}`,title:en(e.name),subtitle:"",imageHTML:`<img src="${this.api.getArtistPictureUrl(e.picture)}" alt="${en(e.name)}" class="card-image" loading="lazy">`,actionButtonsHTML:`
                <button class="like-btn card-like-btn" data-action="toggle-like" data-type="artist" title="Add to Liked">
                    ${this.createHeartIcon(!1)}
                </button>
            `,isCompact:t,extraClasses:`artist${n?" blocked":""}`,extraAttributes:n?'title="Blocked: Artist blocked"':""})}createSkeletonTrack(e=!1){return`
            <div class="skeleton-track">
                ${e?'<div class="skeleton skeleton-track-cover"></div>':'<div class="skeleton skeleton-track-number"></div>'}
                <div class="skeleton-track-info">
                    <div class="skeleton-track-details">
                        <div class="skeleton skeleton-track-title"></div>
                        <div class="skeleton skeleton-track-artist"></div>
                    </div>
                </div>
                <div class="skeleton skeleton-track-duration"></div>
                <div class="skeleton skeleton-track-actions"></div>
            </div>
        `}createSkeletonCard(e=!1){return`
            <div class="skeleton-card ${e?"artist":""}">
                <div class="skeleton skeleton-card-image"></div>
                <div class="skeleton skeleton-card-title"></div>
                ${e?"":'<div class="skeleton skeleton-card-subtitle"></div>'}
            </div>
        `}createSkeletonTracks(e=5,t=!1){return Array(e).fill(0).map(()=>this.createSkeletonTrack(t)).join("")}createSkeletonCards(e=6,t=!1){return Array(e).fill(0).map(()=>this.createSkeletonCard(t)).join("")}setupSearchClearButton(e,t=".search-clear-btn"){if(!e)return;const n=e.parentElement?.querySelector(t);if(!n)return;const r=n._clearListener;r&&n.removeEventListener("click",r);const i=()=>{n.style.display=e.value.trim()?"flex":"none"},c=()=>{e.value="",e.dispatchEvent(new Event("input")),e.focus()};e.addEventListener("input",i),n._clearListener=c,n.addEventListener("click",c)}setupTracklistSearch(e="track-list-search-input",t="playlist-detail-tracklist"){const n=document.getElementById(e),r=document.getElementById(t);if(!n||!r)return;this.setupSearchClearButton(n);const i=n._searchListener;i&&n.removeEventListener("input",i);const c=()=>{const h=n.value.toLowerCase().trim();r.querySelectorAll(".track-item").forEach(g=>{const y=Hn.get(g);if(!y){g.style.display="";return}const u=(y.title||"").toLowerCase(),l=(y.artist?.name||y.artists?.[0]?.name||"").toLowerCase(),d=(y.album?.title||"").toLowerCase(),m=u.includes(h)||l.includes(h)||d.includes(h);g.style.display=m?"":"none"})};n._searchListener=c,n.addEventListener("input",c)}renderListWithTracks(e,t,n,r=!1,i=!1){const c=document.createDocumentFragment(),h=document.createElement("div"),f=t.some(g=>(g.volumeNumber||g.discNumber||1)>1);for(h.innerHTML=t.map((g,y)=>this.createTrackItemHTML(g,y,n,f,i)).join(""),Array.from(h.children).forEach((g,y)=>{const u=t[y];g&&u&&(Hn.set(g,u),this.updateLikeState(g,"track",u.id))});h.firstChild;)c.appendChild(h.firstChild);r||(e.innerHTML=""),e.appendChild(c)}setPageBackground(e){const t=document.getElementById("page-background");Di.isEnabled()&&e?(t.style.backgroundImage=`url('${e}')`,t.classList.add("active"),document.body.classList.add("has-page-background")):(t.classList.remove("active"),document.body.classList.remove("has-page-background"),setTimeout(()=>{t.classList.contains("active")||(t.style.backgroundImage="")},500))}setVibrantColor(e){if(!e)return;const t=document.documentElement,r=t.getAttribute("data-theme")==="white";let i=e.replace("#","");i.length===3&&(i=i.split("").map(d=>d+d).join(""));let c=parseInt(i.substr(0,2),16),h=parseInt(i.substr(2,2),16),f=parseInt(i.substr(4,2),16),g=(c*299+h*587+f*114)/1e3;if(r)for(;g>150;)c=Math.floor(c*.9),h=Math.floor(h*.9),f=Math.floor(f*.9),g=(c*299+h*587+f*114)/1e3;else for(;g<80&&(c=Math.min(255,Math.max(c+1,Math.floor(c*1.15))),h=Math.min(255,Math.max(h+1,Math.floor(h*1.15))),f=Math.min(255,Math.max(f+1,Math.floor(f*1.15))),g=(c*299+h*587+f*114)/1e3,!(c>=255&&h>=255&&f>=255)););const y=`#${c.toString(16).padStart(2,"0")}${h.toString(16).padStart(2,"0")}${f.toString(16).padStart(2,"0")}`,u=g>128?"#000000":"#ffffff";t.style.setProperty("--primary",y),t.style.setProperty("--primary-foreground",u),t.style.setProperty("--highlight",y),t.style.setProperty("--highlight-rgb",`${c}, ${h}, ${f}`),t.style.setProperty("--active-highlight",y),t.style.setProperty("--ring",y);let l;if(g>200){const d=Math.floor(c*.85),m=Math.floor(h*.85),E=Math.floor(f*.85);l=`rgba(${d}, ${m}, ${E}, 0.25)`}else l=`rgba(${c}, ${h}, ${f}, 0.15)`;t.style.setProperty("--track-hover-bg",l)}resetVibrantColor(){const e=document.documentElement;e.style.removeProperty("--primary"),e.style.removeProperty("--primary-foreground"),e.style.removeProperty("--highlight"),e.style.removeProperty("--highlight-rgb"),e.style.removeProperty("--active-highlight"),e.style.removeProperty("--ring"),e.style.removeProperty("--track-hover-bg")}updateFullscreenMetadata(e,t){if(!e)return;const n=document.getElementById("fullscreen-cover-overlay"),r=document.getElementById("fullscreen-cover-image"),i=document.getElementById("fullscreen-track-title"),c=document.getElementById("fullscreen-track-artist"),h=document.getElementById("fullscreen-next-track"),f=e.album?.videoCover?this.api.tidalAPI.getVideoCoverUrl(e.album.videoCover,"1280"):null,g=f||this.api.getCoverUrl(e.album?.cover,"1280"),y=document.getElementById("fs-like-btn");if(y&&this.updateLikeState(y.parentElement,"track",e.id),f){if(r.tagName==="IMG"){const d=document.createElement("video");d.src=f,d.autoplay=!0,d.loop=!0,d.muted=!0,d.playsInline=!0,d.id=r.id,d.className=r.className,r.replaceWith(d)}}else if(r.tagName==="VIDEO"){const d=document.createElement("img");d.src=g,d.id=r.id,d.className=r.className,r.replaceWith(d)}const u=document.getElementById("fullscreen-cover-image");(u.src!==g||!f)&&(u.src=g),n.style.setProperty("--bg-image",`url('${g}')`),this.extractAndApplyColor(this.api.getCoverUrl(e.album?.cover,"80"));const l=Or(e);i.innerHTML=`${en(e.title)} ${l}`,c.textContent=wa(e),t?(h.style.display="flex",h.querySelector(".value").textContent=`${t.title} â€¢ ${wa(t)}`):h.style.display="none"}async showFullscreenCover(e,t,n,r){if(!e)return;window.location.hash!=="#fullscreen"&&window.history.pushState({fullscreen:!0},"","#fullscreen");const i=document.getElementById("fullscreen-cover-overlay"),c=document.getElementById("fullscreen-next-track"),h=document.getElementById("toggle-fullscreen-lyrics-btn");if(this.updateFullscreenMetadata(e,t),t?(c.classList.remove("animate-in"),c.offsetWidth,c.classList.add("animate-in")):c.classList.remove("animate-in"),n&&r){h.style.display="flex",h.classList.remove("active");const y=()=>{ks(e,r,n),h.classList.toggle("active")},u=h.cloneNode(!0);h.parentNode.replaceChild(u,h),u.addEventListener("click",y)}else h.style.display="none";const f=document.querySelector(".now-playing-bar");f&&(f.style.display="none"),this.setupFullscreenControls(r),i.style.display="flex";const g=()=>{if(!br.isEnabled()){this.visualizer&&this.visualizer.stop();return}if(!this.visualizer&&r){const y=document.getElementById("visualizer-canvas");y&&(this.visualizer=new Tb(y,r))}this.visualizer&&this.visualizer.start(),i.classList.add("visualizer-active")};if(this.setupUIToggleButton(i),localStorage.getItem("epilepsy-warning-dismissed")==="true")g();else{const y=document.getElementById("epilepsy-warning-modal");if(y){y.classList.add("active");const u=document.getElementById("epilepsy-accept-btn"),l=document.getElementById("epilepsy-cancel-btn");u.onclick=()=>{y.classList.remove("active"),localStorage.setItem("epilepsy-warning-dismissed","true"),g()},l.onclick=()=>{y.classList.remove("active"),this.closeFullscreenCover()}}else g()}}closeFullscreenCover(){const e=document.getElementById("fullscreen-cover-overlay");e.style.display="none",e.classList.remove("visualizer-active","ui-hidden");const t=document.querySelector(".now-playing-bar");t&&t.style.removeProperty("display"),this.fullscreenUpdateInterval&&(cancelAnimationFrame(this.fullscreenUpdateInterval),this.fullscreenUpdateInterval=null),this.visualizer&&this.visualizer.stop(),this.uiToggleMouseTimer&&(clearTimeout(this.uiToggleMouseTimer),this.uiToggleMouseTimer=null)}setupUIToggleButton(e){const t=document.getElementById("toggle-ui-btn");if(!t)return;let n=!1;const r=()=>{t.classList.add("visible")},i=()=>{t.classList.remove("visible")},c=f=>{const g=e.getBoundingClientRect(),y=f.clientY<100&&f.clientX>g.width-150;n&&(y?r():i())},h=()=>{n=!n,e.classList.toggle("ui-hidden",n),t.classList.toggle("active",n),t.title=n?"Show UI":"Hide UI",n?i():r()};t.addEventListener("click",h),e.addEventListener("mousemove",c),e.addEventListener("mouseleave",()=>{n&&i()}),this.uiToggleCleanup=()=>{t.removeEventListener("click",h),e.removeEventListener("mousemove",c)}}setupFullscreenControls(e){const t=document.getElementById("fs-play-pause-btn"),n=document.getElementById("fs-prev-btn"),r=document.getElementById("fs-next-btn"),i=document.getElementById("fs-shuffle-btn"),c=document.getElementById("fs-repeat-btn"),h=document.getElementById("fs-progress-bar"),f=document.getElementById("fs-progress-fill"),g=document.getElementById("fs-current-time"),y=document.getElementById("fs-total-duration"),u=document.getElementById("fs-like-btn"),l=document.getElementById("fs-add-playlist-btn"),d=document.getElementById("fs-download-btn"),m=document.getElementById("fs-cast-btn"),E=document.getElementById("fs-queue-btn"),S=document.getElementById("fullscreen-track-artist");S&&(S.style.cursor="pointer",S.onclick=()=>{this.player.currentTrack&&this.player.currentTrack.artist&&(this.closeFullscreenCover(),Bn(`/artist/${this.player.currentTrack.artist.id}`))});let _=null;const M=()=>{const ze=e.paused;ze!==_&&(_=ze,ze?t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>':t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>')};M(),t.onclick=()=>{this.player.handlePlayPause(),M()},n.onclick=()=>this.player.playPrev(),r.onclick=()=>this.player.playNext(),i.onclick=()=>{this.player.toggleShuffle(),i.classList.toggle("active",this.player.shuffleActive)},c.onclick=()=>{const ze=this.player.toggleRepeat();c.classList.toggle("active",ze!==0),ze===2?c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m17 2 4 4-4 4"/><path d="M3 11v-1a4 4 0 0 1 4-4h14"/><path d="m7 22-4-4 4-4"/><path d="M21 13v1a4 4 0 0 1-4 4H3"/><path d="M11 10h1v4"/></svg>':c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m17 2 4 4-4 4"/><path d="M3 11v-1a4 4 0 0 1 4-4h14"/><path d="m7 22-4-4 4-4"/><path d="M21 13v1a4 4 0 0 1-4 4H3"/></svg>'};let R=!1,W=!1,fe=0;const ye=ze=>{isNaN(e.duration)||(f.style.width=`${ze*100}%`,g&&(g.textContent=Ma(ze*e.duration)))};h.addEventListener("mousedown",ze=>{R=!0,W=!e.paused,W&&e.pause();const de=h.getBoundingClientRect(),we=Math.max(0,Math.min(1,(ze.clientX-de.left)/de.width));fe=we,ye(we)}),h.addEventListener("touchstart",ze=>{ze.preventDefault(),R=!0,W=!e.paused,W&&e.pause();const de=ze.touches[0],we=h.getBoundingClientRect(),ce=Math.max(0,Math.min(1,(de.clientX-we.left)/we.width));fe=ce,ye(ce)},{passive:!1}),document.addEventListener("mousemove",ze=>{if(R){const de=h.getBoundingClientRect(),we=Math.max(0,Math.min(1,(ze.clientX-de.left)/de.width));fe=we,ye(we)}}),document.addEventListener("touchmove",ze=>{if(R){const de=ze.touches[0],we=h.getBoundingClientRect(),ce=Math.max(0,Math.min(1,(de.clientX-we.left)/we.width));fe=ce,ye(ce)}},{passive:!1}),document.addEventListener("mouseup",()=>{R&&(isNaN(e.duration)||(e.currentTime=fe*e.duration,W&&e.play()),R=!1)}),document.addEventListener("touchend",()=>{R&&(isNaN(e.duration)||(e.currentTime=fe*e.duration,W&&e.play()),R=!1)}),u&&(u.onclick=()=>document.getElementById("now-playing-like-btn")?.click()),l&&(l.onclick=()=>document.getElementById("now-playing-add-playlist-btn")?.click()),d&&(d.onclick=()=>document.getElementById("download-current-btn")?.click()),m&&(m.onclick=()=>document.getElementById("cast-btn")?.click()),E&&(E.onclick=()=>{document.getElementById("queue-btn")?.click()}),i.classList.toggle("active",this.player.shuffleActive);const Y=this.player.repeatMode;c.classList.toggle("active",Y!==0),Y===2&&(c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m17 2 4 4-4 4"/><path d="M3 11v-1a4 4 0 0 1 4-4h14"/><path d="m7 22-4-4 4-4"/><path d="M21 13v1a4 4 0 0 1-4 4H3"/><path d="M11 10h1v4"/></svg>');const j=document.getElementById("fs-volume-btn"),se=document.getElementById("fs-volume-bar"),Te=document.getElementById("fs-volume-fill");if(j&&se&&Te){const ze=()=>{const{muted:ce}=e,he=this.player.userVolume;j.innerHTML=ce||he===0?Yd:Gd,j.classList.toggle("muted",ce||he===0);const Pe=ce?0:he*100;Te.style.setProperty("--fs-volume-level",`${Pe}%`),Te.style.width=`${Pe}%`};j.onclick=()=>{e.muted=!e.muted,localStorage.setItem("muted",e.muted),ze()};const de=ce=>{const he=se.getBoundingClientRect(),$e=Math.max(0,Math.min(1,(ce.clientX-he.left)/he.width));this.player.setVolume($e),e.muted&&$e>0&&(e.muted=!1,localStorage.setItem("muted",!1)),ze()};let we=!1;se.addEventListener("mousedown",ce=>{we=!0,de(ce)}),se.addEventListener("touchstart",ce=>{ce.preventDefault(),we=!0;const he=ce.touches[0];de({clientX:he.clientX})},{passive:!1}),document.addEventListener("mousemove",ce=>{we&&de(ce)}),document.addEventListener("touchmove",ce=>{if(we){const he=ce.touches[0];de({clientX:he.clientX})}},{passive:!1}),document.addEventListener("mouseup",()=>{we=!1}),document.addEventListener("touchend",()=>{we=!1}),e.addEventListener("volumechange",ze),ze()}const Ae=()=>{if(document.getElementById("fullscreen-cover-overlay").style.display==="none")return;const ze=e.duration||0,de=e.currentTime||0;if(ze>0){if(!R){const we=de/ze*100;f.style.width=`${we}%`,g.textContent=Ma(de)}y.textContent=Ma(ze)}M(),this.fullscreenUpdateInterval=requestAnimationFrame(Ae)};this.fullscreenUpdateInterval&&cancelAnimationFrame(this.fullscreenUpdateInterval),this.fullscreenUpdateInterval=requestAnimationFrame(Ae)}showPage(e){document.querySelectorAll(".page").forEach(t=>{t.classList.toggle("active",t.id===`page-${e}`)}),document.querySelectorAll(".sidebar-nav a").forEach(t=>{t.classList.toggle("active",t.pathname===`/${e}`||e==="home"&&t.pathname==="/")}),document.querySelector(".main-content").scrollTop=0,["album","artist","playlist","mix"].includes(e)||(this.setPageBackground(null),this.updateGlobalTheme()),e==="settings"&&this.renderApiSettings()}async renderLibraryPage(){this.showPage("library");const e=document.getElementById("library-tracks-container"),t=document.getElementById("library-albums-container"),n=document.getElementById("library-artists-container"),r=document.getElementById("library-playlists-container"),i=document.getElementById("library-local-container"),c=document.getElementById("my-folders-container"),h=await nn.getFavorites("track"),f=document.getElementById("shuffle-liked-tracks-btn"),g=document.getElementById("download-liked-tracks-btn");h.length?(f&&(f.style.display="flex"),g&&(g.style.display="flex"),this.renderListWithTracks(e,h,!0)):(f&&(f.style.display="none"),g&&(g.style.display="none"),e.innerHTML=Kn("No liked tracks yet."));const y=await nn.getFavorites("album");y.length?(t.innerHTML=y.map(W=>this.createAlbumCardHTML(W)).join(""),y.forEach(W=>{const fe=t.querySelector(`[data-album-id="${W.id}"]`);fe&&(Hn.set(fe,W),this.updateLikeState(fe,"album",W.id))})):t.innerHTML=Kn("No liked albums yet.");const u=await nn.getFavorites("artist");u.length?(n.innerHTML=u.map(W=>this.createArtistCardHTML(W)).join(""),u.forEach(W=>{const fe=n.querySelector(`[data-artist-id="${W.id}"]`);fe&&(Hn.set(fe,W),this.updateLikeState(fe,"artist",W.id))})):n.innerHTML=Kn("No liked artists yet.");const l=await nn.getFavorites("playlist"),d=await nn.getFavorites("mix");let m=[];l.length&&m.push(...l.map(W=>({...W,_type:"playlist"}))),d.length&&m.push(...d.map(W=>({...W,_type:"mix"}))),m.sort((W,fe)=>fe.addedAt-W.addedAt),m.length?(r.innerHTML=m.map(W=>W._type==="playlist"?this.createPlaylistCardHTML(W):this.createMixCardHTML(W)).join(""),l.forEach(W=>{const fe=r.querySelector(`[data-playlist-id="${W.uuid}"]`);fe&&(Hn.set(fe,W),this.updateLikeState(fe,"playlist",W.uuid))}),d.forEach(W=>{const fe=r.querySelector(`[data-mix-id="${W.id}"]`);fe&&(Hn.set(fe,W),this.updateLikeState(fe,"mix",W.id))})):r.innerHTML=Kn("No liked playlists or mixes yet.");const E=await nn.getFolders();c&&(c.innerHTML=E.map(W=>this.createFolderCardHTML(W)).join(""),c.style.display=E.length?"grid":"none");const S=document.getElementById("my-playlists-container"),_=await nn.getPlaylists(),M=new Set;E.forEach(W=>{W.playlists&&W.playlists.forEach(fe=>M.add(fe))});const R=_.filter(W=>!M.has(W.id));R.length?(S.innerHTML=R.map(W=>this.createUserPlaylistCardHTML(W)).join(""),R.forEach(W=>{const fe=S.querySelector(`[data-user-playlist-id="${W.id}"]`);fe&&Hn.set(fe,W)})):E.length===0?S.innerHTML=Kn("No playlists yet. Create your first playlist!"):S.innerHTML="",this.renderLocalFiles(i)}async renderLocalFiles(e){if(!e)return;const t=document.getElementById("local-files-intro"),n=document.getElementById("local-files-header"),r=document.getElementById("local-files-list"),i=document.getElementById("select-local-folder-text"),c=await nn.getSetting("local_folder_handle");c?(i&&(i.textContent=`Load "${c.name}"`),window.localFilesCache&&window.localFilesCache.length>0?(t&&(t.style.display="none"),n&&(n.style.display="flex",n.querySelector("h3").textContent=`Local Files (${window.localFilesCache.length})`),r&&this.renderListWithTracks(r,window.localFilesCache,!0)):(t&&(t.style.display="block"),n&&(n.style.display="none"),r&&(r.innerHTML=""))):(i&&(i.textContent="Select Music Folder"),t&&(t.style.display="block"),n&&(n.style.display="none"),r&&(r.innerHTML=""))}async renderHomePage(){if(!this.renderLock){this.renderLock=!0;try{this.showPage("home");const e=document.getElementById("home-welcome"),t=document.getElementById("home-content"),n=document.getElementById("home-editors-picks-section-empty"),r=document.getElementById("home-editors-picks-section"),i=await nn.getHistory(),c=await nn.getFavorites("track"),h=await nn.getPlaylists(!0),f=i.length>0||c.length>0||h.length>0;if(Vr.shouldShowEditorsPicks()?(n&&(n.style.display=f?"none":""),r&&(r.style.display=f?"":"none")):(n&&(n.style.display="none"),r&&(r.style.display="none")),f?this.renderHomeEditorsPicks(!1,"home-editors-picks"):this.renderHomeEditorsPicks(!1,"home-editors-picks-empty"),!f){e&&(e.style.display="block"),t&&(t.style.display="none");return}e&&(e.style.display="none"),t&&(t.style.display="block");const g=document.getElementById("refresh-songs-btn"),y=document.getElementById("refresh-albums-btn"),u=document.getElementById("refresh-artists-btn"),l=document.getElementById("clear-recent-btn");g&&(g.onclick=()=>this.renderHomeSongs(!0)),y&&(y.onclick=()=>this.renderHomeAlbums(!0)),u&&(u.onclick=()=>this.renderHomeArtists(!0)),l&&(l.onclick=()=>{confirm("Clear recent activity?")&&(Nr.clear(),this.renderHomeRecent())}),this.renderHomeRecent();const d=await this.getSeeds();await Promise.all([this.renderHomeSongs(!1,d),this.renderHomeAlbums(!1,d),this.renderHomeArtists(!1,d)])}finally{this.renderLock=!1}}}async getSeeds(){const e=await nn.getHistory(),t=await nn.getFavorites("track"),r=(await nn.getPlaylists(!0)).flatMap(h=>h.tracks||[]),i=h=>[...h].sort(()=>Math.random()-.5),c=[...i(r).slice(0,20),...i(t).slice(0,20),...i(e).slice(0,10)];return i(c)}async renderHomeSongs(e=!1,t=null){const n=document.getElementById("home-recommended-songs"),r=n?.closest(".content-section");if(!Vr.shouldShowRecommendedSongs()){r&&(r.style.display="none");return}if(r&&(r.style.display=""),n){if(e||n.children.length===0)n.innerHTML=this.createSkeletonTracks(10,!0);else if(!n.querySelector(".skeleton"))return;try{const c=(t||await this.getSeeds()).slice(0,5),h=await this.api.getRecommendedTracksForPlaylist(c,20,{skipCache:e}),f=await this.filterUserContent(h,"track");f.length>0?this.renderListWithTracks(n,f,!0):n.innerHTML=Kn("No song recommendations found.")}catch(i){console.error(i),n.innerHTML=Kn("Failed to load song recommendations.")}}}async renderHomeAlbums(e=!1,t=null){const n=document.getElementById("home-recommended-albums"),r=n?.closest(".content-section");if(!Vr.shouldShowRecommendedAlbums()){r&&(r.style.display="none");return}if(r&&(r.style.display=""),n){if(e||n.children.length===0)n.innerHTML=this.createSkeletonCards(5);else if(!n.querySelector(".skeleton"))return;try{const c=(t||await this.getSeeds()).find(h=>h.album&&h.album.id);if(c){const h=await this.api.getSimilarAlbums(c.album.id),f=await this.filterUserContent(h,"album");f.length>0?(n.innerHTML=f.slice(0,12).map(g=>this.createAlbumCardHTML(g)).join(""),f.slice(0,12).forEach(g=>{const y=n.querySelector(`[data-album-id="${g.id}"]`);y&&(Hn.set(y,g),this.updateLikeState(y,"album",g.id))})):n.innerHTML=`<div style="grid-column: 1/-1; padding: 2rem 0;">${Kn("Tell us more about what you like so we can recommend albums!")}</div>`}else n.innerHTML=`<div style="grid-column: 1/-1; padding: 2rem 0;">${Kn("Tell us more about what you like so we can recommend albums!")}</div>`}catch(i){console.error(i),n.innerHTML=Kn("Failed to load album recommendations.")}}}createTrackCardHTML(e){const t=xi(e)?this.createExplicitBadge():"",n=Or(e),r=Mr.isCompactAlbum();return this.createBaseCardHTML({type:"track",id:e.id,href:`/track/${e.id}`,title:`${en(Ca(e))} ${t} ${n}`,subtitle:en(wa(e)),imageHTML:this.getCoverHTML(e.album?.videoCover,e.album?.cover,en(e.title)),actionButtonsHTML:`
                <button class="like-btn card-like-btn" data-action="toggle-like" data-type="track" title="Add to Liked">
                    ${this.createHeartIcon(!1)}
                </button>
            `,isCompact:r})}async renderHomeEditorsPicks(e=!1,t="home-editors-picks"){const n=document.getElementById(t);if(n){if(e)n.innerHTML=this.createSkeletonCards(6);else if(n.children.length>0&&!n.querySelector(".skeleton"))return;try{const r=await fetch("/editors-picks.json");if(!r.ok)throw new Error("Failed to load editor's picks");let i=await r.json();if(!Array.isArray(i)||i.length===0){n.innerHTML=Kn("No editor's picks available.");return}const{contentBlockingSettings:c}=await ta(async()=>{const{contentBlockingSettings:g}=await Promise.resolve().then(()=>ya);return{contentBlockingSettings:g}},void 0,import.meta.url);i=i.filter(g=>g.type==="track"?!c.shouldHideTrack(g):g.type==="album"?!c.shouldHideAlbum(g):g.type==="artist"?!c.shouldHideArtist(g):!0),Vr.shouldShuffleEditorsPicks()&&(i=[...i].sort(()=>Math.random()-.5));const h=[],f=[];for(const g of i)try{if(g.type==="album")if(g.title&&g.artist){const y={id:g.id,title:g.title,artist:g.artist,releaseDate:g.releaseDate,cover:g.cover,explicit:g.explicit,audioQuality:g.audioQuality,mediaMetadata:g.mediaMetadata,type:"ALBUM"};h.push(this.createAlbumCardHTML(y)),f.push({el:null,data:y,type:"album"})}else{const y=await this.api.getAlbum(g.id);y&&y.album&&(h.push(this.createAlbumCardHTML(y.album)),f.push({el:null,data:y.album,type:"album"}))}else if(g.type==="artist")if(g.name&&g.picture){const y={id:g.id,name:g.name,picture:g.picture};h.push(this.createArtistCardHTML(y)),f.push({el:null,data:y,type:"artist"})}else{const y=await this.api.getArtist(g.id);y&&(h.push(this.createArtistCardHTML(y)),f.push({el:null,data:y,type:"artist"}))}else if(g.type==="track")if(g.title&&g.album){const y={id:g.id,title:g.title,artist:g.artist,album:g.album,explicit:g.explicit,audioQuality:g.audioQuality,mediaMetadata:g.mediaMetadata,duration:g.duration};h.push(this.createTrackCardHTML(y)),f.push({el:null,data:y,type:"track"})}else{const y=await this.api.getTrackMetadata(g.id);y&&(h.push(this.createTrackCardHTML(y)),f.push({el:null,data:y,type:"track"}))}else if(g.type==="user-playlist")if(g.id&&g.name){const y={id:g.id,name:g.name,cover:g.cover,tracks:g.tracks||[],numberOfTracks:g.numberOfTracks||(g.tracks?g.tracks.length:0)},u=g.username?`by ${g.username}`:null;h.push(this.createUserPlaylistCardHTML(y,u)),f.push({el:null,data:y,type:"user-playlist"})}else{const y=await On.getPublicPlaylist(g.id);if(y){const u=g.username?`by ${g.username}`:null;h.push(this.createUserPlaylistCardHTML(y,u)),f.push({el:null,data:y,type:"user-playlist"})}}}catch(y){console.warn(`Failed to load ${g.type} ${g.id}:`,y)}h.length>0?(n.innerHTML=h.join(""),f.forEach((g,y)=>{const u=g.type,l=g.data.id,d=n.querySelector(`[data-${u}-id="${l}"]`);d&&(Hn.set(d,g.data),this.updateLikeState(d,u,l))})):n.innerHTML=Kn("No editor's picks available.")}catch(r){console.error("Failed to load editor's picks:",r),n.innerHTML=Kn("Failed to load editor's picks.")}}}async renderHomeArtists(e=!1,t=null){const n=document.getElementById("home-recommended-artists"),r=n?.closest(".content-section");if(!Vr.shouldShowRecommendedArtists()){r&&(r.style.display="none");return}if(r&&(r.style.display=""),n){if(e||n.children.length===0)n.innerHTML=this.createSkeletonCards(12,!0);else if(!n.querySelector(".skeleton"))return;try{const c=(t||await this.getSeeds()).find(f=>f.artist&&f.artist.id||f.artists&&f.artists.length>0),h=c?c.artist?.id||c.artists?.[0]?.id:null;if(h){const f=await this.api.getSimilarArtists(h),g=await this.filterUserContent(f,"artist");g.length>0?(n.innerHTML=g.slice(0,12).map(y=>this.createArtistCardHTML(y)).join(""),g.slice(0,12).forEach(y=>{const u=n.querySelector(`[data-artist-id="${y.id}"]`);u&&(Hn.set(u,y),this.updateLikeState(u,"artist",y.id))})):n.innerHTML=Kn("No artist recommendations found.")}else n.innerHTML=Kn("Listen to more music to get artist recommendations.")}catch(i){console.error(i),n.innerHTML=Kn("Failed to load artist recommendations.")}}}renderHomeRecent(){const e=document.getElementById("home-recent-mixed"),t=e?.closest(".content-section");if(!Vr.shouldShowJumpBackIn()){t&&(t.style.display="none");return}if(t&&(t.style.display=""),e){const n=Nr.getRecents(),r=[];n.albums&&r.push(...n.albums.slice(0,4).map(c=>({...c,_kind:"album"}))),n.playlists&&r.push(...n.playlists.slice(0,4).map(c=>({...c,_kind:"playlist"}))),n.mixes&&r.push(...n.mixes.slice(0,4).map(c=>({...c,_kind:"mix"}))),r.sort(()=>Math.random()-.5);const i=r.slice(0,6);i.length>0?(e.innerHTML=i.map(c=>c._kind==="album"?this.createAlbumCardHTML(c):c._kind==="playlist"?c.isUserPlaylist?this.createUserPlaylistCardHTML(c):this.createPlaylistCardHTML(c):c._kind==="mix"?this.createMixCardHTML(c):"").join(""),i.forEach(c=>{let h="";c._kind==="album"?h=`[data-album-id="${c.id}"]`:c._kind==="playlist"?h=c.isUserPlaylist?`[data-user-playlist-id="${c.id}"]`:`[data-playlist-id="${c.uuid}"]`:c._kind==="mix"&&(h=`[data-mix-id="${c.id}"]`);const f=e.querySelector(h);f&&(Hn.set(f,c),c._kind==="album"&&this.updateLikeState(f,"album",c.id),c._kind==="playlist"&&!c.isUserPlaylist&&this.updateLikeState(f,"playlist",c.uuid),c._kind==="mix"&&this.updateLikeState(f,"mix",c.id))})):e.innerHTML=Kn("No recent items yet...")}}async filterUserContent(e,t){if(!e||e.length===0)return[];const{contentBlockingSettings:n}=await ta(async()=>{const{contentBlockingSettings:g}=await Promise.resolve().then(()=>ya);return{contentBlockingSettings:g}},void 0,import.meta.url);t==="track"?e=n.filterTracks(e):t==="album"?e=n.filterAlbums(e):t==="artist"&&(e=n.filterArtists(e));const r=await nn.getFavorites(t),i=new Set(r.map(g=>g.id)),c=await nn.getFavorites("track"),h=await nn.getPlaylists(!0),f=new Map;if(c.forEach(g=>f.set(g.id,g)),h.forEach(g=>{g.tracks&&g.tracks.forEach(y=>f.set(y.id,y))}),t==="track")return e.filter(g=>!f.has(g.id));if(t==="album"){const g=new Map;for(const y of f.values())if(y.album&&y.album.id){const u=y.album.id;g.set(u,(g.get(u)||0)+1)}return e.filter(y=>{if(i.has(y.id))return!1;const u=g.get(y.id)||0,l=y.numberOfTracks;return!(l&&l>0&&u/l>.5)})}return e.filter(g=>!i.has(g.id))}async renderSearchPage(e){this.showPage("search"),document.getElementById("search-results-title").textContent=`Search Results for "${e}"`;const t=document.getElementById("search-tracks-container"),n=document.getElementById("search-artists-container"),r=document.getElementById("search-albums-container"),i=document.getElementById("search-playlists-container");t.innerHTML=this.createSkeletonTracks(8,!0),n.innerHTML=this.createSkeletonCards(6,!0),r.innerHTML=this.createSkeletonCards(6,!1),i.innerHTML=this.createSkeletonCards(6,!1),this.searchAbortController&&this.searchAbortController.abort(),this.searchAbortController=new AbortController;const c=this.searchAbortController.signal;try{const h=this.api.getCurrentProvider(),[f,g,y,u]=await Promise.all([this.api.searchTracks(e,{signal:c,provider:h}),this.api.searchArtists(e,{signal:c,provider:h}),this.api.searchAlbums(e,{signal:c,provider:h}),this.api.searchPlaylists(e,{signal:c,provider:h})]);let l=f.items,d=g.items,m=y.items,E=u.items;if(d.length===0&&l.length>0){const _=new Map;l.forEach(M=>{M.artist&&!_.has(M.artist.id)&&_.set(M.artist.id,M.artist),M.artists&&M.artists.forEach(R=>{_.has(R.id)||_.set(R.id,R)})}),d=Array.from(_.values())}if(m.length===0&&l.length>0){const _=new Map;l.forEach(M=>{M.album&&!_.has(M.album.id)&&_.set(M.album.id,M.album)}),m=Array.from(_.values())}const S=l.length+d.length+m.length+E.length;jp(e,S),l.length?this.renderListWithTracks(t,l,!0):t.innerHTML=Kn("No tracks found."),n.innerHTML=d.length?d.map(_=>this.createArtistCardHTML(_)).join(""):Kn("No artists found."),d.forEach(_=>{const M=n.querySelector(`[data-artist-id="${_.id}"]`);M&&(Hn.set(M,_),this.updateLikeState(M,"artist",_.id))}),r.innerHTML=m.length?m.map(_=>this.createAlbumCardHTML(_)).join(""):Kn("No albums found."),m.forEach(_=>{const M=r.querySelector(`[data-album-id="${_.id}"]`);M&&(Hn.set(M,_),this.updateLikeState(M,"album",_.id))}),i.innerHTML=E.length?E.map(_=>this.createPlaylistCardHTML(_)).join(""):Kn("No playlists found."),E.forEach(_=>{const M=i.querySelector(`[data-playlist-id="${_.uuid}"]`);M&&(Hn.set(M,_),this.updateLikeState(M,"playlist",_.uuid))})}catch(h){if(h.name==="AbortError")return;console.error("Search failed:",h);const f=Kn(`Error during search. ${h.message}`);t.innerHTML=f,n.innerHTML=f,r.innerHTML=f,i.innerHTML=f}}renderSearchHistory(){const e=document.getElementById("search-history");if(!e)return;const t=JSON.parse(localStorage.getItem("search-history")||"[]");if(t.length===0){e.style.display="none";return}e.innerHTML=t.map(r=>`
            <div class="search-history-item" data-query="${en(r)}">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="history-icon">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                <span class="query-text">${en(r)}</span>
                <span class="delete-history-btn" title="Remove from history">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </span>
            </div>
        `).join("")+`
            <div class="search-history-clear-all" id="clear-search-history">
                Clear all history
            </div>
        `,e.style.display="block",e.querySelectorAll(".search-history-item").forEach(r=>{r.addEventListener("click",i=>{if(i.target.closest(".delete-history-btn")){i.stopPropagation(),this.removeFromSearchHistory(r.dataset.query);return}const c=r.dataset.query,h=document.getElementById("search-input");h&&(h.value=c,h.dispatchEvent(new Event("input")),e.style.display="none")})});const n=document.getElementById("clear-search-history");n&&n.addEventListener("click",r=>{r.preventDefault(),r.stopPropagation(),localStorage.removeItem("search-history"),this.renderSearchHistory()})}removeFromSearchHistory(e){let t=JSON.parse(localStorage.getItem("search-history")||"[]");t=t.filter(n=>n!==e),localStorage.setItem("search-history",JSON.stringify(t)),this.renderSearchHistory()}addToSearchHistory(e){if(!e||e.trim().length===0)return;let t=JSON.parse(localStorage.getItem("search-history")||"[]");t=t.filter(n=>n!==e),t.unshift(e),t=t.slice(0,10),localStorage.setItem("search-history",JSON.stringify(t))}async renderAlbumPage(e,t=null){this.showPage("album");const n=document.getElementById("album-detail-image"),r=document.getElementById("album-detail-title"),i=document.getElementById("album-detail-meta"),c=document.getElementById("album-detail-producer"),h=document.getElementById("album-detail-tracklist"),f=document.getElementById("play-album-btn");f&&(f.innerHTML=`${cr}<span>Play Album</span>`);const g=document.getElementById("download-album-btn");g&&(g.innerHTML=`${Ui}<span>Download Album</span>`);const y=document.getElementById("album-mix-btn");y&&(y.style.display="none"),n.src="",n.style.backgroundColor="var(--muted)",r.innerHTML='<div class="skeleton" style="height: 48px; width: 300px; max-width: 90%;"></div>',i.innerHTML='<div class="skeleton" style="height: 16px; width: 200px; max-width: 80%;"></div>',c.innerHTML='<div class="skeleton" style="height: 16px; width: 200px; max-width: 80%;"></div>',h.innerHTML=`
            <div class="track-list-header">
                <span style="width: 40px; text-align: center;">#</span>
                <span>Title</span>
                <span class="duration-header">Duration</span>
                <span style="display: flex; justify-content: flex-end; opacity: 0.8;">Menu</span>
            </div>
            ${this.createSkeletonTracks(10,!1)}
        `;try{const{album:u,tracks:l}=await this.api.getAlbum(e,t),d=u.videoCover?this.api.tidalAPI.getVideoCoverUrl(u.videoCover):null,m=d||this.api.getCoverUrl(u.cover);if(d)if(n.tagName==="IMG"){const we=document.createElement("video");we.src=d,we.autoplay=!0,we.loop=!0,we.muted=!0,we.playsInline=!0,we.className=n.className,we.id=n.id,n.replaceWith(we)}else n.src=d;else if(n.tagName==="VIDEO"){const we=document.createElement("img");we.src=m,we.className=n.className,we.id=n.id,n.replaceWith(we)}else n.src=m;n.style.backgroundColor="",this.setPageBackground(m),Di.isEnabled()&&u.cover&&this.extractAndApplyColor(this.api.getCoverUrl(u.cover,"80"));const E=xi(u)?this.createExplicitBadge():"";r.innerHTML=`${en(u.title)} ${E}`,this.adjustTitleFontSize(r,u.title);const S=Ci(l);let _="";if(u.releaseDate){const we=new Date(u.releaseDate);if(!isNaN(we.getTime())){const ce=we.getFullYear();_=window.innerWidth>768?we.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):ce}}const M=l.find(we=>we.copyright)?.copyright;i.innerHTML=(_?`${_} â€¢ `:"")+`${l.length} tracks â€¢ ${Li(S)}`,c.innerHTML=`By <a href="/artist/${u.artist.id}">${u.artist.name}</a>`+(M?` â€¢ ${M}`:""),h.innerHTML=`
                <div class="track-list-header">
                    <span style="width: 40px; text-align: center;">#</span>
                    <span>Title</span>
                    <span class="duration-header">Duration</span>
                    <span style="display: flex; justify-content: flex-end; opacity: 0.8;">Menu</span>
                </div>
            `,l.sort((we,ce)=>{const he=we.volumeNumber??we.discNumber??1,Pe=ce.volumeNumber??ce.discNumber??1;return he!==Pe?he-Pe:we.trackNumber-ce.trackNumber}),this.renderListWithTracks(h,l,!1,!0),Nr.addAlbum(u);const R=document.getElementById("like-album-btn");if(R){const we=await nn.isFavorite("album",u.id);R.innerHTML=this.createHeartIcon(we),R.classList.toggle("active",we)}document.title=`${u.title} - ${u.artist.name}`;const W=document.getElementById("album-section-more-albums"),fe=document.getElementById("album-detail-more-albums"),ye=document.getElementById("album-title-more-albums"),Y=document.getElementById("album-section-eps"),j=document.getElementById("album-detail-eps"),se=document.getElementById("album-title-eps"),Te=document.getElementById("album-section-similar-artists"),Ae=document.getElementById("album-detail-similar-artists"),ze=document.getElementById("album-section-similar-albums"),de=document.getElementById("album-detail-similar-albums");[W,Y,Te,ze].forEach(we=>{we&&(we.style.display="none")});try{const we=await this.api.getArtist(u.artist.id),ce=document.getElementById("album-mix-btn");ce&&we.mixes&&we.mixes.ARTIST_MIX&&(ce.style.display="flex",ce.onclick=()=>Bn(`/mix/${we.mixes.ARTIST_MIX}`));const he=(Pe,$e,He,et,Ve)=>{if(!$e||!He)return;const Et=(Pe||[]).filter(Nt=>Nt.id!=u.id).filter((Nt,$t,Ie)=>$t===Ie.findIndex(pe=>pe.title===Nt.title)).slice(0,12);Et.length!==0&&($e.innerHTML=Et.map(Nt=>this.createAlbumCardHTML(Nt)).join(""),et&&Ve&&(et.textContent=Ve),He.style.display="block",Et.forEach(Nt=>{const $t=$e.querySelector(`[data-album-id="${Nt.id}"]`);$t&&(Hn.set($t,Nt),this.updateLikeState($t,"album",Nt.id))}))};he(we.albums,fe,W,ye,`More albums from ${u.artist.name}`),he(we.eps,j,Y,se,`EPs and Singles from ${u.artist.name}`),this.api.getSimilarArtists(u.artist.id).then(async Pe=>{const{contentBlockingSettings:$e}=await ta(async()=>{const{contentBlockingSettings:et}=await Promise.resolve().then(()=>ya);return{contentBlockingSettings:et}},void 0,import.meta.url),He=$e.filterArtists(Pe||[]);He.length>0&&Ae&&Te&&(Ae.innerHTML=He.map(et=>this.createArtistCardHTML(et)).join(""),Te.style.display="block",He.forEach(et=>{const Ve=Ae.querySelector(`[data-artist-id="${et.id}"]`);Ve&&(Hn.set(Ve,et),this.updateLikeState(Ve,"artist",et.id))}))}).catch(Pe=>console.warn("Failed to load similar artists:",Pe)),this.api.getSimilarAlbums(e).then(async Pe=>{const{contentBlockingSettings:$e}=await ta(async()=>{const{contentBlockingSettings:et}=await Promise.resolve().then(()=>ya);return{contentBlockingSettings:et}},void 0,import.meta.url),He=$e.filterAlbums(Pe||[]);He.length>0&&de&&ze&&(de.innerHTML=He.map(et=>this.createAlbumCardHTML(et)).join(""),ze.style.display="block",He.forEach(et=>{const Ve=de.querySelector(`[data-album-id="${et.id}"]`);Ve&&(Hn.set(Ve,et),this.updateLikeState(Ve,"album",et.id))}))}).catch(Pe=>console.warn("Failed to load similar albums:",Pe))}catch(we){console.warn('Failed to load "More from artist":',we)}}catch(u){console.error("Failed to load album:",u),h.innerHTML=Kn(`Could not load album details. ${u.message}`)}}async loadRecommendedSongsForPlaylist(e,t=!1){const n=document.getElementById("playlist-section-recommended"),r=document.getElementById("playlist-detail-recommended");if(!n||!r){console.warn("Recommended songs section not found in DOM");return}t&&(r.innerHTML=this.createSkeletonTracks(5,!0));try{let i=await this.api.getRecommendedTracksForPlaylist(e,20,{refresh:t});const{contentBlockingSettings:c}=await ta(async()=>{const{contentBlockingSettings:h}=await Promise.resolve().then(()=>ya);return{contentBlockingSettings:h}},void 0,import.meta.url);i=c.filterTracks(i),i.length>0?(this.renderListWithTracks(r,i,!0),r.querySelectorAll(".track-item").forEach(f=>{const g=f.querySelector(".track-item-actions");if(g){const y=document.createElement("button");y.className="track-action-btn add-to-playlist-btn",y.title="Add to this playlist",y.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14"/><path d="M5 12h14"/></svg>',y.onclick=async l=>{l.stopPropagation();const d=Hn.get(f);if(d)try{const E=window.location.pathname.match(/\/userplaylist\/([^/]+)/);if(E){const S=E[1];await nn.addTrackToPlaylist(S,d);const _=await nn.getPlaylist(S);On.syncUserPlaylist(_,"update");const M=document.getElementById("playlist-detail-tracklist");if(M&&_.tracks){M.innerHTML=`
                                                                                                                                                <div class="track-list-header">
                                                                                                                                                    <span style="width: 40px; text-align: center;">#</span>
                                                                                                                                                    <span>Title</span>
                                                                                                                                                    <span class="duration-header">Duration</span>
                                                                                                                                                    <span style="display: flex; justify-content: flex-end; opacity: 0.8;">Menu</span>
                                                                                                                                                </div>                                            `,this.renderListWithTracks(M,_.tracks,!0),document.querySelector(".remove-from-playlist-btn")&&this.enableTrackReordering(M,_.tracks,S,On);const R=document.getElementById("playlist-detail-meta");if(R){const W=Ci(_.tracks);R.textContent=`${_.tracks.length} tracks â€¢ ${Li(W)}`}}Dn(`Added "${d.title}" to playlist`)}}catch(m){console.error("Failed to add track to playlist:",m),Dn("Failed to add track to playlist")}};const u=g.querySelector(".track-menu-btn");u?g.insertBefore(y,u):g.appendChild(y)}}),n.style.display="block"):n.style.display="none"}catch(i){console.error("Failed to load recommended songs:",i),n.style.display="none"}}async renderPlaylistPage(e,t=null,n=null){this.showPage("playlist");const r=document.getElementById("track-list-search-input");r&&(r.value="");const i=document.getElementById("playlist-detail-image"),c=document.getElementById("playlist-detail-collage"),h=document.getElementById("playlist-detail-title"),f=document.getElementById("playlist-detail-meta"),g=document.getElementById("playlist-detail-description"),y=document.getElementById("playlist-detail-tracklist"),u=document.getElementById("play-playlist-btn");u&&(u.innerHTML=`${cr}<span>Play</span>`);const l=document.getElementById("download-playlist-btn");l&&(l.innerHTML=`${Ui}<span>Download</span>`);const d=document.getElementById("add-playlist-to-playlist-btn");i.src="",i.style.backgroundColor="var(--muted)",h.innerHTML='<div class="skeleton" style="height: 48px; width: 300px; max-width: 90%;"></div>',f.innerHTML='<div class="skeleton" style="height: 16px; width: 200px; max-width: 80%;"></div>',g.innerHTML='<div class="skeleton" style="height: 16px; width: 100%;"></div>',y.innerHTML=`
            <div class="track-list-header">
                <span style="width: 40px; text-align: center;">#</span>
                <span>Title</span>
                <span class="duration-header">Duration</span>
                <span style="display: flex; justify-content: flex-end; opacity: 0.8;">Menu</span>
            </div>
            ${this.createSkeletonTracks(10,!0)}
        `;try{const m=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e);let E=null,S=null,_="custom";if((t==="user"||!t&&m)&&(S=await nn.getPlaylist(e),E=S,!E))try{E=await On.getPublicPlaylist(e)}catch(M){console.warn("Failed to check public pocketbase playlists:",M)}if(E){if(d&&(d.style.display="none"),E.cover)i.src=E.cover,i.style.display="block",c&&(c.style.display="none"),this.setPageBackground(E.cover),this.extractAndApplyColor(E.cover);else{const de=(E.tracks||[]).filter(he=>he.album&&he.album.cover),we=[],ce=new Set;for(const he of de)if(!ce.has(he.album.cover)&&(ce.add(he.album.cover),we.push(he.album.cover),we.length>=4))break;if(we.length>0&&c){i.style.display="none",c.style.display="grid",c.innerHTML="";const he=[];for(let Pe=0;Pe<4;Pe++)he.push(we[Pe%we.length]);he.forEach(Pe=>{const $e=document.createElement("img");$e.src=this.api.getCoverUrl(Pe),c.appendChild($e)})}else i.src="/assets/appicon.png",i.style.display="block",c&&(c.style.display="none");this.setPageBackground(null),this.resetVibrantColor()}h.textContent=E.name||E.title,this.adjustTitleFontSize(h,h.textContent);const M=E.tracks||[],R=Ci(M);f.textContent=`${M.length} tracks â€¢ ${Li(R)}`,g.textContent=E.description||"";const W=[...M];_=localStorage.getItem(`playlist-sort-${e}`)||"custom";let ye=Ts(W,_);const Y=()=>{const de=document.getElementById("playlist-detail-tracklist");de.innerHTML=`
                        <div class="track-list-header">
                            <span style="width: 40px; text-align: center;">#</span>
                            <span>Title</span>
                            <span class="duration-header">Duration</span>
                            <span style="display: flex; justify-content: flex-end; opacity: 0.8;">Menu</span>
                        </div>
                    `,this.renderListWithTracks(de,ye,!0,!0),S?(de.querySelectorAll(".track-item").forEach((ce,he)=>{const Pe=ce.querySelector(".track-item-actions"),$e=document.createElement("button");$e.className="track-action-btn remove-from-playlist-btn",$e.title="Remove from playlist",$e.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>',$e.dataset.trackId=ye[he].id;const He=Pe.querySelector(".track-menu-btn");Pe.insertBefore($e,He)}),de.classList.add("is-editable"),_==="custom"&&this.enableTrackReordering(de,ye,e,On)):de.classList.remove("is-editable")},j=de=>{_=de,localStorage.setItem(`playlist-sort-${e}`,de),ye=Ts(W,de),Y()};Y();const se=document.getElementById("like-playlist-btn");if(se&&(se.style.display="none"),S){this.loadRecommendedSongsForPlaylist(M);const de=document.getElementById("refresh-recommended-songs-btn");de&&(de.onclick=async()=>{const we=de.querySelector("svg");we&&(we.style.animation="spin 1s linear infinite"),de.disabled=!0,await this.loadRecommendedSongsForPlaylist(M,!0),we&&(we.style.animation=""),de.disabled=!1})}this.updatePlaylistHeaderActions(E,!!S,ye,!1,j,()=>_),u.onclick=()=>{this.player.setQueue(ye,0),this.player.playTrackFromQueue()};const Te=[],Ae=new Set,ze=E.tracks||[];for(const de of ze){const we=de.album?.cover;if(we&&!Ae.has(we)&&(Ae.add(we),Te.push(we),Te.length>=4))break}Nr.addPlaylist({id:E.id||E.uuid,name:E.name||E.title,title:E.title||E.name,uuid:E.uuid||E.id,cover:E.cover,images:Te,numberOfTracks:E.tracks?E.tracks.length:0,isUserPlaylist:!0}),document.title=`${E.name||E.title} - Monochrome`,this.setupTracklistSearch()}else{if(d&&(d.style.display="flex"),t==="user")throw new Error("Playlist not found. If this is a custom playlist, make sure it is set to Public.");let M=await this.api.getPlaylist(e);const{playlist:R,tracks:W}=M,fe=R.squareImage||R.image;fe?(i.src=this.api.getCoverUrl(fe,"1080"),this.setPageBackground(i.src),this.extractAndApplyColor(this.api.getCoverUrl(fe,"160"))):(i.src="/assets/appicon.png",this.setPageBackground(null),this.resetVibrantColor()),h.textContent=R.title,this.adjustTitleFontSize(h,R.title);const ye=Ci(W);f.textContent=`${R.numberOfTracks} tracks â€¢ ${Li(ye)}`,g.textContent=R.description||"";const Y=[...W];let se=localStorage.getItem(`playlist-sort-${e}`)||"custom",Te=Ts(Y,se);const Ae=()=>{y.innerHTML=`
                        <div class="track-list-header">
                            <span style="width: 40px; text-align: center;">#</span>
                            <span>Title</span>
                            <span class="duration-header">Duration</span>
                            <span style="display: flex; justify-content: flex-end; opacity: 0.8;">Menu</span>
                        </div>
                    `,this.renderListWithTracks(y,Te,!0,!0)},ze=he=>{se=he,localStorage.setItem(`playlist-sort-${e}`,he),Te=Ts(Y,he),Ae()};Ae(),u.onclick=()=>{this.player.setQueue(Te,0),this.player.playTrackFromQueue()};const de=document.getElementById("like-playlist-btn");if(de){const he=await nn.isFavorite("playlist",R.uuid);de.innerHTML=this.createHeartIcon(he),de.classList.toggle("active",he),de.style.display="flex"}const we=document.getElementById("delete-playlist-btn");we&&(we.style.display="none");const ce=document.getElementById("playlist-section-recommended");ce&&(ce.style.display="none"),this.updatePlaylistHeaderActions(R,!1,Te,!1,ze,()=>se),Nr.addPlaylist(R),document.title=R.title||"Artist Mix"}this.setupTracklistSearch()}catch(m){console.error("Failed to load playlist:",m),y.innerHTML=Kn(`Could not load playlist details. ${m.message}`)}}async renderFolderPage(e){this.showPage("folder");const t=document.getElementById("folder-detail-image"),n=document.getElementById("folder-detail-title"),r=document.getElementById("folder-detail-meta"),i=document.getElementById("folder-detail-container");t.src="",t.style.backgroundColor="var(--muted)",n.innerHTML='<div class="skeleton" style="height: 48px; width: 300px; max-width: 90%;"></div>',i.innerHTML=this.createSkeletonCards(4,!1);try{const c=await nn.getFolder(e);if(!c)throw new Error("Folder not found");if(t.src=c.cover||"/assets/folder.png",t.onerror=()=>{t.src="/assets/folder.png"},t.style.backgroundColor="",n.textContent=c.name,r.textContent=`Created ${new Date(c.createdAt).toLocaleDateString()}`,this.setPageBackground(null),this.resetVibrantColor(),c.playlists?.length>0){const h=c.playlists.map(g=>nn.getPlaylist(g)),f=(await Promise.all(h)).filter(Boolean);f.length>0?(i.innerHTML=f.map(g=>this.createUserPlaylistCardHTML(g)).join(""),f.forEach(g=>{const y=i.querySelector(`[data-user-playlist-id="${g.id}"]`);y&&Hn.set(y,g)})):i.innerHTML=Kn("This folder is empty. Some playlists may have been deleted.")}else i.innerHTML=Kn("This folder is empty. Drag a playlist here to add it.")}catch(c){console.error("Failed to load folder:",c),i.innerHTML=Kn("Folder not found.")}}async renderMixPage(e,t=null){this.showPage("mix");const n=document.getElementById("mix-detail-image"),r=document.getElementById("mix-detail-title"),i=document.getElementById("mix-detail-meta"),c=document.getElementById("mix-detail-description"),h=document.getElementById("mix-detail-tracklist"),f=document.getElementById("play-mix-btn");f&&(f.innerHTML=`${cr}<span>Play</span>`);const g=document.getElementById("download-mix-btn");g&&(g.innerHTML=`${Ui}<span>Download</span>`),n.src="",n.style.backgroundColor="var(--muted)",r.innerHTML='<div class="skeleton" style="height: 48px; width: 300px; max-width: 90%;"></div>',i.innerHTML='<div class="skeleton" style="height: 16px; width: 200px; max-width: 80%;"></div>',c.innerHTML='<div class="skeleton" style="height: 16px; width: 100%;"></div>',h.innerHTML=`
            <div class="track-list-header">
                <span style="width: 40px; text-align: center;">#</span>
                <span>Title</span>
                <span class="duration-header">Duration</span>
                <span style="display: flex; justify-content: flex-end; opacity: 0.8;">Menu</span>
            </div>
            ${this.createSkeletonTracks(10,!0)}
        `;try{const{mix:y,tracks:u}=await this.api.getMix(e,t);if(y.cover)n.src=y.cover,this.setPageBackground(y.cover),this.extractAndApplyColor(y.cover);else if(u.length>0&&u[0].album?.cover){const E=u[0].album?.videoCover?this.api.tidalAPI.getVideoCoverUrl(u[0].album.videoCover):null,S=E||this.api.getCoverUrl(u[0].album.cover);if(E)if(n.tagName==="IMG"){const _=document.createElement("video");_.src=E,_.autoplay=!0,_.loop=!0,_.muted=!0,_.playsInline=!0,_.className=n.className,_.id=n.id,n.replaceWith(_)}else n.src=E;else if(n.tagName==="VIDEO"){const _=document.createElement("img");_.src=S,_.className=n.className,_.id=n.id,n.replaceWith(_)}else n.src=S;this.setPageBackground(S),this.extractAndApplyColor(this.api.getCoverUrl(u[0].album.cover,"160"))}else n.src="/assets/appicon.png",this.setPageBackground(null),this.resetVibrantColor();n.style.backgroundColor="";const l=y.title||"Mix";r.textContent=l,this.adjustTitleFontSize(r,l);const d=Ci(u);i.textContent=`${u.length} tracks â€¢ ${Li(d)}`,c.innerHTML=`${y.subTitle}`,h.innerHTML=`
                <div class="track-list-header">
                    <span style="width: 40px; text-align: center;">#</span>
                    <span>Title</span>
                    <span class="duration-header">Duration</span>
                    <span style="display: flex; justify-content: flex-end; opacity: 0.8;">Menu</span>
                </div>
            `,this.renderListWithTracks(h,u,!0,!0),f.onclick=()=>{this.player.setQueue(u,0),this.player.playTrackFromQueue()},Nr.addMix(y);const m=document.getElementById("like-mix-btn");if(m){m.style.display="flex";const E=await nn.isFavorite("mix",y.id);m.innerHTML=this.createHeartIcon(E),m.classList.toggle("active",E)}document.title=l}catch(y){console.error("Failed to load mix:",y),h.innerHTML=Kn(`Could not load mix details. ${y.message}`)}}async renderArtistPage(e,t=null){this.showPage("artist");const n=document.getElementById("artist-detail-image"),r=document.getElementById("artist-detail-name"),i=document.getElementById("artist-detail-meta"),c=document.getElementById("artist-detail-socials"),h=document.getElementById("artist-detail-bio"),f=document.getElementById("artist-detail-tracks"),g=document.getElementById("artist-detail-albums"),y=document.getElementById("artist-detail-eps"),u=document.getElementById("artist-section-eps"),l=document.getElementById("artist-detail-similar"),d=document.getElementById("artist-section-similar"),m=document.getElementById("download-discography-btn");m&&(m.innerHTML=`${Ui}<span>Download Discography</span>`),n.src="",n.style.backgroundColor="var(--muted)",r.innerHTML='<div class="skeleton" style="height: 48px; width: 300px; max-width: 90%;"></div>',i.innerHTML='<div class="skeleton" style="height: 16px; width: 150px;"></div>',c&&(c.innerHTML=""),h&&(h.style.display="none",h.textContent="",h.classList.remove("expanded")),f.innerHTML=this.createSkeletonTracks(5,!0),g.innerHTML=this.createSkeletonCards(6,!1),y&&(y.innerHTML=this.createSkeletonCards(6,!1)),u&&(u.style.display="none");const E=document.getElementById("artist-section-load-unreleased");E&&(E.style.display="none"),l&&(l.innerHTML=this.createSkeletonCards(6,!0)),d&&(d.style.display="block");try{const S=await this.api.getArtist(e,t);if(h){const j=["artist","album","track","playlist"],se={wimp:j.reduce((we,ce)=>(we[ce]=new RegExp(`\\[wimpLink ${ce}Id="([a-f\\d-]+)"\\](.*?)\\[\\/wimpLink\\]`,"g"),we),{}),legacy:j.reduce((we,ce)=>(we[ce]=new RegExp(`\\[${ce}:([a-f\\d-]+)\\](.*?)\\[\\/${ce}\\]`,"g"),we),{}),doubleBracket:/\[\[(.*?)\|(.*?)\]\]/g},Te=we=>{if(!we)return"";let ce=we;return j.forEach(he=>{ce=ce.replace(se.wimp[he],(Pe,$e,He)=>`<span class="bio-link" data-type="${he}" data-id="${$e}">${He}</span>`),ce=ce.replace(se.legacy[he],(Pe,$e,He)=>`<span class="bio-link" data-type="${he}" data-id="${$e}">${He}</span>`)}),ce=ce.replace(se.doubleBracket,(he,Pe,$e)=>`<span class="bio-link" data-type="artist" data-id="${$e}">${Pe}</span>`),ce.replace(/\n/g,"<br>")},Ae=we=>{if(!we)return"";let ce=we;return j.forEach(he=>{ce=ce.replace(se.wimp[he],(Pe,$e,He)=>He),ce=ce.replace(se.legacy[he],(Pe,$e,He)=>He)}),ce=ce.replace(se.doubleBracket,(he,Pe,$e)=>Pe),ce},ze=we=>{const ce=typeof we=="string"?we:we.text,he=typeof we=="string"?null:we.source,Pe=document.createElement("div");Pe.className="modal active bio-modal",Pe.style.zIndex="9999",Pe.innerHTML=`
                        <div class="modal-overlay"></div>
                        <div class="modal-content extra-wide" style="display: flex; flex-direction: column;">
                            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; border-bottom: 1px solid var(--border); padding-bottom: 1rem;">
                                <h3 style="margin: 0;">Artist Biography</h3>
                                <button class="btn-close" style="background: none; border: none; font-size: 2rem; cursor: pointer; color: var(--foreground); padding: 0.2rem 0.5rem; line-height: 1;">&times;</button>
                            </div>
                            <div class="modal-body" style="max-height: 70vh; overflow-y: auto; line-height: 1.8; font-size: 1.1rem; padding-right: 1rem; color: var(--foreground); cursor: default;">
                                ${Te(ce)}
                                ${he?`<div class="bio-source">Source: ${he}</div>`:""}
                            </div>
                        </div>
                    `,document.body.appendChild(Pe);const $e=et=>{et&&(et.preventDefault(),et.stopPropagation()),Pe.remove()};Pe.querySelector(".modal-overlay").onclick=$e,Pe.querySelector(".btn-close").onclick=$e,Pe.querySelector(".modal-body").addEventListener("click",et=>{const Ve=et.target.closest(".bio-link");if(Ve){et.preventDefault(),et.stopPropagation();const{type:Et,id:Nt}=Ve.dataset;Et&&Nt&&(Pe.remove(),Bn(`/${Et}/t/${Nt}`))}},!0)},de=we=>{const ce=typeof we=="string"?we:we.text;if(ce){const he=Ae(ce),Pe=he.length>200,$e=Pe?he.substring(0,200).trim()+"...":he;if(h.innerHTML=$e.replace(/\n/g,"<br>"),h.style.display="block",h.style.webkitLineClamp="unset",h.style.cursor="default",h.onclick=null,Pe){h.appendChild(document.createElement("br"));const He=document.createElement("span");He.className="bio-read-more",He.textContent="Read More",He.onclick=et=>{et.preventDefault(),et.stopPropagation(),ze(we)},h.appendChild(He)}}else h.style.display="none"};S.biography?de(S.biography):this.api.getArtistBiography(e,t).then(we=>{we&&de(we)}).catch(()=>{})}const _=document.getElementById("artist-mix-btn");_&&(S.mixes&&S.mixes.ARTIST_MIX?(_.style.display="flex",_.onclick=()=>Bn(`/mix/${S.mixes.ARTIST_MIX}`)):_.style.display="none"),l&&d&&this.api.getSimilarArtists(e).then(async j=>{const{contentBlockingSettings:se}=await ta(async()=>{const{contentBlockingSettings:Ae}=await Promise.resolve().then(()=>ya);return{contentBlockingSettings:Ae}},void 0,import.meta.url),Te=se.filterArtists(j||[]);Te.length>0?(l.innerHTML=Te.map(Ae=>this.createArtistCardHTML(Ae)).join(""),d.style.display="block",Te.forEach(Ae=>{const ze=l.querySelector(`[data-artist-id="${Ae.id}"]`);ze&&(Hn.set(ze,Ae),this.updateLikeState(ze,"artist",Ae.id))})):d.style.display="none"}).catch(()=>{d.style.display="none"}),n.src=this.api.getArtistPictureUrl(S.picture),n.style.backgroundColor="",r.textContent=S.name,this.setPageBackground(n.src);const M=this.api.getArtistPictureUrl(S.picture,"160");this.extractAndApplyColor(M),this.adjustTitleFontSize(r,S.name),i.innerHTML=`
                <span>${S.popularity}% popularity</span>
                <div class="artist-tags">
                    ${(S.artistRoles||[]).filter(j=>j.category).map(j=>`<span class="artist-tag">${j.category}</span>`).join("")}
                </div>
            `,this.api.getArtistSocials(S.name).then(j=>{c&&j.length>0&&(c.innerHTML=j.map(se=>this.createSocialLinkHTML(se)).join(""))}),this.renderListWithTracks(f,S.tracks,!0);const R=document.getElementById("like-artist-btn");if(R){const j=await nn.isFavorite("artist",S.id);R.innerHTML=this.createHeartIcon(j),R.classList.toggle("active",j)}g.innerHTML=S.albums.length?S.albums.map(j=>this.createAlbumCardHTML(j)).join(""):Kn("No albums found."),y&&u&&(S.eps&&S.eps.length>0?(y.innerHTML=S.eps.map(j=>this.createAlbumCardHTML(j)).join(""),u.style.display="block",S.eps.forEach(j=>{const se=y.querySelector(`[data-album-id="${j.id}"]`);se&&(Hn.set(se,j),this.updateLikeState(se,"album",j.id))})):u.style.display="none"),S.albums.forEach(j=>{const se=g.querySelector(`[data-album-id="${j.id}"]`);se&&(Hn.set(se,j),this.updateLikeState(se,"album",j.id))});const W=document.getElementById("artist-section-unreleased"),fe=document.getElementById("artist-detail-unreleased"),ye=document.getElementById("load-unreleased-btn"),Y=document.getElementById("artist-section-load-unreleased");W&&fe&&ye&&Y&&(W.style.display="none",Y.style.display="none",Ff(S.name)&&(Y.style.display="block",ye.onclick=async()=>{ye.disabled=!0,ye.textContent="Loading...";try{const se=await Xb(S.name);if(se&&se.eras.length>0){const{artist:Te,sheetId:Ae,eras:ze}=se;fe.innerHTML=ze.map(we=>{let ce=0;return we.data&&Object.values(we.data).forEach(he=>{he&&he.length&&(ce+=he.length)}),Ws(we,Te,Ae,ce)}).join(""),W.style.display="block",ye.style.display="none";const de=this.player;fe.querySelectorAll(".card").forEach(we=>{const ce=decodeURIComponent(we.dataset.trackerProjectId),he=ze.find(Pe=>Pe.name===ce);he&&(we.onclick=Pe=>{if(Pe.target.closest(".card-play-btn")){Pe.stopPropagation();let $e=[];he.data&&Object.values(he.data).forEach(et=>{et&&et.length&&et.forEach(Ve=>{const Et=ei(Ve,he,Te.name,$e.length,Ae);$e.push(Et)})});const He=$e.filter(et=>!et.unavailable);He.length>0&&(de.setQueue(He,0),de.playTrackFromQueue())}else Pe.target.closest(".card-menu-btn")?Pe.stopPropagation():Bn(`/unreleased/${Ae}/${encodeURIComponent(he.name)}`)})})}else ye.textContent="No unreleased projects"}catch(se){console.error("Failed to load unreleased projects:",se),ye.textContent="Failed to load",ye.disabled=!1}})),Nr.addArtist(S),document.title=S.name}catch(S){console.error("Failed to load artist:",S),f.innerHTML=g.innerHTML=Kn(`Could not load artist details. ${S.message}`)}}createSocialLinkHTML(e){const t=e.url;if(t.includes("tidal.com")||t.includes("qobuz.com"))return"";let n=Jb,r="Website";return t.includes("twitter.com")||t.includes("x.com")?(n=nE,r="Twitter"):t.includes("instagram.com")?(n=Zb,r="Instagram"):t.includes("facebook.com")?(n=eE,r="Facebook"):t.includes("youtube.com")?(n=tE,r="YouTube"):t.includes("spotify.com")||t.includes("open.spotify.com")?(n=aE,r="Spotify"):t.includes("soundcloud.com")?(n=rE,r="SoundCloud"):t.includes("apple.com")&&(n=iE,r="Apple Music"),`<a href="${t}" target="_blank" rel="noopener noreferrer" class="social-link" title="${r}">${n}</a>`}async renderRecentPage(){this.showPage("recent");const e=document.getElementById("recent-tracks-container"),t=document.getElementById("clear-history-btn");e.innerHTML=this.createSkeletonTracks(10,!0);try{const n=await nn.getHistory();if(t&&(t.style.display=n.length>0?"flex":"none"),n.length===0){e.innerHTML=Kn("You haven't played any tracks yet.");return}const r={},i=new Date().setHours(0,0,0,0),c=new Date(i-864e5).setHours(0,0,0,0);n.forEach(h=>{const f=new Date(h.timestamp),g=new Date(f).setHours(0,0,0,0);let y;g===i?y="Today":g===c?y="Yesterday":y=f.toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"}),r[y]||(r[y]=[]),r[y].push(h)}),e.innerHTML="";for(const[h,f]of Object.entries(r)){const g=document.createElement("h3");g.className="track-list-header-group",g.textContent=h,g.style.margin="1.5rem 0 0.5rem 0",g.style.fontSize="1.1rem",g.style.fontWeight="600",g.style.color="var(--foreground)",g.style.paddingLeft="0.5rem",e.appendChild(g);const y=document.createElement("div");for(this.renderListWithTracks(y,f,!0);y.firstChild;)e.appendChild(y.firstChild)}t&&(t.onclick=async()=>{if(confirm("Clear all recently played tracks? This cannot be undone."))try{await nn.clearHistory(),e.innerHTML=Kn("You haven't played any tracks yet."),t.style.display="none"}catch(h){console.error("Failed to clear history:",h),alert("Failed to clear history")}})}catch(n){console.error("Failed to load history:",n),e.innerHTML=Kn("Failed to load history."),t&&(t.style.display="none")}}async renderUnreleasedPage(){this.showPage("unreleased");const e=document.getElementById("unreleased-content");await Vb(e)}async renderTrackerArtistPage(e){this.showPage("tracker-artist");const t=document.getElementById("tracker-artist-projects-container");await Kb(e,t)}async renderTrackerProjectPage(e,t){this.showPage("album");const n=document.getElementById("album-detail-tracklist");await $b(e,t,n)}async renderTrackerTrackPage(e){this.showPage("album");const t=document.getElementById("album-detail-tracklist");await Wb(e,t)}updatePlaylistHeaderActions(e,t,n,r=!1,i=null,c=null){const h=document.getElementById("page-playlist").querySelector(".detail-header-actions");["shuffle-playlist-btn","edit-playlist-btn","delete-playlist-btn","share-playlist-btn","sort-playlist-btn"].forEach(d=>{const m=h.querySelector(`#${d}`);m&&m.remove()});const f=document.createDocumentFragment(),g=document.createElement("button");g.id="shuffle-playlist-btn",g.className="btn-primary",g.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m18 14 4 4-4 4"/><path d="m18 2 4 4-4 4"/><path d="M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22"/><path d="M2 6h1.972a4 4 0 0 1 3.6 2.2"/><path d="M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45"/></svg><span>Shuffle</span>',g.onclick=()=>{const d=[...n].sort(()=>Math.random()-.5);this.player.setQueue(d,0),this.player.playTrackFromQueue()};let y=null;if(i&&(y=document.createElement("button"),y.id="sort-playlist-btn",y.className="btn-secondary",y.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M7 12h10"/><path d="M10 18h4"/></svg><span>Sort</span>',y.onclick=d=>{d.stopPropagation();const m=document.getElementById("sort-menu"),E=n.some(W=>W.addedAt);m.querySelectorAll(".requires-added-date").forEach(W=>{W.style.display=E?"":"none"});const S=c?c():"custom";m.querySelectorAll("li").forEach(W=>{W.classList.toggle("sort-active",W.dataset.sort===S)});const _=y.getBoundingClientRect();m.style.top=`${_.bottom+5}px`,m.style.left=`${_.left}px`,m.style.display="block";const M=()=>{m.style.display="none",document.removeEventListener("click",M)},R=W=>{const fe=W.target.closest("li");fe&&fe.dataset.sort&&(Iy(fe.dataset.sort),i(fe.dataset.sort),M())};m.onclick=R,setTimeout(()=>document.addEventListener("click",M),0)}),t){const d=document.createElement("button");d.id="edit-playlist-btn",d.className="btn-secondary",d.innerHTML='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg><span>Edit</span>',f.appendChild(d);const m=document.createElement("button");m.id="delete-playlist-btn",m.className="btn-secondary danger",m.innerHTML='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg><span>Delete</span>',f.appendChild(m)}if(r||t&&e.isPublic){const d=document.createElement("button");d.id="share-playlist-btn",d.className="btn-secondary",d.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></svg><span>Share</span>',d.onclick=()=>{const m=Ns(`/userplaylist/${e.id||e.uuid}`);navigator.clipboard.writeText(m).then(()=>alert("Link copied to clipboard!"))},f.appendChild(d)}const u=h.querySelector("#download-playlist-btn"),l=h.querySelector("#like-playlist-btn");if(u)for(h.insertBefore(g,u),y&&l?h.insertBefore(y,l):y&&h.appendChild(y);f.firstChild;)h.appendChild(f.firstChild);else for(h.appendChild(g),y&&h.appendChild(y);f.firstChild;)h.appendChild(f.firstChild)}enableTrackReordering(e,t,n,r){const i=e.cloneNode(!0);e.parentNode&&e.parentNode.replaceChild(i,e),e=i;let c=null,h=-1;Array.from(e.querySelectorAll(".track-item")).forEach((m,E)=>{t[E]&&Hn.set(m,t[E]),m.draggable=!0,m.dataset.index=E});const g=m=>{c=m.target.closest(".track-item"),c&&(h=parseInt(c.dataset.index),m.dataTransfer.effectAllowed="move",m.dataTransfer.setData("text/plain",h),c.classList.add("dragging"))},y=()=>{c&&(c.classList.remove("dragging"),c=null)},u=m=>{if(m.preventDefault(),m.dataTransfer.dropEffect="move",!c)return;const E=d(e,m.clientY);E!==c&&(E?e.insertBefore(c,E):e.appendChild(c))},l=async m=>{if(m.preventDefault(),!!c)try{const E=Array.from(e.querySelectorAll(".track-item")),S=E.map(M=>{const R=parseInt(M.dataset.index);return t[R]});E.forEach((M,R)=>{M.dataset.index=R}),t.splice(0,t.length,...S);const _=await nn.updatePlaylistTracks(n,S);r.syncUserPlaylist(_,"update"),c=null,h=-1}catch(E){console.error("Error updating playlist tracks:",E),c&&(c.classList.remove("dragging"),c=null),h=-1}};e.addEventListener("dragstart",g),e.addEventListener("dragend",y),e.addEventListener("dragover",u),e.addEventListener("drop",l);function d(m,E){return[...m.querySelectorAll(".track-item:not(.dragging)")].reduce((_,M)=>{const R=M.getBoundingClientRect(),W=E-R.top-R.height/2;return W<0&&W>_.offset?{offset:W,element:M}:_},{offset:Number.NEGATIVE_INFINITY}).element}}getDragAfterElement(e,t){return[...e.querySelectorAll(".track-item:not(.dragging)")].reduce((r,i)=>{const c=i.getBoundingClientRect(),h=t-c.top-c.height/2;return h<0&&h>r.offset?{offset:h,element:i}:r},{offset:Number.NEGATIVE_INFINITY}).element}renderApiSettings(){const e=document.getElementById("api-instance-list");Promise.all([this.api.settings.getInstances("api"),this.api.settings.getInstances("streaming")]).then(([t,n])=>{const r=(h,f)=>{if(!h||h.length===0)return"";const g=h.map((y,u)=>{const l=y&&typeof y=="object",d=l?y.url||"":String(y||""),m=l&&(y.name||y.displayName||y.id)||d,E=l&&y.version?String(y.version):"",S=en(m||"Unknown instance"),_=en(d||""),M=en(E);return`
                        <li data-index="${u}" data-type="${f}">
                            <div style="flex: 1; min-width: 0;">
                                <div class="instance-url">${S}</div>
                                ${_&&_!==S?`<div style="font-size: 0.8rem; color: var(--muted-foreground); margin-top: 0.15rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${_}</div>`:""}
                                ${M?`<div style="font-size: 0.75rem; color: var(--muted-foreground); margin-top: 0.1rem;">v${M}</div>`:""}
                            </div>
                            <div class="controls">
                                <button class="move-up" title="Move Up" ${u===0?"disabled":""}>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 19V5M5 12l7-7 7 7"/>
                                    </svg>
                                </button>
                                <button class="move-down" title="Move Down" ${u===h.length-1?"disabled":""}>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 5v14M19 12l-7 7-7-7"/>
                                    </svg>
                                </button>
                            </div>
                        </li>
                    `}).join("");return`
                    <li class="group-header" style="font-weight: bold; padding: 1rem 0 0.5rem; background: transparent; border: none; pointer-events: none;">
                        ${f==="api"?"API Instances":"Streaming Instances"}
                    </li>
                    ${g}
                `};e.innerHTML=r(t,"api")+r(n,"streaming");const i=this.api.getCacheStats(),c=document.getElementById("cache-info");c&&(c.textContent=`Cache: ${i.memoryEntries}/${i.maxSize} entries`)})}async renderTrackPage(e,t=null){this.showPage("track"),document.body.classList.add("sidebar-collapsed");const n=document.getElementById("sidebar-toggle");n&&(n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>');const r=document.getElementById("track-detail-image"),i=document.getElementById("track-detail-title"),c=document.getElementById("track-detail-artist"),h=document.getElementById("track-detail-album"),f=document.getElementById("track-detail-year"),g=document.getElementById("track-album-section"),y=document.getElementById("track-detail-album-tracks"),u=document.getElementById("track-similar-section"),l=document.getElementById("play-track-btn"),d=document.getElementById("like-track-btn");if(r.src="",r.style.backgroundColor="var(--muted)",i.innerHTML='<div class="skeleton" style="height: 48px; width: 300px; max-width: 90%;"></div>',c.innerHTML='<div class="skeleton" style="height: 16px; width: 100px;"></div>',h.innerHTML="",f.innerHTML="",y.innerHTML=this.createSkeletonTracks(5,!1),g.style.display="none",u.style.display="none",!e||e==="undefined"||e==="null"){i.textContent="Invalid Track ID",c.innerHTML="";return}try{let m;try{m=(await this.api.getTrack(e,t)).track}catch(R){console.warn("getTrack failed, trying getTrackMetadata",R),m=await this.api.getTrackMetadata(e,t)}const E=m.album?.videoCover?this.api.tidalAPI.getVideoCoverUrl(m.album.videoCover):null,S=E||this.api.getCoverUrl(m.album?.cover);if(E)if(r.tagName==="IMG"){const R=document.createElement("video");R.src=E,R.autoplay=!0,R.loop=!0,R.muted=!0,R.playsInline=!0,R.className=r.className,R.id=r.id,r.replaceWith(R)}else r.src=E;else if(r.tagName==="VIDEO"){const R=document.createElement("img");R.src=S,R.className=r.className,R.id=r.id,r.replaceWith(R)}else r.src=S;r.style.backgroundColor="",this.setPageBackground(S),Di.isEnabled()&&m.album?.cover&&this.extractAndApplyColor(this.api.getCoverUrl(m.album.cover,"80"));const _=xi(m)?this.createExplicitBadge():"",M=Or(m);if(i.innerHTML=`${en(m.title)} ${_} ${M}`,this.adjustTitleFontSize(i,m.title),c.innerHTML=Ps(m),m.album&&(h.innerHTML=`<a href="/album/${m.album.id}">${en(m.album.title)}</a>`),m.album?.releaseDate){const R=new Date(m.album.releaseDate);isNaN(R.getTime())||(f.textContent=R.getFullYear())}if(l.onclick=()=>{this.player.setQueue([m],0),this.player.playTrackFromQueue()},d){const R=await nn.isFavorite("track",m.id);d.innerHTML=this.createHeartIcon(R),d.classList.toggle("active",R)}if(m.album?.id){const{tracks:R}=await this.api.getAlbum(m.album.id);R&&R.length>0&&(g.style.display="block",this.renderListWithTracks(y,R,!1))}document.title=`${m.title} - ${wa(m)}`}catch(m){console.error("Failed to load track:",m),i.textContent="Track not found",c.innerHTML=""}}}var oE={7267:function(o,e){e.byteLength=function(g){var y=h(g),u=y[0],l=y[1];return 3*(u+l)/4-l},e.toByteArray=function(g){var y,u,l=h(g),d=l[0],m=l[1],E=new r((function(M,R,W){return 3*(R+W)/4-W})(0,d,m)),S=0,_=m>0?d-4:d;for(u=0;u<_;u+=4)y=n[g.charCodeAt(u)]<<18|n[g.charCodeAt(u+1)]<<12|n[g.charCodeAt(u+2)]<<6|n[g.charCodeAt(u+3)],E[S++]=y>>16&255,E[S++]=y>>8&255,E[S++]=255&y;return m===2&&(y=n[g.charCodeAt(u)]<<2|n[g.charCodeAt(u+1)]>>4,E[S++]=255&y),m===1&&(y=n[g.charCodeAt(u)]<<10|n[g.charCodeAt(u+1)]<<4|n[g.charCodeAt(u+2)]>>2,E[S++]=y>>8&255,E[S++]=255&y),E},e.fromByteArray=function(g){for(var y,u=g.length,l=u%3,d=[],m=16383,E=0,S=u-l;E<S;E+=m)d.push(f(g,E,E+m>S?S:E+m));return l===1?(y=g[u-1],d.push(t[y>>2]+t[y<<4&63]+"==")):l===2&&(y=(g[u-2]<<8)+g[u-1],d.push(t[y>>10]+t[y>>4&63]+t[y<<2&63]+"=")),d.join("")};for(var t=[],n=[],r=typeof Uint8Array<"u"?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=0;c<64;++c)t[c]=i[c],n[i.charCodeAt(c)]=c;function h(g){var y=g.length;if(y%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var u=g.indexOf("=");return u===-1&&(u=y),[u,u===y?0:4-u%4]}function f(g,y,u){for(var l,d,m=[],E=y;E<u;E+=3)l=(g[E]<<16&16711680)+(g[E+1]<<8&65280)+(255&g[E+2]),m.push(t[(d=l)>>18&63]+t[d>>12&63]+t[d>>6&63]+t[63&d]);return m.join("")}n[45]=62,n[95]=63},44:function(o,e,t){var n=t(7267),r=t(7986),i=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=f,e.SlowBuffer=function(O){return+O!=O&&(O=0),f.alloc(+O)},e.INSPECT_MAX_BYTES=50;var c=2147483647;function h(O){if(O>c)throw new RangeError('The value "'+O+'" is invalid for option "size"');var z=new Uint8Array(O);return Object.setPrototypeOf(z,f.prototype),z}function f(O,z,k){if(typeof O=="number"){if(typeof z=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return u(O)}return g(O,z,k)}function g(O,z,k){if(typeof O=="string")return(function(H,De){if(typeof De=="string"&&De!==""||(De="utf8"),!f.isEncoding(De))throw new TypeError("Unknown encoding: "+De);var Ye=0|E(H,De),qe=h(Ye),Fe=qe.write(H,De);return Fe!==Ye&&(qe=qe.slice(0,Fe)),qe})(O,z);if(ArrayBuffer.isView(O))return(function(H){if(Ie(H,Uint8Array)){var De=new Uint8Array(H);return d(De.buffer,De.byteOffset,De.byteLength)}return l(H)})(O);if(O==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof O);if(Ie(O,ArrayBuffer)||O&&Ie(O.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Ie(O,SharedArrayBuffer)||O&&Ie(O.buffer,SharedArrayBuffer)))return d(O,z,k);if(typeof O=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var L=O.valueOf&&O.valueOf();if(L!=null&&L!==O)return f.from(L,z,k);var ne=(function(H){if(f.isBuffer(H)){var De=0|m(H.length),Ye=h(De);return Ye.length===0||H.copy(Ye,0,0,De),Ye}return H.length!==void 0?typeof H.length!="number"||pe(H.length)?h(0):l(H):H.type==="Buffer"&&Array.isArray(H.data)?l(H.data):void 0})(O);if(ne)return ne;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof O[Symbol.toPrimitive]=="function")return f.from(O[Symbol.toPrimitive]("string"),z,k);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof O)}function y(O){if(typeof O!="number")throw new TypeError('"size" argument must be of type number');if(O<0)throw new RangeError('The value "'+O+'" is invalid for option "size"')}function u(O){return y(O),h(O<0?0:0|m(O))}function l(O){for(var z=O.length<0?0:0|m(O.length),k=h(z),L=0;L<z;L+=1)k[L]=255&O[L];return k}function d(O,z,k){if(z<0||O.byteLength<z)throw new RangeError('"offset" is outside of buffer bounds');if(O.byteLength<z+(k||0))throw new RangeError('"length" is outside of buffer bounds');var L;return L=z===void 0&&k===void 0?new Uint8Array(O):k===void 0?new Uint8Array(O,z):new Uint8Array(O,z,k),Object.setPrototypeOf(L,f.prototype),L}function m(O){if(O>=c)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+c.toString(16)+" bytes");return 0|O}function E(O,z){if(f.isBuffer(O))return O.length;if(ArrayBuffer.isView(O)||Ie(O,ArrayBuffer))return O.byteLength;if(typeof O!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof O);var k=O.length,L=arguments.length>2&&arguments[2]===!0;if(!L&&k===0)return 0;for(var ne=!1;;)switch(z){case"ascii":case"latin1":case"binary":return k;case"utf8":case"utf-8":return Et(O).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*k;case"hex":return k>>>1;case"base64":return Nt(O).length;default:if(ne)return L?-1:Et(O).length;z=(""+z).toLowerCase(),ne=!0}}function S(O,z,k){var L=!1;if((z===void 0||z<0)&&(z=0),z>this.length||((k===void 0||k>this.length)&&(k=this.length),k<=0)||(k>>>=0)<=(z>>>=0))return"";for(O||(O="utf8");;)switch(O){case"hex":return we(this,z,k);case"utf8":case"utf-8":return Te(this,z,k);case"ascii":return ze(this,z,k);case"latin1":case"binary":return de(this,z,k);case"base64":return se(this,z,k);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ce(this,z,k);default:if(L)throw new TypeError("Unknown encoding: "+O);O=(O+"").toLowerCase(),L=!0}}function _(O,z,k){var L=O[z];O[z]=O[k],O[k]=L}function M(O,z,k,L,ne){if(O.length===0)return-1;if(typeof k=="string"?(L=k,k=0):k>2147483647?k=2147483647:k<-2147483648&&(k=-2147483648),pe(k=+k)&&(k=ne?0:O.length-1),k<0&&(k=O.length+k),k>=O.length){if(ne)return-1;k=O.length-1}else if(k<0){if(!ne)return-1;k=0}if(typeof z=="string"&&(z=f.from(z,L)),f.isBuffer(z))return z.length===0?-1:R(O,z,k,L,ne);if(typeof z=="number")return z&=255,typeof Uint8Array.prototype.indexOf=="function"?ne?Uint8Array.prototype.indexOf.call(O,z,k):Uint8Array.prototype.lastIndexOf.call(O,z,k):R(O,[z],k,L,ne);throw new TypeError("val must be string, number or Buffer")}function R(O,z,k,L,ne){var H,De=1,Ye=O.length,qe=z.length;if(L!==void 0&&((L=String(L).toLowerCase())==="ucs2"||L==="ucs-2"||L==="utf16le"||L==="utf-16le")){if(O.length<2||z.length<2)return-1;De=2,Ye/=2,qe/=2,k/=2}function Fe(nt,dt){return De===1?nt[dt]:nt.readUInt16BE(dt*De)}if(ne){var Ue=-1;for(H=k;H<Ye;H++)if(Fe(O,H)===Fe(z,Ue===-1?0:H-Ue)){if(Ue===-1&&(Ue=H),H-Ue+1===qe)return Ue*De}else Ue!==-1&&(H-=H-Ue),Ue=-1}else for(k+qe>Ye&&(k=Ye-qe),H=k;H>=0;H--){for(var Ke=!0,tt=0;tt<qe;tt++)if(Fe(O,H+tt)!==Fe(z,tt)){Ke=!1;break}if(Ke)return H}return-1}function W(O,z,k,L){k=Number(k)||0;var ne=O.length-k;L?(L=Number(L))>ne&&(L=ne):L=ne;var H=z.length;L>H/2&&(L=H/2);for(var De=0;De<L;++De){var Ye=parseInt(z.substr(2*De,2),16);if(pe(Ye))return De;O[k+De]=Ye}return De}function fe(O,z,k,L){return $t(Et(z,O.length-k),O,k,L)}function ye(O,z,k,L){return $t((function(ne){for(var H=[],De=0;De<ne.length;++De)H.push(255&ne.charCodeAt(De));return H})(z),O,k,L)}function Y(O,z,k,L){return $t(Nt(z),O,k,L)}function j(O,z,k,L){return $t((function(ne,H){for(var De,Ye,qe,Fe=[],Ue=0;Ue<ne.length&&!((H-=2)<0);++Ue)Ye=(De=ne.charCodeAt(Ue))>>8,qe=De%256,Fe.push(qe),Fe.push(Ye);return Fe})(z,O.length-k),O,k,L)}function se(O,z,k){return z===0&&k===O.length?n.fromByteArray(O):n.fromByteArray(O.slice(z,k))}function Te(O,z,k){k=Math.min(O.length,k);for(var L=[],ne=z;ne<k;){var H,De,Ye,qe,Fe=O[ne],Ue=null,Ke=Fe>239?4:Fe>223?3:Fe>191?2:1;if(ne+Ke<=k)switch(Ke){case 1:Fe<128&&(Ue=Fe);break;case 2:(192&(H=O[ne+1]))==128&&(qe=(31&Fe)<<6|63&H)>127&&(Ue=qe);break;case 3:H=O[ne+1],De=O[ne+2],(192&H)==128&&(192&De)==128&&(qe=(15&Fe)<<12|(63&H)<<6|63&De)>2047&&(qe<55296||qe>57343)&&(Ue=qe);break;case 4:H=O[ne+1],De=O[ne+2],Ye=O[ne+3],(192&H)==128&&(192&De)==128&&(192&Ye)==128&&(qe=(15&Fe)<<18|(63&H)<<12|(63&De)<<6|63&Ye)>65535&&qe<1114112&&(Ue=qe)}Ue===null?(Ue=65533,Ke=1):Ue>65535&&(Ue-=65536,L.push(Ue>>>10&1023|55296),Ue=56320|1023&Ue),L.push(Ue),ne+=Ke}return(function(tt){var nt=tt.length;if(nt<=Ae)return String.fromCharCode.apply(String,tt);for(var dt="",Gt=0;Gt<nt;)dt+=String.fromCharCode.apply(String,tt.slice(Gt,Gt+=Ae));return dt})(L)}e.kMaxLength=c,f.TYPED_ARRAY_SUPPORT=(function(){try{var O=new Uint8Array(1),z={foo:function(){return 42}};return Object.setPrototypeOf(z,Uint8Array.prototype),Object.setPrototypeOf(O,z),O.foo()===42}catch{return!1}})(),f.TYPED_ARRAY_SUPPORT||typeof console>"u"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(f.prototype,"parent",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.buffer}}),Object.defineProperty(f.prototype,"offset",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.byteOffset}}),f.poolSize=8192,f.from=function(O,z,k){return g(O,z,k)},Object.setPrototypeOf(f.prototype,Uint8Array.prototype),Object.setPrototypeOf(f,Uint8Array),f.alloc=function(O,z,k){return(function(L,ne,H){return y(L),L<=0?h(L):ne!==void 0?typeof H=="string"?h(L).fill(ne,H):h(L).fill(ne):h(L)})(O,z,k)},f.allocUnsafe=function(O){return u(O)},f.allocUnsafeSlow=function(O){return u(O)},f.isBuffer=function(O){return O!=null&&O._isBuffer===!0&&O!==f.prototype},f.compare=function(O,z){if(Ie(O,Uint8Array)&&(O=f.from(O,O.offset,O.byteLength)),Ie(z,Uint8Array)&&(z=f.from(z,z.offset,z.byteLength)),!f.isBuffer(O)||!f.isBuffer(z))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(O===z)return 0;for(var k=O.length,L=z.length,ne=0,H=Math.min(k,L);ne<H;++ne)if(O[ne]!==z[ne]){k=O[ne],L=z[ne];break}return k<L?-1:L<k?1:0},f.isEncoding=function(O){switch(String(O).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},f.concat=function(O,z){if(!Array.isArray(O))throw new TypeError('"list" argument must be an Array of Buffers');if(O.length===0)return f.alloc(0);var k;if(z===void 0)for(z=0,k=0;k<O.length;++k)z+=O[k].length;var L=f.allocUnsafe(z),ne=0;for(k=0;k<O.length;++k){var H=O[k];if(Ie(H,Uint8Array))ne+H.length>L.length?f.from(H).copy(L,ne):Uint8Array.prototype.set.call(L,H,ne);else{if(!f.isBuffer(H))throw new TypeError('"list" argument must be an Array of Buffers');H.copy(L,ne)}ne+=H.length}return L},f.byteLength=E,f.prototype._isBuffer=!0,f.prototype.swap16=function(){var O=this.length;if(O%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var z=0;z<O;z+=2)_(this,z,z+1);return this},f.prototype.swap32=function(){var O=this.length;if(O%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var z=0;z<O;z+=4)_(this,z,z+3),_(this,z+1,z+2);return this},f.prototype.swap64=function(){var O=this.length;if(O%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var z=0;z<O;z+=8)_(this,z,z+7),_(this,z+1,z+6),_(this,z+2,z+5),_(this,z+3,z+4);return this},f.prototype.toString=function(){var O=this.length;return O===0?"":arguments.length===0?Te(this,0,O):S.apply(this,arguments)},f.prototype.toLocaleString=f.prototype.toString,f.prototype.equals=function(O){if(!f.isBuffer(O))throw new TypeError("Argument must be a Buffer");return this===O||f.compare(this,O)===0},f.prototype.inspect=function(){var O="",z=e.INSPECT_MAX_BYTES;return O=this.toString("hex",0,z).replace(/(.{2})/g,"$1 ").trim(),this.length>z&&(O+=" ... "),"<Buffer "+O+">"},i&&(f.prototype[i]=f.prototype.inspect),f.prototype.compare=function(O,z,k,L,ne){if(Ie(O,Uint8Array)&&(O=f.from(O,O.offset,O.byteLength)),!f.isBuffer(O))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof O);if(z===void 0&&(z=0),k===void 0&&(k=O?O.length:0),L===void 0&&(L=0),ne===void 0&&(ne=this.length),z<0||k>O.length||L<0||ne>this.length)throw new RangeError("out of range index");if(L>=ne&&z>=k)return 0;if(L>=ne)return-1;if(z>=k)return 1;if(this===O)return 0;for(var H=(ne>>>=0)-(L>>>=0),De=(k>>>=0)-(z>>>=0),Ye=Math.min(H,De),qe=this.slice(L,ne),Fe=O.slice(z,k),Ue=0;Ue<Ye;++Ue)if(qe[Ue]!==Fe[Ue]){H=qe[Ue],De=Fe[Ue];break}return H<De?-1:De<H?1:0},f.prototype.includes=function(O,z,k){return this.indexOf(O,z,k)!==-1},f.prototype.indexOf=function(O,z,k){return M(this,O,z,k,!0)},f.prototype.lastIndexOf=function(O,z,k){return M(this,O,z,k,!1)},f.prototype.write=function(O,z,k,L){if(z===void 0)L="utf8",k=this.length,z=0;else if(k===void 0&&typeof z=="string")L=z,k=this.length,z=0;else{if(!isFinite(z))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");z>>>=0,isFinite(k)?(k>>>=0,L===void 0&&(L="utf8")):(L=k,k=void 0)}var ne=this.length-z;if((k===void 0||k>ne)&&(k=ne),O.length>0&&(k<0||z<0)||z>this.length)throw new RangeError("Attempt to write outside buffer bounds");L||(L="utf8");for(var H=!1;;)switch(L){case"hex":return W(this,O,z,k);case"utf8":case"utf-8":return fe(this,O,z,k);case"ascii":case"latin1":case"binary":return ye(this,O,z,k);case"base64":return Y(this,O,z,k);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return j(this,O,z,k);default:if(H)throw new TypeError("Unknown encoding: "+L);L=(""+L).toLowerCase(),H=!0}},f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Ae=4096;function ze(O,z,k){var L="";k=Math.min(O.length,k);for(var ne=z;ne<k;++ne)L+=String.fromCharCode(127&O[ne]);return L}function de(O,z,k){var L="";k=Math.min(O.length,k);for(var ne=z;ne<k;++ne)L+=String.fromCharCode(O[ne]);return L}function we(O,z,k){var L=O.length;(!z||z<0)&&(z=0),(!k||k<0||k>L)&&(k=L);for(var ne="",H=z;H<k;++H)ne+=Be[O[H]];return ne}function ce(O,z,k){for(var L=O.slice(z,k),ne="",H=0;H<L.length-1;H+=2)ne+=String.fromCharCode(L[H]+256*L[H+1]);return ne}function he(O,z,k){if(O%1!=0||O<0)throw new RangeError("offset is not uint");if(O+z>k)throw new RangeError("Trying to access beyond buffer length")}function Pe(O,z,k,L,ne,H){if(!f.isBuffer(O))throw new TypeError('"buffer" argument must be a Buffer instance');if(z>ne||z<H)throw new RangeError('"value" argument is out of bounds');if(k+L>O.length)throw new RangeError("Index out of range")}function $e(O,z,k,L,ne,H){if(k+L>O.length)throw new RangeError("Index out of range");if(k<0)throw new RangeError("Index out of range")}function He(O,z,k,L,ne){return z=+z,k>>>=0,ne||$e(O,0,k,4),r.write(O,z,k,L,23,4),k+4}function et(O,z,k,L,ne){return z=+z,k>>>=0,ne||$e(O,0,k,8),r.write(O,z,k,L,52,8),k+8}f.prototype.slice=function(O,z){var k=this.length;(O=~~O)<0?(O+=k)<0&&(O=0):O>k&&(O=k),(z=z===void 0?k:~~z)<0?(z+=k)<0&&(z=0):z>k&&(z=k),z<O&&(z=O);var L=this.subarray(O,z);return Object.setPrototypeOf(L,f.prototype),L},f.prototype.readUintLE=f.prototype.readUIntLE=function(O,z,k){O>>>=0,z>>>=0,k||he(O,z,this.length);for(var L=this[O],ne=1,H=0;++H<z&&(ne*=256);)L+=this[O+H]*ne;return L},f.prototype.readUintBE=f.prototype.readUIntBE=function(O,z,k){O>>>=0,z>>>=0,k||he(O,z,this.length);for(var L=this[O+--z],ne=1;z>0&&(ne*=256);)L+=this[O+--z]*ne;return L},f.prototype.readUint8=f.prototype.readUInt8=function(O,z){return O>>>=0,z||he(O,1,this.length),this[O]},f.prototype.readUint16LE=f.prototype.readUInt16LE=function(O,z){return O>>>=0,z||he(O,2,this.length),this[O]|this[O+1]<<8},f.prototype.readUint16BE=f.prototype.readUInt16BE=function(O,z){return O>>>=0,z||he(O,2,this.length),this[O]<<8|this[O+1]},f.prototype.readUint32LE=f.prototype.readUInt32LE=function(O,z){return O>>>=0,z||he(O,4,this.length),(this[O]|this[O+1]<<8|this[O+2]<<16)+16777216*this[O+3]},f.prototype.readUint32BE=f.prototype.readUInt32BE=function(O,z){return O>>>=0,z||he(O,4,this.length),16777216*this[O]+(this[O+1]<<16|this[O+2]<<8|this[O+3])},f.prototype.readIntLE=function(O,z,k){O>>>=0,z>>>=0,k||he(O,z,this.length);for(var L=this[O],ne=1,H=0;++H<z&&(ne*=256);)L+=this[O+H]*ne;return L>=(ne*=128)&&(L-=Math.pow(2,8*z)),L},f.prototype.readIntBE=function(O,z,k){O>>>=0,z>>>=0,k||he(O,z,this.length);for(var L=z,ne=1,H=this[O+--L];L>0&&(ne*=256);)H+=this[O+--L]*ne;return H>=(ne*=128)&&(H-=Math.pow(2,8*z)),H},f.prototype.readInt8=function(O,z){return O>>>=0,z||he(O,1,this.length),128&this[O]?-1*(255-this[O]+1):this[O]},f.prototype.readInt16LE=function(O,z){O>>>=0,z||he(O,2,this.length);var k=this[O]|this[O+1]<<8;return 32768&k?4294901760|k:k},f.prototype.readInt16BE=function(O,z){O>>>=0,z||he(O,2,this.length);var k=this[O+1]|this[O]<<8;return 32768&k?4294901760|k:k},f.prototype.readInt32LE=function(O,z){return O>>>=0,z||he(O,4,this.length),this[O]|this[O+1]<<8|this[O+2]<<16|this[O+3]<<24},f.prototype.readInt32BE=function(O,z){return O>>>=0,z||he(O,4,this.length),this[O]<<24|this[O+1]<<16|this[O+2]<<8|this[O+3]},f.prototype.readFloatLE=function(O,z){return O>>>=0,z||he(O,4,this.length),r.read(this,O,!0,23,4)},f.prototype.readFloatBE=function(O,z){return O>>>=0,z||he(O,4,this.length),r.read(this,O,!1,23,4)},f.prototype.readDoubleLE=function(O,z){return O>>>=0,z||he(O,8,this.length),r.read(this,O,!0,52,8)},f.prototype.readDoubleBE=function(O,z){return O>>>=0,z||he(O,8,this.length),r.read(this,O,!1,52,8)},f.prototype.writeUintLE=f.prototype.writeUIntLE=function(O,z,k,L){O=+O,z>>>=0,k>>>=0,L||Pe(this,O,z,k,Math.pow(2,8*k)-1,0);var ne=1,H=0;for(this[z]=255&O;++H<k&&(ne*=256);)this[z+H]=O/ne&255;return z+k},f.prototype.writeUintBE=f.prototype.writeUIntBE=function(O,z,k,L){O=+O,z>>>=0,k>>>=0,L||Pe(this,O,z,k,Math.pow(2,8*k)-1,0);var ne=k-1,H=1;for(this[z+ne]=255&O;--ne>=0&&(H*=256);)this[z+ne]=O/H&255;return z+k},f.prototype.writeUint8=f.prototype.writeUInt8=function(O,z,k){return O=+O,z>>>=0,k||Pe(this,O,z,1,255,0),this[z]=255&O,z+1},f.prototype.writeUint16LE=f.prototype.writeUInt16LE=function(O,z,k){return O=+O,z>>>=0,k||Pe(this,O,z,2,65535,0),this[z]=255&O,this[z+1]=O>>>8,z+2},f.prototype.writeUint16BE=f.prototype.writeUInt16BE=function(O,z,k){return O=+O,z>>>=0,k||Pe(this,O,z,2,65535,0),this[z]=O>>>8,this[z+1]=255&O,z+2},f.prototype.writeUint32LE=f.prototype.writeUInt32LE=function(O,z,k){return O=+O,z>>>=0,k||Pe(this,O,z,4,4294967295,0),this[z+3]=O>>>24,this[z+2]=O>>>16,this[z+1]=O>>>8,this[z]=255&O,z+4},f.prototype.writeUint32BE=f.prototype.writeUInt32BE=function(O,z,k){return O=+O,z>>>=0,k||Pe(this,O,z,4,4294967295,0),this[z]=O>>>24,this[z+1]=O>>>16,this[z+2]=O>>>8,this[z+3]=255&O,z+4},f.prototype.writeIntLE=function(O,z,k,L){if(O=+O,z>>>=0,!L){var ne=Math.pow(2,8*k-1);Pe(this,O,z,k,ne-1,-ne)}var H=0,De=1,Ye=0;for(this[z]=255&O;++H<k&&(De*=256);)O<0&&Ye===0&&this[z+H-1]!==0&&(Ye=1),this[z+H]=(O/De|0)-Ye&255;return z+k},f.prototype.writeIntBE=function(O,z,k,L){if(O=+O,z>>>=0,!L){var ne=Math.pow(2,8*k-1);Pe(this,O,z,k,ne-1,-ne)}var H=k-1,De=1,Ye=0;for(this[z+H]=255&O;--H>=0&&(De*=256);)O<0&&Ye===0&&this[z+H+1]!==0&&(Ye=1),this[z+H]=(O/De|0)-Ye&255;return z+k},f.prototype.writeInt8=function(O,z,k){return O=+O,z>>>=0,k||Pe(this,O,z,1,127,-128),O<0&&(O=255+O+1),this[z]=255&O,z+1},f.prototype.writeInt16LE=function(O,z,k){return O=+O,z>>>=0,k||Pe(this,O,z,2,32767,-32768),this[z]=255&O,this[z+1]=O>>>8,z+2},f.prototype.writeInt16BE=function(O,z,k){return O=+O,z>>>=0,k||Pe(this,O,z,2,32767,-32768),this[z]=O>>>8,this[z+1]=255&O,z+2},f.prototype.writeInt32LE=function(O,z,k){return O=+O,z>>>=0,k||Pe(this,O,z,4,2147483647,-2147483648),this[z]=255&O,this[z+1]=O>>>8,this[z+2]=O>>>16,this[z+3]=O>>>24,z+4},f.prototype.writeInt32BE=function(O,z,k){return O=+O,z>>>=0,k||Pe(this,O,z,4,2147483647,-2147483648),O<0&&(O=4294967295+O+1),this[z]=O>>>24,this[z+1]=O>>>16,this[z+2]=O>>>8,this[z+3]=255&O,z+4},f.prototype.writeFloatLE=function(O,z,k){return He(this,O,z,!0,k)},f.prototype.writeFloatBE=function(O,z,k){return He(this,O,z,!1,k)},f.prototype.writeDoubleLE=function(O,z,k){return et(this,O,z,!0,k)},f.prototype.writeDoubleBE=function(O,z,k){return et(this,O,z,!1,k)},f.prototype.copy=function(O,z,k,L){if(!f.isBuffer(O))throw new TypeError("argument should be a Buffer");if(k||(k=0),L||L===0||(L=this.length),z>=O.length&&(z=O.length),z||(z=0),L>0&&L<k&&(L=k),L===k||O.length===0||this.length===0)return 0;if(z<0)throw new RangeError("targetStart out of bounds");if(k<0||k>=this.length)throw new RangeError("Index out of range");if(L<0)throw new RangeError("sourceEnd out of bounds");L>this.length&&(L=this.length),O.length-z<L-k&&(L=O.length-z+k);var ne=L-k;return this===O&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(z,k,L):Uint8Array.prototype.set.call(O,this.subarray(k,L),z),ne},f.prototype.fill=function(O,z,k,L){if(typeof O=="string"){if(typeof z=="string"?(L=z,z=0,k=this.length):typeof k=="string"&&(L=k,k=this.length),L!==void 0&&typeof L!="string")throw new TypeError("encoding must be a string");if(typeof L=="string"&&!f.isEncoding(L))throw new TypeError("Unknown encoding: "+L);if(O.length===1){var ne=O.charCodeAt(0);(L==="utf8"&&ne<128||L==="latin1")&&(O=ne)}}else typeof O=="number"?O&=255:typeof O=="boolean"&&(O=Number(O));if(z<0||this.length<z||this.length<k)throw new RangeError("Out of range index");if(k<=z)return this;var H;if(z>>>=0,k=k===void 0?this.length:k>>>0,O||(O=0),typeof O=="number")for(H=z;H<k;++H)this[H]=O;else{var De=f.isBuffer(O)?O:f.from(O,L),Ye=De.length;if(Ye===0)throw new TypeError('The value "'+O+'" is invalid for argument "value"');for(H=0;H<k-z;++H)this[H+z]=De[H%Ye]}return this};var Ve=/[^+/0-9A-Za-z-_]/g;function Et(O,z){var k;z=z||1/0;for(var L=O.length,ne=null,H=[],De=0;De<L;++De){if((k=O.charCodeAt(De))>55295&&k<57344){if(!ne){if(k>56319){(z-=3)>-1&&H.push(239,191,189);continue}if(De+1===L){(z-=3)>-1&&H.push(239,191,189);continue}ne=k;continue}if(k<56320){(z-=3)>-1&&H.push(239,191,189),ne=k;continue}k=65536+(ne-55296<<10|k-56320)}else ne&&(z-=3)>-1&&H.push(239,191,189);if(ne=null,k<128){if((z-=1)<0)break;H.push(k)}else if(k<2048){if((z-=2)<0)break;H.push(k>>6|192,63&k|128)}else if(k<65536){if((z-=3)<0)break;H.push(k>>12|224,k>>6&63|128,63&k|128)}else{if(!(k<1114112))throw new Error("Invalid code point");if((z-=4)<0)break;H.push(k>>18|240,k>>12&63|128,k>>6&63|128,63&k|128)}}return H}function Nt(O){return n.toByteArray((function(z){if((z=(z=z.split("=")[0]).trim().replace(Ve,"")).length<2)return"";for(;z.length%4!=0;)z+="=";return z})(O))}function $t(O,z,k,L){for(var ne=0;ne<L&&!(ne+k>=z.length||ne>=O.length);++ne)z[ne+k]=O[ne];return ne}function Ie(O,z){return O instanceof z||O!=null&&O.constructor!=null&&O.constructor.name!=null&&O.constructor.name===z.name}function pe(O){return O!=O}var Be=(function(){for(var O="0123456789abcdef",z=new Array(256),k=0;k<16;++k)for(var L=16*k,ne=0;ne<16;++ne)z[L+ne]=O[k]+O[ne];return z})()},6877:function(o,e){var t={parseBuffer:function(i){return new n(i).parse()},addBoxProcessor:function(i,c){typeof i=="string"&&typeof c=="function"&&(r.prototype._boxProcessors[i]=c)},createFile:function(){return new n},createBox:function(i,c,h){var f=r.create(i);return c&&c.append(f,h),f},createFullBox:function(i,c,h){var f=t.createBox(i,c,h);return f.version=0,f.flags=0,f},Utils:{}};t.Utils.dataViewToString=function(i,c){var h=c||"utf-8";if(typeof TextDecoder<"u")return new TextDecoder(h).decode(i);var f=[],g=0;if(h==="utf-8")for(;g<i.byteLength;){var y=i.getUint8(g++);y<128||(y<224?(y=(31&y)<<6,y|=63&i.getUint8(g++)):y<240?(y=(15&y)<<12,y|=(63&i.getUint8(g++))<<6,y|=63&i.getUint8(g++)):(y=(7&y)<<18,y|=(63&i.getUint8(g++))<<12,y|=(63&i.getUint8(g++))<<6,y|=63&i.getUint8(g++))),f.push(String.fromCharCode(y))}else for(;g<i.byteLength;)f.push(String.fromCharCode(i.getUint8(g++)));return f.join("")},t.Utils.utf8ToByteArray=function(i){var c,h;if(typeof TextEncoder<"u")c=new TextEncoder().encode(i);else for(c=[],h=0;h<i.length;++h){var f=i.charCodeAt(h);f<128?c.push(f):f<2048?(c.push(192|f>>6),c.push(128|63&f)):f<65536?(c.push(224|f>>12),c.push(128|63&f>>6),c.push(128|63&f)):(c.push(240|f>>18),c.push(128|63&f>>12),c.push(128|63&f>>6),c.push(128|63&f))}return c},t.Utils.appendBox=function(i,c,h){if(c._offset=i._cursor.offset,c._root=i._root?i._root:i,c._raw=i._raw,c._parent=i,h!==-1)if(h!=null){var f,g=-1;if(typeof h=="number")g=h;else{if(typeof h=="string")f=h;else{if(typeof h!="object"||!h.type)return void i.boxes.push(c);f=h.type}for(var y=0;y<i.boxes.length;y++)if(f===i.boxes[y].type){g=y+1;break}}i.boxes.splice(g,0,c)}else i.boxes.push(c)},e.parseBuffer=t.parseBuffer,e.addBoxProcessor=t.addBoxProcessor,e.createFile=t.createFile,e.createBox=t.createBox,e.createFullBox=t.createFullBox,e.Utils=t.Utils,t.Cursor=function(i){this.offset=i===void 0?0:i};var n=function(i){this._cursor=new t.Cursor,this.boxes=[],i&&(this._raw=new DataView(i))};n.prototype.fetch=function(i){var c=this.fetchAll(i,!0);return c.length?c[0]:null},n.prototype.fetchAll=function(i,c){var h=[];return n._sweep.call(this,i,h,c),h},n.prototype.parse=function(){for(this._cursor.offset=0,this.boxes=[];this._cursor.offset<this._raw.byteLength;){var i=r.parse(this);if(i.type===void 0)break;this.boxes.push(i)}return this},n._sweep=function(i,c,h){for(var f in this.type&&this.type==i&&c.push(this),this.boxes){if(c.length&&h)return;n._sweep.call(this.boxes[f],i,c,h)}},n.prototype.write=function(){var i,c=0;for(i=0;i<this.boxes.length;i++)c+=this.boxes[i].getLength(!1);var h=new Uint8Array(c);for(this._rawo=new DataView(h.buffer),this.bytes=h,this._cursor.offset=0,i=0;i<this.boxes.length;i++)this.boxes[i].write();return h.buffer},n.prototype.append=function(i,c){t.Utils.appendBox(this,i,c)};var r=function(){this._cursor=new t.Cursor};r.parse=function(i){var c=new r;return c._offset=i._cursor.offset,c._root=i._root?i._root:i,c._raw=i._raw,c._parent=i,c._parseBox(),i._cursor.offset=c._raw.byteOffset+c._raw.byteLength,c},r.create=function(i){var c=new r;return c.type=i,c.boxes=[],c},r.prototype._boxContainers=["dinf","edts","mdia","meco","mfra","minf","moof","moov","mvex","stbl","strk","traf","trak","tref","udta","vttc","sinf","schi","encv","enca","meta","grpl","prsl"],r.prototype._boxProcessors={},r.prototype._procField=function(i,c,h){this._parsing?this[i]=this._readField(c,h):this._writeField(c,h,this[i])},r.prototype._procFieldArray=function(i,c,h,f){var g;if(this._parsing)for(this[i]=[],g=0;g<c;g++)this[i][g]=this._readField(h,f);else for(g=0;g<this[i].length;g++)this._writeField(h,f,this[i][g])},r.prototype._procFullBox=function(){this._procField("version","uint",8),this._procField("flags","uint",24)},r.prototype._procEntries=function(i,c,h){var f;if(this._parsing)for(this[i]=[],f=0;f<c;f++)this[i].push({}),h.call(this,this[i][f]);else for(f=0;f<c;f++)h.call(this,this[i][f])},r.prototype._procSubEntries=function(i,c,h,f){var g;if(this._parsing)for(i[c]=[],g=0;g<h;g++)i[c].push({}),f.call(this,i[c][g]);else for(g=0;g<h;g++)f.call(this,i[c][g])},r.prototype._procEntryField=function(i,c,h,f){this._parsing?i[c]=this._readField(h,f):this._writeField(h,f,i[c])},r.prototype._procSubBoxes=function(i,c){var h;if(this._parsing)for(this[i]=[],h=0;h<c;h++)this[i].push(r.parse(this));else for(h=0;h<c;h++)this._rawo?this[i][h].write():this.size+=this[i][h].getLength()},r.prototype._readField=function(i,c){switch(i){case"uint":return this._readUint(c);case"int":return this._readInt(c);case"template":return this._readTemplate(c);case"string":return c===-1?this._readTerminatedString():this._readString(c);case"data":return this._readData(c);case"utf8":return this._readUTF8String();case"utf8string":return this._readUTF8TerminatedString();default:return-1}},r.prototype._readInt=function(i){var c=null,h=this._cursor.offset-this._raw.byteOffset;switch(i){case 8:c=this._raw.getInt8(h);break;case 16:c=this._raw.getInt16(h);break;case 32:c=this._raw.getInt32(h);break;case 64:var f=this._raw.getInt32(h),g=this._raw.getInt32(h+4);c=f*Math.pow(2,32)+g}return this._cursor.offset+=i>>3,c},r.prototype._readUint=function(i){var c,h,f=null,g=this._cursor.offset-this._raw.byteOffset;switch(i){case 8:f=this._raw.getUint8(g);break;case 16:f=this._raw.getUint16(g);break;case 24:f=((c=this._raw.getUint16(g))<<8)+(h=this._raw.getUint8(g+2));break;case 32:f=this._raw.getUint32(g);break;case 64:c=this._raw.getUint32(g),h=this._raw.getUint32(g+4),f=c*Math.pow(2,32)+h}return this._cursor.offset+=i>>3,f},r.prototype._readString=function(i){for(var c="",h=0;h<i;h++){var f=this._readUint(8);c+=String.fromCharCode(f)}return c},r.prototype._readTemplate=function(i){return this._readUint(i/2)+this._readUint(i/2)/Math.pow(2,i/2)},r.prototype._readTerminatedString=function(){for(var i="";this._cursor.offset-this._offset<this._raw.byteLength;){var c=this._readUint(8);if(c===0)break;i+=String.fromCharCode(c)}return i},r.prototype._readData=function(i){var c=i>0?i:this._raw.byteLength-(this._cursor.offset-this._offset);if(c>0){var h=new Uint8Array(this._raw.buffer,this._cursor.offset,c);return this._cursor.offset+=c,h}return null},r.prototype._readUTF8String=function(){var i=this._raw.byteLength-(this._cursor.offset-this._offset),c=null;return i>0&&(c=new DataView(this._raw.buffer,this._cursor.offset,i),this._cursor.offset+=i),c&&t.Utils.dataViewToString(c)},r.prototype._readUTF8TerminatedString=function(){var i=this._raw.byteLength-(this._cursor.offset-this._offset),c=null;if(i>0){var h;for(c=new DataView(this._raw.buffer,this._cursor.offset,i),h=0;h<i&&c.getUint8(h)!==0;h++);c=new DataView(this._raw.buffer,this._cursor.offset,h),this._cursor.offset+=Math.min(h+1,i)}return c&&t.Utils.dataViewToString(c)},r.prototype._parseBox=function(){if(this._parsing=!0,this._cursor.offset=this._offset,this._offset+8>this._raw.buffer.byteLength)this._root._incomplete=!0;else{switch(this._procField("size","uint",32),this._procField("type","string",4),this.size===1&&this._procField("largesize","uint",64),this.type==="uuid"&&this._procFieldArray("usertype",16,"uint",8),this.size){case 0:this._raw=new DataView(this._raw.buffer,this._offset);break;case 1:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.largesize);break;default:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.size)}this._incomplete||(this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),this._boxContainers.indexOf(this.type)!==-1?this._parseContainerBox():this._data=this._readData())}},r.prototype._parseFullBox=function(){this.version=this._readUint(8),this.flags=this._readUint(24)},r.prototype._parseContainerBox=function(){for(this.boxes=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.boxes.push(r.parse(this))},r.prototype.append=function(i,c){t.Utils.appendBox(this,i,c)},r.prototype.getLength=function(){if(this._parsing=!1,this._rawo=null,this.size=0,this._procField("size","uint",32),this._procField("type","string",4),this.size===1&&this._procField("largesize","uint",64),this.type==="uuid"&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),this._boxContainers.indexOf(this.type)!==-1)for(var i=0;i<this.boxes.length;i++)this.size+=this.boxes[i].getLength();return this._data&&this._writeData(this._data),this.size},r.prototype.write=function(){switch(this._parsing=!1,this._cursor.offset=this._parent._cursor.offset,this.size){case 0:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.parent._rawo.byteLength-this._cursor.offset);break;case 1:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.largesize);break;default:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.size)}if(this._procField("size","uint",32),this._procField("type","string",4),this.size===1&&this._procField("largesize","uint",64),this.type==="uuid"&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),this._boxContainers.indexOf(this.type)!==-1)for(var i=0;i<this.boxes.length;i++)this.boxes[i].write();return this._data&&this._writeData(this._data),this._parent._cursor.offset+=this.size,this.size},r.prototype._writeInt=function(i,c){if(this._rawo){var h=this._cursor.offset-this._rawo.byteOffset;switch(i){case 8:this._rawo.setInt8(h,c);break;case 16:this._rawo.setInt16(h,c);break;case 32:this._rawo.setInt32(h,c);break;case 64:var f=Math.floor(c/Math.pow(2,32)),g=c-f*Math.pow(2,32);this._rawo.setUint32(h,f),this._rawo.setUint32(h+4,g)}this._cursor.offset+=i>>3}else this.size+=i>>3},r.prototype._writeUint=function(i,c){if(this._rawo){var h,f,g=this._cursor.offset-this._rawo.byteOffset;switch(i){case 8:this._rawo.setUint8(g,c);break;case 16:this._rawo.setUint16(g,c);break;case 24:h=(16776960&c)>>8,f=255&c,this._rawo.setUint16(g,h),this._rawo.setUint8(g+2,f);break;case 32:this._rawo.setUint32(g,c);break;case 64:f=c-(h=Math.floor(c/Math.pow(2,32)))*Math.pow(2,32),this._rawo.setUint32(g,h),this._rawo.setUint32(g+4,f)}this._cursor.offset+=i>>3}else this.size+=i>>3},r.prototype._writeString=function(i,c){for(var h=0;h<i;h++)this._writeUint(8,c.charCodeAt(h))},r.prototype._writeTerminatedString=function(i){if(i.length!==0){for(var c=0;c<i.length;c++)this._writeUint(8,i.charCodeAt(c));this._writeUint(8,0)}},r.prototype._writeTemplate=function(i,c){var h=Math.floor(c),f=(c-h)*Math.pow(2,i/2);this._writeUint(i/2,h),this._writeUint(i/2,f)},r.prototype._writeData=function(i){if(i)if(this._rawo){if(i instanceof Array){for(var c=this._cursor.offset-this._rawo.byteOffset,h=0;h<i.length;h++)this._rawo.setInt8(c+h,i[h]);this._cursor.offset+=i.length}i instanceof Uint8Array&&(this._root.bytes.set(i,this._cursor.offset),this._cursor.offset+=i.length)}else this.size+=i.length},r.prototype._writeUTF8String=function(i){var c=t.Utils.utf8ToByteArray(i);if(this._rawo)for(var h=new DataView(this._rawo.buffer,this._cursor.offset,c.length),f=0;f<c.length;f++)h.setUint8(f,c[f]);else this.size+=c.length},r.prototype._writeField=function(i,c,h){switch(i){case"uint":this._writeUint(c,h);break;case"int":this._writeInt(c,h);break;case"template":this._writeTemplate(c,h);break;case"string":c==-1?this._writeTerminatedString(h):this._writeString(c,h);break;case"data":this._writeData(h);break;case"utf8":this._writeUTF8String(h)}},r.prototype._boxProcessors.ardi=function(){this._procFullBox(),this._procField("audio_rendering_indication","uint",8)},r.prototype._boxProcessors.avc1=r.prototype._boxProcessors.avc2=r.prototype._boxProcessors.avc3=r.prototype._boxProcessors.avc4=r.prototype._boxProcessors.hvc1=r.prototype._boxProcessors.hev1=r.prototype._boxProcessors.encv=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procField("pre_defined1","uint",16),this._procField("reserved2","uint",16),this._procFieldArray("pre_defined2",3,"uint",32),this._procField("width","uint",16),this._procField("height","uint",16),this._procField("horizresolution","template",32),this._procField("vertresolution","template",32),this._procField("reserved3","uint",32),this._procField("frame_count","uint",16),this._procFieldArray("compressorname",32,"uint",8),this._procField("depth","uint",16),this._procField("pre_defined3","int",16),this._procField("config","data",-1)},r.prototype._boxProcessors.ctts=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(i){this._procEntryField(i,"sample_count","uint",32),this._procEntryField(i,"sample_offset",this.version===1?"int":"uint",32)}))},r.prototype._boxProcessors.dref=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},r.prototype._boxProcessors.elng=function(){this._procFullBox(),this._procField("extended_language","utf8string")},r.prototype._boxProcessors.elst=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(i){this._procEntryField(i,"segment_duration","uint",this.version===1?64:32),this._procEntryField(i,"media_time","int",this.version===1?64:32),this._procEntryField(i,"media_rate_integer","int",16),this._procEntryField(i,"media_rate_fraction","int",16)}))},r.prototype._boxProcessors.emsg=function(){this._procFullBox(),this.version==1?(this._procField("timescale","uint",32),this._procField("presentation_time","uint",64),this._procField("event_duration","uint",32),this._procField("id","uint",32),this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1)):(this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1),this._procField("timescale","uint",32),this._procField("presentation_time_delta","uint",32),this._procField("event_duration","uint",32),this._procField("id","uint",32)),this._procField("message_data","data",-1)},r.prototype._boxProcessors.free=r.prototype._boxProcessors.skip=function(){this._procField("data","data",-1)},r.prototype._boxProcessors.frma=function(){this._procField("data_format","uint",32)},r.prototype._boxProcessors.ftyp=r.prototype._boxProcessors.styp=function(){this._procField("major_brand","string",4),this._procField("minor_version","uint",32);var i=-1;this._parsing&&(i=(this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset))/4),this._procFieldArray("compatible_brands",i,"string",4)},r.prototype._boxProcessors.hdlr=function(){this._procFullBox(),this._procField("pre_defined","uint",32),this._procField("handler_type","string",4),this._procFieldArray("reserved",3,"uint",32),this._procField("name","string",-1)},r.prototype._boxProcessors.imda=function(){this._procField("imda_identifier","uint",32),this._procField("data","data",-1)},r.prototype._boxProcessors.kind=function(){this._procFullBox(),this._procField("schemeURI","utf8string"),this._procField("value","utf8string")},r.prototype._boxProcessors.labl=function(){this._procFullBox(),this.is_group_label=!!(1&this.flags),this._procField("label_id","uint",16),this._procField("language","utf8string"),this._procField("label","utf8string")},r.prototype._boxProcessors.mdat=function(){this._procField("data","data",-1)},r.prototype._boxProcessors.mdhd=function(){this._procFullBox(),this._procField("creation_time","uint",this.version==1?64:32),this._procField("modification_time","uint",this.version==1?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",this.version==1?64:32),this._parsing||typeof this.language!="string"||(this.language=this.language.charCodeAt(0)-96<<10|this.language.charCodeAt(1)-96<<5|this.language.charCodeAt(2)-96),this._procField("language","uint",16),this._parsing&&(this.language=String.fromCharCode(96+(this.language>>10&31),96+(this.language>>5&31),96+(31&this.language))),this._procField("pre_defined","uint",16)},r.prototype._boxProcessors.mehd=function(){this._procFullBox(),this._procField("fragment_duration","uint",this.version==1?64:32)},r.prototype._boxProcessors.meta=function(){this._procFullBox()},r.prototype._boxProcessors.mfhd=function(){this._procFullBox(),this._procField("sequence_number","uint",32)},r.prototype._boxProcessors.mfro=function(){this._procFullBox(),this._procField("mfra_size","uint",32)},r.prototype._boxProcessors.mp4a=r.prototype._boxProcessors.enca=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procField("channelcount","uint",16),this._procField("samplesize","uint",16),this._procField("pre_defined","uint",16),this._procField("reserved3","uint",16),this._procField("samplerate","template",32),this._procField("esds","data",-1)},r.prototype._boxProcessors.mvhd=function(){this._procFullBox(),this._procField("creation_time","uint",this.version==1?64:32),this._procField("modification_time","uint",this.version==1?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",this.version==1?64:32),this._procField("rate","template",32),this._procField("volume","template",16),this._procField("reserved1","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procFieldArray("matrix",9,"template",32),this._procFieldArray("pre_defined",6,"uint",32),this._procField("next_track_ID","uint",32)},r.prototype._boxProcessors.payl=function(){this._procField("cue_text","utf8")},r.prototype._boxProcessors.prft=function(){this._procFullBox(),this._procField("reference_track_ID","uint",32),this._procField("ntp_timestamp_sec","uint",32),this._procField("ntp_timestamp_frac","uint",32),this._procField("media_time","uint",this.version==1?64:32)},r.prototype._boxProcessors.prsl=function(){this._procFullBox(),this._procField("group_id","uint",32),this._procField("num_entities_in_group","uint",32),this._procEntries("entities",this.num_entities_in_group,(function(i){this._procEntryField(i,"entity_id","uint",32)})),4096&this.flags&&this._procField("preselection_tag","utf8string"),8192&this.flags&&this._procField("selection_priority","uint",8),16384&this.flags&&this._procField("interleaving_tag","utf8string")},r.prototype._boxProcessors.pssh=function(){this._procFullBox(),this._procFieldArray("SystemID",16,"uint",8),this._procField("DataSize","uint",32),this._procFieldArray("Data",this.DataSize,"uint",8)},r.prototype._boxProcessors.schm=function(){this._procFullBox(),this._procField("scheme_type","uint",32),this._procField("scheme_version","uint",32),1&this.flags&&this._procField("scheme_uri","string",-1)},r.prototype._boxProcessors.sdtp=function(){this._procFullBox();var i=-1;this._parsing&&(i=this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset)),this._procFieldArray("sample_dependency_table",i,"uint",8)},r.prototype._boxProcessors.sidx=function(){this._procFullBox(),this._procField("reference_ID","uint",32),this._procField("timescale","uint",32),this._procField("earliest_presentation_time","uint",this.version==1?64:32),this._procField("first_offset","uint",this.version==1?64:32),this._procField("reserved","uint",16),this._procField("reference_count","uint",16),this._procEntries("references",this.reference_count,(function(i){this._parsing||(i.reference=(1&i.reference_type)<<31,i.reference|=2147483647&i.referenced_size,i.sap=(1&i.starts_with_SAP)<<31,i.sap|=(3&i.SAP_type)<<28,i.sap|=268435455&i.SAP_delta_time),this._procEntryField(i,"reference","uint",32),this._procEntryField(i,"subsegment_duration","uint",32),this._procEntryField(i,"sap","uint",32),this._parsing&&(i.reference_type=i.reference>>31&1,i.referenced_size=2147483647&i.reference,i.starts_with_SAP=i.sap>>31&1,i.SAP_type=i.sap>>28&7,i.SAP_delta_time=268435455&i.sap)}))},r.prototype._boxProcessors.smhd=function(){this._procFullBox(),this._procField("balance","uint",16),this._procField("reserved","uint",16)},r.prototype._boxProcessors.ssix=function(){this._procFullBox(),this._procField("subsegment_count","uint",32),this._procEntries("subsegments",this.subsegment_count,(function(i){this._procEntryField(i,"ranges_count","uint",32),this._procSubEntries(i,"ranges",i.ranges_count,(function(c){this._procEntryField(c,"level","uint",8),this._procEntryField(c,"range_size","uint",24)}))}))},r.prototype._boxProcessors.stsd=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},r.prototype._boxProcessors.sttg=function(){this._procField("settings","utf8")},r.prototype._boxProcessors.stts=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(i){this._procEntryField(i,"sample_count","uint",32),this._procEntryField(i,"sample_delta","uint",32)}))},r.prototype._boxProcessors.subs=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(i){this._procEntryField(i,"sample_delta","uint",32),this._procEntryField(i,"subsample_count","uint",16),this._procSubEntries(i,"subsamples",i.subsample_count,(function(c){this._procEntryField(c,"subsample_size","uint",this.version===1?32:16),this._procEntryField(c,"subsample_priority","uint",8),this._procEntryField(c,"discardable","uint",8),this._procEntryField(c,"codec_specific_parameters","uint",32)}))}))},r.prototype._boxProcessors.tenc=function(){this._procFullBox(),this._procField("default_IsEncrypted","uint",24),this._procField("default_IV_size","uint",8),this._procFieldArray("default_KID",16,"uint",8)},r.prototype._boxProcessors.tfdt=function(){this._procFullBox(),this._procField("baseMediaDecodeTime","uint",this.version==1?64:32)},r.prototype._boxProcessors.tfhd=function(){this._procFullBox(),this._procField("track_ID","uint",32),1&this.flags&&this._procField("base_data_offset","uint",64),2&this.flags&&this._procField("sample_description_offset","uint",32),8&this.flags&&this._procField("default_sample_duration","uint",32),16&this.flags&&this._procField("default_sample_size","uint",32),32&this.flags&&this._procField("default_sample_flags","uint",32)},r.prototype._boxProcessors.tfra=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._parsing||(this.reserved=0,this.reserved|=(48&this.length_size_of_traf_num)<<4,this.reserved|=(12&this.length_size_of_trun_num)<<2,this.reserved|=3&this.length_size_of_sample_num),this._procField("reserved","uint",32),this._parsing&&(this.length_size_of_traf_num=(48&this.reserved)>>4,this.length_size_of_trun_num=(12&this.reserved)>>2,this.length_size_of_sample_num=3&this.reserved),this._procField("number_of_entry","uint",32),this._procEntries("entries",this.number_of_entry,(function(i){this._procEntryField(i,"time","uint",this.version===1?64:32),this._procEntryField(i,"moof_offset","uint",this.version===1?64:32),this._procEntryField(i,"traf_number","uint",8*(this.length_size_of_traf_num+1)),this._procEntryField(i,"trun_number","uint",8*(this.length_size_of_trun_num+1)),this._procEntryField(i,"sample_number","uint",8*(this.length_size_of_sample_num+1))}))},r.prototype._boxProcessors.tkhd=function(){this._procFullBox(),this._procField("creation_time","uint",this.version==1?64:32),this._procField("modification_time","uint",this.version==1?64:32),this._procField("track_ID","uint",32),this._procField("reserved1","uint",32),this._procField("duration","uint",this.version==1?64:32),this._procFieldArray("reserved2",2,"uint",32),this._procField("layer","uint",16),this._procField("alternate_group","uint",16),this._procField("volume","template",16),this._procField("reserved3","uint",16),this._procFieldArray("matrix",9,"template",32),this._procField("width","template",32),this._procField("height","template",32)},r.prototype._boxProcessors.trex=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._procField("default_sample_description_index","uint",32),this._procField("default_sample_duration","uint",32),this._procField("default_sample_size","uint",32),this._procField("default_sample_flags","uint",32)},r.prototype._boxProcessors.trun=function(){this._procFullBox(),this._procField("sample_count","uint",32),1&this.flags&&this._procField("data_offset","int",32),4&this.flags&&this._procField("first_sample_flags","uint",32),this._procEntries("samples",this.sample_count,(function(i){256&this.flags&&this._procEntryField(i,"sample_duration","uint",32),512&this.flags&&this._procEntryField(i,"sample_size","uint",32),1024&this.flags&&this._procEntryField(i,"sample_flags","uint",32),2048&this.flags&&this._procEntryField(i,"sample_composition_time_offset",this.version===1?"int":"uint",32)}))},r.prototype._boxProcessors["url "]=r.prototype._boxProcessors["urn "]=function(){this._procFullBox(),this.type==="urn "&&this._procField("name","string",-1),this._procField("location","string",-1)},r.prototype._boxProcessors.vlab=function(){this._procField("source_label","utf8")},r.prototype._boxProcessors.vmhd=function(){this._procFullBox(),this._procField("graphicsmode","uint",16),this._procFieldArray("opcolor",3,"uint",16)},r.prototype._boxProcessors.vttC=function(){this._procField("config","utf8")},r.prototype._boxProcessors.vtte=function(){}},9826:function(o){var e,t=typeof Reflect=="object"?Reflect:null,n=t&&typeof t.apply=="function"?t.apply:function(S,_,M){return Function.prototype.apply.call(S,_,M)};e=t&&typeof t.ownKeys=="function"?t.ownKeys:Object.getOwnPropertySymbols?function(S){return Object.getOwnPropertyNames(S).concat(Object.getOwnPropertySymbols(S))}:function(S){return Object.getOwnPropertyNames(S)};var r=Number.isNaN||function(S){return S!=S};function i(){i.init.call(this)}o.exports=i,o.exports.once=function(S,_){return new Promise((function(M,R){function W(ye){S.removeListener(_,fe),R(ye)}function fe(){typeof S.removeListener=="function"&&S.removeListener("error",W),M([].slice.call(arguments))}E(S,_,fe,{once:!0}),_!=="error"&&(function(ye,Y){typeof ye.on=="function"&&E(ye,"error",Y,{once:!0})})(S,W)}))},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var c=10;function h(S){if(typeof S!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof S)}function f(S){return S._maxListeners===void 0?i.defaultMaxListeners:S._maxListeners}function g(S,_,M,R){var W,fe,ye,Y;if(h(M),(fe=S._events)===void 0?(fe=S._events=Object.create(null),S._eventsCount=0):(fe.newListener!==void 0&&(S.emit("newListener",_,M.listener?M.listener:M),fe=S._events),ye=fe[_]),ye===void 0)ye=fe[_]=M,++S._eventsCount;else if(typeof ye=="function"?ye=fe[_]=R?[M,ye]:[ye,M]:R?ye.unshift(M):ye.push(M),(W=f(S))>0&&ye.length>W&&!ye.warned){ye.warned=!0;var j=new Error("Possible EventEmitter memory leak detected. "+ye.length+" "+String(_)+" listeners added. Use emitter.setMaxListeners() to increase limit");j.name="MaxListenersExceededWarning",j.emitter=S,j.type=_,j.count=ye.length,Y=j,console&&console.warn&&console.warn(Y)}return S}function y(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(S,_,M){var R={fired:!1,wrapFn:void 0,target:S,type:_,listener:M},W=y.bind(R);return W.listener=M,R.wrapFn=W,W}function l(S,_,M){var R=S._events;if(R===void 0)return[];var W=R[_];return W===void 0?[]:typeof W=="function"?M?[W.listener||W]:[W]:M?(function(fe){for(var ye=new Array(fe.length),Y=0;Y<ye.length;++Y)ye[Y]=fe[Y].listener||fe[Y];return ye})(W):m(W,W.length)}function d(S){var _=this._events;if(_!==void 0){var M=_[S];if(typeof M=="function")return 1;if(M!==void 0)return M.length}return 0}function m(S,_){for(var M=new Array(_),R=0;R<_;++R)M[R]=S[R];return M}function E(S,_,M,R){if(typeof S.on=="function")R.once?S.once(_,M):S.on(_,M);else{if(typeof S.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof S);S.addEventListener(_,(function W(fe){R.once&&S.removeEventListener(_,W),M(fe)}))}}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(S){if(typeof S!="number"||S<0||r(S))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+S+".");c=S}}),i.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(S){if(typeof S!="number"||S<0||r(S))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+S+".");return this._maxListeners=S,this},i.prototype.getMaxListeners=function(){return f(this)},i.prototype.emit=function(S){for(var _=[],M=1;M<arguments.length;M++)_.push(arguments[M]);var R=S==="error",W=this._events;if(W!==void 0)R=R&&W.error===void 0;else if(!R)return!1;if(R){var fe;if(_.length>0&&(fe=_[0]),fe instanceof Error)throw fe;var ye=new Error("Unhandled error."+(fe?" ("+fe.message+")":""));throw ye.context=fe,ye}var Y=W[S];if(Y===void 0)return!1;if(typeof Y=="function")n(Y,this,_);else{var j=Y.length,se=m(Y,j);for(M=0;M<j;++M)n(se[M],this,_)}return!0},i.prototype.addListener=function(S,_){return g(this,S,_,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(S,_){return g(this,S,_,!0)},i.prototype.once=function(S,_){return h(_),this.on(S,u(this,S,_)),this},i.prototype.prependOnceListener=function(S,_){return h(_),this.prependListener(S,u(this,S,_)),this},i.prototype.removeListener=function(S,_){var M,R,W,fe,ye;if(h(_),(R=this._events)===void 0)return this;if((M=R[S])===void 0)return this;if(M===_||M.listener===_)--this._eventsCount==0?this._events=Object.create(null):(delete R[S],R.removeListener&&this.emit("removeListener",S,M.listener||_));else if(typeof M!="function"){for(W=-1,fe=M.length-1;fe>=0;fe--)if(M[fe]===_||M[fe].listener===_){ye=M[fe].listener,W=fe;break}if(W<0)return this;W===0?M.shift():(function(Y,j){for(;j+1<Y.length;j++)Y[j]=Y[j+1];Y.pop()})(M,W),M.length===1&&(R[S]=M[0]),R.removeListener!==void 0&&this.emit("removeListener",S,ye||_)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(S){var _,M,R;if((M=this._events)===void 0)return this;if(M.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):M[S]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete M[S]),this;if(arguments.length===0){var W,fe=Object.keys(M);for(R=0;R<fe.length;++R)(W=fe[R])!=="removeListener"&&this.removeAllListeners(W);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(_=M[S])=="function")this.removeListener(S,_);else if(_!==void 0)for(R=_.length-1;R>=0;R--)this.removeListener(S,_[R]);return this},i.prototype.listeners=function(S){return l(this,S,!0)},i.prototype.rawListeners=function(S){return l(this,S,!1)},i.listenerCount=function(S,_){return typeof S.listenerCount=="function"?S.listenerCount(_):d.call(S,_)},i.prototype.listenerCount=d,i.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]}},7316:function(o){o.exports=function e(t,n){if(t===n)return!0;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return!1;var r,i,c;if(Array.isArray(t)){if((r=t.length)!=n.length)return!1;for(i=r;i--!=0;)if(!e(t[i],n[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((r=(c=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(i=r;i--!=0;)if(!Object.prototype.hasOwnProperty.call(n,c[i]))return!1;for(i=r;i--!=0;){var h=c[i];if(!e(t[h],n[h]))return!1}return!0}return t!=t&&n!=n}},7986:function(o,e){e.read=function(t,n,r,i,c){var h,f,g=8*c-i-1,y=(1<<g)-1,u=y>>1,l=-7,d=r?c-1:0,m=r?-1:1,E=t[n+d];for(d+=m,h=E&(1<<-l)-1,E>>=-l,l+=g;l>0;h=256*h+t[n+d],d+=m,l-=8);for(f=h&(1<<-l)-1,h>>=-l,l+=i;l>0;f=256*f+t[n+d],d+=m,l-=8);if(h===0)h=1-u;else{if(h===y)return f?NaN:1/0*(E?-1:1);f+=Math.pow(2,i),h-=u}return(E?-1:1)*f*Math.pow(2,h-i)},e.write=function(t,n,r,i,c,h){var f,g,y,u=8*h-c-1,l=(1<<u)-1,d=l>>1,m=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,E=i?0:h-1,S=i?1:-1,_=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(g=isNaN(n)?1:0,f=l):(f=Math.floor(Math.log(n)/Math.LN2),n*(y=Math.pow(2,-f))<1&&(f--,y*=2),(n+=f+d>=1?m/y:m*Math.pow(2,1-d))*y>=2&&(f++,y/=2),f+d>=l?(g=0,f=l):f+d>=1?(g=(n*y-1)*Math.pow(2,c),f+=d):(g=n*Math.pow(2,d-1)*Math.pow(2,c),f=0));c>=8;t[r+E]=255&g,E+=S,g/=256,c-=8);for(f=f<<c|g,u+=c;u>0;t[r+E]=255&f,E+=S,f/=256,u-=8);t[r+E-S]|=128*_}},5474:function(o,e,t){(function(n){n.parser=function(k,L){return new c(k,L)},n.SAXParser=c,n.SAXStream=f,n.createStream=function(k,L){return new f(k,L)},n.MAX_BUFFER_LENGTH=65536;var r,i=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function c(k,L){if(!(this instanceof c))return new c(k,L);var ne=this;(function(H){for(var De=0,Ye=i.length;De<Ye;De++)H[i[De]]=""})(ne),ne.q=ne.c="",ne.bufferCheckPosition=n.MAX_BUFFER_LENGTH,ne.opt=L||{},ne.opt.lowercase=ne.opt.lowercase||ne.opt.lowercasetags,ne.looseCase=ne.opt.lowercase?"toLowerCase":"toUpperCase",ne.tags=[],ne.closed=ne.closedRoot=ne.sawRoot=!1,ne.tag=ne.error=null,ne.strict=!!k,ne.noscript=!(!k&&!ne.opt.noscript),ne.state=de.BEGIN,ne.strictEntities=ne.opt.strictEntities,ne.ENTITIES=ne.strictEntities?Object.create(n.XML_ENTITIES):Object.create(n.ENTITIES),ne.attribList=[],ne.opt.xmlns&&(ne.ns=Object.create(M)),ne.trackPosition=ne.opt.position!==!1,ne.trackPosition&&(ne.position=ne.line=ne.column=0),ce(ne,"onready")}n.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(k){function L(){}return L.prototype=k,new L}),Object.keys||(Object.keys=function(k){var L=[];for(var ne in k)k.hasOwnProperty(ne)&&L.push(ne);return L}),c.prototype={end:function(){et(this)},write:function(k){var L=this;if(this.error)throw this.error;if(L.closed)return He(L,"Cannot write after close. Assign an onready handler.");if(k===null)return et(L);typeof k=="object"&&(k=k.toString());for(var ne=0,H="";H=z(k,ne++),L.c=H,H;)switch(L.trackPosition&&(L.position++,H===`
`?(L.line++,L.column=0):L.column++),L.state){case de.BEGIN:if(L.state=de.BEGIN_WHITESPACE,H==="\uFEFF")continue;O(L,H);continue;case de.BEGIN_WHITESPACE:O(L,H);continue;case de.TEXT:if(L.sawRoot&&!L.closedRoot){for(var De=ne-1;H&&H!=="<"&&H!=="&";)(H=z(k,ne++))&&L.trackPosition&&(L.position++,H===`
`?(L.line++,L.column=0):L.column++);L.textNode+=k.substring(De,ne-1)}H!=="<"||L.sawRoot&&L.closedRoot&&!L.strict?(!se(g,H)||L.sawRoot&&!L.closedRoot||Ve(L,"Text data outside of root node."),H==="&"?L.state=de.TEXT_ENTITY:L.textNode+=H):(L.state=de.OPEN_WAKA,L.startTagPosition=L.position);continue;case de.SCRIPT:H==="<"?L.state=de.SCRIPT_ENDING:L.script+=H;continue;case de.SCRIPT_ENDING:H==="/"?L.state=de.CLOSE_TAG:(L.script+="<"+H,L.state=de.SCRIPT);continue;case de.OPEN_WAKA:if(H==="!")L.state=de.SGML_DECL,L.sgmlDecl="";else if(!j(g,H))if(j(R,H))L.state=de.OPEN_TAG,L.tagName=H;else if(H==="/")L.state=de.CLOSE_TAG,L.tagName="";else if(H==="?")L.state=de.PROC_INST,L.procInstName=L.procInstBody="";else{if(Ve(L,"Unencoded <"),L.startTagPosition+1<L.position){var Ye=L.position-L.startTagPosition;H=new Array(Ye).join(" ")+H}L.textNode+="<"+H,L.state=de.TEXT}continue;case de.SGML_DECL:(L.sgmlDecl+H).toUpperCase()===m?(he(L,"onopencdata"),L.state=de.CDATA,L.sgmlDecl="",L.cdata=""):L.sgmlDecl+H==="--"?(L.state=de.COMMENT,L.comment="",L.sgmlDecl=""):(L.sgmlDecl+H).toUpperCase()===E?(L.state=de.DOCTYPE,(L.doctype||L.sawRoot)&&Ve(L,"Inappropriately located doctype declaration"),L.doctype="",L.sgmlDecl=""):H===">"?(he(L,"onsgmldeclaration",L.sgmlDecl),L.sgmlDecl="",L.state=de.TEXT):(j(l,H)&&(L.state=de.SGML_DECL_QUOTED),L.sgmlDecl+=H);continue;case de.SGML_DECL_QUOTED:H===L.q&&(L.state=de.SGML_DECL,L.q=""),L.sgmlDecl+=H;continue;case de.DOCTYPE:H===">"?(L.state=de.TEXT,he(L,"ondoctype",L.doctype),L.doctype=!0):(L.doctype+=H,H==="["?L.state=de.DOCTYPE_DTD:j(l,H)&&(L.state=de.DOCTYPE_QUOTED,L.q=H));continue;case de.DOCTYPE_QUOTED:L.doctype+=H,H===L.q&&(L.q="",L.state=de.DOCTYPE);continue;case de.DOCTYPE_DTD:L.doctype+=H,H==="]"?L.state=de.DOCTYPE:j(l,H)&&(L.state=de.DOCTYPE_DTD_QUOTED,L.q=H);continue;case de.DOCTYPE_DTD_QUOTED:L.doctype+=H,H===L.q&&(L.state=de.DOCTYPE_DTD,L.q="");continue;case de.COMMENT:H==="-"?L.state=de.COMMENT_ENDING:L.comment+=H;continue;case de.COMMENT_ENDING:H==="-"?(L.state=de.COMMENT_ENDED,L.comment=$e(L.opt,L.comment),L.comment&&he(L,"oncomment",L.comment),L.comment=""):(L.comment+="-"+H,L.state=de.COMMENT);continue;case de.COMMENT_ENDED:H!==">"?(Ve(L,"Malformed comment"),L.comment+="--"+H,L.state=de.COMMENT):L.state=de.TEXT;continue;case de.CDATA:H==="]"?L.state=de.CDATA_ENDING:L.cdata+=H;continue;case de.CDATA_ENDING:H==="]"?L.state=de.CDATA_ENDING_2:(L.cdata+="]"+H,L.state=de.CDATA);continue;case de.CDATA_ENDING_2:H===">"?(L.cdata&&he(L,"oncdata",L.cdata),he(L,"onclosecdata"),L.cdata="",L.state=de.TEXT):H==="]"?L.cdata+="]":(L.cdata+="]]"+H,L.state=de.CDATA);continue;case de.PROC_INST:H==="?"?L.state=de.PROC_INST_ENDING:j(g,H)?L.state=de.PROC_INST_BODY:L.procInstName+=H;continue;case de.PROC_INST_BODY:if(!L.procInstBody&&j(g,H))continue;H==="?"?L.state=de.PROC_INST_ENDING:L.procInstBody+=H;continue;case de.PROC_INST_ENDING:H===">"?(he(L,"onprocessinginstruction",{name:L.procInstName,body:L.procInstBody}),L.procInstName=L.procInstBody="",L.state=de.TEXT):(L.procInstBody+="?"+H,L.state=de.PROC_INST_BODY);continue;case de.OPEN_TAG:j(W,H)?L.tagName+=H:(Et(L),H===">"?Ie(L):H==="/"?L.state=de.OPEN_TAG_SLASH:(se(g,H)&&Ve(L,"Invalid character in tag name"),L.state=de.ATTRIB));continue;case de.OPEN_TAG_SLASH:H===">"?(Ie(L,!0),pe(L)):(Ve(L,"Forward-slash in opening tag not followed by >"),L.state=de.ATTRIB);continue;case de.ATTRIB:if(j(g,H))continue;H===">"?Ie(L):H==="/"?L.state=de.OPEN_TAG_SLASH:j(R,H)?(L.attribName=H,L.attribValue="",L.state=de.ATTRIB_NAME):Ve(L,"Invalid attribute name");continue;case de.ATTRIB_NAME:H==="="?L.state=de.ATTRIB_VALUE:H===">"?(Ve(L,"Attribute without value"),L.attribValue=L.attribName,$t(L),Ie(L)):j(g,H)?L.state=de.ATTRIB_NAME_SAW_WHITE:j(W,H)?L.attribName+=H:Ve(L,"Invalid attribute name");continue;case de.ATTRIB_NAME_SAW_WHITE:if(H==="=")L.state=de.ATTRIB_VALUE;else{if(j(g,H))continue;Ve(L,"Attribute without value"),L.tag.attributes[L.attribName]="",L.attribValue="",he(L,"onattribute",{name:L.attribName,value:""}),L.attribName="",H===">"?Ie(L):j(R,H)?(L.attribName=H,L.state=de.ATTRIB_NAME):(Ve(L,"Invalid attribute name"),L.state=de.ATTRIB)}continue;case de.ATTRIB_VALUE:if(j(g,H))continue;j(l,H)?(L.q=H,L.state=de.ATTRIB_VALUE_QUOTED):(Ve(L,"Unquoted attribute value"),L.state=de.ATTRIB_VALUE_UNQUOTED,L.attribValue=H);continue;case de.ATTRIB_VALUE_QUOTED:if(H!==L.q){H==="&"?L.state=de.ATTRIB_VALUE_ENTITY_Q:L.attribValue+=H;continue}$t(L),L.q="",L.state=de.ATTRIB_VALUE_CLOSED;continue;case de.ATTRIB_VALUE_CLOSED:j(g,H)?L.state=de.ATTRIB:H===">"?Ie(L):H==="/"?L.state=de.OPEN_TAG_SLASH:j(R,H)?(Ve(L,"No whitespace between attributes"),L.attribName=H,L.attribValue="",L.state=de.ATTRIB_NAME):Ve(L,"Invalid attribute name");continue;case de.ATTRIB_VALUE_UNQUOTED:if(se(d,H)){H==="&"?L.state=de.ATTRIB_VALUE_ENTITY_U:L.attribValue+=H;continue}$t(L),H===">"?Ie(L):L.state=de.ATTRIB;continue;case de.CLOSE_TAG:if(L.tagName)H===">"?pe(L):j(W,H)?L.tagName+=H:L.script?(L.script+="</"+L.tagName,L.tagName="",L.state=de.SCRIPT):(se(g,H)&&Ve(L,"Invalid tagname in closing tag"),L.state=de.CLOSE_TAG_SAW_WHITE);else{if(j(g,H))continue;se(R,H)?L.script?(L.script+="</"+H,L.state=de.SCRIPT):Ve(L,"Invalid tagname in closing tag."):L.tagName=H}continue;case de.CLOSE_TAG_SAW_WHITE:if(j(g,H))continue;H===">"?pe(L):Ve(L,"Invalid characters in closing tag");continue;case de.TEXT_ENTITY:case de.ATTRIB_VALUE_ENTITY_Q:case de.ATTRIB_VALUE_ENTITY_U:var qe,Fe;switch(L.state){case de.TEXT_ENTITY:qe=de.TEXT,Fe="textNode";break;case de.ATTRIB_VALUE_ENTITY_Q:qe=de.ATTRIB_VALUE_QUOTED,Fe="attribValue";break;case de.ATTRIB_VALUE_ENTITY_U:qe=de.ATTRIB_VALUE_UNQUOTED,Fe="attribValue"}H===";"?(L[Fe]+=Be(L),L.entity="",L.state=qe):j(L.entity.length?ye:fe,H)?L.entity+=H:(Ve(L,"Invalid character in entity name"),L[Fe]+="&"+L.entity+H,L.entity="",L.state=qe);continue;default:throw new Error(L,"Unknown state: "+L.state)}return L.position>=L.bufferCheckPosition&&(function(Ue){for(var Ke=Math.max(n.MAX_BUFFER_LENGTH,10),tt=0,nt=0,dt=i.length;nt<dt;nt++){var Gt=Ue[i[nt]].length;if(Gt>Ke)switch(i[nt]){case"textNode":Pe(Ue);break;case"cdata":he(Ue,"oncdata",Ue.cdata),Ue.cdata="";break;case"script":he(Ue,"onscript",Ue.script),Ue.script="";break;default:He(Ue,"Max buffer length exceeded: "+i[nt])}tt=Math.max(tt,Gt)}var vt=n.MAX_BUFFER_LENGTH-tt;Ue.bufferCheckPosition=vt+Ue.position})(L),L},resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){var k;Pe(k=this),k.cdata!==""&&(he(k,"oncdata",k.cdata),k.cdata=""),k.script!==""&&(he(k,"onscript",k.script),k.script="")}};try{r=t(3515).Stream}catch{r=function(){}}var h=n.EVENTS.filter((function(k){return k!=="error"&&k!=="end"}));function f(k,L){if(!(this instanceof f))return new f(k,L);r.apply(this),this._parser=new c(k,L),this.writable=!0,this.readable=!0;var ne=this;this._parser.onend=function(){ne.emit("end")},this._parser.onerror=function(H){ne.emit("error",H),ne._parser.error=null},this._decoder=null,h.forEach((function(H){Object.defineProperty(ne,"on"+H,{get:function(){return ne._parser["on"+H]},set:function(De){if(!De)return ne.removeAllListeners(H),ne._parser["on"+H]=De,De;ne.on(H,De)},enumerable:!0,configurable:!1})}))}f.prototype=Object.create(r.prototype,{constructor:{value:f}}),f.prototype.write=function(k){if(typeof Buffer=="function"&&typeof Buffer.isBuffer=="function"&&Buffer.isBuffer(k)){if(!this._decoder){var L=t(748).StringDecoder;this._decoder=new L("utf8")}k=this._decoder.write(k)}return this._parser.write(k.toString()),this.emit("data",k),!0},f.prototype.end=function(k){return k&&k.length&&this.write(k),this._parser.end(),!0},f.prototype.on=function(k,L){var ne=this;return ne._parser["on"+k]||h.indexOf(k)===-1||(ne._parser["on"+k]=function(){var H=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);H.splice(0,0,k),ne.emit.apply(ne,H)}),r.prototype.on.call(ne,k,L)};var g=`\r
	 `,y="0124356789",u="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",l=`'"`,d=g+">",m="[CDATA[",E="DOCTYPE",S="http://www.w3.org/XML/1998/namespace",_="http://www.w3.org/2000/xmlns/",M={xml:S,xmlns:_};g=Y(g),y=Y(y),u=Y(u);var R=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,W=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/,fe=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,ye=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/;function Y(k){return k.split("").reduce((function(L,ne){return L[ne]=!0,L}),{})}function j(k,L){return(function(ne){return Object.prototype.toString.call(ne)==="[object RegExp]"})(k)?!!L.match(k):k[L]}function se(k,L){return!j(k,L)}l=Y(l),d=Y(d);var Te,Ae,ze,de=0;for(var we in n.STATE={BEGIN:de++,BEGIN_WHITESPACE:de++,TEXT:de++,TEXT_ENTITY:de++,OPEN_WAKA:de++,SGML_DECL:de++,SGML_DECL_QUOTED:de++,DOCTYPE:de++,DOCTYPE_QUOTED:de++,DOCTYPE_DTD:de++,DOCTYPE_DTD_QUOTED:de++,COMMENT_STARTING:de++,COMMENT:de++,COMMENT_ENDING:de++,COMMENT_ENDED:de++,CDATA:de++,CDATA_ENDING:de++,CDATA_ENDING_2:de++,PROC_INST:de++,PROC_INST_BODY:de++,PROC_INST_ENDING:de++,OPEN_TAG:de++,OPEN_TAG_SLASH:de++,ATTRIB:de++,ATTRIB_NAME:de++,ATTRIB_NAME_SAW_WHITE:de++,ATTRIB_VALUE:de++,ATTRIB_VALUE_QUOTED:de++,ATTRIB_VALUE_CLOSED:de++,ATTRIB_VALUE_UNQUOTED:de++,ATTRIB_VALUE_ENTITY_Q:de++,ATTRIB_VALUE_ENTITY_U:de++,CLOSE_TAG:de++,CLOSE_TAG_SAW_WHITE:de++,SCRIPT:de++,SCRIPT_ENDING:de++},n.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},n.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(n.ENTITIES).forEach((function(k){var L=n.ENTITIES[k],ne=typeof L=="number"?String.fromCharCode(L):L;n.ENTITIES[k]=ne})),n.STATE)n.STATE[n.STATE[we]]=we;function ce(k,L,ne){k[L]&&k[L](ne)}function he(k,L,ne){k.textNode&&Pe(k),ce(k,L,ne)}function Pe(k){k.textNode=$e(k.opt,k.textNode),k.textNode&&ce(k,"ontext",k.textNode),k.textNode=""}function $e(k,L){return k.trim&&(L=L.trim()),k.normalize&&(L=L.replace(/\s+/g," ")),L}function He(k,L){return Pe(k),k.trackPosition&&(L+=`
Line: `+k.line+`
Column: `+k.column+`
Char: `+k.c),L=new Error(L),k.error=L,ce(k,"onerror",L),k}function et(k){return k.sawRoot&&!k.closedRoot&&Ve(k,"Unclosed root tag"),k.state!==de.BEGIN&&k.state!==de.BEGIN_WHITESPACE&&k.state!==de.TEXT&&He(k,"Unexpected end"),Pe(k),k.c="",k.closed=!0,ce(k,"onend"),c.call(k,k.strict,k.opt),k}function Ve(k,L){if(typeof k!="object"||!(k instanceof c))throw new Error("bad call to strictFail");k.strict&&He(k,L)}function Et(k){k.strict||(k.tagName=k.tagName[k.looseCase]());var L=k.tags[k.tags.length-1]||k,ne=k.tag={name:k.tagName,attributes:{}};k.opt.xmlns&&(ne.ns=L.ns),k.attribList.length=0,he(k,"onopentagstart",ne)}function Nt(k,L){var ne=k.indexOf(":")<0?["",k]:k.split(":"),H=ne[0],De=ne[1];return L&&k==="xmlns"&&(H="xmlns",De=""),{prefix:H,local:De}}function $t(k){if(k.strict||(k.attribName=k.attribName[k.looseCase]()),k.attribList.indexOf(k.attribName)!==-1||k.tag.attributes.hasOwnProperty(k.attribName))k.attribName=k.attribValue="";else{if(k.opt.xmlns){var L=Nt(k.attribName,!0),ne=L.prefix,H=L.local;if(ne==="xmlns")if(H==="xml"&&k.attribValue!==S)Ve(k,"xml: prefix must be bound to "+S+`
Actual: `+k.attribValue);else if(H==="xmlns"&&k.attribValue!==_)Ve(k,"xmlns: prefix must be bound to "+_+`
Actual: `+k.attribValue);else{var De=k.tag,Ye=k.tags[k.tags.length-1]||k;De.ns===Ye.ns&&(De.ns=Object.create(Ye.ns)),De.ns[H]=k.attribValue}k.attribList.push([k.attribName,k.attribValue])}else k.tag.attributes[k.attribName]=k.attribValue,he(k,"onattribute",{name:k.attribName,value:k.attribValue});k.attribName=k.attribValue=""}}function Ie(k,L){if(k.opt.xmlns){var ne=k.tag,H=Nt(k.tagName);ne.prefix=H.prefix,ne.local=H.local,ne.uri=ne.ns[H.prefix]||"",ne.prefix&&!ne.uri&&(Ve(k,"Unbound namespace prefix: "+JSON.stringify(k.tagName)),ne.uri=H.prefix);var De=k.tags[k.tags.length-1]||k;ne.ns&&De.ns!==ne.ns&&Object.keys(ne.ns).forEach((function(Tt){he(k,"onopennamespace",{prefix:Tt,uri:ne.ns[Tt]})}));for(var Ye=0,qe=k.attribList.length;Ye<qe;Ye++){var Fe=k.attribList[Ye],Ue=Fe[0],Ke=Fe[1],tt=Nt(Ue,!0),nt=tt.prefix,dt=tt.local,Gt=nt===""?"":ne.ns[nt]||"",vt={name:Ue,value:Ke,prefix:nt,local:dt,uri:Gt};nt&&nt!=="xmlns"&&!Gt&&(Ve(k,"Unbound namespace prefix: "+JSON.stringify(nt)),vt.uri=nt),k.tag.attributes[Ue]=vt,he(k,"onattribute",vt)}k.attribList.length=0}k.tag.isSelfClosing=!!L,k.sawRoot=!0,k.tags.push(k.tag),he(k,"onopentag",k.tag),L||(k.noscript||k.tagName.toLowerCase()!=="script"?k.state=de.TEXT:k.state=de.SCRIPT,k.tag=null,k.tagName=""),k.attribName=k.attribValue="",k.attribList.length=0}function pe(k){if(!k.tagName)return Ve(k,"Weird empty close tag."),k.textNode+="</>",void(k.state=de.TEXT);if(k.script){if(k.tagName!=="script")return k.script+="</"+k.tagName+">",k.tagName="",void(k.state=de.SCRIPT);he(k,"onscript",k.script),k.script=""}var L=k.tags.length,ne=k.tagName;k.strict||(ne=ne[k.looseCase]());for(var H=ne;L--&&k.tags[L].name!==H;)Ve(k,"Unexpected close tag");if(L<0)return Ve(k,"Unmatched closing tag: "+k.tagName),k.textNode+="</"+k.tagName+">",void(k.state=de.TEXT);k.tagName=ne;for(var De=k.tags.length;De-- >L;){var Ye=k.tag=k.tags.pop();k.tagName=k.tag.name,he(k,"onclosetag",k.tagName);var qe={};for(var Fe in Ye.ns)qe[Fe]=Ye.ns[Fe];var Ue=k.tags[k.tags.length-1]||k;k.opt.xmlns&&Ye.ns!==Ue.ns&&Object.keys(Ye.ns).forEach((function(Ke){var tt=Ye.ns[Ke];he(k,"onclosenamespace",{prefix:Ke,uri:tt})}))}L===0&&(k.closedRoot=!0),k.tagName=k.attribValue=k.attribName="",k.attribList.length=0,k.state=de.TEXT}function Be(k){var L,ne=k.entity,H=ne.toLowerCase(),De="";return k.ENTITIES[ne]?k.ENTITIES[ne]:k.ENTITIES[H]?k.ENTITIES[H]:((ne=H).charAt(0)==="#"&&(ne.charAt(1)==="x"?(ne=ne.slice(2),De=(L=parseInt(ne,16)).toString(16)):(ne=ne.slice(1),De=(L=parseInt(ne,10)).toString(10))),ne=ne.replace(/^0+/,""),De.toLowerCase()!==ne?(Ve(k,"Invalid character entity"),"&"+k.entity+";"):String.fromCodePoint(L))}function O(k,L){L==="<"?(k.state=de.OPEN_WAKA,k.startTagPosition=k.position):se(g,L)&&(Ve(k,"Non-whitespace before first tag."),k.textNode=L,k.state=de.TEXT)}function z(k,L){var ne="";return L<k.length&&(ne=k.charAt(L)),ne}de=n.STATE,String.fromCodePoint||(Te=String.fromCharCode,Ae=Math.floor,ze=function(){var k,L,ne=[],H=-1,De=arguments.length;if(!De)return"";for(var Ye="";++H<De;){var qe=Number(arguments[H]);if(!isFinite(qe)||qe<0||qe>1114111||Ae(qe)!==qe)throw RangeError("Invalid code point: "+qe);qe<=65535?ne.push(qe):(k=55296+((qe-=65536)>>10),L=qe%1024+56320,ne.push(k,L)),(H+1===De||ne.length>16384)&&(Ye+=Te.apply(null,ne),ne.length=0)}return Ye},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:ze,configurable:!0,writable:!0}):String.fromCodePoint=ze)})(e)},6739:function(o,e,t){(function(n,r,i,c,h){function f(z){if("contents"in z)for(var k=("styleAttrs"in z)?z.styleAttrs[c.byName.ruby.qname]:null,L=z.kind==="span"&&(k==="container"||k==="textContainer"||k==="baseContainer"),ne=z.contents.length-1;ne>=0;ne--)!L||"styleAttrs"in z.contents[ne]&&c.byName.ruby.qname in z.contents[ne].styleAttrs?f(z.contents[ne]):delete z.contents[ne]}function g(z,k,L,ne){var H=ne&&ne.timeContainer==="seq",De=0;ne&&(De=H&&L?L.end:ne.begin),k.begin=k.explicit_begin?k.explicit_begin+De:De;var Ye=k.begin,qe=null;if("sets"in k)for(var Fe=0;Fe<k.sets.length;Fe++)g(z,k.sets[Fe],qe,k),Ye=k.timeContainer==="seq"?k.sets[Fe].end:Math.max(Ye,k.sets[Fe].end),qe=k.sets[Fe];if("contents"in k){if("contents"in k)for(var Ue=0;Ue<k.contents.length;Ue++)g(z,k.contents[Ue],qe,k),Ye=k.timeContainer==="seq"?k.contents[Ue].end:Math.max(Ye,k.contents[Ue].end),qe=k.contents[Ue]}else Ye=H?k.begin:Number.POSITIVE_INFINITY;k.explicit_end!==null&&k.explicit_dur!==null?k.end=Math.min(k.begin+k.explicit_dur,De+k.explicit_end):k.explicit_end===null&&k.explicit_dur!==null?k.end=k.begin+k.explicit_dur:k.explicit_end!==null&&k.explicit_dur===null?k.end=De+k.explicit_end:k.end=Ye,delete k.explicit_begin,delete k.explicit_dur,delete k.explicit_end,z._registerEvent(k)}function y(z){this.node=z}function u(){this.events=[],this.head=new l,this.body=null}function l(){this.styling=new d,this.layout=new S}function d(){this.styles={},this.initials={}}function m(){this.id=null,this.styleAttrs=null,this.styleRefs=null}function E(){this.styleAttrs=null}function S(){this.regions={}}function _(z,k){M.call(this,"image"),this.src=z,this.type=k}function M(z){this.kind=z}function R(z){this.id=z}function W(z){this.regionID=z}function fe(z){this.styleAttrs=z}function ye(z){this.sets=z}function Y(z){this.contents=z}function j(z,k,L){this.explicit_begin=z,this.explicit_end=k,this.explicit_dur=L}function se(){M.call(this,"body")}function Te(){M.call(this,"div")}function Ae(){M.call(this,"p")}function ze(){M.call(this,"span")}function de(){M.call(this,"span")}function we(){M.call(this,"br")}function ce(){}function he(){}function Pe(z){return z&&"xml:id"in z.attributes&&z.attributes["xml:id"].value||null}function $e(z){return z&&"style"in z.attributes?z.attributes.style.value.split(" "):[]}function He(z,k){var L={};if(z!==null)for(var ne in z.attributes){var H=z.attributes[ne].uri+" "+z.attributes[ne].local,De=c.byQName[H];if(De!==void 0){var Ye=De.parse(z.attributes[ne].value);Ye!==null?(L[H]=Ye,De===c.byName.zIndex&&Ie(k,"zIndex attribute present but not used by IMSC1 since regions do not overlap")):pe(k,"Cannot parse styling attribute "+H+" --> "+z.attributes[ne].value)}}return L}function et(z,k,L){for(var ne in z.attributes)if(z.attributes[ne].uri===k&&z.attributes[ne].local===L)return z.attributes[ne].value;return null}function Ve(z,k,L){var ne,H=null;return(ne=/^(\d+(?:\.\d+)?)f$/.exec(L))!==null?k!==null&&(H=parseFloat(ne[1])/k):(ne=/^(\d+(?:\.\d+)?)t$/.exec(L))!==null?z!==null&&(H=parseFloat(ne[1])/z):(ne=/^(\d+(?:\.\d+)?)ms$/.exec(L))!==null?H=parseFloat(ne[1])/1e3:(ne=/^(\d+(?:\.\d+)?)s$/.exec(L))!==null?H=parseFloat(ne[1]):(ne=/^(\d+(?:\.\d+)?)h$/.exec(L))!==null?H=3600*parseFloat(ne[1]):(ne=/^(\d+(?:\.\d+)?)m$/.exec(L))!==null?H=60*parseFloat(ne[1]):(ne=/^(\d{2,}):(\d\d):(\d\d(?:\.\d+)?)$/.exec(L))!==null?H=3600*parseInt(ne[1])+60*parseInt(ne[2])+parseFloat(ne[3]):(ne=/^(\d{2,}):(\d\d):(\d\d)\:(\d{2,})$/.exec(L))!==null&&k!==null&&(H=3600*parseInt(ne[1])+60*parseInt(ne[2])+parseInt(ne[3])+(ne[4]===null?0:parseInt(ne[4])/k)),H}function Et(z,k,L){for(;k.styleRefs.length>0;){var ne=k.styleRefs.pop();ne in z.styles?(Et(z,z.styles[ne],L),$t(z.styles[ne].styleAttrs,k.styleAttrs)):pe(L,"Non-existant style id referenced")}}function Nt(z,k,L,ne){for(var H=k.length-1;H>=0;H--){var De=k[H];De in z.styles?$t(z.styles[De].styleAttrs,L):pe(ne,"Non-existant style id referenced")}}function $t(z,k){for(var L in z)z.hasOwnProperty(L)&&(L in k||(k[L]=z[L]))}function Ie(z,k){if(z&&z.warn&&z.warn(k))throw k}function pe(z,k){if(z&&z.error&&z.error(k))throw k}function Be(z,k){throw z&&z.fatal&&z.fatal(k),k}function O(z,k){for(var L,ne=0,H=z.length-1;ne<=H;){var De=z[L=Math.floor((ne+H)/2)];if(De<k)ne=L+1;else{if(!(De>k))return{found:!0,index:L};H=L-1}}return{found:!1,index:ne}}n.fromXML=function(z,k,L){var ne=r.parser(!0,{xmlns:!0}),H=[],De=[],Ye=[],qe=0,Fe=null;ne.onclosetag=function(dt){if(H[0]instanceof ce)Fe.head!==null&&Fe.head.styling!==null&&Nt(Fe.head.styling,H[0].styleRefs,H[0].styleAttrs,k),delete H[0].styleRefs;else if(H[0]instanceof d)for(var Gt in H[0].styles)H[0].styles.hasOwnProperty(Gt)&&Et(H[0],H[0].styles[Gt],k);else if(H[0]instanceof Ae||H[0]instanceof ze){if(H[0].contents.length>1){var vt,Tt=[H[0].contents[0]];for(vt=1;vt<H[0].contents.length;vt++)H[0].contents[vt]instanceof de&&Tt[Tt.length-1]instanceof de?Tt[Tt.length-1].text+=H[0].contents[vt].text:Tt.push(H[0].contents[vt]);H[0].contents=Tt}H[0]instanceof ze&&H[0].contents.length===1&&H[0].contents[0]instanceof de&&(H[0].text=H[0].contents[0].text,delete H[0].contents)}else H[0]instanceof y&&(H[0].node.uri===i.ns_tt&&H[0].node.local==="metadata"?qe--:qe>0&&L&&"onCloseTag"in L&&L.onCloseTag());Ye.shift(),De.shift(),H.shift()},ne.ontext=function(dt){if(H[0]!==void 0)if(H[0]instanceof ze||H[0]instanceof Ae){if(H[0]instanceof ze){var Gt=H[0].styleAttrs[c.byName.ruby.qname];if(Gt==="container"||Gt==="textContainer"||Gt==="baseContainer")return}var vt=new de;vt.initFromText(Fe,H[0],dt,De[0],Ye[0],k),H[0].contents.push(vt)}else H[0]instanceof y&&qe>0&&L&&"onText"in L&&L.onText(dt)},ne.onopentag=function(dt){var Gt=dt.attributes["xml:space"];Gt?Ye.unshift(Gt.value):Ye.length===0?Ye.unshift("default"):Ye.unshift(Ye[0]);var vt=dt.attributes["xml:lang"];if(vt?De.unshift(vt.value):De.length===0?De.unshift(""):De.unshift(De[0]),dt.uri===i.ns_tt)if(dt.local==="tt")Fe!==null&&Be(k,"Two <tt> elements at ("+this.line+","+this.column+")"),(Fe=new u).initFromNode(dt,De[0],k),H.unshift(Fe);else if(dt.local==="head")H[0]instanceof u||Be(k,"Parent of <head> element is not <tt> at ("+this.line+","+this.column+")"),H.unshift(Fe.head);else if(dt.local==="styling")H[0]instanceof l||Be(k,"Parent of <styling> element is not <head> at ("+this.line+","+this.column+")"),H.unshift(Fe.head.styling);else if(dt.local==="style"){var Tt;H[0]instanceof d?((Tt=new m).initFromNode(dt,k),Tt.id?Fe.head.styling.styles[Tt.id]=Tt:pe(k,"<style> element missing @id attribute"),H.unshift(Tt)):H[0]instanceof ce?((Tt=new m).initFromNode(dt,k),$t(Tt.styleAttrs,H[0].styleAttrs),H.unshift(Tt)):Be(k,"Parent of <style> element is not <styling> or <region> at ("+this.line+","+this.column+")")}else if(dt.local==="initial"){var yt;if(H[0]instanceof d){for(var Zt in(yt=new E).initFromNode(dt,k),yt.styleAttrs)yt.styleAttrs.hasOwnProperty(Zt)&&(Fe.head.styling.initials[Zt]=yt.styleAttrs[Zt]);H.unshift(yt)}else Be(k,"Parent of <initial> element is not <styling> at ("+this.line+","+this.column+")")}else if(dt.local==="layout")H[0]instanceof l||Be(k,"Parent of <layout> element is not <head> at "+this.line+","+this.column+")"),H.unshift(Fe.head.layout);else if(dt.local==="region"){H[0]instanceof S||Be(k,"Parent of <region> element is not <layout> at "+this.line+","+this.column+")");var _n=new ce;_n.initFromNode(Fe,dt,De[0],k),!_n.id||_n.id in Fe.head.layout.regions?pe(k,"Ignoring <region> with duplicate or missing @id at "+this.line+","+this.column+")"):Fe.head.layout.regions[_n.id]=_n,H.unshift(_n)}else if(dt.local==="body"){H[0]instanceof u||Be(k,"Parent of <body> element is not <tt> at "+this.line+","+this.column+")"),Fe.body!==null&&Be(k,"Second <body> element at "+this.line+","+this.column+")");var An=new se;An.initFromNode(Fe,dt,De[0],k),Fe.body=An,H.unshift(An)}else if(dt.local==="div"){H[0]instanceof Te||H[0]instanceof se||Be(k,"Parent of <div> element is not <body> or <div> at "+this.line+","+this.column+")");var Sn=new Te;Sn.initFromNode(Fe,H[0],dt,De[0],k);var wn=Sn.styleAttrs[c.byName.backgroundImage.qname];wn&&(Sn.contents.push(new _(wn)),delete Sn.styleAttrs[c.byName.backgroundImage.qname]),H[0].contents.push(Sn),H.unshift(Sn)}else if(dt.local==="image"){H[0]instanceof Te||Be(k,"Parent of <image> element is not <div> at "+this.line+","+this.column+")");var Rn=new _;Rn.initFromNode(Fe,H[0],dt,De[0],k),H[0].contents.push(Rn),H.unshift(Rn)}else if(dt.local==="p"){H[0]instanceof Te||Be(k,"Parent of <p> element is not <div> at "+this.line+","+this.column+")");var mt=new Ae;mt.initFromNode(Fe,H[0],dt,De[0],k),H[0].contents.push(mt),H.unshift(mt)}else if(dt.local==="span"){H[0]instanceof ze||H[0]instanceof Ae||Be(k,"Parent of <span> element is not <span> or <p> at "+this.line+","+this.column+")");var st=new ze;st.initFromNode(Fe,H[0],dt,De[0],Ye[0],k),H[0].contents.push(st),H.unshift(st)}else if(dt.local==="br"){H[0]instanceof ze||H[0]instanceof Ae||Be(k,"Parent of <br> element is not <span> or <p> at "+this.line+","+this.column+")");var it=new we;it.initFromNode(Fe,H[0],dt,De[0],k),H[0].contents.push(it),H.unshift(it)}else if(dt.local==="set"){H[0]instanceof ze||H[0]instanceof Ae||H[0]instanceof Te||H[0]instanceof se||H[0]instanceof ce||H[0]instanceof we||Be(k,"Parent of <set> element is not a content element or a region at "+this.line+","+this.column+")");var lt=new he;lt.initFromNode(Fe,H[0],dt,k),H[0].sets.push(lt),H.unshift(lt)}else H.unshift(new y(dt));else H.unshift(new y(dt));if(H[0]instanceof y){if(dt.uri===i.ns_tt&&dt.local==="metadata")qe++;else if(qe>0&&L&&"onOpenTag"in L){var ft=[];for(var kt in dt.attributes)ft[dt.attributes[kt].uri+" "+dt.attributes[kt].local]={uri:dt.attributes[kt].uri,local:dt.attributes[kt].local,value:dt.attributes[kt].value};L.onOpenTag(dt.uri,dt.local,ft)}}},ne.write(z).close(),delete Fe.head.styling.styles;var Ue=!1;for(var Ke in Fe.head.layout.regions)if(Fe.head.layout.regions.hasOwnProperty(Ke)){Ue=!0;break}if(!Ue){var tt=ce.prototype.createDefaultRegion(Fe.lang);Fe.head.layout.regions[tt.id]=tt}for(var nt in Fe.head.layout.regions)Fe.head.layout.regions.hasOwnProperty(nt)&&g(Fe,Fe.head.layout.regions[nt],null,null);return Fe.body&&g(Fe,Fe.body,null,null),Fe.body&&f(Fe.body),Fe},u.prototype.initFromNode=function(z,k,L){var ne=(function(qe,Fe){var Ue=et(qe,i.ns_ttp,"cellResolution"),Ke=15,tt=32;if(Ue!==null){var nt=/(\d+) (\d+)/.exec(Ue);nt!==null?(tt=parseInt(nt[1]),Ke=parseInt(nt[2])):Ie(Fe,"Malformed cellResolution value (using initial value instead)")}return{w:tt,h:Ke}})(z,L);this.cellLength={h:new h.ComputedLength(0,1/ne.h),w:new h.ComputedLength(1/ne.w,0)};var H=(function(qe,Fe){var Ue,Ke=et(qe,i.ns_ttp,"frameRate"),tt=30;Ke!==null&&((Ue=/(\d+)/.exec(Ke))!==null?tt=parseInt(Ue[1]):Ie(Fe,"Malformed frame rate attribute (using initial value instead)"));var nt=et(qe,i.ns_ttp,"frameRateMultiplier"),dt=1;nt!==null&&((Ue=/(\d+) (\d+)/.exec(nt))!==null?dt=parseInt(Ue[1])/parseInt(Ue[2]):Ie(Fe,"Malformed frame rate multiplier attribute (using initial value instead)"));var Gt=dt*tt,vt=1,Tt=et(qe,i.ns_ttp,"tickRate");return Tt===null?Ke!==null&&(vt=Gt):(Ue=/(\d+)/.exec(Tt))!==null?vt=parseInt(Ue[1]):Ie(Fe,"Malformed tick rate attribute (using initial value instead)"),{effectiveFrameRate:Gt,tickRate:vt}})(z,L);this.effectiveFrameRate=H.effectiveFrameRate,this.tickRate=H.tickRate,this.aspectRatio=(function(qe,Fe){var Ue=et(qe,i.ns_ittp,"aspectRatio");Ue===null&&(Ue=et(qe,i.ns_ttp,"displayAspectRatio"));var Ke=null;if(Ue!==null){var tt=/(\d+)\s+(\d+)/.exec(Ue);if(tt!==null){var nt=parseInt(tt[1]),dt=parseInt(tt[2]);nt!==0&&dt!==0?Ke=nt/dt:pe(Fe,"Illegal aspectRatio values (ignoring)")}else pe(Fe,"Malformed aspectRatio attribute (ignoring)")}return Ke})(z,L);var De=et(z,i.ns_ttp,"timeBase");De!==null&&De!=="media"&&Be(L,"Unsupported time base");var Ye=(function(qe,Fe){var Ue=et(qe,i.ns_tts,"extent");if(Ue===null)return null;var Ke=Ue.split(" ");if(Ke.length!==2)return Ie(Fe,"Malformed extent (ignoring)"),null;var tt=h.parseLength(Ke[0]),nt=h.parseLength(Ke[1]);return nt&&tt?{h:nt,w:tt}:(Ie(Fe,"Malformed extent values (ignoring)"),null)})(z,L);Ye===null?this.pxLength={h:null,w:null}:(Ye.h.unit==="px"&&Ye.w.unit==="px"||Be(L,"Extent on TT must be in px or absent"),this.pxLength={h:new h.ComputedLength(0,1/Ye.h.value),w:new h.ComputedLength(1/Ye.w.value,0)}),this.dimensions={h:new h.ComputedLength(0,1),w:new h.ComputedLength(1,0)},this.lang=k},u.prototype._registerEvent=function(z){if(!(z.end<=z.begin)){var k=O(this.events,z.begin);if(k.found||this.events.splice(k.index,0,z.begin),z.end!==Number.POSITIVE_INFINITY){var L=O(this.events,z.end);L.found||this.events.splice(L.index,0,z.end)}}},u.prototype.getMediaTimeRange=function(){return[this.events[0],this.events[this.events.length-1]]},u.prototype.getMediaTimeEvents=function(){return this.events},m.prototype.initFromNode=function(z,k){this.id=Pe(z),this.styleAttrs=He(z,k),this.styleRefs=$e(z)},E.prototype.initFromNode=function(z,k){for(var L in this.styleAttrs={},z.attributes)if(z.attributes[L].uri===i.ns_itts||z.attributes[L].uri===i.ns_ebutts||z.attributes[L].uri===i.ns_tts){var ne=z.attributes[L].uri+" "+z.attributes[L].local;this.styleAttrs[ne]=z.attributes[L].value}},_.prototype.initFromNode=function(z,k,L,ne,H){this.src="src"in L.attributes?L.attributes.src.value:null,this.src||pe(H,"Invalid image@src attribute"),this.type="type"in L.attributes?L.attributes.type.value:null,this.type||pe(H,"Invalid image@type attribute"),fe.prototype.initFromNode.call(this,z,k,L,H),j.prototype.initFromNode.call(this,z,k,L,H),ye.prototype.initFromNode.call(this,z,k,L,H),W.prototype.initFromNode.call(this,z,k,L,H),this.lang=ne},R.prototype.initFromNode=function(z,k,L,ne){this.id=Pe(L)},W.prototype.initFromNode=function(z,k,L,ne){this.regionID=(function(H){return H&&"region"in H.attributes?H.attributes.region.value:""})(L)},fe.prototype.initFromNode=function(z,k,L,ne){this.styleAttrs=He(L,ne),z.head!==null&&z.head.styling!==null&&Nt(z.head.styling,$e(L),this.styleAttrs,ne)},ye.prototype.initFromNode=function(z,k,L,ne){this.sets=[]},Y.prototype.initFromNode=function(z,k,L,ne){this.contents=[]},j.prototype.initFromNode=function(z,k,L,ne){var H=(function(De,Ye,qe,Fe){var Ue=null;qe&&"begin"in qe.attributes&&(Ue=Ve(De.tickRate,De.effectiveFrameRate,qe.attributes.begin.value))===null&&Ie(Fe,"Malformed begin value "+qe.attributes.begin.value+" (using 0)");var Ke=null;qe&&"dur"in qe.attributes&&(Ke=Ve(De.tickRate,De.effectiveFrameRate,qe.attributes.dur.value))===null&&Ie(Fe,"Malformed dur value "+qe.attributes.dur.value+" (ignoring)");var tt=null;return qe&&"end"in qe.attributes&&(tt=Ve(De.tickRate,De.effectiveFrameRate,qe.attributes.end.value))===null&&Ie(Fe,"Malformed end value (ignoring)"),{explicit_begin:Ue,explicit_end:tt,explicit_dur:Ke}})(z,0,L,ne);this.explicit_begin=H.explicit_begin,this.explicit_end=H.explicit_end,this.explicit_dur=H.explicit_dur,this.timeContainer=(function(De,Ye){var qe=De&&"timeContainer"in De.attributes?De.attributes.timeContainer.value:null;return qe&&qe!=="par"?qe==="seq"?"seq":(pe(Ye,"Illegal value of timeContainer (assuming 'par')"),"par"):"par"})(L,ne)},se.prototype.initFromNode=function(z,k,L,ne){fe.prototype.initFromNode.call(this,z,null,k,ne),j.prototype.initFromNode.call(this,z,null,k,ne),ye.prototype.initFromNode.call(this,z,null,k,ne),W.prototype.initFromNode.call(this,z,null,k,ne),Y.prototype.initFromNode.call(this,z,null,k,ne),this.lang=L},Te.prototype.initFromNode=function(z,k,L,ne,H){fe.prototype.initFromNode.call(this,z,k,L,H),j.prototype.initFromNode.call(this,z,k,L,H),ye.prototype.initFromNode.call(this,z,k,L,H),W.prototype.initFromNode.call(this,z,k,L,H),Y.prototype.initFromNode.call(this,z,k,L,H),this.lang=ne},Ae.prototype.initFromNode=function(z,k,L,ne,H){fe.prototype.initFromNode.call(this,z,k,L,H),j.prototype.initFromNode.call(this,z,k,L,H),ye.prototype.initFromNode.call(this,z,k,L,H),W.prototype.initFromNode.call(this,z,k,L,H),Y.prototype.initFromNode.call(this,z,k,L,H),this.lang=ne},ze.prototype.initFromNode=function(z,k,L,ne,H,De){fe.prototype.initFromNode.call(this,z,k,L,De),j.prototype.initFromNode.call(this,z,k,L,De),ye.prototype.initFromNode.call(this,z,k,L,De),W.prototype.initFromNode.call(this,z,k,L,De),Y.prototype.initFromNode.call(this,z,k,L,De),this.space=H,this.lang=ne},de.prototype.initFromText=function(z,k,L,ne,H,De){j.prototype.initFromNode.call(this,z,k,null,De),this.text=L,this.space=H,this.lang=ne},we.prototype.initFromNode=function(z,k,L,ne,H){W.prototype.initFromNode.call(this,z,k,L,H),j.prototype.initFromNode.call(this,z,k,L,H),this.lang=ne},ce.prototype.createDefaultRegion=function(z){var k=new ce;return R.call(k,""),fe.call(k,{}),ye.call(k,[]),j.call(k,0,Number.POSITIVE_INFINITY,null),this.lang=z,k},ce.prototype.initFromNode=function(z,k,L,ne){R.prototype.initFromNode.call(this,z,null,k,ne),j.prototype.initFromNode.call(this,z,null,k,ne),ye.prototype.initFromNode.call(this,z,null,k,ne),this.styleAttrs=He(k,ne),this.styleRefs=$e(k),this.lang=L},he.prototype.initFromNode=function(z,k,L,ne){j.prototype.initFromNode.call(this,z,k,L,ne);var H=He(L,ne);for(var De in this.qname=null,this.value=null,H)if(H.hasOwnProperty(De)){if(this.qname){pe(ne,"More than one style specified on set");break}this.qname=De,this.value=H[De]}}})(e,typeof sax>"u"?t(5474):sax,typeof imscNames>"u"?t(977):imscNames,typeof imscStyles>"u"?t(1219):imscStyles,typeof imscUtils>"u"?t(6404):imscUtils)},1612:function(o,e,t){var n=/firefox/i.test(navigator.userAgent);(function(r,i,c){function h(Y,j,se,Te){var Ae;if(se.kind==="region")(Ae=document.createElement("div")).style.position="absolute";else if(se.kind==="body")Ae=document.createElement("div");else if(se.kind==="div")Ae=document.createElement("div");else if(se.kind==="image"){if(Ae=document.createElement("img"),Y.imgResolver!==null&&se.src!==null){var ze=Y.imgResolver(se.src,Ae);ze&&(Ae.src=ze),Ae.height=Y.regionH,Ae.width=Y.regionW}}else if(se.kind==="p")Ae=document.createElement("p");else if(se.kind==="span")if(se.styleAttrs[c.byName.ruby.qname]==="container")Ae=document.createElement("ruby"),Y.ruby=!0;else if(se.styleAttrs[c.byName.ruby.qname]==="base")Ae=document.createElement("span");else if(se.styleAttrs[c.byName.ruby.qname]==="text")Ae=document.createElement("rt");else if(se.styleAttrs[c.byName.ruby.qname]==="baseContainer")Ae=document.createElement("rbc");else if(se.styleAttrs[c.byName.ruby.qname]==="textContainer")Ae=document.createElement("rtc");else{if(se.styleAttrs[c.byName.ruby.qname]==="delimiter")return;Ae=document.createElement("span")}else se.kind==="br"&&(Ae=document.createElement("br"));if(Ae){if(se.lang&&(se.kind!=="region"&&se.lang===Te.lang||(Ae.lang=se.lang)),j.appendChild(Ae),Ae.style.margin="0",se.kind==="region"){var de=se.styleAttrs[c.byName.writingMode.qname];de==="lrtb"||de==="lr"?(Y.ipd="lr",Y.bpd="tb"):de==="rltb"||de==="rl"?(Y.ipd="rl",Y.bpd="tb"):de==="tblr"?(Y.ipd="tb",Y.bpd="lr"):de!=="tbrl"&&de!=="tb"||(Y.ipd="tb",Y.bpd="rl")}else if(se.kind==="p"&&Y.bpd==="tb"){var we=se.styleAttrs[c.byName.direction.qname];Y.ipd=we==="ltr"?"lr":"rl"}for(var ce=0;ce<E.length;ce++){var he=E[ce],Pe=se.styleAttrs[he.qname];Pe!==void 0&&he.map!==null&&he.map(Y,Ae,se,Pe)}var $e=Ae,He=se.styleAttrs[c.byName.linePadding.qname];if(He&&!He.isZero()){var et=He.toUsedLength(Y.w,Y.h);if(et>0){var Ve=Math.ceil(et)+"px";Y.bpd==="tb"?($e.style.paddingLeft=Ve,$e.style.paddingRight=Ve):($e.style.paddingTop=Ve,$e.style.paddingBottom=Ve),Y.lp=He}}var Et=se.styleAttrs[c.byName.multiRowAlign.qname];if(Et&&Et!=="auto"){var Nt=document.createElement("span");Nt.style.display="inline-block",Nt.style.textAlign=Et,Ae.appendChild(Nt),$e=Nt,Y.mra=Et}var $t=se.styleAttrs[c.byName.rubyReserve.qname];if($t&&$t[0]!=="none"&&(Y.rubyReserve=$t),se.styleAttrs[c.byName.fillLineGap.qname]&&(Y.flg=!0),se.kind==="span"&&se.text){var Ie=se.styleAttrs[c.byName.textEmphasis.qname];if(Ie&&Ie.style!=="none"&&(Y.textEmphasis=!0),c.byName.textCombine.qname in se.styleAttrs&&se.styleAttrs[c.byName.textCombine.qname]==="all")Ae.textContent=se.text,Ae._isd_element=se,Ie&&d(Y,Ae,0,Ie);else for(var pe="",Be=0;Be<se.text.length;Be++){pe+=se.text.charAt(Be);var O=se.text.charCodeAt(Be);if(O<55296||O>56319||Be===se.text.length-1){var z=document.createElement("span");z.textContent=pe,Ie&&d(Y,z,0,Ie),Ae.appendChild(z),pe="",z._isd_element=se}}}if("contents"in se)for(var k=0;k<se.contents.length;k++)h(Y,$e,se.contents[k],se);var L=[];if(se.kind==="p"&&(l(Y,$e,L,null),Y.rubyReserve&&((function(qe,Fe){for(var Ue=0;Ue<qe.length;Ue++){var Ke,tt,nt=document.createElement("ruby"),dt=document.createElement("span");dt.textContent="â€‹",nt.appendChild(dt);var Gt,vt=Fe.rubyReserve[1].toUsedLength(Fe.w,Fe.h)+"px";Fe.rubyReserve[0]==="both"||Fe.rubyReserve[0]==="outside"&&qe.length==1?((Ke=document.createElement("rtc")).style[R]=M?"after":"under",Ke.textContent="â€‹",Ke.style.fontSize=vt,(tt=document.createElement("rtc")).style[R]=M?"before":"over",tt.textContent="â€‹",tt.style.fontSize=vt,nt.appendChild(Ke),nt.appendChild(tt)):((Ke=document.createElement("rtc")).textContent="â€‹",Ke.style.fontSize=vt,Gt=Fe.rubyReserve[0]==="after"||Fe.rubyReserve[0]==="outside"&&Ue>0?M?"after":Fe.bpd==="tb"||Fe.bpd==="rl"?"under":"over":M?"before":Fe.bpd==="tb"||Fe.bpd==="rl"?"over":"under",Ke.style[R]=Gt,nt.appendChild(Ke));for(var Tt=null,yt=0;yt<qe[Ue].rbc.length;yt++)if(qe[Ue].rbc[yt].localName==="ruby"){Tt=qe[Ue].rbc[yt];for(var Zt=0;Zt<Tt.style.length;Zt++)nt.style.setProperty(Tt.style.item(Zt),Tt.style.getPropertyValue(Tt.style.item(Zt)));break}(Tt=Tt||qe[Ue].elements[0].node).parentElement.insertBefore(nt,Tt)}})(L,Y),Y.rubyReserve=null),(Y.ruby||Y.rubyReserve)&&((function(qe,Fe){for(var Ue=0;Ue<qe.length;Ue++)for(var Ke=0;Ke<qe[Ue].rbc.length;Ke++){var tt;qe[Ue].rbc[Ke].style[R]||(tt=M?Ue===0?"before":"after":Fe.bpd==="tb"||Fe.bpd==="rl"?Ue===0?"over":"under":Ue===0?"under":"over",qe[Ue].rbc[Ke].style[R]=tt)}})(L,Y),Y.ruby=null),Y.textEmphasis&&((function(qe,Fe){for(var Ue=0;Ue<qe.length;Ue++)for(var Ke=0;Ke<qe[Ue].te.length;Ke++){var tt;qe[Ue].te[Ke].style[fe]&&qe[Ue].te[Ke].style[fe]!=="none"||(tt=Fe.bpd==="tb"?Ue===0?"left over":"left under":Fe.bpd==="rl"?Ue===0?"right under":"left under":Ue===0?"left under":"right under",qe[Ue].te[Ke].style[fe]=tt)}})(L,Y),Y.textEmphasis=null),Y.mra&&((function(qe){for(var Fe=0;Fe<qe.length-1;Fe++){var Ue=qe[Fe].elements.length;if(Ue!==0&&qe[Fe].br===!1){var Ke=document.createElement("br"),tt=qe[Fe].elements[Ue-1].node;tt.parentElement.insertBefore(Ke,tt.nextSibling)}}})(L),Y.mra=null),Y.lp&&((function(qe,Fe,Ue){if(qe!==null)for(var Ke=0;Ke<qe.length;Ke++){var tt=qe[Ke].elements.length,nt=Math.ceil(Fe)+"px",dt="-"+Math.ceil(Fe)+"px";if(tt!==0){var Gt=qe[Ke].elements[qe[Ke].start_elem],vt=qe[Ke].elements[qe[Ke].end_elem];if(Gt===vt){var Tt=Gt.node.getBoundingClientRect();if(Tt.width==0||Tt.height==0)continue}Ue.ipd==="lr"?(Gt.node.style.marginLeft=dt,Gt.node.style.paddingLeft=nt):Ue.ipd==="rl"?(Gt.node.style.paddingRight=nt,Gt.node.style.marginRight=dt):Ue.ipd==="tb"&&(Gt.node.style.paddingTop=nt,Gt.node.style.marginTop=dt),Ue.ipd==="lr"?(n||(vt.node.style.marginRight=dt),vt.node.style.paddingRight=nt):Ue.ipd==="rl"?(vt.node.style.paddingLeft=nt,n||(vt.node.style.marginLeft=dt)):Ue.ipd==="tb"&&(vt.node.style.paddingBottom=nt,vt.node.style.marginBottom=dt)}}})(L,Y.lp.toUsedLength(Y.w,Y.h),Y),Y.lp=null),(function(qe,Fe){for(var Ue=0;Ue<qe.length;Ue++)for(var Ke=qe[Ue],tt=1;tt<Ke.elements.length;){var nt=Ke.elements[tt-1],dt=Ke.elements[tt];g(nt.node,dt.node,Fe)?Ke.elements.splice(tt,1):tt++}for(var Gt,vt,Tt=[],yt=0;yt<qe.length;yt++)for(var Zt=0;Zt<qe[yt].elements.length;Zt++)(vt=f(Gt=qe[yt].elements[Zt].node,Tt,!1))&&(Gt.style.backgroundColor=vt);for(var _n=0;_n<Tt.length;_n++)Tt[_n].style.backgroundColor=""})(L,Y),Y.flg)){var ne=u($e.getBoundingClientRect(),Y);(function(qe,Fe,Ue,Ke){for(var tt=Math.sign(Ue-Fe),nt=0;nt<=qe.length;nt++){var dt,Gt,vt,Tt;if(dt=nt===0?Math.round(Fe):nt===qe.length?Math.round(Ue):Math.round((qe[nt-1].after+qe[nt].before)/2),nt>0&&qe[nt-1])for(vt=0;vt<qe[nt-1].elements.length;vt++)Gt=tt*(dt-(Tt=qe[nt-1].elements[vt]).after)+"px",Ke.bpd==="lr"?Tt.node.style.paddingRight=Gt:Ke.bpd==="rl"?Tt.node.style.paddingLeft=Gt:Ke.bpd==="tb"&&(Tt.node.style.paddingBottom=Gt);if(nt<qe.length)for(vt=0;vt<qe[nt].elements.length;vt++)Gt=tt*((Tt=qe[nt].elements[vt]).before-dt)+"px",Ke.bpd==="lr"?Tt.node.style.paddingLeft=Gt:Ke.bpd==="rl"?Tt.node.style.paddingRight=Gt:Ke.bpd==="tb"&&(Tt.node.style.paddingTop=Gt)}})(L,ne.before,ne.after,Y),Y.flg=null}if(se.kind==="region"&&Y.bpd==="tb"&&Y.enableRollUp&&se.contents.length>0&&se.styleAttrs[c.byName.displayAlign.qname]==="after"){l(Y,$e,L,null);var H=new y(se.id===""?"_":se.id,L);if(Y.currentISDState[H.id]=H,Y.previousISDState&&H.id in Y.previousISDState&&Y.previousISDState[H.id].plist.length>0&&H.plist.length>1&&H.plist[H.plist.length-2].text===Y.previousISDState[H.id].plist[Y.previousISDState[H.id].plist.length-1].text){var De=Ae.firstElementChild,Ye=H.plist[H.plist.length-1].after-H.plist[H.plist.length-1].before;De.style.bottom="-"+Ye+"px",De.style.transition="transform 0.4s",De.style.position="relative",De.style.transform="translateY(-"+Ye+"px)"}}}else ye(Y.errorHandler,"Error processing ISD element kind: "+se.kind)}function f(Y,j,se){return Y.style.backgroundColor?(se&&!j.includes(Y)&&j.push(Y),Y.style.backgroundColor):Y.parentElement.nodeName==="SPAN"||Y.parentElement.nodeName==="RUBY"||Y.parentElement.nodeName==="RBC"||Y.parentElement.nodeName==="RTC"||Y.parentElement.nodeName==="RT"?f(Y.parentElement,j,!0):void 0}function g(Y,j,se){if(Y.tagName==="SPAN"&&j.tagName==="SPAN"&&Y._isd_element===j._isd_element){if(!Y._isd_element)return ye(se.errorHandler,"Internal error: HTML span is not linked to a source element; cannot merge spans."),!1;Y.textContent+=j.textContent;for(var Te=0;Te<j.style.length;Te++){var Ae=j.style[Te];(Ae.indexOf("border")>=0||Ae.indexOf("padding")>=0||Ae.indexOf("margin")>=0)&&(Y.style[Ae]=j.style[Ae])}return j.parentElement.removeChild(j),!0}return!1}function y(Y,j){this.id=Y,this.plist=j}function u(Y,j){var se={before:null,after:null,start:null,end:null};return j.bpd==="tb"?(se.before=Y.top,se.after=Y.bottom,j.ipd==="lr"?(se.start=Y.left,se.end=Y.right):(se.start=Y.right,se.end=Y.left)):j.bpd==="lr"?(se.before=Y.left,se.after=Y.right,se.start=Y.top,se.end=Y.bottom):j.bpd==="rl"&&(se.before=Y.right,se.after=Y.left,se.start=Y.top,se.end=Y.bottom),se}function l(Y,j,se,Te){if(j.localName!=="rt"&&j.localName!=="rtc"){var Ae,ze,de,we,ce=j.style.backgroundColor||Te;if(j.childElementCount===0)if(j.localName==="span"||j.localName==="rb"){var he=u(j.getBoundingClientRect(),Y);if(se.length!==0&&(Ae=he.before,ze=he.after,de=se[se.length-1].before,ze<(we=se[se.length-1].after)&&Ae>de||we<=ze&&de>=Ae)){var Pe=Math.sign(he.after-he.before),$e=Math.sign(he.end-he.start);Pe*(he.before-se[se.length-1].before)<0&&(se[se.length-1].before=he.before),Pe*(he.after-se[se.length-1].after)>0&&(se[se.length-1].after=he.after),$e*(he.start-se[se.length-1].start)<0&&(se[se.length-1].start=he.start,se[se.length-1].start_elem=se[se.length-1].elements.length),$e*(he.end-se[se.length-1].end)>0&&(se[se.length-1].end=he.end,se[se.length-1].end_elem=se[se.length-1].elements.length)}else se.push({before:he.before,after:he.after,start:he.start,end:he.end,start_elem:0,end_elem:0,elements:[],rbc:[],te:[],text:"",br:!1});se[se.length-1].text+=j.textContent,se[se.length-1].elements.push({node:j,bgcolor:ce,before:he.before,after:he.after})}else j.localName==="br"&&se.length!==0&&(se[se.length-1].br=!0);else for(var He=j.firstChild;He;)He.nodeType===Node.ELEMENT_NODE&&(l(Y,He,se,ce),He.localName==="ruby"||He.localName==="rtc"?se.length>0&&se[se.length-1].rbc.push(He):He.localName==="span"&&He.style[W]&&He.style[W]!=="none"&&se.length>0&&se[se.length-1].te.push(He)),He=He.nextSibling}}function d(Y,j,se,Te){var Ae;Te.style!=="none"&&(Te.style==="auto"?j.style[W]="filled":j.style[W]=Te.style+" "+Te.symbol,(Te.position==="before"||Te.position==="after")&&(Ae=Y.bpd==="tb"?Te.position==="before"?"left over":"left under":Y.bpd==="rl"?Te.position==="before"?"right under":"left under":Te.position==="before"?"left under":"right under",j.style[fe]=Ae))}function m(Y,j){this.qname=Y,this.map=j}r.render=function(Y,j,se,Te,Ae,ze,de,we,ce){var he=Te||j.clientHeight,Pe=Ae||j.clientWidth;if(Y.aspectRatio!==null){var $e=he*Y.aspectRatio;$e>Pe?he=Math.round(Pe/Y.aspectRatio):Pe=$e}var He=document.createElement("div");He.style.position="relative",He.style.width=Pe+"px",He.style.height=he+"px",He.style.margin="auto",He.style.top=0,He.style.bottom=0,He.style.left=0,He.style.right=0,He.style.zIndex=0;var et={h:he,w:Pe,regionH:null,regionW:null,imgResolver:se,displayForcedOnlyMode:ze||!1,isd:Y,errorHandler:de,previousISDState:we,enableRollUp:ce||!1,currentISDState:{},flg:null,lp:null,mra:null,ipd:null,bpd:null,ruby:null,textEmphasis:null,rubyReserve:null};if(j.appendChild(He),"contents"in Y)for(var Ve=0;Ve<Y.contents.length;Ve++)h(et,He,Y.contents[Ve],Y);return et.currentISDState};for(var E=[new m("http://www.w3.org/ns/ttml#styling backgroundColor",(function(Y,j,se,Te){Te[3]!==0&&(j.style.backgroundColor="rgba("+Te[0].toString()+","+Te[1].toString()+","+Te[2].toString()+","+(Te[3]/255).toString()+")")})),new m("http://www.w3.org/ns/ttml#styling color",(function(Y,j,se,Te){j.style.color="rgba("+Te[0].toString()+","+Te[1].toString()+","+Te[2].toString()+","+(Te[3]/255).toString()+")"})),new m("http://www.w3.org/ns/ttml#styling direction",(function(Y,j,se,Te){j.style.direction=Te})),new m("http://www.w3.org/ns/ttml#styling display",(function(Y,j,se,Te){})),new m("http://www.w3.org/ns/ttml#styling displayAlign",(function(Y,j,se,Te){j.style.display="flex",j.style.flexDirection="column",Te==="before"?j.style.justifyContent="flex-start":Te==="center"?j.style.justifyContent="center":Te==="after"&&(j.style.justifyContent="flex-end")})),new m("http://www.w3.org/ns/ttml#styling extent",(function(Y,j,se,Te){Y.regionH=Te.h.toUsedLength(Y.w,Y.h),Y.regionW=Te.w.toUsedLength(Y.w,Y.h);var Ae=0,ze=0,de=se.styleAttrs["http://www.w3.org/ns/ttml#styling padding"];de&&(Ae=de[0].toUsedLength(Y.w,Y.h)+de[2].toUsedLength(Y.w,Y.h),ze=de[1].toUsedLength(Y.w,Y.h)+de[3].toUsedLength(Y.w,Y.h)),j.style.height=Y.regionH-Ae+"px",j.style.width=Y.regionW-ze+"px"})),new m("http://www.w3.org/ns/ttml#styling fontFamily",(function(Y,j,se,Te){for(var Ae=[],ze=0;ze<Te.length;ze++)Te[ze]=Te[ze].trim(),Te[ze]==="monospaceSerif"?(Ae.push("Courier New"),Ae.push('"Liberation Mono"'),Ae.push("Courier"),Ae.push("monospace")):Te[ze]==="proportionalSansSerif"?(Ae.push("Arial"),Ae.push("Helvetica"),Ae.push('"Liberation Sans"'),Ae.push("sans-serif")):Te[ze]==="monospace"?Ae.push("monospace"):Te[ze]==="sansSerif"?Ae.push("sans-serif"):Te[ze]==="serif"?Ae.push("serif"):Te[ze]==="monospaceSansSerif"?(Ae.push("Consolas"),Ae.push("monospace")):Te[ze]==="proportionalSerif"?Ae.push("serif"):Ae.push(Te[ze]);if(Ae.length>0){for(var de=[Ae[0]],we=1;we<Ae.length;we++)de.indexOf(Ae[we])==-1&&de.push(Ae[we]);Ae=de}j.style.fontFamily=Ae.join(",")})),new m("http://www.w3.org/ns/ttml#styling shear",(function(Y,j,se,Te){if(Te!==0){var Ae=-.9*Te;Y.bpd==="tb"?j.style.transform="skewX("+Ae+"deg)":j.style.transform="skewY("+Ae+"deg)"}})),new m("http://www.w3.org/ns/ttml#styling fontSize",(function(Y,j,se,Te){j.style.fontSize=Te.toUsedLength(Y.w,Y.h)+"px"})),new m("http://www.w3.org/ns/ttml#styling fontStyle",(function(Y,j,se,Te){j.style.fontStyle=Te})),new m("http://www.w3.org/ns/ttml#styling fontWeight",(function(Y,j,se,Te){j.style.fontWeight=Te})),new m("http://www.w3.org/ns/ttml#styling lineHeight",(function(Y,j,se,Te){j.style.lineHeight=Te==="normal"?"normal":Te.toUsedLength(Y.w,Y.h)+"px"})),new m("http://www.w3.org/ns/ttml#styling opacity",(function(Y,j,se,Te){j.style.opacity=Te})),new m("http://www.w3.org/ns/ttml#styling origin",(function(Y,j,se,Te){j.style.top=Te.h.toUsedLength(Y.w,Y.h)+"px",j.style.left=Te.w.toUsedLength(Y.w,Y.h)+"px"})),new m("http://www.w3.org/ns/ttml#styling overflow",(function(Y,j,se,Te){j.style.overflow=Te})),new m("http://www.w3.org/ns/ttml#styling padding",(function(Y,j,se,Te){var Ae=[];Ae[0]=Te[0].toUsedLength(Y.w,Y.h)+"px",Ae[1]=Te[3].toUsedLength(Y.w,Y.h)+"px",Ae[2]=Te[2].toUsedLength(Y.w,Y.h)+"px",Ae[3]=Te[1].toUsedLength(Y.w,Y.h)+"px",j.style.padding=Ae.join(" ")})),new m("http://www.w3.org/ns/ttml#styling position",(function(Y,j,se,Te){j.style.top=Te.h.toUsedLength(Y.w,Y.h)+"px",j.style.left=Te.w.toUsedLength(Y.w,Y.h)+"px"})),new m("http://www.w3.org/ns/ttml#styling rubyAlign",(function(Y,j,se,Te){j.style.rubyAlign=Te==="spaceAround"?"space-around":"center"})),new m("http://www.w3.org/ns/ttml#styling rubyPosition",(function(Y,j,se,Te){var Ae;Te!=="before"&&Te!=="after"||(Ae=M?Te:Y.bpd==="tb"||Y.bpd==="rl"?Te==="before"?"over":"under":Te==="before"?"under":"over",j.parentElement.style[R]=Ae)})),new m("http://www.w3.org/ns/ttml#styling showBackground",null),new m("http://www.w3.org/ns/ttml#styling textAlign",(function(Y,j,se,Te){var Ae;Ae=Te==="start"?Y.ipd==="rl"?"right":"left":Te==="end"?Y.ipd==="rl"?"left":"right":Te,j.style.textAlign=Ae})),new m("http://www.w3.org/ns/ttml#styling textDecoration",(function(Y,j,se,Te){j.style.textDecoration=Te.join(" ").replace("lineThrough","line-through")})),new m("http://www.w3.org/ns/ttml#styling textOutline",(function(Y,j,se,Te){})),new m("http://www.w3.org/ns/ttml#styling textShadow",(function(Y,j,se,Te){var Ae=se.styleAttrs[c.byName.textOutline.qname];if(Te==="none"&&Ae==="none")j.style.textShadow="";else{var ze=[];if(Ae!=="none"){var de="rgba("+Ae.color[0].toString()+","+Ae.color[1].toString()+","+Ae.color[2].toString()+","+(Ae.color[3]/255).toString()+")";ze.push("1px 1px 1px "+de),ze.push("-1px 1px 1px "+de),ze.push("1px -1px 1px "+de),ze.push("-1px -1px 1px "+de)}if(Te!=="none")for(var we=0;we<Te.length;we++)ze.push(Te[we].x_off.toUsedLength(Y.w,Y.h)+"px "+Te[we].y_off.toUsedLength(Y.w,Y.h)+"px "+Te[we].b_radius.toUsedLength(Y.w,Y.h)+"px rgba("+Te[we].color[0].toString()+","+Te[we].color[1].toString()+","+Te[we].color[2].toString()+","+(Te[we].color[3]/255).toString()+")");j.style.textShadow=ze.join(",")}})),new m("http://www.w3.org/ns/ttml#styling textCombine",(function(Y,j,se,Te){j.style.textCombineUpright=Te})),new m("http://www.w3.org/ns/ttml#styling textEmphasis",(function(Y,j,se,Te){})),new m("http://www.w3.org/ns/ttml#styling unicodeBidi",(function(Y,j,se,Te){var Ae;Ae=Te==="bidiOverride"?"bidi-override":Te,j.style.unicodeBidi=Ae})),new m("http://www.w3.org/ns/ttml#styling visibility",(function(Y,j,se,Te){j.style.visibility=Te})),new m("http://www.w3.org/ns/ttml#styling wrapOption",(function(Y,j,se,Te){Te==="wrap"?se.space==="preserve"?j.style.whiteSpace="pre-wrap":j.style.whiteSpace="normal":se.space==="preserve"?j.style.whiteSpace="pre":j.style.whiteSpace="noWrap"})),new m("http://www.w3.org/ns/ttml#styling writingMode",(function(Y,j,se,Te){Te==="lrtb"||Te==="lr"||Te==="rltb"||Te==="rl"?j.style.writingMode="horizontal-tb":Te==="tblr"?j.style.writingMode="vertical-lr":Te!=="tbrl"&&Te!=="tb"||(j.style.writingMode="vertical-rl")})),new m("http://www.w3.org/ns/ttml#styling zIndex",(function(Y,j,se,Te){j.style.zIndex=Te})),new m("http://www.w3.org/ns/ttml/profile/imsc1#styling forcedDisplay",(function(Y,j,se,Te){Y.displayForcedOnlyMode&&Te===!1&&(j.style.visibility="hidden")}))],S={},_=0;_<E.length;_++)S[E[_].qname]=E[_];var M="webkitRubyPosition"in window.getComputedStyle(document.documentElement),R=M?"webkitRubyPosition":"rubyPosition",W="webkitTextEmphasisStyle"in window.getComputedStyle(document.documentElement)?"webkitTextEmphasisStyle":"textEmphasisStyle",fe="webkitTextEmphasisPosition"in window.getComputedStyle(document.documentElement)?"webkitTextEmphasisPosition":"textEmphasisPosition";function ye(Y,j){if(Y&&Y.error&&Y.error(j))throw j}})(e,typeof imscNames>"u"?t(977):imscNames,typeof imscStyles>"u"?t(1219):imscStyles,typeof imscUtils>"u"?t(6404):imscUtils)},8905:function(o,e,t){(function(n,r,i,c){n.generateISD=function(m,E,S){var _,M=new u(m),R={},W={},fe=m.head.styling.initials[i.byName.showBackground.qname],ye=m.head.styling.initials[i.byName.backgroundColor.qname];for(var Y in m.head.layout.regions)if(m.head.layout.regions.hasOwnProperty(Y)){var j=m.head.layout.regions[Y],se=j.styleAttrs[i.byName.showBackground.qname]||fe,Te=j.styleAttrs[i.byName.backgroundColor.qname]||ye;W[j.id]=(se==="always"||se===void 0)&&Te!==void 0&&!(E<j.begin||E>=j.end)}for(var Ae in m.body&&m.body.regionID&&(W[m.body.regionID]=!0),_=m.body!==null?(function de(we,ce){if(ce.contents){var he={};for(var Pe in ce)ce.hasOwnProperty(Pe)&&(he[Pe]=ce[Pe]);return he.contents=[],ce.contents.filter((function($e){return!(we<$e.begin||we>=$e.end)})).forEach((function($e){var He=de(we,$e);He.regionID&&(W[He.regionID]=!0),He!==null&&he.contents.push(He)})),he}return ce})(E,m.body):null,W[""]!==void 0&&(W[""]=!0),W)if(W[Ae]){var ze=f(m,E,m.head.layout.regions[Ae],_,null,"",m.head.layout.regions[Ae],S,R);ze!==null&&M.contents.push(ze.element)}return M};var h=[i.byName.color.qname,i.byName.textCombine.qname,i.byName.textDecoration.qname,i.byName.textEmphasis.qname,i.byName.textOutline.qname,i.byName.textShadow.qname];function f(m,E,S,_,M,R,W,fe,ye){if(E<W.begin||E>=W.end)return null;var Y="regionID"in W&&W.regionID!==""?W.regionID:R;if(M!==null&&Y!==S.id&&(!("contents"in W)||"contents"in W&&W.contents.length===0||Y!==""))return null;var j=new l(W);if("sets"in W)for(var se=0;se<W.sets.length;se++)E<W.sets[se].begin||E>=W.sets[se].end||(j.styleAttrs[W.sets[se].qname]=W.sets[se].value);var Te={};for(var Ae in j.styleAttrs)if(j.styleAttrs.hasOwnProperty(Ae)&&(Te[Ae]=!0,j.kind==="region"&&Ae===i.byName.writingMode.qname&&!(i.byName.direction.qname in j.styleAttrs))){var ze=j.styleAttrs[Ae];ze==="lrtb"||ze==="lr"?j.styleAttrs[i.byName.direction.qname]="ltr":ze!=="rltb"&&ze!=="rl"||(j.styleAttrs[i.byName.direction.qname]="rtl")}if(M!==null)for(var de=0;de<i.all.length;de++){var we=i.all[de];if(we.qname===i.byName.textDecoration.qname){var ce=M.styleAttrs[we.qname],he=j.styleAttrs[we.qname],Pe=[];he===void 0?Pe=ce:he.indexOf("none")===-1?((he.indexOf("noUnderline")===-1&&ce.indexOf("underline")!==-1||he.indexOf("underline")!==-1)&&Pe.push("underline"),(he.indexOf("noLineThrough")===-1&&ce.indexOf("lineThrough")!==-1||he.indexOf("lineThrough")!==-1)&&Pe.push("lineThrough"),(he.indexOf("noOverline")===-1&&ce.indexOf("overline")!==-1||he.indexOf("overline")!==-1)&&Pe.push("overline")):Pe.push("none"),j.styleAttrs[we.qname]=Pe}else if(we.qname!==i.byName.fontSize.qname||we.qname in j.styleAttrs||j.kind!=="span"||j.styleAttrs[i.byName.ruby.qname]!=="textContainer")if(we.qname!==i.byName.fontSize.qname||we.qname in j.styleAttrs||j.kind!=="span"||j.styleAttrs[i.byName.ruby.qname]!=="text")we.inherit&&we.qname in M.styleAttrs&&!(we.qname in j.styleAttrs)&&(j.styleAttrs[we.qname]=M.styleAttrs[we.qname]);else{var $e=M.styleAttrs[i.byName.fontSize.qname];M.styleAttrs[i.byName.ruby.qname]==="textContainer"?j.styleAttrs[we.qname]=$e:j.styleAttrs[we.qname]=new c.ComputedLength(.5*$e.rw,.5*$e.rh)}else{var He=M.styleAttrs[i.byName.fontSize.qname];j.styleAttrs[we.qname]=new c.ComputedLength(.5*He.rw,.5*He.rh)}}for(var et=0;et<i.all.length;et++){var Ve=i.all[et];if(!(Ve.qname in j.styleAttrs)&&!(Ve.qname===i.byName.position.qname&&i.byName.origin.qname in j.styleAttrs||Ve.qname===i.byName.origin.qname&&i.byName.position.qname in j.styleAttrs)){var Et=m.head.styling.initials[Ve.qname]||Ve.initial;if(Et!==null&&(j.kind==="region"||Ve.inherit===!1&&Et!==null)){var Nt=Ve.parse(Et);Nt!==null?(j.styleAttrs[Ve.qname]=Nt,Te[Ve.qname]=!0):d(fe,"Invalid initial value for '"+Ve.qname+"' on element '"+j.kind)}}}for(var $t=0;$t<i.all.length;$t++){var Ie=i.all[$t];if(Ie.qname in Te&&Ie.compute!==null){var pe=Ie.compute(m,M,j,j.styleAttrs[Ie.qname],ye);pe!==null?j.styleAttrs[Ie.qname]=pe:(j.styleAttrs[Ie.qname]=Ie.compute(m,M,j,Ie.parse(Ie.initial),ye),d(fe,"Style '"+Ie.qname+"' on element '"+j.kind+"' cannot be computed"))}}if(j.styleAttrs[i.byName.display.qname]==="none")return null;var Be=null;M===null?Be=_===null?[]:[_]:"contents"in W&&(Be=W.contents);for(var O=0;Be!==null&&O<Be.length;O++){var z=f(m,E,S,_,j,Y,Be[O],fe,ye);z!==null&&j.contents.push(z.element)}for(var k in j.styleAttrs)if(j.styleAttrs.hasOwnProperty(k)){var L=!1;if(j.kind==="span"){var ne=j.styleAttrs[i.byName.ruby.qname];(L=(ne==="container"||ne==="textContainer"||ne==="baseContainer")&&h.indexOf(k)!==-1)||(L=ne!=="container"&&k===i.byName.rubyAlign.qname),L||(L=!(ne==="textContainer"||ne==="text")&&k===i.byName.rubyPosition.qname)}if(!L){var H=i.byQName[k];"applies"in H&&(L=H.applies.indexOf(j.kind)===-1)}L&&delete j.styleAttrs[k]}var De=j.styleAttrs[i.byName.ruby.qname];if(j.kind==="p"||j.kind==="span"&&(De==="textContainer"||De==="text")){var Ye=[];g(j,Ye),(function(qe){for(var Fe,Ue=0;Ue<qe.length;)if((Fe=qe[Ue]).kind!=="br"&&Fe.space!=="preserve"){var Ke=Fe.text.replace(/[\t\r\n ]+/g," ");/^[ ]/.test(Ke)&&(Ue===0||(tt=qe[Ue-1]).kind==="br"||/[\r\n\t ]$/.test(tt.text))&&(Ke=Ke.substring(1)),Fe.text=Ke,Ke.length===0?qe.splice(Ue,1):Ue++}else Ue++;var tt,nt;for(Ue=0;Ue<qe.length;Ue++)(Fe=qe[Ue]).kind!=="br"&&Fe.space!=="preserve"?/[ ]$/.test(Fe.text)&&(Ue===qe.length-1||(nt=qe[Ue+1]).kind==="br"||nt.space==="preserve"&&/^[\r\n]/.test(nt.text))&&(Fe.text=Fe.text.slice(0,-1)):Ue++})(Ye),y(j)}return j.kind==="div"&&i.byName.backgroundImage.qname in j.styleAttrs||j.kind==="br"||j.kind==="image"||"contents"in j&&j.contents.length>0||j.kind==="span"&&j.text!==null||j.kind==="region"&&j.styleAttrs[i.byName.showBackground.qname]==="always"?{region_id:Y,element:j}:null}function g(m,E){if("contents"in m)for(var S=0;S<m.contents.length;S++){var _=m.contents[S],M=_.styleAttrs[i.byName.ruby.qname];(_.kind!=="span"||M!=="textContainer"&&M!=="text")&&("contents"in _?g(_,E):(_.kind==="span"&&_.text.length!==0||_.kind==="br")&&E.push(_))}}function y(m){if(m.kind==="br")return!1;if("text"in m)return m.text.length===0;if("contents"in m){for(var E=m.contents.length;E--;)y(m.contents[E])&&m.contents.splice(E,1);return m.contents.length===0}}function u(m){this.contents=[],this.aspectRatio=m.aspectRatio,this.lang=m.lang}function l(m){for(var E in this.kind=m.kind||"region",this.lang=m.lang,m.id&&(this.id=m.id),this.styleAttrs={},m.styleAttrs)m.styleAttrs.hasOwnProperty(E)&&(this.styleAttrs[E]=m.styleAttrs[E]);"src"in m&&(this.src=m.src),"type"in m&&(this.type=m.type),"text"in m?this.text=m.text:(this.kind==="region"||"contents"in m)&&(this.contents=[]),"space"in m&&(this.space=m.space)}function d(m,E){if(m&&m.error&&m.error(E))throw E}})(e,typeof imscNames>"u"?t(977):imscNames,typeof imscStyles>"u"?t(1219):imscStyles,typeof imscUtils>"u"?t(6404):imscUtils)},7640:function(o,e,t){e.generateISD=t(8905).generateISD,e.fromXML=t(6739).fromXML,e.renderHTML=t(1612).render},977:function(o,e){(function(t){t.ns_tt="http://www.w3.org/ns/ttml",t.ns_tts="http://www.w3.org/ns/ttml#styling",t.ns_ttp="http://www.w3.org/ns/ttml#parameter",t.ns_xml="http://www.w3.org/XML/1998/namespace",t.ns_itts="http://www.w3.org/ns/ttml/profile/imsc1#styling",t.ns_ittp="http://www.w3.org/ns/ttml/profile/imsc1#parameter",t.ns_smpte="http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt",t.ns_ebutts="urn:ebu:tt:style"})(e)},1219:function(o,e,t){(function(n,r,i){function c(g,y,u,l,d,m,E,S){this.name=y,this.ns=g,this.qname=g+" "+y,this.inherit=d,this.animatable=m,this.initial=u,this.applies=l,this.parse=E,this.compute=S}for(var h in n.all=[new c(r.ns_tts,"backgroundColor","transparent",["body","div","p","region","span"],!1,!0,i.parseColor,null),new c(r.ns_tts,"color","white",["span"],!0,!0,i.parseColor,null),new c(r.ns_tts,"direction","ltr",["p","span"],!0,!0,(function(g){return g}),null),new c(r.ns_tts,"display","auto",["body","div","p","region","span"],!1,!0,(function(g){return g}),null),new c(r.ns_tts,"displayAlign","before",["region"],!1,!0,(function(g){return g}),null),new c(r.ns_tts,"extent","auto",["tt","region"],!1,!0,(function(g){if(g==="auto")return g;var y=g.split(" ");if(y.length!==2)return null;var u=i.parseLength(y[0]),l=i.parseLength(y[1]);return l&&u?{h:l,w:u}:null}),(function(g,y,u,l,d){var m,E;if(l==="auto")m=new i.ComputedLength(0,1);else if((m=i.toComputedLength(l.h.value,l.h.unit,null,g.dimensions.h,null,g.pxLength.h))===null)return null;if(l==="auto")E=new i.ComputedLength(1,0);else if((E=i.toComputedLength(l.w.value,l.w.unit,null,g.dimensions.w,null,g.pxLength.w))===null)return null;return{h:m,w:E}})),new c(r.ns_tts,"fontFamily","default",["span","p"],!0,!0,(function(g){for(var y=g.split(","),u=[],l=0;l<y.length;l++)y[l]=y[l].trim(),y[l].charAt(0)!=="'"&&y[l].charAt(0)!=='"'&&y[l]==="default"?u.push("monospaceSerif"):u.push(y[l]);return u}),null),new c(r.ns_tts,"shear","0%",["p"],!0,!0,i.parseLength,(function(g,y,u,l){return l.unit!=="%"?null:Math.abs(l.value)>100?100*Math.sign(l.value):l.value})),new c(r.ns_tts,"fontSize","1c",["span","p"],!0,!0,i.parseLength,(function(g,y,u,l,d){return i.toComputedLength(l.value,l.unit,y!==null?y.styleAttrs[n.byName.fontSize.qname]:g.cellLength.h,y!==null?y.styleAttrs[n.byName.fontSize.qname]:g.cellLength.h,g.cellLength.h,g.pxLength.h)})),new c(r.ns_tts,"fontStyle","normal",["span","p"],!0,!0,(function(g){return g}),null),new c(r.ns_tts,"fontWeight","normal",["span","p"],!0,!0,(function(g){return g}),null),new c(r.ns_tts,"lineHeight","normal",["p"],!0,!0,(function(g){return g==="normal"?g:i.parseLength(g)}),(function(g,y,u,l,d){var m;if(l==="normal")m=l;else if((m=i.toComputedLength(l.value,l.unit,u.styleAttrs[n.byName.fontSize.qname],u.styleAttrs[n.byName.fontSize.qname],g.cellLength.h,g.pxLength.h))===null)return null;return m})),new c(r.ns_tts,"opacity",1,["region"],!1,!0,parseFloat,null),new c(r.ns_tts,"origin","auto",["region"],!1,!0,(function(g){if(g==="auto")return g;var y=g.split(" ");if(y.length!==2)return null;var u=i.parseLength(y[0]),l=i.parseLength(y[1]);return l&&u?{h:l,w:u}:null}),(function(g,y,u,l,d){var m,E;if(l==="auto")m=new i.ComputedLength(0,0);else if((m=i.toComputedLength(l.h.value,l.h.unit,null,g.dimensions.h,null,g.pxLength.h))===null)return null;if(l==="auto")E=new i.ComputedLength(0,0);else if((E=i.toComputedLength(l.w.value,l.w.unit,null,g.dimensions.w,null,g.pxLength.w))===null)return null;return{h:m,w:E}})),new c(r.ns_tts,"overflow","hidden",["region"],!1,!0,(function(g){return g}),null),new c(r.ns_tts,"padding","0px",["region"],!1,!0,(function(g){var y=g.split(" ");if(y.length>4)return null;for(var u=[],l=0;l<y.length;l++){var d=i.parseLength(y[l]);if(!d)return null;u.push(d)}return u}),(function(g,y,u,l,d){var m;if(l.length===1)m=[l[0],l[0],l[0],l[0]];else if(l.length===2)m=[l[0],l[1],l[0],l[1]];else if(l.length===3)m=[l[0],l[1],l[2],l[1]];else{if(l.length!==4)return null;m=[l[0],l[1],l[2],l[3]]}var E=u.styleAttrs[n.byName.writingMode.qname];if(E==="lrtb"||E==="lr")m=[m[0],m[3],m[2],m[1]];else if(E==="rltb"||E==="rl")m=[m[0],m[1],m[2],m[3]];else if(E==="tblr")m=[m[3],m[0],m[1],m[2]];else{if(E!=="tbrl"&&E!=="tb")return null;m=[m[3],m[2],m[1],m[0]]}for(var S=[],_=0;_<m.length;_++)if(m[_].value===0)S[_]=new i.ComputedLength(0,0);else if(S[_]=i.toComputedLength(m[_].value,m[_].unit,u.styleAttrs[n.byName.fontSize.qname],_===0||_===2?u.styleAttrs[n.byName.extent.qname].h:u.styleAttrs[n.byName.extent.qname].w,_===0||_===2?g.cellLength.h:g.cellLength.w,_===0||_===2?g.pxLength.h:g.pxLength.w),S[_]===null)return null;return S})),new c(r.ns_tts,"position","top left",["region"],!1,!0,(function(g){return i.parsePosition(g)}),(function(g,y,u,l){var d,m;return(d=i.toComputedLength(l.v.offset.value,l.v.offset.unit,null,new i.ComputedLength(-u.styleAttrs[n.byName.extent.qname].h.rw,g.dimensions.h.rh-u.styleAttrs[n.byName.extent.qname].h.rh),null,g.pxLength.h))===null?null:(l.v.edge==="bottom"&&(d=new i.ComputedLength(-d.rw-u.styleAttrs[n.byName.extent.qname].h.rw,g.dimensions.h.rh-d.rh-u.styleAttrs[n.byName.extent.qname].h.rh)),m=i.toComputedLength(l.h.offset.value,l.h.offset.unit,null,new i.ComputedLength(g.dimensions.w.rw-u.styleAttrs[n.byName.extent.qname].w.rw,-u.styleAttrs[n.byName.extent.qname].w.rh),null,g.pxLength.w),d===null?null:(l.h.edge==="right"&&(m=new i.ComputedLength(g.dimensions.w.rw-m.rw-u.styleAttrs[n.byName.extent.qname].w.rw,-m.rh-u.styleAttrs[n.byName.extent.qname].w.rh)),{h:d,w:m}))})),new c(r.ns_tts,"ruby","none",["span"],!1,!0,(function(g){return g}),null),new c(r.ns_tts,"rubyAlign","center",["span"],!0,!0,(function(g){return g!=="center"&&g!=="spaceAround"?null:g}),null),new c(r.ns_tts,"rubyPosition","outside",["span"],!0,!0,(function(g){return g}),null),new c(r.ns_tts,"rubyReserve","none",["p"],!0,!0,(function(g){var y=g.split(" "),u=[null,null];if(y.length===0||y.length>2||y[0]!=="none"&&y[0]!=="both"&&y[0]!=="after"&&y[0]!=="before"&&y[0]!=="outside")return null;if(u[0]=y[0],y.length===2&&y[0]!=="none"){var l=i.parseLength(y[1]);if(!l)return null;u[1]=l}return u}),(function(g,y,u,l,d){if(l[0]==="none")return l;var m;return(m=l[1]===null?new i.ComputedLength(.5*u.styleAttrs[n.byName.fontSize.qname].rw,.5*u.styleAttrs[n.byName.fontSize.qname].rh):i.toComputedLength(l[1].value,l[1].unit,u.styleAttrs[n.byName.fontSize.qname],u.styleAttrs[n.byName.fontSize.qname],g.cellLength.h,g.pxLength.h))===null?null:[l[0],m]})),new c(r.ns_tts,"showBackground","always",["region"],!1,!0,(function(g){return g}),null),new c(r.ns_tts,"textAlign","start",["p"],!0,!0,(function(g){return g}),(function(g,y,u,l,d){return l==="left"?"start":l==="right"?"end":l})),new c(r.ns_tts,"textCombine","none",["span"],!0,!0,(function(g){return g==="none"||g==="all"?g:null}),null),new c(r.ns_tts,"textDecoration","none",["span"],!0,!0,(function(g){return g.split(" ")}),null),new c(r.ns_tts,"textEmphasis","none",["span"],!0,!0,(function(g){for(var y=g.split(" "),u={style:null,symbol:null,color:null,position:null},l=0;l<y.length;l++)if(y[l]==="none"||y[l]==="auto")u.style=y[l];else if(y[l]==="filled"||y[l]==="open")u.style=y[l];else if(y[l]==="circle"||y[l]==="dot"||y[l]==="sesame")u.symbol=y[l];else if(y[l]==="current")u.color=y[l];else if(y[l]==="outside"||y[l]==="before"||y[l]==="after")u.position=y[l];else if(u.color=i.parseColor(y[l]),u.color===null)return null;return u.style==null&&u.symbol==null?u.style="auto":(u.symbol=u.symbol||"circle",u.style=u.style||"filled"),u.position=u.position||"outside",u.color=u.color||"current",u}),null),new c(r.ns_tts,"textOutline","none",["span"],!0,!0,(function(g){if(g==="none")return g;var y={},u=g.split(" ");if(u.length===0||u.length>2)return null;var l=i.parseColor(u[0]);if(y.color=l,l!==null&&u.shift(),u.length!==1)return null;var d=i.parseLength(u[0]);return d?(y.thickness=d,y):null}),(function(g,y,u,l,d){if(l==="none")return l;var m={};return l.color===null?m.color=u.styleAttrs[n.byName.color.qname]:m.color=l.color,m.thickness=i.toComputedLength(l.thickness.value,l.thickness.unit,u.styleAttrs[n.byName.fontSize.qname],u.styleAttrs[n.byName.fontSize.qname],g.cellLength.h,g.pxLength.h),m.thickness===null?null:m})),new c(r.ns_tts,"textShadow","none",["span"],!0,!0,i.parseTextShadow,(function(g,y,u,l){if(l==="none")return l;for(var d=[],m=0;m<l.length;m++){var E={};if(E.x_off=i.toComputedLength(l[m][0].value,l[m][0].unit,null,u.styleAttrs[n.byName.fontSize.qname],null,g.pxLength.w),E.x_off===null||(E.y_off=i.toComputedLength(l[m][1].value,l[m][1].unit,null,u.styleAttrs[n.byName.fontSize.qname],null,g.pxLength.h),E.y_off===null))return null;if(l[m][2]===null)E.b_radius=0;else if(E.b_radius=i.toComputedLength(l[m][2].value,l[m][2].unit,null,u.styleAttrs[n.byName.fontSize.qname],null,g.pxLength.h),E.b_radius===null)return null;l[m][3]===null?E.color=u.styleAttrs[n.byName.color.qname]:E.color=l[m][3],d.push(E)}return d})),new c(r.ns_tts,"unicodeBidi","normal",["span","p"],!1,!0,(function(g){return g}),null),new c(r.ns_tts,"visibility","visible",["body","div","p","region","span"],!0,!0,(function(g){return g}),null),new c(r.ns_tts,"wrapOption","wrap",["span"],!0,!0,(function(g){return g}),null),new c(r.ns_tts,"writingMode","lrtb",["region"],!1,!0,(function(g){return g}),null),new c(r.ns_tts,"zIndex","auto",["region"],!1,!0,(function(g){var y;return g==="auto"?y=g:(y=parseInt(g),isNaN(y)&&(y=null)),y}),null),new c(r.ns_ebutts,"linePadding","0c",["p"],!0,!1,i.parseLength,(function(g,y,u,l,d){return i.toComputedLength(l.value,l.unit,null,null,g.cellLength.w,null)})),new c(r.ns_ebutts,"multiRowAlign","auto",["p"],!0,!1,(function(g){return g}),null),new c(r.ns_smpte,"backgroundImage",null,["div"],!1,!1,(function(g){return g}),null),new c(r.ns_itts,"forcedDisplay","false",["body","div","p","region","span"],!0,!0,(function(g){return g==="true"}),null),new c(r.ns_itts,"fillLineGap","false",["p"],!0,!0,(function(g){return g==="true"}),null)],n.byQName={},n.all)n.byQName[n.all[h].qname]=n.all[h];for(var f in n.byName={},n.all)n.byName[n.all[f].name]=n.all[f]})(e,typeof imscNames>"u"?t(977):imscNames,typeof imscUtils>"u"?t(6404):imscUtils)},6404:function(o,e){(function(t){var n=/#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})?/,r=/rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,i=/rgba\(\s*(\d+),\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,c={transparent:[0,0,0,0],black:[0,0,0,255],silver:[192,192,192,255],gray:[128,128,128,255],white:[255,255,255,255],maroon:[128,0,0,255],red:[255,0,0,255],purple:[128,0,128,255],fuchsia:[255,0,255,255],magenta:[255,0,255,255],green:[0,128,0,255],lime:[0,255,0,255],olive:[128,128,0,255],yellow:[255,255,0,255],navy:[0,0,128,255],blue:[0,0,255,255],teal:[0,128,128,255],aqua:[0,255,255,255],cyan:[0,255,255,255]};t.parseColor=function(f){var g,y=null,u=c[f.toLowerCase()];return u!==void 0?y=u:(g=n.exec(f))!==null?y=[parseInt(g[1],16),parseInt(g[2],16),parseInt(g[3],16),g[4]!==void 0?parseInt(g[4],16):255]:(g=r.exec(f))!==null?y=[parseInt(g[1]),parseInt(g[2]),parseInt(g[3]),255]:(g=i.exec(f))!==null&&(y=[parseInt(g[1]),parseInt(g[2]),parseInt(g[3]),parseInt(g[4])]),y};var h=/^((?:\+|\-)?\d*(?:\.\d+)?)(px|em|c|%|rh|rw)$/;t.parseLength=function(f){var g,y=null;return(g=h.exec(f))!==null&&(y={value:parseFloat(g[1]),unit:g[2]}),y},t.parseTextShadow=function(f){for(var g=f.match(/([^\(,\)]|\([^\)]+\))+/g),y=[],u=0;u<g.length;u++){var l=g[u].split(" ");if(l.length===1&&l[0]==="none")return"none";if(l.length>1&&l.length<5){var d=[null,null,null,null],m=t.parseLength(l.shift());if(m===null||(d[0]=m,(m=t.parseLength(l.shift()))===null))return null;if(d[1]=m,l.length===0){y.push(d);continue}if((m=t.parseLength(l[0]))!==null&&(d[2]=m,l.shift()),l.length===0){y.push(d);continue}var E=t.parseColor(l[0]);if(E===null)return null;d[3]=E,y.push(d)}}return y},t.parsePosition=function(f){var g=f.split(" "),y=function(_){return _==="center"||_==="left"||_==="top"||_==="bottom"||_==="right"};if(g.length>4)return null;for(var u=0;u<g.length;u++)if(!y(g[u])){var l=t.parseLength(g[u]);if(l===null)return null;g[u]=l}for(var d={h:{edge:"left",offset:{value:50,unit:"%"}},v:{edge:"top",offset:{value:50,unit:"%"}}},m=0;m<g.length;){var E=g[m++];if(y(E)){var S={value:0,unit:"%"};g.length!==2&&m<g.length&&!y(g[m])&&(S=g[m++]),E==="right"?(d.h.edge=E,d.h.offset=S):E==="bottom"?(d.v.edge=E,d.v.offset=S):E==="left"?d.h.offset=S:E==="top"&&(d.v.offset=S)}else{if(g.length!==1&&g.length!==2)return null;m===1?d.h.offset=E:d.v.offset=E}}return d},t.ComputedLength=function(f,g){this.rw=f,this.rh=g},t.ComputedLength.prototype.toUsedLength=function(f,g){return f*this.rw+g*this.rh},t.ComputedLength.prototype.isZero=function(){return this.rw===0&&this.rh===0},t.toComputedLength=function(f,g,y,u,l,d){return g==="%"&&u?new t.ComputedLength(u.rw*f/100,u.rh*f/100):g==="em"&&y?new t.ComputedLength(y.rw*f,y.rh*f):g==="c"&&l?new t.ComputedLength(f*l.rw,f*l.rh):g==="px"&&d?new t.ComputedLength(f*d.rw,f*d.rh):g==="rh"?new t.ComputedLength(0,f/100):g==="rw"?new t.ComputedLength(f/100,0):null}})(e)},7523:function(o){typeof Object.create=="function"?o.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:o.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},3282:function(o){function e(r){if(typeof r!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(r))}function t(r,i){for(var c,h="",f=0,g=-1,y=0,u=0;u<=r.length;++u){if(u<r.length)c=r.charCodeAt(u);else{if(c===47)break;c=47}if(c===47){if(!(g===u-1||y===1))if(g!==u-1&&y===2){if(h.length<2||f!==2||h.charCodeAt(h.length-1)!==46||h.charCodeAt(h.length-2)!==46){if(h.length>2){var l=h.lastIndexOf("/");if(l!==h.length-1){l===-1?(h="",f=0):f=(h=h.slice(0,l)).length-1-h.lastIndexOf("/"),g=u,y=0;continue}}else if(h.length===2||h.length===1){h="",f=0,g=u,y=0;continue}}i&&(h.length>0?h+="/..":h="..",f=2)}else h.length>0?h+="/"+r.slice(g+1,u):h=r.slice(g+1,u),f=u-g-1;g=u,y=0}else c===46&&y!==-1?++y:y=-1}return h}var n={resolve:function(){for(var r,i="",c=!1,h=arguments.length-1;h>=-1&&!c;h--){var f;h>=0?f=arguments[h]:(r===void 0&&(r=process.cwd()),f=r),e(f),f.length!==0&&(i=f+"/"+i,c=f.charCodeAt(0)===47)}return i=t(i,!c),c?i.length>0?"/"+i:"/":i.length>0?i:"."},normalize:function(r){if(e(r),r.length===0)return".";var i=r.charCodeAt(0)===47,c=r.charCodeAt(r.length-1)===47;return(r=t(r,!i)).length!==0||i||(r="."),r.length>0&&c&&(r+="/"),i?"/"+r:r},isAbsolute:function(r){return e(r),r.length>0&&r.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var r,i=0;i<arguments.length;++i){var c=arguments[i];e(c),c.length>0&&(r===void 0?r=c:r+="/"+c)}return r===void 0?".":n.normalize(r)},relative:function(r,i){if(e(r),e(i),r===i||(r=n.resolve(r))===(i=n.resolve(i)))return"";for(var c=1;c<r.length&&r.charCodeAt(c)===47;++c);for(var h=r.length,f=h-c,g=1;g<i.length&&i.charCodeAt(g)===47;++g);for(var y=i.length-g,u=f<y?f:y,l=-1,d=0;d<=u;++d){if(d===u){if(y>u){if(i.charCodeAt(g+d)===47)return i.slice(g+d+1);if(d===0)return i.slice(g+d)}else f>u&&(r.charCodeAt(c+d)===47?l=d:d===0&&(l=0));break}var m=r.charCodeAt(c+d);if(m!==i.charCodeAt(g+d))break;m===47&&(l=d)}var E="";for(d=c+l+1;d<=h;++d)d!==h&&r.charCodeAt(d)!==47||(E.length===0?E+="..":E+="/..");return E.length>0?E+i.slice(g+l):(g+=l,i.charCodeAt(g)===47&&++g,i.slice(g))},_makeLong:function(r){return r},dirname:function(r){if(e(r),r.length===0)return".";for(var i=r.charCodeAt(0),c=i===47,h=-1,f=!0,g=r.length-1;g>=1;--g)if((i=r.charCodeAt(g))===47){if(!f){h=g;break}}else f=!1;return h===-1?c?"/":".":c&&h===1?"//":r.slice(0,h)},basename:function(r,i){if(i!==void 0&&typeof i!="string")throw new TypeError('"ext" argument must be a string');e(r);var c,h=0,f=-1,g=!0;if(i!==void 0&&i.length>0&&i.length<=r.length){if(i.length===r.length&&i===r)return"";var y=i.length-1,u=-1;for(c=r.length-1;c>=0;--c){var l=r.charCodeAt(c);if(l===47){if(!g){h=c+1;break}}else u===-1&&(g=!1,u=c+1),y>=0&&(l===i.charCodeAt(y)?--y==-1&&(f=c):(y=-1,f=u))}return h===f?f=u:f===-1&&(f=r.length),r.slice(h,f)}for(c=r.length-1;c>=0;--c)if(r.charCodeAt(c)===47){if(!g){h=c+1;break}}else f===-1&&(g=!1,f=c+1);return f===-1?"":r.slice(h,f)},extname:function(r){e(r);for(var i=-1,c=0,h=-1,f=!0,g=0,y=r.length-1;y>=0;--y){var u=r.charCodeAt(y);if(u!==47)h===-1&&(f=!1,h=y+1),u===46?i===-1?i=y:g!==1&&(g=1):i!==-1&&(g=-1);else if(!f){c=y+1;break}}return i===-1||h===-1||g===0||g===1&&i===h-1&&i===c+1?"":r.slice(i,h)},format:function(r){if(r===null||typeof r!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof r);return(function(i,c){var h=c.dir||c.root,f=c.base||(c.name||"")+(c.ext||"");return h?h===c.root?h+f:h+"/"+f:f})(0,r)},parse:function(r){e(r);var i={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return i;var c,h=r.charCodeAt(0),f=h===47;f?(i.root="/",c=1):c=0;for(var g=-1,y=0,u=-1,l=!0,d=r.length-1,m=0;d>=c;--d)if((h=r.charCodeAt(d))!==47)u===-1&&(l=!1,u=d+1),h===46?g===-1?g=d:m!==1&&(m=1):g!==-1&&(m=-1);else if(!l){y=d+1;break}return g===-1||u===-1||m===0||m===1&&g===u-1&&g===y+1?u!==-1&&(i.base=i.name=y===0&&f?r.slice(1,u):r.slice(y,u)):(y===0&&f?(i.name=r.slice(1,g),i.base=r.slice(1,u)):(i.name=r.slice(y,g),i.base=r.slice(y,u)),i.ext=r.slice(g,u)),y>0?i.dir=r.slice(0,y-1):f&&(i.dir="/"),i},sep:"/",delimiter:":",win32:null,posix:null};n.posix=n,o.exports=n},3515:function(o,e,t){o.exports=r;var n=t(9826).EventEmitter;function r(){n.call(this)}t(7523)(r,n),r.Readable=t(2762),r.Writable=t(3726),r.Duplex=t(884),r.Transform=t(6756),r.PassThrough=t(1390),r.finished=t(2896),r.pipeline=t(8460),r.Stream=r,r.prototype.pipe=function(i,c){var h=this;function f(E){i.writable&&i.write(E)===!1&&h.pause&&h.pause()}function g(){h.readable&&h.resume&&h.resume()}h.on("data",f),i.on("drain",g),i._isStdio||c&&c.end===!1||(h.on("end",u),h.on("close",l));var y=!1;function u(){y||(y=!0,i.end())}function l(){y||(y=!0,typeof i.destroy=="function"&&i.destroy())}function d(E){if(m(),n.listenerCount(this,"error")===0)throw E}function m(){h.removeListener("data",f),i.removeListener("drain",g),h.removeListener("end",u),h.removeListener("close",l),h.removeListener("error",d),i.removeListener("error",d),h.removeListener("end",m),h.removeListener("close",m),i.removeListener("close",m)}return h.on("error",d),i.on("error",d),h.on("end",m),h.on("close",m),i.on("close",m),i.emit("pipe",h),i}},1602:function(o){var e={};function t(r,i,c){c||(c=Error);var h=(function(f){var g,y;function u(l,d,m){return f.call(this,(function(E,S,_){return typeof i=="string"?i:i(E,S,_)})(l,d,m))||this}return y=f,(g=u).prototype=Object.create(y.prototype),g.prototype.constructor=g,g.__proto__=y,u})(c);h.prototype.name=c.name,h.prototype.code=r,e[r]=h}function n(r,i){if(Array.isArray(r)){var c=r.length;return r=r.map((function(h){return String(h)})),c>2?"one of ".concat(i," ").concat(r.slice(0,c-1).join(", "),", or ")+r[c-1]:c===2?"one of ".concat(i," ").concat(r[0]," or ").concat(r[1]):"of ".concat(i," ").concat(r[0])}return"of ".concat(i," ").concat(String(r))}t("ERR_INVALID_OPT_VALUE",(function(r,i){return'The value "'+i+'" is invalid for option "'+r+'"'}),TypeError),t("ERR_INVALID_ARG_TYPE",(function(r,i,c){var h,f,g,y,u;if(typeof i=="string"&&(f="not ",i.substr(0,4)===f)?(h="must not be",i=i.replace(/^not /,"")):h="must be",(function(d,m,E){return(E===void 0||E>d.length)&&(E=d.length),d.substring(E-9,E)===m})(r," argument"))g="The ".concat(r," ").concat(h," ").concat(n(i,"type"));else{var l=(typeof u!="number"&&(u=0),u+1>(y=r).length||y.indexOf(".",u)===-1?"argument":"property");g='The "'.concat(r,'" ').concat(l," ").concat(h," ").concat(n(i,"type"))}return g+". Received type ".concat(typeof c)}),TypeError),t("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),t("ERR_METHOD_NOT_IMPLEMENTED",(function(r){return"The "+r+" method is not implemented"})),t("ERR_STREAM_PREMATURE_CLOSE","Premature close"),t("ERR_STREAM_DESTROYED",(function(r){return"Cannot call "+r+" after a stream was destroyed"})),t("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),t("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),t("ERR_STREAM_WRITE_AFTER_END","write after end"),t("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),t("ERR_UNKNOWN_ENCODING",(function(r){return"Unknown encoding: "+r}),TypeError),t("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),o.exports.codes=e},884:function(o,e,t){var n=Object.keys||function(l){var d=[];for(var m in l)d.push(m);return d};o.exports=g;var r=t(2762),i=t(3726);t(7523)(g,r);for(var c=n(i.prototype),h=0;h<c.length;h++){var f=c[h];g.prototype[f]||(g.prototype[f]=i.prototype[f])}function g(l){if(!(this instanceof g))return new g(l);r.call(this,l),i.call(this,l),this.allowHalfOpen=!0,l&&(l.readable===!1&&(this.readable=!1),l.writable===!1&&(this.writable=!1),l.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",y)))}function y(){this._writableState.ended||process.nextTick(u,this)}function u(l){l.end()}Object.defineProperty(g.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(g.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(g.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(g.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._writableState!==void 0&&this._readableState.destroyed&&this._writableState.destroyed},set:function(l){this._readableState!==void 0&&this._writableState!==void 0&&(this._readableState.destroyed=l,this._writableState.destroyed=l)}})},1390:function(o,e,t){o.exports=r;var n=t(6756);function r(i){if(!(this instanceof r))return new r(i);n.call(this,i)}t(7523)(r,n),r.prototype._transform=function(i,c,h){h(null,i)}},2762:function(o,e,t){var n;o.exports=j,j.ReadableState=Y,t(9826).EventEmitter;var r,i=function(Ie,pe){return Ie.listeners(pe).length},c=t(2611),h=t(44).Buffer,f=(t.g!==void 0?t.g:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){},g=t(7199);r=g&&g.debuglog?g.debuglog("stream"):function(){};var y,u,l,d=t(3791),m=t(2410),E=t(1749).getHighWaterMark,S=t(1602).codes,_=S.ERR_INVALID_ARG_TYPE,M=S.ERR_STREAM_PUSH_AFTER_EOF,R=S.ERR_METHOD_NOT_IMPLEMENTED,W=S.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;t(7523)(j,c);var fe=m.errorOrDestroy,ye=["error","close","destroy","pause","resume"];function Y(Ie,pe,Be){n=n||t(884),Ie=Ie||{},typeof Be!="boolean"&&(Be=pe instanceof n),this.objectMode=!!Ie.objectMode,Be&&(this.objectMode=this.objectMode||!!Ie.readableObjectMode),this.highWaterMark=E(this,Ie,"readableHighWaterMark",Be),this.buffer=new d,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=Ie.emitClose!==!1,this.autoDestroy=!!Ie.autoDestroy,this.destroyed=!1,this.defaultEncoding=Ie.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,Ie.encoding&&(y||(y=t(748).StringDecoder),this.decoder=new y(Ie.encoding),this.encoding=Ie.encoding)}function j(Ie){if(n=n||t(884),!(this instanceof j))return new j(Ie);var pe=this instanceof n;this._readableState=new Y(Ie,this,pe),this.readable=!0,Ie&&(typeof Ie.read=="function"&&(this._read=Ie.read),typeof Ie.destroy=="function"&&(this._destroy=Ie.destroy)),c.call(this)}function se(Ie,pe,Be,O,z){r("readableAddChunk",pe);var k,L=Ie._readableState;if(pe===null)L.reading=!1,(function(ne,H){if(r("onEofChunk"),!H.ended){if(H.decoder){var De=H.decoder.end();De&&De.length&&(H.buffer.push(De),H.length+=H.objectMode?1:De.length)}H.ended=!0,H.sync?de(ne):(H.needReadable=!1,H.emittedReadable||(H.emittedReadable=!0,we(ne)))}})(Ie,L);else if(z||(k=(function(ne,H){var De,Ye;return Ye=H,h.isBuffer(Ye)||Ye instanceof f||typeof H=="string"||H===void 0||ne.objectMode||(De=new _("chunk",["string","Buffer","Uint8Array"],H)),De})(L,pe)),k)fe(Ie,k);else if(L.objectMode||pe&&pe.length>0)if(typeof pe=="string"||L.objectMode||Object.getPrototypeOf(pe)===h.prototype||(pe=(function(ne){return h.from(ne)})(pe)),O)L.endEmitted?fe(Ie,new W):Te(Ie,L,pe,!0);else if(L.ended)fe(Ie,new M);else{if(L.destroyed)return!1;L.reading=!1,L.decoder&&!Be?(pe=L.decoder.write(pe),L.objectMode||pe.length!==0?Te(Ie,L,pe,!1):ce(Ie,L)):Te(Ie,L,pe,!1)}else O||(L.reading=!1,ce(Ie,L));return!L.ended&&(L.length<L.highWaterMark||L.length===0)}function Te(Ie,pe,Be,O){pe.flowing&&pe.length===0&&!pe.sync?(pe.awaitDrain=0,Ie.emit("data",Be)):(pe.length+=pe.objectMode?1:Be.length,O?pe.buffer.unshift(Be):pe.buffer.push(Be),pe.needReadable&&de(Ie)),ce(Ie,pe)}Object.defineProperty(j.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._readableState.destroyed},set:function(Ie){this._readableState&&(this._readableState.destroyed=Ie)}}),j.prototype.destroy=m.destroy,j.prototype._undestroy=m.undestroy,j.prototype._destroy=function(Ie,pe){pe(Ie)},j.prototype.push=function(Ie,pe){var Be,O=this._readableState;return O.objectMode?Be=!0:typeof Ie=="string"&&((pe=pe||O.defaultEncoding)!==O.encoding&&(Ie=h.from(Ie,pe),pe=""),Be=!0),se(this,Ie,pe,!1,Be)},j.prototype.unshift=function(Ie){return se(this,Ie,null,!0,!1)},j.prototype.isPaused=function(){return this._readableState.flowing===!1},j.prototype.setEncoding=function(Ie){y||(y=t(748).StringDecoder);var pe=new y(Ie);this._readableState.decoder=pe,this._readableState.encoding=this._readableState.decoder.encoding;for(var Be=this._readableState.buffer.head,O="";Be!==null;)O+=pe.write(Be.data),Be=Be.next;return this._readableState.buffer.clear(),O!==""&&this._readableState.buffer.push(O),this._readableState.length=O.length,this};var Ae=1073741824;function ze(Ie,pe){return Ie<=0||pe.length===0&&pe.ended?0:pe.objectMode?1:Ie!=Ie?pe.flowing&&pe.length?pe.buffer.head.data.length:pe.length:(Ie>pe.highWaterMark&&(pe.highWaterMark=(function(Be){return Be>=Ae?Be=Ae:(Be--,Be|=Be>>>1,Be|=Be>>>2,Be|=Be>>>4,Be|=Be>>>8,Be|=Be>>>16,Be++),Be})(Ie)),Ie<=pe.length?Ie:pe.ended?pe.length:(pe.needReadable=!0,0))}function de(Ie){var pe=Ie._readableState;r("emitReadable",pe.needReadable,pe.emittedReadable),pe.needReadable=!1,pe.emittedReadable||(r("emitReadable",pe.flowing),pe.emittedReadable=!0,process.nextTick(we,Ie))}function we(Ie){var pe=Ie._readableState;r("emitReadable_",pe.destroyed,pe.length,pe.ended),pe.destroyed||!pe.length&&!pe.ended||(Ie.emit("readable"),pe.emittedReadable=!1),pe.needReadable=!pe.flowing&&!pe.ended&&pe.length<=pe.highWaterMark,et(Ie)}function ce(Ie,pe){pe.readingMore||(pe.readingMore=!0,process.nextTick(he,Ie,pe))}function he(Ie,pe){for(;!pe.reading&&!pe.ended&&(pe.length<pe.highWaterMark||pe.flowing&&pe.length===0);){var Be=pe.length;if(r("maybeReadMore read 0"),Ie.read(0),Be===pe.length)break}pe.readingMore=!1}function Pe(Ie){var pe=Ie._readableState;pe.readableListening=Ie.listenerCount("readable")>0,pe.resumeScheduled&&!pe.paused?pe.flowing=!0:Ie.listenerCount("data")>0&&Ie.resume()}function $e(Ie){r("readable nexttick read 0"),Ie.read(0)}function He(Ie,pe){r("resume",pe.reading),pe.reading||Ie.read(0),pe.resumeScheduled=!1,Ie.emit("resume"),et(Ie),pe.flowing&&!pe.reading&&Ie.read(0)}function et(Ie){var pe=Ie._readableState;for(r("flow",pe.flowing);pe.flowing&&Ie.read()!==null;);}function Ve(Ie,pe){return pe.length===0?null:(pe.objectMode?Be=pe.buffer.shift():!Ie||Ie>=pe.length?(Be=pe.decoder?pe.buffer.join(""):pe.buffer.length===1?pe.buffer.first():pe.buffer.concat(pe.length),pe.buffer.clear()):Be=pe.buffer.consume(Ie,pe.decoder),Be);var Be}function Et(Ie){var pe=Ie._readableState;r("endReadable",pe.endEmitted),pe.endEmitted||(pe.ended=!0,process.nextTick(Nt,pe,Ie))}function Nt(Ie,pe){if(r("endReadableNT",Ie.endEmitted,Ie.length),!Ie.endEmitted&&Ie.length===0&&(Ie.endEmitted=!0,pe.readable=!1,pe.emit("end"),Ie.autoDestroy)){var Be=pe._writableState;(!Be||Be.autoDestroy&&Be.finished)&&pe.destroy()}}function $t(Ie,pe){for(var Be=0,O=Ie.length;Be<O;Be++)if(Ie[Be]===pe)return Be;return-1}j.prototype.read=function(Ie){r("read",Ie),Ie=parseInt(Ie,10);var pe=this._readableState,Be=Ie;if(Ie!==0&&(pe.emittedReadable=!1),Ie===0&&pe.needReadable&&((pe.highWaterMark!==0?pe.length>=pe.highWaterMark:pe.length>0)||pe.ended))return r("read: emitReadable",pe.length,pe.ended),pe.length===0&&pe.ended?Et(this):de(this),null;if((Ie=ze(Ie,pe))===0&&pe.ended)return pe.length===0&&Et(this),null;var O,z=pe.needReadable;return r("need readable",z),(pe.length===0||pe.length-Ie<pe.highWaterMark)&&r("length less than watermark",z=!0),pe.ended||pe.reading?r("reading or ended",z=!1):z&&(r("do read"),pe.reading=!0,pe.sync=!0,pe.length===0&&(pe.needReadable=!0),this._read(pe.highWaterMark),pe.sync=!1,pe.reading||(Ie=ze(Be,pe))),(O=Ie>0?Ve(Ie,pe):null)===null?(pe.needReadable=pe.length<=pe.highWaterMark,Ie=0):(pe.length-=Ie,pe.awaitDrain=0),pe.length===0&&(pe.ended||(pe.needReadable=!0),Be!==Ie&&pe.ended&&Et(this)),O!==null&&this.emit("data",O),O},j.prototype._read=function(Ie){fe(this,new R("_read()"))},j.prototype.pipe=function(Ie,pe){var Be=this,O=this._readableState;switch(O.pipesCount){case 0:O.pipes=Ie;break;case 1:O.pipes=[O.pipes,Ie];break;default:O.pipes.push(Ie)}O.pipesCount+=1,r("pipe count=%d opts=%j",O.pipesCount,pe);var z=pe&&pe.end===!1||Ie===process.stdout||Ie===process.stderr?Fe:k;function k(){r("onend"),Ie.end()}O.endEmitted?process.nextTick(z):Be.once("end",z),Ie.on("unpipe",(function Ue(Ke,tt){r("onunpipe"),Ke===Be&&tt&&tt.hasUnpiped===!1&&(tt.hasUnpiped=!0,r("cleanup"),Ie.removeListener("close",Ye),Ie.removeListener("finish",qe),Ie.removeListener("drain",L),Ie.removeListener("error",De),Ie.removeListener("unpipe",Ue),Be.removeListener("end",k),Be.removeListener("end",Fe),Be.removeListener("data",H),ne=!0,!O.awaitDrain||Ie._writableState&&!Ie._writableState.needDrain||L())}));var L=(function(Ue){return function(){var Ke=Ue._readableState;r("pipeOnDrain",Ke.awaitDrain),Ke.awaitDrain&&Ke.awaitDrain--,Ke.awaitDrain===0&&i(Ue,"data")&&(Ke.flowing=!0,et(Ue))}})(Be);Ie.on("drain",L);var ne=!1;function H(Ue){r("ondata");var Ke=Ie.write(Ue);r("dest.write",Ke),Ke===!1&&((O.pipesCount===1&&O.pipes===Ie||O.pipesCount>1&&$t(O.pipes,Ie)!==-1)&&!ne&&(r("false write response, pause",O.awaitDrain),O.awaitDrain++),Be.pause())}function De(Ue){r("onerror",Ue),Fe(),Ie.removeListener("error",De),i(Ie,"error")===0&&fe(Ie,Ue)}function Ye(){Ie.removeListener("finish",qe),Fe()}function qe(){r("onfinish"),Ie.removeListener("close",Ye),Fe()}function Fe(){r("unpipe"),Be.unpipe(Ie)}return Be.on("data",H),(function(Ue,Ke,tt){if(typeof Ue.prependListener=="function")return Ue.prependListener(Ke,tt);Ue._events&&Ue._events[Ke]?Array.isArray(Ue._events[Ke])?Ue._events[Ke].unshift(tt):Ue._events[Ke]=[tt,Ue._events[Ke]]:Ue.on(Ke,tt)})(Ie,"error",De),Ie.once("close",Ye),Ie.once("finish",qe),Ie.emit("pipe",Be),O.flowing||(r("pipe resume"),Be.resume()),Ie},j.prototype.unpipe=function(Ie){var pe=this._readableState,Be={hasUnpiped:!1};if(pe.pipesCount===0)return this;if(pe.pipesCount===1)return Ie&&Ie!==pe.pipes||(Ie||(Ie=pe.pipes),pe.pipes=null,pe.pipesCount=0,pe.flowing=!1,Ie&&Ie.emit("unpipe",this,Be)),this;if(!Ie){var O=pe.pipes,z=pe.pipesCount;pe.pipes=null,pe.pipesCount=0,pe.flowing=!1;for(var k=0;k<z;k++)O[k].emit("unpipe",this,{hasUnpiped:!1});return this}var L=$t(pe.pipes,Ie);return L===-1||(pe.pipes.splice(L,1),pe.pipesCount-=1,pe.pipesCount===1&&(pe.pipes=pe.pipes[0]),Ie.emit("unpipe",this,Be)),this},j.prototype.on=function(Ie,pe){var Be=c.prototype.on.call(this,Ie,pe),O=this._readableState;return Ie==="data"?(O.readableListening=this.listenerCount("readable")>0,O.flowing!==!1&&this.resume()):Ie==="readable"&&(O.endEmitted||O.readableListening||(O.readableListening=O.needReadable=!0,O.flowing=!1,O.emittedReadable=!1,r("on readable",O.length,O.reading),O.length?de(this):O.reading||process.nextTick($e,this))),Be},j.prototype.addListener=j.prototype.on,j.prototype.removeListener=function(Ie,pe){var Be=c.prototype.removeListener.call(this,Ie,pe);return Ie==="readable"&&process.nextTick(Pe,this),Be},j.prototype.removeAllListeners=function(Ie){var pe=c.prototype.removeAllListeners.apply(this,arguments);return Ie!=="readable"&&Ie!==void 0||process.nextTick(Pe,this),pe},j.prototype.resume=function(){var Ie=this._readableState;return Ie.flowing||(r("resume"),Ie.flowing=!Ie.readableListening,(function(pe,Be){Be.resumeScheduled||(Be.resumeScheduled=!0,process.nextTick(He,pe,Be))})(this,Ie)),Ie.paused=!1,this},j.prototype.pause=function(){return r("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(r("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},j.prototype.wrap=function(Ie){var pe=this,Be=this._readableState,O=!1;for(var z in Ie.on("end",(function(){if(r("wrapped end"),Be.decoder&&!Be.ended){var L=Be.decoder.end();L&&L.length&&pe.push(L)}pe.push(null)})),Ie.on("data",(function(L){r("wrapped data"),Be.decoder&&(L=Be.decoder.write(L)),Be.objectMode&&L==null||(Be.objectMode||L&&L.length)&&(pe.push(L)||(O=!0,Ie.pause()))})),Ie)this[z]===void 0&&typeof Ie[z]=="function"&&(this[z]=(function(L){return function(){return Ie[L].apply(Ie,arguments)}})(z));for(var k=0;k<ye.length;k++)Ie.on(ye[k],this.emit.bind(this,ye[k]));return this._read=function(L){r("wrapped _read",L),O&&(O=!1,Ie.resume())},this},typeof Symbol=="function"&&(j.prototype[Symbol.asyncIterator]=function(){return u===void 0&&(u=t(5857)),u(this)}),Object.defineProperty(j.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(j.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(j.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(Ie){this._readableState&&(this._readableState.flowing=Ie)}}),j._fromList=Ve,Object.defineProperty(j.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),typeof Symbol=="function"&&(j.from=function(Ie,pe){return l===void 0&&(l=t(3411)),l(j,Ie,pe)})},6756:function(o,e,t){o.exports=y;var n=t(1602).codes,r=n.ERR_METHOD_NOT_IMPLEMENTED,i=n.ERR_MULTIPLE_CALLBACK,c=n.ERR_TRANSFORM_ALREADY_TRANSFORMING,h=n.ERR_TRANSFORM_WITH_LENGTH_0,f=t(884);function g(d,m){var E=this._transformState;E.transforming=!1;var S=E.writecb;if(S===null)return this.emit("error",new i);E.writechunk=null,E.writecb=null,m!=null&&this.push(m),S(d);var _=this._readableState;_.reading=!1,(_.needReadable||_.length<_.highWaterMark)&&this._read(_.highWaterMark)}function y(d){if(!(this instanceof y))return new y(d);f.call(this,d),this._transformState={afterTransform:g.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,d&&(typeof d.transform=="function"&&(this._transform=d.transform),typeof d.flush=="function"&&(this._flush=d.flush)),this.on("prefinish",u)}function u(){var d=this;typeof this._flush!="function"||this._readableState.destroyed?l(this,null,null):this._flush((function(m,E){l(d,m,E)}))}function l(d,m,E){if(m)return d.emit("error",m);if(E!=null&&d.push(E),d._writableState.length)throw new h;if(d._transformState.transforming)throw new c;return d.push(null)}t(7523)(y,f),y.prototype.push=function(d,m){return this._transformState.needTransform=!1,f.prototype.push.call(this,d,m)},y.prototype._transform=function(d,m,E){E(new r("_transform()"))},y.prototype._write=function(d,m,E){var S=this._transformState;if(S.writecb=E,S.writechunk=d,S.writeencoding=m,!S.transforming){var _=this._readableState;(S.needTransform||_.needReadable||_.length<_.highWaterMark)&&this._read(_.highWaterMark)}},y.prototype._read=function(d){var m=this._transformState;m.writechunk===null||m.transforming?m.needTransform=!0:(m.transforming=!0,this._transform(m.writechunk,m.writeencoding,m.afterTransform))},y.prototype._destroy=function(d,m){f.prototype._destroy.call(this,d,(function(E){m(E)}))}},3726:function(o,e,t){function n(ce){var he=this;this.next=null,this.entry=null,this.finish=function(){(function(Pe,$e){var He=Pe.entry;for(Pe.entry=null;He;){var et=He.callback;$e.pendingcb--,et(void 0),He=He.next}$e.corkedRequestsFree.next=Pe})(he,ce)}}var r;o.exports=j,j.WritableState=Y;var i,c={deprecate:t(9e3)},h=t(2611),f=t(44).Buffer,g=(t.g!==void 0?t.g:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){},y=t(2410),u=t(1749).getHighWaterMark,l=t(1602).codes,d=l.ERR_INVALID_ARG_TYPE,m=l.ERR_METHOD_NOT_IMPLEMENTED,E=l.ERR_MULTIPLE_CALLBACK,S=l.ERR_STREAM_CANNOT_PIPE,_=l.ERR_STREAM_DESTROYED,M=l.ERR_STREAM_NULL_VALUES,R=l.ERR_STREAM_WRITE_AFTER_END,W=l.ERR_UNKNOWN_ENCODING,fe=y.errorOrDestroy;function ye(){}function Y(ce,he,Pe){r=r||t(884),ce=ce||{},typeof Pe!="boolean"&&(Pe=he instanceof r),this.objectMode=!!ce.objectMode,Pe&&(this.objectMode=this.objectMode||!!ce.writableObjectMode),this.highWaterMark=u(this,ce,"writableHighWaterMark",Pe),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var $e=ce.decodeStrings===!1;this.decodeStrings=!$e,this.defaultEncoding=ce.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(He){(function(et,Ve){var Et=et._writableState,Nt=Et.sync,$t=Et.writecb;if(typeof $t!="function")throw new E;if((function(pe){pe.writing=!1,pe.writecb=null,pe.length-=pe.writelen,pe.writelen=0})(Et),Ve)(function(pe,Be,O,z,k){--Be.pendingcb,O?(process.nextTick(k,z),process.nextTick(we,pe,Be),pe._writableState.errorEmitted=!0,fe(pe,z)):(k(z),pe._writableState.errorEmitted=!0,fe(pe,z),we(pe,Be))})(et,Et,Nt,Ve,$t);else{var Ie=ze(Et)||et.destroyed;Ie||Et.corked||Et.bufferProcessing||!Et.bufferedRequest||Ae(et,Et),Nt?process.nextTick(Te,et,Et,Ie,$t):Te(et,Et,Ie,$t)}})(he,He)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=ce.emitClose!==!1,this.autoDestroy=!!ce.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new n(this)}function j(ce){var he=this instanceof(r=r||t(884));if(!he&&!i.call(j,this))return new j(ce);this._writableState=new Y(ce,this,he),this.writable=!0,ce&&(typeof ce.write=="function"&&(this._write=ce.write),typeof ce.writev=="function"&&(this._writev=ce.writev),typeof ce.destroy=="function"&&(this._destroy=ce.destroy),typeof ce.final=="function"&&(this._final=ce.final)),h.call(this)}function se(ce,he,Pe,$e,He,et,Ve){he.writelen=$e,he.writecb=Ve,he.writing=!0,he.sync=!0,he.destroyed?he.onwrite(new _("write")):Pe?ce._writev(He,he.onwrite):ce._write(He,et,he.onwrite),he.sync=!1}function Te(ce,he,Pe,$e){Pe||(function(He,et){et.length===0&&et.needDrain&&(et.needDrain=!1,He.emit("drain"))})(ce,he),he.pendingcb--,$e(),we(ce,he)}function Ae(ce,he){he.bufferProcessing=!0;var Pe=he.bufferedRequest;if(ce._writev&&Pe&&Pe.next){var $e=he.bufferedRequestCount,He=new Array($e),et=he.corkedRequestsFree;et.entry=Pe;for(var Ve=0,Et=!0;Pe;)He[Ve]=Pe,Pe.isBuf||(Et=!1),Pe=Pe.next,Ve+=1;He.allBuffers=Et,se(ce,he,!0,he.length,He,"",et.finish),he.pendingcb++,he.lastBufferedRequest=null,et.next?(he.corkedRequestsFree=et.next,et.next=null):he.corkedRequestsFree=new n(he),he.bufferedRequestCount=0}else{for(;Pe;){var Nt=Pe.chunk,$t=Pe.encoding,Ie=Pe.callback;if(se(ce,he,!1,he.objectMode?1:Nt.length,Nt,$t,Ie),Pe=Pe.next,he.bufferedRequestCount--,he.writing)break}Pe===null&&(he.lastBufferedRequest=null)}he.bufferedRequest=Pe,he.bufferProcessing=!1}function ze(ce){return ce.ending&&ce.length===0&&ce.bufferedRequest===null&&!ce.finished&&!ce.writing}function de(ce,he){ce._final((function(Pe){he.pendingcb--,Pe&&fe(ce,Pe),he.prefinished=!0,ce.emit("prefinish"),we(ce,he)}))}function we(ce,he){var Pe=ze(he);if(Pe&&((function(He,et){et.prefinished||et.finalCalled||(typeof He._final!="function"||et.destroyed?(et.prefinished=!0,He.emit("prefinish")):(et.pendingcb++,et.finalCalled=!0,process.nextTick(de,He,et)))})(ce,he),he.pendingcb===0&&(he.finished=!0,ce.emit("finish"),he.autoDestroy))){var $e=ce._readableState;(!$e||$e.autoDestroy&&$e.endEmitted)&&ce.destroy()}return Pe}t(7523)(j,h),Y.prototype.getBuffer=function(){for(var ce=this.bufferedRequest,he=[];ce;)he.push(ce),ce=ce.next;return he},(function(){try{Object.defineProperty(Y.prototype,"buffer",{get:c.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})(),typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(i=Function.prototype[Symbol.hasInstance],Object.defineProperty(j,Symbol.hasInstance,{value:function(ce){return!!i.call(this,ce)||this===j&&ce&&ce._writableState instanceof Y}})):i=function(ce){return ce instanceof this},j.prototype.pipe=function(){fe(this,new S)},j.prototype.write=function(ce,he,Pe){var $e,He=this._writableState,et=!1,Ve=!He.objectMode&&($e=ce,f.isBuffer($e)||$e instanceof g);return Ve&&!f.isBuffer(ce)&&(ce=(function(Et){return f.from(Et)})(ce)),typeof he=="function"&&(Pe=he,he=null),Ve?he="buffer":he||(he=He.defaultEncoding),typeof Pe!="function"&&(Pe=ye),He.ending?(function(Et,Nt){var $t=new R;fe(Et,$t),process.nextTick(Nt,$t)})(this,Pe):(Ve||(function(Et,Nt,$t,Ie){var pe;return $t===null?pe=new M:typeof $t=="string"||Nt.objectMode||(pe=new d("chunk",["string","Buffer"],$t)),!pe||(fe(Et,pe),process.nextTick(Ie,pe),!1)})(this,He,ce,Pe))&&(He.pendingcb++,et=(function(Et,Nt,$t,Ie,pe,Be){if(!$t){var O=(function(ne,H,De){return ne.objectMode||ne.decodeStrings===!1||typeof H!="string"||(H=f.from(H,De)),H})(Nt,Ie,pe);Ie!==O&&($t=!0,pe="buffer",Ie=O)}var z=Nt.objectMode?1:Ie.length;Nt.length+=z;var k=Nt.length<Nt.highWaterMark;if(k||(Nt.needDrain=!0),Nt.writing||Nt.corked){var L=Nt.lastBufferedRequest;Nt.lastBufferedRequest={chunk:Ie,encoding:pe,isBuf:$t,callback:Be,next:null},L?L.next=Nt.lastBufferedRequest:Nt.bufferedRequest=Nt.lastBufferedRequest,Nt.bufferedRequestCount+=1}else se(Et,Nt,!1,z,Ie,pe,Be);return k})(this,He,Ve,ce,he,Pe)),et},j.prototype.cork=function(){this._writableState.corked++},j.prototype.uncork=function(){var ce=this._writableState;ce.corked&&(ce.corked--,ce.writing||ce.corked||ce.bufferProcessing||!ce.bufferedRequest||Ae(this,ce))},j.prototype.setDefaultEncoding=function(ce){if(typeof ce=="string"&&(ce=ce.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((ce+"").toLowerCase())>-1))throw new W(ce);return this._writableState.defaultEncoding=ce,this},Object.defineProperty(j.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(j.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),j.prototype._write=function(ce,he,Pe){Pe(new m("_write()"))},j.prototype._writev=null,j.prototype.end=function(ce,he,Pe){var $e=this._writableState;return typeof ce=="function"?(Pe=ce,ce=null,he=null):typeof he=="function"&&(Pe=he,he=null),ce!=null&&this.write(ce,he),$e.corked&&($e.corked=1,this.uncork()),$e.ending||(function(He,et,Ve){et.ending=!0,we(He,et),Ve&&(et.finished?process.nextTick(Ve):He.once("finish",Ve)),et.ended=!0,He.writable=!1})(this,$e,Pe),this},Object.defineProperty(j.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(j.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==void 0&&this._writableState.destroyed},set:function(ce){this._writableState&&(this._writableState.destroyed=ce)}}),j.prototype.destroy=y.destroy,j.prototype._undestroy=y.undestroy,j.prototype._destroy=function(ce,he){he(ce)}},5857:function(o,e,t){var n;function r(M,R,W){return(R=(function(fe){var ye=(function(Y){if(typeof Y!="object"||Y===null)return Y;var j=Y[Symbol.toPrimitive];if(j!==void 0){var se=j.call(Y,"string");if(typeof se!="object")return se;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(Y)})(fe);return typeof ye=="symbol"?ye:String(ye)})(R))in M?Object.defineProperty(M,R,{value:W,enumerable:!0,configurable:!0,writable:!0}):M[R]=W,M}var i=t(2896),c=Symbol("lastResolve"),h=Symbol("lastReject"),f=Symbol("error"),g=Symbol("ended"),y=Symbol("lastPromise"),u=Symbol("handlePromise"),l=Symbol("stream");function d(M,R){return{value:M,done:R}}function m(M){var R=M[c];if(R!==null){var W=M[l].read();W!==null&&(M[y]=null,M[c]=null,M[h]=null,R(d(W,!1)))}}function E(M){process.nextTick(m,M)}var S=Object.getPrototypeOf((function(){})),_=Object.setPrototypeOf((r(n={get stream(){return this[l]},next:function(){var M=this,R=this[f];if(R!==null)return Promise.reject(R);if(this[g])return Promise.resolve(d(void 0,!0));if(this[l].destroyed)return new Promise((function(Y,j){process.nextTick((function(){M[f]?j(M[f]):Y(d(void 0,!0))}))}));var W,fe=this[y];if(fe)W=new Promise((function(Y,j){return function(se,Te){Y.then((function(){j[g]?se(d(void 0,!0)):j[u](se,Te)}),Te)}})(fe,this));else{var ye=this[l].read();if(ye!==null)return Promise.resolve(d(ye,!1));W=new Promise(this[u])}return this[y]=W,W}},Symbol.asyncIterator,(function(){return this})),r(n,"return",(function(){var M=this;return new Promise((function(R,W){M[l].destroy(null,(function(fe){fe?W(fe):R(d(void 0,!0))}))}))})),n),S);o.exports=function(M){var R,W=Object.create(_,(r(R={},l,{value:M,writable:!0}),r(R,c,{value:null,writable:!0}),r(R,h,{value:null,writable:!0}),r(R,f,{value:null,writable:!0}),r(R,g,{value:M._readableState.endEmitted,writable:!0}),r(R,u,{value:function(fe,ye){var Y=W[l].read();Y?(W[y]=null,W[c]=null,W[h]=null,fe(d(Y,!1))):(W[c]=fe,W[h]=ye)},writable:!0}),R));return W[y]=null,i(M,(function(fe){if(fe&&fe.code!=="ERR_STREAM_PREMATURE_CLOSE"){var ye=W[h];return ye!==null&&(W[y]=null,W[c]=null,W[h]=null,ye(fe)),void(W[f]=fe)}var Y=W[c];Y!==null&&(W[y]=null,W[c]=null,W[h]=null,Y(d(void 0,!0))),W[g]=!0})),M.on("readable",E.bind(null,W)),W}},3791:function(o,e,t){function n(u,l){var d=Object.keys(u);if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(u);l&&(m=m.filter((function(E){return Object.getOwnPropertyDescriptor(u,E).enumerable}))),d.push.apply(d,m)}return d}function r(u){for(var l=1;l<arguments.length;l++){var d=arguments[l]!=null?arguments[l]:{};l%2?n(Object(d),!0).forEach((function(m){i(u,m,d[m])})):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(d)):n(Object(d)).forEach((function(m){Object.defineProperty(u,m,Object.getOwnPropertyDescriptor(d,m))}))}return u}function i(u,l,d){return(l=h(l))in u?Object.defineProperty(u,l,{value:d,enumerable:!0,configurable:!0,writable:!0}):u[l]=d,u}function c(u,l){for(var d=0;d<l.length;d++){var m=l[d];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(u,h(m.key),m)}}function h(u){var l=(function(d){if(typeof d!="object"||d===null)return d;var m=d[Symbol.toPrimitive];if(m!==void 0){var E=m.call(d,"string");if(typeof E!="object")return E;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)})(u);return typeof l=="symbol"?l:String(l)}var f=t(44).Buffer,g=t(3779).inspect,y=g&&g.custom||"inspect";o.exports=(function(){function u(){(function(m,E){if(!(m instanceof E))throw new TypeError("Cannot call a class as a function")})(this,u),this.head=null,this.tail=null,this.length=0}var l,d;return l=u,(d=[{key:"push",value:function(m){var E={data:m,next:null};this.length>0?this.tail.next=E:this.head=E,this.tail=E,++this.length}},{key:"unshift",value:function(m){var E={data:m,next:this.head};this.length===0&&(this.tail=E),this.head=E,++this.length}},{key:"shift",value:function(){if(this.length!==0){var m=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,m}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(m){if(this.length===0)return"";for(var E=this.head,S=""+E.data;E=E.next;)S+=m+E.data;return S}},{key:"concat",value:function(m){if(this.length===0)return f.alloc(0);for(var E,S,_,M=f.allocUnsafe(m>>>0),R=this.head,W=0;R;)E=R.data,S=M,_=W,f.prototype.copy.call(E,S,_),W+=R.data.length,R=R.next;return M}},{key:"consume",value:function(m,E){var S;return m<this.head.data.length?(S=this.head.data.slice(0,m),this.head.data=this.head.data.slice(m)):S=m===this.head.data.length?this.shift():E?this._getString(m):this._getBuffer(m),S}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(m){var E=this.head,S=1,_=E.data;for(m-=_.length;E=E.next;){var M=E.data,R=m>M.length?M.length:m;if(R===M.length?_+=M:_+=M.slice(0,m),(m-=R)==0){R===M.length?(++S,E.next?this.head=E.next:this.head=this.tail=null):(this.head=E,E.data=M.slice(R));break}++S}return this.length-=S,_}},{key:"_getBuffer",value:function(m){var E=f.allocUnsafe(m),S=this.head,_=1;for(S.data.copy(E),m-=S.data.length;S=S.next;){var M=S.data,R=m>M.length?M.length:m;if(M.copy(E,E.length-m,0,R),(m-=R)==0){R===M.length?(++_,S.next?this.head=S.next:this.head=this.tail=null):(this.head=S,S.data=M.slice(R));break}++_}return this.length-=_,E}},{key:y,value:function(m,E){return g(this,r(r({},E),{},{depth:0,customInspect:!1}))}}])&&c(l.prototype,d),Object.defineProperty(l,"prototype",{writable:!1}),u})()},2410:function(o){function e(r,i){n(r,i),t(r)}function t(r){r._writableState&&!r._writableState.emitClose||r._readableState&&!r._readableState.emitClose||r.emit("close")}function n(r,i){r.emit("error",i)}o.exports={destroy:function(r,i){var c=this,h=this._readableState&&this._readableState.destroyed,f=this._writableState&&this._writableState.destroyed;return h||f?(i?i(r):r&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process.nextTick(n,this,r)):process.nextTick(n,this,r)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(r||null,(function(g){!i&&g?c._writableState?c._writableState.errorEmitted?process.nextTick(t,c):(c._writableState.errorEmitted=!0,process.nextTick(e,c,g)):process.nextTick(e,c,g):i?(process.nextTick(t,c),i(g)):process.nextTick(t,c)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(r,i){var c=r._readableState,h=r._writableState;c&&c.autoDestroy||h&&h.autoDestroy?r.destroy(i):r.emit("error",i)}}},2896:function(o,e,t){var n=t(1602).codes.ERR_STREAM_PREMATURE_CLOSE;function r(){}o.exports=function i(c,h,f){if(typeof h=="function")return i(c,null,h);h||(h={}),f=(function(R){var W=!1;return function(){if(!W){W=!0;for(var fe=arguments.length,ye=new Array(fe),Y=0;Y<fe;Y++)ye[Y]=arguments[Y];R.apply(this,ye)}}})(f||r);var g=h.readable||h.readable!==!1&&c.readable,y=h.writable||h.writable!==!1&&c.writable,u=function(){c.writable||d()},l=c._writableState&&c._writableState.finished,d=function(){y=!1,l=!0,g||f.call(c)},m=c._readableState&&c._readableState.endEmitted,E=function(){g=!1,m=!0,y||f.call(c)},S=function(R){f.call(c,R)},_=function(){var R;return g&&!m?(c._readableState&&c._readableState.ended||(R=new n),f.call(c,R)):y&&!l?(c._writableState&&c._writableState.ended||(R=new n),f.call(c,R)):void 0},M=function(){c.req.on("finish",d)};return(function(R){return R.setHeader&&typeof R.abort=="function"})(c)?(c.on("complete",d),c.on("abort",_),c.req?M():c.on("request",M)):y&&!c._writableState&&(c.on("end",u),c.on("close",u)),c.on("end",E),c.on("finish",d),h.error!==!1&&c.on("error",S),c.on("close",_),function(){c.removeListener("complete",d),c.removeListener("abort",_),c.removeListener("request",M),c.req&&c.req.removeListener("finish",d),c.removeListener("end",u),c.removeListener("close",u),c.removeListener("finish",d),c.removeListener("end",E),c.removeListener("error",S),c.removeListener("close",_)}}},3411:function(o){o.exports=function(){throw new Error("Readable.from is not available in the browser")}},8460:function(o,e,t){var n,r=t(1602).codes,i=r.ERR_MISSING_ARGS,c=r.ERR_STREAM_DESTROYED;function h(y){if(y)throw y}function f(y){y()}function g(y,u){return y.pipe(u)}o.exports=function(){for(var y=arguments.length,u=new Array(y),l=0;l<y;l++)u[l]=arguments[l];var d,m=(function(S){return S.length?typeof S[S.length-1]!="function"?h:S.pop():h})(u);if(Array.isArray(u[0])&&(u=u[0]),u.length<2)throw new i("streams");var E=u.map((function(S,_){var M=_<u.length-1;return(function(R,W,fe,ye){ye=(function(se){var Te=!1;return function(){Te||(Te=!0,se.apply(void 0,arguments))}})(ye);var Y=!1;R.on("close",(function(){Y=!0})),n===void 0&&(n=t(2896)),n(R,{readable:W,writable:fe},(function(se){if(se)return ye(se);Y=!0,ye()}));var j=!1;return function(se){if(!Y&&!j)return j=!0,(function(Te){return Te.setHeader&&typeof Te.abort=="function"})(R)?R.abort():typeof R.destroy=="function"?R.destroy():void ye(se||new c("pipe"))}})(S,M,_>0,(function(R){d||(d=R),R&&E.forEach(f),M||(E.forEach(f),m(d))}))}));return u.reduce(g)}},1749:function(o,e,t){var n=t(1602).codes.ERR_INVALID_OPT_VALUE;o.exports={getHighWaterMark:function(r,i,c,h){var f=(function(g,y,u){return g.highWaterMark!=null?g.highWaterMark:y?g[u]:null})(i,h,c);if(f!=null){if(!isFinite(f)||Math.floor(f)!==f||f<0)throw new n(h?c:"highWaterMark",f);return Math.floor(f)}return r.objectMode?16:16384}}},2611:function(o,e,t){o.exports=t(9826).EventEmitter},748:function(o,e,t){var n=t(4598).Buffer,r=n.isEncoding||function(m){switch((m=""+m)&&m.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function i(m){var E;switch(this.encoding=(function(S){var _=(function(M){if(!M)return"utf8";for(var R;;)switch(M){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return M;default:if(R)return;M=(""+M).toLowerCase(),R=!0}})(S);if(typeof _!="string"&&(n.isEncoding===r||!r(S)))throw new Error("Unknown encoding: "+S);return _||S})(m),this.encoding){case"utf16le":this.text=f,this.end=g,E=4;break;case"utf8":this.fillLast=h,E=4;break;case"base64":this.text=y,this.end=u,E=3;break;default:return this.write=l,void(this.end=d)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(E)}function c(m){return m<=127?0:m>>5==6?2:m>>4==14?3:m>>3==30?4:m>>6==2?-1:-2}function h(m){var E=this.lastTotal-this.lastNeed,S=(function(_,M){if((192&M[0])!=128)return _.lastNeed=0,"ï¿½";if(_.lastNeed>1&&M.length>1){if((192&M[1])!=128)return _.lastNeed=1,"ï¿½";if(_.lastNeed>2&&M.length>2&&(192&M[2])!=128)return _.lastNeed=2,"ï¿½"}})(this,m);return S!==void 0?S:this.lastNeed<=m.length?(m.copy(this.lastChar,E,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(m.copy(this.lastChar,E,0,m.length),void(this.lastNeed-=m.length))}function f(m,E){if((m.length-E)%2==0){var S=m.toString("utf16le",E);if(S){var _=S.charCodeAt(S.length-1);if(_>=55296&&_<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=m[m.length-2],this.lastChar[1]=m[m.length-1],S.slice(0,-1)}return S}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=m[m.length-1],m.toString("utf16le",E,m.length-1)}function g(m){var E=m&&m.length?this.write(m):"";if(this.lastNeed){var S=this.lastTotal-this.lastNeed;return E+this.lastChar.toString("utf16le",0,S)}return E}function y(m,E){var S=(m.length-E)%3;return S===0?m.toString("base64",E):(this.lastNeed=3-S,this.lastTotal=3,S===1?this.lastChar[0]=m[m.length-1]:(this.lastChar[0]=m[m.length-2],this.lastChar[1]=m[m.length-1]),m.toString("base64",E,m.length-S))}function u(m){var E=m&&m.length?this.write(m):"";return this.lastNeed?E+this.lastChar.toString("base64",0,3-this.lastNeed):E}function l(m){return m.toString(this.encoding)}function d(m){return m&&m.length?this.write(m):""}e.StringDecoder=i,i.prototype.write=function(m){if(m.length===0)return"";var E,S;if(this.lastNeed){if((E=this.fillLast(m))===void 0)return"";S=this.lastNeed,this.lastNeed=0}else S=0;return S<m.length?E?E+this.text(m,S):this.text(m,S):E||""},i.prototype.end=function(m){var E=m&&m.length?this.write(m):"";return this.lastNeed?E+"ï¿½":E},i.prototype.text=function(m,E){var S=(function(M,R,W){var fe=R.length-1;if(fe<W)return 0;var ye=c(R[fe]);return ye>=0?(ye>0&&(M.lastNeed=ye-1),ye):--fe<W||ye===-2?0:(ye=c(R[fe]))>=0?(ye>0&&(M.lastNeed=ye-2),ye):--fe<W||ye===-2?0:(ye=c(R[fe]))>=0?(ye>0&&(ye===2?ye=0:M.lastNeed=ye-3),ye):0})(this,m,E);if(!this.lastNeed)return m.toString("utf8",E);this.lastTotal=S;var _=m.length-(S-this.lastNeed);return m.copy(this.lastChar,0,_),m.toString("utf8",E,_)},i.prototype.fillLast=function(m){if(this.lastNeed<=m.length)return m.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);m.copy(this.lastChar,this.lastTotal-this.lastNeed,0,m.length),this.lastNeed-=m.length}},4598:function(o,e,t){var n=t(44),r=n.Buffer;function i(h,f){for(var g in h)f[g]=h[g]}function c(h,f,g){return r(h,f,g)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?o.exports=n:(i(n,e),e.Buffer=c),i(r,c),c.from=function(h,f,g){if(typeof h=="number")throw new TypeError("Argument must not be a number");return r(h,f,g)},c.alloc=function(h,f,g){if(typeof h!="number")throw new TypeError("Argument must be a number");var y=r(h);return f!==void 0?typeof g=="string"?y.fill(f,g):y.fill(f):y.fill(0),y},c.allocUnsafe=function(h){if(typeof h!="number")throw new TypeError("Argument must be a number");return r(h)},c.allocUnsafeSlow=function(h){if(typeof h!="number")throw new TypeError("Argument must be a number");return n.SlowBuffer(h)}},8571:function(o,e,t){var n;(function(r,i){var c="function",h="undefined",f="object",g="string",y="major",u="model",l="name",d="type",m="vendor",E="version",S="architecture",_="console",M="mobile",R="tablet",W="smarttv",fe="wearable",ye="embedded",Y="Amazon",j="Apple",se="ASUS",Te="BlackBerry",Ae="Browser",ze="Chrome",de="Firefox",we="Google",ce="Huawei",he="LG",Pe="Microsoft",$e="Motorola",He="Opera",et="Samsung",Ve="Sharp",Et="Sony",Nt="Xiaomi",$t="Zebra",Ie="Facebook",pe="Chromium OS",Be="Mac OS",O=function(Ke){for(var tt={},nt=0;nt<Ke.length;nt++)tt[Ke[nt].toUpperCase()]=Ke[nt];return tt},z=function(Ke,tt){return typeof Ke===g&&k(tt).indexOf(k(Ke))!==-1},k=function(Ke){return Ke.toLowerCase()},L=function(Ke,tt){if(typeof Ke===g)return Ke=Ke.replace(/^\s\s*/,""),typeof tt===h?Ke:Ke.substring(0,500)},ne=function(Ke,tt){for(var nt,dt,Gt,vt,Tt,yt,Zt=0;Zt<tt.length&&!Tt;){var _n=tt[Zt],An=tt[Zt+1];for(nt=dt=0;nt<_n.length&&!Tt&&_n[nt];)if(Tt=_n[nt++].exec(Ke))for(Gt=0;Gt<An.length;Gt++)yt=Tt[++dt],typeof(vt=An[Gt])===f&&vt.length>0?vt.length===2?typeof vt[1]==c?this[vt[0]]=vt[1].call(this,yt):this[vt[0]]=vt[1]:vt.length===3?typeof vt[1]!==c||vt[1].exec&&vt[1].test?this[vt[0]]=yt?yt.replace(vt[1],vt[2]):i:this[vt[0]]=yt?vt[1].call(this,yt,vt[2]):i:vt.length===4&&(this[vt[0]]=yt?vt[3].call(this,yt.replace(vt[1],vt[2])):i):this[vt]=yt||i;Zt+=2}},H=function(Ke,tt){for(var nt in tt)if(typeof tt[nt]===f&&tt[nt].length>0){for(var dt=0;dt<tt[nt].length;dt++)if(z(tt[nt][dt],Ke))return nt==="?"?i:nt}else if(z(tt[nt],Ke))return nt==="?"?i:nt;return Ke},De={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Ye={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[E,[l,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[E,[l,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[l,E],[/opios[\/ ]+([\w\.]+)/i],[E,[l,He+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[E,[l,He+" GX"]],[/\bopr\/([\w\.]+)/i],[E,[l,He]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[E,[l,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[l,E],[/\bddg\/([\w\.]+)/i],[E,[l,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[E,[l,"UC"+Ae]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[E,[l,"WeChat"]],[/konqueror\/([\w\.]+)/i],[E,[l,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[E,[l,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[E,[l,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[E,[l,"Smart Lenovo "+Ae]],[/(avast|avg)\/([\w\.]+)/i],[[l,/(.+)/,"$1 Secure "+Ae],E],[/\bfocus\/([\w\.]+)/i],[E,[l,de+" Focus"]],[/\bopt\/([\w\.]+)/i],[E,[l,He+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[E,[l,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[E,[l,"Dolphin"]],[/coast\/([\w\.]+)/i],[E,[l,He+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[E,[l,"MIUI "+Ae]],[/fxios\/([-\w\.]+)/i],[E,[l,de]],[/\bqihu|(qi?ho?o?|360)browser/i],[[l,"360 "+Ae]],[/(oculus|sailfish|huawei|vivo)browser\/([\w\.]+)/i],[[l,/(.+)/,"$1 "+Ae],E],[/samsungbrowser\/([\w\.]+)/i],[E,[l,et+" Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[l,/_/g," "],E],[/metasr[\/ ]?([\d\.]+)/i],[E,[l,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[l,"Sogou Mobile"],E],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[l,E],[/(lbbrowser)/i,/\[(linkedin)app\]/i],[l],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[l,Ie],E],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[l,E],[/\bgsa\/([\w\.]+) .*safari\//i],[E,[l,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[E,[l,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[E,[l,ze+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[l,ze+" WebView"],E],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[E,[l,"Android "+Ae]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[l,E],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[E,[l,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[E,l],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[l,[E,H,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[l,E],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[l,"Netscape"],E],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[E,[l,de+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[l,E],[/(cobalt)\/([\w\.]+)/i],[l,[E,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[S,"amd64"]],[/(ia32(?=;))/i],[[S,k]],[/((?:i[346]|x)86)[;\)]/i],[[S,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[S,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[S,"armhf"]],[/windows (ce|mobile); ppc;/i],[[S,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[S,/ower/,"",k]],[/(sun4\w)[;\)]/i],[[S,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[S,k]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[u,[m,et],[d,R]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[u,[m,et],[d,M]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[u,[m,j],[d,M]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[u,[m,j],[d,R]],[/(macintosh);/i],[u,[m,j]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[u,[m,Ve],[d,M]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[u,[m,ce],[d,R]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[u,[m,ce],[d,M]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[u,/_/g," "],[m,Nt],[d,M]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[u,/_/g," "],[m,Nt],[d,R]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[u,[m,"OPPO"],[d,M]],[/\b(opd2\d{3}a?) bui/i],[u,[m,"OPPO"],[d,R]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[u,[m,"Vivo"],[d,M]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[u,[m,"Realme"],[d,M]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[u,[m,$e],[d,M]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[u,[m,$e],[d,R]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[u,[m,he],[d,R]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[u,[m,he],[d,M]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[u,[m,"Lenovo"],[d,R]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[u,/_/g," "],[m,"Nokia"],[d,M]],[/(pixel c)\b/i],[u,[m,we],[d,R]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[u,[m,we],[d,M]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[u,[m,Et],[d,M]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[u,"Xperia Tablet"],[m,Et],[d,R]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[u,[m,"OnePlus"],[d,M]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[u,[m,Y],[d,R]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[u,/(.+)/g,"Fire Phone $1"],[m,Y],[d,M]],[/(playbook);[-\w\),; ]+(rim)/i],[u,m,[d,R]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[u,[m,Te],[d,M]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[u,[m,se],[d,R]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[u,[m,se],[d,M]],[/(nexus 9)/i],[u,[m,"HTC"],[d,R]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[m,[u,/_/g," "],[d,M]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[u,[m,"Acer"],[d,R]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[u,[m,"Meizu"],[d,M]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[u,[m,"Ulefone"],[d,M]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[m,u,[d,M]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[m,u,[d,R]],[/(surface duo)/i],[u,[m,Pe],[d,R]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[u,[m,"Fairphone"],[d,M]],[/(u304aa)/i],[u,[m,"AT&T"],[d,M]],[/\bsie-(\w*)/i],[u,[m,"Siemens"],[d,M]],[/\b(rct\w+) b/i],[u,[m,"RCA"],[d,R]],[/\b(venue[\d ]{2,7}) b/i],[u,[m,"Dell"],[d,R]],[/\b(q(?:mv|ta)\w+) b/i],[u,[m,"Verizon"],[d,R]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[u,[m,"Barnes & Noble"],[d,R]],[/\b(tm\d{3}\w+) b/i],[u,[m,"NuVision"],[d,R]],[/\b(k88) b/i],[u,[m,"ZTE"],[d,R]],[/\b(nx\d{3}j) b/i],[u,[m,"ZTE"],[d,M]],[/\b(gen\d{3}) b.+49h/i],[u,[m,"Swiss"],[d,M]],[/\b(zur\d{3}) b/i],[u,[m,"Swiss"],[d,R]],[/\b((zeki)?tb.*\b) b/i],[u,[m,"Zeki"],[d,R]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[m,"Dragon Touch"],u,[d,R]],[/\b(ns-?\w{0,9}) b/i],[u,[m,"Insignia"],[d,R]],[/\b((nxa|next)-?\w{0,9}) b/i],[u,[m,"NextBook"],[d,R]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[m,"Voice"],u,[d,M]],[/\b(lvtel\-)?(v1[12]) b/i],[[m,"LvTel"],u,[d,M]],[/\b(ph-1) /i],[u,[m,"Essential"],[d,M]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[u,[m,"Envizen"],[d,R]],[/\b(trio[-\w\. ]+) b/i],[u,[m,"MachSpeed"],[d,R]],[/\btu_(1491) b/i],[u,[m,"Rotor"],[d,R]],[/(shield[\w ]+) b/i],[u,[m,"Nvidia"],[d,R]],[/(sprint) (\w+)/i],[m,u,[d,M]],[/(kin\.[onetw]{3})/i],[[u,/\./g," "],[m,Pe],[d,M]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[u,[m,$t],[d,R]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[u,[m,$t],[d,M]],[/smart-tv.+(samsung)/i],[m,[d,W]],[/hbbtv.+maple;(\d+)/i],[[u,/^/,"SmartTV"],[m,et],[d,W]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[m,he],[d,W]],[/(apple) ?tv/i],[m,[u,j+" TV"],[d,W]],[/crkey/i],[[u,ze+"cast"],[m,we],[d,W]],[/droid.+aft(\w+)( bui|\))/i],[u,[m,Y],[d,W]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[u,[m,Ve],[d,W]],[/(bravia[\w ]+)( bui|\))/i],[u,[m,Et],[d,W]],[/(mitv-\w{5}) bui/i],[u,[m,Nt],[d,W]],[/Hbbtv.*(technisat) (.*);/i],[m,u,[d,W]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[m,L],[u,L],[d,W]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[d,W]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[m,u,[d,_]],[/droid.+; (shield) bui/i],[u,[m,"Nvidia"],[d,_]],[/(playstation [345portablevi]+)/i],[u,[m,Et],[d,_]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[u,[m,Pe],[d,_]],[/((pebble))app/i],[m,u,[d,fe]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[u,[m,j],[d,fe]],[/droid.+; (glass) \d/i],[u,[m,we],[d,fe]],[/droid.+; (wt63?0{2,3})\)/i],[u,[m,$t],[d,fe]],[/(quest( \d| pro)?)/i],[u,[m,Ie],[d,fe]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[m,[d,ye]],[/(aeobc)\b/i],[u,[m,Y],[d,ye]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[u,[d,M]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[u,[d,R]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[d,R]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[d,M]],[/(android[-\w\. ]{0,9});.+buil/i],[u,[m,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[E,[l,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[E,[l,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[l,E],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[E,l]],os:[[/microsoft (windows) (vista|xp)/i],[l,E],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[l,[E,H,De]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[E,H,De],[l,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[E,/_/g,"."],[l,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[l,Be],[E,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[E,l],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[l,E],[/\(bb(10);/i],[E,[l,Te]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[E,[l,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[E,[l,de+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[E,[l,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[E,[l,"watchOS"]],[/crkey\/([\d\.]+)/i],[E,[l,ze+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[l,pe],E],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[l,E],[/(sunos) ?([\w\.\d]*)/i],[[l,"Solaris"],E],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[l,E]]},qe=function(Ke,tt){if(typeof Ke===f&&(tt=Ke,Ke=i),!(this instanceof qe))return new qe(Ke,tt).getResult();var nt=typeof r!==h&&r.navigator?r.navigator:i,dt=Ke||(nt&&nt.userAgent?nt.userAgent:""),Gt=nt&&nt.userAgentData?nt.userAgentData:i,vt=tt?(function(yt,Zt){var _n={};for(var An in yt)Zt[An]&&Zt[An].length%2==0?_n[An]=Zt[An].concat(yt[An]):_n[An]=yt[An];return _n})(Ye,tt):Ye,Tt=nt&&nt.userAgent==dt;return this.getBrowser=function(){var yt,Zt={};return Zt[l]=i,Zt[E]=i,ne.call(Zt,dt,vt.browser),Zt[y]=typeof(yt=Zt[E])===g?yt.replace(/[^\d\.]/g,"").split(".")[0]:i,Tt&&nt&&nt.brave&&typeof nt.brave.isBrave==c&&(Zt[l]="Brave"),Zt},this.getCPU=function(){var yt={};return yt[S]=i,ne.call(yt,dt,vt.cpu),yt},this.getDevice=function(){var yt={};return yt[m]=i,yt[u]=i,yt[d]=i,ne.call(yt,dt,vt.device),Tt&&!yt[d]&&Gt&&Gt.mobile&&(yt[d]=M),Tt&&yt[u]=="Macintosh"&&nt&&typeof nt.standalone!==h&&nt.maxTouchPoints&&nt.maxTouchPoints>2&&(yt[u]="iPad",yt[d]=R),yt},this.getEngine=function(){var yt={};return yt[l]=i,yt[E]=i,ne.call(yt,dt,vt.engine),yt},this.getOS=function(){var yt={};return yt[l]=i,yt[E]=i,ne.call(yt,dt,vt.os),Tt&&!yt[l]&&Gt&&Gt.platform&&Gt.platform!="Unknown"&&(yt[l]=Gt.platform.replace(/chrome os/i,pe).replace(/macos/i,Be)),yt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return dt},this.setUA=function(yt){return dt=typeof yt===g&&yt.length>500?L(yt,500):yt,this},this.setUA(dt),this};qe.VERSION="1.0.38",qe.BROWSER=O([l,E,y]),qe.CPU=O([S]),qe.DEVICE=O([u,m,d,_,M,W,R,fe,ye]),qe.ENGINE=qe.OS=O([l,E]),typeof e!==h?(o.exports&&(e=o.exports=qe),e.UAParser=qe):t.amdO?(n=(function(){return qe}).call(e,t,e,o))===i||(o.exports=n):typeof r!==h&&(r.UAParser=qe);var Fe=typeof r!==h&&(r.jQuery||r.Zepto);if(Fe&&!Fe.ua){var Ue=new qe;Fe.ua=Ue.getResult(),Fe.ua.get=function(){return Ue.getUA()},Fe.ua.set=function(Ke){Ue.setUA(Ke);var tt=Ue.getResult();for(var nt in tt)Fe.ua[nt]=tt[nt]}}})(typeof window=="object"?window:this)},9e3:function(o,e,t){function n(r){try{if(!t.g.localStorage)return!1}catch{return!1}var i=t.g.localStorage[r];return i!=null&&String(i).toLowerCase()==="true"}o.exports=function(r,i){if(n("noDeprecation"))return r;var c=!1;return function(){if(!c){if(n("throwDeprecation"))throw new Error(i);n("traceDeprecation")?console.trace(i):console.warn(i),c=!0}return r.apply(this,arguments)}}},3779:function(){},7199:function(){},5393:function(o,e,t){t.r(e),t.d(e,{Debug:function(){return i.default},FactoryMaker:function(){return r.default},MediaPlayer:function(){return n.default}});var n=t(8200),r=t(138),i=t(649),c=t(8986),h=typeof window<"u"&&window||global,f=h.dashjs;f||(f=h.dashjs={}),f.MediaPlayer=n.default,f.FactoryMaker=r.default,f.Debug=i.default,f.Version=(0,c.getVersionString)(),e.default=f},649:function(o,e,t){t.r(e);var n=t(8850),r=t(3621),i=t(138);function c(f){f=f||{};const g=this.context,y=(0,n.default)(g).getInstance(),u=f.settings,l=[];let d,m,E,S;function _(j){return j&&j.bind?j.bind(window.console):window.console.log.bind(window.console)}function M(...j){Y(1,this,...j)}function R(...j){Y(2,this,...j)}function W(...j){Y(3,this,...j)}function fe(...j){Y(4,this,...j)}function ye(...j){Y(5,this,...j)}function Y(j,se,...Te){let Ae="",ze=null;m&&(ze=new Date().getTime(),Ae+="["+(ze-S)+"]"),E&&se&&se.getClassName&&(Ae+="["+se.getClassName()+"]",se.getType&&(Ae+="["+se.getType()+"]")),Ae.length>0&&(Ae+=" "),Array.apply(null,Te).forEach((function(de){Ae+=de+" "})),l[j]&&u&&u.get().debug.logLevel>=j&&l[j](Ae),u&&u.get().debug.dispatchEvent&&y.trigger(r.default.LOG,{message:Ae,level:j})}return d={getLogger:function(j){return{fatal:M.bind(j),error:R.bind(j),warn:W.bind(j),info:fe.bind(j),debug:ye.bind(j)}},setLogTimestampVisible:function(j){m=j},setCalleeNameVisible:function(j){E=j}},m=!0,E=!0,S=new Date().getTime(),typeof window<"u"&&window.console&&(l[1]=_(window.console.error),l[2]=_(window.console.error),l[3]=_(window.console.warn),l[4]=_(window.console.info),l[5]=_(window.console.debug)),d}c.__dashjs_factory_name="Debug";const h=i.default.getSingletonFactory(c);h.LOG_LEVEL_NONE=0,h.LOG_LEVEL_FATAL=1,h.LOG_LEVEL_ERROR=2,h.LOG_LEVEL_WARNING=3,h.LOG_LEVEL_INFO=4,h.LOG_LEVEL_DEBUG=5,i.default.updateSingletonFactory(c.__dashjs_factory_name,h),e.default=h},8850:function(o,e,t){t.r(e);var n=t(138),r=t(1191);function i(){let h={};function f(u,l,d,m={},E=!1){if(!u)throw new Error("event type cannot be null or undefined");if(!l||typeof l!="function")throw new Error("listener must be a function: "+l);let S=m.priority||0;if(y(u,l,d)>=0)return;h[u]=h[u]||[];const _={callback:l,scope:d,priority:S,executeOnlyOnce:E};d&&d.getStreamId&&(_.streamId=d.getStreamId()),d&&d.getType&&(_.mediaType=d.getType()),m&&m.mode&&(_.mode=m.mode),h[u].some(((M,R)=>{if(M&&S>M.priority)return h[u].splice(R,0,_),!0}))||h[u].push(_)}function g(u,l,d){if(!u||!l||!h[u])return;const m=y(u,l,d);m<0||(h[u][m]=null)}function y(u,l,d){let m=-1;return h[u]&&h[u].some(((E,S)=>{if(E&&E.callback===l&&(!d||d===E.scope))return m=S,!0})),m}return{on:function(u,l,d,m={}){f(u,l,d,m)},once:function(u,l,d,m={}){f(u,l,d,m,!0)},off:g,trigger:function(u,l={},d={}){if(!u||!h[u])return;if((l=l||{}).hasOwnProperty("type"))throw new Error("'type' is a reserved word for event dispatching");l.type=u,d.streamId&&(l.streamId=d.streamId),d.mediaType&&(l.mediaType=d.mediaType);const m=[];h[u].filter((E=>!(!E||d.streamId&&E.streamId&&E.streamId!==d.streamId||d.mediaType&&E.mediaType&&E.mediaType!==d.mediaType||d.mode&&E.mode&&E.mode!==d.mode||!E.mode&&d.mode&&d.mode===r.default.EVENT_MODE_ON_RECEIVE))).forEach((E=>{E&&E.callback.call(E.scope,l),E.executeOnlyOnce&&m.push(E)})),m.forEach((E=>{g(u,E.callback,E.scope)}))},reset:function(){h={}}}}i.__dashjs_factory_name="EventBus";const c=n.default.getSingletonFactory(i);c.EVENT_PRIORITY_LOW=0,c.EVENT_PRIORITY_HIGH=5e3,n.default.updateSingletonFactory(i.__dashjs_factory_name,c),e.default=c},138:function(o,e,t){t.r(e);const n=(function(){let r,i=[];const c={},h={};function f(l,d){for(const m in i){const E=i[m];if(E.context===l&&E.name===d)return E.instance}return null}function g(l,d){return d[l]}function y(l,d,m){l in m&&(m[l]=d)}function u(l,d,m){let E;const S=l.__dashjs_factory_name,_=d[S];if(_){let M=_.instance;if(!_.override)return M.apply({context:d,factory:r},m);E=l.apply({context:d},m),M=M.apply({context:d,factory:r,parent:E},m);for(const R in M)E.hasOwnProperty(R)&&(E[R]=M[R])}else E=l.apply({context:d},m);return E.getClassName=function(){return S},E}return r={deleteSingletonInstances:function(l){i=i.filter((d=>d.context!==l))},extend:function(l,d,m,E){!E[l]&&d&&(E[l]={instance:d,override:m})},getClassFactory:function(l){let d=g(l.__dashjs_factory_name,h);return d||(d=function(m){return m===void 0&&(m={}),{create:function(){return u(l,m,arguments)}}},h[l.__dashjs_factory_name]=d),d},getClassFactoryByName:function(l){return g(l,h)},getSingletonFactory:function(l){let d=g(l.__dashjs_factory_name,c);return d||(d=function(m){let E;return m===void 0&&(m={}),{getInstance:function(){return E||(E=f(m,l.__dashjs_factory_name)),E||(E=u(l,m,arguments),i.push({name:l.__dashjs_factory_name,context:m,instance:E})),E}}},c[l.__dashjs_factory_name]=d),d},getSingletonFactoryByName:function(l){return g(l,c)},getSingletonInstance:f,setSingletonInstance:function(l,d,m){for(const E in i){const S=i[E];if(S.context===l&&S.name===d)return void(i[E].instance=m)}i.push({name:d,context:l,instance:m})},updateClassFactory:function(l,d){y(l,d,h)},updateSingletonFactory:function(l,d){y(l,d,c)}},r})();e.default=n},8261:function(o,e,t){t.r(e);var n=t(138),r=t(7263),i=t(649),c=t(5212),h=t(7568),f=t(8850),g=t(3621),y=t(4246);function u(){let d;const m=this.context,E=(0,f.default)(m).getInstance(),S={"streaming.delay.liveDelay":g.default.SETTING_UPDATED_LIVE_DELAY,"streaming.delay.liveDelayFragmentCount":g.default.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT,"streaming.liveCatchup.enabled":g.default.SETTING_UPDATED_CATCHUP_ENABLED,"streaming.liveCatchup.playbackRate.min":g.default.SETTING_UPDATED_PLAYBACK_RATE_MIN,"streaming.liveCatchup.playbackRate.max":g.default.SETTING_UPDATED_PLAYBACK_RATE_MAX,"streaming.abr.rules.throughputRule.active":g.default.SETTING_UPDATED_ABR_ACTIVE_RULES,"streaming.abr.rules.bolaRule.active":g.default.SETTING_UPDATED_ABR_ACTIVE_RULES,"streaming.abr.rules.insufficientBufferRule.active":g.default.SETTING_UPDATED_ABR_ACTIVE_RULES,"streaming.abr.rules.switchHistoryRule.active":g.default.SETTING_UPDATED_ABR_ACTIVE_RULES,"streaming.abr.rules.droppedFramesRule.active":g.default.SETTING_UPDATED_ABR_ACTIVE_RULES,"streaming.abr.rules.abandonRequestsRule.active":g.default.SETTING_UPDATED_ABR_ACTIVE_RULES,"streaming.abr.rules.l2ARule.active":g.default.SETTING_UPDATED_ABR_ACTIVE_RULES,"streaming.abr.rules.loLPRule.active":g.default.SETTING_UPDATED_ABR_ACTIVE_RULES,"streaming.abr.maxBitrate.video":g.default.SETTING_UPDATED_MAX_BITRATE,"streaming.abr.maxBitrate.audio":g.default.SETTING_UPDATED_MAX_BITRATE,"streaming.abr.minBitrate.video":g.default.SETTING_UPDATED_MIN_BITRATE,"streaming.abr.minBitrate.audio":g.default.SETTING_UPDATED_MIN_BITRATE},_={debug:{logLevel:i.default.LOG_LEVEL_WARNING,dispatchEvent:!1},streaming:{abandonLoadTimeout:1e4,wallclockTimeUpdateInterval:100,manifestUpdateRetryInterval:100,liveUpdateTimeThresholdInMilliseconds:0,cacheInitSegments:!1,applyServiceDescription:!0,applyProducerReferenceTime:!0,applyContentSteering:!0,enableManifestDurationMismatchFix:!0,parseInbandPrft:!1,enableManifestTimescaleMismatchFix:!1,capabilities:{filterUnsupportedEssentialProperties:!0,supportedEssentialProperties:[{schemeIdUri:c.default.FONT_DOWNLOAD_DVB_SCHEME},{schemeIdUri:c.default.COLOUR_PRIMARIES_SCHEME_ID_URI,value:/1|5|6|7/},{schemeIdUri:c.default.URL_QUERY_INFO_SCHEME},{schemeIdUri:c.default.EXT_URL_QUERY_INFO_SCHEME},{schemeIdUri:c.default.MATRIX_COEFFICIENTS_SCHEME_ID_URI,value:/0|1|5|6/},{schemeIdUri:c.default.TRANSFER_CHARACTERISTICS_SCHEME_ID_URI,value:/1|6|13|14|15/},{schemeIdUri:c.default.SEGMENT_SEQUENCE_REPRESENTATION_SCHEME_ID_URI},...c.default.THUMBNAILS_SCHEME_ID_URIS.map((W=>({schemeIdUri:W})))],useMediaCapabilitiesApi:!0,filterVideoColorimetryEssentialProperties:!1,filterHDRMetadataFormatEssentialProperties:!1,filterAudioChannelConfiguration:!1},events:{eventControllerRefreshDelay:100,deleteEventMessageDataTimeout:1e4},timeShiftBuffer:{calcFromSegmentTimeline:!1,fallbackToSegmentTimeline:!0},metrics:{maxListDepth:100},delay:{liveDelayFragmentCount:NaN,liveDelay:NaN,useSuggestedPresentationDelay:!0},protection:{keepProtectionMediaKeys:!1,keepProtectionMediaKeysMaximumOpenSessions:-1,ignoreEmeEncryptedEvent:!1,detectPlayreadyMessageFormat:!0,ignoreKeyStatuses:!1},buffer:{enableSeekDecorrelationFix:!1,fastSwitchEnabled:null,flushBufferAtTrackSwitch:!1,reuseExistingSourceBuffers:!0,bufferPruningInterval:10,bufferToKeep:20,bufferTimeAtTopQuality:30,bufferTimeAtTopQualityLongForm:60,initialBufferLevel:NaN,bufferTimeDefault:18,longFormContentDurationThreshold:600,stallThreshold:.3,lowLatencyStallThreshold:.3,useAppendWindow:!0,setStallState:!0,avoidCurrentTimeRangePruning:!1,useChangeType:!0,mediaSourceDurationInfinity:!0,resetSourceBuffersForTrackSwitch:!1,syntheticStallEvents:{enabled:!1,ignoreReadyState:!1}},gaps:{jumpGaps:!0,jumpLargeGaps:!0,smallGapLimit:1.5,threshold:.3,enableSeekFix:!0,enableStallFix:!1,stallSeek:.1,seekOffset:0},utcSynchronization:{enabled:!0,useManifestDateHeaderTimeSource:!0,backgroundAttempts:2,timeBetweenSyncAttempts:30,maximumTimeBetweenSyncAttempts:600,minimumTimeBetweenSyncAttempts:2,timeBetweenSyncAttemptsAdjustmentFactor:2,maximumAllowedDrift:100,enableBackgroundSyncAfterSegmentDownloadError:!0,defaultTimingSource:{scheme:"urn:mpeg:dash:utc:http-xsdate:2014",value:"https://time.akamai.com/?iso&ms"},artificialTimeOffsetToApply:0},scheduling:{defaultTimeout:500,lowLatencyTimeout:0,scheduleWhilePaused:!0},text:{defaultEnabled:!0,dispatchForManualRendering:!1,extendSegmentedCues:!0,imsc:{displayForcedOnlyMode:!1,enableRollUp:!0},webvtt:{customRenderingEnabled:!1}},liveCatchup:{maxDrift:NaN,playbackRate:{min:NaN,max:NaN},playbackBufferMin:.5,enabled:null,mode:c.default.LIVE_CATCHUP_MODE_DEFAULT},lastBitrateCachingInfo:{enabled:!0,ttl:36e4},lastMediaSettingsCachingInfo:{enabled:!0,ttl:36e4},saveLastMediaSettingsForCurrentStreamingSession:!0,cacheLoadThresholds:{video:10,audio:5},trackSwitchMode:{audio:c.default.TRACK_SWITCH_MODE_ALWAYS_REPLACE,video:c.default.TRACK_SWITCH_MODE_NEVER_REPLACE},includePreselectionsInMediainfoArray:!0,includePreselectionsForInitialTrackSelection:!1,ignoreSelectionPriority:!1,prioritizeRoleMain:!0,assumeDefaultRoleAsMain:!0,selectionModeForInitialTrack:c.default.TRACK_SELECTION_MODE_LOWEST_STARTUP_DELAY,fragmentRequestTimeout:2e4,fragmentRequestProgressTimeout:-1,manifestRequestTimeout:1e4,retryIntervals:{[h.HTTPRequest.MPD_TYPE]:500,[h.HTTPRequest.XLINK_EXPANSION_TYPE]:500,[h.HTTPRequest.MEDIA_SEGMENT_TYPE]:1e3,[h.HTTPRequest.INIT_SEGMENT_TYPE]:1e3,[h.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE]:1e3,[h.HTTPRequest.INDEX_SEGMENT_TYPE]:1e3,[h.HTTPRequest.MSS_FRAGMENT_INFO_SEGMENT_TYPE]:1e3,[h.HTTPRequest.LICENSE]:1e3,[h.HTTPRequest.OTHER_TYPE]:1e3,lowLatencyReductionFactor:10},retryAttempts:{[h.HTTPRequest.MPD_TYPE]:3,[h.HTTPRequest.XLINK_EXPANSION_TYPE]:1,[h.HTTPRequest.MEDIA_SEGMENT_TYPE]:3,[h.HTTPRequest.INIT_SEGMENT_TYPE]:3,[h.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE]:3,[h.HTTPRequest.INDEX_SEGMENT_TYPE]:3,[h.HTTPRequest.MSS_FRAGMENT_INFO_SEGMENT_TYPE]:3,[h.HTTPRequest.LICENSE]:3,[h.HTTPRequest.OTHER_TYPE]:3,lowLatencyMultiplyFactor:5},abr:{limitBitrateByPortal:!1,usePixelRatioInLimitBitrateByPortal:!1,enableSupplementalPropertyAdaptationSetSwitching:!0,rules:{throughputRule:{active:!0,priority:y.default.PRIORITY.DEFAULT},bolaRule:{active:!0,priority:y.default.PRIORITY.DEFAULT},insufficientBufferRule:{active:!0,priority:y.default.PRIORITY.DEFAULT,parameters:{throughputSafetyFactor:.7,segmentIgnoreCount:2}},switchHistoryRule:{active:!0,priority:y.default.PRIORITY.DEFAULT,parameters:{sampleSize:8,switchPercentageThreshold:.075}},droppedFramesRule:{active:!1,priority:y.default.PRIORITY.DEFAULT,parameters:{minimumSampleSize:375,droppedFramesPercentageThreshold:.15}},abandonRequestsRule:{active:!0,priority:y.default.PRIORITY.DEFAULT,parameters:{abandonDurationMultiplier:1.8,minSegmentDownloadTimeThresholdInMs:500,minThroughputSamplesThreshold:6}},l2ARule:{active:!1,priority:y.default.PRIORITY.DEFAULT},loLPRule:{active:!1,priority:y.default.PRIORITY.DEFAULT}},throughput:{averageCalculationMode:c.default.THROUGHPUT_CALCULATION_MODES.EWMA,lowLatencyDownloadTimeCalculationMode:c.default.LOW_LATENCY_DOWNLOAD_TIME_CALCULATION_MODE.MOOF_PARSING,useResourceTimingApi:!0,useNetworkInformationApi:{xhr:!1,fetch:!1},useDeadTimeLatency:!0,bandwidthSafetyFactor:.9,sampleSettings:{live:3,vod:4,enableSampleSizeAdjustment:!0,decreaseScale:.7,increaseScale:1.3,maxMeasurementsToKeep:20,averageLatencySampleAmount:4},ewma:{throughputSlowHalfLifeSeconds:8,throughputFastHalfLifeSeconds:3,latencySlowHalfLifeCount:2,latencyFastHalfLifeCount:1,weightDownloadTimeMultiplicationFactor:.0015}},maxBitrate:{audio:-1,video:-1},minBitrate:{audio:-1,video:-1},initialBitrate:{audio:-1,video:-1},autoSwitchBitrate:{audio:!0,video:!0}},cmcd:{applyParametersFromMpd:!0,enabled:!1,sid:null,cid:null,rtp:null,rtpSafetyFactor:5,mode:c.default.CMCD_MODE_QUERY,enabledKeys:c.default.CMCD_AVAILABLE_KEYS,includeInRequests:["segment","mpd"],version:1},cmsd:{enabled:!1,abr:{applyMb:!1,etpWeightRatio:0}},enhancement:{enabled:!1,codecs:["lvc1"]},defaultSchemeIdUri:{viewpoint:"",audioChannelConfiguration:"urn:mpeg:mpegB:cicp:ChannelConfiguration",role:"urn:mpeg:dash:role:2011",accessibility:"urn:mpeg:dash:role:2011"}},errors:{recoverAttempts:{mediaErrorDecode:5}}};let M=r.default.clone(_);function R(W,fe,ye){for(let Y in W)W.hasOwnProperty(Y)&&(fe.hasOwnProperty(Y)?typeof W[Y]!="object"||W[Y]instanceof RegExp||W[Y]instanceof Array||W[Y]===null?(fe[Y]=r.default.clone(W[Y]),S[ye+Y]&&E.trigger(S[ye+Y])):R(W[Y],fe[Y],ye.slice()+Y+"."):console.error("Settings parameter "+ye+Y+" is not supported"))}return d={get:function(){return M},update:function(W){typeof W=="object"&&R(W,M,"")},reset:function(){M=r.default.clone(_)}},d}u.__dashjs_factory_name="Settings";let l=n.default.getSingletonFactory(u);e.default=l},7263:function(o,e,t){t.r(e);var n=t(3282),r=t(8571),i=t(5212);class c{static mixin(f,g,y){let u,l={};if(f)for(let d in g)g.hasOwnProperty(d)&&(u=g[d],d in f&&(f[d]===u||d in l&&l[d]===u)||(typeof f[d]=="object"&&f[d]!==null?f[d]=c.mixin(f[d],u,y):f[d]=y(u)));return f}static clone(f){if(!f||typeof f!="object")return f;if(f instanceof RegExp)return new RegExp(f);let g;if(f instanceof Array){g=[];for(let y=0,u=f.length;y<u;++y)y in f&&g.push(c.clone(f[y]))}else g={};return c.mixin(g,f,c.clone)}static addAdditionalQueryParameterToUrl(f,g){try{if(!g||g.length===0)return f;let y=f;return g.forEach((({key:u,value:l})=>{const d=y.includes("?")?"&":"?";y+=`${d}${encodeURIComponent(u)}=${encodeURIComponent(l)}`})),y}catch{return f}}static removeQueryParameterFromUrl(f,g){if(!f||!g)return f;const y=new URL(f),u=new URLSearchParams(y.search);if(!u||u.size===0||!u.has(g))return f;u.delete(g);const l=Array.from(u.entries()).map((([m,E])=>`${m}=${E}`)).join("&"),d=`${y.origin}${y.pathname}`;return l?`${d}?${l}`:d}static parseHttpHeaders(f){let g={};if(!f)return g;let y=f.trim().split(`\r
`);for(let u=0,l=y.length;u<l;u++){let d=y[u],m=d.indexOf(": ");m>0&&(g[d.substring(0,m)]=d.substring(m+2))}return g}static parseQueryParams(f){const g=[],y=new URLSearchParams(f);for(const[u,l]of y.entries())g.push({key:decodeURIComponent(u),value:decodeURIComponent(l)});return g}static generateUuid(){let f=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(g){const y=(f+16*Math.random())%16|0;return f=Math.floor(f/16),(g=="x"?y:3&y|8).toString(16)}))}static generateHashCode(f){let g=0;if(f.length===0)return g;for(let y=0;y<f.length;y++)g=(g<<5)-g+f.charCodeAt(y),g|=0;return g}static getRelativeUrl(f,g){try{const y=new URL(f),u=new URL(g);if(y.protocol=u.protocol,y.origin!==u.origin)return g;let l=n.relative(y.pathname.substr(0,y.pathname.lastIndexOf("/")),u.pathname.substr(0,u.pathname.lastIndexOf("/")));const d=l.length===0?1:0;return l+=u.pathname.substr(u.pathname.lastIndexOf("/")+d,u.pathname.length-1),u.pathname.length<l.length?u.pathname:l}catch{return g}}static getHostFromUrl(f){try{return new URL(f).host}catch{return null}}static parseUserAgent(f=null){try{const g=f===null&&typeof navigator<"u"?navigator.userAgent.toLowerCase():"";return(0,r.UAParser)(g)}catch{return{}}}static stringHasProtocol(f){return/(http(s?)):\/\//i.test(f)}static bufferSourceToDataView(f){return c.toDataView(f,DataView)}static bufferSourceToInt8(f){return c.toDataView(f,Uint8Array)}static uint8ArrayToString(f){return new TextDecoder("utf-8").decode(f)}static bufferSourceToHex(f){const g=c.bufferSourceToInt8(f);let y="";for(let u of g)u=u.toString(16),u.length===1&&(u="0"+u),y+=u;return y}static toDataView(f,g){const y=c.getArrayBuffer(f);let u=1;"BYTES_PER_ELEMENT"in DataView&&(u=DataView.BYTES_PER_ELEMENT);const l=((f.byteOffset||0)+f.byteLength)/u,d=(f.byteOffset||0)/u,m=Math.floor(Math.max(0,Math.min(d,l)));return new g(y,m,Math.floor(Math.min(m+Math.max(1/0,0),l))-m)}static getArrayBuffer(f){return f instanceof ArrayBuffer?f:f.buffer}static getCodecFamily(f){const{base:g,profile:y}=c._getCodecParts(f);switch(g){case"mp4a":switch(y){case"69":case"6b":case"40.34":return i.default.CODEC_FAMILIES.MP3;case"66":case"67":case"68":case"40.2":case"40.02":case"40.5":case"40.05":case"40.29":case"40.42":return i.default.CODEC_FAMILIES.AAC;case"a5":return i.default.CODEC_FAMILIES.AC3;case"e6":return i.default.CODEC_FAMILIES.EC3;case"b2":return i.default.CODEC_FAMILIES.DTSX;case"a9":return i.default.CODEC_FAMILIES.DTSC}break;case"avc1":case"avc3":return i.default.CODEC_FAMILIES.AVC;case"hvc1":case"hvc3":return i.default.CODEC_FAMILIES.HEVC;default:return g}return g}static _getCodecParts(f){const[g,...y]=f.split(".");return{base:g,profile:y.join(".")}}}e.default=c},8986:function(o,e,t){t.r(e),t.d(e,{getVersionString:function(){return r}});const n="5.1.1";function r(){return n}},8748:function(o,e,t){t.r(e),e.default=class{extend(n,r){if(!n)return;let i=!!r&&r.override,c=!!r&&r.publicOnly;for(const h in n)!n.hasOwnProperty(h)||this[h]&&!i||c&&n[h].indexOf("public_")===-1||(this[h]=n[h])}}},5734:function(o,e,t){t.r(e);var n=t(7252);class r extends n.default{constructor(){super(),this.ATTEMPT_BACKGROUND_SYNC="attemptBackgroundSync",this.BUFFERING_COMPLETED="bufferingCompleted",this.BUFFER_CLEARED="bufferCleared",this.BUFFER_REPLACEMENT_STARTED="bufferReplacementStarted",this.BYTES_APPENDED_END_FRAGMENT="bytesAppendedEndFragment",this.CHECK_FOR_EXISTENCE_COMPLETED="checkForExistenceCompleted",this.CMSD_STATIC_HEADER="cmsdStaticHeader",this.CURRENT_TRACK_CHANGED="currentTrackChanged",this.DATA_UPDATE_COMPLETED="dataUpdateCompleted",this.INBAND_EVENTS="inbandEvents",this.INITIAL_STREAM_SWITCH="initialStreamSwitch",this.INIT_FRAGMENT_LOADED="initFragmentLoaded",this.INIT_FRAGMENT_NEEDED="initFragmentNeeded",this.INTERNAL_MANIFEST_LOADED="internalManifestLoaded",this.LOADING_ABANDONED="loadingAborted",this.LOADING_COMPLETED="loadingCompleted",this.LOADING_DATA_PROGRESS="loadingDataProgress",this.LOADING_PROGRESS="loadingProgress",this.MANIFEST_UPDATED="manifestUpdated",this.MEDIAINFO_UPDATED="mediaInfoUpdated",this.MEDIA_FRAGMENT_LOADED="mediaFragmentLoaded",this.MEDIA_FRAGMENT_NEEDED="mediaFragmentNeeded",this.ORIGINAL_MANIFEST_LOADED="originalManifestLoaded",this.QUOTA_EXCEEDED="quotaExceeded",this.SEEK_TARGET="seekTarget",this.SEGMENT_LOCATION_BLACKLIST_ADD="segmentLocationBlacklistAdd",this.SEGMENT_LOCATION_BLACKLIST_CHANGED="segmentLocationBlacklistChanged",this.SERVICE_LOCATION_BASE_URL_BLACKLIST_ADD="serviceLocationBlacklistAdd",this.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED="serviceLocationBlacklistChanged",this.SERVICE_LOCATION_LOCATION_BLACKLIST_ADD="serviceLocationLocationBlacklistAdd",this.SERVICE_LOCATION_LOCATION_BLACKLIST_CHANGED="serviceLocationLocationBlacklistChanged",this.SETTING_UPDATED_ABR_ACTIVE_RULES="settingUpdatedAbrActiveRules",this.SETTING_UPDATED_CATCHUP_ENABLED="settingUpdatedCatchupEnabled",this.SETTING_UPDATED_LIVE_DELAY="settingUpdatedLiveDelay",this.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT="settingUpdatedLiveDelayFragmentCount",this.SETTING_UPDATED_MAX_BITRATE="settingUpdatedMaxBitrate",this.SETTING_UPDATED_MIN_BITRATE="settingUpdatedMinBitrate",this.SETTING_UPDATED_PLAYBACK_RATE_MAX="settingUpdatedPlaybackRateMax",this.SETTING_UPDATED_PLAYBACK_RATE_MIN="settingUpdatedPlaybackRateMin",this.SET_FRAGMENTED_TEXT_AFTER_DISABLED="setFragmentedTextAfterDisabled",this.SET_NON_FRAGMENTED_TEXT="setNonFragmentedText",this.SOURCE_BUFFER_ERROR="sourceBufferError",this.STREAMS_COMPOSED="streamsComposed",this.STREAM_BUFFERING_COMPLETED="streamBufferingCompleted",this.STREAM_REQUESTING_COMPLETED="streamRequestingCompleted",this.TEXT_TRACKS_QUEUE_INITIALIZED="textTracksQueueInitialized",this.TIME_SYNCHRONIZATION_COMPLETED="timeSynchronizationComplete",this.UPDATE_TIME_SYNC_OFFSET="updateTimeSyncOffset",this.URL_RESOLUTION_FAILED="urlResolutionFailed",this.VIDEO_CHUNK_RECEIVED="videoChunkReceived",this.VIDEO_ELEMENT_RESIZED="videoElementResized",this.WALLCLOCK_TIME_UPDATED="wallclockTimeUpdated",this.XLINK_ELEMENT_LOADED="xlinkElementLoaded",this.XLINK_READY="xlinkReady"}}e.default=r},3621:function(o,e,t){t.r(e);var n=t(5734);class r extends n.default{}let i=new r;e.default=i},7252:function(o,e,t){t.r(e),e.default=class{extend(n,r){if(!n)return;let i=!!r&&r.override,c=!!r&&r.publicOnly;for(const h in n)!n.hasOwnProperty(h)||this[h]&&!i||c&&n[h].indexOf("public_")===-1||(this[h]=n[h])}}},8854:function(o,e,t){t.r(e),e.default={ACCESSIBILITY:"Accessibility",ADAPTATION_SET:"AdaptationSet",ADAPTATION_SETS:"adaptationSets",ADAPTATION_SET_SWITCHING_SCHEME_ID_URI:"urn:mpeg:dash:adaptation-set-switching:2016",ADD:"add",ASSET_IDENTIFIER:"AssetIdentifier",AUDIO_CHANNEL_CONFIGURATION:"AudioChannelConfiguration",AUDIO_SAMPLING_RATE:"audioSamplingRate",AVAILABILITY_END_TIME:"availabilityEndTime",AVAILABILITY_START_TIME:"availabilityStartTime",AVAILABILITY_TIME_COMPLETE:"availabilityTimeComplete",AVAILABILITY_TIME_OFFSET:"availabilityTimeOffset",BANDWITH:"bandwidth",BASE_URL:"BaseURL",BITSTREAM_SWITCHING:"BitstreamSwitching",BITSTREAM_SWITCHING_MINUS:"bitstreamSwitching",BYTE_RANGE:"byteRange",CAPTION:"caption",CENC_DEFAULT_KID:"cenc:default_KID",CLIENT_DATA_REPORTING:"ClientDataReporting",CLIENT_REQUIREMENT:"clientRequirement",CMCD_PARAMETERS:"CMCDParameters",CODECS:"codecs",CODEC_PRIVATE_DATA:"codecPrivateData",CODING_DEPENDENCY:"codingDependency",CONTENT_COMPONENT:"ContentComponent",CONTENT_PROTECTION:"ContentProtection",CONTENT_STEERING:"ContentSteering",CONTENT_STEERING_RESPONSE:{VERSION:"VERSION",TTL:"TTL",RELOAD_URI:"RELOAD-URI",PATHWAY_PRIORITY:"PATHWAY-PRIORITY",PATHWAY_CLONES:"PATHWAY-CLONES",BASE_ID:"BASE-ID",ID:"ID",URI_REPLACEMENT:"URI-REPLACEMENT",HOST:"HOST",PARAMS:"PARAMS"},CONTENT_TYPE:"contentType",DEFAULT_SERVICE_LOCATION:"defaultServiceLocation",DEPENDENCY_ID:"dependencyId",DURATION:"duration",DVB_PRIORITY:"dvb:priority",DVB_WEIGHT:"dvb:weight",DVB_URL:"dvb:url",DVB_MIMETYPE:"dvb:mimeType",DVB_FONTFAMILY:"dvb:fontFamily",DYNAMIC:"dynamic",END_NUMBER:"endNumber",ESSENTIAL_PROPERTY:"EssentialProperty",EVENT:"Event",EVENT_STREAM:"EventStream",FORCED_SUBTITLE:"forced-subtitle",FRAMERATE:"frameRate",FRAME_PACKING:"FramePacking",GROUP_LABEL:"GroupLabel",HEIGHT:"height",ID:"id",INBAND:"inband",INBAND_EVENT_STREAM:"InbandEventStream",INDEX:"index",INDEX_RANGE:"indexRange",INITIALIZATION:"Initialization",INITIALIZATION_MINUS:"initialization",LA_URL:"Laurl",LA_URL_LOWER_CASE:"laurl",LABEL:"Label",LANG:"lang",LOCATION:"Location",MAIN:"main",MAXIMUM_SAP_PERIOD:"maximumSAPPeriod",MAX_PLAYOUT_RATE:"maxPlayoutRate",MAX_SEGMENT_DURATION:"maxSegmentDuration",MAX_SUBSEGMENT_DURATION:"maxSubsegmentDuration",MEDIA:"media",MEDIA_PRESENTATION_DURATION:"mediaPresentationDuration",MEDIA_RANGE:"mediaRange",MEDIA_STREAM_STRUCTURE_ID:"mediaStreamStructureId",METRICS:"Metrics",METRICS_MINUS:"metrics",MIME_TYPE:"mimeType",MINIMUM_UPDATE_PERIOD:"minimumUpdatePeriod",MIN_BUFFER_TIME:"minBufferTime",MP4_PROTECTION_SCHEME:"urn:mpeg:dash:mp4protection:2011",MPD:"MPD",MPD_TYPE:"mpd",MPD_PATCH_TYPE:"mpdpatch",ORDER:"order",ORIGINAL_MPD_ID:"mpdId",ORIGINAL_PUBLISH_TIME:"originalPublishTime",PATCH_LOCATION:"PatchLocation",PERIOD:"Period",PRESELECTION:"Preselection",PRESELECTION_COMPONENTS:"preselectionComponents",PRESENTATION_TIME:"presentationTime",PRESENTATION_TIME_OFFSET:"presentationTimeOffset",PRO:"pro",PRODUCER_REFERENCE_TIME:"ProducerReferenceTime",PRODUCER_REFERENCE_TIME_TYPE:{ENCODER:"encoder",CAPTURED:"captured",APPLICATION:"application"},PROFILES:"profiles",PSSH:"pssh",PUBLISH_TIME:"publishTime",QUALITY_RANKING:"qualityRanking",QUERY_BEFORE_START:"queryBeforeStart",QUERY_PART:"$querypart$",RANGE:"range",RATING:"Rating",REF:"ref",REF_ID:"refId",REMOVE:"remove",REPLACE:"replace",REPORTING:"Reporting",REPRESENTATION:"Representation",REPRESENTATION_INDEX:"RepresentationIndex",ROBUSTNESS:"robustness",ROLE:"Role",S:"S",SAR:"sar",SCAN_TYPE:"scanType",SEGMENT_ALIGNMENT:"segmentAlignment",SEGMENT_BASE:"SegmentBase",SEGMENT_LIST:"SegmentList",SEGMENT_PROFILES:"segmentProfiles",SEGMENT_SEQUENCE_PROPERTIES:"SegmentSequenceProperties",SEGMENT_TEMPLATE:"SegmentTemplate",SEGMENT_TIMELINE:"SegmentTimeline",SEGMENT_TYPE:"segment",SEGMENT_URL:"SegmentURL",SERVICE_DESCRIPTION:"ServiceDescription",SERVICE_DESCRIPTION_LATENCY:"Latency",SERVICE_DESCRIPTION_OPERATING_BANDWIDTH:"OperatingBandwidth",SERVICE_DESCRIPTION_OPERATING_QUALITY:"OperatingQuality",SERVICE_DESCRIPTION_PLAYBACK_RATE:"PlaybackRate",SERVICE_DESCRIPTION_SCOPE:"Scope",SERVICE_LOCATION:"serviceLocation",SERVICE_LOCATIONS:"serviceLocations",SOURCE_URL:"sourceURL",START:"start",START_NUMBER:"startNumber",START_WITH_SAP:"startWithSAP",STATIC:"static",STEERING_TYPE:"steering",SUBSET:"Subset",SUBTITLE:"subtitle",SUB_REPRESENTATION:"SubRepresentation",SUB_SEGMENT_ALIGNMENT:"subsegmentAlignment",SUGGESTED_PRESENTATION_DELAY:"suggestedPresentationDelay",SUPPLEMENTAL_PROPERTY:"SupplementalProperty",SUPPLEMENTAL_CODECS:"scte214:supplementalCodecs",TAG:"tag",TIMESCALE:"timescale",TIMESHIFT_BUFFER_DEPTH:"timeShiftBufferDepth",TTL:"ttl",TYPE:"type",UTC_TIMING:"UTCTiming",VALUE:"value",VIEWPOINT:"Viewpoint",WALL_CLOCK_TIME:"wallClockTime",WIDTH:"width"}},5717:function(o,e,t){t.r(e),e.default=class{constructor(){this.schemeIdUri="",this.value=""}}},8200:function(o,e,t){t.r(e),t.d(e,{default:function(){return xg}});var n=t(138),r=t(4246),i={TCP_CONNECTION:"TcpList",HTTP_REQUEST:"HttpList",TRACK_SWITCH:"RepSwitchList",BUFFER_LEVEL:"BufferLevel",BUFFER_LOADED:"bufferLoaded",ABANDON_LOAD:"abandonload",ALLOW_LOAD:"allowload",BUFFER_EMPTY:"bufferStalled",BUFFER_STATE:"BufferState",DVR_INFO:"DVRInfo",DROPPED_FRAMES:"DroppedFrames",SCHEDULING_INFO:"SchedulingInfo",REQUESTS_QUEUE:"RequestsQueue",MANIFEST_UPDATE:"ManifestUpdate",MANIFEST_UPDATE_STREAM_INFO:"ManifestUpdatePeriodInfo",MANIFEST_UPDATE_TRACK_INFO:"ManifestUpdateRepresentationInfo",PLAY_LIST:"PlayList",DVB_ERRORS:"DVBErrors",HTTP_REQUEST_DVB_REPORTING_TYPE:"DVBReporting"},c=t(649),h=t(8261);function f(b){b=b||{};const p=this.context,v=b.dashMetrics;let T,w,A;return T={getSwitchRequest:function(N){try{const C=(0,r.default)(p).create();C.rule=this.getClassName();const x=N.getMediaInfo(),B=N.getMediaType(),q=v.getCurrentBufferState(B),I=N.getScheduleController(),P=N.getAbrController(),D=N.getStreamInfo(),$=D?D.id:null,J=D&&D.manifestInfo?D.manifestInfo.isDynamic:null,Z=N.getThroughputController(),V=Z.getSafeAverageThroughput(B),re=Z.getAverageLatency(B);return isNaN(V)||!q||P.getAbandonmentStateFor($,B)===i.ALLOW_LOAD&&(q.state===i.BUFFER_LOADED||J)&&(C.representation=P.getOptimalRepresentationForBitrate(x,V,!0),C.priority=w.get().streaming.abr.rules.throughputRule.priority,C.reason={throughput:V,latency:re,message:`[ThroughputRule]: Switching to Representation with bitrate ${C.representation?C.representation.bitrateInKbit:"n/a"} kbit/s. Throughput: ${V}`},I.setTimeToLoadDelay(0)),C}catch(C){return A.error(C),(0,r.default)(p).create()}},reset:function(){}},A=(0,c.default)(p).getInstance().getLogger(T),w=(0,h.default)(p).getInstance(),T}f.__dashjs_factory_name="ThroughputRule";var g=n.default.getClassFactory(f),y=t(8850),u=t(3621),l=t(5212),d=t(1191);function m(b){b=b||{};const p=this.context,v=(0,y.default)(p).getInstance(),T=b.dashMetrics,w=(0,h.default)(p).getInstance();let A,N,C;function x(){const I=w.get().streaming.abr.rules.insufficientBufferRule.parameters.segmentIgnoreCount;C={},C[l.default.VIDEO]={ignoreCount:I},C[l.default.AUDIO]={ignoreCount:I},C[l.default.ENHANCEMENT]={ignoreCount:I}}function B(){x()}function q(I){isNaN(I.startTime)||I.mediaType!==l.default.AUDIO&&I.mediaType!==l.default.VIDEO||C[I.mediaType].ignoreCount>0&&C[I.mediaType].ignoreCount--}return A={getSwitchRequest:function(I){const P=(0,r.default)(p).create();if(P.rule=this.getClassName(),!I||!I.hasOwnProperty("getMediaType"))return P;const D=I.getMediaType(),$=T.getCurrentBufferState(D),J=I.getRepresentation().fragmentDuration;if(!(function(re,le,ue){return!re.getLowLatencyModeEnabled()&&C[le].ignoreCount<=0&&ue})(I.getScheduleController().getPlaybackController(),D,J))return P;const Z=I.getMediaInfo(),V=I.getAbrController();if($&&$.state===i.BUFFER_EMPTY)N.debug("["+D+"] Switch to index 0; buffer is empty."),P.representation=V.getOptimalRepresentationForBitrate(Z,0,!0),P.reason={message:"[InsufficientBufferRule]: Switching to lowest Representation because buffer is empty"};else{const re=I.getThroughputController(),le=T.getCurrentBufferLevel(D),ue=re.getAverageThroughput(D,null,NaN)*w.get().streaming.abr.rules.insufficientBufferRule.parameters.throughputSafetyFactor*le/J;if(isNaN(ue)||ue<=0)return P;P.representation=V.getOptimalRepresentationForBitrate(Z,ue,!0),P.priority=w.get().streaming.abr.rules.insufficientBufferRule.priority,P.reason={message:"[InsufficientBufferRule]: Limiting maximum bitrate to avoid a buffer underrun.",bitrate:ue}}return P},reset:function(){x(),v.off(d.default.PLAYBACK_SEEKING,B,A),v.off(u.default.BYTES_APPENDED_END_FRAGMENT,q,A)}},N=(0,c.default)(p).getInstance().getLogger(A),x(),v.on(d.default.PLAYBACK_SEEKING,B,A),v.on(u.default.BYTES_APPENDED_END_FRAGMENT,q,A),A}m.__dashjs_factory_name="InsufficientBufferRule";var E=n.default.getClassFactory(m);function S(b){const p=(b=b||{}).mediaPlayerModel,v=b.dashMetrics,T=this.context,w=(0,h.default)(T).getInstance();let A,N,C;function x(){C={}}return A={shouldAbandon:function(B){const q=(0,r.default)(T).create();q.rule=this.getClassName();try{if(!B)return q;const I=B.getCurrentRequest();if(!isNaN(I.index)){if(I.firstByteDate===null||C.hasOwnProperty(I.index))return q;const P=p.getBufferTimeDefault(),D=B.getMediaType();if(v.getCurrentBufferLevel(D)>P)return q;const $=Date.now()-I.firstByteDate.getTime();if(I.traces.length>=w.get().streaming.abr.rules.abandonRequestsRule.parameters.minThroughputSamplesThreshold&&$>w.get().streaming.abr.rules.abandonRequestsRule.parameters.minSegmentDownloadTimeThresholdInMs&&I.bytesLoaded<I.bytesTotal)return(function(J,Z,V){const re=J.getMediaInfo(),le=J.getMediaType(),ue=Z.traces.reduce(((ve,te)=>ve+te.b[0]),0)-Z.traces[0].b[0],be=Math.max(Z.traces.reduce(((ve,te)=>ve+te.d),0)-Z.traces[0].d,1),X=Math.round(8*ue/be),G=Number(8*Z.bytesTotal/X/1e3).toFixed(2),U=J.getRepresentation(),F=J.getAbrController();if(G<Z.duration*w.get().streaming.abr.rules.abandonRequestsRule.parameters.abandonDurationMultiplier||F.isPlayingAtLowestQuality(U))return V;if(!C.hasOwnProperty(Z.index)){const ve=J.getAbrController(),te=Z.bytesTotal-Z.bytesLoaded,ke=ve.getOptimalRepresentationForBitrate(re,X,!0),Ee=Z.representation;te>Z.bytesTotal*ke.bitrateInKbit/Ee.bitrateInKbit&&(V.representation=ke,V.priority=w.get().streaming.abr.rules.abandonRequestsRule.priority,V.reason={throughputInKbit:X,message:`[AbandonRequestRule][${le} is asking to abandon and switch to quality to ${ke.absoluteIndex}. The measured bandwidth was ${X} kbit/s`},C[Z.index]=!0)}return V})(B,I,q)}return q}catch(I){return N.error(I),q}},reset:x},N=(0,c.default)(T).getInstance().getLogger(A),x(),A}S.__dashjs_factory_name="AbandonRequestsRule";var _=n.default.getClassFactory(S);function M(){const b=this.context,p=(0,h.default)(b).getInstance();let v;return v={getSwitchRequest:function(T){const w=(0,r.default)(b).create();if(w.rule=this.getClassName(),!T||!T.hasOwnProperty("getDroppedFramesHistory"))return w;const A=T.getDroppedFramesHistory();if(!A)return w;const N=T.getStreamInfo().id,C=T.getMediaInfo(),x=T.getAbrController(),B=A.getFrameHistory(N);if(!B||Object.keys(B).length===0)return w;let q=0,I=0;const P=x.getPossibleVoRepresentationsFilteredBySettings(C,!0);let D=null;for(let $=1;$<P.length;$++){const J=P[$];if(J&&B[J.id]&&(q=B[J.id].droppedVideoFrames,I=B[J.id].totalVideoFrames,I>p.get().streaming.abr.rules.droppedFramesRule.parameters.minimumSampleSize&&q/I>p.get().streaming.abr.rules.droppedFramesRule.parameters.droppedFramesPercentageThreshold)){D=P[$-1];break}}return D&&(w.representation=D,w.priority=p.get().streaming.abr.rules.droppedFramesRule.priority,w.reason={droppedFrames:q,message:`[DroppedFramesRule]: Switching to index ${D.absoluteIndex}. Dropped Frames: ${q}, Total Frames: ${I}`}),w}},v}M.__dashjs_factory_name="DroppedFramesRule";var R=n.default.getClassFactory(M);function W(){const b=this.context,p=(0,h.default)(b).getInstance();let v;return v={getSwitchRequest:function(T){const w=(0,r.default)(b).create();if(w.rule=this.getClassName(),!T)return w;const A=T.getStreamInfo().id,N=T.getMediaType(),C=T?T.getSwitchRequestHistory():null,x=C?C.getSwitchRequests(A,N):{},B=T.getAbrController(),q=T.getMediaInfo(),I=B.getPossibleVoRepresentationsFilteredBySettings(q,!0);let P=0,D=0;for(let $=0;$<I.length;$++){const J=I[$];if(J&&x[J.id]&&(P+=x[J.id].drops,D+=x[J.id].noDrops,P+D>=p.get().streaming.abr.rules.switchHistoryRule.parameters.sampleSize&&P/D>p.get().streaming.abr.rules.switchHistoryRule.parameters.switchPercentageThreshold)){w.representation=$>0&&x[J.id].drops>0?I[$-1]:J,w.priority=p.get().streaming.abr.rules.switchHistoryRule.priority,w.reason={drops:P,noDrops:D,message:`[SwitchHistoryRule]: Switch to index: ${w.representation.absoluteIndex} samples: ${P+D} drops:  ${P}`};break}}return w}},v}W.__dashjs_factory_name="SwitchHistoryRule";var fe=n.default.getClassFactory(W),ye=t(7568);const Y="BOLA_STATE_ONE_BITRATE",j="BOLA_STATE_STARTUP",se="BOLA_STATE_STEADY",Te=10;function Ae(b){b=b||{};const p=this.context,v=b.dashMetrics,T=b.mediaPlayerModel,w=(0,y.default)(p).getInstance(),A=Rn(p).getInstance();let N,C,x,B;function q(F){const ve=F.mediaType,te=F.streamId,ke=ve===l.default.AUDIO?[l.default.AUDIO]:B[te];for(const Ee in ke)B[te]&&B[te].hasOwnProperty(Ee)&&B[te][Ee].state===se&&(B[te][Ee].placeholderBuffer=0)}function I(F){const ve=F.streamId;for(const te in B[ve])if(B[ve].hasOwnProperty(te)){const ke=B[ve][te];ke.state!==Y&&(ke.state=j,P(ke))}}function P(F){F.placeholderBuffer=0,F.mostAdvancedSegmentStart=NaN,F.lastSegmentWasReplacement=!1,F.lastSegmentStart=NaN,F.lastSegmentDurationS=NaN,F.lastSegmentRequestTimeMs=NaN,F.lastSegmentFinishTimeMs=NaN}function D(F){try{if(F&&F.metric===i.HTTP_REQUEST&&F.value&&F.value.type===ye.HTTPRequest.MEDIA_SEGMENT_TYPE&&F.value.trace&&F.value.trace.length){const ve=B[F.value._streamId]&&B[F.value._streamId][F.mediaType]?B[F.value._streamId][F.mediaType]:null;ve&&ve.state!==Y&&(ve.lastSegmentRequestTimeMs=F.value.trequest.getTime(),ve.lastSegmentFinishTimeMs=F.value._tfinish.getTime(),$(ve,F.mediaType))}}catch(ve){C.error(ve)}}function $(F,ve){if(!isNaN(F.lastSegmentStart)&&!isNaN(F.lastSegmentRequestTimeMs)&&!isNaN(F.placeholderBuffer)){if(F.placeholderBuffer*=.99,!isNaN(F.lastSegmentFinishTimeMs)){const te=v.getCurrentBufferLevel(ve)+.001*(F.lastSegmentFinishTimeMs-F.lastSegmentRequestTimeMs),ke=re(F,F.currentRepresentation),Ee=Math.max(0,ke-te);F.placeholderBuffer=Math.min(Ee,F.placeholderBuffer)}F.lastSegmentWasReplacement&&!isNaN(F.lastSegmentDurationS)&&(F.placeholderBuffer+=F.lastSegmentDurationS),F.lastSegmentStart=NaN,F.lastSegmentRequestTimeMs=NaN}}function J(F){if(F&&B[F.streamId]&&B[F.streamId][F.mediaType]){const ve=B[F.streamId][F.mediaType];ve&&ve.state!==Y&&(ve.currentRepresentation=F.newRepresentation)}}function Z(F,ve,te){const ke=te.reduce(((Oe,Le,Q)=>Le>te[Oe]?Q:Oe),0);if(ke===0)return null;const Ee=Math.max(F,Te+2*ve.length),Re=(te[ke]-1)/(Ee/Te-1);return{gp:Re,Vp:Te/Re}}function V(F,ve){const te=T.getBufferTimeDefault();if(F.bufferTimeDefault!==te){const ke=Z(te,F.representations,F.utilities);if(ke.Vp!==F.Vp||ke.gp!==F.gp){const Ee=v.getCurrentBufferLevel(ve);let Re=Ee+F.placeholderBuffer;Re-=Te,Re*=ke.Vp/F.Vp,Re+=Te,F.bufferTimeDefault=te,F.Vp=ke.Vp,F.gp=ke.gp,F.placeholderBuffer=Math.max(0,Re-Ee)}}}function re(F,ve){return F.Vp*(F.utilities[ve.absoluteIndex]+F.gp)}function le(F){if(F&&F.chunk&&F.chunk.representation.mediaInfo&&B[F.streamId]){const ve=B[F.streamId][F.chunk.representation.mediaInfo.type];if(ve&&ve.state!==Y){const te=F.chunk.start;isNaN(ve.mostAdvancedSegmentStart)||te>ve.mostAdvancedSegmentStart?(ve.mostAdvancedSegmentStart=te,ve.lastSegmentWasReplacement=!1):ve.lastSegmentWasReplacement=!0,ve.lastSegmentStart=te,ve.lastSegmentDurationS=F.chunk.duration,ve.currentRepresentation=F.chunk.representation,$(ve,F.chunk.representation.mediaInfo.type)}}}function ue(){U()}function be(){x.get().streaming.abr.limitBitrateByPortal&&U()}function X(F,ve){const te=ve.absoluteIndex,ke=ve.bandwidth,Ee=F.utilities[te];let Re=0;for(let Oe=te-1;Oe>=0;--Oe)if(F.utilities[Oe]<F.utilities[te]){const Le=F.representations[Oe].bandwidth,Q=F.utilities[Oe],ee=F.Vp*(F.gp+(ke*Q-Le*Ee)/(ke-Le));Re=Math.max(Re,ee)}return Re}function G(F){if(F&&B[F.streamId]){const ve=B[F.streamId][F.mediaType];if(ve&&ve.state!==Y){const te=v.getCurrentBufferLevel(F.mediaType);let ke;ke=ve.currentRepresentation.absoluteIndex>0?X(ve,ve.currentRepresentation):Te;const Ee=Math.max(0,ke-te);ve.placeholderBuffer=Math.min(ve.placeholderBuffer,Ee)}}}function U(){B={}}return N={getSwitchRequest:function(F){try{const ve=(0,r.default)(p).create();F.getScheduleController().setTimeToLoadDelay(0),ve.rule=this.getClassName(),ve.reason=ve.reason||{};const te=(function(ke){const Ee=ke.getMediaType(),Re=ke.getStreamInfo().id;B[Re]||(B={},B[Re]={});let Oe=B[Re][Ee];return Oe?Oe.state!==Y&&V(Oe,Ee):(Oe=(function(Le){const Q={},ee=Le.getMediaInfo(),oe=A.getPossibleVoRepresentationsFilteredBySettings(ee,!0);let ae=oe.map((K=>K.bandwidth)).map((K=>Math.log(K)));ae=ae.map((K=>K-ae[0]+1));const ie=T.getBufferTimeDefault(),me=Z(ie,oe,ae);return me?(Q.state=j,Q.representations=oe,Q.utilities=ae,Q.bufferTimeDefault=ie,Q.Vp=me.Vp,Q.gp=me.gp,Q.currentRepresentation=null,P(Q)):Q.state=Y,Q})(ke),B[Re][Ee]=Oe),Oe})(F);switch(ve.reason.state=te.state,te.state){case Y:break;case j:(function(ke,Ee,Re){const Oe=Ee.getMediaType(),Le=Ee.getThroughputController().getSafeAverageThroughput(Oe);if(isNaN(Le))return;const Q=Ee.getMediaInfo(),ee=A.getOptimalRepresentationForBitrate(Q,Le,!0),oe=v.getCurrentBufferLevel(Oe);ke.representation=ee,ke.reason.throughput=Le,Re.placeholderBuffer=Math.max(0,X(Re,ee)-oe),Re.currentRepresentation=ee,!isNaN(Re.lastSegmentDurationS)&&oe>=Re.lastSegmentDurationS&&(Re.state=se)})(ve,F,te);break;case se:(function(ke,Ee,Re){const Oe=Ee.getMediaType(),Le=Ee.getThroughputController(),Q=Ee.getMediaInfo(),ee=Le.getSafeAverageThroughput(Oe),oe=Ee.getScheduleController();(function(ge,_e){const xe=Date.now();if(isNaN(ge.lastSegmentFinishTimeMs)){if(!isNaN(ge.lastCallTimeMs)){const Me=.001*(xe-ge.lastCallTimeMs);ge.placeholderBuffer+=Math.max(0,Me)}}else{const Me=.001*(xe-ge.lastSegmentFinishTimeMs);ge.placeholderBuffer+=Math.max(0,Me)}ge.lastCallTimeMs=xe,ge.lastSegmentStart=NaN,ge.lastSegmentRequestTimeMs=NaN,ge.lastSegmentFinishTimeMs=NaN,V(ge,_e)})(Re,Oe);const ae=v.getCurrentBufferLevel(Oe);let ie=(function(ge,_e){const xe=ge.representations.length;let Me=NaN,Ne=NaN;for(let Ge=0;Ge<xe;++Ge){let Ze=(ge.Vp*(ge.utilities[Ge]-1+ge.gp)-_e)/ge.representations[Ge].bandwidth;(isNaN(Ne)||Ze>=Ne)&&(Ne=Ze,Me=Ge)}return ge.representations[Me]})(Re,ae+Re.placeholderBuffer);const me=A.getOptimalRepresentationForBitrate(Q,ee,!0);ie.absoluteIndex>Re.currentRepresentation.absoluteIndex&&ie.absoluteIndex>me.absoluteIndex&&(ie=me.absoluteIndex>Re.currentRepresentation.absoluteIndex?me:Re.currentRepresentation);let K=Math.max(0,ae+Re.placeholderBuffer-re(Re,ie));K<=Re.placeholderBuffer?(Re.placeholderBuffer-=K,K=0):(K-=Re.placeholderBuffer,Re.placeholderBuffer=0,A.isPlayingAtTopQuality(ie)?K=0:oe.setTimeToLoadDelay(1e3*K)),ke.representation=ie,ke.reason.throughput=ee,ke.reason.bufferLevel=ae,ke.reason.placeholderBuffer=Re.placeholderBuffer,ke.reason.delay=K,Re.currentRepresentation=ie})(ve,F,te);break;default:(function(ke,Ee,Re){C.debug("BOLA ABR rule invoked in bad state.");const Oe=Ee.getMediaInfo(),Le=Ee.getMediaType(),Q=Ee.getThroughputController().getSafeAverageThroughput(Le);ke.representation=A.getOptimalRepresentationForBitrate(Oe,Q,!0),ke.reason.state=Re.state,ke.reason.throughput=Q,Re.state=j,P(Re)})(ve,F,te)}return ve.priority=x.get().streaming.abr.rules.bolaRule.priority,ve}catch(ve){return C.error(ve),(0,r.default)(p).create()}},handleNewMediaInfo:function(F){F&&F.streamInfo&&F.type&&B[F.streamInfo.id]&&B[F.streamInfo.id][F.type]&&delete B[F.streamInfo.id][F.type]},reset:function(){U(),w.off(d.default.BUFFER_EMPTY,q,N),w.off(d.default.PLAYBACK_SEEKING,I,N),w.off(d.default.METRIC_ADDED,D,N),w.off(d.default.QUALITY_CHANGE_REQUESTED,J,N),w.off(d.default.FRAGMENT_LOADING_ABANDONED,G,N),w.off(u.default.MEDIA_FRAGMENT_LOADED,le,N),w.off(u.default.SETTING_UPDATED_MAX_BITRATE,ue,N),w.off(u.default.SETTING_UPDATED_MIN_BITRATE,ue,N),w.off(u.default.VIDEO_ELEMENT_RESIZED,be,N)}},C=(0,c.default)(p).getInstance().getLogger(N),x=(0,h.default)(p).getInstance(),U(),w.on(d.default.BUFFER_EMPTY,q,N),w.on(d.default.PLAYBACK_SEEKING,I,N),w.on(d.default.METRIC_ADDED,D,N),w.on(d.default.QUALITY_CHANGE_REQUESTED,J,N),w.on(d.default.FRAGMENT_LOADING_ABANDONED,G,N),w.on(u.default.MEDIA_FRAGMENT_LOADED,le,N),w.on(u.default.SETTING_UPDATED_MAX_BITRATE,ue,N),w.on(u.default.SETTING_UPDATED_MIN_BITRATE,ue,N),w.on(u.default.VIDEO_ELEMENT_RESIZED,be,N),N}Ae.__dashjs_factory_name="BolaRule";var ze=n.default.getClassFactory(Ae);const de="L2A_STATE_ONE_BITRATE",we="L2A_STATE_STARTUP",ce="L2A_STATE_STEADY",he=Math.pow(4,.99);function Pe(b){b=b||{};const p=this.context,v=b.dashMetrics,T=(0,y.default)(p).getInstance(),w=(0,h.default)(p).getInstance();let A,N,C,x;function B(Z){Z.placeholderBuffer=0,Z.mostAdvancedSegmentStart=NaN,Z.lastSegmentWasReplacement=!1,Z.lastSegmentStart=NaN,Z.lastSegmentDurationS=NaN,Z.lastSegmentRequestTimeMs=NaN,Z.lastSegmentFinishTimeMs=NaN,Z.lastSegmentUrl=""}function q(){for(const Z in N)if(N.hasOwnProperty(Z)){const V=N[Z];V.state!==de&&(V.state=we,B(V))}}function I(Z){if(Z&&Z.chunk&&Z.chunk.representation&&Z.chunk.representation.mediaInfo){const V=N[Z.chunk.representation.mediaInfo.type],re=C[Z.chunk.representation.mediaInfo.type];if(V&&V.state!==de){const le=Z.chunk.start;isNaN(V.mostAdvancedSegmentStart)||le>V.mostAdvancedSegmentStart?(V.mostAdvancedSegmentStart=le,V.lastSegmentWasReplacement=!1):V.lastSegmentWasReplacement=!0,V.lastSegmentStart=le,V.lastSegmentDurationS=Z.chunk.duration,V.currentRepresentation=Z.chunk.representation,D(V,re)}}}function P(Z){if(Z&&Z.metric===i.HTTP_REQUEST&&Z.value&&Z.value.type===ye.HTTPRequest.MEDIA_SEGMENT_TYPE&&Z.value.trace&&Z.value.trace.length){const V=N[Z.mediaType],re=C[Z.mediaType];V&&V.state!==de&&(V.lastSegmentRequestTimeMs=Z.value.trequest.getTime(),V.lastSegmentFinishTimeMs=Z.value._tfinish.getTime(),D(V,re))}}function D(Z,V){isNaN(Z.lastSegmentStart)||isNaN(Z.lastSegmentRequestTimeMs)||(V.segment_request_start_s=.001*Z.lastSegmentRequestTimeMs,V.segment_download_finish_s=.001*Z.lastSegmentFinishTimeMs,Z.lastSegmentStart=NaN,Z.lastSegmentRequestTimeMs=NaN)}function $(Z,V){if(Z.length!==V.length)return-1;let re=0;for(let le=0;le<Z.length;le++)re+=Z[le]*V[le];return re}function J(){N={},C={}}return A={getSwitchRequest:function(Z){try{const V=(0,r.default)(p).create();V.rule=this.getClassName();const re=Z.getMediaType(),le=Z.getScheduleController();if(V.reason=V.reason||{},re===l.default.AUDIO)return V;le.setTimeToLoadDelay(0);const ue=(function(be){const X=be.getMediaType();let G=N[X];return G||(G=(function(U){const F={},ve=U.getMediaInfo();return F.state=we,F.currentRepresentation=null,(function(te){te&&te.type&&(C[te.type]={},C[te.type].w=[],C[te.type].prev_w=[],C[te.type].Q=0,C[te.type].segment_request_start_s=0,C[te.type].segment_download_finish_s=0,C[te.type].B_target=1.5)})(ve),B(F),F})(be),N[X]=G),G})(Z);if(!C[re])return V;switch(V.reason.state=ue.state,ue.state){case de:break;case we:(function(be,X,G){const U=be.getMediaInfo(),F=be.getMediaType(),ve=be.getThroughputController().getSafeAverageThroughput(F);if(isNaN(ve))return X;const te=be.getAbrController(),ke=te.getOptimalRepresentationForBitrate(U,ve,!0),Ee=v.getCurrentBufferLevel(F,!0),Re=C[F],Oe=te.getPossibleVoRepresentationsFilteredBySettings(U,!0);if(X.representation=ke,X.reason.throughput=ve,G.currentRepresentation=ke,!isNaN(G.lastSegmentDurationS)&&Ee>=Re.B_target){G.state=ce,Re.Q=he;for(let Le=0;Le<Oe.length;++Le)Oe[Le].id===G.currentRepresentation.id?Re.prev_w[Le]=1:Re.prev_w[Le]=0}})(Z,V,ue);break;case ce:(function(be,X,G){let U=[];const F=be.getThroughputController(),ve=be.getMediaType();let te=F.getAverageThroughput(ve,l.default.THROUGHPUT_CALCULATION_MODES.ARITHMETIC_MEAN,1),ke=v.getCurrentHttpRequest(ve),Ee=null;const Re=C[ve];if(te<1&&(te=1),ke.url===G.lastSegmentUrl||ke.type===ye.HTTPRequest.INIT_SEGMENT_TYPE)Ee=G.currentRepresentation;else{let Oe=G.lastSegmentDurationS,Le=1;const Q=be.getAbrController(),ee=be.getMediaInfo(),oe=Q.getPossibleVoRepresentationsFilteredBySettings(ee,!0);let ae=be.getVideoModel().getPlaybackRate();const ie=Math.max(Math.pow(4,1),he*Math.sqrt(4));for(let _e=0;_e<oe.length;++_e){const xe=oe[_e];ae*xe.bitrateInKbit>te&&(Le=-1),Re.w[_e]=Re.prev_w[_e]+Le*(Oe/(2*ie))*((Re.Q+he)*(ae*xe.bitrateInKbit/te))}Re.w=(function(_e){const xe=_e.length;let Me=!1,Ne=[];for(let Wt=0;Wt<xe;++Wt)Ne[Wt]=_e[Wt];let Ge=_e.sort((function(Wt,At){return At-Wt})),Ze=0,ht=0,wt=[];for(let Wt=0;Wt<xe-1;++Wt)if(Ze+=Ge[Wt],ht=(Ze-1)/(Wt+1),ht>=Ge[Wt+1]){Me=!0;break}Me||(ht=(Ze+Ge[xe-1]-1)/xe);for(let Wt=0;Wt<xe;++Wt)wt[Wt]=Math.max(Ne[Wt]-ht,0);return wt})(Re.w);for(let _e=0;_e<oe.length;++_e)U[_e]=Re.w[_e]-Re.prev_w[_e],Re.prev_w[_e]=Re.w[_e];const me=oe.map((_e=>_e.bandwidth));Re.Q=Math.max(0,Re.Q-Oe+Oe*ae*(($(me,Re.prev_w)+$(me,U))/te));let K=[];for(let _e=0;_e<me.length;++_e)K[_e]=Math.abs(me[_e]-$(Re.w,me));const ge=K.indexOf(Math.min(...K));Ee=Q.getRepresentationByAbsoluteIndex(ge,ee,!0),Ee.absoluteIndex>G.currentRepresentation.absoluteIndex&&me[G.currentRepresentation.absoluteIndex+1]<=te&&(Ee=Q.getRepresentationByAbsoluteIndex(G.currentRepresentation.absoluteIndex+1,ee,!0)),Ee.bitrateInKbit>=te&&(Re.Q=2*Math.max(he,Re.Q)),G.lastSegmentUrl=ke.url}X.representation=Ee,G.currentRepresentation=X.representation})(Z,V,ue);break;default:(function(be,X,G){const U=be.getAbrController(),F=be.getMediaInfo(),ve=be.getMediaType(),te=be.getThroughputController().getSafeAverageThroughput(ve);X.representation=U.getOptimalRepresentationForBitrate(F,te,!0),X.reason.throughput=te,G.state=we,B(G)})(Z,V,ue)}return V.priority=w.get().streaming.abr.rules.l2ARule.priority,V}catch(V){return x.error(V),(0,r.default)(p).create()}},reset:function(){J(),T.off(u.default.PLAYBACK_SEEKING,q,A),T.off(u.default.MEDIA_FRAGMENT_LOADED,I,A),T.off(u.default.METRIC_ADDED,P,A)}},x=(0,c.default)(p).getInstance().getLogger(A),J(),T.on(u.default.PLAYBACK_SEEKING,q,A),T.on(u.default.MEDIA_FRAGMENT_LOADED,I,A),T.on(u.default.METRIC_ADDED,P,A),A}Pe.__dashjs_factory_name="L2ARule";var $e=n.default.getClassFactory(Pe);function He(){const b=this.context;let p,v,T,w,A,N,C,x,B;function q(){T=null,w=1,A=100,N=0,C=null,x=null,B="dynamic_weight_selection"}function I(){let Z=0;if(T)for(let V=0;V<T.length;V++){let re=T[V];re.state.throughput>Z&&(Z=re.state.throughput)}return Z}function P(Z,V,re){let le=Z.map(((ue,be)=>re[be]*Math.pow(ue-V[be],2))).reduce(((ue,be)=>ue+be));return(le<0?-1:1)*Math.sqrt(Math.abs(le))}function D(Z,V){return P([Z.state.throughput,Z.state.latency,Z.state.rebuffer,Z.state.switch],[V.state.throughput,V.state.latency,V.state.rebuffer,V.state.switch],[1,1,1,1])}function $(Z,V){for(let re=0;re<T.length;re++){let le=T[re],ue=.1;const be=D(le,Z);J(le,V,Math.exp(-1*Math.pow(be,2)/(2*Math.pow(ue,2))))}}function J(Z,V,re){let le=Z.state,ue=[.01,.01,.01,.01];le.throughput=le.throughput+(V[0]-le.throughput)*ue[0]*re,le.latency=le.latency+(V[1]-le.latency)*ue[1]*re,le.rebuffer=le.rebuffer+(V[2]-le.rebuffer)*ue[2]*re,le.switch=le.switch+(V[3]-le.switch)*ue[3]*re}return p={getNextQuality:function(Z,V,re,le,ue,be,X,G){let U=le,F=re;(function(ee,oe){if(!T){T=[];const ae=oe.getPossibleVoRepresentationsFilteredBySettings(ee,!0),ie=ae.map((me=>me.bandwidth));N=Math.min(...ie),w=(function(me){const K=me.map((ge=>Math.pow(ge,2))).reduce(((ge,_e)=>ge+_e));return Math.sqrt(K)})(ie),ae.forEach((me=>{let K={representation:me,state:{throughput:me.bandwidth/w,latency:0,rebuffer:0,switch:0}};T.push(K)})),x=(function(me){let K=[],ge=(function(Ge){let Ze=[];for(let ht=0;ht<Ge;ht++){let wt=[Math.random()*I(),Math.random(),Math.random(),Math.random()];Ze.push(wt)}return Ze})(Math.pow(me.length,2));K.push(ge[0]);let _e=[1,1,1,1];for(let Ge=1;Ge<me.length;Ge++){let Ze=null,ht=null;for(let wt=0;wt<ge.length;wt++){let Wt=ge[wt],At=null;for(let Vt=0;Vt<K.length;Vt++){let on=P(Wt,K[Vt],_e);(At===null||on<At)&&(At=on)}(ht===null||At>ht)&&(Ze=Wt,ht=At)}K.push(Ze)}let xe=null,Me=null;for(let Ge=0;Ge<K.length;Ge++){let Ze=0;for(let ht=0;ht<K.length;ht++)Ge!==ht&&(Ze+=P(K[Ge],K[ht],_e));(xe===null||Ze>xe)&&(xe=Ze,Me=Ge)}let Ne=[];for(Ne.push(K[Me]),K.splice(Me,1);K.length>0;){let Ge=null,Ze=null;for(let ht=0;ht<K.length;ht++){let wt=P(Ne[0],K[ht],_e);(Ge===null||wt<Ge)&&(Ge=wt,Ze=ht)}Ne.push(K[Ze]),K.splice(Ze,1)}return Ne})(T)}})(V,Z);let ve=re/w;ve>1&&(ve=I()),le/=A;let te=T.find((ee=>ee.representation.id===X.id)),ke=te.representation.bandwidth*G.getSegmentDuration()/F,Ee=Math.max(0,ke-ue);if(ue-ke<G.getMinBuffer())return v.debug(`Buffer is low for bitrate= ${te.representation.bandwidth} downloadTime=${ke} currentBuffer=${ue} rebuffer=${Ee}`),(function(ee,oe){let ae=0,ie=ee;if(T)for(let me=0;me<T.length;me++){let K=T[me];K.representation.bandwidth<ee.representation.bandwidth&&K.representation.bandwidth>ae&&oe>K.representation.bandwidth&&(ae=K.representation.bandwidth,ie=K)}return ie})(te,F).representation;switch(B){case"manual_weight_selection":C=[.4,.4,.4,.4];break;case"random_weight_selection":C=(function(ee){let oe=[],ae=Math.sqrt(2/ee);for(let ie=0;ie<4;ie++)oe.push(Math.random()*ae);return C=oe,C})(T.length);break;default:(function(ee,oe,ae,ie,me,K){C||(C=x[x.length-1]);let ge=ee.findWeightVector(T,oe,ae,ie,me,K);ge!==null&&ge!==-1&&(C=ge)})(G,U,ue,Ee,F,be)}let Re=null,Oe=null,Le=null;for(let ee=0;ee<T.length;ee++){let oe=T[ee],ae=oe.state,ie=[ae.throughput,ae.latency,ae.rebuffer,ae.switch],me=C.slice(),K=G.getNextBufferWithBitrate(oe.representation.bandwidth,ue,F),ge=K<G.getMinBuffer();ge&&v.debug(`Buffer is low for bitrate=${oe.representation.bandwidth} downloadTime=${ke} currentBuffer=${ue} nextBuffer=${K}`),(oe.representation.bandwidth>re-1e4||ge)&&oe.representation.bandwidth!==N&&(me[0]=100);let _e=P(ie,[ve,0,0,0],me);(Re===null||_e<Re)&&(Re=_e,Oe=oe.representation,Le=oe)}let Q=Math.abs(te.representation.bandwidth-Le.representation.bandwidth)/w;return $(te,[ve,le,Ee,Q]),$(Le,[ve,0,0,Q]),Oe},reset:function(){q()}},v=(0,c.default)(b).getInstance().getLogger(p),q(),p}He.__dashjs_factory_name="LearningAbrController";var et=n.default.getClassFactory(He),Ve=class{constructor(){this.type=null,this.lastBitrate=null,this.weights={},this.weights.bitrateReward=null,this.weights.bitrateSwitchPenalty=null,this.weights.rebufferPenalty=null,this.weights.latencyPenalty=null,this.weights.playbackSpeedPenalty=null,this.bitrateWSum=0,this.bitrateSwitchWSum=0,this.rebufferWSum=0,this.latencyWSum=0,this.playbackSpeedWSum=0,this.totalQoe=0}};function Et(){let b,p,v,T,w;function A(){p=null,v=null,T=null,w=null}function N(x,B,q,I){let P=new Ve;return P.type=x,P.weights.bitrateReward=B||1,P.weights.bitrateSwitchPenalty=1,P.weights.rebufferPenalty=q||1e3,P.weights.latencyPenalty=[],P.weights.latencyPenalty.push({threshold:1.1,penalty:.05*I}),P.weights.latencyPenalty.push({threshold:1e8,penalty:.1*q}),P.weights.playbackSpeedPenalty=I||200,P}function C(x,B,q,I,P){P.bitrateWSum+=P.weights.bitrateReward*x,P.lastBitrate&&(P.bitrateSwitchWSum+=P.weights.bitrateSwitchPenalty*Math.abs(x-P.lastBitrate)),P.lastBitrate=x,P.rebufferWSum+=P.weights.rebufferPenalty*B;for(let D=0;D<P.weights.latencyPenalty.length;D++){let $=P.weights.latencyPenalty[D];if(q<=$.threshold){P.latencyWSum+=$.penalty*q;break}}P.playbackSpeedWSum+=P.weights.playbackSpeedPenalty*Math.abs(1-I),P.totalQoe=P.bitrateWSum-P.bitrateSwitchWSum-P.rebufferWSum-P.latencyWSum-P.playbackSpeedWSum}return b={setupPerSegmentQoe:function(x,B,q){p=N("segment",x,B,q),v=x,T=B,w=q},logSegmentMetrics:function(x,B,q,I){p&&C(x,B,q,I,p)},getPerSegmentQoe:function(){return p},calculateSingleUseQoe:function(x,B,q,I){let P=null;return v&&T&&w&&(P=N("segment",v,T,w)),P?(C(x,B,q,I,P),P.totalQoe):0},reset:function(){A()}},A(),b}Et.__dashjs_factory_name="LoLpQoeEvaluator";var Nt=n.default.getClassFactory(Et);function $t(b){let p,v,T,w,A=b.targetLatency,N=b.bufferMin,C=b.segmentDuration,x=b.qoeEvaluator;function B(){return C}function q(I,P){const D=B();let $;return $=P>D?I-D:I+D-P,$}return p={getMinBuffer:function(){return N},getSegmentDuration:B,getNextBufferWithBitrate:function(I,P,D){return q(P,I*C/D)},getNextBuffer:q,findWeightVector:function(I,P,D,$,J,Z){let V=null,re=null,le=null,ue=Math.abs(P-w);return I.forEach((be=>{T.forEach((X=>{X[0];let G,U=X[1],F=X[2],ve=(X[3],be.representation.bandwidth*C/J),te=q(D,ve);G=F===0?10:1/F;let ke=G*Math.max(1e-5,ve-te);G=U===0?10:1/U;let Ee=G*be.state.latency,Re=x.calculateSingleUseQoe(be.representation.bandwidth,ke,Ee,Z);(V===null||Re>V)&&(function(Oe,Le,Q){return!(Oe>A+Q)&&Le>=N})(P,te,ue)&&(V=Re,re=X,le=be.representation.bandwidth)}))})),re===null&&le===null&&(re=-1),w=P,re}},v=[.2,.4,.6,.8,1],T=(function(I){let P=I.map((function($){return[$]})),D=function($,J,Z){if(Z===J)return $;let V=$.length;for(let re=0;re<V;re++){let le=$.shift();for(let ue=0;ue<I.length;ue++)$.push(le.concat(I[ue]))}return D($,J,Z+1)};return D(P,4,1)})(v),w=0,p}$t.__dashjs_factory_name="LoLpWeightSelector";var Ie=n.default.getClassFactory($t);function pe(b){let p,v,T,w,A,N=(b=b||{}).dashMetrics,C=this.context;return T={getSwitchRequest:function(x){try{let B=(0,r.default)(C).create();B.rule=this.getClassName();let q=x.getMediaInfo().type,I=x.getAbrController();const P=x.getStreamInfo();let D=x.getRepresentation();const $=x.getMediaInfo(),J=N.getCurrentBufferState(q),Z=x.getScheduleController(),V=N.getCurrentBufferLevel(q,!0),re=Z.getPlaybackController();let le=re.getCurrentLiveLatency();if(q===l.default.AUDIO)return B;le||(le=0);const ue=re.getPlaybackRate(),be=x.getThroughputController().getSafeAverageThroughput(q);if(p.debug(`Throughput ${Math.round(be)} kbps`),isNaN(be)||!J||I.getAbandonmentStateFor(P.id,q)===i.ABANDON_LOAD)return B;let X=I.getPossibleVoRepresentationsFilteredBySettings($,!0).map((Oe=>Oe.bandwidth)),G=x.getRepresentation().fragmentDuration,U=Math.min(...X)/1e3,F=Math.max(...X)/1e3,ve=D.bandwidth/1e3,te=N.getCurrentHttpRequest(q,!0),ke=(te.tresponse.getTime()-te.trequest.getTime())/1e3,Ee=ke>G?ke-G:0;A.setupPerSegmentQoe(G,F,U),A.logSegmentMetrics(ve,Ee,le,ue);let Re=Ie(C).create({targetLatency:1.5,bufferMin:.3,segmentDuration:G,qoeEvaluator:A});return B.representation=w.getNextQuality(I,$,1e3*be,le,V,ue,D,Re),B.reason={throughput:be,latency:le},B.priority=v.get().streaming.abr.rules.loLPRule.priority,Z.setTimeToLoadDelay(0),B}catch(B){throw B}},reset:function(){w.reset(),A.reset()}},p=(0,c.default)(C).getInstance().getLogger(T),w=et(C).create(),A=Nt(C).create(),v=(0,h.default)(C).getInstance(),T}pe.__dashjs_factory_name="LoLPRule";var Be=n.default.getClassFactory(pe);function O(b){b=b||{};const p=this.context,v=b.mediaPlayerModel,T=b.customParametersModel,w=b.dashMetrics,A=b.settings,N=(0,y.default)(p).getInstance();let C,x,B,q;function I(){Object.values(l.default.QUALITY_SWITCH_RULES).forEach((Z=>{x=P(Z,x)})),Object.values(l.default.ABANDON_FRAGMENT_RULES).forEach((Z=>{B=P(Z,B)})),T.getAbrCustomRules().forEach((function(Z){Z.type===l.default.RULES_TYPES.QUALITY_SWITCH_RULES&&x.push(Z.rule(p).create()),Z.type===l.default.RULES_TYPES.ABANDON_FRAGMENT_RULES&&B.push(Z.rule(p).create())})),x.length===0&&(x.push(ze(p).create({dashMetrics:w,mediaPlayerModel:v,settings:A})),x.push(g(p).create({dashMetrics:w})))}function P(Z,V){const re=Z.charAt(0).toLowerCase()+Z.slice(1);return A.get().streaming.abr.rules[re].active&&!(function(le,ue){return le.filter((be=>be.getClassName()===ue)).length>0})(V,Z)?(V.push((function(le){switch(le){case l.default.QUALITY_SWITCH_RULES.BOLA_RULE:return ze(p).create({dashMetrics:w,mediaPlayerModel:v,settings:A});case l.default.QUALITY_SWITCH_RULES.THROUGHPUT_RULE:return g(p).create({dashMetrics:w});case l.default.QUALITY_SWITCH_RULES.INSUFFICIENT_BUFFER_RULE:return E(p).create({dashMetrics:w,settings:A});case l.default.QUALITY_SWITCH_RULES.SWITCH_HISTORY_RULE:return fe(p).create();case l.default.QUALITY_SWITCH_RULES.DROPPED_FRAMES_RULE:return R(p).create();case l.default.QUALITY_SWITCH_RULES.LEARN_TO_ADAPT_RULE:return $e(p).create({dashMetrics:w,settings:A});case l.default.QUALITY_SWITCH_RULES.LOL_PLUS_RULE:return Be(p).create({dashMetrics:w});case l.default.ABANDON_FRAGMENT_RULES.ABANDON_REQUEST_RULE:return _(p).create({dashMetrics:w,mediaPlayerModel:v,settings:A})}})(Z)),V):A.get().streaming.abr.rules[re].active?V:(function(le,ue){return le.filter((be=>be.getClassName()!==ue))})(V,Z)}function D(Z){return Z.filter((V=>V.representation!==r.default.NO_CHANGE))}function $(Z){const V={};let re,le,ue,be=null;if(Z.length!==0){for(V[r.default.PRIORITY.STRONG]=null,V[r.default.PRIORITY.WEAK]=null,V[r.default.PRIORITY.DEFAULT]=null,re=0,le=Z.length;re<le;re+=1)ue=Z[re],ue.representation!==r.default.NO_CHANGE&&(V[ue.priority]===null||V[ue.priority].representation!==r.default.NO_CHANGE&&ue.representation.bitrateInKbit<V[ue.priority].representation.bitrateInKbit)&&(V[ue.priority]=ue);return V[r.default.PRIORITY.WEAK]&&V[r.default.PRIORITY.WEAK].representation!==r.default.NO_CHANGE&&(be=V[r.default.PRIORITY.WEAK]),V[r.default.PRIORITY.DEFAULT]&&V[r.default.PRIORITY.DEFAULT].representation!==r.default.NO_CHANGE&&(be=V[r.default.PRIORITY.DEFAULT]),V[r.default.PRIORITY.STRONG]&&V[r.default.PRIORITY.STRONG].representation!==r.default.NO_CHANGE&&(be=V[r.default.PRIORITY.STRONG]),be}}function J(){I()}return C={clearDataForStream:function(Z){[x,B].forEach((V=>{V&&V.length&&V.forEach((re=>re.clearDataForStream&&typeof re.clearDataForStream=="function"&&re.clearDataForStream(Z)))}))},getAbandonFragmentRules:function(){return B},getBestPossibleSwitchRequest:function(Z){return Z&&$(D(x.filter((V=>{const re=V.getClassName();if(re!==l.default.QUALITY_SWITCH_RULES.BOLA_RULE&&re!==l.default.QUALITY_SWITCH_RULES.THROUGHPUT_RULE)return!0;const le=Z.getMediaType();return q[le]&&re===l.default.QUALITY_SWITCH_RULES.BOLA_RULE||!q[le]&&re===l.default.QUALITY_SWITCH_RULES.THROUGHPUT_RULE})).map((V=>V.getSwitchRequest(Z)))))||(0,r.default)(p).create()},getBolaState:function(Z){return q[Z]},getMinSwitchRequest:$,getQualitySwitchRules:function(){return x},handleNewMediaInfo:function(Z){x.forEach((V=>V.handleNewMediaInfo&&V.handleNewMediaInfo(Z))),B.forEach((V=>V.handleNewMediaInfo&&V.handleNewMediaInfo(Z)))},initialize:function(){x=[],B=[],q={},I(),N.on(u.default.SETTING_UPDATED_ABR_ACTIVE_RULES,J,C)},reset:function(){[x,B].forEach((Z=>{Z&&Z.length&&Z.forEach((V=>V.reset&&V.reset()))})),x=[],B=[],q={},N.off(u.default.SETTING_UPDATED_ABR_ACTIVE_RULES,J,C)},setBolaState:function(Z,V){q[Z]=V},shouldAbandonFragment:function(Z){if(!Z)return(0,r.default)(p).create();const V=$(D(B.map((re=>re.shouldAbandon(Z)))));return V&&V.reason&&(V.reason.forceAbandon=!0),V||(0,r.default)(p).create()}},C}O.__dashjs_factory_name="ABRRulesCollection";const z=n.default.getClassFactory(O);n.default.updateSingletonFactory(O.__dashjs_factory_name,z);var k=z;class L{constructor(p){this.action=L.ACTION_DOWNLOAD,this.availabilityEndTime=null,this.availabilityStartTime=null,this.bandwidth=NaN,this.bytesLoaded=NaN,this.bytesTotal=NaN,this.delayLoadingTime=NaN,this.duration=NaN,this.endDate=null,this.firstByteDate=null,this.index=NaN,this.isPartialSegmentRequest=!1,this.mediaStartTime=NaN,this.mediaType=null,this.presentationStartTime=NaN,this.range=null,this.representation=null,this.responseType="arraybuffer",this.retryAttempts=0,this.serviceLocation=null,this.startDate=null,this.startTime=NaN,this.timescale=NaN,this.type=null,this.url=p||null,this.wallStartTime=null}isInitializationRequest(){return this.type&&this.type===ye.HTTPRequest.INIT_SEGMENT_TYPE}setInfo(p){this.type=p&&p.init?ye.HTTPRequest.INIT_SEGMENT_TYPE:ye.HTTPRequest.MEDIA_SEGMENT_TYPE,this.url=p&&p.url?p.url:null,this.range=p&&p.range?p.range.start+"-"+p.range.end:null,this.mediaType=p&&p.mediaType?p.mediaType:null,this.representation=p&&p.representation?p.representation:null}}L.ACTION_DOWNLOAD="download",L.ACTION_COMPLETE="complete";var ne=L;const H="loading",De="executed",Ye="failed";function qe(b){const p=(b=b||{}).eventBus,v=b.events,T=b.dashMetrics,w=b.fragmentLoader,A=b.debug,N=b.streamInfo,C=b.type;let x,B,q,I;function P(X){return!!X&&(function(G){let U=!1;return G.some((F=>{if(ve=X,te=F,!isNaN(ve.index)&&ve.startTime===te.startTime&&ve.adaptationIndex===te.adaptationIndex&&ve.type===te.type||(function(ke,Ee){return ke.representation.id===Ee.representation.id})(X,F)||(function(ke,Ee){return ke.action===ne.ACTION_COMPLETE&&ke.action===Ee.action})(X,F))return U=!0,U;var ve,te})),U})(q)}function D(X){return isNaN(X.duration)?.25:Math.min(X.duration/8,.5)}function $(X){q=q.filter((G=>{const U=D(G);return isNaN(G.startTime)||X!==void 0&&G.startTime>=X-U}))}function J(X,G){G<=X+.5||(q=q.filter((U=>{const F=D(U);return isNaN(U.startTime)||U.startTime>=G-F||isNaN(U.duration)||U.startTime+U.duration<=X+F})))}function Z(X,G,U){for(let F=X.length-1;F>=0;F--){const ve=X[F],te=ve.startTime,ke=te+ve.duration;if(U=isNaN(U)?D(ve):U,!isNaN(te)&&!isNaN(ke)&&G+U>=te&&G-U<ke||isNaN(te)&&isNaN(G))return ve}return null}function V(X,G){T.addSchedulingInfo(X,G),T.addRequestsQueue(X.mediaType,I,q)}function re(X){X.sender===w&&(I.splice(I.indexOf(X.request),1),X.response&&!X.error&&q.push(X.request),V(X.request,X.error?Ye:De),p.trigger(v.FRAGMENT_LOADING_COMPLETED,{request:X.request,response:X.response,error:X.error,sender:this},{streamId:N.id,mediaType:C}))}function le(X){X.sender===w&&p.trigger(v.FRAGMENT_LOADING_PROGRESS,{request:X.request,response:X.response,error:X.error,sender:this},{streamId:N.id,mediaType:C})}function ue(X){X.sender===w&&p.trigger(v.FRAGMENT_LOADING_ABANDONED,{request:X.request},{streamId:N.id,mediaType:C})}function be(){q=[],I=[],w&&w.resetInitialSettings()}return x={abortRequests:function(){B.debug("abort requests"),w.abort(),I=[]},executeRequest:function(X){X.action===ne.ACTION_DOWNLOAD?(V(X,H),I.push(X),(function(G){p.trigger(v.FRAGMENT_LOADING_STARTED,{request:G},{streamId:N.id,mediaType:C}),w.load(G)})(X)):B.warn("Unknown request action.")},getRequests:function(X){const G=X?X.state instanceof Array?X.state:[X.state]:[];let U=[];return G.forEach((F=>{const ve=(function(te){let ke;switch(te){case H:ke=I;break;case De:ke=q;break;default:ke=[]}return ke})(F);U=U.concat((function(te,ke){return ke.hasOwnProperty("time")?[Z(te,ke.time,ke.threshold)]:te.filter((Ee=>{for(const Re in ke)if(Re!=="state"&&ke.hasOwnProperty(Re)&&Ee[Re]!=ke[Re])return!1;return!0}))})(ve,X))})),U},getStreamId:function(){return N.id},getType:function(){return C},isFragmentLoaded:P,isFragmentLoadedOrPending:function(X){let G,U=!1,F=0;if(U=P(X),!U)for(F=0;F<I.length;F++)G=I[F],X.url===G.url&&X.startTime===G.startTime&&(U=!0);return U},removeExecutedRequestsAfterTime:function(X){q=q.filter((G=>isNaN(G.startTime)||X!==void 0&&G.startTime<X))},removeExecutedRequestsBeforeTime:$,reset:function(){p.off(v.LOADING_COMPLETED,re,this),p.off(v.LOADING_DATA_PROGRESS,le,this),p.off(v.LOADING_ABANDONED,ue,this),w&&w.reset(),be()},resetInitialSettings:be,syncExecutedRequestsWithBufferedRange:function(X,G){if(!X||X.length===0)return void $();let U=0;for(let F=0,ve=X.length;F<ve;F++)J(U,X.start(F)),U=X.end(F);G>0&&J(U,G)}},B=A.getLogger(x),be(),p.on(v.LOADING_COMPLETED,re,x),p.on(v.LOADING_DATA_PROGRESS,le,x),p.on(v.LOADING_ABANDONED,ue,x),x}qe.__dashjs_factory_name="FragmentModel";const Fe=n.default.getClassFactory(qe);Fe.FRAGMENT_MODEL_LOADING=H,Fe.FRAGMENT_MODEL_EXECUTED=De,Fe.FRAGMENT_MODEL_CANCELED="canceled",Fe.FRAGMENT_MODEL_FAILED=Ye,n.default.updateClassFactory(qe.__dashjs_factory_name,Fe);var Ue=Fe;function Ke(b){let p;const v=(b=b||{}).abrController,T=b.throughputController,w=b.switchRequestHistory,A=b.droppedFramesHistory,N=b.currentRequest,C=b.streamProcessor?b.streamProcessor.getScheduleController():null,x=b.streamProcessor?b.streamProcessor.getRepresentation():null,B=b.videoModel?b.videoModel:null;function q(){return x?x.mediaInfo:null}return p={getAbrController:function(){return v},getCurrentRequest:function(){return N},getDroppedFramesHistory:function(){return A},getMediaInfo:q,getMediaType:function(){const I=q();return I?I.type:null},getRepresentation:function(){return x},getScheduleController:function(){return C},getStreamInfo:function(){const I=q();return I?I.streamInfo:null},getSwitchRequestHistory:function(){return w},getThroughputController:function(){return T},getVideoModel:function(){return B}},p}Ke.__dashjs_factory_name="RulesContext";var tt=n.default.getClassFactory(Ke);function nt(){let b={},p={};const v=this.context,T=(0,h.default)(v).getInstance();return{clearForStream:function(w){delete b[w],delete p[w]},getSwitchRequests:function(w,A){return w!=null&&A!=null&&b[w]&&b[w][A]?b[w][A]:{}},push:function(w){const A=w.currentRepresentation,N=w.newRepresentation;if(A.mediaInfo.streamInfo.id!==N.mediaInfo.streamInfo.id||N.mediaInfo.id!==A.mediaInfo.id)return;const C=A.mediaInfo.streamInfo.id;b[C]||(function(J){b[J]={},p[J]={}})(C);const x=A.mediaInfo.type;b[C][x]||(function(J,Z){b[J][Z]={},p[J][Z]=[]})(C,x);const B=w.currentRepresentation.id;b[C][x][B]||(function(J,Z,V){b[J][Z][V]={noDrops:0,drops:0,dropSize:0}})(C,x,B);let q=w.newRepresentation.absoluteIndex-w.currentRepresentation.absoluteIndex,I=q<0?1:0,P=I?-q:0,D=I?0:1;b[C][x][w.currentRepresentation.id].drops+=I,b[C][x][w.currentRepresentation.id].dropSize+=P,b[C][x][w.currentRepresentation.id].noDrops+=D,p[C][x].push({id:w.currentRepresentation.id,noDrop:D,drop:I,dropSize:P});const $=(function(J,Z){return p[J][Z].length>T.get().streaming.abr.rules.switchHistoryRule.parameters.sampleSize?p[J][Z].shift():null})(C,x);$&&(function(J,Z,V){b[J][Z][V.id].drops-=V.drop,b[J][Z][V.id].dropSize-=V.dropSize,b[J][Z][V.id].noDrops-=V.noDrop})(C,x,$)},reset:function(){b={},p={}}}}nt.__dashjs_factory_name="SwitchRequestHistory";var dt=n.default.getClassFactory(nt);function Gt(){let b={},p={},v={};return{clearForStream:function(T){delete b[T],delete p[T],delete v[T]},getFrameHistory:function(T){return b[T]},push:function(T,w,A){if(!w)return;b[T]||(function(I){b[I]=[],p[I]=0,v[I]=0})(T);let N=A&&A.droppedVideoFrames?A.droppedVideoFrames:0,C=A&&A.totalVideoFrames?A.totalVideoFrames:0,x=N-p[T];p[T]=N;let B=C-v[T];v[T]=C;const q=b[T];q[w]?(q[w].droppedVideoFrames+=x,q[w].totalVideoFrames+=B):q[w]={droppedVideoFrames:x,totalVideoFrames:B}},reset:function(){b={},p={},v={}}}}Gt.__dashjs_factory_name="DroppedFramesHistory";var vt=n.default.getClassFactory(Gt);function Tt(){const b=this.context,p=(0,c.default)(b).getInstance(),v=(0,y.default)(b).getInstance();let T,w,A,N,C,x,B,q,I,P,D,$,J,Z,V,re,le,ue,be,X,G;function U(){T={},ue={},V=new Map,D&&D.reset(),be&&be.reset(),B=void 0,D=void 0,be=void 0,clearTimeout(w),w=null}function F(K,ge=!0){let _e=ve(K,ge);return _e=(function(xe){try{return(function(Me){try{if(!re.get().streaming.cmsd.enabled||!re.get().streaming.cmsd.abr.applyMb)return Me;const Ne=Me.filter((Ge=>{const Ze=Ge.mediaInfo.type;let ht=x.getMaxBitrate(Ze);if(Ze!==l.default.VIDEO||ht<0)return!0;const wt=Ge.mediaInfo.streamInfo.id;return ht-=ue[wt][l.default.AUDIO].getRepresentation().bitrateInKbit||0,Ge.bitrateInKbit<=ht}));return Ne.length>0?Ne:Me}catch(Ne){return J.error(Ne),Me}})(xe=(function(Me){try{if(!re.get().streaming.abr.limitBitrateByPortal)return Me;const{elementWidth:Ne}=G.getVideoElementSize(),Ge=Me.filter((Ze=>Ze.mediaInfo.type!==l.default.VIDEO||Ze.width<=Ne));return Ge.length>0?Ge:Me}catch(Ne){return J.error(Ne),Me}})(xe=(function(Me){try{const Ne=Me.filter((Ge=>{const Ze=Ge.mediaInfo.type,ht=Ge.bitrateInKbit,wt=Z.getAbrBitrateParameter("maxBitrate",Ze),Wt=Z.getAbrBitrateParameter("minBitrate",Ze);return!(wt>-1&&ht>wt||Wt>-1&&ht<Wt)}));return Ne.length>0?Ne:Me}catch(Ne){return J.error(Ne),Me}})(xe)))}catch(Me){return J.error(Me),xe}})(_e),_e}function ve(K,ge){let _e=[];return K&&((function(Me){try{const Ne=[];if(Me&&Ne.push(Me),!re.get().streaming.abr.enableSupplementalPropertyAdaptationSetSwitching||!Me.adaptationSetSwitchingCompatibleIds||Me.adaptationSetSwitchingCompatibleIds.length===0)return Ne;const Ge=ue[Me.streamInfo.id][Me.type].getAllMediaInfos().filter((Ze=>Me.adaptationSetSwitchingCompatibleIds.includes(Ze.id)));return Ne.concat(Ge)}catch{return[Me]}})(K).forEach((Me=>{let Ne=N.getVoRepresentations(Me);Ne&&Ne.length>0&&(_e=_e.concat(Ne))})),_e=(function(Me){return Me.forEach((Ne=>{if(Ne.dependentRepresentation&&Ne.dependentRepresentation.mediaInfo===null){let Ge=Ne.dependentRepresentation.id,Ze=Me.find((ht=>ht.id===Ge));Ze&&(Ne.dependentRepresentation=Ze)}})),Me})(_e),_e=(function(Me){return Me=(function(Ne){let Ge=null;return Ne.filter((Ze=>(Ge||(Ge=Ze.mediaInfo),!isNaN(Ze.qualityRanking)&&N.areMediaInfosEqual(Ge,Ze.mediaInfo)))).length===Ne.length})(Me)?(function(Ne){return Ne.sort(((Ge,Ze)=>Ze.qualityRanking-Ge.qualityRanking)),Ne})(Me):(function(Ne){return Ne.sort(((Ge,Ze)=>N.areMediaInfosEqual(Ge.mediaInfo,Ze.mediaInfo)?isNaN(Ge.pixelsPerSecond)||isNaN(Ze.pixelsPerSecond)||Ge.pixelsPerSecond===Ze.pixelsPerSecond?Ge.bandwidth-Ze.bandwidth:Ge.pixelsPerSecond-Ze.pixelsPerSecond:isNaN(Ge.pixelsPerSecond)||isNaN(Ze.pixelsPerSecond)||Ge.pixelsPerSecond===Ze.pixelsPerSecond?isNaN(Ge.bitsPerPixel)||isNaN(Ze.bitsPerPixel)?Ge.bandwidth-Ze.bandwidth:Ze.bitsPerPixel-Ge.bitsPerPixel:Ge.pixelsPerSecond-Ze.pixelsPerSecond)),Ne})(Me)})(_e),_e.forEach(((Me,Ne)=>{Me.absoluteIndex=Ne})),_e=_e.filter((Me=>{const Ne=!!ge||N.areMediaInfosEqual(Me.mediaInfo,K),Ge=!Me||!Me.mediaInfo||C.areKeyIdsUsable(Me.mediaInfo);return Ne&&Ge}))),_e}function te(K){const ge=K.request.mediaType,_e=K.streamId;if(!(ge&&_e&&ue[_e]&&re.get().streaming.abr.autoSwitchBitrate[ge]))return;const xe=ue[_e][ge];if(!xe)return;var Me;if(!(!((Me=xe.getLastSegment())&&Me.isPartialSegment&&!isNaN(Me.totalNumberOfPartialSegments)&&!isNaN(Me.replacementSubNumber))||Me.replacementSubNumber===0))return;const Ne=Ee(xe,K.request),Ge=A.shouldAbandonFragment(Ne);Ge&&Ge.representation!==r.default.NO_CHANGE&&(function(Ze,ht,wt,Wt,At){if(Wt.getFragmentModel().getRequests({state:Ue.FRAGMENT_MODEL_LOADING,index:Ze.request.index})[0]){const Vt=(function(on,kn){return T[on]&&T[on][kn]?T[on][kn]:null})(ht,wt);Vt&&(Vt.state=i.ABANDON_LOAD),be.reset(),oe(wt,le.getActiveStreamInfo(),At.representation,At.reason),clearTimeout(w),w=setTimeout((()=>{Vt&&(T[ht][wt].state=i.ALLOW_LOAD),w=null}),re.get().streaming.abandonLoadTimeout)}})(K,_e,ge,xe,Ge)}function ke(){re.get().streaming.abr.limitBitrateByPortal&&Object.keys(ue).forEach((K=>{Object.keys(ue[K]).forEach((ge=>{Le(ge,K)}))}))}function Ee(K,ge){return tt(b).create({abrController:$,adapter:N,currentRequest:ge,droppedFramesHistory:D,streamProcessor:K,switchRequestHistory:be,throughputController:X,videoModel:G})}function Re(K){K.mediaType===l.default.VIDEO&&(ee(K.streamId),B=K.newRepresentation.id)}function Oe(K){!me()||K.metric!==i.BUFFER_LEVEL||K.mediaType!==l.default.AUDIO&&K.mediaType!==l.default.VIDEO||(function(ge,_e){try{const xe=Z.getBufferTimeDefault(),Me=xe,Ne=.5*xe,Ge=A.getBolaState(ge),Ze=_e>=(Ge?Ne:Me);A.setBolaState(ge,Ze),Ze!==Ge&&(Ze?J.info("["+ge+"] switching from throughput to buffer occupancy ABR rule (buffer: "+_e.toFixed(3)+")."):J.info("["+ge+"] switching from buffer occupancy to throughput ABR rule (buffer: "+_e.toFixed(3)+")."))}catch(xe){J.error(xe)}})(K.mediaType,.001*K.value.level)}function Le(K,ge){try{if(!(K&&ue&&ue[ge]&&ue[ge][K]))return!1;ee(ge);const _e=ue[ge][K],xe=_e.getLastSegment(),Me=_e.getRepresentationController()?.getCurrentCompositeRepresentation(),Ne=Q(xe,Me);if(!re.get().streaming.abr.autoSwitchBitrate[K]||!Ne)return!1;const Ge=Ee(_e),Ze=A.getBestPossibleSwitchRequest(Ge);if(!Ze||!Ze.representation)return!1;let ht=Ze.representation;return(function(wt,Wt){be.push({currentRepresentation:wt,newRepresentation:Wt})})(Me,ht),ht.id!==Me.id&&(T[ge][K].state===i.ALLOW_LOAD||ht.absoluteIndex<Me.absoluteIndex)&&(ie(K,Me,ht,Ze.reason),!0)}catch(_e){return J.error(_e),!1}}function Q(K,ge){return!(K&&K.isPartialSegment&&!isNaN(K.totalNumberOfPartialSegments)&&!isNaN(K.replacementSubNumber))||K.replacementSubNumber===K.totalNumberOfPartialSegments-1||(function(_e,xe){if(!xe||!xe.segmentSequenceProperties||xe.segmentSequenceProperties.length<=0||xe&&xe.mediaInfo&&xe.mediaInfo.adaptationSetSwitchingCompatibleIds&&xe.mediaInfo.adaptationSetSwitchingCompatibleIds.length>0)return!1;const Me=xe.segmentSequenceProperties.filter((Ge=>!isNaN(Ge.sapType)&&Ge.sapType<=1));if(Me.length===0)return!1;let Ne=(_e.replacementSubNumber+1)%_e.totalNumberOfPartialSegments;return Me.some((Ge=>Ne%Ge.cadence==0))})(K,ge)}function ee(K){if(D){const ge=G.getPlaybackQuality();ge&&D.push(K,B,ge)}}function oe(K,ge,_e,xe={}){if(!(ge&&ge.id&&K&&ue&&ue[ge.id]&&ue[ge.id][K]&&_e))return!1;const Me=ue[ge.id][K],Ne=Me.getRepresentationController()?.getCurrentCompositeRepresentation();return(!Ne||_e.id!==Ne.id)&&ie(K,Ne,_e,xe)}function ae(K,ge){return`${K}-${ge}`}function ie(K,ge,_e,xe){const Me=_e.mediaInfo.streamInfo.id;if(!K||!ue[Me]||!ue[Me][K])return!1;const Ne=ue[Me][K].getStreamInfo(),Ge=I.getCurrentBufferLevel(K),Ze=ge!==null&&!N.areMediaInfosEqual(ge.mediaInfo,_e.mediaInfo),ht=ge?ge.bitrateInKbit:0;return J.info(`[AbrController]: Switching quality in period ${Me} for media type ${K}. Switch from bitrate ${ht} to bitrate ${_e.bitrateInKbit}. Current buffer level: ${Ge}. Reason:`+(xe?JSON.stringify(xe):"/")),v.trigger(d.default.QUALITY_CHANGE_REQUESTED,{isAdaptationSetSwitch:Ze,mediaType:K,newRepresentation:_e,oldRepresentation:ge,reason:xe,streamInfo:Ne},{streamId:Ne.id,mediaType:K}),(function(wt){const Wt=X.getAverageThroughput(wt);isNaN(Wt)||P.setSavedBitrateSettings(wt,Wt)})(K),!0}function me(){return re.get().streaming.abr.rules.bolaRule.active&&re.get().streaming.abr.rules.throughputRule.active}return $={canPerformQualitySwitch:Q,checkPlaybackQuality:Le,clearDataForStream:function(K){D&&D.clearForStream(K),ue[K]&&delete ue[K],be&&be.clearForStream(K),T[K]&&delete T[K],A.clearDataForStream(K)},getAbandonmentStateFor:function(K,ge){return T[K]&&T[K][ge]?T[K][ge].state:null},getInitialBitrateFor:function(K){if(K===l.default.TEXT)return NaN;let ge=Z.getAbrBitrateParameter("initialBitrate",K);if(ge>0)return ge;let _e=NaN;if(P&&P.hasOwnProperty("getSavedBitrateSettings")&&(_e=P.getSavedBitrateSettings(K)),!isNaN(_e))return _e;const xe=X.getAverageThroughput(K);return!isNaN(xe)&&xe>0?xe:K===l.default.VIDEO?1e3:100},getOptimalRepresentationForBitrate:function(K,ge,_e=!0){const xe=F(K,_e);if(!xe||xe.length===0)return null;const Me=xe.reduce(((Ge,Ze)=>Ge.bandwidth<Ze.bandwidth?Ge:Ze));if(ge<=0)return Me;const Ne=xe.filter((Ge=>Ge.bitrateInKbit<=ge));return Ne&&Ne.length!==0?Ne.reduce(((Ge,Ze)=>Ze.absoluteIndex>Ge.absoluteIndex?Ze:Ge)):Me},getPossibleVoRepresentations:function(K,ge=!0){return ve(K,ge)},getPossibleVoRepresentationsFilteredBySettings:F,getRepresentationByAbsoluteIndex:function(K,ge,_e=!0){return isNaN(K)||K<0?null:F(ge,_e).find((xe=>xe.absoluteIndex===K))},handleNewMediaInfo:function(K){A.handleNewMediaInfo(K)},handlePendingManualQualitySwitch:function(K,ge){try{const _e=ae(K,ge);let xe=null;if(V.has(_e)&&(xe=V.get(_e)),!xe)return!1;const Me=ue[K][ge],Ne=Me.getLastSegment();if(!Q(Ne,Me.getRepresentation()))return!1;const{type:Ge,streamInfo:Ze,representation:ht,reason:wt}=xe;return V.delete(_e),oe(Ge,Ze,ht,wt),!0}catch(_e){J.error(`Can not handle pending manual quality switch: ${_e}`)}},initialize:function(){D=vt(b).create(),be=dt(b).create(),A=k(b).create({dashMetrics:I,customParametersModel:q,mediaPlayerModel:Z,settings:re}),A.initialize(),v.on(d.default.QUALITY_CHANGE_RENDERED,Re,$),v.on(d.default.METRIC_ADDED,Oe,$),v.on(u.default.LOADING_PROGRESS,te,$),v.on(u.default.VIDEO_ELEMENT_RESIZED,ke,$)},isPlayingAtLowestQuality:function(K){return F(K.mediaInfo,!0)[0].id===K.id},isPlayingAtTopQuality:function(K){if(!K)return!0;const ge=F(K.mediaInfo,!0);return ge[ge.length-1].id===K.id},manuallySetPlaybackQuality:function(K,ge,_e,xe={}){const Me=ue[ge.id][K];if(Q(Me.getLastSegment(),Me.getRepresentation()))return oe(K,ge,_e,xe);(function(Ne,Ge,Ze,ht){try{J.debug(`[AbrController] Queuing manual quality switch for stream ${Ge.id} and type ${Ne} to representation ${Ze.id}`);const wt=ae(Ge.id,Ne);V.set(wt,{type:Ne,streamInfo:Ge,representation:Ze,reason:ht})}catch(wt){J.error(`Can not queue manual quality switch: ${wt}`)}})(K,ge,_e,xe)},registerStreamType:function(K,ge){const _e=ge.getStreamInfo().id;ue[_e]||(ue[_e]={}),ue[_e][K]=ge,T[_e]||(T[_e]={}),T[_e][K]={},T[_e][K].state=i.ALLOW_LOAD,A.getBolaState(K)===void 0&&A.setBolaState(K,re.get().streaming.abr.rules.bolaRule.active&&!me())},reset:function(){U(),v.off(d.default.QUALITY_CHANGE_RENDERED,Re,$),v.off(d.default.METRIC_ADDED,Oe,$),v.off(u.default.LOADING_PROGRESS,te,$),v.off(u.default.VIDEO_ELEMENT_RESIZED,ke,$),A&&A.reset()},setConfig:function(K){K&&(K.streamController&&(le=K.streamController),K.throughputController&&(X=K.throughputController),K.domStorage&&(P=K.domStorage),K.mediaPlayerModel&&(Z=K.mediaPlayerModel),K.customParametersModel&&(q=K.customParametersModel),K.cmsdModel&&(x=K.cmsdModel),K.dashMetrics&&(I=K.dashMetrics),K.adapter&&(N=K.adapter),K.videoModel&&(G=K.videoModel),K.settings&&(re=K.settings),K.capabilities&&(C=K.capabilities))},setPlaybackQuality:oe,unRegisterStreamType:function(K,ge){try{ue[K]&&ue[K][ge]&&delete ue[K][ge],T[K]&&T[K][ge]&&delete T[K][ge]}catch{}}},J=p.getLogger($),U(),$}Tt.__dashjs_factory_name="AbrController";const yt=n.default.getSingletonFactory(Tt);n.default.updateSingletonFactory(Tt.__dashjs_factory_name,yt);var Zt,_n,An,Sn,wn,Rn=yt,mt=function(b){for(var p=[],v=0;v<b.length;++v){var T=b.charCodeAt(v);T<128?p.push(T):T<2048?(p.push(192|T>>6),p.push(128|63&T)):T<65536?(p.push(224|T>>12),p.push(128|63&T>>6),p.push(128|63&T)):(p.push(240|T>>18),p.push(128|63&T>>12),p.push(128|63&T>>6),p.push(128|63&T))}return p},st=function(b){for(var p=[],v=0;v<b.length;){var T=b[v++];T<128||(T<224?(T=(31&T)<<6,T|=63&b[v++]):T<240?(T=(15&T)<<12,T|=(63&b[v++])<<6,T|=63&b[v++]):(T=(7&T)<<18,T|=(63&b[v++])<<12,T|=(63&b[v++])<<6,T|=63&b[v++])),p.push(String.fromCharCode(T))}return p.join("")},it={};Zt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_n=function(b){for(var p=0,v=[],T=0|b.length/3;0<T--;){var w=(b[p]<<16)+(b[p+1]<<8)+b[p+2];p+=3,v.push(Zt.charAt(63&w>>18)),v.push(Zt.charAt(63&w>>12)),v.push(Zt.charAt(63&w>>6)),v.push(Zt.charAt(63&w))}return b.length-p==2?(w=(b[p]<<16)+(b[p+1]<<8),v.push(Zt.charAt(63&w>>18)),v.push(Zt.charAt(63&w>>12)),v.push(Zt.charAt(63&w>>6)),v.push("=")):b.length-p==1&&(w=b[p]<<16,v.push(Zt.charAt(63&w>>18)),v.push(Zt.charAt(63&w>>12)),v.push("==")),v.join("")},An=(function(){for(var b=[],p=0;p<64;++p)b[Zt.charCodeAt(p)]=p;return b[61]=0,b})(),Sn=function(b){for(var p=0,v=[],T=0|b.length/4;0<T--;){var w=(An[b.charCodeAt(p)]<<18)+(An[b.charCodeAt(p+1)]<<12)+(An[b.charCodeAt(p+2)]<<6)+An[b.charCodeAt(p+3)];v.push(255&w>>16),v.push(255&w>>8),v.push(255&w),p+=4}return v&&(b.charAt(p-2)=="="?(v.pop(),v.pop()):b.charAt(p-1)=="="&&v.pop()),v},wn={encode:function(b){for(var p=[],v=0;v<b.length;++v)p.push(b.charCodeAt(v));return p},decode:function(b){for(var p=0;p<s.length;++p)a[p]=String.fromCharCode(a[p]);return a.join("")}},it.decodeArray=function(b){var p=Sn(b);return new Uint8Array(p)},it.encodeASCII=function(b){var p=wn.encode(b);return _n(p)},it.decodeASCII=function(b){var p=Sn(b);return wn.decode(p)},it.encode=function(b){var p=mt(b);return _n(p)},it.decode=function(b){var p=Sn(b);return st(p)},typeof exports<"u"&&(exports.decode=it.decode,exports.decodeArray=it.decodeArray,exports.encode=it.encode,exports.encodeASCII=it.encodeASCII);var lt=it,ft=t(7393);const kt=NaN;class Ot{constructor(p,v){this.data={baseUrls:p||null,selectedIdx:v||kt},this.children=[]}}function Ft(){let b,p,v,T;const w=this.context,A=(0,ft.default)(w).getInstance();function N(q,I,P){const D=C(P);q[I]?A.areEqual(D,q[I].data.baseUrls)||(q[I].data.baseUrls=D,q[I].data.selectedIdx=kt):q[I]=new Ot(D)}function C(q){let I=v.getBaseURLsFromElement(q);const P=T.getSynthesizedBaseUrlElements(I);return P&&P.length>0&&P.forEach((D=>{const $=I.findIndex((J=>J.serviceLocation===D.serviceLocation));$!==-1?I[$]=D:I.push(D)})),I}function x(q,I){const P=I||p;q(P.data),P.children&&P.children.forEach((D=>x(q,D)))}function B(){p=new Ot}return b={reset:B,update:function(q){(function(I){(function(){if(!v||!v.hasOwnProperty("getBaseURLsFromElement")||!v.hasOwnProperty("getRepresentationSortFunction"))throw new Error("setConfig function has to be called previously")})();const P=C(I);A.areEqual(P,p.data.baseUrls)||(p.data.baseUrls=P,p.data.selectedIdx=kt),I&&I.Period&&I.Period.forEach(((D,$)=>{N(p.children,$,D),D.AdaptationSet&&D.AdaptationSet.forEach(((J,Z)=>{N(p.children[$].children,Z,J),J.Representation&&J.Representation.sort(v.getRepresentationSortFunction()).forEach(((V,re)=>{N(p.children[$].children[Z].children,re,V)}))}))}))})(q)},getForPath:function(q){let I=p;const P=[I.data];return q&&q.forEach((D=>{I=I.children[D],I&&P.push(I.data)})),P.filter((D=>D.baseUrls.length))},invalidateSelectedIndexes:function(q){x((I=>{isNaN(I.selectedIdx)||q===I.baseUrls[I.selectedIdx].serviceLocation&&(I.selectedIdx=kt)}))},setConfig:function(q){q.adapter&&(v=q.adapter),q.contentSteeringController&&(T=q.contentSteeringController)},getBaseUrls:function(q){return C(q)}},B(),b}Ft.__dashjs_factory_name="BaseURLTreeModel";var It=n.default.getClassFactory(Ft),Ct=t(8748);class jt extends Ct.default{constructor(){super(),this.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE=10,this.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE=11,this.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE=12,this.SEGMENT_BASE_LOADER_ERROR_CODE=15,this.TIME_SYNC_FAILED_ERROR_CODE=16,this.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE=17,this.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE=18,this.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE=19,this.APPEND_ERROR_CODE=20,this.REMOVE_ERROR_CODE=21,this.DATA_UPDATE_FAILED_ERROR_CODE=22,this.CAPABILITY_MEDIASOURCE_ERROR_CODE=23,this.CAPABILITY_MEDIAKEYS_ERROR_CODE=24,this.DOWNLOAD_ERROR_ID_MANIFEST_CODE=25,this.DOWNLOAD_ERROR_ID_SIDX_CODE=26,this.DOWNLOAD_ERROR_ID_CONTENT_CODE=27,this.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE=28,this.DOWNLOAD_ERROR_ID_XLINK_CODE=29,this.MANIFEST_ERROR_ID_PARSE_CODE=31,this.MANIFEST_ERROR_ID_NOSTREAMS_CODE=32,this.TIMED_TEXT_ERROR_ID_PARSE_CODE=33,this.MANIFEST_ERROR_ID_MULTIPLEXED_CODE=34,this.MEDIASOURCE_TYPE_UNSUPPORTED_CODE=35,this.NO_SUPPORTED_KEY_IDS=36,this.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE="parsing failed for ",this.MANIFEST_LOADER_LOADING_FAILURE_ERROR_MESSAGE="Failed loading manifest: ",this.XLINK_LOADER_LOADING_FAILURE_ERROR_MESSAGE="Failed loading Xlink element: ",this.SEGMENTS_UPDATE_FAILED_ERROR_MESSAGE="Segments update failed",this.SEGMENTS_UNAVAILABLE_ERROR_MESSAGE="no segments are available yet",this.SEGMENT_BASE_LOADER_ERROR_MESSAGE="error loading segment ranges from sidx",this.TIME_SYNC_FAILED_ERROR_MESSAGE="Failed to synchronize client and server time",this.FRAGMENT_LOADER_NULL_REQUEST_ERROR_MESSAGE="request is null",this.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE="Failed to resolve a valid URL",this.APPEND_ERROR_MESSAGE="chunk is not defined",this.REMOVE_ERROR_MESSAGE="Removing data from the SourceBuffer",this.DATA_UPDATE_FAILED_ERROR_MESSAGE="Data update failed",this.CAPABILITY_MEDIASOURCE_ERROR_MESSAGE="mediasource is not supported",this.CAPABILITY_MEDIAKEYS_ERROR_MESSAGE="mediakeys is not supported",this.TIMED_TEXT_ERROR_MESSAGE_PARSE="parsing error :",this.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE="Error creating source buffer of type : ",this.NO_SUPPORTED_KEY_IDS_MESSAGE="All possible Adaptation Sets have an invalid key status"}}var Yt=new jt;function Mt(b){let p;b=b||{};let v=[];const T=(0,y.default)(this.context).getInstance(),w=b.updateEventName,A=b.addBlacklistEventName;function N(x){v.indexOf(x)===-1&&(v.push(x),T.trigger(w,{entry:x}))}function C(x){N(x.entry)}return p={add:N,remove:function(x){const B=v.indexOf(x);B!==-1&&v.splice(B,1)},contains:function(x){return!!(v.length&&x&&x.length)&&v.indexOf(x)!==-1},reset:function(){A&&T.off(A,C,p),v=[]}},A&&T.on(A,C,p),p}Mt.__dashjs_factory_name="BlackListController";var tn=n.default.getClassFactory(Mt);function hn(b){let p;const v=(b=b||{}).blacklistController;return p={select:function(T){return T&&(function(w){let A,N,C=0,x=[],B=0;if(N=w.sort((function(q,I){let P=q.dvbPriority-I.dvbPriority;return isNaN(P)?0:P})).filter((function(q,I,P){return!I||P[0].dvbPriority&&q.dvbPriority&&P[0].dvbPriority===q.dvbPriority})),N.length)return N.length>1&&(N.forEach((q=>{C+=q.dvbWeight,x.push(C)})),A=Math.floor(Math.random()*(C-1)),x.every(((q,I)=>(B=I,!(A<q))))),N[B]})((function(w){let A=[];return w.filter((function(N){return!v.contains(N.serviceLocation)||(N.dvbPriority&&A.push(N.dvbPriority),!1)})).filter((function(N){return!A.length||!N.dvbPriority||A.indexOf(N.dvbPriority)===-1}))})(T))}},p}hn.__dashjs_factory_name="DVBSelector";var un=n.default.getClassFactory(hn);function an(b){let p;const v=(b=b||{}).blacklistController;return p={select:function(T){let w,A=0;return T&&T.some(((N,C)=>(A=C,!v.contains(N.serviceLocation))))&&(w=T[A]),w}},p}an.__dashjs_factory_name="BasicSelector";var Pn=n.default.getClassFactory(an),Bt=t(1944),ct=t(656),at=t(7263);function qt(){let b,p;function v(){p&&(p.onloadend=p.onerror=p.onprogress=p.onload=null,p.abort(),p=null)}return b={load:function(T,w){if(p=null,p=new XMLHttpRequest,p.open(T.method,T.url,!0),T.responseType&&(p.responseType=T.responseType),T.headers)for(let A in T.headers){let N=T.headers[A];N&&p.setRequestHeader(A,N)}return p.withCredentials=T.credentials==="include",p.timeout=T.timeout,p.onload=function(){w.url=this.responseURL,w.status=this.status,w.statusText=this.statusText,w.headers=at.default.parseHttpHeaders(this.getAllResponseHeaders()),w.data=this.response},T.customData&&(p.onloadend=T.customData.onloadend,p.onprogress=T.customData.onprogress,p.onabort=T.customData.onabort,p.ontimeout=T.customData.ontimeout),p.send(),T.customData.abort=v.bind(this),!0},abort:v,getXhr:function(){return p},reset:function(){v(),b=null},resetInitialSettings:function(){v()}},b}qt.__dashjs_factory_name="XHRLoader";var Qt=n.default.getClassFactory(qt);function fn(){const b=this.context,p=(0,h.default)(b).getInstance();let v,T,w;function A(I,P,D){I.customData.reader.read().then(D).catch((function(){N(I)}))}function N(I){I.customData.onloadend&&I.customData.onloadend()}function C(){return typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now()}function x(){if(this.customData.abortController)this.customData.abortController.abort();else if(this.customData.reader)try{this.customData.reader.cancel(),this.onabort()}catch{}}function B(I,P){try{if((I=I.filter((D=>D.bytes>P/4/I.length))).length>1){let D=0;const $=(I[I.length-1].timestamp-I[0].timestamp)/I.length;return I.forEach(((J,Z)=>{const V=I[Z+1];if(V){const re=V.timestamp-J.timestamp;D+=re<$?re:0}})),D}return null}catch{return null}}function q(I,P){return 8*I/P}return w=(0,c.default)(b).getInstance().getLogger(v),v={abort:x,calculateDownloadedTime:B,load:function(I,P){const D=(function(Z){const V=new Headers;if(Z.headers)for(let re in Z.headers){let le=Z.headers[re];le&&V.append(re,le)}return V})(I),$=(function(Z){let V;return typeof window.AbortController=="function"&&(V=new AbortController,Z.customData.abortController=V,V.signal.onabort=Z.customData.onabort),Z.customData.abort=x.bind(Z),V})(I),J=(function(Z,V,re){return new Request(Z.url,{method:Z.method,headers:V,credentials:Z.credentials,signal:re?re.signal:void 0})})(I,D,$);fetch(J).then((Z=>{(function(V,re,le){(function(Re,Oe){Re.status=Oe.status,Re.statusText=Oe.statusText,Re.url=Oe.url;const Le={};for(const Q of Oe.headers.keys())Le[Q]=Oe.headers.get(Q);Re.headers=Le})(le,V),V.ok||re.customData.onloadend();let ue=0,be=!1,X=new Uint8Array,G=0;re.customData.reader=V.body.getReader();let U=[],F=[],ve=[],te=!0;const ke=p.get().streaming.abr.throughput.lowLatencyDownloadTimeCalculationMode,Ee=({value:Re,done:Oe})=>{Oe?(function(){if(X){const Le=(function(){let Q=null;return ke===l.default.LOW_LATENCY_DOWNLOAD_TIME_CALCULATION_MODE.MOOF_PARSING?Q=(function(){const ee=(function(oe,ae){try{let ie,me;if(ie=oe.slice(0,-1),me=ae.slice(0,-1),ie.length!==me.length&&w.warn(`[FetchLoader] Moof and Mdat data arrays have different lengths. Moof: ${ie.length}, Mdat: ${me.length}`),ie.length<=1)return null;let K=[],ge=0,_e=0;for(let xe=0;xe<ie.length;xe++)if(ie[xe]&&me[xe]){let Me=me[xe].timestamp-ie[xe].timestamp;if(Me>1){const Ne=q(me[xe].bytes,Me);K.push(Ne),_e=0}else{_e===0&&(_e=ie[xe].timestamp,ge=0);let Ne=me[xe].timestamp-_e;if(Ne>1){ge+=me[xe].bytes;const Ge=q(ge,Ne);K.push(Ge),_e=0}else ge+=me[xe].bytes}}return K.length>0?K.reduce(((xe,Me)=>xe+Me),0)/K.length:null}catch{return null}})(F,ve);return ee?8*ue/ee:null})():ke===l.default.LOW_LATENCY_DOWNLOAD_TIME_CALCULATION_MODE.DOWNLOADED_DATA&&(Q=B(U,ue)),Q})();re.customData.onprogress({loaded:ue,total:ue,lengthComputable:!0,time:Le}),le.data=X.buffer}re.customData.onloadend()})():(Re&&Re.length>0&&(function(Le){X=(function(ee,oe){if(ee.length===0)return oe;const ae=new Uint8Array(ee.length+oe.length);return ae.set(ee),ae.set(oe,ee.length),ae})(X,Le),ue+=Le.length,U.push({timestamp:C(),bytes:Le.length}),ke===l.default.LOW_LATENCY_DOWNLOAD_TIME_CALCULATION_MODE.MOOF_PARSING&&te&&T.findLastTopIsoBoxCompleted(["moof"],X,G).found&&(te=!1,F.push({timestamp:C()}));const Q=T.findLastTopIsoBoxCompleted(["moov","mdat"],X,G);Q.found?(function(ee){const oe=(function(ae){let ie;return ae===X.length?(ie=X,X=new Uint8Array):(ie=new Uint8Array(X.subarray(0,ae)),X=X.subarray(ae)),ie})(ee.startOffsetOfLastFoundTargetBox+ee.sizeOfLastFoundTargetBox);ke!==l.default.LOW_LATENCY_DOWNLOAD_TIME_CALCULATION_MODE.MOOF_PARSING||te||(te=!0,ve.push({timestamp:C(),bytes:oe.length})),re.customData.onprogress({data:oe.buffer,lengthComputable:!1,noTrace:!0}),G=0})(Q):(function(ee){G=ee.startOffsetOfLastCompletedBox+ee.sizeOfLastCompletedBox,be||(re.customData.onprogress({lengthComputable:!1,noTrace:!0}),be=!0)})(Q)})(Re),A(re,0,Ee))};A(re,0,Ee)})(Z,I,P)})).catch((()=>{N(I)}))},reset:function(){},setConfig:function(I){T=I.boxParser}},v}fn.__dashjs_factory_name="FetchLoader";var Nn=n.default.getClassFactory(fn),Mn=t(913),ra=class{constructor(){this.period=null,this.index=-1,this.id=null,this.type=null}};class qn{constructor(p,v,T,w){this.url=p||"",this.serviceLocation=v||p||"",this.dvbPriority=T||1,this.dvbWeight=w||1,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0,this.queryParams={}}}qn.DEFAULT_DVB_PRIORITY=1,qn.DEFAULT_DVB_WEIGHT=1;var Xn=qn,Se=t(8854),ia=class{constructor(){this.schemeIdUri=null,this.value=null,this.id=null}init(b){b&&(this.schemeIdUri=b.schemeIdUri?b.schemeIdUri:null,this.value=b.value!==null&&b.value!==void 0?b.value.toString():null,this.id=b.id?b.id:null,b[Se.default.DVB_URL]&&(this.dvbUrl=b[Se.default.DVB_URL]),b[Se.default.DVB_MIMETYPE]&&(this.dvbMimeType=b[Se.default.DVB_MIMETYPE]),b[Se.default.DVB_FONTFAMILY]&&(this.dvbFontFamily=b[Se.default.DVB_FONTFAMILY]))}inArray(b){return!!b&&b.some((p=>this.schemeIdUri===p.schemeIdUri&&(this.value?this.value.toString().match(p.value):"".match(p.value))))}},ca=class extends ia{constructor(){super(),this.version=null,this.sessionID=null,this.contentID=null,this.mode=null,this.keys=null,this.includeInRequests=null}init(b){super.init(b),b&&(this.version=b.version,this.sessionID=b.sessionID,this.contentID=b.contentID,this.mode=b.mode??"query",this.keys=b.keys?b.keys.split(" "):null,this.includeInRequests=b.includeInRequests?b.includeInRequests.split(" "):["segment"],this.schemeIdUri=b.schemeIdUri)}},Da=class{constructor(){this.adaptationSets=null,this.adaptationSetsArray=[],this.cmcdParameters=null,this.serviceLocations=null,this.serviceLocationsArray=[]}},sa=class extends ia{constructor(){super(),this.ref=null,this.refId=null,this.robustness=null,this.keyId=null,this.cencDefaultKid=null,this.pssh=null,this.pro=null,this.laUrl=null}init(b){super.init(b),b&&(this.ref=b.hasOwnProperty(Se.default.REF)?b[Se.default.REF]:null,this.refId=b.hasOwnProperty(Se.default.REF_ID)?b[Se.default.REF_ID]:null,this.robustness=b.hasOwnProperty(Se.default.ROBUSTNESS)?b[Se.default.ROBUSTNESS]:null,this.cencDefaultKid=b.hasOwnProperty(Se.default.CENC_DEFAULT_KID)?b[Se.default.CENC_DEFAULT_KID]:null,this.pssh=b.hasOwnProperty(Se.default.PSSH)?b[Se.default.PSSH]:null,this.pro=b.hasOwnProperty(Se.default.PRO)?b[Se.default.PRO]:null,this.laUrl=b.hasOwnProperty(Se.default.LA_URL)?b[Se.default.LA_URL]:b.hasOwnProperty(Se.default.LA_URL_LOWER_CASE)?b[Se.default.LA_URL_LOWER_CASE]:null)}mergeAttributesFromReference(b){["schemeIdUri","value","id","robustness","cencDefaultKid","pro","pssh","laUrl"].forEach((p=>{this[p]===null&&(this[p]=b[p])}))}},Oa=class{constructor(){this.defaultServiceLocation=null,this.defaultServiceLocationArray=[],this.queryBeforeStart=!1,this.serverUrl=null,this.clientRequirement=!0}},da=class{constructor(){this.type="",this.duration=NaN,this.presentationTime=NaN,this.id=NaN,this.messageData="",this.eventStream=null,this.presentationTimeDelta=NaN,this.parsedMessageData=null}},Fr=class{constructor(){this.adaptionSet=null,this.representation=null,this.period=null,this.timescale=1,this.value="",this.schemeIdUri="",this.presentationTimeOffset=0}},tr=class{constructor(){this.availabilityEndTime=Number.POSITIVE_INFINITY,this.availabilityStartTime=null,this.manifest=null,this.maxSegmentDuration=Number.POSITIVE_INFINITY,this.mediaPresentationDuration=NaN,this.minimumUpdatePeriod=NaN,this.publishTime=null,this.suggestedPresentationDelay=0,this.timeShiftBufferDepth=Number.POSITIVE_INFINITY}},wr=class{constructor(b,p){this.url=b||"",this.serviceLocation=p||null,this.queryParams={}}},La=class{constructor(b,p,v){this.url=b||"",this.serviceLocation=p||null,this.ttl=v||NaN,this.queryParams={}}};class _r{constructor(){this.id=null,this.index=-1,this.duration=NaN,this.start=NaN,this.mpd=null,this.nextPeriodId=null,this.isEncrypted=!1}}_r.DEFAULT_ID="defaultId";var _a=_r,ur=class{constructor(){this.period=null,this.index=-1,this.id=1,this.type=null,this.tag=null,this.order="undefined",this.preselectionComponents=[]}},Dt=class{constructor(){this.id=null,this.inband=!1,this.type="encoder",this.applicationScheme=null,this.wallClockTime=null,this.presentationTime=NaN,this.UTCTiming=null}},Xt=class{constructor(){this.absoluteIndex=NaN,this.adaptation=null,this.availabilityTimeComplete=!0,this.availabilityTimeOffset=0,this.bandwidth=NaN,this.bitrateInKbit=NaN,this.bitsPerPixel=NaN,this.codecFamily=null,this.codecPrivateData=null,this.codecs=null,this.dependencyId=null,this.dependentRepresentation=null,this.endNumber=null,this.essentialProperties=[],this.fragmentDuration=null,this.frameRate=null,this.height=NaN,this.id=null,this.indexRange=null,this.initialization=null,this.maxPlayoutRate=NaN,this.mediaFinishedInformation={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN},this.mediaInfo=null,this.mimeType=null,this.mseTimeOffset=NaN,this.pixelsPerSecond=NaN,this.presentationTimeOffset=0,this.qualityRanking=NaN,this.range=null,this.scanType=null,this.segments=null,this.segmentDuration=NaN,this.segmentInfoType=null,this.segmentSequenceProperties=[],this.supplementalProperties=[],this.startNumber=1,this.timescale=1,this.width=NaN}hasInitialization(){return this.initialization!==null||this.range!==null}hasSegments(){return this.segmentInfoType!==Se.default.BASE_URL&&this.segmentInfoType!==Se.default.SEGMENT_BASE&&!this.indexRange}};function rn(){let b;const p=/^[a-z][a-z0-9+\-_.]*:/i,v=/^https?:\/\//i,T=/^https:\/\//i,w=/^([a-z][a-z0-9+\-_.]*:\/\/[^\/]+)\/?/i,A=(D,$)=>{try{return new window.URL(D,$).toString()}catch{return D}},N=(D,$)=>{let J=C;if(!$||!q(D))return D;I(D)&&(J=x),P(D)&&(J=B);const Z=J($),V=Z.charAt(Z.length-1)!=="/"&&D.charAt(0)!=="/"?"/":"";return[Z,D].join(V)};function C(D){const $=D.indexOf("/"),J=D.lastIndexOf("/");return $!==-1?J===$+1?D:(D.indexOf("?")!==-1&&(D=D.substring(0,D.indexOf("?"))),D.substring(0,J+1)):""}function x(D){const $=D.match(w);return $?$[1]:""}function B(D){const $=D.match(p);return $?$[0]:""}function q(D){return!p.test(D)}function I(D){return q(D)&&D.charAt(0)==="/"}function P(D){return D.indexOf("//")===0}return(function(){try{new window.URL("x","http://y"),b=A}catch{}finally{b=b||N}})(),{parseBaseUrl:C,parseOrigin:x,parseScheme:B,isRelative:q,isPathAbsolute:I,isSchemeRelative:P,isHTTPURL:function(D){return v.test(D)},isHTTPS:function(D){return T.test(D)},removeHostname:function(D){return/^(?:\w+\:\/\/)?([^\/]+)(.*)$/.exec(D)[2].substring(1)},resolve:function(D,$){return b(D,$)}}}rn.__dashjs_factory_name="DefaultURLUtils";var Ln=n.default.getSingletonFactory(rn);function In(){let b,p,v=[];const T=this.context;function w(A,N,C){let x=(function(B){let q;for(q=0;q<v.length;q++)if(v[q].regex.test(B))return v[q].utils;return p})(C||N);return x&&typeof x[A]=="function"?x[A](N,C):p[A](N,C)}return p=Ln(T).getInstance(),b={registerUrlRegex:function(A,N){v.push({regex:A,utils:N})},parseBaseUrl:function(A){return w("parseBaseUrl",A)},parseOrigin:function(A){return w("parseOrigin",A)},parseScheme:function(A){return w("parseScheme",A)},isRelative:function(A){return w("isRelative",A)},isPathAbsolute:function(A){return w("isPathAbsolute",A)},isSchemeRelative:function(A){return w("isSchemeRelative",A)},isHTTPURL:function(A){return w("isHTTPURL",A)},isHTTPS:function(A){return w("isHTTPS",A)},removeHostname:function(A){return w("removeHostname",A)},resolve:function(A,N){return w("resolve",A,N)}},b}In.__dashjs_factory_name="URLUtils";var Un=n.default.getSingletonFactory(In),$n=t(5717),Fn=class{constructor(){this.cadence=1,this.sapType=0,this.event=!0,this.alignment=null}init(b){b&&(this.cadence=b.cadence===void 0||isNaN(b.cadence)?1:b.cadence,this.sapType=b.sapType===void 0||isNaN(b.sapType)?0:b.sapType,this.event=b.event===void 0||b.event,this.alignment=b.alignment!==void 0?b.alignment:null)}};function zn(){let b,p,v,T;const w=this.context,A=Un(w).getInstance(),N=Number.isInteger||function(Q){return typeof Q=="number"&&isFinite(Q)&&Math.floor(Q)===Q};function C(Q,ee){if(!Q)throw new Error("adaptation is not defined");if(!ee)throw new Error("type is not defined");if(Q.Representation&&Q.Representation.length){const ae=be(Q.Representation[0]);if(ae&&ae.some((ie=>l.default.THUMBNAILS_SCHEME_ID_URIS.indexOf(ie.schemeIdUri)>=0)))return ee===l.default.IMAGE}if(Q.ContentComponent&&Q.ContentComponent.length>0){if(Q.ContentComponent.length>1)return ee===l.default.MUXED;if(Q.ContentComponent[0].contentType===ee)return!0}const oe=ee===l.default.TEXT?new RegExp("(ttml|vtt|wvtt|stpp)"):new RegExp(ee);if(Q.Representation&&Q.Representation.length){const ae=Q.Representation[0].codecs;if(oe.test(ae))return!0}if(Q.hasOwnProperty(Se.default.MIME_TYPE))return oe.test(Q.mimeType);if(Q.Representation){let ae;for(let ie=0;ie<Q.Representation.length;ie++)if(ae=Q.Representation[ie],ae.hasOwnProperty(Se.default.MIME_TYPE))return oe.test(ae.mimeType)}return!1}function x(Q){if(!Q)throw new Error("adaptation is not defined");if(Q.hasOwnProperty(Se.default.SEGMENT_TEMPLATE)||Q.hasOwnProperty(Se.default.SEGMENT_TIMELINE)||Q.hasOwnProperty(Se.default.SEGMENT_LIST)||Q.hasOwnProperty(Se.default.SEGMENT_BASE))return!0;if(Q.Representation&&Q.Representation.length>0){const ee=Q.Representation[0];if(ee.hasOwnProperty(Se.default.SEGMENT_TEMPLATE)||ee.hasOwnProperty(Se.default.SEGMENT_TIMELINE)||ee.hasOwnProperty(Se.default.SEGMENT_LIST)||ee.hasOwnProperty(Se.default.SEGMENT_BASE))return!0}return!1}function B(Q){return C(Q,l.default.TEXT)}function q(Q){return Q&&Q.Representation&&Q.Representation.sort(((ee,oe)=>ee.bandwidth-oe.bandwidth)),Q}function I(Q,ee){return Q&&Q.Period&&N(ee)&&Q.Period[ee]?Q.Period[ee].AdaptationSet:[]}function P(Q){return Q&&Q.Period?Q.Period:[]}function D(Q,ee,oe){let ae=null;if(Q&&Q.Representation&&Q.Representation.length>0){const ie=N(ee)&&ee>=0&&ee<Q.Representation.length?Q.Representation[ee]:Q.Representation[0];ie&&(ae=ie.mimeType+';codecs="'+ie.codecs+'"',oe&&ie.width!==void 0&&(ae+=';width="'+ie.width+'";height="'+ie.height+'"'))}return ae&&(ae=ae.replace(/\sprofiles=[^;]*/g,"")),ae}function $(Q){const ee=J(Q);return ee&&ee.length>0}function J(Q){let ee=[];if(!Q)return ee;const oe=Z(Q);return ee=ee.concat(oe),Q.hasOwnProperty(Se.default.ADAPTATION_SET)&&Q[Se.default.ADAPTATION_SET].length>0&&Q[Se.default.ADAPTATION_SET].forEach((ae=>{const ie=Z(ae);ee=ee.concat(ie)})),ee}function Z(Q){return Q&&Q.hasOwnProperty(Se.default.CONTENT_PROTECTION)&&Q.ContentProtection.length!==0?Q[Se.default.CONTENT_PROTECTION].map((ee=>{const oe=new sa;return oe.init(ee),oe})):[]}function V(Q){let ee=!1;return Q&&Q.hasOwnProperty("type")&&(ee=Q.type===Se.default.DYNAMIC),ee}function re(Q){if(!Q)return null;const ee=Q[Se.default.FRAMERATE];if(!ee)return null;if(typeof ee=="string"&&ee.includes("/")){const[oe,ae]=ee.split("/").map((ie=>parseInt(ie,10)));if(!isNaN(oe)&&!isNaN(ae)&&ae!==0)return oe/ae}return parseInt(ee)}function le(Q,ee){return ee&&ee.hasOwnProperty(Q)&&ee[Q].length?ee[Q].map((oe=>{const ae=new ia;return ae.init(oe),ae})):[]}function ue(Q,ee){if(!ee)return[];let oe=(function(ae,ie){if(!ie||!ie.length)return[];let me=ie[0][ae]||[];return me.length===0?[]:ie.length===1?me:me.filter((K=>ie.slice(1).every((ge=>ge.hasOwnProperty(ae)&&ge[ae].some((_e=>_e.schemeIdUri===K.schemeIdUri&&_e.value===K.value))))))})(Q,ee[Se.default.REPRESENTATION]);return ee.hasOwnProperty(Q)&&ee[Q].length&&oe.push(...ee[Q]),oe.map((ae=>{const ie=new ia;return ie.init(ae),ie}))}function be(Q){return le(Se.default.ESSENTIAL_PROPERTY,Q)}function X(Q){return le(Se.default.SUPPLEMENTAL_PROPERTY,Q)}function G(Q){return Q&&Q.hasOwnProperty(Se.default.SEGMENT_SEQUENCE_PROPERTIES)&&Q[Se.default.SEGMENT_SEQUENCE_PROPERTIES].length?Q[Se.default.SEGMENT_SEQUENCE_PROPERTIES].map((ee=>{const oe=new Fn(ee);return oe.init(ee),oe})):[]}function U(Q,ee,oe,ae,ie,me){const K=new Xt;(function(xe,Me,Ne,Ge,Ze){if(xe.index=Ze,xe.adaptation=Ne,xe.mediaInfo=Ge,Me.hasOwnProperty(Se.default.ID)&&(xe.id=Me.id),Me.hasOwnProperty(Se.default.CODECS)&&(xe.codecs=Me.codecs,xe.codecFamily=at.default.getCodecFamily(xe.codecs)),Me.hasOwnProperty(Se.default.DEPENDENCY_ID)){const ht=Me[Se.default.DEPENDENCY_ID].toString().split(" ")[0];xe.dependencyId=ht,xe.dependentRepresentation=new Xt,xe.dependentRepresentation.id=ht}Me.hasOwnProperty(Se.default.MIME_TYPE)&&(xe.mimeType=Me[Se.default.MIME_TYPE]),Me.hasOwnProperty(Se.default.CODEC_PRIVATE_DATA)&&(xe.codecPrivateData=Me.codecPrivateData),Me.hasOwnProperty(Se.default.BANDWITH)&&(xe.bandwidth=Me.bandwidth,xe.bitrateInKbit=Me.bandwidth/1e3),Me.hasOwnProperty(Se.default.WIDTH)&&(xe.width=Me.width),Me.hasOwnProperty(Se.default.HEIGHT)&&(xe.height=Me.height),Me.hasOwnProperty(Se.default.SCAN_TYPE)&&(xe.scanType=Me.scanType),Me.hasOwnProperty(Se.default.FRAMERATE)&&(xe.frameRate=re(Me)),Me.hasOwnProperty(Se.default.QUALITY_RANKING)&&(xe.qualityRanking=Me[Se.default.QUALITY_RANKING]),Me.hasOwnProperty(Se.default.MAX_PLAYOUT_RATE)&&(xe.maxPlayoutRate=Me.maxPlayoutRate),xe.essentialProperties=be(Me),xe.supplementalProperties=X(Me),xe.segmentSequenceProperties=G(Me),xe.path=[Ne.period.index,Ne.index,Ze]})(K,ee,oe,Q,me);const{segmentInfo:ge,segmentInfoType:_e}=(function(xe){let Me,Ne;return xe.hasOwnProperty(Se.default.SEGMENT_BASE)?(Me=xe.SegmentBase,Ne=Se.default.SEGMENT_BASE):xe.hasOwnProperty(Se.default.SEGMENT_LIST)?(Me=xe.SegmentList,Ne=Me.hasOwnProperty(Se.default.SEGMENT_TIMELINE)?Se.default.SEGMENT_TIMELINE:Se.default.SEGMENT_LIST):xe.hasOwnProperty(Se.default.SEGMENT_TEMPLATE)?(Me=xe.SegmentTemplate,Ne=Me.hasOwnProperty(Se.default.SEGMENT_TIMELINE)?Se.default.SEGMENT_TIMELINE:Se.default.SEGMENT_TEMPLATE):Ne=Se.default.BASE_URL,{segmentInfo:Me,segmentInfoType:Ne}})(ee);return K.segmentInfoType=_e,(function(xe,Me,Ne,Ge,Ze,ht){if(xe){if(xe.hasOwnProperty(Se.default.INITIALIZATION_MINUS)&&(Ne.initialization=xe.initialization.split("$Bandwidth$").join(Ze.bandwidth).split("$RepresentationID$").join(Ze.id)),xe.hasOwnProperty(Se.default.INITIALIZATION)){const wt=xe.Initialization;wt.hasOwnProperty(Se.default.SOURCE_URL)&&(Ne.initialization=wt.sourceURL),wt.hasOwnProperty(Se.default.RANGE)&&(Ne.range=wt.range)}else B(Ge)&&x(Ge)&&Ge.mimeType&&Ge.mimeType.indexOf("application/mp4")===-1&&(Ne.range=0);xe.hasOwnProperty(Se.default.TIMESCALE)&&(Ne.timescale=xe.timescale),xe.hasOwnProperty(Se.default.DURATION)?Ne.segmentDuration=xe.duration/Ne.timescale:Me===Se.default.SEGMENT_TIMELINE&&(Ne.segmentDuration=(function(wt){if(!wt||!wt.S)return NaN;let Wt=wt.S[0],At=wt.S[1];return Wt.hasOwnProperty("d")?Wt.d:At.t-Wt.t})(xe.SegmentTimeline)/Ne.timescale),xe.hasOwnProperty(Se.default.MEDIA)&&(Ne.media=xe.media),xe.hasOwnProperty(Se.default.START_NUMBER)&&(Ne.startNumber=parseInt(xe.startNumber)),xe.hasOwnProperty(Se.default.INDEX_RANGE)&&(Ne.indexRange=xe.indexRange),xe.hasOwnProperty(Se.default.PRESENTATION_TIME_OFFSET)&&(Ne.presentationTimeOffset=xe.presentationTimeOffset/Ne.timescale),xe.hasOwnProperty(Se.default.AVAILABILITY_TIME_OFFSET)?Ne.availabilityTimeOffset=xe.availabilityTimeOffset:ht&&ht.availabilityTimeOffset!==void 0&&(Ne.availabilityTimeOffset=ht.availabilityTimeOffset),xe.hasOwnProperty(Se.default.AVAILABILITY_TIME_COMPLETE)?Ne.availabilityTimeComplete=xe.availabilityTimeComplete!=="false":ht&&ht.availabilityTimeComplete!==void 0&&(Ne.availabilityTimeComplete=ht.availabilityTimeComplete),xe.hasOwnProperty(Se.default.END_NUMBER)&&(Ne.endNumber=xe[Se.default.END_NUMBER]),Ne.mseTimeOffset=(function(wt){const Wt=wt.presentationTimeOffset;return wt.adaptation.period.start-Wt})(Ne)}})(ge,_e,K,ae,ee,ie),(function(xe){isNaN(xe.width)||isNaN(xe.height)||isNaN(xe.frameRate)||(xe.pixelsPerSecond=Math.max(1,xe.width*xe.height*xe.frameRate),isNaN(xe.bandwidth)||(xe.bitsPerPixel=xe.bandwidth/xe.pixelsPerSecond))})(K),K}function F(Q){return C(Q,l.default.MUXED)?l.default.MUXED:C(Q,l.default.AUDIO)?l.default.AUDIO:(function(ee){return C(ee,l.default.VIDEO)})(Q)?l.default.VIDEO:B(Q)?l.default.TEXT:(function(ee){return C(ee,l.default.IMAGE)})(Q)?l.default.IMAGE:(p.warn("Unknown Preselection stream type"),null)}function ve(Q,ee){if(Q&&Q.hasOwnProperty(Se.default.PRESELECTION_COMPONENTS)&&Array.isArray(ee))return String(Q.preselectionComponents).split(" ").map((oe=>ee.find((ae=>ae.id===oe))))}function te(Q,ee){if(!Q||!Q.hasOwnProperty(Se.default.PRESELECTION_COMPONENTS)||!Array.isArray(ee))return;const oe=String(Q.preselectionComponents).split(" ");return ee.find((ae=>ae.id===oe[0]))}function ke(Q,ee){if(!Q)throw new Error("Period cannot be null or undefined");let oe=_a.DEFAULT_ID+"_"+ee;return Q.hasOwnProperty(Se.default.ID)&&Q.id.toString().length>0&&Q.id!=="__proto__"&&(oe=Q.id.toString()),oe}function Ee(Q,ee,oe){const ae=[];let ie;if(!Q)return ae;for(ie=0;ie<Q.length;ie++){const me=new Fr;if(me.timescale=1,me.representation=ee,!Q[ie].hasOwnProperty(l.default.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");me.schemeIdUri=Q[ie].schemeIdUri,Q[ie].hasOwnProperty(Se.default.TIMESCALE)&&(me.timescale=Q[ie].timescale),Q[ie].hasOwnProperty(Se.default.VALUE)&&(me.value=Q[ie].value),ae.push(me),me.period=oe}return ae}function Re(Q){const ee=[],oe=Q.BaseURL||[Q.baseUri];let ae=!1;return oe.some((ie=>{if(ie){const me=new Xn;let K=ie.__text||ie;return A.isRelative(K)&&(ae=!0,Q.baseUri&&(K=A.resolve(K,Q.baseUri))),me.url=K,ie.hasOwnProperty(Se.default.SERVICE_LOCATION)&&ie.serviceLocation.length?me.serviceLocation=ie.serviceLocation:me.serviceLocation=K,ie.hasOwnProperty(Se.default.DVB_PRIORITY)&&(me.dvbPriority=ie[Se.default.DVB_PRIORITY]),ie.hasOwnProperty(Se.default.DVB_WEIGHT)&&(me.dvbWeight=ie[Se.default.DVB_WEIGHT]),ie.hasOwnProperty(Se.default.AVAILABILITY_TIME_OFFSET)&&(me.availabilityTimeOffset=ie[Se.default.AVAILABILITY_TIME_OFFSET]),ie.hasOwnProperty(Se.default.AVAILABILITY_TIME_COMPLETE)&&(me.availabilityTimeComplete=ie[Se.default.AVAILABILITY_TIME_COMPLETE]!=="false"),ee.push(me),ae}})),ee}function Oe(Q){const ee=new Oa;return ee.serverUrl=Q.__text,Q.hasOwnProperty(Se.default.DEFAULT_SERVICE_LOCATION)&&(ee.defaultServiceLocation=Q[Se.default.DEFAULT_SERVICE_LOCATION],ee.defaultServiceLocationArray=ee.defaultServiceLocation.split(" ")),Q.hasOwnProperty(Se.default.QUERY_BEFORE_START)&&(ee.queryBeforeStart=Q[Se.default.QUERY_BEFORE_START].toLowerCase()==="true"),Q.hasOwnProperty(Se.default.CLIENT_REQUIREMENT)&&(ee.clientRequirement=Q[Se.default.CLIENT_REQUIREMENT].toLowerCase()!=="false"),ee}function Le(Q){const ee=new Da;return Q.hasOwnProperty(Se.default.CMCD_PARAMETERS)&&Q[Se.default.CMCD_PARAMETERS].schemeIdUri===l.default.CTA_5004_2023_SCHEME&&(ee.cmcdParameters=new ca,ee.cmcdParameters.init(Q[Se.default.CMCD_PARAMETERS])),Q.hasOwnProperty(Se.default.SERVICE_LOCATIONS)&&Q[Se.default.SERVICE_LOCATIONS]!==""&&(ee.serviceLocations=Q[Se.default.SERVICE_LOCATIONS],ee.serviceLocationsArray=ee.serviceLocations.toString().split(" ")),Q.hasOwnProperty(Se.default.ADAPTATION_SETS)&&Q[Se.default.ADAPTATION_SETS]!==""&&(ee.adaptationSets=Q[Se.default.ADAPTATION_SETS],ee.adaptationSetsArray=ee.adaptationSets.toString().split(" ")),ee}return b={getAccessibilityForAdaptation:function(Q){return Q&&Q.hasOwnProperty(Se.default.ACCESSIBILITY)&&Q[Se.default.ACCESSIBILITY].length?Q[Se.default.ACCESSIBILITY].map((ee=>{const oe=new ia;return oe.init(ee),oe})):[]},getAdaptationForId:function(Q,ee,oe){const ae=I(ee,oe);let ie,me;for(ie=0,me=ae.length;ie<me;ie++)if(ae[ie].hasOwnProperty(Se.default.ID)&&ae[ie].id===Q)return ae[ie];return null},getAdaptationForIndex:function(Q,ee,oe){const ae=I(ee,oe);return ae.length>0&&N(Q)?ae[Q]:null},getAdaptationsForPeriod:function(Q){const ee=Q&&N(Q.index)?Q.mpd.manifest.Period[Q.index]:null,oe=[];let ae,ie,me;if(ee&&ee.AdaptationSet)for(me=0;me<ee.AdaptationSet.length;me++)ie=ee.AdaptationSet[me],ae=new ra,ie.hasOwnProperty(Se.default.ID)&&(ae.id=ie.id),ae.index=me,ae.period=Q,ae.type=F(ie),oe.push(ae);return oe},getAdaptationsForType:function(Q,ee,oe){const ae=I(Q,ee);let ie,me;const K=[];for(ie=0,me=ae.length;ie<me;ie++)C(ae[ie],oe)&&K.push(q(ae[ie]));return K},getAudioChannelConfigurationForAdaptation:function(Q){return Q&&Q.hasOwnProperty(Se.default.AUDIO_CHANNEL_CONFIGURATION)&&Q[Se.default.AUDIO_CHANNEL_CONFIGURATION].length?Q[Se.default.AUDIO_CHANNEL_CONFIGURATION].map((ee=>{const oe=new ia;return oe.init(ee),oe})):[]},getAudioChannelConfigurationForRepresentation:function(Q){return Q&&Q.hasOwnProperty(Se.default.AUDIO_CHANNEL_CONFIGURATION)&&Q[Se.default.AUDIO_CHANNEL_CONFIGURATION].length?Q[Se.default.AUDIO_CHANNEL_CONFIGURATION].map((ee=>{const oe=new ia;return oe.init(ee),oe})):[]},getAvailabilityStartTime:function(Q){return Q&&Q.hasOwnProperty(Se.default.AVAILABILITY_START_TIME)&&Q.availabilityStartTime!==null?Q.availabilityStartTime.getTime():null},getBandwidth:function(Q){return Q&&Q.bandwidth?Q.bandwidth:NaN},getBaseURLsFromElement:Re,getBitrateListForAdaptation:function(Q){const ee=q(Q);return(ee&&ee.Representation?ee.Representation:[]).map((oe=>({bandwidth:oe.bandwidth,width:oe.width||0,height:oe.height||0,scanType:oe.scanType||null,id:oe.id||null})))},getCodec:D,getCodecForPreselection:function(Q,ee,oe){let ae=null;if(Q&&ee){let ie=D(te(Q,ee),0,oe);if(Q.hasOwnProperty(Se.default.CODECS)){let me=Q.codecs;ae=ie.replace(/(codecs=")[^"]*(")/,`$1${me}$2`),p.info("Preselection has own codecs-attribute: replacing in MainAdaptationSet (was: "+ie+"), new Preselection codec is: "+ae)}else ae=ie}return ae},getCombinedEssentialPropertiesForAdaptationSet:function(Q){return ue(Se.default.ESSENTIAL_PROPERTY,Q)},getCombinedSupplementalPropertiesForAdaptationSet:function(Q){return ue(Se.default.SUPPLEMENTAL_PROPERTY,Q)},getContentProtectionByAdaptation:function(Q){return Z(Q)},getContentProtectionByManifest:function(Q){let ee=[];if(!Q)return ee;const oe=Z(Q);return ee=ee.concat(oe),Q.hasOwnProperty(Se.default.PERIOD)&&Q[Se.default.PERIOD].length>0&&Q[Se.default.PERIOD].forEach((ae=>{const ie=J(ae);ee=ee.concat(ie)})),ee},getContentProtectionByPeriod:J,getContentSteering:function(Q){if(Q&&Q.hasOwnProperty(Se.default.CONTENT_STEERING))return Oe(Q[Se.default.CONTENT_STEERING][0])},getDuration:function(Q){let ee;return ee=Q&&Q.hasOwnProperty(Se.default.MEDIA_PRESENTATION_DURATION)?Q.mediaPresentationDuration:Q&&Q.type==="dynamic"?Number.POSITIVE_INFINITY:Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,ee},getEssentialProperties:be,getEventStreamForAdaptationSet:function(Q,ee,oe){let ae,ie,me;return Q&&Q.Period&&ee&&ee.period&&N(ee.period.index)&&(ie=Q.Period[ee.period.index],ie&&ie.AdaptationSet&&N(ee.index)&&(me=ie.AdaptationSet[ee.index],me&&(ae=me.InbandEventStream))),Ee(ae,null,oe)},getEventStreamForRepresentation:function(Q,ee,oe){let ae,ie,me,K;return Q&&Q.Period&&ee&&ee.adaptation&&ee.adaptation.period&&N(ee.adaptation.period.index)&&(ie=Q.Period[ee.adaptation.period.index],ie&&ie.AdaptationSet&&N(ee.adaptation.index)&&(me=ie.AdaptationSet[ee.adaptation.index],me&&me.Representation&&N(ee.index)&&(K=me.Representation[ee.index],K&&(ae=K.InbandEventStream)))),Ee(ae,ee,oe)},getEventsForPeriod:function(Q){const ee=Q&&Q.mpd&&Q.mpd.manifest?Q.mpd.manifest:null,oe=ee?ee.Period:null,ae=oe&&Q&&N(Q.index)?oe[Q.index].EventStream:null,ie=[];let me,K;if(ae)for(me=0;me<ae.length;me++){const ge=new Fr;if(ge.period=Q,ge.timescale=1,!ae[me].hasOwnProperty(l.default.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");for(ge.schemeIdUri=ae[me][l.default.SCHEME_ID_URI],ae[me].hasOwnProperty(Se.default.TIMESCALE)&&(ge.timescale=ae[me][Se.default.TIMESCALE]),ae[me].hasOwnProperty(Se.default.VALUE)&&(ge.value=ae[me][Se.default.VALUE]),ae[me].hasOwnProperty(Se.default.PRESENTATION_TIME_OFFSET)&&(ge.presentationTimeOffset=ae[me][Se.default.PRESENTATION_TIME_OFFSET]),K=0;ae[me].Event&&K<ae[me].Event.length;K++){const _e=ae[me].Event[K],xe=new da;xe.presentationTime=0,xe.eventStream=ge,_e.hasOwnProperty(Se.default.PRESENTATION_TIME)&&(xe.presentationTime=_e.presentationTime);const Me=ge.presentationTimeOffset?ge.presentationTimeOffset/ge.timescale:0;xe.calculatedPresentationTime=xe.presentationTime/ge.timescale+Q.start-Me,_e.hasOwnProperty(Se.default.DURATION)&&(xe.duration=_e.duration/ge.timescale),_e.hasOwnProperty(Se.default.ID)?xe.id=parseInt(_e.id):xe.id=null,_e.Signal&&_e.Signal.Binary&&_e.Signal.Binary.__text?xe.messageData=T.decodeArray(_e.Signal.Binary.__text.toString()):xe.messageData=_e.messageData||_e.__cdata||_e.__text,ie.push(xe)}}return ie},getFramerate:re,getId:function(Q){return Q&&Q[Se.default.ID]||null},getIndexForAdaptation:function(Q,ee,oe){if(!Q)return-1;const ae=I(ee,oe);for(let ie=0;ie<ae.length;ie++)if((0,ft.default)(w).getInstance().areEqual(ae[ie],Q))return ie;return-1},getIsDynamic:V,getIsFragmented:x,getIsText:B,getIsTypeOf:C,getLabelsForAdaptation:function(Q){if(!Q||!Q.Label)return[];const ee=[];for(let oe=0;oe<Q.Label.length;oe++)ee.push({lang:Q.Label[oe].lang,text:Q.Label[oe].__text||Q.Label[oe]});return ee},getLanguageForAdaptation:function(Q){let ee="";return Q&&Q.hasOwnProperty(Se.default.LANG)&&(ee=Q.lang),ee},getLocation:function(Q){return Q&&Q.hasOwnProperty(Se.default.LOCATION)?Q[Se.default.LOCATION].map((ee=>{const oe=ee.__text||ee,ae=ee.hasOwnProperty(Se.default.SERVICE_LOCATION)?ee[Se.default.SERVICE_LOCATION]:null;return new wr(oe,ae)})):[]},getMainAdaptationSetForPreselection:te,getCommonRepresentationForPreselection:function(Q,ee){if(!Q||!Array.isArray(ee))return;const oe=te(Q,ee);return oe?oe.Representation[0]:void 0},getManifestUpdatePeriod:function(Q,ee=0){let oe=NaN;return Q&&Q.hasOwnProperty(Se.default.MINIMUM_UPDATE_PERIOD)&&(oe=Q.minimumUpdatePeriod),isNaN(oe)?oe:Math.max(oe-ee,1)},getMimeType:function(Q){return Q&&Q.Representation&&Q.Representation.length>0?Q.Representation[0].mimeType:null},getMpd:function(Q){const ee=new tr;return Q&&(ee.manifest=Q,Q.hasOwnProperty(Se.default.AVAILABILITY_START_TIME)?ee.availabilityStartTime=new Date(Q.availabilityStartTime.getTime()):Q.loadedTime&&(ee.availabilityStartTime=new Date(Q.loadedTime.getTime())),Q.hasOwnProperty(Se.default.AVAILABILITY_END_TIME)&&(ee.availabilityEndTime=new Date(Q.availabilityEndTime.getTime())),Q.hasOwnProperty(Se.default.MINIMUM_UPDATE_PERIOD)&&(ee.minimumUpdatePeriod=Q.minimumUpdatePeriod),Q.hasOwnProperty(Se.default.MEDIA_PRESENTATION_DURATION)&&(ee.mediaPresentationDuration=Q.mediaPresentationDuration),Q.hasOwnProperty(Se.default.SUGGESTED_PRESENTATION_DELAY)&&(ee.suggestedPresentationDelay=Q.suggestedPresentationDelay),Q.hasOwnProperty(Se.default.TIMESHIFT_BUFFER_DEPTH)&&(ee.timeShiftBufferDepth=Q.timeShiftBufferDepth),Q.hasOwnProperty(Se.default.MAX_SEGMENT_DURATION)&&(ee.maxSegmentDuration=Q.maxSegmentDuration),Q.hasOwnProperty(Se.default.PUBLISH_TIME)&&(ee.publishTime=new Date(Q.publishTime))),ee},getPatchLocation:function(Q){return Q&&Q.hasOwnProperty(Se.default.PATCH_LOCATION)?Q[Se.default.PATCH_LOCATION].map((ee=>{const oe=ee.__text||ee,ae=ee.hasOwnProperty(Se.default.SERVICE_LOCATION)?ee[Se.default.SERVICE_LOCATION]:null;let ie=ee.hasOwnProperty(Se.default.TTL)?1e3*parseFloat(ee[Se.default.TTL]):NaN;return new La(oe,ae,ie)})):[]},getPreselectionIsTypeOf:function(Q,ee,oe){if(!Q)throw new Error("preselection is not defined");if(!ee)throw new Error("adaptations is not defined");if(!oe)throw new Error("type is not defined");const ae=te(Q,ee);return!!ae&&C(ae,oe)},getPreselectionsForPeriod:function(Q){const ee=Q&&N(Q.index)?Q.mpd.manifest.Period[Q.index]:null,oe=[];let ae,ie,me;if(ee&&ee.Preselection)for(me=0;me<ee.Preselection.length;me++){ie=ee.Preselection[me],ae=new ur;const K=ve(ie,ee.AdaptationSet);K.every((ge=>!!ge))&&K.length===1?(ie.hasOwnProperty(Se.default.ID)&&(ae.id=ie.id),ae.index=me,ae.period=Q,ie.hasOwnProperty(Se.default.TAG)&&(ae.tag=ie.tag),ie.hasOwnProperty(Se.default.PRESELECTION_COMPONENTS)?ae.preselectionComponents=K:p.warn("Preselection (index: "+ae.index+") missing component(s)"),ie.hasOwnProperty(Se.default.ORDER)&&(ae.order=ie.order),ae.type=F(K[0]),oe.push(ae)):p.warn("Preselection removed because we don't support multi-representation preselections or not all components available.")}return oe},getProducerReferenceTimesForAdaptation:function(Q){const ee=Q&&Q.hasOwnProperty(Se.default.PRODUCER_REFERENCE_TIME)?Q[Se.default.PRODUCER_REFERENCE_TIME]:[];(Q&&Q.hasOwnProperty(Se.default.REPRESENTATION)?Q[Se.default.REPRESENTATION]:[]).forEach((ae=>{ae.hasOwnProperty(Se.default.PRODUCER_REFERENCE_TIME)&&ee.push(...ae[Se.default.PRODUCER_REFERENCE_TIME])}));const oe=[];return ee.forEach((ae=>{const ie=new Dt;ae.hasOwnProperty(Se.default.ID)&&(ie[Se.default.ID]=parseInt(ae[Se.default.ID]),ae.hasOwnProperty(Se.default.WALL_CLOCK_TIME)&&(ie[Se.default.WALL_CLOCK_TIME]=ae[Se.default.WALL_CLOCK_TIME],ae.hasOwnProperty(Se.default.PRESENTATION_TIME)&&(ie[Se.default.PRESENTATION_TIME]=ae[Se.default.PRESENTATION_TIME],ae.hasOwnProperty(Se.default.INBAND)&&(ie[Se.default.INBAND]=ae[Se.default.INBAND]!=="false"),ae.hasOwnProperty(Se.default.TYPE)&&(ie[Se.default.TYPE]=ae[Se.default.TYPE]),oe.push(ie))))})),oe},getPublishTime:function(Q){return Q&&Q.hasOwnProperty(Se.default.PUBLISH_TIME)?new Date(Q[Se.default.PUBLISH_TIME]):null},getRealPeriodForIndex:function(Q,ee){const oe=P(ee);return oe.length>0&&N(Q)?oe[Q]:null},getRealPeriods:P,getRegularPeriods:function(Q){const ee=!!Q&&V(Q.manifest),oe=[];let ae,ie,me=null,K=null,ge=null,_e=null;for(ie=0,ae=Q&&Q.manifest&&Q.manifest.Period?Q.manifest.Period.length:0;ie<ae;ie++)K=Q.manifest.Period[ie],K.hasOwnProperty(Se.default.START)?(_e=new _a,_e.start=K.start):me!==null&&me.hasOwnProperty(Se.default.DURATION)&&ge!==null?(_e=new _a,_e.start=parseFloat((ge.start+ge.duration).toFixed(5))):ie!==0||ee||(_e=new _a,_e.start=0),ge!==null&&isNaN(ge.duration)&&(_e!==null?ge.duration=parseFloat((_e.start-ge.start).toFixed(5)):p.warn("First period duration could not be calculated because lack of start and duration period properties. This will cause timing issues during playback")),_e!==null&&(_e.id=ke(K,ie),_e.index=ie,_e.mpd=Q,_e.isEncrypted=$(K),K.hasOwnProperty(Se.default.DURATION)&&(_e.duration=K.duration),ge&&(ge.nextPeriodId=_e.id),oe.push(_e),me=K,ge=_e),K=null,_e=null;return oe.length===0||ge!==null&&isNaN(ge.duration)&&(ge.duration=parseFloat(((function(xe){(function(){if(!v||!v.hasOwnProperty("error"))throw new Error(l.default.MISSING_CONFIG_ERROR)})();const Me=V(xe.mpd.manifest);let Ne;return xe.mpd.manifest.mediaPresentationDuration?Ne=xe.mpd.manifest.mediaPresentationDuration:xe.duration?Ne=xe.duration:Me?Ne=Number.POSITIVE_INFINITY:v.error(new Bt.default(Yt.MANIFEST_ERROR_ID_PARSE_CODE,"Must have @mediaPresentationDuration on MPD or an explicit @duration on the last period.",xe)),Ne})(ge)-ge.start).toFixed(5))),oe},getRepresentationCount:function(Q){return Q&&Q.Representation?Q.Representation.length:0},getRepresentationFor:function(Q,ee){return ee&&ee.Representation&&ee.Representation.length>0&&N(Q)?ee.Representation[Q]:null},getRepresentationSortFunction:function(){return(Q,ee)=>Q.bandwidth-ee.bandwidth},getRepresentationsForAdaptation:function(Q,ee){const oe=[],ae=(function(me){if(me&&me.period&&N(me.period.index)){const K=me.period.mpd.manifest.Period[me.period.index];if(K&&K.AdaptationSet&&N(me.index))return q(K.AdaptationSet[me.index])}})(Q);let ie;if(ae&&ae.Representation){if(Q&&Q.period&&N(Q.period.index)){const me=Re(Q.period.mpd.manifest);me&&(ie=me[0])}for(let me=0,K=ae.Representation.length;me<K;++me){const ge=U(ee,ae.Representation[me],Q,ae,ie,me);oe.push(ge)}}return oe},getRolesForAdaptation:function(Q){return Q&&Q.hasOwnProperty(Se.default.ROLE)&&Q[Se.default.ROLE].length?Q[Se.default.ROLE].map((ee=>{ee.schemeIdUri===l.default.DASH_ROLE_SCHEME_ID&&ee.value==="Main"&&(ee.value=Se.default.MAIN);const oe=new ia;return oe.init(ee),oe})):[]},getSegmentAlignment:function(Q){return!(!Q||!Q.hasOwnProperty(Se.default.SEGMENT_ALIGNMENT))&&Q[Se.default.SEGMENT_ALIGNMENT]==="true"},getSegmentSequencePropertiesForAdaptationSet:function(Q){const ee=[];return Q&&(ee.push(...G(Q)),Q.Representation&&Q.Representation.length&&Q.Representation.forEach((oe=>{ee.push(...G(oe))}))),ee},getSelectionPriority:function(Q){try{const ee=Q&&Q.selectionPriority!==void 0?parseInt(Q.selectionPriority):1;return isNaN(ee)?1:ee}catch{return 1}},getServiceDescriptions:function(Q){const ee=[];if(Q&&Q.hasOwnProperty(Se.default.SERVICE_DESCRIPTION))for(const oe of Q.ServiceDescription){let ae=null,ie=null,me=null,K=null,ge=null,_e=null,xe=null,Me=null;for(const Ne in oe)if(oe.hasOwnProperty(Ne))if(Ne===Se.default.ID)ae=oe[Ne];else if(Ne===Se.default.SERVICE_DESCRIPTION_SCOPE)ie=oe[Ne].schemeIdUri;else if(Ne===Se.default.SERVICE_DESCRIPTION_LATENCY)me={target:parseInt(oe[Ne].target),max:parseInt(oe[Ne].max),min:parseInt(oe[Ne].min),referenceId:parseInt(oe[Ne].referenceId)};else if(Ne===Se.default.SERVICE_DESCRIPTION_PLAYBACK_RATE)K={max:parseFloat(oe[Ne].max),min:parseFloat(oe[Ne].min)};else if(Ne===Se.default.SERVICE_DESCRIPTION_OPERATING_QUALITY)ge={mediaType:oe[Ne].mediaType,max:parseInt(oe[Ne].max),min:parseInt(oe[Ne].min),target:parseInt(oe[Ne].target),type:oe[Ne].type,maxQualityDifference:parseInt(oe[Ne].maxQualityDifference)};else if(Ne===Se.default.SERVICE_DESCRIPTION_OPERATING_BANDWIDTH)_e={mediaType:oe[Ne].mediaType,max:parseInt(oe[Ne].max),min:parseInt(oe[Ne].min),target:parseInt(oe[Ne].target)};else if(Ne===Se.default.CONTENT_STEERING){let Ge=oe[Ne];Ge=Array.isArray(Ge)?Ge.at(Ge.length-1):Ge,xe=Oe(Ge)}else Ne===Se.default.CLIENT_DATA_REPORTING&&(Me=Le(oe[Ne]));ee.push({id:ae,schemeIdUri:ie,latency:me,playbackRate:K,operatingQuality:ge,operatingBandwidth:_e,contentSteering:xe,clientDataReporting:Me})}return ee},getSubSegmentAlignment:function(Q){return!(!Q||!Q.hasOwnProperty(Se.default.SUB_SEGMENT_ALIGNMENT))&&Q[Se.default.SUB_SEGMENT_ALIGNMENT]==="true"},getSuggestedPresentationDelay:function(Q){return Q&&Q.hasOwnProperty(Se.default.SUGGESTED_PRESENTATION_DELAY)?Q.suggestedPresentationDelay:null},getSupplementalProperties:X,getUTCTimingSources:function(Q){const ee=V(Q),oe=!!Q&&Q.hasOwnProperty(Se.default.AVAILABILITY_START_TIME),ae=Q?Q.UTCTiming:null,ie=[];return(ee||oe)&&ae&&ae.forEach((function(me){const K=new $n.default;me.hasOwnProperty(l.default.SCHEME_ID_URI)&&(K.schemeIdUri=me.schemeIdUri,me.hasOwnProperty(Se.default.VALUE)&&(K.value=me.value.toString(),ie.push(K)))})),ie},getViewpointForAdaptation:function(Q){return Q&&Q.hasOwnProperty(Se.default.VIEWPOINT)&&Q[Se.default.VIEWPOINT].length?Q[Se.default.VIEWPOINT].map((ee=>{const oe=new ia;return oe.init(ee),oe})):[]},hasProfile:function(Q,ee){let oe=!1;return Q&&Q.profiles&&Q.profiles.length>0&&(oe=Q.profiles.indexOf(ee)!==-1),oe},isPeriodEncrypted:$,setConfig:function(Q){Q&&(Q.errHandler&&(v=Q.errHandler),Q.BASE64&&(T=Q.BASE64))}},p=(0,c.default)(w).getInstance().getLogger(b),b}zn.__dashjs_factory_name="DashManifestModel";var xn=n.default.getSingletonFactory(zn);const Yn="utf-16",ma="utf-16be",ga="utf-16le",Pa="utf-8";function Ga(b,p){if(b<0)return-Ga(-b,p);const v=Math.pow(10,p);if(Math.abs(b*v%1-.5)<Number.EPSILON){const T=Math.floor(b*v);return(T%2==0?T:T+1)/v}return Math.round(b*v)/v}const dr=/&(?:amp|lt|gt|quot|apos|nbsp|lrm|rlm|#[xX]?[0-9a-fA-F]+);/g;function za(b){return b.indexOf("&")===-1?b:b.replace(dr,(p=>{switch(p){case"&amp;":return"&";case"&lt;":return"<";case"&gt;":return">";case"&quot;":return'"';case"&apos;":return"'";case"&nbsp;":return"Â ";case"&lrm;":return"â€Ž";case"&rlm;":return"â€";default:if(p[1]==="#"){const v=p[2]==="x"||p[2]==="X"?parseInt(p.slice(3),16):parseInt(p.slice(2),10);return String.fromCodePoint(v)}return p}}))}var Aa=class sl{constructor(p,v){Array.isArray(p)&&(p=p.map((T=>T instanceof sl?T:new sl(T)))),this.value=p,this.params=v}};const Ar="Dict";function fa(b,p){return{value:b,src:p}}function Wi(b,p,v,T){return new Error(`failed to ${b} "${w=p,Array.isArray(w)?JSON.stringify(w):w instanceof Map?"Map{}":w instanceof Set?"Set{}":typeof w=="object"?JSON.stringify(w):String(w)}" as ${v}`,{cause:T});var w}function Vn(b,p,v){return Wi("parse",b,p,v)}const vi="Inner List",Ti="Bare Item",wi="Boolean",_i="Byte Sequence",Qi="Date",Ai="Decimal",Xi="Integer",Wn=`${Xi} or ${Ai}`;function Sr(b){return b<-999999999999999||999999999999999<b}function qr(b){let p,v=1,T="";const w=Vn(b,Wn);if(b[0]==="-"&&(v=-1,b=b.substring(1)),b.length<=0)throw w;const A=/^(\d+)?/g,N=A.exec(b);if(N[0].length===0)throw w;if(T+=N[1],(b=b.substring(A.lastIndex))[0]==="."){if(T.length>12)throw w;const C=/^(\.\d+)?/g,x=C.exec(b);if(b=b.substring(C.lastIndex),x[0].length===0||x[1].length>4||(T+=x[1],T.length>16))throw w;p=parseFloat(T)*v}else{if(T.length>15)throw w;if(p=parseInt(T)*v,Sr(p))throw Vn(T,Wn)}return fa(p,b)}const Ua="String",Ji=/[\x00-\x1f\x7f]+/;var Sa=class{constructor(b){this.description=b}};const Zi="Token";function Ya(b,p){const v=b[0];if(v==='"')return(function(T){let w="",A=0;if(T[A]!=='"')throw Vn(T,Ua);for(A++;T.length>A;){if(T[A]==="\\"){if(T.length<=A+1||(A++,T[A]!=='"'&&T[A]!=="\\"))throw Vn(T,Ua);w+=T[A]}else{if(T[A]==='"')return fa(w,T.substring(++A));if(Ji.test(T[A]))throw Vn(T,Ua);w+=T[A]}A++}throw Vn(T,Ua)})(b);if(/^[-0-9]/.test(v))return qr(b);if(v==="?")return(function(T){let w=0;if(T[w]!=="?")throw Vn(T,wi);if(w++,T[w]==="1")return fa(!0,T.substring(++w));if(T[w]==="0")return fa(!1,T.substring(++w));throw Vn(T,wi)})(b);if(v===":")return(function(T){if(T[0]!==":"||(T=T.substring(1)).includes(":")===!1)throw Vn(T,_i);const w=/(^.*?)(:)/g,A=w.exec(T)[1];return T=T.substring(w.lastIndex),fa(new Uint8Array([...atob(A)].map((N=>N.charCodeAt(0)))),T)})(b);if(/^[a-zA-Z*]/.test(v))return(function(T,w){if(/^[a-zA-Z*]$/.test(T[0])===!1)throw Vn(T,Zi);const A=/^([!#$%&'*+\-.^_`|~\w:/]+)/g,N=A.exec(T)[1];return T=T.substring(A.lastIndex),fa(Symbol.for(N),T)})(b);if(v==="@")return(function(T){let w=0;if(T[w]!=="@")throw Vn(T,Qi);w++;const A=qr(T.substring(w));if(Number.isInteger(A.value)===!1)throw Vn(T,Qi);return fa(new Date(1e3*A.value),A.src)})(b);throw Vn(b,Ti)}const wl="Key";function _l(b){let p=0;if(/^[a-z*]$/.test(b[p])===!1)throw Vn(b,wl);let v="";for(;b.length>p;){if(/^[a-z0-9_\-.*]$/.test(b[p])===!1)return fa(v,b.substring(p));v+=b[p],p++}return fa(v,b.substring(p))}function Qs(b,p){let v;for(;b.length>0&&b[0]===";";){const T=_l(b=b.substring(1).trim()),w=T.value;let A=!0;if((b=T.src)[0]==="="){const N=Ya(b=b.substring(1));A=N.value,b=N.src}v==null&&(v={}),v[w]=A}return fa(v,b)}function Al(b,p){const v=Ya(b),T=Qs(b=v.src);return b=T.src,fa(new Aa(v.value,T.value),b)}function Sl(b,p){return b[0]==="("?(function(v,T){if(v[0]!=="(")throw Vn(v,vi);v=v.substring(1);const w=[];for(;v.length>0;){if((v=v.trim())[0]===")"){const N=Qs(v=v.substring(1));return fa(new Aa(w,N.value),N.src)}const A=Al(v);if(w.push(A.value),(v=A.src)[0]!==" "&&v[0]!==")")throw Vn(v,vi)}throw Vn(v,vi)})(b):Al(b)}const es="List";function nr(b,p,v){return Wi("serialize",b,p,v)}function kl(b){if(Sr(b))throw nr(b,Xi);return b.toString()}function Vf(b){const p=Ga(b,3);if(Math.floor(Math.abs(p)).toString().length>12)throw nr(b,Ai);const v=p.toString();return v.includes(".")?v:`${v}.0`}function Il(b){return b.description||b.toString().slice(7,-1)}function Rl(b){const p=Il(b);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(p)===!1)throw nr(p,Zi);return p}function Xs(b){switch(typeof b){case"number":if(!Number.isFinite(b))throw nr(b,Ti);return Number.isInteger(b)?kl(b):Vf(b);case"string":return(function(p){if(Ji.test(p))throw nr(p,Ua);return`"${p.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`})(b);case"symbol":return Rl(b);case"boolean":return(function(p){if(typeof p!="boolean")throw nr(p,wi);return p?"?1":"?0"})(b);case"object":if(b instanceof Date)return(function(p){return`@${kl(p.getTime()/1e3)}`})(b);if(b instanceof Uint8Array)return(function(p){if(ArrayBuffer.isView(p)===!1)throw nr(p,_i);return`:${v=p,btoa(String.fromCharCode(...v))}:`;var v})(b);if(b instanceof Sa)return Rl(b);default:throw nr(b,Ti)}}function Js(b){if(/^[a-z*][a-z0-9\-_.*]*$/.test(b)===!1)throw nr(b,wl);return b}function Zs(b){return b==null?"":Object.entries(b).map((([p,v])=>v===!0?`;${Js(p)}`:`;${Js(p)}=${Xs(v)}`)).join("")}function xl(b){return b instanceof Aa?`${Xs(b.value)}${Zs(b.params)}`:Xs(b)}function Cl(b,p){return(function(v,T={whitespace:!0}){if(typeof v!="object"||v==null)throw nr(v,Ar);const w=v instanceof Map?v.entries():Object.entries(v),A=T?.whitespace?" ":"";return Array.from(w).map((([N,C])=>{C instanceof Aa==0&&(C=new Aa(C));let x=Js(N);return C.value===!0?x+=Zs(C.params):(x+="=",Array.isArray(C.value)?x+=(function(B){return`(${B.value.map(xl).join(" ")})${Zs(B.params)}`})(C):x+=xl(C)),x})).join(`,${A}`)})(b,p)}const Ll={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Ka="CMCD-Object",oa="CMCD-Request",kr="CMCD-Session",fr="CMCD-Status",Wf={br:Ka,ab:Ka,d:Ka,ot:Ka,tb:Ka,tpb:Ka,lb:Ka,tab:Ka,lab:Ka,url:Ka,pb:oa,bl:oa,tbl:oa,dl:oa,ltc:oa,mtp:oa,nor:oa,nrr:oa,rc:oa,sn:oa,sta:oa,su:oa,ttfb:oa,ttfbb:oa,ttlb:oa,cmsdd:oa,cmsds:oa,smrt:oa,df:oa,cs:oa,ts:oa,cid:kr,pr:kr,sf:kr,sid:kr,st:kr,v:kr,msd:kr,bs:fr,bsd:fr,cdn:fr,rtp:fr,bg:fr,pt:fr,ec:fr,e:fr},eo={OBJECT:Ka,REQUEST:oa,SESSION:kr,STATUS:fr},Pl="event",ts=b=>Math.round(b),to=(b,p)=>Array.isArray(b)?b.map((v=>to(v,p))):b instanceof Aa&&typeof b.value=="string"?new Aa(to(b.value,p),b.params):(p.baseUrl&&(b=(function(v,T){const w=new URL(v),A=new URL(T);if(w.origin!==A.origin)return v;const N=w.pathname.split("/").slice(1),C=A.pathname.split("/").slice(1,-1),x=Math.min(N.length,C.length);for(let B=0;B<x&&N[B]===C[B];B++)N.shift(),C.shift();for(;C.length;)C.shift(),N.unshift("..");return N.join("/")+w.search+w.hash})(b,p.baseUrl)),p.version===1?encodeURIComponent(b):b),ns=b=>100*ts(b/100),Qf={br:ts,d:ts,bl:ns,dl:ns,mtp:ns,nor:(b,p)=>{let v=b;return p.version>=2&&(b instanceof Aa&&typeof b.value=="string"?v=new Aa([b]):typeof b=="string"&&(v=[b])),to(v,p)},rtp:ns,tb:ts},Nl="request",no=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],Ml=["e"],ao=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"],Xf=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function ro(b){return Xf.test(b)}const Dl=["d","dl","nor","ot","rtp","su"],Ol=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function Jf(b){return Ol.includes(b)||ro(b)}const Zf={[Pl]:function(b){return no.includes(b)||Ml.includes(b)||ao.includes(b)||ro(b)},[Nl]:function(b){return no.includes(b)||Dl.includes(b)||ro(b)}};function zl(b,p={}){const v={};if(b==null||typeof b!="object")return v;const T=p.version||b.v||1,w=p.reportingMode||Nl,A=T===1?Jf:Zf[w];let N=Object.keys(b).filter(A);b.e&&b.e!=="rr"&&(N=N.filter((I=>!(function(P){return ao.includes(P)})(I))));const C=p.filter;typeof C=="function"&&(N=N.filter(C));const x=w===Pl;x&&!N.includes("ts")&&N.push("ts"),T>1&&!N.includes("v")&&N.push("v");const B=Object.assign({},Qf,p.formatters),q={version:T,reportingMode:w,baseUrl:p.baseUrl};return N.sort().forEach((I=>{let P=b[I];const D=B[I];if(typeof D=="function"&&(P=D(P,q)),I==="v"){if(T===1)return;P=T}I=="pr"&&P===1||(x&&I==="ts"&&!Number.isFinite(P)&&(P=Date.now()),(function($){return typeof $=="number"?Number.isFinite($):$!=null&&$!==""&&$!==!1})(P)&&((function($){return["ot","sf","st","e","sta"].includes($)})(I)&&typeof P=="string"&&(P=new Sa(P)),v[I]=P))})),v}function eh(b,p={}){const v={};if(!b)return v;const T=(function(w,A){const N={};if(!w)return N;const C=Object.keys(w),x=A?(B=A,Object.keys(B).reduce(((q,I)=>(B[I]?.forEach((P=>q[P]=I)),q)),{})):{};var B;return C.reduce(((q,I)=>{const P=Wf[I]||x[I]||eo.REQUEST;return(q[P]??={})[I]=w[I],q}),N)})(zl(b,p),p?.customHeaderMap);return Object.entries(T).reduce(((w,[A,N])=>{const C=Cl(N,{whitespace:!1});return C&&(w[A]=C),w}),v)}const th=new Set([...Ol,...no,...Dl,...ao,...Ml]),ar=(Array.from(th),Ll),Ul={DASH:"d",HLS:"h",SMOOTH:"s",OTHER:"o"},Bl={VOD:"v",LIVE:"l"},Fl="segment";function ql(){let b,p,v,T,w,A,N,C,x,B,q,I,P,D,$,J,Z=this.context,V=(0,y.default)(Z).getInstance(),re=(0,h.default)(Z).getInstance(),le=(0,c.default)(Z).getInstance();function ue(){T={pr:1,nor:null,st:null,sf:null,sid:`${at.default.generateUuid()}`,cid:null},P={},I={},D={},q=void 0,$=void 0,J=!1,U()}function be(){U()}function X(){$||($=Date.now())}function G(){$&&!T.msd&&(T.msd=Date.now()-$)}function U(){if(!N)return;const ie=N.getStreamController();if(!ie||typeof ie.getActiveStream!="function")return;const me=ie.getActiveStream();me&&(B=me.getStreamProcessors())}function F(ie){try{const me=te(),K=me.version?me.keys:re.get().streaming.cmcd.enabledKeys;return Object.keys(ie).filter((ge=>K.includes(ge))).reduce(((ge,_e)=>(ge[_e]=ie[_e],ge)),{})}catch{return ie}}function ve(){const ie=te();return(function(me){if(Object.keys(me).length){if(parseInt(me.version)!==1)return v.error("version parameter must be defined in 1."),!1;if(!me.keys)return v.error("keys parameter must be defined."),!1}const K=me.version,ge=re.get().streaming.cmcd&&re.get().streaming.cmcd.enabled;return K||ge})(ie)&&(function(me){let K=re.get().streaming.cmcd.includeInRequests;me.version&&(K=me.includeInRequests??[Fl]);const ge=l.default.CMCD_AVAILABLE_REQUESTS,_e=K.filter((xe=>!ge.includes(xe)));return _e.length===K.length?(v.error("None of the request types are supported."),!1):(_e.map((xe=>{v.warn(`request type ${xe} is not supported.`)})),!0)})(ie)&&(function(me){const K=l.default.CMCD_AVAILABLE_KEYS,ge=l.default.CMCD_V2_AVAILABLE_KEYS,_e=me.version?me.keys:re.get().streaming.cmcd.enabledKeys,xe=re.get().streaming.cmcd.version,Me=_e.filter((Ne=>!(K.includes(Ne)||xe===2&&ge.includes(Ne))));return Me.length===_e.length&&_e.length>0?(v.error(`None of the keys are implemented for CMCD version ${xe}.`),!1):(Me.map((Ne=>{v.warn(`key parameter ${Ne} is not implemented for CMCD version ${xe}.`)})),!0)})(ie)}function te(){let ie={};if(C){const me=C.getServiceDescriptionSettings();re.get().streaming.cmcd.applyParametersFromMpd&&me.clientDataReporting&&me.clientDataReporting.cmcdParameters&&(ie=me.clientDataReporting.cmcdParameters)}return ie}function ke(ie){try{let K=null;if(ie.type,(me=ie.mediaType)!==l.default.VIDEO&&me!==l.default.AUDIO||q&&q!=l.default.AUDIO||(q=me),(function(ge){const _e=te();let xe=re.get().streaming.cmcd.includeInRequests;_e.version&&(xe=_e.includeInRequests?_e.includeInRequests:[Fl]);const Me={[ye.HTTPRequest.INIT_SEGMENT_TYPE]:"segment",[ye.HTTPRequest.MEDIA_SEGMENT_TYPE]:"segment",[ye.HTTPRequest.XLINK_EXPANSION_TYPE]:"xlink",[ye.HTTPRequest.MPD_TYPE]:"mpd",[ye.HTTPRequest.CONTENT_STEERING_TYPE]:"steering",[ye.HTTPRequest.OTHER_TYPE]:"other"};return xe.some((Ne=>Me[ge]===Ne))})(ie.type)){if(ie.type===ye.HTTPRequest.MPD_TYPE)return(function(){const ge=Oe();return ge.ot=ar.MANIFEST,ge})();if(ie.type===ye.HTTPRequest.MEDIA_SEGMENT_TYPE)return Re(ie.mediaType),Ee(ie,ie.mediaType);if(ie.type===ye.HTTPRequest.INIT_SEGMENT_TYPE)return(function(){const ge=Oe();return ge.ot=ar.INIT,ge.su=!0,ge})();if(ie.type===ye.HTTPRequest.OTHER_TYPE||ie.type===ye.HTTPRequest.XLINK_EXPANSION_TYPE)return(function(){const ge=Oe();return ge.ot=ar.OTHER,ge})();if(ie.type===ye.HTTPRequest.LICENSE)return(function(){const ge=Oe();return ge.ot=ar.KEY,ge})();if(ie.type===ye.HTTPRequest.CONTENT_STEERING_TYPE)return(function(ge){const _e=q?Ee(ge,q):Oe();return _e.ot=ar.OTHER,_e})(ie)}return K}catch{return null}var me}function Ee(ie,me){Re(me);const K=Oe(),ge=(function(At){try{return parseInt(At.bandwidth/1e3)}catch{return null}})(ie),_e=(function(At){try{return isNaN(At.duration)?NaN:Math.round(1e3*At.duration)}catch{return null}})(ie),xe=(function(At){try{return 100*parseInt(x.getSafeAverageThroughput(At)/100)}catch{return null}})(me),Me=(function(At){try{const Vt=T.pr,on=A.getCurrentBufferLevel(At);return isNaN(Vt)||isNaN(on)?null:100*parseInt(on/Vt*10)}catch{return null}})(me),Ne=Le(me),Ge=(function(At){try{const Vt=w.getPossibleVoRepresentationsFilteredBySettings(At).map((on=>on.bitrateInKbit));return Math.max(...Vt)}catch{return null}})(ie.representation?.mediaInfo),Ze=T.pr,ht=(function(At){if(B&&B.length!==0){for(let Vt of B)if(Vt.getType()===At)return Vt.probeNextRequest()}})(me);let wt;me===l.default.VIDEO&&(wt=ar.VIDEO),me===l.default.AUDIO&&(wt=ar.AUDIO),ie.mediaType===l.default.ENHANCEMENT&&(wt=ar.OTHER),me===l.default.TEXT&&(wt=ie.representation.mediaInfo.mimeType==="application/mp4"?ar.TIMED_TEXT:ar.CAPTION);let Wt=re.get().streaming.cmcd.rtp;return Wt||(Wt=(function(At){try{let Vt=N.getPlaybackRate();Vt||(Vt=1);let{bandwidth:on,mediaType:kn,representation:vn,duration:cn}=At;if(!vn.mediaInfo)return NaN;let pn=Le(kn);pn===0&&(pn=500);let We=on*cn/1e3/(pn/Vt/1e3),pt=re.get().streaming.cmcd.rtpSafetyFactor&&!isNaN(re.get().streaming.cmcd.rtpSafetyFactor)?re.get().streaming.cmcd.rtpSafetyFactor:5;return 100*(parseInt(We*pt/100)+1)}catch{return NaN}})(ie)),isNaN(Wt)||(K.rtp=Wt),ht&&(ie.url!==ht.url?K.nor=encodeURIComponent(at.default.getRelativeUrl(ie.url,ht.url)):ht.range&&(K.nrr=ht.range)),ge&&(K.br=ge),wt&&(K.ot=wt),isNaN(_e)||(K.d=_e),isNaN(xe)||(K.mtp=xe),isNaN(Me)||(K.dl=Me),isNaN(Ne)||(K.bl=Ne),isNaN(Ge)||(K.tb=Ge),isNaN(Ze)||Ze===1||(K.pr=Ze),P[me]&&(K.bs=!0,P[me]=!1),!I[me]&&D[me]||(K.su=!0,I[me]=!1,D[me]=!0),K}function Re(ie){D.hasOwnProperty(ie)||(D[ie]=!1),I.hasOwnProperty(ie)||(I[ie]=!1),P.hasOwnProperty(ie)||(P[ie]=!1)}function Oe(){const ie=te(),me={};let K=re.get().streaming.cmcd.cid?re.get().streaming.cmcd.cid:T.cid;if(K=ie.contentID?ie.contentID:K,me.v=re.get().streaming.cmcd.version??1,me.sid=re.get().streaming.cmcd.sid?re.get().streaming.cmcd.sid:T.sid,me.sid=ie.sessionID?ie.sessionID:me.sid,me.sid=`${me.sid}`,K&&(me.cid=`${K}`),isNaN(T.pr)||T.pr===1||T.pr===null||(me.pr=T.pr),T.st&&(me.st=T.st),T.sf&&(me.sf=T.sf),me.v===2){let ge=1e3*N.getCurrentLiveLatency();isNaN(ge)||(me.ltc=ge);const _e=T.msd;J||isNaN(_e)||(me.msd=_e,J=!0)}return me}function Le(ie){try{const me=A.getCurrentBufferLevel(ie);return isNaN(me)?null:100*parseInt(10*me)}catch{return null}}function Q(ie){try{T.pr=ie.playbackRate}catch{}}function ee(ie){try{const me=b.getIsDynamic(ie.data)?Bl.LIVE:Bl.VOD,K=ie.protocol&&ie.protocol==="MSS"?Ul.SMOOTH:Ul.DASH;T.st=`${me}`,T.sf=`${K}`}catch{}}function oe(ie){try{ie.state&&ie.mediaType&&ie.state===d.default.BUFFER_EMPTY&&(P[ie.mediaType]||(P[ie.mediaType]=!0),I[ie.mediaType]||(I[ie.mediaType]=!0))}catch{}}function ae(){for(let ie in P)P.hasOwnProperty(ie)&&(P[ie]=!0);for(let ie in I)I.hasOwnProperty(ie)&&(I[ie]=!0)}return p={getCmcdData:ke,getQueryParameter:function(ie){try{if(ve()){const me=ke(ie),K=(function(ge,_e={}){return ge?Cl(zl(ge,_e),{whitespace:!1}):""})(F(me));return V.trigger(Mn.default.CMCD_DATA_GENERATED,{url:ie.url,mediaType:ie.mediaType,cmcdData:me,cmcdString:K}),{key:"CMCD",value:K}}return null}catch{return null}},getHeaderParameters:function(ie){try{if(ve()){const me=ke(ie),K=eh(F(me),re.get().streaming.cmcd.version===1?{}:{customHeaderMap:{[eo.REQUEST]:["ltc"],[eo.SESSION]:["msd"]}});return V.trigger(Mn.default.CMCD_DATA_GENERATED,{url:ie.url,mediaType:ie.mediaType,cmcdData:me,headers:K}),K}return null}catch{return null}},getCmcdParametersFromManifest:te,setConfig:function(ie){ie&&(ie.abrController&&(w=ie.abrController),ie.dashMetrics&&(A=ie.dashMetrics),ie.throughputController&&(x=ie.throughputController),ie.playbackController&&(N=ie.playbackController),ie.serviceDescriptionController&&(C=ie.serviceDescriptionController))},reset:function(){V.off(d.default.PLAYBACK_RATE_CHANGED,Q,this),V.off(d.default.MANIFEST_LOADED,ee,this),V.off(d.default.BUFFER_LEVEL_STATE_CHANGED,oe,p),V.off(d.default.PLAYBACK_SEEKED,ae,p),V.off(d.default.PLAYBACK_STARTED,X,p),V.off(d.default.PLAYBACK_PLAYING,G,p),ue()},initialize:function(ie){V.on(d.default.PLAYBACK_RATE_CHANGED,Q,p),V.on(d.default.MANIFEST_LOADED,ee,p),V.on(d.default.BUFFER_LEVEL_STATE_CHANGED,oe,p),V.on(d.default.PLAYBACK_SEEKED,ae,p),V.on(d.default.PERIOD_SWITCH_COMPLETED,be,p),ie?V.on(d.default.MANIFEST_LOADING_STARTED,X,p):V.on(d.default.PLAYBACK_STARTED,X,p),V.on(d.default.PLAYBACK_PLAYING,G,p)},isCmcdEnabled:ve},b=xn(Z).getInstance(),v=le.getLogger(p),ue(),p}ql.__dashjs_factory_name="CmcdModel";var jl=n.default.getSingletonFactory(ql);const Si="CMSD-Dynamic",Hl="CMSD-Static",as=Ll,nh=Hl.toLowerCase(),ah=Si.toLowerCase(),rh=["mb","st","sf","v"],io="stream",ih={video:as.VIDEO,audio:as.AUDIO,text:as.TIMED_TEXT,stream:io};function Gl(){const b=this.context,p=(0,y.default)(b).getInstance();let v,T,w,A;function N(){w={},A={}}function C(P){P&&Object.keys(P).forEach((D=>{rh.includes(D)||delete P[D]}))}function x(P){try{return(D=P)?Object.entries((function($,J){try{const{src:Z,value:V}=(function(re,le){const ue={};for(;re.length>0;){let be;const X=_l(re),G=X.value;if((re=X.src)[0]==="="){const U=Sl(re.substring(1),le);be=U.value,re=U.src}else{const U=Qs(re,le);be=new Aa(!0,U.value),re=U.src}if(ue[G]=be,(re=re.trim()).length===0)return fa(ue,re);if(re[0]!==","||(re=re.substring(1).trim()).length===0||re[0]===",")throw Vn(re,Ar)}return fa(ue,re)})($.trim(),J);if(Z!=="")throw Vn(Z,Ar);return V}catch(Z){throw Vn($,Ar,Z)}})(D)).reduce((($,[J,Z])=>{const{value:V}=Z;return $[J]=typeof V=="symbol"?Il(V):V,$}),{}):{}}catch($){T.error("Failed to parse CMSD-Static response header value:",$)}var D}function B(P){try{const $=(D=P)?(function(Z,V){try{const{src:re,value:le}=(function(ue,be){const X=[];for(;ue.length>0;){const G=Sl(ue,be);if(X.push(G.value),(ue=G.src.trim()).length===0)return fa(X,ue);if(ue[0]!==","||(ue=ue.substring(1).trim()).length===0||ue[0]===",")throw Vn(ue,es)}return fa(X,ue)})(Z.trim(),V);if(re!=="")throw Vn(re,es);return le}catch(re){throw Vn(Z,es,re)}})(D):[];return $[$.length-1]?.params||{}}catch($){return T.error("Failed to parse CMSD-Dynamic response header value:",$),{}}var D}function q(P){return ih[P]||as.OTHER}function I(P,D,$){const J=P===Hl?w:A,Z=J[D]||{},V=J[io]||{};return Z[$]||V[$]}return v={setConfig:function(){},initialize:function(){},reset:function(){N()},parseResponseHeaders:function(P,D){let $=null,J=null;for(const V in P){const re=P[V];switch(V){case nh:$=x(re),p.trigger(u.default.CMSD_STATIC_HEADER,$);break;case ah:J||(J=B(re))}}let Z=io;return $&&$.ot?Z=$.ot:D&&(Z=q(D)),C(w[Z]),C(A[Z]),$&&(w[Z]=Object.assign(w[Z]||{},$)),J&&(A[Z]=Object.assign(A[Z]||{},J)),{static:$,dynamic:J}},getMaxBitrate:function(P){let D=q(P);return I(Si,D,"mb")||-1},getEstimatedThroughput:function(P){let D=q(P);return I(Si,D,"etp")||null},getResponseDelay:function(P){let D=q(P);return I(Si,D,"rd")||null},getRoundTripTime:function(P){let D=q(P);return I(Si,D,"rtt")||null}},T=(0,c.default)(b).getInstance().getLogger(v),N(),v}Gl.__dashjs_factory_name="CmsdModel";var Yl=n.default.getSingletonFactory(Gl),so=t(1926);function Kl(){let b,p;function v(){p={}}return b={reset:function(){v()},processResponseHeaders:function(T){if(!(T&&T.headers&&T.request&&T.request.url))return;const w=T.headers[l.default.COMMON_ACCESS_TOKEN_HEADER];if(w){const A=at.default.getHostFromUrl(T.request.url);A&&(p[A]=w)}},getCommonAccessTokenForUrl:function(T){if(!T)return null;const w=at.default.getHostFromUrl(T);return w?p[w]?p[w]:null:void 0}},v(),b}Kl.__dashjs_factory_name="CommonAccessTokenController";var sh=n.default.getSingletonFactory(Kl);function $l(){let b,p;return b={setConfig:function(v){v&&v.serviceDescriptionController&&(p=v.serviceDescriptionController)},isAdaptationsIncluded:function(v){const{adaptationSetsArray:T}=p?.getServiceDescriptionSettings()?.clientDataReporting??{};return!T||T?.length===0||T.includes(v)},isServiceLocationIncluded:function(v,T){if(v===ye.HTTPRequest.CONTENT_STEERING_TYPE)return!0;const{serviceLocationsArray:w}=p?.getServiceDescriptionSettings()?.clientDataReporting??{};return!w||w?.length===0||w.includes(T)}},b}$l.__dashjs_factory_name="ClientDataReportingController";var Vl=n.default.getSingletonFactory($l);function Wl(){let b,p,v;const T=this.context;function w(A,N,C,x,B){const q=(function(I,P){let D=[];return D=P===Se.default.PERIOD?I[Se.default.SUPPLEMENTAL_PROPERTY]||[]:[...I[Se.default.ESSENTIAL_PROPERTY]||[],...I[Se.default.SUPPLEMENTAL_PROPERTY]||[]],D.find(($=>$.schemeIdUri===l.default.URL_QUERY_INFO_SCHEME&&$.UrlQueryInfo||$.schemeIdUri===l.default.EXT_URL_QUERY_INFO_SCHEME&&$.ExtUrlQueryInfo))})(N,B);(function(I,P,D,$){D.initialQueryString="";let J="";const Z=I?.ExtUrlQueryInfo||I?.UrlQueryInfo;J=Z&&Z.queryString?P&&P.length>0?P+"&"+Z.queryString:Z.queryString:P,Z?.useMPDUrlQuery==="true"&&$&&(J=J?J+"&"+$:$),D.initialQueryString=J})(q,x.initialQueryString,A,C),(function(I,P,D){if(!I)return void(P.finalQueryString=D);const $=I?.ExtUrlQueryInfo?.queryTemplate||I?.UrlQueryInfo?.queryTemplate||"";P.finalQueryString=$===Se.default.QUERY_PART?P?.initialQueryString:""})(q,A,x.finalQueryString),A.sameOriginOnly=q?.ExtUrlQueryInfo?.sameOriginOnly,A.queryParams=at.default.parseQueryParams(A?.finalQueryString),A.includeInRequests=(function(I,P){return I?I.ExtUrlQueryInfo?.includeInRequests?I.ExtUrlQueryInfo.includeInRequests.split(" "):[Se.default.SEGMENT_TYPE]:P})(q,x.includeInRequests)}return p=(0,c.default)(T).getInstance().getLogger(b),b={getFinalQueryString:function(A){try{if(!v)return null;if(A.type===ye.HTTPRequest.MEDIA_SEGMENT_TYPE||A.type===ye.HTTPRequest.INIT_SEGMENT_TYPE){const N=A.representation;if(!N)return null;const C=N.adaptation,x=C.period,B=v.period[x.index].adaptation[C.index].representation[N.index],q=new URL(A.url),I=!B.sameOriginOnly||v.origin===q.origin;if(B.includeInRequests.includes(Se.default.SEGMENT_TYPE)&&I)return B.queryParams}else if(A.type===ye.HTTPRequest.MPD_TYPE){if([Se.default.MPD_TYPE,Se.default.MPD_PATCH_TYPE].some((N=>v.includeInRequests.includes(N))))return v.queryParams}else if(A.type===ye.HTTPRequest.CONTENT_STEERING_TYPE&&v.includeInRequests.includes(Se.default.STEERING_TYPE))return v.queryParams}catch(N){return p.error(N),null}},createFinalQueryStrings:function(A){v={origin:new URL(A.url).origin,period:[]};const N=A.url.split("?")[1];w(v,A,N,{initialQueryString:"",includeInRequests:[]},Se.default.MPD),A.Period.forEach((C=>{const x={adaptation:[]};w(x,C,N,v,Se.default.PERIOD),C.AdaptationSet.forEach((B=>{const q={representation:[]};w(q,B,N,x,Se.default.ADAPTATION_SET),B.Representation.forEach((I=>{const P={};w(P,I,N,q,Se.default.REPRESENTATION),q.representation.push(P)})),x.adaptation.push(q)})),v.period.push(x)}))}},b}Wl.__dashjs_factory_name="ExtUrlQueryInfoController";var Ql=n.default.getSingletonFactory(Wl),oo=class{constructor(b){this.url=b.url,this.method=b.method,this.responseType=b.responseType!==void 0?b.responseType:null,this.headers=b.headers!==void 0?b.headers:{},this.credentials=b.credentials!==void 0?b.credentials:null,this.mode=b.mode!==void 0?b.mode:null,this.timeout=b.timeout!==void 0?b.timeout:0,this.cmcd=b.cmcd!==void 0?b.cmcd:null,this.customData=b.customData!==void 0?b.customData:null}},lo=class{constructor(b){this.request=b.request,this.url=b.url!==void 0?b.url:null,this.redirected=b.redirected!==void 0&&b.redirected,this.status=b.status!==void 0?b.status:null,this.statusText=b.statusText!==void 0?b.statusText:"",this.type=b.type!==void 0?b.type:"",this.headers=b.headers!==void 0?b.headers:{},this.data=b.data!==void 0?b.data:null,this.resourceTiming=b.resourceTiming!==void 0?b.resourceTiming:null}};function Xl(b){b=b||{};const p=this.context,v=b.errHandler,T=b.dashMetrics,w=b.mediaPlayerModel,A=b.boxParser,N=b.errors,C=b.requestTimeout||0,x=(0,y.default)(p).getInstance(),B=(0,h.default)(p).getInstance();let q,I,P,D,$,J,Z,V,re,le,ue,be,X,G;function U(F,ve){const te=function(){Oe()},ke=function(At){const Vt=new Date;me&&(me=!1,(!At.lengthComputable||At.lengthComputable&&At.total!==At.loaded)&&(ae.firstByteDate=Vt,Ne.resourceTiming.responseStart=Vt.getTime())),At.lengthComputable&&(ae.bytesLoaded=Ne.length=At.loaded,ae.bytesTotal=Ne.resourceTiming.encodedBodySize=At.total,Ne.length=At.total,Ne.resourceTiming.encodedBodySize=At.loaded),At.noTrace||(ie.push({s:ge,d:At.time?At.time:Vt.getTime()-ge.getTime(),b:[At.loaded?At.loaded-_e:0],t:At.throughput}),ae.traces=ie,ge=Vt,_e=At.loaded),xe&&(clearTimeout(xe),xe=null),B.get().streaming.fragmentRequestProgressTimeout>0&&(xe=setTimeout((function(){G.warn("Abort request "+Me.url+" due to progress timeout"),Ze.abort(Me),te()}),B.get().streaming.fragmentRequestProgressTimeout)),F.progress&&At&&F.progress(At)},Ee=function(){Oe(!0)},Re=function(At){let Vt;if(At.lengthComputable){let on=At.loaded/At.total*100;Vt="Request timeout: loaded: "+At.loaded+", out of: "+At.total+" : "+on.toFixed(3)+"% Completed"}else Vt="Request timeout: non-computable download size";G.warn(Vt)},Oe=function(At=!1){I.indexOf(Me)!==-1&&I.splice(I.indexOf(Me),1),xe&&(clearTimeout(xe),xe=null),ue.processResponseHeaders(Ne),Le(),Q(),(function(Vt){const on=le.getResponseInterceptors();return on?on.reduce(((kn,vn)=>kn.then((cn=>vn(cn)))),Promise.resolve(Vt)):Promise.resolve(Vt)})(Ne).then((Vt=>{if(Ne=Vt,(function(on,kn,vn){const cn=on.customData.request,pn=B.get().streaming.cmsd&&B.get().streaming.cmsd.enabled?Z.parseResponseHeaders(kn.headers,cn.mediaType):null;T.addHttpRequest(cn,kn.url,kn.status,kn.headers,vn,pn)})(Me,Ne,ie),At)F.abort&&F.abort(ae);else if(ae.type===ye.HTTPRequest.MPD_TYPE&&(T.addManifestUpdate(ae),x.trigger(u.default.MANIFEST_LOADING_FINISHED,{requestObject:ae})),Ne.status>=200&&Ne.status<=299&&Ne.data)F.success&&F.success(Ne.data,Ne.statusText,Ne.url),F.complete&&F.complete(ae,Ne.statusText);else{try{Ne.status===404&&B.get().streaming.utcSynchronization.enableBackgroundSyncAfterSegmentDownloadError&&ae.type===ye.HTTPRequest.MEDIA_SEGMENT_TYPE&&w.getRetryAttemptsForType(ye.HTTPRequest.MEDIA_SEGMENT_TYPE)===ve&&x.trigger(u.default.ATTEMPT_BACKGROUND_SYNC)}catch{}oe()}}))},Le=function(){ae.startDate=K,ae.endDate=new Date,ae.firstByteDate=ae.firstByteDate||K},Q=function(){Ne.resourceTiming.responseEnd=Date.now(),(function(At,Vt){if(!B.get().streaming.abr.throughput.useResourceTimingApi||typeof performance>"u"||At.range)return;const on=performance.getEntriesByType?.("resource");if(on===void 0||on.length<=0)return;let kn=0,vn=null;for(;kn<on.length;){if(on[kn].name===At.url){vn=on[kn];break}kn+=1}(function(cn){return cn&&!isNaN(cn.responseStart)&&cn.responseStart>0&&!isNaN(cn.responseEnd)&&cn.responseEnd>0&&!isNaN(cn.transferSize)&&cn.transferSize>0})(vn)&&(At.customData.request.resourceTimingValues=vn,Vt.resourceTiming.startTime=vn.startTime,Vt.resourceTiming.encodedBodySize=vn.encodedBodySize,Vt.resourceTiming.responseStart=vn.startTime,Vt.resourceTiming.responseEnd=vn.responseEnd,Vt.resourceTiming.duration=vn.duration)})(Me,Ne)},ee=function(At,Vt,on){return new Promise((kn=>{(function(vn){const cn=le.getRequestInterceptors();return cn?cn.reduce(((pn,We)=>pn.then((pt=>We(pt)))),Promise.resolve(vn)):Promise.resolve(vn)})(Vt).then((vn=>{(Vt=vn).customData.onloadend=te,Vt.customData.onprogress=ke,Vt.customData.onabort=Ee,Vt.customData.ontimeout=Re,on.resourceTiming.startTime=Date.now(),At.load(Vt,on),kn()}))}))},oe=function(){if(ve>0){ve--,F&&F.request&&(F.request.retryAttempts+=1);let At={config:F};D.push(At),At.timeout=setTimeout((function(){D.indexOf(At)!==-1&&(D.splice(D.indexOf(At),1),U(F,ve))}),w.getRetryIntervalsForType(ae.type))}else{if(ae.type===ye.HTTPRequest.MSS_FRAGMENT_INFO_SEGMENT_TYPE)return;v.error(new Bt.default($[ae.type],ae.url+" is not available",{request:ae,response:Ne})),F.error&&F.error(ae,"error",Ne.statusText,Ne),F.complete&&F.complete(ae,Ne.statusText)}},ae=F.request,ie=[];let me,K,ge,_e,xe,Me,Ne;if(ae.bytesLoaded=NaN,ae.bytesTotal=NaN,ae.firstByteDate=null,ae.traces=[],me=!0,K=new Date,ge=K,_e=0,xe=null,!T||!v)throw new Error("config object is not correct or missing");const Ge=(function(At){let Vt,on;return!At.isPartialSegmentRequest&&At.hasOwnProperty("availabilityTimeComplete")&&At.availabilityTimeComplete===!1&&window.fetch&&At.responseType==="arraybuffer"&&At.type===ye.HTTPRequest.MEDIA_SEGMENT_TYPE?(re||(re=Nn(p).create(),re.setConfig({dashMetrics:T,boxParser:A})),Vt=re,on=l.default.FILE_LOADER_TYPES.FETCH):(V||(V=Qt(p).create()),Vt=V,on=l.default.FILE_LOADER_TYPES.XHR),{loader:Vt,fileLoaderType:on}})(ae),Ze=Ge.loader;var ht;ae.fileLoaderType=Ge.fileLoaderType,ae.headers={},(function(At){const Vt=At?.serviceLocation,on=At?.mediaInfo?.id?.toString();if(be.isServiceLocationIncluded(At.type,Vt)&&be.isAdaptationsIncluded(on)&&J.isCmcdEnabled()){const kn=J.getCmcdParametersFromManifest(),vn=kn.mode?kn.mode:B.get().streaming.cmcd.mode;if(vn===l.default.CMCD_MODE_QUERY){At.url=at.default.removeQueryParameterFromUrl(At.url,l.default.CMCD_QUERY_KEY);const cn=(function(pn){try{const We=[],pt=J.getQueryParameter(pn);return pt&&We.push(pt),We}catch{return[]}})(At);At.url=at.default.addAdditionalQueryParameterToUrl(At.url,cn)}else vn===l.default.CMCD_MODE_HEADER&&(At.headers=Object.assign(At.headers,J.getHeaderParameters(At)))}})(ht=ae),ht.retryAttempts===0&&(function(At){let Vt=X.getFinalQueryString(At);Vt&&(At.url=at.default.addAdditionalQueryParameterToUrl(At.url,Vt))})(ht),(function(At){if(At.queryParams){const Vt=Object.keys(At.queryParams).map((on=>({key:on,value:At.queryParams[on]})));At.url=at.default.addAdditionalQueryParameterToUrl(At.url,Vt)}})(ht),(function(At){const Vt=ue.getCommonAccessTokenForUrl(At.url);Vt&&(At.headers[l.default.COMMON_ACCESS_TOKEN_HEADER]=Vt)})(ht),ae.range&&(ae.headers.Range="bytes="+ae.range);const wt=le.getXHRWithCredentialsForType(ae.type);Me=new oo({url:ae.url,method:ye.HTTPRequest.GET,responseType:ae.responseType,headers:ae.headers,credentials:wt?"include":"omit",timeout:C,cmcd:J.getCmcdData(ae),customData:{request:ae}}),Ne=new lo({request:Me,resourceTiming:{startTime:Date.now(),encodedBodySize:0},status:0});let Wt=new Date().getTime();if(isNaN(ae.delayLoadingTime)||Wt>=ae.delayLoadingTime)return I.push(Me),ee(Ze,Me,Ne);{let At={httpRequest:Me,httpResponse:Ne};return P.push(At),At.delayTimeout=setTimeout((function(){if(P.indexOf(At)!==-1){P.splice(P.indexOf(At),1);try{K=new Date,ge=K,I.push(At.httpRequest),ee(Ze,At.httpRequest,At.httpResponse)}catch{At.httpRequest.onloadend()}}}),ae.delayLoadingTime-Wt),Promise.resolve()}}return q={abort:function(){D.forEach((F=>{clearTimeout(F.timeout),F.config.request&&F.config.abort&&F.config.abort(F.config.request)})),D=[],P.forEach((F=>clearTimeout(F.delayTimeout))),P=[],I.forEach((F=>{const ve=F.customData;ve&&(ve.request&&ve.request.type===ye.HTTPRequest.MSS_FRAGMENT_INFO_SEGMENT_TYPE||(ve.onloadend=ve.onprogress=void 0,ve.abort&&ve.abort()))})),I=[]},load:function(F){return F.request?U(F,w.getRetryAttemptsForType(F.request.type)):(F.error&&F.error(F.request,"error"),Promise.resolve())},reset:function(){I=[],P=[],D=[],V&&V.reset(),re&&re.reset(),V=null,re=null},resetInitialSettings:function(){V&&V.resetInitialSettings()},setConfig:function(F){F&&(F.commonAccessTokenController&&(ue=F.commonAccessTokenController),F.extUrlQueryInfoController&&(X=F.extUrlQueryInfoController))}},G=(0,c.default)(p).getInstance().getLogger(q),I=[],P=[],D=[],J=jl(p).getInstance(),be=Vl(p).getInstance(),Z=Yl(p).getInstance(),le=(0,so.default)(p).getInstance(),ue=sh(p).getInstance(),X=Ql(p).getInstance(),$={[ye.HTTPRequest.MPD_TYPE]:N.DOWNLOAD_ERROR_ID_MANIFEST_CODE,[ye.HTTPRequest.XLINK_EXPANSION_TYPE]:N.DOWNLOAD_ERROR_ID_XLINK_CODE,[ye.HTTPRequest.INIT_SEGMENT_TYPE]:N.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE,[ye.HTTPRequest.MEDIA_SEGMENT_TYPE]:N.DOWNLOAD_ERROR_ID_CONTENT_CODE,[ye.HTTPRequest.INDEX_SEGMENT_TYPE]:N.DOWNLOAD_ERROR_ID_CONTENT_CODE,[ye.HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE]:N.DOWNLOAD_ERROR_ID_CONTENT_CODE,[ye.HTTPRequest.OTHER_TYPE]:N.DOWNLOAD_ERROR_ID_CONTENT_CODE},q}Xl.__dashjs_factory_name="HTTPLoader";var oh=n.default.getClassFactory(Xl);function Jl(){let b,p;function v(){p={}}function T(){v()}return T(),b={getLoader:function(w){for(var A in p)if(p.hasOwnProperty(A)&&w.startsWith(A))return p[A];return oh},registerLoader:function(w,A){p[w]=A},unregisterLoader:function(w){p[w]&&delete p[w]},unregisterAllLoader:v,reset:T},b}Jl.__dashjs_factory_name="SchemeLoaderFactory";var Zl=n.default.getSingletonFactory(Jl);function ec(b){b=b||{};const p=this.context;let v,T,w;return T=Zl(p).getInstance(),v={abort:function(){w&&w.abort()},load:function(A){w||(w=T.getLoader(A&&A.request?A.request.url:null)(p).create({errHandler:b.errHandler,mediaPlayerModel:b.mediaPlayerModel,dashMetrics:b.dashMetrics,boxParser:b.boxParser?b.boxParser:null,constants:b.constants?b.constants:null,dashConstants:b.dashConstants?b.dashConstants:null,urlUtils:b.urlUtils?b.urlUtils:null,requestTimeout:isNaN(b.requestTimeout)?0:b.requestTimeout,errors:b.errors})),w.load(A)},reset:function(){T&&(T.reset(),T=null),w&&typeof w.reset=="function"&&w.reset(),w=null},resetInitialSettings:function(){w&&typeof w.resetInitialSettings=="function"&&w.resetInitialSettings()}},v}ec.__dashjs_factory_name="URLLoader";var ri=n.default.getClassFactory(ec),lh=class{constructor(b){this.url=b||null,this.type=ye.HTTPRequest.CONTENT_STEERING_TYPE,this.responseType="json"}},ch=class{constructor(){this.version=null,this.ttl=300,this.reloadUri=null,this.pathwayPriority=[],this.pathwayClones=[]}};function tc(){const b=this.context,p=Un(b).getInstance();let v,T,w,A,N,C,x,B,q,I,P,D,$,J,Z,V;function re(Ee){be(Ee,"baseUrl")}function le(Ee){be(Ee,"location")}function ue(Ee){var Re,Oe;Ee&&Ee.throughputValues&&Ee.throughputValues.serviceLocation&&(Re=Ee.throughputValues.serviceLocation,Oe=Ee.throughputValues,J[Re]||(J[Re]=[]),J[Re].push(Oe),J[Re].length>4&&J[Re].shift())}function be(Ee,Re){if(Ee&&Ee.request&&Ee.request.serviceLocation){const Oe=Ee.request.serviceLocation;D[Re].all.indexOf(Oe)===-1&&D[Re].all.push(Oe),D[Re].current=Oe}}function X(){const Ee=B.getValue();let Re=v.getContentSteering(Ee);return Re||(Re=P.getServiceDescriptionSettings().contentSteering),!Re&&T&&(Re=T),T=Re,Re}function G(){return new Promise((Ee=>{try{const Re=X();if(!Re||!Re.serverUrl)return void Ee();const Oe=(function(Q){let ee=Q.serverUrl;w&&w.reloadUri&&(ee=p.isRelative(w.reloadUri)?p.resolve(w.reloadUri,Q.serverUrl):w.reloadUri);const oe=[],ae=D.baseUrl.all.concat(D.location.all);if(ae.length>0){const ie=ae.map((ge=>{const _e=(function(xe){if(!xe||!J[xe]||J[xe].length===0)return-1;const Me=$.getArithmeticMean(J[xe],J[xe].length,!0);return parseInt(1e3*Me)})(ge);return{serviceLocation:ge,throughput:_e}}));let me="",K="";ie.forEach(((ge,_e)=>{_e!==0&&(me+=",",K+=","),me+=ge.serviceLocation,K+=ge.throughput>-1?ge.throughput:""})),oe.push({key:"_DASH_pathway",value:`"${me}"`}),oe.push({key:"_DASH_throughput",value:K})}return ee=at.default.addAdditionalQueryParameterToUrl(ee,oe),ee})(Re),Le=new lh(Oe);Z.load({request:Le,success:Q=>{(function(ee){ee&&ee[Se.default.CONTENT_STEERING_RESPONSE.VERSION]&&parseInt(ee[Se.default.CONTENT_STEERING_RESPONSE.VERSION])===1&&(w=new ch,w.version=ee[Se.default.CONTENT_STEERING_RESPONSE.VERSION],ee[Se.default.CONTENT_STEERING_RESPONSE.TTL]&&!isNaN(ee[Se.default.CONTENT_STEERING_RESPONSE.TTL])&&(w.ttl=ee[Se.default.CONTENT_STEERING_RESPONSE.TTL]),ee[Se.default.CONTENT_STEERING_RESPONSE.RELOAD_URI]&&(w.reloadUri=ee[Se.default.CONTENT_STEERING_RESPONSE.RELOAD_URI]),ee[Se.default.CONTENT_STEERING_RESPONSE.PATHWAY_PRIORITY]&&(w.pathwayPriority=ee[Se.default.CONTENT_STEERING_RESPONSE.PATHWAY_PRIORITY]),ee[Se.default.CONTENT_STEERING_RESPONSE.PATHWAY_CLONES]&&(w.pathwayClones=ee[Se.default.CONTENT_STEERING_RESPONSE.PATHWAY_CLONES],w.pathwayClones=w.pathwayClones.filter((oe=>(function(ae){return ae[Se.default.CONTENT_STEERING_RESPONSE.BASE_ID]&&ae[Se.default.CONTENT_STEERING_RESPONSE.ID]&&ae[Se.default.CONTENT_STEERING_RESPONSE.URI_REPLACEMENT]&&ae[Se.default.CONTENT_STEERING_RESPONSE.URI_REPLACEMENT][Se.default.CONTENT_STEERING_RESPONSE.HOST]})(oe)))),ve())})(Q),C.trigger(d.default.CONTENT_STEERING_REQUEST_COMPLETED,{currentSteeringResponseData:w,url:Oe}),Ee()},error:(Q,ee,oe,ae)=>{(function(ie,me){try{switch(x.warn("Error fetching data from content steering server",ie),me.status){case 404:case 410:T=null;break;case 429:const K=me&&me.getResponseHeader?me.getResponseHeader("retry-after"):null;K!==null&&(w||(w={}),w.ttl=parseInt(K)),ve();break;default:ve()}}catch(K){x.error(K)}})(Q,ae),Ee(Q)},complete:()=>{D.baseUrl.all=U(D.baseUrl),D.location.all=U(D.location)}})}catch(Re){Ee(Re)}}))}function U(Ee){return Ee.all&&Ee.all.length!==0&&Ee.current?Ee.all.filter((Re=>Re===Ee.current)):[]}function F(Ee){try{const Re=[];return Ee&&Ee.length!==0&&w&&w.pathwayClones&&w.pathwayClones.length!==0&&w.pathwayClones.forEach((Oe=>{let Le=Ee.filter((ee=>Oe[Se.default.CONTENT_STEERING_RESPONSE.BASE_ID]===ee.serviceLocation)),Q=null;if(Le&&Le.length>0&&(Q=Le[0]),Q){const ee=new URL(Q.url);let oe=Oe[Se.default.CONTENT_STEERING_RESPONSE.URI_REPLACEMENT][Se.default.CONTENT_STEERING_RESPONSE.HOST];oe=at.default.stringHasProtocol(oe)?oe:`${ee.protocol}//${oe}`;const ae={synthesizedUrl:`${oe}${ee.pathname}`,serviceLocation:Oe[Se.default.CONTENT_STEERING_RESPONSE.ID],queryParams:Oe[Se.default.CONTENT_STEERING_RESPONSE.URI_REPLACEMENT][Se.default.CONTENT_STEERING_RESPONSE.PARAMS],reference:Q};Re.push(ae)}})),Re}catch(Re){return x.error(Re),[]}}function ve(){w&&w.ttl&&!isNaN(w.ttl)&&(I&&clearTimeout(I),I=setTimeout((()=>{G()}),1e3*w.ttl))}function te(){I&&clearTimeout(I),I=null}function ke(){w=null,T=null,J={},D={baseUrl:{current:null,all:[]},location:{current:null,all:[]}},te()}return V={reset:function(){ke(),C.off(d.default.FRAGMENT_LOADING_STARTED,re,V),C.off(d.default.MANIFEST_LOADING_STARTED,le,V),C.off(d.default.THROUGHPUT_MEASUREMENT_STORED,ue,V)},setConfig:function(Ee){Ee&&(Ee.adapter&&(v=Ee.adapter),Ee.errHandler&&(N=Ee.errHandler),Ee.dashMetrics&&(A=Ee.dashMetrics),Ee.mediaPlayerModel&&(q=Ee.mediaPlayerModel),Ee.manifestModel&&(B=Ee.manifestModel),Ee.serviceDescriptionController&&(P=Ee.serviceDescriptionController),Ee.throughputController&&($=Ee.throughputController),Ee.eventBus&&(C=Ee.eventBus))},loadSteeringData:G,getCurrentSteeringResponseData:function(){return w},shouldQueryBeforeStart:function(){const Ee=X();return!!Ee&&Ee.queryBeforeStart},getSteeringDataFromManifest:X,stopSteeringRequestTimer:te,getSynthesizedBaseUrlElements:function(Ee){try{return F(Ee).map((Re=>{const Oe=new Xn(Re.synthesizedUrl,Re.serviceLocation);return Oe.queryParams=Re.queryParams,Oe.dvbPriority=Re.reference.dvbPriority,Oe.dvbWeight=Re.reference.dvbWeight,Oe.availabilityTimeOffset=Re.reference.availabilityTimeOffset,Oe.availabilityTimeComplete=Re.reference.availabilityTimeComplete,Oe}))}catch(Re){return x.error(Re),[]}},getSynthesizedLocationElements:function(Ee){try{return F(Ee).map((Re=>{const Oe=new wr(Re.synthesizedUrl,Re.serviceLocation);return Oe.queryParams=Re.queryParams,Oe}))}catch(Re){return x.error(Re),[]}},initialize:function(){Z=ri(b).create({errHandler:N,dashMetrics:A,mediaPlayerModel:q,errors:Yt}),C.on(d.default.FRAGMENT_LOADING_STARTED,re,V),C.on(d.default.MANIFEST_LOADING_STARTED,le,V),C.on(d.default.THROUGHPUT_MEASUREMENT_STORED,ue,V)}},x=(0,c.default)(b).getInstance().getLogger(V),ke(),V}tc.__dashjs_factory_name="ContentSteeringController";var co=n.default.getSingletonFactory(tc);function nc(){const b=this.context,p=(0,y.default)(b).getInstance();let v,T,w,A=[];function N(x=[],B=[]){let q=0,I=NaN;for(;q<x.length;){const P=x[q],D=B.findIndex(($=>$.serviceLocation&&$.serviceLocation===P));if(D!==-1&&!w.contains(B[D].serviceLocation)){I=D;break}q+=1}return I}function C(x){const B=T.getCurrentSteeringResponseData();if(!B)return;const q=x.entry,I=setTimeout((()=>{w.remove(q),A.splice(A.indexOf(I,1))}),1e3*B.ttl);A.push(I)}return v={selectBaseUrlIndex:function(x){let B=NaN;if(isNaN(x.selectedIdx)){const I=T.getSteeringDataFromManifest();I&&I.defaultServiceLocationArray.length>0&&(B=N(I.defaultServiceLocationArray,x.baseUrls))}const q=T.getCurrentSteeringResponseData();return x.baseUrls&&x.baseUrls.length&&q&&q.pathwayPriority&&q.pathwayPriority.length&&(B=N(q.pathwayPriority,x.baseUrls)),B},setConfig:function(x){x.blacklistController&&(w=x.blacklistController),x.contentSteeringController&&(T=x.contentSteeringController),p.on(x.addBlacklistEventName,C,v)},reset:function(){A.forEach((x=>clearTimeout(x))),A=[]}},T=co(b).getInstance(),v}nc.__dashjs_factory_name="ContentSteeringSelector";var uh=n.default.getClassFactory(nc);function ac(){const b=this.context,p=(0,y.default)(b).getInstance(),v=(0,h.default)(b).getInstance();let T,w,A,N,C,x;function B(){C.reset(),w.reset()}return T={chooseSelector:function(q){(0,ct.checkParameterType)(q,"boolean"),x=q?N:A},select:function(q){if(!q)return;if(v.get().streaming.applyContentSteering){const P=C.selectBaseUrlIndex(q);isNaN(P)||P===-1||(q.selectedIdx=P)}if(!isNaN(q.selectedIdx))return q.baseUrls[q.selectedIdx];let I=x.select(q.baseUrls);return I?(q.selectedIdx=q.baseUrls.indexOf(I),I):(p.trigger(u.default.URL_RESOLUTION_FAILED,{error:new Bt.default(Yt.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE,Yt.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE)}),void(x===A&&B()))},reset:B,setConfig:function(q){q.selector&&(x=q.selector),q.contentSteeringSelector&&(C=q.contentSteeringSelector)}},w=tn(b).create({updateEventName:u.default.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED,addBlacklistEventName:u.default.SERVICE_LOCATION_BASE_URL_BLACKLIST_ADD}),A=Pn(b).create({blacklistController:w}),N=un(b).create({blacklistController:w}),C=uh(b).create(),C.setConfig({blacklistController:w,addBlacklistEventName:u.default.SERVICE_LOCATION_BASE_URL_BLACKLIST_ADD}),x=A,T}ac.__dashjs_factory_name="BaseURLSelector";var dh=n.default.getClassFactory(ac);function rc(){let b,p;const v=this.context,T=(0,y.default)(v).getInstance(),w=Un(v).getInstance();let A,N,C;function x(q){A.update(q),N.chooseSelector(p.getIsDVB(q)),T.trigger(d.default.BASE_URLS_UPDATED,{baseUrls:B(q)})}function B(q){return A.getBaseUrls(q)}return b={reset:function(){A.reset(),N.reset()},initialize:function(q){A.setConfig({adapter:p,contentSteeringController:C}),x(q)},resolve:function(q){const I=A.getForPath(q).reduce(((P,D)=>{const $=N.select(D);return $?(w.isRelative($.url)?P.url=w.resolve($.url,P.url):(P.url=$.url,P.serviceLocation=$.serviceLocation),P.availabilityTimeOffset=$.availabilityTimeOffset,P.availabilityTimeComplete=$.availabilityTimeComplete,P.queryParams=$.queryParams,P):new Xn}),new Xn);if(!w.isRelative(I.url))return I},setConfig:function(q){q.baseURLTreeModel&&(A=q.baseURLTreeModel),q.baseURLSelector&&(N=q.baseURLSelector),q.adapter&&(p=q.adapter),q.contentSteeringController&&(C=q.contentSteeringController)},getBaseUrls:B,update:x},A=It(v).create(),N=dh(v).create(),T.on(u.default.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED,(function(q){A.invalidateSelectedIndexes(q.entry)}),b),b}rc.__dashjs_factory_name="BaseURLController";var fh=n.default.getClassFactory(rc);class uo{constructor(p){if(this.offset=p._offset,this.type=p.type,this.size=p.size,this.boxes=[],p.boxes)for(let v=0;v<p.boxes.length;v++)this.boxes.push(new uo(p.boxes[v]));switch(this.isComplete=!0,p.type){case"sidx":if(this.timescale=p.timescale,this.earliest_presentation_time=p.earliest_presentation_time,this.first_offset=p.first_offset,this.references=p.references,p.references){this.references=[];for(let v=0;v<p.references.length;v++){let T={reference_type:p.references[v].reference_type,referenced_size:p.references[v].referenced_size,subsegment_duration:p.references[v].subsegment_duration};this.references.push(T)}}break;case"emsg":this.id=p.id,this.version=p.version===1?1:0,this.value=p.value,this.timescale=p.timescale,this.scheme_id_uri=p.scheme_id_uri,this.presentation_time_delta=p.version===1?p.presentation_time:p.presentation_time_delta,this.event_duration=p.event_duration,this.message_data=p.message_data;break;case"mdhd":this.timescale=p.timescale;break;case"mfhd":this.sequence_number=p.sequence_number;break;case"subs":this.entry_count=p.entry_count,this.entries=p.entries;break;case"tfhd":this.base_data_offset=p.base_data_offset,this.sample_description_index=p.sample_description_index,this.default_sample_duration=p.default_sample_duration,this.default_sample_size=p.default_sample_size,this.default_sample_flags=p.default_sample_flags,this.flags=p.flags;break;case"tfdt":this.version=p.version,this.baseMediaDecodeTime=p.baseMediaDecodeTime,this.flags=p.flags;break;case"trun":if(this.sample_count=p.sample_count,this.first_sample_flags=p.first_sample_flags,this.data_offset=p.data_offset,this.flags=p.flags,this.samples=p.samples,p.samples){this.samples=[];for(let v=0,T=p.samples.length;v<T;v++){let w={sample_size:p.samples[v].sample_size,sample_duration:p.samples[v].sample_duration,sample_composition_time_offset:p.samples[v].sample_composition_time_offset};this.samples.push(w)}}break;case"prft":this.version=p.version,this.reference_track_ID=p.reference_track_ID,this.ntp_timestamp_sec=p.ntp_timestamp_sec,this.ntp_timestamp_frac=p.ntp_timestamp_frac,this.media_time=p.media_time,this.flags=p.flags}}getChildBox(p){for(let v=0;v<this.boxes.length;v++)if(this.boxes[v].type===p)return this.boxes[v]}getChildBoxes(p){let v=[];for(let T=0;T<this.boxes.length;T++)this.boxes[T].type===p&&v.push(this.boxes[T]);return v}}var hh=uo;function ic(){let b,p;function v(w){let A=[];if(!w||!p||typeof p.fetchAll!="function")return A;let N,C=p.fetchAll(w);for(let x=0,B=C.length;x<B;x++)N=T(C[x]),N&&A.push(N);return A}function T(w){if(!w)return null;let A=new hh(w);return w.hasOwnProperty("_incomplete")&&(A.isComplete=!w._incomplete),A}return b={getBox:function(w){return w&&p&&p.boxes&&p.boxes.length!==0&&typeof p.fetch=="function"?T(p.fetch(w)):null},getBoxes:v,setData:function(w){p=w},getLastBox:function(){if(!p||!p.boxes||!p.boxes.length)return null;let w=v(p.boxes[p.boxes.length-1].type);return w.length>0?w[w.length-1]:null}},b}ic.__dashjs_factory_name="IsoFile";var mh=n.default.getClassFactory(ic),ki=t(6877),fo=class{constructor({found:b,sizeOfLastCompletedBox:p,sizeOfLastFoundTargetBox:v,startOffsetOfLastCompletedBox:T,startOffsetOfLastFoundTargetBox:w,typeOfLastCompletedBox:A,typeOfLastTargetBox:N}){this.found=b!==void 0&&b,this.sizeOfLastCompletedBox=p!==void 0?p:0,this.sizeOfLastFoundTargetBox=v!==void 0?v:0,this.startOffsetOfLastCompletedBox=T!==void 0?T:0,this.startOffsetOfLastFoundTargetBox=w!==void 0?w:0,this.typeOfLastCompletedBox=A!==void 0?A:null,this.typeOfLastTargetBox=N!==void 0?N:null}};function sc(){let b,p,v=this.context;function T(N){if(!N)return null;N.fileStart===void 0&&(N.fileStart=0);let C=ki.parseBuffer(N),x=mh(v).create();return x.setData(C),x}function w(N,C){return N[C+3]>>>0|N[C+2]<<8>>>0|N[C+1]<<16>>>0|N[C]<<24>>>0}function A(N,C){return String.fromCharCode(N[C++])+String.fromCharCode(N[C++])+String.fromCharCode(N[C++])+String.fromCharCode(N[C])}return p={findInitRange:function(N){let C,x,B=null;const q=T(N);if(!q)return B;const I=q.getBox("ftyp"),P=q.getBox("moov");return b.debug("Searching for initialization."),P&&P.isComplete&&(C=I?I.offset:P.offset,x=P.offset+P.size-1,B=C+"-"+x,b.debug("Found the initialization.  Range: "+B)),B},findLastTopIsoBoxCompleted:function(N,C,x){if(x===void 0&&(x=0),!C||x+8>=C.byteLength)return new fo({found:!1});const B=C instanceof ArrayBuffer?new Uint8Array(C):C;let q,I=0,P=0,D=null;for(;x<B.byteLength;){const $=w(B,x),J=A(B,x+4);if($===0)break;x+$<=B.byteLength&&(N.indexOf(J)>=0?q=new fo({found:!0,startOffsetOfLastFoundTargetBox:x,sizeOfLastFoundTargetBox:$,typeOfLastTargetBox:J}):(I=x,P=$,D=J)),x+=$}return q||new fo({found:!1,startOffsetOfLastCompletedBox:I,sizeOfLastCompletedBox:P,typeOfLastCompletedBox:D})},getMediaTimescaleFromMoov:function(N){let C=T(N),x=C?C.getBox("mdhd"):void 0;return x?x.timescale:NaN},getSamplesInfo:function(N){if(!N||N.byteLength===0)return{sampleList:[],lastSequenceNumber:NaN,totalDuration:NaN,numSequences:NaN};let C,x,B,q,I,P,D,$,J,Z,V,re,le,ue,be,X,G,U=T(N),F=U.getBoxes("moof"),ve=U.getBoxes("mfhd");X=U.getBoxes("moof").length,be=ve[ve.length-1].sequence_number,B=0,P=[];let te=-1,ke=-1;for(V=0;V<F.length;V++){let Ee=F[V],Re=Ee.getChildBoxes("traf");for(J=0;J<Re.length;J++){let Oe=Re[J],Le=Oe.getChildBox("tfhd"),Q=Oe.getChildBox("tfdt");I=Q.baseMediaDecodeTime;let ee=Oe.getChildBoxes("trun"),oe=Oe.getChildBoxes("subs");for(Z=0;Z<ee.length;Z++){let ae=ee[Z];for(B=ae.sample_count,ue=(Le.base_data_offset||0)+(ae.data_offset||0),$=0;$<B;$++){D=ae.samples[$],C=D.sample_duration!==void 0?D.sample_duration:Le.default_sample_duration,q=D.sample_size!==void 0?D.sample_size:Le.default_sample_size,x=D.sample_composition_time_offset!==void 0?D.sample_composition_time_offset:0;let ie={dts:I,cts:I+x,duration:C,offset:Ee.offset+ue,size:q,subSizes:[q]};if(oe)for(re=0;re<oe.length;re++){let me=oe[re];if(te<me.entry_count-1&&$>ke&&(te++,ke+=me.entries[te].sample_delta),$==ke){ie.subSizes=[];let K=me.entries[te];for(le=0;le<K.subsample_count;le++)ie.subSizes.push(K.subsamples[le].subsample_size)}}P.push(ie),ue+=q,I+=C}}G=I-Q.baseMediaDecodeTime}}return{sampleList:P,lastSequenceNumber:be,totalDuration:G,numSequences:X}},parse:T},b=(0,c.default)(v).getInstance().getLogger(p),p}sc.__dashjs_factory_name="BoxParser";var rs=n.default.getSingletonFactory(sc),oc=t(559);const ho={0:void 0,1:{channels:1,lfe:0},2:{channels:2,lfe:0},3:{channels:3,lfe:0},4:{channels:4,lfe:0},5:{channels:5,lfe:0},6:{channels:5,lfe:1},7:{channels:7,lfe:1},8:{channels:2,lfe:0},9:{channels:3,lfe:0},10:{channels:4,lfe:0},11:{channels:6,lfe:1},12:{channels:7,lfe:1},13:{channels:22,lfe:2},14:{channels:7,lfe:1},15:{channels:10,lfe:2},16:{channels:9,lfe:1},17:{channels:11,lfe:1},18:{channels:13,lfe:1},19:{channels:11,lfe:1},20:{channels:13,lfe:1}};function lc(b){return b==0?0:b.toString(2).match(/1/g).length}function mo(b,p){let v,T=parseInt("0x"+b,16),w=T&p[0],A=T&p[1];return v=lc(w)+2*lc(A),v}var cc=function(b,p=!1){let v;if(!b||!b.schemeIdUri||!b.value)return;const T=b.schemeIdUri,w=b.value;return T==="urn:mpeg:dash:23003:3:audio_channel_configuration:2011"||T==="urn:mpeg:mpegB:cicp:ChannelConfiguration"?v=ho[w]&&ho[w].channels+(p?ho[w].lfe:0):T==="tag:dolby.com,2014:dash:audio_channel_configuration:2011"?v=(function(A,N){if(A.length===4)return mo(A,[63880+(N?6:0),1648])})(w,p):T==="tag:dolby.com,2015:dash:audio_channel_configuration:2015"?v=(function(A,N){if(A.length===6)return A==="800000"?24:mo(A,[56834+(N?4160:0),205245])})(w,p):T==="tag:dts.com,2014:dash:audio_channel_configuration:2012"?v=parseInt(w):T==="tag:dts.com,2018:uhd:audio_channel_configuration"&&(v=(function(A,N){if(!(A.length>8))return mo(A,[4294901727+(N?65568:0),0])})(w,p)),v};function uc(){const b=this.context,p=(0,y.default)(b).getInstance();let v,T,w,A,N,C,x;function B(V,re,le,ue=void 0){const be=I(V,re,le,ue);return w.isCodecSupportedBasedOnTestedConfigurations(be,V)}function q(V,re,le,ue,be,X=void 0){const G=I(V,re,le,X),U=JSON.stringify(G);ue.has(U)||(ue.add(U),be.push(G))}function I(V,re,le,ue){let be=null;switch(V){case l.default.VIDEO:be=(function(X,G,U){let F={codec:G,width:X&&X.width||null,height:X&&X.height||null,framerate:T.getFramerate(X)||null,bitrate:X&&X.bandwidth||null,isSupported:!0};if(X.tagName===Se.default.PRESELECTION&&U&&(F.width||(F.width=U.width||null),F.height||(F.height=U.height||null),F.bitrate||(F.bitrate=U.bandwidth||null),F.framerate||(F.framerate=T.getFramerate(U)||null)),A.get().streaming.capabilities.filterVideoColorimetryEssentialProperties&&(Object.assign(F,D(X)),X.tagName===Se.default.PRESELECTION&&U)){let ke=D(U),Ee=ke.isSupported;delete ke.isSupported,F.isSupported=F.isSupported&&Ee,P(F,ke)}let ve=F.isSupported;if(A.get().streaming.capabilities.filterHDRMetadataFormatEssentialProperties&&(Object.assign(F,$(X)),X.tagName===Se.default.PRESELECTION&&U)){let ke=$(U),Ee=ke.isSupported;delete ke.isSupported,F.isSupported=F.isSupported&&Ee,P(F,ke)}let te=F.isSupported;return ve&&te||(F.isSupported=!1),F})(re,le,ue);break;case l.default.AUDIO:be=(function(X,G,U){let F={codec:G,samplerate:X&&X.audioSamplingRate||null,bitrate:X&&X.bandwidth||null,isSupported:!0};return X.tagName===Se.default.PRESELECTION&&U&&(F.samplerate||(F.samplerate=U.audioSamplingRate||null),F.bitrate||(F.bitrate=U.bandwidth||null)),A.get().streaming.capabilities.filterAudioChannelConfiguration&&Object.assign(F,(function(ve,te){let ke=ve[Se.default.AUDIO_CHANNEL_CONFIGURATION]||[],Ee=null;ke.length==0&&te&&(ke=te[Se.default.AUDIO_CHANNEL_CONFIGURATION]||[]);const Re=ke.map((Oe=>cc(Oe,!0)));return Re.every((Oe=>Oe==Re[0]))&&(Ee=Re[0]),{channels:Ee}})(X,U)),F})(re,le,ue);break;default:return be}return ue&&(be=J(ue,be)),J(re,be)}function P(V,re){for(const le in re)Object.prototype.hasOwnProperty.call(re,le)&&!(le in V)&&(V[le]=re[le]);return V}function D(V){let re={colorGamut:null,transferFunction:null,isSupported:!0};for(const le of V.EssentialProperty||[])le.schemeIdUri===l.default.COLOUR_PRIMARIES_SCHEME_ID_URI&&["1","5","6","7"].includes(le.value.toString())?re.colorGamut=l.default.MEDIA_CAPABILITIES_API.COLORGAMUT.SRGB:le.schemeIdUri===l.default.COLOUR_PRIMARIES_SCHEME_ID_URI&&["11","12"].includes(le.value.toString())?re.colorGamut=l.default.MEDIA_CAPABILITIES_API.COLORGAMUT.P3:le.schemeIdUri===l.default.COLOUR_PRIMARIES_SCHEME_ID_URI&&["9"].includes(le.value.toString())?re.colorGamut=l.default.MEDIA_CAPABILITIES_API.COLORGAMUT.REC2020:le.schemeIdUri===l.default.COLOUR_PRIMARIES_SCHEME_ID_URI&&["2"].includes(le.value.toString())?re.colorGamut=null:le.schemeIdUri===l.default.COLOUR_PRIMARIES_SCHEME_ID_URI&&(re.isSupported=!1),le.schemeIdUri===l.default.TRANSFER_CHARACTERISTICS_SCHEME_ID_URI&&["1","6","13","14","15"].includes(le.value.toString())?re.transferFunction=l.default.MEDIA_CAPABILITIES_API.TRANSFERFUNCTION.SRGB:le.schemeIdUri===l.default.TRANSFER_CHARACTERISTICS_SCHEME_ID_URI&&["16"].includes(le.value.toString())?re.transferFunction=l.default.MEDIA_CAPABILITIES_API.TRANSFERFUNCTION.PQ:le.schemeIdUri===l.default.TRANSFER_CHARACTERISTICS_SCHEME_ID_URI&&["18"].includes(le.value.toString())?re.transferFunction=l.default.MEDIA_CAPABILITIES_API.TRANSFERFUNCTION.HLG:le.schemeIdUri===l.default.TRANSFER_CHARACTERISTICS_SCHEME_ID_URI&&["2"].includes(le.value.toString())?re.transferFunction=null:le.schemeIdUri===l.default.TRANSFER_CHARACTERISTICS_SCHEME_ID_URI&&(re.isSupported=!1);return re}function $(V){let re={isSupported:!0,hdrMetadataType:null};for(const le of V.EssentialProperty||[])le.schemeIdUri===l.default.HDR_METADATA_FORMAT_SCHEME_ID_URI&&le.value===l.default.HDR_METADATA_FORMAT_VALUES.ST2094_10?re.hdrMetadataType=l.default.MEDIA_CAPABILITIES_API.HDR_METADATATYPE.SMPTE_ST_2094_10:le.schemeIdUri===l.default.HDR_METADATA_FORMAT_SCHEME_ID_URI&&le.value===l.default.HDR_METADATA_FORMAT_VALUES.SL_HDR2?re.hdrMetadataType=l.default.MEDIA_CAPABILITIES_API.HDR_METADATATYPE.SLHDR2:le.schemeIdUri===l.default.HDR_METADATA_FORMAT_SCHEME_ID_URI&&le.value===l.default.HDR_METADATA_FORMAT_VALUES.ST2094_40?re.hdrMetadataType=l.default.MEDIA_CAPABILITIES_API.HDR_METADATATYPE.SMPTE_ST_2094_40:le.schemeIdUri===l.default.HDR_METADATA_FORMAT_SCHEME_ID_URI&&(re.isSupported=!1);return re}function J(V,re){return C&&V&&V[Se.default.CONTENT_PROTECTION]&&V[Se.default.CONTENT_PROTECTION].length>0&&(re.keySystemsMetadata=C.getSupportedKeySystemMetadataFromContentProtection(V[Se.default.CONTENT_PROTECTION])),re}function Z(V){if(!V||V.length===0)return!0;let re=0;for(;re<V.length;){if(!w.supportsEssentialProperty(V[re]))return x.debug("[Stream] EssentialProperty not supported: "+V[re].schemeIdUri),!1;re+=1}return!0}return v={setConfig:function(V){V&&(V.adapter&&(T=V.adapter),V.capabilities&&(w=V.capabilities),V.settings&&(A=V.settings),V.protectionController&&(C=V.protectionController),V.customParametersModel&&(N=V.customParametersModel))},filterUnsupportedFeatures:function(V){return new Promise((re=>{const le=[l.default.VIDEO,l.default.AUDIO],ue=[];le.forEach((be=>{(function(G,U){if(!G||!G.Period||G.Period.length===0)return[];const F=new Set,ve=[];return G.Period.forEach((te=>{te.AdaptationSet.forEach((ke=>{T.getIsTypeOf(ke,U)&&ke.Representation.forEach(((Ee,Re)=>{const Oe=T.getCodec(ke,Re,!1);q(U,Ee,Oe,F,ve);const Le=T.getSupplementalCodecs(Ee);Le.length>0&&q(U,Ee,Le[0],F,ve)}))})),te.Preselection&&te.Preselection.length&&te.Preselection.forEach((ke=>{if(T.getPreselectionIsTypeOf(ke,te.AdaptationSet,U)){const Ee=T.getCodecForPreselection(ke,te.AdaptationSet),Re=T.getCommonRepresentationForPreselection(ke,te.AdaptationSet);q(U,ke,Ee,F,ve,Re)}}))})),ve})(V,be).forEach((G=>{ue.push(w.runCodecSupportCheck(G,be))}))})),Promise.allSettled(ue).then((()=>(le.forEach((be=>{(function(X,G){G&&G.Period&&G.Period.length!==0&&G.Period.forEach((U=>{(function(F,ve){F&&F.AdaptationSet&&F.AdaptationSet.length!==0&&(F.AdaptationSet=F.AdaptationSet.filter((te=>{T.getIsTypeOf(te,ve)&&(function(Ee,Re){Ee.Representation&&Ee.Representation.length!==0&&(Ee.Representation=Ee.Representation.filter(((Oe,Le)=>{const Q=T.getCodec(Ee,Le,!1),ee=B(Re,Oe,Q);let oe=(function(ae,ie){let me=!1;const K=T.getSupplementalCodecs(ae);return K.length>0&&(K.length>1&&x.warn("[CapabilitiesFilter] Multiple supplemental codecs not supported; using the first in list"),me=B(ie,ae,K[0])),me})(Oe,Re);return oe&&(x.debug(`[CapabilitiesFilter] Codec supported. Upgrading codecs string of Representation with ID ${Oe.id}`),Oe.codecs=Oe[Se.default.SUPPLEMENTAL_CODECS]),ee||oe||x.warn(`[CapabilitiesFilter] Codec ${Q} not supported. Removing Representation with ID ${Oe.id}`),ee||oe})))})(te,ve);const ke=te.Representation&&te.Representation.length>0;return ke||(p.trigger(u.default.ADAPTATION_SET_REMOVED_NO_CAPABILITIES,{adaptationSet:te}),x.warn(`[CapabilitiesFilter] AdaptationSet with ID ${te.id?te.id:"undefined"} and codec ${te.codecs?te.codecs:"undefined"} has been removed because of no supported Representation`)),ke})))})(U,X),(function(F,ve){F&&F.Preselection&&F.Preselection.length!==0&&(F.Preselection=F.Preselection.filter((te=>{if(T.getPreselectionIsTypeOf(te,F.AdaptationSet,ve)){const ke=T.getCodecForPreselection(te,F.AdaptationSet);let Ee=!0;if(ke){let Re=T.getCommonRepresentationForPreselection(te,F.AdaptationSet);Ee=B(ve,te,ke,Re)}return Ee||x.warn(`[CapabilitiesFilter] Preselection@codecs ${ke} not supported. Removing Preselection with ID ${te.id}`),Ee}return!0})))})(U,X)}))})(be,V)})),A.get().streaming.capabilities.filterUnsupportedEssentialProperties&&(function(be){be&&be.Period&&be.Period.length!==0&&be.Period.forEach((X=>{X.AdaptationSet=X.AdaptationSet.filter((G=>!G.Representation||G.Representation.length===0||!!Z(T.getEssentialProperties(G))&&(G.Representation=G.Representation.filter((U=>Z(T.getEssentialProperties(U)))),G.Representation&&G.Representation.length>0))),X.Preselection&&X.Preselection.length&&(X.Preselection=X.Preselection.filter((G=>!!Z(T.getEssentialProperties(G))||(x.warn(`[CapabilitiesFilter] removed Preselection (id: ${G.id}) with unsupported EssentialProperty`),!1))))}))})(V),(function(be){be&&be.Period&&be.Period.length!==0&&be.Period.forEach((X=>{X.Preselection&&(X.Preselection=X.Preselection.filter((G=>{const U=String(G.preselectionComponents).split(" ").length;return U!==1&&x.warn(`Multi-Representation Preselection (id: ${G.id}) removed as not supported.`),U===1})))}))})(V),(function(be){be&&be.Period&&be.Period.length!==0&&be.Period.forEach((X=>{X.Preselection&&(X.Preselection=X.Preselection.filter((G=>{const U=String(G.preselectionComponents).split(" "),F=X.AdaptationSet.map((ve=>ve.id));return U.every((ve=>F.includes(ve)))})))}))})(V),(function(be){if(!be||!be.Period||be.Period.length===0)return Promise.resolve();const X=[];return be.Period.forEach((G=>{X.push((function(U){return new Promise((F=>{if(!U||!U.AdaptationSet||U.AdaptationSet.length===0)return void F();const ve=[];U.AdaptationSet.forEach((te=>{ve.push((function(ke){return new Promise((Ee=>{if(!ke.Representation||ke.Representation.length===0)return void Ee();const Re=[];ke.Representation.forEach((Oe=>{Re.push((function(Le){const Q=[],ee=N.getCustomCapabilitiesFilters();return ee&&ee.length!==0?ee.forEach((oe=>{Q.push(new Promise((ae=>ae(oe(Le)))))})):Q.push(Promise.resolve(!0)),Promise.all(Q)})(Oe))})),Promise.all(Re).then((Oe=>{ke.Representation=ke.Representation.filter(((Le,Q)=>{let ee=Oe[Q].every((oe=>oe));return ee||x.debug("[Stream] Representation "+Le.id+" has been removed because of unsupported CustomFilter"),ee})),Ee()})).catch((Oe=>{x.warn("[Stream] at least one promise rejected in CustomFilter with error: ",Oe),Ee()}))}))})(te))})),Promise.all(ve).then((()=>{U.AdaptationSet=U.AdaptationSet.filter((te=>te.Representation&&te.Representation.length>0)),F()})).catch((()=>{F()}))}))})(G))})),Promise.all(X)})(V)))).then((()=>{re()})).catch((be=>{x.error(be),re()}))}))}},x=(0,c.default)(b).getInstance().getLogger(v),v}uc.__dashjs_factory_name="CapabilitiesFilter";var gh=n.default.getSingletonFactory(uc);function dc(){const b=this.context,p=(0,y.default)(b).getInstance();let v,T,w,A,N,C,x,B,q,I;function P(){T=!1;const be=at.default.parseUserAgent();w=be&&be.browser&&be.browser.name&&be.browser.name.toLowerCase()==="safari"}function D(){T=!1}function $(be){if(be.streamId!==C.getActiveStreamInfo().id||!q)return;const X=x.getLiveDelay();x.getBufferLevel()>X/2&&(q=!1)}function J(be){be.streamId===C.getActiveStreamInfo().id&&(q=be.state===i.BUFFER_EMPTY)}function Z(){B.getCatchupModeEnabled()||A.setPlaybackRate(1)}function V(){x.getIsDynamic()&&B.getCatchupModeEnabled()&&(B.getCatchupPlaybackRates().max>0||B.getCatchupPlaybackRates().min<0)&&!x.isPaused()&&!x.isSeeking()&&(function(){try{return!x.getTime()>0||T?!1:le()===l.default.LIVE_CATCHUP_MODE_LOLP?(function(be,X){try{return Math.abs(re())>0||be<X}catch{return!1}})(x.getBufferLevel(),N.get().streaming.liveCatchup.playbackBufferMin):(function(){try{return Math.abs(re())>0}catch{return!1}})()}catch{return!1}})()&&(function(){if(!T&&A){let be;const X=A.getPlaybackRate(),G=B.getCatchupPlaybackRates(),U=x.getBufferLevel(),F=re(),ve=B.getCatchupMaxDrift();if(!isNaN(ve)&&ve>0&&F>ve)I.info("[CatchupController]: Low Latency catchup mechanism. Latency too high, doing a seek to live point"),T=!0,x.seekToCurrentLive(!0,!1);else{const te=x.getCurrentLiveLatency(),ke=x.getLiveDelay();be=le()===l.default.LIVE_CATCHUP_MODE_LOLP?(function(Re,Oe,Le,Q,ee){let oe;if(ee<Q){const ae=Math.abs(Re.min),ie=5*(ee-Q);oe=1-ae+2*ae/(1+Math.pow(Math.E,-ie)),I.debug("[LoL+ playback control_buffer-based] bufferLevel: "+ee+", newRate: "+oe)}else{if(Math.abs(Oe-Le)<=.02*Le)oe=1;else{const ie=Oe-Le,me=ie<0?Math.abs(Re.min):Re.max,K=5*ie;oe=1-me+2*me/(1+Math.pow(Math.E,-K))}I.debug("[LoL+ playback control_latency-based] latency: "+Oe+", newRate: "+oe)}return oe})(G,te,ke,N.get().streaming.liveCatchup.playbackBufferMin,U):(function(Re,Oe,Le,Q){if(q)return 1;const ee=Oe-Le,oe=ee<0?Math.abs(Re.min):Re.max,ae=5*ee;let ie=1-oe+2*oe/(1+Math.pow(Math.E,-ae));return x.getPlaybackStalled()&&Q<=Le/2&&ee>0&&(ie=1),ie})(G,te,ke,U);const Ee=w?.25:.02/(.5/G.max);(be&&Math.abs(X-be)>=Ee||be==1)&&(I.debug(`[CatchupController]: Setting playback rate to ${be}`),A.setPlaybackRate(be))}}})()}function re(){return x.getCurrentLiveLatency()-x.getLiveDelay()}function le(){const be=N.get().streaming.liveCatchup.playbackBufferMin;return N.get().streaming.liveCatchup.mode!==l.default.LIVE_CATCHUP_MODE_LOLP||be===null||isNaN(be)?l.default.LIVE_CATCHUP_MODE_DEFAULT:l.default.LIVE_CATCHUP_MODE_LOLP}function ue(){B.getCatchupPlaybackRates(!0)}return v={reset:function(){p.off(d.default.BUFFER_LEVEL_UPDATED,$,v),p.off(d.default.BUFFER_LEVEL_STATE_CHANGED,J,v),p.off(d.default.PLAYBACK_PROGRESS,V,v),p.off(d.default.PLAYBACK_TIME_UPDATED,V,v),p.off(d.default.PLAYBACK_SEEKED,D,v),p.off(u.default.SETTING_UPDATED_CATCHUP_ENABLED,Z,v),p.off(u.default.SETTING_UPDATED_PLAYBACK_RATE_MIN,ue,v),p.off(u.default.SETTING_UPDATED_PLAYBACK_RATE_MAX,ue,v),p.off(d.default.STREAM_INITIALIZED,ue,v),P(),A.setPlaybackRate(1,!0)},setConfig:function(be){be&&(be.settings&&(N=be.settings),be.videoModel&&(A=be.videoModel),be.streamController&&(C=be.streamController),be.playbackController&&(x=be.playbackController),be.mediaPlayerModel&&(B=be.mediaPlayerModel))},initialize:function(){p.on(d.default.BUFFER_LEVEL_UPDATED,$,v),p.on(d.default.BUFFER_LEVEL_STATE_CHANGED,J,v),p.on(d.default.PLAYBACK_PROGRESS,V,v),p.on(d.default.PLAYBACK_TIME_UPDATED,V,v),p.on(d.default.PLAYBACK_SEEKED,D,v),p.on(u.default.SETTING_UPDATED_CATCHUP_ENABLED,Z,v),p.on(u.default.SETTING_UPDATED_PLAYBACK_RATE_MIN,ue,v),p.on(u.default.SETTING_UPDATED_PLAYBACK_RATE_MAX,ue,v),p.on(d.default.STREAM_INITIALIZED,ue,v),ue()}},I=(0,c.default)(b).getInstance().getLogger(v),P(),v}dc.__dashjs_factory_name="CatchupController";var ph=n.default.getSingletonFactory(dc);const yh=[{oldKey:"dashjs_vbitrate",newKey:"dashjs_video_bitrate"},{oldKey:"dashjs_abitrate",newKey:"dashjs_audio_bitrate"},{oldKey:"dashjs_vsettings",newKey:"dashjs_video_settings"},{oldKey:"dashjs_asettings",newKey:"dashjs_audio_settings"}],fc="dashjs_?_bitrate",hc="dashjs_?_settings",ii="localStorage",mc="lastBitrate",gc="lastMediaSettings";function pc(b){b=b||{};const p=this.context,v=b.settings;let T,w,A;function N(q){if(A!==void 0)return A;let I;A=!1;try{typeof window<"u"&&(I=window[q])}catch(P){return w.warn("DOMStorage access denied: "+P.message),A}if(!I||q!==ii)return A;try{I.setItem("1","1"),I.removeItem("1"),A=!0}catch(P){w.warn("DOMStorage is supported, but cannot be used: "+P.message)}return A}function C(){return Math.round(new Date().getTime()/6e5)*6e5}function x(q,I){return N(q)&&v.get().streaming[I+"CachingInfo"].enabled}function B(){if(!v)throw new Error(l.default.MISSING_CONFIG_ERROR)}return T={getSavedBitrateSettings:function(q){if(B(),!v.get().streaming.lastBitrateCachingInfo.enabled)return NaN;let I=NaN;if(x(ii,mc)){const P=fc.replace(/\?/,q);try{const D=JSON.parse(localStorage.getItem(P))||{},$=new Date().getTime()-parseInt(D.timestamp,10)>=v.get().streaming.lastBitrateCachingInfo.ttl||!1,J=parseFloat(D.bitrate);isNaN(J)||$?$&&localStorage.removeItem(P):(I=J,w.debug("Last saved bitrate for "+q+" was "+J))}catch{return null}}return I},setSavedBitrateSettings:function(q,I){if(x(ii,mc)&&I){const P=fc.replace(/\?/,q);try{localStorage.setItem(P,JSON.stringify({bitrate:I.toFixed(3),timestamp:C()}))}catch(D){w.error(D.message)}}},getSavedMediaSettings:function(q){if(B(),!v.get().streaming.lastMediaSettingsCachingInfo.enabled)return null;let I=null;if(x(ii,gc)){const P=hc.replace(/\?/,q);try{const D=JSON.parse(localStorage.getItem(P))||{},$=new Date().getTime()-parseInt(D.timestamp,10)>=v.get().streaming.lastMediaSettingsCachingInfo.ttl||!1;I=D.settings,$&&(localStorage.removeItem(P),I=null)}catch{return null}}return I},setSavedMediaSettings:function(q,I){if(x(ii,gc)){const P=hc.replace(/\?/,q);try{localStorage.setItem(P,JSON.stringify({settings:I,timestamp:C()}))}catch(D){w.error(D.message)}}}},w=(0,c.default)(p).getInstance().getLogger(T),N(ii)&&yh.forEach((q=>{const I=localStorage.getItem(q.oldKey);if(I){localStorage.removeItem(q.oldKey);try{localStorage.setItem(q.newKey,I)}catch(P){w.error(P.message)}}})),T}pc.__dashjs_factory_name="DOMStorage";var bh=n.default.getSingletonFactory(pc),is=class{constructor(){this.accessibility=null,this.adaptationSetSwitchingCompatibleIds=[],this.audioChannelConfiguration=null,this.bitrateList=null,this.codec=null,this.contentProtection=null,this.essentialProperties=[],this.id=null,this.index=null,this.isEmbedded=null,this.isFragmented=null,this.isPreselection=!1,this.isText=!1,this.labels=null,this.lang=null,this.mimeType=null,this.normalizedKeyIds=new Set,this.representationCount=0,this.roles=null,this.segmentAlignment=!1,this.segmentSequenceProperties=[],this.selectionPriority=1,this.streamInfo=null,this.subSegmentAlignment=!1,this.supplementalProperties=[],this.type=null,this.viewpoint=null}},yc=class{constructor(){this.id=null,this.index=null,this.start=NaN,this.duration=NaN,this.manifestInfo=null,this.isLast=!0,this.isEncrypted=!1}},Eh=class{constructor(){this.availableFrom=null,this.duration=NaN,this.dvrWindowSize=NaN,this.isDynamic=!1,this.loadedTime=null,this.maxFragmentDuration=null,this.minBufferTime=NaN,this.protocol=null,this.serviceDescriptions=[]}},vh=class{constructor(b){this.valid=b[0]=="/",this.path=b.split("/").filter((p=>p.length!==0)).map((p=>{let v={name:p},T=p.indexOf("[");if(T!=-1){v.name=p.substring(0,T);let w=p.substring(T+1,p.length-1);this.valid=this.valid&&w.indexOf("[")==-1;let A=w.indexOf("=");A!=-1?(v.attribute={name:w.substring(1,A),value:w.substring(A+1)},["'",'"'].indexOf(v.attribute.value[0])!=-1&&(v.attribute.value=v.attribute.value.substring(1,v.attribute.value.length-1))):v.position=parseInt(w,10)-1}return v}))}isValid(){return this.valid}findsElement(){return!this.findsAttribute()}findsAttribute(){return this.path[this.path.length-1].name.startsWith("@")}findsTextReplace(){return this.path[this.path.length-1].name==="text()"}getMpdTarget(b,p){let v=null,T=b,w=1,A="MPD";for(;w<this.path.length&&T!==null;){v=T;let N=this.path[w];if(A=N.name,w!==this.path.length-1||!A.startsWith("@")&&A!=="text()"){let C=v[A]||[];if(C.length===0&&v[A]&&C.push(v[A]),N.position)T=C[N.position]||null;else if(N.attribute){let x=N.attribute;T=C.filter((B=>B[x.name]==x.value))[0]||null}else T=Array.isArray(C)?C[0]:C}w++}return T===null?null:A.startsWith("@")?{name:A.substring(1),leaf:T,target:T}:A==="text()"?{name:"__text",leaf:T,target:T}:{name:A,leaf:T,target:p?v:T}}},Th=class{constructor(b,p,v){this.action=b,this.xpath=p,this.value=v,this.position=null}getMpdTarget(b){let p=this.action==="remove"||this.action==="replace"||this.position==="before"||this.position==="after";return this.xpath.getMpdTarget(b,p)}};function bc(){let b,p;const v=this.context;return b={getIsPatch:function(T){return T&&T.hasOwnProperty(Se.default.ORIGINAL_MPD_ID)||!1},getMpdId:function(T){return T&&T[Se.default.ORIGINAL_MPD_ID]||null},getOriginalPublishTime:function(T){return T&&T.hasOwnProperty(Se.default.ORIGINAL_PUBLISH_TIME)?new Date(T[Se.default.ORIGINAL_PUBLISH_TIME]):null},getPatchOperations:function(T){return T?(T.__children||[]).map((w=>{const A=w.tagName;if(A!=="add"&&A!=="remove"&&A!=="replace")return p.warn(`Ignoring node of invalid action: ${A}`),null;let N=w.sel;if(A==="add"&&w.type){if(!w.type.startsWith("@"))return p.warn(`Ignoring add action for prefixed namespace declaration: ${w.type}=${w.__text}`),null;N=`${N}/${w.type}`}let C=new vh(N);if(!C.isValid())return p.warn(`Ignoring action with invalid selector: ${A} - ${N}`),null;let x=null;C.findsAttribute()||C.findsTextReplace()?x=w.__text||"":A!=="remove"&&(x=w.__children.reduce(((q,I)=>{let P=I.tagName;return P!=="#text"&&(q[P]=q[P]||[],q[P].push(I)),q}),{}));let B=new Th(A,C,x);return A==="add"&&(B.position=w.pos),B})).filter((w=>!!w)):[]},getPublishTime:function(T){return T&&T.hasOwnProperty(Se.default.PUBLISH_TIME)?new Date(T[Se.default.PUBLISH_TIME]):null}},p=(0,c.default)(v).getInstance().getLogger(b),b}bc.__dashjs_factory_name="PatchManifestModel";var wh=n.default.getSingletonFactory(bc);function jr(b={}){let p=[];if(b.irregular)return b.irregular;if(b.regular)return b.regular;if(b.language){p=p.concat(b.language,b.extendedLanguageSubtags||[],b.script||[],b.region||[],b.variants||[]);const v=b.extensions||[];let T=-1;for(;++T<v.length;){const w=v[T];w.singleton&&w.extensions&&w.extensions.length>0&&p.push(w.singleton,...w.extensions)}}return b.privateuse&&b.privateuse.length>0&&p.push("x",...b.privateuse),p.join("-")}function ka(b){const p=typeof b=="string"?b.charCodeAt(0):b;return p>=97&&p<=122||p>=65&&p<=90}function si(b){const p=typeof b=="string"?b.charCodeAt(0):b;return p>=48&&p<=57}function Ir(b){return ka(b)||si(b)}const _h=["art-lojban","cel-gaulish","no-bok","no-nyn","zh-guoyu","zh-hakka","zh-min","zh-min-nan","zh-xiang"],Ec={"en-gb-oed":"en-GB-oxendict","i-ami":"ami","i-bnn":"bnn","i-default":null,"i-enochian":null,"i-hak":"hak","i-klingon":"tlh","i-lux":"lb","i-mingo":null,"i-navajo":"nv","i-pwn":"pwn","i-tao":"tao","i-tay":"tay","i-tsu":"tsu","sgn-be-fr":"sfb","sgn-be-nl":"vgt","sgn-ch-de":"sgg","art-lojban":"jbo","cel-gaulish":null,"no-bok":"nb","no-nyn":"nn","zh-guoyu":"cmn","zh-hakka":"hak","zh-min":null,"zh-min-nan":"nan","zh-xiang":"hsn"},Ah={}.hasOwnProperty;function Rr(b,p={}){const v={language:null,extendedLanguageSubtags:[],script:null,region:null,variants:[],extensions:[],privateuse:[],irregular:null,regular:null},T=String(b),w=T.toLowerCase();let A=0;if(b==null)throw new Error("Expected string, got `"+b+"`");if(Ah.call(Ec,w)){const C=Ec[w];return p.normalize!==void 0&&p.normalize!==null&&!p.normalize||typeof C!="string"?(v[_h.includes(w)?"regular":"irregular"]=T,v):Rr(C)}for(;ka(w.charCodeAt(A))&&A<9;)A++;if(A>1&&A<9){if(v.language=T.slice(0,A),A<4){let C=0;for(;w.charCodeAt(A)===45&&ka(w.charCodeAt(A+1))&&ka(w.charCodeAt(A+2))&&ka(w.charCodeAt(A+3))&&!ka(w.charCodeAt(A+4));){if(C>2)return N(A,3,"Too many extended language subtags, expected at most 3 subtags");v.extendedLanguageSubtags.push(T.slice(A+1,A+4)),A+=4,C++}}for(w.charCodeAt(A)===45&&ka(w.charCodeAt(A+1))&&ka(w.charCodeAt(A+2))&&ka(w.charCodeAt(A+3))&&ka(w.charCodeAt(A+4))&&!ka(w.charCodeAt(A+5))&&(v.script=T.slice(A+1,A+5),A+=5),w.charCodeAt(A)===45&&(ka(w.charCodeAt(A+1))&&ka(w.charCodeAt(A+2))&&!ka(w.charCodeAt(A+3))?(v.region=T.slice(A+1,A+3),A+=3):si(w.charCodeAt(A+1))&&si(w.charCodeAt(A+2))&&si(w.charCodeAt(A+3))&&!si(w.charCodeAt(A+4))&&(v.region=T.slice(A+1,A+4),A+=4));w.charCodeAt(A)===45;){const C=A+1;let x=C;for(;Ir(w.charCodeAt(x));){if(x-C>7)return N(x,1,"Too long variant, expected at most 8 characters");x++}if(!(x-C>4||x-C>3&&si(w.charCodeAt(C))))break;v.variants.push(T.slice(C,x)),A=x}for(;w.charCodeAt(A)===45&&w.charCodeAt(A+1)!==120&&Ir(w.charCodeAt(A+1))&&w.charCodeAt(A+2)===45&&Ir(w.charCodeAt(A+3));){let C=A+2,x=0;for(;w.charCodeAt(C)===45&&Ir(w.charCodeAt(C+1))&&Ir(w.charCodeAt(C+2));){const B=C+1;for(C=B+2,x++;Ir(w.charCodeAt(C));){if(C-B>7)return N(C,2,"Too long extension, expected at most 8 characters");C++}}if(!x)return N(C,4,"Empty extension, extensions must have at least 2 characters of content");v.extensions.push({singleton:T.charAt(A+1),extensions:T.slice(A+3,C).split("-")}),A=C}}else A=0;if(A===0&&w.charCodeAt(A)===120||w.charCodeAt(A)===45&&w.charCodeAt(A+1)===120){A=A?A+2:1;let C=A;for(;w.charCodeAt(C)===45&&Ir(w.charCodeAt(C+1));){const x=A+1;for(C=x;Ir(w.charCodeAt(C));){if(C-x>7)return N(C,5,"Too long private-use area, expected at most 8 characters");C++}v.privateuse.push(T.slice(A+1,C)),A=C}}return A!==T.length?N(A,6,"Found superfluous content after tag"):v;function N(C,x,B){return p.warning&&p.warning(B,x,C),p.forgiving?v:{language:null,extendedLanguageSubtags:[],script:null,region:null,variants:[],extensions:[],privateuse:[],irregular:null,regular:null}}}function Sh(b,p){return function(v,T){let w=vc(v,"tag");const A=vc(T??"*","range"),N=[];let C=-1;for(;++C<A.length;){const x=A[C].toLowerCase();if(!p&&x==="*")continue;let B=-1;const q=[];for(;++B<w.length;)if(b(w[B].toLowerCase(),x)){if(!p)return w[B];N.push(w[B])}else q.push(w[B]);w=q}return p?N:void 0}}const go=Sh((function(b,p){const v=b.split("-"),T=p.split("-");let w=0,A=0;if(T[A]!=="*"&&v[w]!==T[A])return!1;for(w++,A++;A<T.length;)if(T[A]!=="*"){if(!v[w])return!1;if(v[w]!==T[A]){if(v[w].length===1)return!1;w++}else w++,A++}else A++;return!0}),!0);function vc(b,p){const v=b&&typeof b=="string"?[b]:b;if(!v||typeof v!="object"||!("length"in v))throw new Error("Invalid "+p+" `"+v+"`, expected non-empty string");return v}const po=[{from:"in",to:"id"},{from:"iw",to:"he"},{from:"ji",to:"yi"},{from:"jw",to:"jv"},{from:"mo",to:"ro"},{from:"scc",to:"sr"},{from:"scr",to:"hr"},{from:"aam",to:"aas"},{from:"adp",to:"dz"},{from:"aue",to:"ktz"},{from:"ayx",to:"nun"},{from:"bgm",to:"bcg"},{from:"bjd",to:"drl"},{from:"ccq",to:"rki"},{from:"cjr",to:"mom"},{from:"cka",to:"cmr"},{from:"cmk",to:"xch"},{from:"coy",to:"pij"},{from:"cqu",to:"quh"},{from:"drh",to:"mn"},{from:"drw",to:"fa-af"},{from:"gav",to:"dev"},{from:"gfx",to:"vaj"},{from:"ggn",to:"gvr"},{from:"gti",to:"nyc"},{from:"guv",to:"duz"},{from:"hrr",to:"jal"},{from:"ibi",to:"opa"},{from:"ilw",to:"gal"},{from:"jeg",to:"oyb"},{from:"kgc",to:"tdf"},{from:"kgh",to:"kml"},{from:"koj",to:"kwv"},{from:"krm",to:"bmf"},{from:"ktr",to:"dtp"},{from:"kvs",to:"gdj"},{from:"kwq",to:"yam"},{from:"kxe",to:"tvd"},{from:"kzj",to:"dtp"},{from:"kzt",to:"dtp"},{from:"lii",to:"raq"},{from:"lmm",to:"rmx"},{from:"meg",to:"cir"},{from:"mst",to:"mry"},{from:"mwj",to:"vaj"},{from:"myt",to:"mry"},{from:"nad",to:"xny"},{from:"ncp",to:"kdz"},{from:"nnx",to:"ngv"},{from:"nts",to:"pij"},{from:"oun",to:"vaj"},{from:"pcr",to:"adx"},{from:"pmc",to:"huw"},{from:"pmu",to:"phr"},{from:"ppa",to:"bfy"},{from:"ppr",to:"lcq"},{from:"pry",to:"prt"},{from:"puz",to:"pub"},{from:"sca",to:"hle"},{from:"skk",to:"oyb"},{from:"tdu",to:"dtp"},{from:"thc",to:"tpo"},{from:"thx",to:"oyb"},{from:"tie",to:"ras"},{from:"tkk",to:"twm"},{from:"tlw",to:"weo"},{from:"tmp",to:"tyj"},{from:"tne",to:"kak"},{from:"tnf",to:"fa-af"},{from:"tsf",to:"taj"},{from:"uok",to:"ema"},{from:"xba",to:"cax"},{from:"xia",to:"acn"},{from:"xkh",to:"waw"},{from:"xsj",to:"suj"},{from:"ybd",to:"rki"},{from:"yma",to:"lrr"},{from:"ymt",to:"mtm"},{from:"yos",to:"zom"},{from:"yuu",to:"yug"},{from:"asd",to:"snz"},{from:"dit",to:"dif"},{from:"llo",to:"ngt"},{from:"myd",to:"aog"},{from:"nns",to:"nbr"},{from:"agp",to:"apf"},{from:"ais",to:"ami"},{from:"ajt",to:"aeb"},{from:"baz",to:"nvo"},{from:"bhk",to:"fbl"},{from:"bic",to:"bir"},{from:"bjq",to:"bzc"},{from:"bkb",to:"ebk"},{from:"blg",to:"iba"},{from:"btb",to:"beb"},{from:"daf",to:"dnj"},{from:"dap",to:"njz"},{from:"djl",to:"dze"},{from:"dkl",to:"aqd"},{from:"drr",to:"kzk"},{from:"dud",to:"uth"},{from:"duj",to:"dwu"},{from:"dwl",to:"dbt"},{from:"elp",to:"amq"},{from:"gbc",to:"wny"},{from:"ggo",to:"esg"},{from:"ggr",to:"gtu"},{from:"gio",to:"aou"},{from:"gli",to:"kzk"},{from:"ill",to:"ilm"},{from:"izi",to:"eza"},{from:"jar",to:"jgk"},{from:"kdv",to:"zkd"},{from:"kgd",to:"ncq"},{from:"kpp",to:"jkm"},{from:"kxl",to:"kru"},{from:"kzh",to:"dgl"},{from:"lak",to:"ksp"},{from:"leg",to:"enl"},{from:"mgx",to:"jbk"},{from:"mnt",to:"wnn"},{from:"mof",to:"xnt"},{from:"mwd",to:"dmw"},{from:"nbf",to:"nru"},{from:"nbx",to:"ekc"},{from:"nln",to:"azd"},{from:"nlr",to:"nrk"},{from:"noo",to:"dtd"},{from:"nxu",to:"bpp"},{from:"pat",to:"kxr"},{from:"rmr",to:"emx"},{from:"sap",to:"aqt"},{from:"sgl",to:"isk"},{from:"smd",to:"kmb"},{from:"snb",to:"iba"},{from:"sul",to:"sgd"},{from:"sum",to:"ulw"},{from:"tgg",to:"bjp"},{from:"thw",to:"ola"},{from:"tid",to:"itd"},{from:"unp",to:"wro"},{from:"wgw",to:"wgb"},{from:"wit",to:"nol"},{from:"wiw",to:"nwo"},{from:"xrq",to:"dmw"},{from:"yen",to:"ynq"},{from:"yiy",to:"yrm"},{from:"zir",to:"scv"},{from:"sgn-br",to:"bzs"},{from:"sgn-co",to:"csn"},{from:"sgn-de",to:"gsg"},{from:"sgn-dk",to:"dsl"},{from:"sgn-fr",to:"fsl"},{from:"sgn-gb",to:"bfi"},{from:"sgn-gr",to:"gss"},{from:"sgn-ie",to:"isg"},{from:"sgn-it",to:"ise"},{from:"sgn-jp",to:"jsl"},{from:"sgn-mx",to:"mfs"},{from:"sgn-ni",to:"ncs"},{from:"sgn-nl",to:"dse"},{from:"sgn-no",to:"nsi"},{from:"sgn-pt",to:"psr"},{from:"sgn-se",to:"swl"},{from:"sgn-us",to:"ase"},{from:"sgn-za",to:"sfs"},{from:"sgn-es",to:"ssp"},{from:"zh-cmn",to:"zh"},{from:"zh-cmn-hans",to:"zh-hans"},{from:"zh-cmn-hant",to:"zh-hant"},{from:"zh-gan",to:"gan"},{from:"zh-wuu",to:"wuu"},{from:"zh-yue",to:"yue"},{from:"no-bokmal",to:"nb"},{from:"no-nynorsk",to:"nn"},{from:"aa-saaho",to:"ssy"},{from:"sh",to:"sr-latn"},{from:"cnr",to:"sr-me"},{from:"tl",to:"fil"},{from:"aju",to:"jrb"},{from:"als",to:"sq"},{from:"arb",to:"ar"},{from:"ayr",to:"ay"},{from:"azj",to:"az"},{from:"bcc",to:"bal"},{from:"bcl",to:"bik"},{from:"bxk",to:"luy"},{from:"bxr",to:"bua"},{from:"cld",to:"syr"},{from:"cmn",to:"zh"},{from:"cwd",to:"cr"},{from:"dgo",to:"doi"},{from:"dhd",to:"mwr"},{from:"dik",to:"din"},{from:"diq",to:"zza"},{from:"lbk",to:"bnc"},{from:"ekk",to:"et"},{from:"emk",to:"man"},{from:"esk",to:"ik"},{from:"fat",to:"ak"},{from:"fuc",to:"ff"},{from:"gaz",to:"om"},{from:"gbo",to:"grb"},{from:"gno",to:"gon"},{from:"gug",to:"gn"},{from:"gya",to:"gba"},{from:"hdn",to:"hai"},{from:"hea",to:"hmn"},{from:"ike",to:"iu"},{from:"kmr",to:"ku"},{from:"knc",to:"kr"},{from:"kng",to:"kg"},{from:"knn",to:"kok"},{from:"kpv",to:"kv"},{from:"lvs",to:"lv"},{from:"mhr",to:"chm"},{from:"mup",to:"raj"},{from:"khk",to:"mn"},{from:"npi",to:"ne"},{from:"ojg",to:"oj"},{from:"ory",to:"or"},{from:"pbu",to:"ps"},{from:"pes",to:"fa"},{from:"plt",to:"mg"},{from:"pnb",to:"lah"},{from:"quz",to:"qu"},{from:"rmy",to:"rom"},{from:"spy",to:"kln"},{from:"src",to:"sc"},{from:"swh",to:"sw"},{from:"ttq",to:"tmh"},{from:"tw",to:"ak"},{from:"umu",to:"del"},{from:"uzn",to:"uz"},{from:"xpe",to:"kpe"},{from:"xsl",to:"den"},{from:"ydd",to:"yi"},{from:"zai",to:"zap"},{from:"zsm",to:"ms"},{from:"zyb",to:"za"},{from:"him",to:"srx"},{from:"mnk",to:"man"},{from:"bh",to:"bho"},{from:"prs",to:"fa-af"},{from:"swc",to:"sw-cd"},{from:"aar",to:"aa"},{from:"abk",to:"ab"},{from:"ave",to:"ae"},{from:"afr",to:"af"},{from:"aka",to:"ak"},{from:"amh",to:"am"},{from:"arg",to:"an"},{from:"ara",to:"ar"},{from:"asm",to:"as"},{from:"ava",to:"av"},{from:"aym",to:"ay"},{from:"aze",to:"az"},{from:"bak",to:"ba"},{from:"bel",to:"be"},{from:"bul",to:"bg"},{from:"bih",to:"bho"},{from:"bis",to:"bi"},{from:"bam",to:"bm"},{from:"ben",to:"bn"},{from:"bod",to:"bo"},{from:"bre",to:"br"},{from:"bos",to:"bs"},{from:"cat",to:"ca"},{from:"che",to:"ce"},{from:"cha",to:"ch"},{from:"cos",to:"co"},{from:"cre",to:"cr"},{from:"ces",to:"cs"},{from:"chu",to:"cu"},{from:"chv",to:"cv"},{from:"cym",to:"cy"},{from:"dan",to:"da"},{from:"deu",to:"de"},{from:"div",to:"dv"},{from:"dzo",to:"dz"},{from:"ewe",to:"ee"},{from:"ell",to:"el"},{from:"eng",to:"en"},{from:"epo",to:"eo"},{from:"spa",to:"es"},{from:"est",to:"et"},{from:"eus",to:"eu"},{from:"fas",to:"fa"},{from:"ful",to:"ff"},{from:"fin",to:"fi"},{from:"fij",to:"fj"},{from:"fao",to:"fo"},{from:"fra",to:"fr"},{from:"fry",to:"fy"},{from:"gle",to:"ga"},{from:"gla",to:"gd"},{from:"glg",to:"gl"},{from:"grn",to:"gn"},{from:"guj",to:"gu"},{from:"glv",to:"gv"},{from:"hau",to:"ha"},{from:"heb",to:"he"},{from:"hin",to:"hi"},{from:"hmo",to:"ho"},{from:"hrv",to:"hr"},{from:"hat",to:"ht"},{from:"hun",to:"hu"},{from:"hye",to:"hy"},{from:"her",to:"hz"},{from:"ina",to:"ia"},{from:"ind",to:"id"},{from:"ile",to:"ie"},{from:"ibo",to:"ig"},{from:"iii",to:"ii"},{from:"ipk",to:"ik"},{from:"ido",to:"io"},{from:"isl",to:"is"},{from:"ita",to:"it"},{from:"iku",to:"iu"},{from:"jpn",to:"ja"},{from:"jav",to:"jv"},{from:"kat",to:"ka"},{from:"kon",to:"kg"},{from:"kik",to:"ki"},{from:"kua",to:"kj"},{from:"kaz",to:"kk"},{from:"kal",to:"kl"},{from:"khm",to:"km"},{from:"kan",to:"kn"},{from:"kor",to:"ko"},{from:"kau",to:"kr"},{from:"kas",to:"ks"},{from:"kur",to:"ku"},{from:"kom",to:"kv"},{from:"cor",to:"kw"},{from:"kir",to:"ky"},{from:"lat",to:"la"},{from:"ltz",to:"lb"},{from:"lug",to:"lg"},{from:"lim",to:"li"},{from:"lin",to:"ln"},{from:"lao",to:"lo"},{from:"lit",to:"lt"},{from:"lub",to:"lu"},{from:"lav",to:"lv"},{from:"mlg",to:"mg"},{from:"mah",to:"mh"},{from:"mri",to:"mi"},{from:"mkd",to:"mk"},{from:"mal",to:"ml"},{from:"mon",to:"mn"},{from:"mol",to:"ro"},{from:"mar",to:"mr"},{from:"msa",to:"ms"},{from:"mlt",to:"mt"},{from:"mya",to:"my"},{from:"nau",to:"na"},{from:"nob",to:"nb"},{from:"nde",to:"nd"},{from:"nep",to:"ne"},{from:"ndo",to:"ng"},{from:"nld",to:"nl"},{from:"nno",to:"nn"},{from:"nor",to:"no"},{from:"nbl",to:"nr"},{from:"nav",to:"nv"},{from:"nya",to:"ny"},{from:"oci",to:"oc"},{from:"oji",to:"oj"},{from:"orm",to:"om"},{from:"ori",to:"or"},{from:"oss",to:"os"},{from:"pan",to:"pa"},{from:"pli",to:"pi"},{from:"pol",to:"pl"},{from:"pus",to:"ps"},{from:"por",to:"pt"},{from:"que",to:"qu"},{from:"roh",to:"rm"},{from:"run",to:"rn"},{from:"ron",to:"ro"},{from:"rus",to:"ru"},{from:"kin",to:"rw"},{from:"san",to:"sa"},{from:"srd",to:"sc"},{from:"snd",to:"sd"},{from:"sme",to:"se"},{from:"sag",to:"sg"},{from:"hbs",to:"sr-latn"},{from:"sin",to:"si"},{from:"slk",to:"sk"},{from:"slv",to:"sl"},{from:"smo",to:"sm"},{from:"sna",to:"sn"},{from:"som",to:"so"},{from:"sqi",to:"sq"},{from:"srp",to:"sr"},{from:"ssw",to:"ss"},{from:"sot",to:"st"},{from:"sun",to:"su"},{from:"swe",to:"sv"},{from:"swa",to:"sw"},{from:"tam",to:"ta"},{from:"tel",to:"te"},{from:"tgk",to:"tg"},{from:"tha",to:"th"},{from:"tir",to:"ti"},{from:"tuk",to:"tk"},{from:"tgl",to:"fil"},{from:"tsn",to:"tn"},{from:"ton",to:"to"},{from:"tur",to:"tr"},{from:"tso",to:"ts"},{from:"tat",to:"tt"},{from:"twi",to:"ak"},{from:"tah",to:"ty"},{from:"uig",to:"ug"},{from:"ukr",to:"uk"},{from:"urd",to:"ur"},{from:"uzb",to:"uz"},{from:"ven",to:"ve"},{from:"vie",to:"vi"},{from:"vol",to:"vo"},{from:"wln",to:"wa"},{from:"wol",to:"wo"},{from:"xho",to:"xh"},{from:"yid",to:"yi"},{from:"yor",to:"yo"},{from:"zha",to:"za"},{from:"zho",to:"zh"},{from:"zul",to:"zu"},{from:"alb",to:"sq"},{from:"arm",to:"hy"},{from:"baq",to:"eu"},{from:"bur",to:"my"},{from:"chi",to:"zh"},{from:"cze",to:"cs"},{from:"dut",to:"nl"},{from:"fre",to:"fr"},{from:"geo",to:"ka"},{from:"ger",to:"de"},{from:"gre",to:"el"},{from:"ice",to:"is"},{from:"mac",to:"mk"},{from:"mao",to:"mi"},{from:"may",to:"ms"},{from:"per",to:"fa"},{from:"rum",to:"ro"},{from:"slo",to:"sk"},{from:"tib",to:"bo"},{from:"wel",to:"cy"},{from:"und-aaland",to:"und-ax"},{from:"hy-arevmda",to:"hyw"},{from:"und-arevmda",to:"und"},{from:"und-arevela",to:"und"},{from:"und-lojban",to:"und"},{from:"und-saaho",to:"und"},{from:"und-bokmal",to:"und"},{from:"und-nynorsk",to:"und"},{from:"und-hakka",to:"und"},{from:"und-xiang",to:"und"},{from:"und-hepburn-heploc",to:"und-alalc97"}],Ii=[{from:{field:"script",value:"qaai"},to:{field:"script",value:"zinh"}},{from:{field:"region",value:"bu"},to:{field:"region",value:"mm"}},{from:{field:"region",value:"ct"},to:{field:"region",value:"ki"}},{from:{field:"region",value:"dd"},to:{field:"region",value:"de"}},{from:{field:"region",value:"dy"},to:{field:"region",value:"bj"}},{from:{field:"region",value:"fx"},to:{field:"region",value:"fr"}},{from:{field:"region",value:"hv"},to:{field:"region",value:"bf"}},{from:{field:"region",value:"jt"},to:{field:"region",value:"um"}},{from:{field:"region",value:"mi"},to:{field:"region",value:"um"}},{from:{field:"region",value:"nh"},to:{field:"region",value:"vu"}},{from:{field:"region",value:"nq"},to:{field:"region",value:"aq"}},{from:{field:"region",value:"pu"},to:{field:"region",value:"um"}},{from:{field:"region",value:"pz"},to:{field:"region",value:"pa"}},{from:{field:"region",value:"qu"},to:{field:"region",value:"eu"}},{from:{field:"region",value:"rh"},to:{field:"region",value:"zw"}},{from:{field:"region",value:"tp"},to:{field:"region",value:"tl"}},{from:{field:"region",value:"uk"},to:{field:"region",value:"gb"}},{from:{field:"region",value:"vd"},to:{field:"region",value:"vn"}},{from:{field:"region",value:"wk"},to:{field:"region",value:"um"}},{from:{field:"region",value:"yd"},to:{field:"region",value:"ye"}},{from:{field:"region",value:"zr"},to:{field:"region",value:"cd"}},{from:{field:"region",value:"230"},to:{field:"region",value:"et"}},{from:{field:"region",value:"280"},to:{field:"region",value:"de"}},{from:{field:"region",value:"736"},to:{field:"region",value:"sd"}},{from:{field:"region",value:"886"},to:{field:"region",value:"ye"}},{from:{field:"region",value:"958"},to:{field:"region",value:"aa"}},{from:{field:"region",value:"020"},to:{field:"region",value:"ad"}},{from:{field:"region",value:"784"},to:{field:"region",value:"ae"}},{from:{field:"region",value:"004"},to:{field:"region",value:"af"}},{from:{field:"region",value:"028"},to:{field:"region",value:"ag"}},{from:{field:"region",value:"660"},to:{field:"region",value:"ai"}},{from:{field:"region",value:"008"},to:{field:"region",value:"al"}},{from:{field:"region",value:"051"},to:{field:"region",value:"am"}},{from:{field:"region",value:"024"},to:{field:"region",value:"ao"}},{from:{field:"region",value:"010"},to:{field:"region",value:"aq"}},{from:{field:"region",value:"032"},to:{field:"region",value:"ar"}},{from:{field:"region",value:"016"},to:{field:"region",value:"as"}},{from:{field:"region",value:"040"},to:{field:"region",value:"at"}},{from:{field:"region",value:"036"},to:{field:"region",value:"au"}},{from:{field:"region",value:"533"},to:{field:"region",value:"aw"}},{from:{field:"region",value:"248"},to:{field:"region",value:"ax"}},{from:{field:"region",value:"031"},to:{field:"region",value:"az"}},{from:{field:"region",value:"070"},to:{field:"region",value:"ba"}},{from:{field:"region",value:"052"},to:{field:"region",value:"bb"}},{from:{field:"region",value:"050"},to:{field:"region",value:"bd"}},{from:{field:"region",value:"056"},to:{field:"region",value:"be"}},{from:{field:"region",value:"854"},to:{field:"region",value:"bf"}},{from:{field:"region",value:"100"},to:{field:"region",value:"bg"}},{from:{field:"region",value:"048"},to:{field:"region",value:"bh"}},{from:{field:"region",value:"108"},to:{field:"region",value:"bi"}},{from:{field:"region",value:"204"},to:{field:"region",value:"bj"}},{from:{field:"region",value:"652"},to:{field:"region",value:"bl"}},{from:{field:"region",value:"060"},to:{field:"region",value:"bm"}},{from:{field:"region",value:"096"},to:{field:"region",value:"bn"}},{from:{field:"region",value:"068"},to:{field:"region",value:"bo"}},{from:{field:"region",value:"535"},to:{field:"region",value:"bq"}},{from:{field:"region",value:"076"},to:{field:"region",value:"br"}},{from:{field:"region",value:"044"},to:{field:"region",value:"bs"}},{from:{field:"region",value:"064"},to:{field:"region",value:"bt"}},{from:{field:"region",value:"104"},to:{field:"region",value:"mm"}},{from:{field:"region",value:"074"},to:{field:"region",value:"bv"}},{from:{field:"region",value:"072"},to:{field:"region",value:"bw"}},{from:{field:"region",value:"112"},to:{field:"region",value:"by"}},{from:{field:"region",value:"084"},to:{field:"region",value:"bz"}},{from:{field:"region",value:"124"},to:{field:"region",value:"ca"}},{from:{field:"region",value:"166"},to:{field:"region",value:"cc"}},{from:{field:"region",value:"180"},to:{field:"region",value:"cd"}},{from:{field:"region",value:"140"},to:{field:"region",value:"cf"}},{from:{field:"region",value:"178"},to:{field:"region",value:"cg"}},{from:{field:"region",value:"756"},to:{field:"region",value:"ch"}},{from:{field:"region",value:"384"},to:{field:"region",value:"ci"}},{from:{field:"region",value:"184"},to:{field:"region",value:"ck"}},{from:{field:"region",value:"152"},to:{field:"region",value:"cl"}},{from:{field:"region",value:"120"},to:{field:"region",value:"cm"}},{from:{field:"region",value:"156"},to:{field:"region",value:"cn"}},{from:{field:"region",value:"170"},to:{field:"region",value:"co"}},{from:{field:"region",value:"188"},to:{field:"region",value:"cr"}},{from:{field:"region",value:"192"},to:{field:"region",value:"cu"}},{from:{field:"region",value:"132"},to:{field:"region",value:"cv"}},{from:{field:"region",value:"531"},to:{field:"region",value:"cw"}},{from:{field:"region",value:"162"},to:{field:"region",value:"cx"}},{from:{field:"region",value:"196"},to:{field:"region",value:"cy"}},{from:{field:"region",value:"203"},to:{field:"region",value:"cz"}},{from:{field:"region",value:"278"},to:{field:"region",value:"de"}},{from:{field:"region",value:"276"},to:{field:"region",value:"de"}},{from:{field:"region",value:"262"},to:{field:"region",value:"dj"}},{from:{field:"region",value:"208"},to:{field:"region",value:"dk"}},{from:{field:"region",value:"212"},to:{field:"region",value:"dm"}},{from:{field:"region",value:"214"},to:{field:"region",value:"do"}},{from:{field:"region",value:"012"},to:{field:"region",value:"dz"}},{from:{field:"region",value:"218"},to:{field:"region",value:"ec"}},{from:{field:"region",value:"233"},to:{field:"region",value:"ee"}},{from:{field:"region",value:"818"},to:{field:"region",value:"eg"}},{from:{field:"region",value:"732"},to:{field:"region",value:"eh"}},{from:{field:"region",value:"232"},to:{field:"region",value:"er"}},{from:{field:"region",value:"724"},to:{field:"region",value:"es"}},{from:{field:"region",value:"231"},to:{field:"region",value:"et"}},{from:{field:"region",value:"246"},to:{field:"region",value:"fi"}},{from:{field:"region",value:"242"},to:{field:"region",value:"fj"}},{from:{field:"region",value:"238"},to:{field:"region",value:"fk"}},{from:{field:"region",value:"583"},to:{field:"region",value:"fm"}},{from:{field:"region",value:"234"},to:{field:"region",value:"fo"}},{from:{field:"region",value:"250"},to:{field:"region",value:"fr"}},{from:{field:"region",value:"249"},to:{field:"region",value:"fr"}},{from:{field:"region",value:"266"},to:{field:"region",value:"ga"}},{from:{field:"region",value:"826"},to:{field:"region",value:"gb"}},{from:{field:"region",value:"308"},to:{field:"region",value:"gd"}},{from:{field:"region",value:"268"},to:{field:"region",value:"ge"}},{from:{field:"region",value:"254"},to:{field:"region",value:"gf"}},{from:{field:"region",value:"831"},to:{field:"region",value:"gg"}},{from:{field:"region",value:"288"},to:{field:"region",value:"gh"}},{from:{field:"region",value:"292"},to:{field:"region",value:"gi"}},{from:{field:"region",value:"304"},to:{field:"region",value:"gl"}},{from:{field:"region",value:"270"},to:{field:"region",value:"gm"}},{from:{field:"region",value:"324"},to:{field:"region",value:"gn"}},{from:{field:"region",value:"312"},to:{field:"region",value:"gp"}},{from:{field:"region",value:"226"},to:{field:"region",value:"gq"}},{from:{field:"region",value:"300"},to:{field:"region",value:"gr"}},{from:{field:"region",value:"239"},to:{field:"region",value:"gs"}},{from:{field:"region",value:"320"},to:{field:"region",value:"gt"}},{from:{field:"region",value:"316"},to:{field:"region",value:"gu"}},{from:{field:"region",value:"624"},to:{field:"region",value:"gw"}},{from:{field:"region",value:"328"},to:{field:"region",value:"gy"}},{from:{field:"region",value:"344"},to:{field:"region",value:"hk"}},{from:{field:"region",value:"334"},to:{field:"region",value:"hm"}},{from:{field:"region",value:"340"},to:{field:"region",value:"hn"}},{from:{field:"region",value:"191"},to:{field:"region",value:"hr"}},{from:{field:"region",value:"332"},to:{field:"region",value:"ht"}},{from:{field:"region",value:"348"},to:{field:"region",value:"hu"}},{from:{field:"region",value:"360"},to:{field:"region",value:"id"}},{from:{field:"region",value:"372"},to:{field:"region",value:"ie"}},{from:{field:"region",value:"376"},to:{field:"region",value:"il"}},{from:{field:"region",value:"833"},to:{field:"region",value:"im"}},{from:{field:"region",value:"356"},to:{field:"region",value:"in"}},{from:{field:"region",value:"086"},to:{field:"region",value:"io"}},{from:{field:"region",value:"368"},to:{field:"region",value:"iq"}},{from:{field:"region",value:"364"},to:{field:"region",value:"ir"}},{from:{field:"region",value:"352"},to:{field:"region",value:"is"}},{from:{field:"region",value:"380"},to:{field:"region",value:"it"}},{from:{field:"region",value:"832"},to:{field:"region",value:"je"}},{from:{field:"region",value:"388"},to:{field:"region",value:"jm"}},{from:{field:"region",value:"400"},to:{field:"region",value:"jo"}},{from:{field:"region",value:"392"},to:{field:"region",value:"jp"}},{from:{field:"region",value:"404"},to:{field:"region",value:"ke"}},{from:{field:"region",value:"417"},to:{field:"region",value:"kg"}},{from:{field:"region",value:"116"},to:{field:"region",value:"kh"}},{from:{field:"region",value:"296"},to:{field:"region",value:"ki"}},{from:{field:"region",value:"174"},to:{field:"region",value:"km"}},{from:{field:"region",value:"659"},to:{field:"region",value:"kn"}},{from:{field:"region",value:"408"},to:{field:"region",value:"kp"}},{from:{field:"region",value:"410"},to:{field:"region",value:"kr"}},{from:{field:"region",value:"414"},to:{field:"region",value:"kw"}},{from:{field:"region",value:"136"},to:{field:"region",value:"ky"}},{from:{field:"region",value:"398"},to:{field:"region",value:"kz"}},{from:{field:"region",value:"418"},to:{field:"region",value:"la"}},{from:{field:"region",value:"422"},to:{field:"region",value:"lb"}},{from:{field:"region",value:"662"},to:{field:"region",value:"lc"}},{from:{field:"region",value:"438"},to:{field:"region",value:"li"}},{from:{field:"region",value:"144"},to:{field:"region",value:"lk"}},{from:{field:"region",value:"430"},to:{field:"region",value:"lr"}},{from:{field:"region",value:"426"},to:{field:"region",value:"ls"}},{from:{field:"region",value:"440"},to:{field:"region",value:"lt"}},{from:{field:"region",value:"442"},to:{field:"region",value:"lu"}},{from:{field:"region",value:"428"},to:{field:"region",value:"lv"}},{from:{field:"region",value:"434"},to:{field:"region",value:"ly"}},{from:{field:"region",value:"504"},to:{field:"region",value:"ma"}},{from:{field:"region",value:"492"},to:{field:"region",value:"mc"}},{from:{field:"region",value:"498"},to:{field:"region",value:"md"}},{from:{field:"region",value:"499"},to:{field:"region",value:"me"}},{from:{field:"region",value:"663"},to:{field:"region",value:"mf"}},{from:{field:"region",value:"450"},to:{field:"region",value:"mg"}},{from:{field:"region",value:"584"},to:{field:"region",value:"mh"}},{from:{field:"region",value:"807"},to:{field:"region",value:"mk"}},{from:{field:"region",value:"466"},to:{field:"region",value:"ml"}},{from:{field:"region",value:"496"},to:{field:"region",value:"mn"}},{from:{field:"region",value:"446"},to:{field:"region",value:"mo"}},{from:{field:"region",value:"580"},to:{field:"region",value:"mp"}},{from:{field:"region",value:"474"},to:{field:"region",value:"mq"}},{from:{field:"region",value:"478"},to:{field:"region",value:"mr"}},{from:{field:"region",value:"500"},to:{field:"region",value:"ms"}},{from:{field:"region",value:"470"},to:{field:"region",value:"mt"}},{from:{field:"region",value:"480"},to:{field:"region",value:"mu"}},{from:{field:"region",value:"462"},to:{field:"region",value:"mv"}},{from:{field:"region",value:"454"},to:{field:"region",value:"mw"}},{from:{field:"region",value:"484"},to:{field:"region",value:"mx"}},{from:{field:"region",value:"458"},to:{field:"region",value:"my"}},{from:{field:"region",value:"508"},to:{field:"region",value:"mz"}},{from:{field:"region",value:"516"},to:{field:"region",value:"na"}},{from:{field:"region",value:"540"},to:{field:"region",value:"nc"}},{from:{field:"region",value:"562"},to:{field:"region",value:"ne"}},{from:{field:"region",value:"574"},to:{field:"region",value:"nf"}},{from:{field:"region",value:"566"},to:{field:"region",value:"ng"}},{from:{field:"region",value:"558"},to:{field:"region",value:"ni"}},{from:{field:"region",value:"528"},to:{field:"region",value:"nl"}},{from:{field:"region",value:"578"},to:{field:"region",value:"no"}},{from:{field:"region",value:"524"},to:{field:"region",value:"np"}},{from:{field:"region",value:"520"},to:{field:"region",value:"nr"}},{from:{field:"region",value:"570"},to:{field:"region",value:"nu"}},{from:{field:"region",value:"554"},to:{field:"region",value:"nz"}},{from:{field:"region",value:"512"},to:{field:"region",value:"om"}},{from:{field:"region",value:"591"},to:{field:"region",value:"pa"}},{from:{field:"region",value:"604"},to:{field:"region",value:"pe"}},{from:{field:"region",value:"258"},to:{field:"region",value:"pf"}},{from:{field:"region",value:"598"},to:{field:"region",value:"pg"}},{from:{field:"region",value:"608"},to:{field:"region",value:"ph"}},{from:{field:"region",value:"586"},to:{field:"region",value:"pk"}},{from:{field:"region",value:"616"},to:{field:"region",value:"pl"}},{from:{field:"region",value:"666"},to:{field:"region",value:"pm"}},{from:{field:"region",value:"612"},to:{field:"region",value:"pn"}},{from:{field:"region",value:"630"},to:{field:"region",value:"pr"}},{from:{field:"region",value:"275"},to:{field:"region",value:"ps"}},{from:{field:"region",value:"620"},to:{field:"region",value:"pt"}},{from:{field:"region",value:"585"},to:{field:"region",value:"pw"}},{from:{field:"region",value:"600"},to:{field:"region",value:"py"}},{from:{field:"region",value:"634"},to:{field:"region",value:"qa"}},{from:{field:"region",value:"959"},to:{field:"region",value:"qm"}},{from:{field:"region",value:"960"},to:{field:"region",value:"qn"}},{from:{field:"region",value:"962"},to:{field:"region",value:"qp"}},{from:{field:"region",value:"963"},to:{field:"region",value:"qq"}},{from:{field:"region",value:"964"},to:{field:"region",value:"qr"}},{from:{field:"region",value:"965"},to:{field:"region",value:"qs"}},{from:{field:"region",value:"966"},to:{field:"region",value:"qt"}},{from:{field:"region",value:"967"},to:{field:"region",value:"eu"}},{from:{field:"region",value:"968"},to:{field:"region",value:"qv"}},{from:{field:"region",value:"969"},to:{field:"region",value:"qw"}},{from:{field:"region",value:"970"},to:{field:"region",value:"qx"}},{from:{field:"region",value:"971"},to:{field:"region",value:"qy"}},{from:{field:"region",value:"972"},to:{field:"region",value:"qz"}},{from:{field:"region",value:"638"},to:{field:"region",value:"re"}},{from:{field:"region",value:"642"},to:{field:"region",value:"ro"}},{from:{field:"region",value:"688"},to:{field:"region",value:"rs"}},{from:{field:"region",value:"643"},to:{field:"region",value:"ru"}},{from:{field:"region",value:"646"},to:{field:"region",value:"rw"}},{from:{field:"region",value:"682"},to:{field:"region",value:"sa"}},{from:{field:"region",value:"090"},to:{field:"region",value:"sb"}},{from:{field:"region",value:"690"},to:{field:"region",value:"sc"}},{from:{field:"region",value:"729"},to:{field:"region",value:"sd"}},{from:{field:"region",value:"752"},to:{field:"region",value:"se"}},{from:{field:"region",value:"702"},to:{field:"region",value:"sg"}},{from:{field:"region",value:"654"},to:{field:"region",value:"sh"}},{from:{field:"region",value:"705"},to:{field:"region",value:"si"}},{from:{field:"region",value:"744"},to:{field:"region",value:"sj"}},{from:{field:"region",value:"703"},to:{field:"region",value:"sk"}},{from:{field:"region",value:"694"},to:{field:"region",value:"sl"}},{from:{field:"region",value:"674"},to:{field:"region",value:"sm"}},{from:{field:"region",value:"686"},to:{field:"region",value:"sn"}},{from:{field:"region",value:"706"},to:{field:"region",value:"so"}},{from:{field:"region",value:"740"},to:{field:"region",value:"sr"}},{from:{field:"region",value:"728"},to:{field:"region",value:"ss"}},{from:{field:"region",value:"678"},to:{field:"region",value:"st"}},{from:{field:"region",value:"222"},to:{field:"region",value:"sv"}},{from:{field:"region",value:"534"},to:{field:"region",value:"sx"}},{from:{field:"region",value:"760"},to:{field:"region",value:"sy"}},{from:{field:"region",value:"748"},to:{field:"region",value:"sz"}},{from:{field:"region",value:"796"},to:{field:"region",value:"tc"}},{from:{field:"region",value:"148"},to:{field:"region",value:"td"}},{from:{field:"region",value:"260"},to:{field:"region",value:"tf"}},{from:{field:"region",value:"768"},to:{field:"region",value:"tg"}},{from:{field:"region",value:"764"},to:{field:"region",value:"th"}},{from:{field:"region",value:"762"},to:{field:"region",value:"tj"}},{from:{field:"region",value:"772"},to:{field:"region",value:"tk"}},{from:{field:"region",value:"626"},to:{field:"region",value:"tl"}},{from:{field:"region",value:"795"},to:{field:"region",value:"tm"}},{from:{field:"region",value:"788"},to:{field:"region",value:"tn"}},{from:{field:"region",value:"776"},to:{field:"region",value:"to"}},{from:{field:"region",value:"792"},to:{field:"region",value:"tr"}},{from:{field:"region",value:"780"},to:{field:"region",value:"tt"}},{from:{field:"region",value:"798"},to:{field:"region",value:"tv"}},{from:{field:"region",value:"158"},to:{field:"region",value:"tw"}},{from:{field:"region",value:"834"},to:{field:"region",value:"tz"}},{from:{field:"region",value:"804"},to:{field:"region",value:"ua"}},{from:{field:"region",value:"800"},to:{field:"region",value:"ug"}},{from:{field:"region",value:"581"},to:{field:"region",value:"um"}},{from:{field:"region",value:"840"},to:{field:"region",value:"us"}},{from:{field:"region",value:"858"},to:{field:"region",value:"uy"}},{from:{field:"region",value:"860"},to:{field:"region",value:"uz"}},{from:{field:"region",value:"336"},to:{field:"region",value:"va"}},{from:{field:"region",value:"670"},to:{field:"region",value:"vc"}},{from:{field:"region",value:"862"},to:{field:"region",value:"ve"}},{from:{field:"region",value:"092"},to:{field:"region",value:"vg"}},{from:{field:"region",value:"850"},to:{field:"region",value:"vi"}},{from:{field:"region",value:"704"},to:{field:"region",value:"vn"}},{from:{field:"region",value:"548"},to:{field:"region",value:"vu"}},{from:{field:"region",value:"876"},to:{field:"region",value:"wf"}},{from:{field:"region",value:"882"},to:{field:"region",value:"ws"}},{from:{field:"region",value:"973"},to:{field:"region",value:"xa"}},{from:{field:"region",value:"974"},to:{field:"region",value:"xb"}},{from:{field:"region",value:"975"},to:{field:"region",value:"xc"}},{from:{field:"region",value:"976"},to:{field:"region",value:"xd"}},{from:{field:"region",value:"977"},to:{field:"region",value:"xe"}},{from:{field:"region",value:"978"},to:{field:"region",value:"xf"}},{from:{field:"region",value:"979"},to:{field:"region",value:"xg"}},{from:{field:"region",value:"980"},to:{field:"region",value:"xh"}},{from:{field:"region",value:"981"},to:{field:"region",value:"xi"}},{from:{field:"region",value:"982"},to:{field:"region",value:"xj"}},{from:{field:"region",value:"983"},to:{field:"region",value:"xk"}},{from:{field:"region",value:"984"},to:{field:"region",value:"xl"}},{from:{field:"region",value:"985"},to:{field:"region",value:"xm"}},{from:{field:"region",value:"986"},to:{field:"region",value:"xn"}},{from:{field:"region",value:"987"},to:{field:"region",value:"xo"}},{from:{field:"region",value:"988"},to:{field:"region",value:"xp"}},{from:{field:"region",value:"989"},to:{field:"region",value:"xq"}},{from:{field:"region",value:"990"},to:{field:"region",value:"xr"}},{from:{field:"region",value:"991"},to:{field:"region",value:"xs"}},{from:{field:"region",value:"992"},to:{field:"region",value:"xt"}},{from:{field:"region",value:"993"},to:{field:"region",value:"xu"}},{from:{field:"region",value:"994"},to:{field:"region",value:"xv"}},{from:{field:"region",value:"995"},to:{field:"region",value:"xw"}},{from:{field:"region",value:"996"},to:{field:"region",value:"xx"}},{from:{field:"region",value:"997"},to:{field:"region",value:"xy"}},{from:{field:"region",value:"998"},to:{field:"region",value:"xz"}},{from:{field:"region",value:"720"},to:{field:"region",value:"ye"}},{from:{field:"region",value:"887"},to:{field:"region",value:"ye"}},{from:{field:"region",value:"175"},to:{field:"region",value:"yt"}},{from:{field:"region",value:"710"},to:{field:"region",value:"za"}},{from:{field:"region",value:"894"},to:{field:"region",value:"zm"}},{from:{field:"region",value:"716"},to:{field:"region",value:"zw"}},{from:{field:"region",value:"999"},to:{field:"region",value:"zz"}},{from:{field:"variants",value:"polytoni"},to:{field:"variants",value:"polyton"}},{from:{field:"variants",value:"heploc"},to:{field:"variants",value:"alalc97"}}],yo={region:{172:["ru","am","az","by","ge","kg","kz","md","tj","tm","ua","uz"],200:["cz","sk"],530:["cw","sx","bq"],532:["cw","sx","bq"],536:["sa","iq"],582:["fm","mh","mp","pw"],810:["ru","am","az","by","ee","ge","kz","kg","lv","lt","md","tj","tm","ua","uz"],830:["je","gg"],890:["rs","me","si","hr","mk","ba"],891:["rs","me"],an:["cw","sx","bq"],cs:["rs","me"],fq:["aq","tf"],nt:["sa","iq"],pc:["fm","mh","mp","pw"],su:["ru","am","az","by","ee","ge","kz","kg","lv","lt","md","tj","tm","ua","uz"],yu:["rs","me"],"062":["034","143"],ant:["cw","sx","bq"],scg:["rs","me"],ntz:["sa","iq"],sun:["ru","am","az","by","ee","ge","kz","kg","lv","lt","md","tj","tm","ua","uz"],yug:["rs","me"]}},ss={aa:"aa-latn-et",aaa:"aaa-latn-ng",aab:"aab-latn-ng",aac:"aac-latn-pg",aad:"aad-latn-pg",aae:"aae-latn-it","aae-grek":"aae-grek-it",aaf:"aaf-mlym-in","aaf-arab":"aaf-arab-in",aag:"aag-latn-pg",aah:"aah-latn-pg",aai:"aai-latn-zz",aak:"aak-latn-zz",aal:"aal-latn-cm",aan:"aan-latn-br",aao:"aao-arab-dz",aap:"aap-latn-br",aaq:"aaq-latn-us",aas:"aas-latn-tz",aat:"aat-grek-gr",aau:"aau-latn-zz",aaw:"aaw-latn-pg",aax:"aax-latn-id",aaz:"aaz-latn-id",ab:"ab-cyrl-ge",aba:"aba-latn-ci",abb:"abb-latn-cm",abc:"abc-latn-ph",abd:"abd-latn-ph",abe:"abe-latn-ca",abf:"abf-latn-my",abg:"abg-latn-pg",abh:"abh-arab-tj",abi:"abi-latn-zz",abl:"abl-rjng-id","abl-latn":"abl-latn-id",abm:"abm-latn-ng",abn:"abn-latn-ng",abo:"abo-latn-ng",abp:"abp-latn-ph",abq:"abq-cyrl-zz",abr:"abr-latn-gh",abs:"abs-latn-id",abt:"abt-latn-zz",abu:"abu-latn-ci",abv:"abv-arab-bh",abw:"abw-latn-pg",abx:"abx-latn-ph",aby:"aby-latn-zz",abz:"abz-latn-id",aca:"aca-latn-co",acb:"acb-latn-ng",acd:"acd-latn-zz",ace:"ace-latn-id",acf:"acf-latn-lc",ach:"ach-latn-ug",acm:"acm-arab-iq",acn:"acn-latn-cn",acp:"acp-latn-ng",acq:"acq-arab-ye",acr:"acr-latn-gt",acs:"acs-latn-br",act:"act-latn-nl",acu:"acu-latn-ec",acv:"acv-latn-us",acw:"acw-arab-sa",acx:"acx-arab-om",acy:"acy-latn-cy","acy-arab":"acy-arab-cy","acy-grek":"acy-grek-cy",acz:"acz-latn-sd",ada:"ada-latn-gh",adb:"adb-latn-tl",add:"add-latn-cm",ade:"ade-latn-zz",adf:"adf-arab-om",adg:"adg-latn-au",adh:"adh-latn-ug",adi:"adi-latn-in","adi-tibt":"adi-tibt-cn",adj:"adj-latn-zz",adl:"adl-latn-in",adn:"adn-latn-id",ado:"ado-latn-pg",adp:"adp-tibt-bt",adq:"adq-latn-gh",adr:"adr-latn-id",adt:"adt-latn-au",adu:"adu-latn-ng",adw:"adw-latn-br",adx:"adx-tibt-cn",ady:"ady-cyrl-ru",adz:"adz-latn-zz",ae:"ae-avst-ir",aea:"aea-latn-au",aeb:"aeb-arab-tn",aec:"aec-arab-eg",aee:"aee-arab-af",aek:"aek-latn-nc",ael:"ael-latn-cm",aem:"aem-latn-vn",aeq:"aeq-arab-pk",aer:"aer-latn-au",aeu:"aeu-latn-cn",aew:"aew-latn-pg",aey:"aey-latn-zz",aez:"aez-latn-pg",af:"af-latn-za",afb:"afb-arab-kw",afd:"afd-latn-pg",afe:"afe-latn-ng",afh:"afh-latn-gh",afi:"afi-latn-pg",afk:"afk-latn-pg",afn:"afn-latn-ng",afo:"afo-latn-ng",afp:"afp-latn-pg",afs:"afs-latn-mx",afu:"afu-latn-gh",afz:"afz-latn-id",aga:"aga-latn-pe",agb:"agb-latn-ng",agc:"agc-latn-zz",agd:"agd-latn-zz",age:"age-latn-pg",agf:"agf-latn-id",agg:"agg-latn-zz",agh:"agh-latn-cd",agi:"agi-deva-in",agj:"agj-ethi-et","agj-arab":"agj-arab-et",agk:"agk-latn-ph",agl:"agl-latn-pg",agm:"agm-latn-zz",agn:"agn-latn-ph",ago:"ago-latn-zz",agq:"agq-latn-cm",agr:"agr-latn-pe",ags:"ags-latn-cm",agt:"agt-latn-ph",agu:"agu-latn-gt",agv:"agv-latn-ph",agw:"agw-latn-sb",agx:"agx-cyrl-ru",agy:"agy-latn-ph",agz:"agz-latn-ph",aha:"aha-latn-zz",ahb:"ahb-latn-vu",ahg:"ahg-ethi-et",ahh:"ahh-latn-id",ahi:"ahi-latn-ci",ahk:"ahk-latn-mm","ahk-mymr":"ahk-mymr-mm","ahk-th":"ahk-latn-th","ahk-thai":"ahk-thai-th",ahl:"ahl-latn-zz",ahm:"ahm-latn-ci",ahn:"ahn-latn-ng",aho:"aho-ahom-in",ahp:"ahp-latn-ci",ahr:"ahr-deva-in",ahs:"ahs-latn-ng",aht:"aht-latn-us",aia:"aia-latn-sb",aib:"aib-arab-cn",aic:"aic-latn-pg",aid:"aid-latn-au",aie:"aie-latn-pg",aif:"aif-latn-pg",aig:"aig-latn-ag",aij:"aij-hebr-il",aik:"aik-latn-ng",ail:"ail-latn-pg",aim:"aim-latn-in",ain:"ain-kana-jp","ain-latn":"ain-latn-jp",aio:"aio-mymr-in",aip:"aip-latn-id",aiq:"aiq-arab-af",air:"air-latn-id",ait:"ait-latn-br",aiw:"aiw-latn-et","aiw-arab":"aiw-arab-et","aiw-ethi":"aiw-ethi-et",aix:"aix-latn-pg",aiy:"aiy-latn-cf",aja:"aja-latn-ss",ajg:"ajg-latn-zz",aji:"aji-latn-nc",ajn:"ajn-latn-au",ajp:"ajp-arab-jo",ajt:"ajt-arab-tn",ajw:"ajw-latn-ng",ajz:"ajz-latn-in",ak:"ak-latn-gh",akb:"akb-latn-id","akb-batk":"akb-batk-id",akc:"akc-latn-id",akd:"akd-latn-ng",ake:"ake-latn-gy",akf:"akf-latn-ng",akg:"akg-latn-id",akh:"akh-latn-pg",aki:"aki-latn-pg",akk:"akk-xsux-iq",akl:"akl-latn-ph",ako:"ako-latn-sr",akp:"akp-latn-gh",akq:"akq-latn-pg",akr:"akr-latn-vu",aks:"aks-latn-tg",akt:"akt-latn-pg",aku:"aku-latn-cm",akv:"akv-cyrl-ru",akw:"akw-latn-cg",akz:"akz-latn-us",ala:"ala-latn-zz",alc:"alc-latn-cl",ald:"ald-latn-ci",ale:"ale-latn-us",alf:"alf-latn-ng",alh:"alh-latn-au",ali:"ali-latn-zz",alj:"alj-latn-ph",alk:"alk-laoo-la",all:"all-mlym-in",alm:"alm-latn-vu",aln:"aln-latn-xk",alo:"alo-latn-id",alp:"alp-latn-id",alq:"alq-latn-ca",alr:"alr-cyrl-ru",alt:"alt-cyrl-ru",alu:"alu-latn-sb",alw:"alw-ethi-et",alx:"alx-latn-pg",aly:"aly-latn-au",alz:"alz-latn-cd",am:"am-ethi-et",ama:"ama-latn-br",amb:"amb-latn-ng",amc:"amc-latn-pe",ame:"ame-latn-pe",amf:"amf-latn-et","amf-ethi":"amf-ethi-et",amg:"amg-latn-au",ami:"ami-latn-tw",amj:"amj-latn-td",amk:"amk-latn-id",amm:"amm-latn-zz",amn:"amn-latn-zz",amo:"amo-latn-ng",amp:"amp-latn-zz",amq:"amq-latn-id",amr:"amr-latn-pe",ams:"ams-jpan-jp",amt:"amt-latn-pg",amu:"amu-latn-mx",amv:"amv-latn-id",amw:"amw-syrc-sy","amw-arab":"amw-arab-sy","amw-armi":"amw-armi-sy","amw-latn":"amw-latn-sy",amx:"amx-latn-au",amy:"amy-latn-au",amz:"amz-latn-au",an:"an-latn-es",ana:"ana-latn-co",anb:"anb-latn-pe",anc:"anc-latn-zz",and:"and-latn-id",ane:"ane-latn-nc",anf:"anf-latn-gh",ang:"ang-latn-gb",anh:"anh-latn-pg",ani:"ani-cyrl-ru",anj:"anj-latn-pg",ank:"ank-latn-zz",anl:"anl-latn-mm",anm:"anm-latn-in",ann:"ann-latn-ng",ano:"ano-latn-co",anp:"anp-deva-in",anr:"anr-deva-in",ans:"ans-latn-co",ant:"ant-latn-au",anu:"anu-ethi-et","anu-arab":"anu-arab-ss","anu-latn":"anu-latn-ss",anv:"anv-latn-cm",anw:"anw-latn-ng",anx:"anx-latn-pg",any:"any-latn-zz",anz:"anz-latn-pg",aoa:"aoa-latn-st",aob:"aob-latn-pg",aoc:"aoc-latn-ve",aod:"aod-latn-pg",aoe:"aoe-latn-pg",aof:"aof-latn-pg",aog:"aog-latn-pg",aoi:"aoi-latn-au",aoj:"aoj-latn-zz",aok:"aok-latn-nc",aol:"aol-latn-id",aom:"aom-latn-zz",aon:"aon-latn-pg",aor:"aor-latn-vu",aos:"aos-latn-id",aot:"aot-beng-bd","aot-latn":"aot-latn-in",aox:"aox-latn-gy",aoz:"aoz-latn-id",apb:"apb-latn-sb",apc:"apc-arab-sy",apd:"apd-arab-tg",ape:"ape-latn-zz",apf:"apf-latn-ph",apg:"apg-latn-id",aph:"aph-deva-np",api:"api-latn-br",apj:"apj-latn-us",apk:"apk-latn-us",apl:"apl-latn-us",apm:"apm-latn-us",apn:"apn-latn-br",apo:"apo-latn-pg",app:"app-latn-vu",apr:"apr-latn-zz",aps:"aps-latn-zz",apt:"apt-latn-in",apu:"apu-latn-br",apv:"apv-latn-br",apw:"apw-latn-us",apx:"apx-latn-id",apy:"apy-latn-br",apz:"apz-latn-zz",aqc:"aqc-cyrl-ru",aqd:"aqd-latn-ml",aqg:"aqg-latn-ng",aqk:"aqk-latn-ng",aqm:"aqm-latn-id",aqn:"aqn-latn-ph",aqr:"aqr-latn-nc",aqt:"aqt-latn-py",aqz:"aqz-latn-br",ar:"ar-arab-eg",arc:"arc-armi-ir","arc-nbat":"arc-nbat-jo","arc-palm":"arc-palm-sy",ard:"ard-latn-au",are:"are-latn-au",arh:"arh-latn-zz",ari:"ari-latn-us",arj:"arj-latn-br",ark:"ark-latn-br",arl:"arl-latn-pe",arn:"arn-latn-cl",aro:"aro-latn-bo",arp:"arp-latn-us",arq:"arq-arab-dz",arr:"arr-latn-br",ars:"ars-arab-sa",aru:"aru-latn-br",arw:"arw-latn-sr",arx:"arx-latn-br",ary:"ary-arab-ma",arz:"arz-arab-eg",as:"as-beng-in",asa:"asa-latn-tz",asb:"asb-latn-ca",asc:"asc-latn-id",ase:"ase-sgnw-us",asg:"asg-latn-zz",ash:"ash-latn-pe",asi:"asi-latn-id",asj:"asj-latn-cm",ask:"ask-arab-af",asl:"asl-latn-id",asn:"asn-latn-br",aso:"aso-latn-zz",ass:"ass-latn-cm",ast:"ast-latn-es",asu:"asu-latn-br",asv:"asv-latn-cd",asx:"asx-latn-pg",asy:"asy-latn-id",asz:"asz-latn-id",ata:"ata-latn-zz",atb:"atb-latn-cn","atb-lisu":"atb-lisu-cn",atc:"atc-latn-pe",atd:"atd-latn-ph",ate:"ate-latn-pg",atg:"atg-latn-zz",ati:"ati-latn-ci",atj:"atj-latn-ca",atk:"atk-latn-ph",atl:"atl-latn-ph",atm:"atm-latn-ph",atn:"atn-arab-ir",ato:"ato-latn-cm",atp:"atp-latn-ph",atq:"atq-latn-id",atr:"atr-latn-br",ats:"ats-latn-us",att:"att-latn-ph",atu:"atu-latn-ss",atv:"atv-cyrl-ru",atw:"atw-latn-us",atx:"atx-latn-br",aty:"aty-latn-vu",atz:"atz-latn-ph",aua:"aua-latn-sb",auc:"auc-latn-ec",aud:"aud-latn-sb",aug:"aug-latn-bj",auh:"auh-latn-zm",aui:"aui-latn-pg",auj:"auj-arab-ly","auj-latn":"auj-latn-ly","auj-tfng":"auj-tfng-ly",auk:"auk-latn-pg",aul:"aul-latn-vu",aum:"aum-latn-ng",aun:"aun-latn-pg",auo:"auo-latn-ng",aup:"aup-latn-pg",auq:"auq-latn-id",aur:"aur-latn-pg",aut:"aut-latn-pf",auu:"auu-latn-id",auw:"auw-latn-id",auy:"auy-latn-zz",auz:"auz-arab-uz",av:"av-cyrl-ru",avb:"avb-latn-pg",avd:"avd-arab-ir",avi:"avi-latn-ci",avk:"avk-latn-001",avl:"avl-arab-zz",avm:"avm-latn-au",avn:"avn-latn-zz",avo:"avo-latn-br",avs:"avs-latn-pe",avt:"avt-latn-zz",avu:"avu-latn-zz",avv:"avv-latn-br",awa:"awa-deva-in",awb:"awb-latn-zz",awc:"awc-latn-ng",awe:"awe-latn-br",awg:"awg-latn-au",awh:"awh-latn-id",awi:"awi-latn-pg",awk:"awk-latn-au",awm:"awm-latn-pg",awn:"awn-ethi-et",awo:"awo-latn-zz",awr:"awr-latn-id",aws:"aws-latn-id",awt:"awt-latn-br",awu:"awu-latn-id",awv:"awv-latn-id",aww:"aww-latn-pg",awx:"awx-latn-zz",awy:"awy-latn-id",axb:"axb-latn-ar",axe:"axe-latn-au",axg:"axg-latn-br",axk:"axk-latn-cf",axl:"axl-latn-au",axm:"axm-armn-am",axx:"axx-latn-nc",ay:"ay-latn-bo",aya:"aya-latn-pg",ayb:"ayb-latn-zz",ayc:"ayc-latn-pe",ayd:"ayd-latn-au",aye:"aye-latn-ng",ayg:"ayg-latn-tg",ayh:"ayh-arab-ye",ayi:"ayi-latn-ng",ayk:"ayk-latn-ng",ayl:"ayl-arab-ly",ayn:"ayn-arab-ye",ayo:"ayo-latn-py",ayp:"ayp-arab-iq",ayq:"ayq-latn-pg",ays:"ays-latn-ph",ayt:"ayt-latn-ph",ayu:"ayu-latn-ng",ayz:"ayz-latn-id",az:"az-latn-az","az-arab":"az-arab-ir","az-iq":"az-arab-iq","az-ir":"az-arab-ir","az-ru":"az-cyrl-ru",azb:"azb-arab-ir","azb-cyrl":"azb-cyrl-az","azb-latn":"azb-latn-az",azd:"azd-latn-mx",azg:"azg-latn-mx",azm:"azm-latn-mx",azn:"azn-latn-mx",azo:"azo-latn-cm",azt:"azt-latn-ph",azz:"azz-latn-mx",ba:"ba-cyrl-ru",baa:"baa-latn-sb",bab:"bab-latn-gw",bac:"bac-latn-id",bae:"bae-latn-ve",baf:"baf-latn-cm",bag:"bag-latn-cm",bah:"bah-latn-bs",baj:"baj-latn-id",bal:"bal-arab-pk",ban:"ban-latn-id",bao:"bao-latn-co",bap:"bap-deva-np",bar:"bar-latn-at",bas:"bas-latn-cm",bau:"bau-latn-ng",bav:"bav-latn-zz",baw:"baw-latn-cm",bax:"bax-bamu-cm",bay:"bay-latn-id",bba:"bba-latn-zz",bbb:"bbb-latn-zz",bbc:"bbc-latn-id",bbd:"bbd-latn-zz",bbe:"bbe-latn-cd",bbf:"bbf-latn-pg",bbg:"bbg-latn-ga",bbi:"bbi-latn-cm",bbj:"bbj-latn-cm",bbk:"bbk-latn-cm",bbl:"bbl-geor-ge",bbm:"bbm-latn-cd",bbn:"bbn-latn-pg",bbo:"bbo-latn-bf",bbp:"bbp-latn-zz",bbq:"bbq-latn-cm",bbr:"bbr-latn-zz",bbs:"bbs-latn-ng",bbt:"bbt-latn-ng",bbu:"bbu-latn-ng",bbv:"bbv-latn-pg",bbw:"bbw-latn-cm",bbx:"bbx-latn-cm",bby:"bby-latn-cm",bca:"bca-latn-cn","bca-hani":"bca-hani-cn",bcb:"bcb-latn-sn",bcd:"bcd-latn-id",bce:"bce-latn-cm",bcf:"bcf-latn-zz",bcg:"bcg-latn-gn",bch:"bch-latn-zz",bci:"bci-latn-ci",bcj:"bcj-latn-au",bck:"bck-latn-au",bcm:"bcm-latn-zz",bcn:"bcn-latn-zz",bco:"bco-latn-zz",bcp:"bcp-latn-cd",bcq:"bcq-ethi-zz",bcr:"bcr-latn-ca",bcs:"bcs-latn-ng",bct:"bct-latn-cd",bcu:"bcu-latn-zz",bcv:"bcv-latn-ng",bcw:"bcw-latn-cm",bcy:"bcy-latn-ng",bcz:"bcz-latn-sn",bda:"bda-latn-sn",bdb:"bdb-latn-id",bdc:"bdc-latn-co",bdd:"bdd-latn-zz",bde:"bde-latn-ng",bdf:"bdf-latn-pg",bdg:"bdg-latn-my",bdh:"bdh-latn-ss",bdi:"bdi-latn-sd",bdj:"bdj-latn-ss",bdk:"bdk-latn-az",bdl:"bdl-latn-id",bdm:"bdm-latn-td",bdn:"bdn-latn-cm",bdo:"bdo-latn-td",bdp:"bdp-latn-tz",bdq:"bdq-latn-vn",bdr:"bdr-latn-my",bds:"bds-latn-tz",bdt:"bdt-latn-cf",bdu:"bdu-latn-cm",bdv:"bdv-orya-in",bdw:"bdw-latn-id",bdx:"bdx-latn-id",bdy:"bdy-latn-au",bdz:"bdz-arab-pk",be:"be-cyrl-by",bea:"bea-latn-ca","bea-cans":"bea-cans-ca",beb:"beb-latn-cm",bec:"bec-latn-cm",bed:"bed-latn-id",bee:"bee-deva-in",bef:"bef-latn-zz",beh:"beh-latn-zz",bei:"bei-latn-id",bej:"bej-arab-sd",bek:"bek-latn-pg",bem:"bem-latn-zm",beo:"beo-latn-pg",bep:"bep-latn-id",beq:"beq-latn-cg",bes:"bes-latn-td",bet:"bet-latn-zz",beu:"beu-latn-id",bev:"bev-latn-ci",bew:"bew-latn-id",bex:"bex-latn-zz",bey:"bey-latn-pg",bez:"bez-latn-tz",bfa:"bfa-latn-ss","bfa-arab":"bfa-arab-ss",bfb:"bfb-deva-in",bfc:"bfc-latn-cn",bfd:"bfd-latn-cm",bfe:"bfe-latn-id",bff:"bff-latn-cf",bfg:"bfg-latn-id",bfh:"bfh-latn-pg",bfj:"bfj-latn-cm",bfl:"bfl-latn-cf",bfm:"bfm-latn-cm",bfn:"bfn-latn-tl",bfo:"bfo-latn-bf",bfp:"bfp-latn-cm",bfq:"bfq-taml-in",bfs:"bfs-latn-cn","bfs-hani":"bfs-hani-cn",bft:"bft-arab-pk",bfu:"bfu-tibt-in","bfu-takr":"bfu-takr-in",bfw:"bfw-orya-in",bfx:"bfx-latn-ph",bfy:"bfy-deva-in",bfz:"bfz-deva-in",bg:"bg-cyrl-bg",bga:"bga-latn-ng",bgb:"bgb-latn-id",bgc:"bgc-deva-in",bgd:"bgd-deva-in",bgf:"bgf-latn-cm",bgg:"bgg-latn-in",bgi:"bgi-latn-ph",bgj:"bgj-latn-cm",bgn:"bgn-arab-pk",bgo:"bgo-latn-gn",bgp:"bgp-arab-pk",bgq:"bgq-deva-in",bgr:"bgr-latn-in",bgs:"bgs-latn-ph",bgt:"bgt-latn-sb",bgu:"bgu-latn-ng",bgv:"bgv-latn-id",bgw:"bgw-deva-in",bgx:"bgx-grek-tr",bgy:"bgy-latn-id",bgz:"bgz-latn-id",bha:"bha-deva-in",bhb:"bhb-deva-in",bhc:"bhc-latn-id",bhd:"bhd-deva-in","bhd-arab":"bhd-arab-in","bhd-takr":"bhd-takr-in",bhe:"bhe-arab-pk",bhf:"bhf-latn-pg",bhg:"bhg-latn-zz",bhh:"bhh-cyrl-il","bhh-hebr":"bhh-hebr-il","bhh-latn":"bhh-latn-il",bhi:"bhi-deva-in",bhj:"bhj-deva-np",bhl:"bhl-latn-zz",bhm:"bhm-arab-om",bhn:"bhn-syrc-ge",bho:"bho-deva-in",bhp:"bhp-latn-id",bhq:"bhq-latn-id",bhr:"bhr-latn-mg",bhs:"bhs-latn-cm",bht:"bht-takr-in","bht-deva":"bht-deva-in","bht-latn":"bht-latn-in",bhu:"bhu-deva-in",bhv:"bhv-latn-id",bhw:"bhw-latn-id",bhy:"bhy-latn-zz",bhz:"bhz-latn-id",bi:"bi-latn-vu",bia:"bia-latn-au",bib:"bib-latn-zz",bid:"bid-latn-td",bie:"bie-latn-pg",bif:"bif-latn-gw",big:"big-latn-zz",bik:"bik-latn-ph",bil:"bil-latn-ng",bim:"bim-latn-zz",bin:"bin-latn-ng",bio:"bio-latn-zz",bip:"bip-latn-cd",biq:"biq-latn-zz",bir:"bir-latn-pg",bit:"bit-latn-pg",biu:"biu-latn-in",biv:"biv-latn-gh",biw:"biw-latn-cm",biy:"biy-deva-in",biz:"biz-latn-cd",bja:"bja-latn-cd",bjb:"bjb-latn-au",bjc:"bjc-latn-pg",bjf:"bjf-syrc-il",bjg:"bjg-latn-gw",bjh:"bjh-latn-zz",bji:"bji-ethi-zz",bjj:"bjj-deva-in",bjk:"bjk-latn-pg",bjl:"bjl-latn-pg",bjm:"bjm-arab-iq",bjn:"bjn-latn-id",bjo:"bjo-latn-zz",bjp:"bjp-latn-pg",bjr:"bjr-latn-zz",bjs:"bjs-latn-bb",bjt:"bjt-latn-sn",bju:"bju-latn-cm",bjv:"bjv-latn-td",bjw:"bjw-latn-ci",bjx:"bjx-latn-ph",bjy:"bjy-latn-au",bjz:"bjz-latn-zz",bka:"bka-latn-ng",bkc:"bkc-latn-zz",bkd:"bkd-latn-ph",bkf:"bkf-latn-cd",bkg:"bkg-latn-cf",bkh:"bkh-latn-cm",bki:"bki-latn-vu",bkj:"bkj-latn-cf",bkl:"bkl-latn-id",bkm:"bkm-latn-cm",bkn:"bkn-latn-id",bko:"bko-latn-cm",bkp:"bkp-latn-cd",bkq:"bkq-latn-zz",bkr:"bkr-latn-id",bks:"bks-latn-ph",bkt:"bkt-latn-cd",bku:"bku-latn-ph",bkv:"bkv-latn-zz",bkw:"bkw-latn-cg",bkx:"bkx-latn-tl",bky:"bky-latn-ng",bkz:"bkz-latn-id",bla:"bla-latn-ca",blb:"blb-latn-sb",blc:"blc-latn-ca",bld:"bld-latn-id",ble:"ble-latn-gw",blf:"blf-latn-id",blg:"blg-latn-my",blh:"blh-latn-lr",bli:"bli-latn-cd",blj:"blj-latn-id",blk:"blk-mymr-mm",blm:"blm-latn-ss",bln:"bln-latn-ph",blo:"blo-latn-bj",blp:"blp-latn-sb",blq:"blq-latn-pg",blr:"blr-latn-cn","blr-tale":"blr-tale-cn","blr-thai":"blr-thai-th",bls:"bls-latn-id",blt:"blt-tavt-vn",blv:"blv-latn-ao",blw:"blw-latn-ph",blx:"blx-latn-ph",bly:"bly-latn-bj",blz:"blz-latn-id",bm:"bm-latn-ml",bma:"bma-latn-ng",bmb:"bmb-latn-cd",bmc:"bmc-latn-pg",bmd:"bmd-latn-gn",bme:"bme-latn-cf",bmf:"bmf-latn-sl",bmg:"bmg-latn-cd",bmh:"bmh-latn-zz",bmi:"bmi-latn-td",bmj:"bmj-deva-np",bmk:"bmk-latn-zz",bml:"bml-latn-cd",bmm:"bmm-latn-mg",bmn:"bmn-latn-pg",bmo:"bmo-latn-cm",bmp:"bmp-latn-pg",bmq:"bmq-latn-ml",bmr:"bmr-latn-co",bms:"bms-latn-ne",bmu:"bmu-latn-zz",bmv:"bmv-latn-cm",bmw:"bmw-latn-cg",bmx:"bmx-latn-pg",bmz:"bmz-latn-pg",bn:"bn-beng-bd",bna:"bna-latn-id",bnb:"bnb-latn-my",bnc:"bnc-latn-ph",bnd:"bnd-latn-id",bne:"bne-latn-id",bnf:"bnf-latn-id",bng:"bng-latn-zz",bni:"bni-latn-cd",bnj:"bnj-latn-ph",bnk:"bnk-latn-vu",bnm:"bnm-latn-zz",bnn:"bnn-latn-tw",bno:"bno-latn-ph",bnp:"bnp-latn-zz",bnq:"bnq-latn-id",bnr:"bnr-latn-vu",bns:"bns-deva-in",bnu:"bnu-latn-id",bnv:"bnv-latn-id",bnw:"bnw-latn-pg",bnx:"bnx-latn-cd",bny:"bny-latn-my",bnz:"bnz-latn-cm",bo:"bo-tibt-cn",boa:"boa-latn-pe",bob:"bob-latn-ke",boe:"boe-latn-cm",bof:"bof-latn-bf",boh:"boh-latn-cd",boj:"boj-latn-zz",bok:"bok-latn-cg",bol:"bol-latn-ng",bom:"bom-latn-zz",bon:"bon-latn-zz",boo:"boo-latn-ml",bop:"bop-latn-pg",boq:"boq-latn-pg",bor:"bor-latn-br",bot:"bot-latn-ss",bou:"bou-latn-tz",bov:"bov-latn-gh",bow:"bow-latn-pg",box:"box-latn-bf",boy:"boy-latn-cf",boz:"boz-latn-ml","boz-arab":"boz-arab-ml",bpa:"bpa-latn-vu",bpc:"bpc-latn-cm",bpd:"bpd-latn-cf",bpe:"bpe-latn-pg",bpg:"bpg-latn-id",bph:"bph-cyrl-ru",bpi:"bpi-latn-pg",bpj:"bpj-latn-cd",bpk:"bpk-latn-nc",bpl:"bpl-latn-au",bpm:"bpm-latn-pg",bpo:"bpo-latn-id",bpp:"bpp-latn-id",bpq:"bpq-latn-id",bpr:"bpr-latn-ph",bps:"bps-latn-ph",bpt:"bpt-latn-au",bpu:"bpu-latn-pg",bpv:"bpv-latn-id",bpw:"bpw-latn-pg",bpx:"bpx-deva-in",bpy:"bpy-beng-in",bpz:"bpz-latn-id",bqa:"bqa-latn-bj",bqb:"bqb-latn-id",bqc:"bqc-latn-zz",bqd:"bqd-latn-cm",bqf:"bqf-latn-gn","bqf-arab":"bqf-arab-gn",bqg:"bqg-latn-tg",bqi:"bqi-arab-ir",bqj:"bqj-latn-sn",bqk:"bqk-latn-cf",bql:"bql-latn-pg",bqm:"bqm-latn-cm",bqo:"bqo-latn-cm",bqp:"bqp-latn-zz",bqq:"bqq-latn-id",bqr:"bqr-latn-id",bqs:"bqs-latn-pg",bqt:"bqt-latn-cm",bqu:"bqu-latn-cd",bqv:"bqv-latn-ci",bqw:"bqw-latn-ng",bqx:"bqx-latn-ng",bqz:"bqz-latn-cm",br:"br-latn-fr",bra:"bra-deva-in",brb:"brb-khmr-kh","brb-laoo":"brb-laoo-la","brb-latn":"brb-latn-vn",brc:"brc-latn-gy",brd:"brd-deva-np",brf:"brf-latn-cd",brg:"brg-latn-bo",brh:"brh-arab-pk",bri:"bri-latn-cm",brj:"brj-latn-vu",brk:"brk-arab-sd",brl:"brl-latn-bw",brm:"brm-latn-cd",brn:"brn-latn-cr",brp:"brp-latn-id",brq:"brq-latn-pg",brr:"brr-latn-sb",brs:"brs-latn-id",brt:"brt-latn-ng",bru:"bru-latn-vn","bru-laoo":"bru-laoo-la","bru-thai":"bru-thai-la",brv:"brv-laoo-la",brx:"brx-deva-in",bry:"bry-latn-pg",brz:"brz-latn-zz",bs:"bs-latn-ba",bsa:"bsa-latn-id",bsb:"bsb-latn-bn",bsc:"bsc-latn-sn",bse:"bse-latn-cm",bsf:"bsf-latn-ng",bsh:"bsh-arab-af",bsi:"bsi-latn-cm",bsj:"bsj-latn-zz",bsk:"bsk-arab-pk","bsk-latn":"bsk-latn-pk",bsl:"bsl-latn-ng",bsm:"bsm-latn-id",bsn:"bsn-latn-co",bso:"bso-latn-td",bsp:"bsp-latn-gn",bsq:"bsq-bass-lr",bsr:"bsr-latn-ng",bss:"bss-latn-cm",bst:"bst-ethi-zz",bsu:"bsu-latn-id",bsv:"bsv-latn-gn","bsv-arab":"bsv-arab-gn",bsw:"bsw-latn-et","bsw-ethi":"bsw-ethi-et",bsx:"bsx-latn-ng",bsy:"bsy-latn-my",bta:"bta-latn-ng",btc:"btc-latn-cm",btd:"btd-batk-id",bte:"bte-latn-ng",btf:"btf-latn-td",btg:"btg-latn-ci",bth:"bth-latn-my",bti:"bti-latn-id",btj:"btj-latn-id",btm:"btm-batk-id",btn:"btn-latn-ph",bto:"bto-latn-ph",btp:"btp-latn-pg",btq:"btq-latn-my",btr:"btr-latn-vu",bts:"bts-latn-id","bts-batk":"bts-batk-id",btt:"btt-latn-zz",btu:"btu-latn-ng",btv:"btv-deva-pk",btw:"btw-latn-ph",btx:"btx-latn-id","btx-batk":"btx-batk-id",bty:"bty-latn-id",btz:"btz-latn-id",bua:"bua-cyrl-ru",bub:"bub-latn-td",buc:"buc-latn-yt",bud:"bud-latn-zz",bue:"bue-latn-ca",buf:"buf-latn-cd",bug:"bug-latn-id",buh:"buh-latn-cn",bui:"bui-latn-cg",buj:"buj-latn-ng",buk:"buk-latn-zz",bum:"bum-latn-cm",bun:"bun-latn-sl",buo:"buo-latn-zz",bup:"bup-latn-id",buq:"buq-latn-pg",bus:"bus-latn-zz",but:"but-latn-pg",buu:"buu-latn-zz",buv:"buv-latn-pg",buw:"buw-latn-ga",bux:"bux-latn-ng",buy:"buy-latn-sl",buz:"buz-latn-ng",bva:"bva-latn-td",bvb:"bvb-latn-gq",bvc:"bvc-latn-sb",bvd:"bvd-latn-sb",bve:"bve-latn-id",bvf:"bvf-latn-td",bvg:"bvg-latn-cm",bvh:"bvh-latn-ng",bvi:"bvi-latn-ss",bvj:"bvj-latn-ng",bvk:"bvk-latn-id",bvm:"bvm-latn-cm",bvn:"bvn-latn-pg",bvo:"bvo-latn-td",bvq:"bvq-latn-cf",bvr:"bvr-latn-au",bvt:"bvt-latn-id",bvu:"bvu-latn-id",bvv:"bvv-latn-ve",bvw:"bvw-latn-ng",bvx:"bvx-latn-cg",bvy:"bvy-latn-ph",bvz:"bvz-latn-id",bwa:"bwa-latn-nc",bwb:"bwb-latn-fj",bwc:"bwc-latn-zm",bwd:"bwd-latn-zz",bwe:"bwe-mymr-mm","bwe-latn":"bwe-latn-mm",bwf:"bwf-latn-pg",bwg:"bwg-latn-mz",bwh:"bwh-latn-cm",bwi:"bwi-latn-ve",bwj:"bwj-latn-bf",bwk:"bwk-latn-pg",bwl:"bwl-latn-cd",bwm:"bwm-latn-pg",bwo:"bwo-latn-et","bwo-ethi":"bwo-ethi-et",bwp:"bwp-latn-id",bwq:"bwq-latn-bf",bwr:"bwr-latn-zz",bws:"bws-latn-cd",bwt:"bwt-latn-cm",bwu:"bwu-latn-gh",bww:"bww-latn-cd",bwx:"bwx-latn-cn",bwy:"bwy-latn-bf",bwz:"bwz-latn-cg",bxa:"bxa-latn-sb",bxb:"bxb-latn-ss",bxc:"bxc-latn-gq",bxf:"bxf-latn-pg",bxg:"bxg-latn-cd",bxh:"bxh-latn-zz",bxi:"bxi-latn-au",bxj:"bxj-latn-au",bxl:"bxl-latn-bf",bxm:"bxm-cyrl-mn","bxm-latn":"bxm-latn-mn","bxm-mong":"bxm-mong-mn",bxn:"bxn-latn-au",bxo:"bxo-latn-ng",bxp:"bxp-latn-cm",bxq:"bxq-latn-ng",bxs:"bxs-latn-cm",bxu:"bxu-mong-cn","bxu-cyrl":"bxu-cyrl-cn","bxu-latn":"bxu-latn-cn",bxv:"bxv-latn-td",bxw:"bxw-latn-ml",bxz:"bxz-latn-pg",bya:"bya-latn-ph",byb:"byb-latn-cm",byc:"byc-latn-ng",byd:"byd-latn-id",bye:"bye-latn-zz",byf:"byf-latn-ng",byh:"byh-deva-np",byi:"byi-latn-cd",byj:"byj-latn-ng",byk:"byk-latn-cn",byl:"byl-latn-id",bym:"bym-latn-au",byn:"byn-ethi-er",byp:"byp-latn-ng",byr:"byr-latn-zz",bys:"bys-latn-zz",byv:"byv-latn-cm",byw:"byw-deva-np",byx:"byx-latn-zz",byz:"byz-latn-pg",bza:"bza-latn-zz",bzb:"bzb-latn-id",bzc:"bzc-latn-mg",bzd:"bzd-latn-cr",bze:"bze-latn-ml",bzf:"bzf-latn-zz",bzh:"bzh-latn-zz",bzi:"bzi-thai-th",bzj:"bzj-latn-bz",bzk:"bzk-latn-ni",bzl:"bzl-latn-id",bzm:"bzm-latn-cd",bzn:"bzn-latn-id",bzo:"bzo-latn-cd",bzp:"bzp-latn-id",bzq:"bzq-latn-id",bzr:"bzr-latn-au",bzt:"bzt-latn-001",bzu:"bzu-latn-id",bzv:"bzv-latn-cm",bzw:"bzw-latn-zz",bzx:"bzx-latn-ml",bzy:"bzy-latn-ng",bzz:"bzz-latn-ng",ca:"ca-latn-es",caa:"caa-latn-gt",cab:"cab-latn-hn",cac:"cac-latn-gt",cad:"cad-latn-us",cae:"cae-latn-sn",caf:"caf-latn-ca","caf-cans":"caf-cans-ca",cag:"cag-latn-py",cah:"cah-latn-pe",caj:"caj-latn-ar",cak:"cak-latn-gt",cal:"cal-latn-mp",cam:"cam-latn-nc",can:"can-latn-zz",cao:"cao-latn-bo",cap:"cap-latn-bo",caq:"caq-latn-in",car:"car-latn-ve",cas:"cas-latn-bo",cav:"cav-latn-bo",caw:"caw-latn-bo",cax:"cax-latn-bo",cay:"cay-latn-ca",caz:"caz-latn-bo",cbb:"cbb-latn-co",cbc:"cbc-latn-co",cbd:"cbd-latn-co",cbg:"cbg-latn-co",cbi:"cbi-latn-ec",cbj:"cbj-latn-zz",cbk:"cbk-latn-ph","cbk-brai":"cbk-brai-ph",cbl:"cbl-latn-mm",cbn:"cbn-thai-th",cbo:"cbo-latn-ng",cbq:"cbq-latn-ng",cbr:"cbr-latn-pe",cbs:"cbs-latn-pe",cbt:"cbt-latn-pe",cbu:"cbu-latn-pe",cbv:"cbv-latn-co",cbw:"cbw-latn-ph",cby:"cby-latn-co",ccc:"ccc-latn-pe",ccd:"ccd-latn-br",cce:"cce-latn-mz",ccg:"ccg-latn-ng",cch:"cch-latn-ng",ccj:"ccj-latn-gw",ccl:"ccl-latn-tz",ccm:"ccm-latn-my",cco:"cco-latn-mx",ccp:"ccp-cakm-bd",ccr:"ccr-latn-sv",cde:"cde-telu-in",cdf:"cdf-latn-in","cdf-beng":"cdf-beng-in",cdh:"cdh-deva-in","cdh-takr":"cdh-takr-in",cdi:"cdi-gujr-in",cdj:"cdj-deva-in",cdm:"cdm-deva-np","cdm-latn":"cdm-latn-np",cdo:"cdo-hans-cn","cdo-hant":"cdo-hant-cn","cdo-latn":"cdo-latn-cn",cdr:"cdr-latn-ng",cdz:"cdz-beng-in",ce:"ce-cyrl-ru",cea:"cea-latn-us",ceb:"ceb-latn-ph",ceg:"ceg-latn-py",cek:"cek-latn-mm",cen:"cen-latn-ng",cet:"cet-latn-ng",cey:"cey-latn-mm",cfa:"cfa-latn-zz",cfd:"cfd-latn-ng",cfg:"cfg-latn-ng",cfm:"cfm-latn-mm","cfm-beng":"cfm-beng-in",cga:"cga-latn-pg",cgc:"cgc-latn-ph",cgg:"cgg-latn-ug",cgk:"cgk-tibt-bt",ch:"ch-latn-gu",chb:"chb-latn-co",chd:"chd-latn-mx",chf:"chf-latn-mx",chg:"chg-arab-tm",chh:"chh-latn-us",chj:"chj-latn-mx",chk:"chk-latn-fm",chl:"chl-latn-us",chm:"chm-cyrl-ru",chn:"chn-latn-us","chn-dupl":"chn-dupl-us",cho:"cho-latn-us",chp:"chp-latn-ca",chq:"chq-latn-mx",chr:"chr-cher-us",cht:"cht-latn-pe",chw:"chw-latn-mz",chx:"chx-deva-np",chy:"chy-latn-us",chz:"chz-latn-mx",cia:"cia-latn-id","cia-arab":"cia-arab-id","cia-hang":"cia-hang-id",cib:"cib-latn-bj",cic:"cic-latn-us",cie:"cie-latn-ng",cih:"cih-deva-in",cim:"cim-latn-it",cin:"cin-latn-br",cip:"cip-latn-mx",cir:"cir-latn-nc",ciw:"ciw-latn-us","ciw-cans":"ciw-cans-us",ciy:"ciy-latn-ve",cja:"cja-arab-kh",cje:"cje-latn-vn",cjh:"cjh-latn-us",cji:"cji-cyrl-ru",cjk:"cjk-latn-ao",cjm:"cjm-cham-vn",cjn:"cjn-latn-pg",cjo:"cjo-latn-pe",cjp:"cjp-latn-cr",cjs:"cjs-latn-ru","cjs-cyrl":"cjs-cyrl-ru",cjv:"cjv-latn-zz",cjy:"cjy-hans-cn","cjy-hant":"cjy-hant-cn",ckb:"ckb-arab-iq",ckl:"ckl-latn-zz",ckm:"ckm-latn-hr","ckm-glag":"ckm-glag-hr",ckn:"ckn-latn-mm",cko:"cko-latn-zz",ckq:"ckq-latn-td",ckr:"ckr-latn-pg",cks:"cks-latn-nc",ckt:"ckt-cyrl-ru",cku:"cku-latn-us",ckv:"ckv-latn-tw",ckx:"ckx-latn-cm",cky:"cky-latn-zz",ckz:"ckz-latn-gt",cla:"cla-latn-zz",clc:"clc-latn-ca",cle:"cle-latn-mx",clh:"clh-arab-pk",cli:"cli-latn-gh",clj:"clj-latn-mm",clk:"clk-latn-in","clk-tibt":"clk-tibt-cn",cll:"cll-latn-gh",clm:"clm-latn-us",clo:"clo-latn-mx",clt:"clt-latn-mm",clu:"clu-latn-ph",clw:"clw-cyrl-ru",cly:"cly-latn-mx",cma:"cma-latn-vn",cme:"cme-latn-zz",cmg:"cmg-soyo-mn",cmi:"cmi-latn-co",cml:"cml-latn-id",cmo:"cmo-latn-vn","cmo-kh":"cmo-latn-kh","cmo-khmr":"cmo-khmr-kh",cmr:"cmr-latn-mm",cms:"cms-latn-it",cmt:"cmt-latn-za",cna:"cna-tibt-in",cnb:"cnb-latn-mm",cnc:"cnc-latn-vn",cng:"cng-latn-cn",cnh:"cnh-latn-mm",cni:"cni-latn-pe",cnk:"cnk-latn-mm",cnl:"cnl-latn-mx",cnp:"cnp-hans-cn","cnp-hant":"cnp-hant-cn",cnq:"cnq-latn-cm",cns:"cns-latn-id",cnt:"cnt-latn-mx",cnw:"cnw-latn-mm",cnx:"cnx-latn-gb",co:"co-latn-fr",coa:"coa-latn-au",cob:"cob-latn-mx",coc:"coc-latn-mx",cod:"cod-latn-pe",coe:"coe-latn-co",cof:"cof-latn-ec",cog:"cog-thai-th",coh:"coh-latn-ke",coj:"coj-latn-mx",cok:"cok-latn-mx",col:"col-latn-us",com:"com-latn-us",coo:"coo-latn-ca",cop:"cop-copt-eg",coq:"coq-latn-us",cot:"cot-latn-pe",cou:"cou-latn-sn",cox:"cox-latn-pe",coz:"coz-latn-mx",cpa:"cpa-latn-mx",cpb:"cpb-latn-pe",cpc:"cpc-latn-pe",cpg:"cpg-grek-gr",cpi:"cpi-latn-nr",cpn:"cpn-latn-gh",cpo:"cpo-latn-bf",cps:"cps-latn-ph",cpu:"cpu-latn-pe",cpx:"cpx-latn-cn",cpy:"cpy-latn-pe",cqd:"cqd-latn-cn",cr:"cr-cans-ca",crb:"crb-latn-vc",crc:"crc-latn-vu",crd:"crd-latn-us",crf:"crf-latn-co",crg:"crg-latn-ca",crh:"crh-cyrl-ua",cri:"cri-latn-st",crj:"crj-cans-ca","crj-latn":"crj-latn-ca",crk:"crk-cans-ca",crl:"crl-cans-ca",crm:"crm-cans-ca",crn:"crn-latn-mx",cro:"cro-latn-us",crq:"crq-latn-ar",crs:"crs-latn-sc",crt:"crt-latn-ar",crv:"crv-latn-in",crw:"crw-latn-vn",crx:"crx-latn-ca","crx-cans":"crx-cans-ca",cry:"cry-latn-ng",crz:"crz-latn-us",cs:"cs-latn-cz",csa:"csa-latn-mx",csb:"csb-latn-pl",csh:"csh-mymr-mm","csh-latn":"csh-latn-mm",csj:"csj-latn-mm",csk:"csk-latn-sn",csm:"csm-latn-us",cso:"cso-latn-mx",csp:"csp-hans-cn","csp-hant":"csp-hant-cn",css:"css-latn-us",cst:"cst-latn-us",csv:"csv-latn-mm",csw:"csw-cans-ca",csy:"csy-latn-mm",csz:"csz-latn-us",cta:"cta-latn-mx",ctc:"ctc-latn-us",ctd:"ctd-pauc-mm",cte:"cte-latn-mx",ctg:"ctg-beng-bd","ctg-arab":"ctg-arab-bd","ctg-latn":"ctg-latn-bd",cth:"cth-latn-mm",ctl:"ctl-latn-mx",ctm:"ctm-latn-us",ctn:"ctn-deva-np",cto:"cto-latn-co",ctp:"ctp-latn-mx",cts:"cts-latn-ph",ctt:"ctt-taml-in",ctu:"ctu-latn-mx",ctz:"ctz-latn-mx",cu:"cu-cyrl-ru","cu-glag":"cu-glag-bg",cua:"cua-latn-vn",cub:"cub-latn-co",cuc:"cuc-latn-mx",cuh:"cuh-latn-ke",cui:"cui-latn-co",cuj:"cuj-latn-pe",cuk:"cuk-latn-pa",cul:"cul-latn-br",cuo:"cuo-latn-ve",cup:"cup-latn-us",cut:"cut-latn-mx",cuu:"cuu-lana-cn",cuv:"cuv-latn-cm",cux:"cux-latn-mx",cv:"cv-cyrl-ru",cvg:"cvg-latn-in","cvg-tibt":"cvg-tibt-in",cvn:"cvn-latn-mx",cwa:"cwa-latn-tz",cwb:"cwb-latn-mz",cwe:"cwe-latn-tz",cwg:"cwg-latn-my",cwt:"cwt-latn-sn",cy:"cy-latn-gb",cya:"cya-latn-mx",cyb:"cyb-latn-bo",cyo:"cyo-latn-ph",czh:"czh-hans-cn","czh-hant":"czh-hant-cn",czk:"czk-hebr-cz",czn:"czn-latn-mx",czt:"czt-latn-mm",da:"da-latn-dk",daa:"daa-latn-td",dac:"dac-latn-pg",dad:"dad-latn-zz",dae:"dae-latn-cm",daf:"daf-latn-ci",dag:"dag-latn-zz",dah:"dah-latn-zz",dai:"dai-latn-td",daj:"daj-latn-sd",dak:"dak-latn-us",dal:"dal-latn-ke",dam:"dam-latn-ng",dao:"dao-latn-mm",daq:"daq-deva-in",dar:"dar-cyrl-ru",das:"das-latn-ci",dau:"dau-latn-td",dav:"dav-latn-ke",daw:"daw-latn-ph",dax:"dax-latn-au",daz:"daz-latn-id",dba:"dba-latn-ml",dbb:"dbb-latn-ng",dbd:"dbd-latn-zz",dbe:"dbe-latn-id",dbf:"dbf-latn-id",dbg:"dbg-latn-ml",dbi:"dbi-latn-ng",dbj:"dbj-latn-my","dbj-arab":"dbj-arab-my",dbl:"dbl-latn-au",dbm:"dbm-latn-ng",dbn:"dbn-latn-id",dbo:"dbo-latn-ng",dbp:"dbp-latn-ng",dbq:"dbq-latn-zz",dbt:"dbt-latn-ml",dbu:"dbu-latn-ml",dbv:"dbv-latn-ng",dbw:"dbw-latn-ml",dby:"dby-latn-pg",dcc:"dcc-arab-in",dcr:"dcr-latn-vi",dda:"dda-latn-au",ddd:"ddd-latn-ss",dde:"dde-latn-cg",ddg:"ddg-latn-tl",ddi:"ddi-latn-pg",ddj:"ddj-latn-au",ddn:"ddn-latn-zz",ddo:"ddo-cyrl-ru",ddr:"ddr-latn-au",dds:"dds-latn-ml",ddw:"ddw-latn-id",de:"de-latn-de",dec:"dec-latn-sd",ded:"ded-latn-zz",dee:"dee-latn-lr",def:"def-arab-ir",deg:"deg-latn-ng",deh:"deh-arab-pk",dei:"dei-latn-id",dek:"dek-latn-cm",del:"del-latn-us",dem:"dem-latn-id",den:"den-latn-ca",deq:"deq-latn-cf",der:"der-beng-in","der-latn":"der-latn-in",des:"des-latn-br",dev:"dev-latn-pg",dez:"dez-latn-cd",dga:"dga-latn-zz",dgb:"dgb-latn-ml",dgc:"dgc-latn-ph",dgd:"dgd-latn-bf",dge:"dge-latn-pg",dgg:"dgg-latn-pg",dgh:"dgh-latn-zz",dgi:"dgi-latn-zz",dgk:"dgk-latn-cf",dgl:"dgl-arab-zz",dgn:"dgn-latn-au",dgr:"dgr-latn-ca",dgs:"dgs-latn-bf",dgt:"dgt-latn-au",dgw:"dgw-latn-au",dgx:"dgx-latn-pg",dgz:"dgz-latn-zz",dhg:"dhg-latn-au",dhi:"dhi-deva-np",dhl:"dhl-latn-au",dhm:"dhm-latn-ao",dhn:"dhn-gujr-in",dho:"dho-deva-in",dhr:"dhr-latn-au",dhs:"dhs-latn-tz",dhu:"dhu-latn-au",dhv:"dhv-latn-nc",dhw:"dhw-deva-np",dhx:"dhx-latn-au",dia:"dia-latn-zz",dib:"dib-latn-ss",dic:"dic-latn-ci",did:"did-latn-ss",dif:"dif-latn-au",dig:"dig-latn-ke",dih:"dih-latn-mx",dii:"dii-latn-cm",dij:"dij-latn-id",dil:"dil-latn-sd",din:"din-latn-ss","din-arab":"din-arab-ss",dio:"dio-latn-ng",dip:"dip-latn-ss",dir:"dir-latn-ng",dis:"dis-latn-in","dis-beng":"dis-beng-in",diu:"diu-latn-na",diw:"diw-latn-ss",dix:"dix-latn-vu",diy:"diy-latn-id",diz:"diz-latn-cd",dja:"dja-latn-au",djb:"djb-latn-au",djc:"djc-latn-td",djd:"djd-latn-au",dje:"dje-latn-ne",djf:"djf-latn-au",dji:"dji-latn-au",djj:"djj-latn-au",djk:"djk-latn-sr",djm:"djm-latn-ml",djn:"djn-latn-au",djo:"djo-latn-id",djr:"djr-latn-au",dju:"dju-latn-pg",djw:"djw-latn-au",dka:"dka-tibt-bt",dkg:"dkg-latn-ng",dkk:"dkk-latn-id",dkr:"dkr-latn-my",dks:"dks-latn-ss",dkx:"dkx-latn-cm",dlg:"dlg-cyrl-ru",dlm:"dlm-latn-hr",dln:"dln-latn-in",dma:"dma-latn-ga",dmb:"dmb-latn-ml",dmc:"dmc-latn-pg",dmd:"dmd-latn-au",dme:"dme-latn-cm",dmf:"dmf-medf-ng",dmg:"dmg-latn-my",dmk:"dmk-arab-pk",dml:"dml-arab-pk",dmm:"dmm-latn-cm",dmo:"dmo-latn-cm",dmr:"dmr-latn-id",dms:"dms-latn-id",dmu:"dmu-latn-id",dmv:"dmv-latn-my",dmw:"dmw-latn-au",dmx:"dmx-latn-mz",dmy:"dmy-latn-id",dna:"dna-latn-id",dnd:"dnd-latn-pg",dne:"dne-latn-tz",dng:"dng-cyrl-kg","dng-arab":"dng-arab-kg",dni:"dni-latn-id",dnj:"dnj-latn-ci",dnk:"dnk-latn-id",dnn:"dnn-latn-bf",dno:"dno-latn-cd",dnr:"dnr-latn-pg",dnt:"dnt-latn-id",dnu:"dnu-mymr-mm",dnv:"dnv-mymr-mm",dnw:"dnw-latn-id",dny:"dny-latn-br",doa:"doa-latn-pg",dob:"dob-latn-zz",doc:"doc-latn-cn",doe:"doe-latn-tz",dof:"dof-latn-pg",doh:"doh-latn-ng",doi:"doi-deva-in",dok:"dok-latn-id",dol:"dol-latn-pg",don:"don-latn-pg",doo:"doo-latn-cd",dop:"dop-latn-zz",dor:"dor-latn-sb",dos:"dos-latn-bf",dot:"dot-latn-ng",dov:"dov-latn-zw",dow:"dow-latn-zz",dox:"dox-ethi-et",doy:"doy-latn-gh",dpp:"dpp-latn-my",drc:"drc-latn-pt",dre:"dre-tibt-np",drg:"drg-latn-my",drh:"drh-mong-cn",dri:"dri-latn-zz",drl:"drl-latn-au",drn:"drn-latn-id",dro:"dro-latn-my",drq:"drq-deva-np",drs:"drs-ethi-zz",drt:"drt-latn-nl",dru:"dru-latn-tw",dry:"dry-deva-np",dsb:"dsb-latn-de",dsh:"dsh-latn-ke",dsi:"dsi-latn-td",dsn:"dsn-latn-id",dso:"dso-orya-in",dsq:"dsq-latn-ml","dsq-arab":"dsq-arab-ml",dta:"dta-latn-cn","dta-cyrl":"dta-cyrl-cn","dta-hans":"dta-hans-cn",dtb:"dtb-latn-my",dtd:"dtd-latn-ca",dth:"dth-latn-au",dti:"dti-latn-ml",dtk:"dtk-latn-ml",dtm:"dtm-latn-ml",dto:"dto-latn-ml",dtp:"dtp-latn-my",dtr:"dtr-latn-my",dts:"dts-latn-zz",dtt:"dtt-latn-ml",dtu:"dtu-latn-ml",dty:"dty-deva-np",dua:"dua-latn-cm",dub:"dub-gujr-in",duc:"duc-latn-zz",dud:"dud-latn-zz",due:"due-latn-ph",duf:"duf-latn-nc",dug:"dug-latn-zz",duh:"duh-deva-in","duh-gujr":"duh-gujr-in",dui:"dui-latn-pg",duk:"duk-latn-pg",dul:"dul-latn-ph",dum:"dum-latn-nl",dun:"dun-latn-id",duo:"duo-latn-ph",dup:"dup-latn-id",duq:"duq-latn-id",dur:"dur-latn-cm",dus:"dus-deva-np",duu:"duu-latn-cn",duv:"duv-latn-id",duw:"duw-latn-id",dux:"dux-latn-ml",duy:"duy-latn-ph",duz:"duz-latn-cm",dv:"dv-thaa-mv",dva:"dva-latn-zz",dwa:"dwa-latn-ng",dwk:"dwk-orya-in",dwr:"dwr-latn-et","dwr-ethi":"dwr-ethi-et",dws:"dws-latn-001",dwu:"dwu-latn-au",dww:"dww-latn-zz",dwy:"dwy-latn-au",dwz:"dwz-deva-np",dya:"dya-latn-bf",dyb:"dyb-latn-au",dyd:"dyd-latn-au",dyg:"dyg-latn-ph",dyi:"dyi-latn-ci",dym:"dym-latn-ml",dyn:"dyn-latn-au",dyo:"dyo-latn-sn",dyu:"dyu-latn-bf",dyy:"dyy-latn-au",dz:"dz-tibt-bt",dza:"dza-latn-ng",dze:"dze-latn-au",dzg:"dzg-latn-zz",dzl:"dzl-tibt-bt",dzn:"dzn-latn-cd",eaa:"eaa-latn-au",ebc:"ebc-latn-id",ebg:"ebg-latn-ng",ebk:"ebk-latn-ph",ebo:"ebo-latn-cg",ebr:"ebr-latn-ci",ebu:"ebu-latn-ke",ecr:"ecr-grek-gr",ecy:"ecy-cprt-cy",ee:"ee-latn-gh",efa:"efa-latn-ng",efe:"efe-latn-cd",efi:"efi-latn-ng",ega:"ega-latn-ci",egl:"egl-latn-it",egm:"egm-latn-tz",ego:"ego-latn-ng",egy:"egy-egyp-eg",ehu:"ehu-latn-ng",eip:"eip-latn-id",eit:"eit-latn-pg",eiv:"eiv-latn-pg",eja:"eja-latn-gw",eka:"eka-latn-zz",eke:"eke-latn-ng",ekg:"ekg-latn-id",eki:"eki-latn-ng",ekl:"ekl-latn-bd",ekm:"ekm-latn-cm",eko:"eko-latn-mz","eko-arab":"eko-arab-mz",ekp:"ekp-latn-ng",ekr:"ekr-latn-ng",eky:"eky-kali-mm",el:"el-grek-gr",ele:"ele-latn-pg",elk:"elk-latn-pg",elm:"elm-latn-ng",elo:"elo-latn-ke",elu:"elu-latn-pg",ema:"ema-latn-zz",emb:"emb-latn-id",eme:"eme-latn-gf",emg:"emg-deva-np",emi:"emi-latn-zz",emm:"emm-latn-mx",emn:"emn-latn-cm",emp:"emp-latn-pa",ems:"ems-latn-us","ems-cyrl":"ems-cyrl-us",emu:"emu-deva-in",emw:"emw-latn-id",emx:"emx-latn-fr",emz:"emz-latn-cm",en:"en-latn-us","en-shaw":"en-shaw-gb",ena:"ena-latn-pg",enb:"enb-latn-ke",enc:"enc-latn-vn",end:"end-latn-id",enf:"enf-cyrl-ru",enh:"enh-cyrl-ru",enl:"enl-latn-py",enm:"enm-latn-gb",enn:"enn-latn-zz",eno:"eno-latn-id",enq:"enq-latn-zz",enr:"enr-latn-id",env:"env-latn-ng",enw:"enw-latn-ng",enx:"enx-latn-py",eo:"eo-latn-001",eot:"eot-latn-ci",epi:"epi-latn-ng",era:"era-taml-in",erg:"erg-latn-vu",erh:"erh-latn-ng",eri:"eri-latn-zz",erk:"erk-latn-vu",err:"err-latn-au",ert:"ert-latn-id",erw:"erw-latn-id",es:"es-latn-es",ese:"ese-latn-bo",esg:"esg-gonm-in",esh:"esh-arab-ir",esi:"esi-latn-us",esm:"esm-latn-ci",ess:"ess-latn-us","ess-cyrl":"ess-cyrl-us",esu:"esu-latn-us",esy:"esy-latn-ph",et:"et-latn-ee",etb:"etb-latn-ng",etn:"etn-latn-vu",eto:"eto-latn-cm",etr:"etr-latn-zz",ets:"ets-latn-ng",ett:"ett-ital-it",etu:"etu-latn-zz",etx:"etx-latn-zz",etz:"etz-latn-id",eu:"eu-latn-es",eve:"eve-cyrl-ru",evh:"evh-latn-ng",evn:"evn-cyrl-ru","evn-latn":"evn-latn-cn","evn-mong":"evn-mong-cn",ewo:"ewo-latn-cm",ext:"ext-latn-es",eya:"eya-latn-us",eyo:"eyo-latn-ke",eza:"eza-latn-zz",eze:"eze-latn-ng",fa:"fa-arab-ir",faa:"faa-latn-zz",fab:"fab-latn-zz",fad:"fad-latn-pg",faf:"faf-latn-sb",fag:"fag-latn-zz",fah:"fah-latn-ng",fai:"fai-latn-zz",faj:"faj-latn-pg",fak:"fak-latn-cm",fal:"fal-latn-cm",fam:"fam-latn-ng",fan:"fan-latn-gq",fap:"fap-latn-sn",far:"far-latn-sb",fau:"fau-latn-id",fax:"fax-latn-es",fay:"fay-arab-ir",faz:"faz-arab-ir",fbl:"fbl-latn-ph",fer:"fer-latn-ss",ff:"ff-latn-sn","ff-adlm":"ff-adlm-gn",ffi:"ffi-latn-zz",ffm:"ffm-latn-ml",fgr:"fgr-latn-td",fi:"fi-latn-fi",fia:"fia-arab-sd",fie:"fie-latn-ng",fif:"fif-latn-sa",fil:"fil-latn-ph",fip:"fip-latn-tz",fir:"fir-latn-ng",fit:"fit-latn-se",fiw:"fiw-latn-pg",fj:"fj-latn-fj",fkk:"fkk-latn-ng",fkv:"fkv-latn-no",fla:"fla-latn-us",flh:"flh-latn-id",fli:"fli-latn-ng",fll:"fll-latn-cm",fln:"fln-latn-au",flr:"flr-latn-zz",fly:"fly-latn-za",fmp:"fmp-latn-zz",fmu:"fmu-deva-in",fnb:"fnb-latn-vu",fng:"fng-latn-za",fni:"fni-latn-td",fo:"fo-latn-fo",fod:"fod-latn-zz",foi:"foi-latn-pg",fom:"fom-latn-cd",fon:"fon-latn-bj",for:"for-latn-zz",fos:"fos-latn-tw",fpe:"fpe-latn-zz",fqs:"fqs-latn-zz",fr:"fr-latn-fr",frc:"frc-latn-us",frd:"frd-latn-id",frk:"frk-latn-de",frm:"frm-latn-fr",fro:"fro-latn-fr",frp:"frp-latn-fr",frq:"frq-latn-pg",frr:"frr-latn-de",frs:"frs-latn-de",frt:"frt-latn-vu",fub:"fub-arab-cm",fud:"fud-latn-wf",fue:"fue-latn-zz",fuf:"fuf-latn-gn",fuh:"fuh-latn-zz",fui:"fui-latn-td",fum:"fum-latn-ng",fun:"fun-latn-br",fuq:"fuq-latn-ne",fur:"fur-latn-it",fut:"fut-latn-vu",fuu:"fuu-latn-cd",fuv:"fuv-latn-ng",fuy:"fuy-latn-zz",fvr:"fvr-latn-sd",fwa:"fwa-latn-nc",fwe:"fwe-latn-na",fy:"fy-latn-nl",ga:"ga-latn-ie",gaa:"gaa-latn-gh",gab:"gab-latn-td",gac:"gac-latn-in","gac-deva":"gac-deva-in",gad:"gad-latn-ph",gae:"gae-latn-ve",gaf:"gaf-latn-zz",gag:"gag-latn-md",gah:"gah-latn-zz",gai:"gai-latn-pg",gaj:"gaj-latn-zz",gak:"gak-latn-id",gal:"gal-latn-tl",gam:"gam-latn-zz",gan:"gan-hans-cn",gao:"gao-latn-pg",gap:"gap-latn-pg",gaq:"gaq-orya-in",gar:"gar-latn-pg",gas:"gas-gujr-in",gat:"gat-latn-pg",gau:"gau-telu-in",gaw:"gaw-latn-zz",gax:"gax-latn-et","gax-ethi":"gax-ethi-et",gay:"gay-latn-id",gba:"gba-latn-zz",gbb:"gbb-latn-au",gbd:"gbd-latn-au",gbe:"gbe-latn-pg",gbf:"gbf-latn-zz",gbg:"gbg-latn-cf",gbh:"gbh-latn-bj",gbi:"gbi-latn-id",gbj:"gbj-orya-in",gbk:"gbk-deva-in","gbk-takr":"gbk-takr-in",gbl:"gbl-gujr-in","gbl-deva":"gbl-deva-in",gbm:"gbm-deva-in",gbn:"gbn-latn-ss",gbp:"gbp-latn-cf",gbq:"gbq-latn-cf",gbr:"gbr-latn-ng",gbs:"gbs-latn-bj",gbu:"gbu-latn-au",gbv:"gbv-latn-cf",gbw:"gbw-latn-au",gbx:"gbx-latn-bj",gby:"gby-latn-zz",gbz:"gbz-arab-ir",gcc:"gcc-latn-pg",gcd:"gcd-latn-au",gcf:"gcf-latn-gp",gcl:"gcl-latn-gd",gcn:"gcn-latn-pg",gcr:"gcr-latn-gf",gct:"gct-latn-ve",gd:"gd-latn-gb",gdb:"gdb-orya-in","gdb-telu":"gdb-telu-in",gdc:"gdc-latn-au",gdd:"gdd-latn-pg",gde:"gde-latn-zz",gdf:"gdf-latn-ng",gdg:"gdg-latn-ph",gdh:"gdh-latn-au",gdi:"gdi-latn-cf",gdj:"gdj-latn-au",gdk:"gdk-latn-td",gdl:"gdl-latn-et","gdl-ethi":"gdl-ethi-et",gdm:"gdm-latn-td",gdn:"gdn-latn-zz",gdo:"gdo-cyrl-ru",gdq:"gdq-latn-ye",gdr:"gdr-latn-zz",gdt:"gdt-latn-au",gdu:"gdu-latn-ng",gdx:"gdx-deva-in",gea:"gea-latn-ng",geb:"geb-latn-zz",gec:"gec-latn-lr",ged:"ged-latn-ng",gef:"gef-latn-id",geg:"geg-latn-ng",geh:"geh-latn-ca",gei:"gei-latn-id",gej:"gej-latn-zz",gek:"gek-latn-ng",gel:"gel-latn-zz",geq:"geq-latn-cf",ges:"ges-latn-id",gev:"gev-latn-ga",gew:"gew-latn-ng",gex:"gex-latn-so",gey:"gey-latn-cd",gez:"gez-ethi-et",gfk:"gfk-latn-zz",gga:"gga-latn-sb",ggb:"ggb-latn-lr",ggd:"ggd-latn-au",gge:"gge-latn-au",ggg:"ggg-arab-pk",ggk:"ggk-latn-au",ggl:"ggl-latn-pg",ggn:"ggn-deva-np",ggt:"ggt-latn-pg",ggu:"ggu-latn-ci",ggw:"ggw-latn-pg",gha:"gha-arab-ly","gha-latn":"gha-latn-ly","gha-tfng":"gha-tfng-ly",ghc:"ghc-latn-gb",ghe:"ghe-deva-np",ghk:"ghk-latn-mm",ghn:"ghn-latn-sb",ghr:"ghr-arab-pk",ghs:"ghs-latn-zz",ght:"ght-tibt-np",gia:"gia-latn-au",gib:"gib-latn-ng",gic:"gic-latn-za",gid:"gid-latn-cm",gie:"gie-latn-ci",gig:"gig-arab-pk",gih:"gih-latn-au",gil:"gil-latn-ki",gim:"gim-latn-zz",gin:"gin-cyrl-ru",gip:"gip-latn-pg",giq:"giq-latn-vn",gir:"gir-latn-vn",gis:"gis-latn-cm",git:"git-latn-ca",gix:"gix-latn-cd",giy:"giy-latn-au",giz:"giz-latn-cm",gjk:"gjk-arab-pk",gjm:"gjm-latn-au",gjn:"gjn-latn-zz",gjr:"gjr-latn-au",gju:"gju-arab-pk",gka:"gka-latn-pg",gkd:"gkd-latn-pg",gke:"gke-latn-cm",gkn:"gkn-latn-zz",gko:"gko-latn-au",gkp:"gkp-latn-zz",gku:"gku-latn-za",gl:"gl-latn-es",glb:"glb-latn-ng",glc:"glc-latn-td",gld:"gld-cyrl-ru",glh:"glh-arab-af",glj:"glj-latn-td",glk:"glk-arab-ir",gll:"gll-latn-au",glo:"glo-latn-ng",glr:"glr-latn-lr",glu:"glu-latn-td",glw:"glw-latn-ng",gma:"gma-latn-au",gmb:"gmb-latn-sb",gmd:"gmd-latn-ng",gmg:"gmg-latn-pg",gmh:"gmh-latn-de",gmm:"gmm-latn-zz",gmn:"gmn-latn-cm",gmr:"gmr-latn-au",gmu:"gmu-latn-pg",gmv:"gmv-ethi-zz",gmx:"gmx-latn-tz",gmy:"gmy-linb-gr",gmz:"gmz-latn-ng",gn:"gn-latn-py",gna:"gna-latn-bf",gnb:"gnb-latn-in",gnc:"gnc-latn-es",gnd:"gnd-latn-zz",gne:"gne-latn-ng",gng:"gng-latn-zz",gnh:"gnh-latn-ng",gni:"gni-latn-au",gnj:"gnj-latn-ci",gnk:"gnk-latn-bw",gnl:"gnl-latn-au",gnm:"gnm-latn-pg",gnn:"gnn-latn-au",gnq:"gnq-latn-my",gnr:"gnr-latn-au",gnt:"gnt-latn-pg",gnu:"gnu-latn-pg",gnw:"gnw-latn-bo",gnz:"gnz-latn-cf",goa:"goa-latn-ci",gob:"gob-latn-co",goc:"goc-latn-pg",god:"god-latn-zz",goe:"goe-tibt-bt",gof:"gof-ethi-zz",gog:"gog-latn-tz",goh:"goh-latn-de",goi:"goi-latn-zz",gok:"gok-deva-in",gol:"gol-latn-lr",gom:"gom-deva-in",gon:"gon-telu-in",goo:"goo-latn-fj",gop:"gop-latn-id",goq:"goq-latn-id",gor:"gor-latn-id",gos:"gos-latn-nl",got:"got-goth-ua",gou:"gou-latn-cm",gov:"gov-latn-ci",gow:"gow-latn-tz",gox:"gox-latn-cd",goy:"goy-latn-td",gpa:"gpa-latn-ng",gpe:"gpe-latn-gh",gpn:"gpn-latn-pg",gqa:"gqa-latn-ng",gqn:"gqn-latn-br",gqr:"gqr-latn-td",gra:"gra-deva-in","gra-gujr":"gra-gujr-in",grb:"grb-latn-zz",grc:"grc-cprt-cy","grc-linb":"grc-linb-gr",grd:"grd-latn-ng",grg:"grg-latn-pg",grh:"grh-latn-ng",gri:"gri-latn-sb",grj:"grj-latn-lr",grm:"grm-latn-my",grq:"grq-latn-pg",grs:"grs-latn-id",grt:"grt-beng-in",gru:"gru-ethi-et","gru-latn":"gru-latn-et",grv:"grv-latn-lr",grw:"grw-latn-zz",grx:"grx-latn-pg",gry:"gry-latn-lr",grz:"grz-latn-pg",gsl:"gsl-latn-sn",gsn:"gsn-latn-pg",gso:"gso-latn-cf",gsp:"gsp-latn-pg",gsw:"gsw-latn-ch",gta:"gta-latn-br",gtu:"gtu-latn-au",gu:"gu-gujr-in",gua:"gua-latn-ng",gub:"gub-latn-br",guc:"guc-latn-co",gud:"gud-latn-zz",gue:"gue-latn-au",guf:"guf-latn-au",guh:"guh-latn-co",gui:"gui-latn-bo",guk:"guk-latn-et","guk-ethi":"guk-ethi-et",gul:"gul-latn-us",gum:"gum-latn-co",gun:"gun-latn-br",guo:"guo-latn-co",gup:"gup-latn-au",guq:"guq-latn-py",gur:"gur-latn-gh",gut:"gut-latn-cr",guu:"guu-latn-ve",guw:"guw-latn-zz",gux:"gux-latn-zz",guz:"guz-latn-ke",gv:"gv-latn-im",gva:"gva-latn-py",gvc:"gvc-latn-br",gve:"gve-latn-pg",gvf:"gvf-latn-zz",gvj:"gvj-latn-br",gvl:"gvl-latn-td",gvm:"gvm-latn-ng",gvn:"gvn-latn-au",gvo:"gvo-latn-br",gvp:"gvp-latn-br",gvr:"gvr-deva-np",gvs:"gvs-latn-zz",gvy:"gvy-latn-au",gwa:"gwa-latn-ci",gwb:"gwb-latn-ng",gwc:"gwc-arab-zz",gwd:"gwd-latn-et",gwe:"gwe-latn-tz",gwf:"gwf-arab-pk",gwg:"gwg-latn-ng",gwi:"gwi-latn-ca",gwj:"gwj-latn-bw",gwm:"gwm-latn-au",gwn:"gwn-latn-ng",gwr:"gwr-latn-ug",gwt:"gwt-arab-zz",gwu:"gwu-latn-au",gww:"gww-latn-au",gwx:"gwx-latn-gh",gxx:"gxx-latn-ci",gyb:"gyb-latn-pg",gyd:"gyd-latn-au",gye:"gye-latn-ng",gyf:"gyf-latn-au",gyg:"gyg-latn-cf",gyi:"gyi-latn-zz",gyl:"gyl-latn-et","gyl-ethi":"gyl-ethi-et",gym:"gym-latn-pa",gyn:"gyn-latn-gy",gyo:"gyo-deva-np",gyr:"gyr-latn-bo",gyy:"gyy-latn-au",gyz:"gyz-latn-ng",gza:"gza-latn-sd",gzi:"gzi-arab-ir",gzn:"gzn-latn-id",ha:"ha-latn-ng","ha-cm":"ha-arab-cm","ha-sd":"ha-arab-sd",haa:"haa-latn-us",hac:"hac-arab-ir",had:"had-latn-id",hae:"hae-latn-et",hag:"hag-latn-zz",hah:"hah-latn-pg",hai:"hai-latn-ca",haj:"haj-latn-in","haj-beng":"haj-beng-in",hak:"hak-hans-cn",hal:"hal-latn-vn",ham:"ham-latn-zz",han:"han-latn-tz",hao:"hao-latn-pg",hap:"hap-latn-id",haq:"haq-latn-tz",har:"har-ethi-et","har-arab":"har-arab-et","har-latn":"har-latn-et",has:"has-latn-ca",hav:"hav-latn-cd",haw:"haw-latn-us",hax:"hax-latn-ca",hay:"hay-latn-tz",haz:"haz-arab-af",hba:"hba-latn-cd",hbb:"hbb-latn-zz",hbn:"hbn-latn-sd",hbo:"hbo-hebr-il",hbu:"hbu-latn-tl",hch:"hch-latn-mx",hdy:"hdy-ethi-zz",he:"he-hebr-il",hed:"hed-latn-td",heg:"heg-latn-id",heh:"heh-latn-tz",hei:"hei-latn-ca",hem:"hem-latn-cd",hgm:"hgm-latn-na",hgw:"hgw-latn-pg",hhi:"hhi-latn-pg",hhr:"hhr-latn-sn",hhy:"hhy-latn-zz",hi:"hi-deva-in","hi-latn":"hi-latn-in",hia:"hia-latn-zz",hib:"hib-latn-pe",hid:"hid-latn-us",hif:"hif-latn-fj",hig:"hig-latn-zz",hih:"hih-latn-zz",hii:"hii-takr-in","hii-deva":"hii-deva-in",hij:"hij-latn-cm",hik:"hik-latn-id",hil:"hil-latn-ph",hio:"hio-latn-bw",hir:"hir-latn-br",hit:"hit-xsux-tr",hiw:"hiw-latn-vu",hix:"hix-latn-br",hji:"hji-latn-id",hka:"hka-latn-tz",hke:"hke-latn-cd",hkh:"hkh-arab-in","hkh-deva":"hkh-deva-in","hkh-latn":"hkh-latn-in",hkk:"hkk-latn-pg",hla:"hla-latn-zz",hlb:"hlb-deva-in",hld:"hld-latn-vn",hlt:"hlt-latn-mm",hlu:"hlu-hluw-tr",hma:"hma-latn-cn",hmb:"hmb-latn-ml",hmd:"hmd-plrd-cn",hmf:"hmf-latn-vn",hmj:"hmj-bopo-cn",hmm:"hmm-latn-cn",hmn:"hmn-latn-cn","hmn-bopo":"hmn-bopo-cn","hmn-hmng":"hmn-hmng-cn",hmp:"hmp-latn-cn",hmq:"hmq-bopo-cn",hmr:"hmr-latn-in",hms:"hms-latn-cn",hmt:"hmt-latn-zz",hmu:"hmu-latn-id",hmv:"hmv-latn-vn",hmw:"hmw-latn-cn",hmy:"hmy-latn-cn",hmz:"hmz-latn-cn","hmz-plrd":"hmz-plrd-cn",hna:"hna-latn-cm",hnd:"hnd-arab-pk",hne:"hne-deva-in",hng:"hng-latn-ao",hnh:"hnh-latn-bw",hni:"hni-latn-cn",hnj:"hnj-hmnp-us","hnj-au":"hnj-laoo-au","hnj-cn":"hnj-laoo-cn","hnj-fr":"hnj-laoo-fr","hnj-gf":"hnj-laoo-gf","hnj-la":"hnj-laoo-la","hnj-laoo":"hnj-laoo-la","hnj-mm":"hnj-laoo-mm","hnj-sr":"hnj-laoo-sr","hnj-th":"hnj-laoo-th","hnj-us":"hnj-hmnp-us","hnj-vn":"hnj-laoo-vn",hnn:"hnn-latn-ph",hno:"hno-arab-pk",hns:"hns-latn-sr",ho:"ho-latn-pg",hoa:"hoa-latn-sb",hob:"hob-latn-pg",hoc:"hoc-deva-in",hod:"hod-latn-ng",hoe:"hoe-latn-ng",hoh:"hoh-arab-om",hoi:"hoi-latn-us",hoj:"hoj-deva-in",hol:"hol-latn-ao",hom:"hom-latn-ss",hoo:"hoo-latn-cd",hop:"hop-latn-us",hor:"hor-latn-td",hot:"hot-latn-zz",hov:"hov-latn-id",how:"how-hani-cn",hoy:"hoy-deva-in",hpo:"hpo-mymr-mm",hr:"hr-latn-hr",hra:"hra-latn-in",hrc:"hrc-latn-pg",hre:"hre-latn-vn",hrk:"hrk-latn-id",hrm:"hrm-latn-cn","hrm-hmng":"hrm-hmng-cn",hro:"hro-latn-vn",hrp:"hrp-latn-au",hrt:"hrt-syrc-tr",hru:"hru-latn-in",hrw:"hrw-latn-pg",hrx:"hrx-latn-br",hrz:"hrz-arab-ir",hsb:"hsb-latn-de",hsn:"hsn-hans-cn",hss:"hss-arab-om",ht:"ht-latn-ht",hti:"hti-latn-id",hto:"hto-latn-co",hts:"hts-latn-tz",htu:"htu-latn-id",htx:"htx-xsux-tr",hu:"hu-latn-hu",hub:"hub-latn-pe",huc:"huc-latn-bw",hud:"hud-latn-id",hue:"hue-latn-mx",huf:"huf-latn-pg",hug:"hug-latn-pe",huh:"huh-latn-cl",hui:"hui-latn-zz",huk:"huk-latn-id",hul:"hul-latn-pg",hum:"hum-latn-cd",hup:"hup-latn-us",hur:"hur-latn-ca",hus:"hus-latn-mx",hut:"hut-deva-np","hut-tibt":"hut-tibt-np",huu:"huu-latn-pe",huv:"huv-latn-mx",huw:"huw-latn-id",hux:"hux-latn-pe",huy:"huy-hebr-il",huz:"huz-cyrl-ru",hvc:"hvc-latn-ht",hve:"hve-latn-mx",hvk:"hvk-latn-nc",hvn:"hvn-latn-id",hvv:"hvv-latn-mx",hwa:"hwa-latn-ci",hwc:"hwc-latn-us",hwo:"hwo-latn-ng",hy:"hy-armn-am",hya:"hya-latn-cm",hyw:"hyw-armn-am",hz:"hz-latn-na",ia:"ia-latn-001",iai:"iai-latn-nc",ian:"ian-latn-zz",iar:"iar-latn-zz",iba:"iba-latn-my",ibb:"ibb-latn-ng",ibd:"ibd-latn-au",ibe:"ibe-latn-ng",ibg:"ibg-latn-ph",ibh:"ibh-latn-vn",ibl:"ibl-latn-ph",ibm:"ibm-latn-ng",ibn:"ibn-latn-ng",ibr:"ibr-latn-ng",ibu:"ibu-latn-id",iby:"iby-latn-zz",ica:"ica-latn-zz",ich:"ich-latn-zz",icr:"icr-latn-co",id:"id-latn-id",ida:"ida-latn-ke",idb:"idb-latn-in",idc:"idc-latn-ng",idd:"idd-latn-zz",ide:"ide-latn-ng",idi:"idi-latn-zz",idr:"idr-latn-ss",ids:"ids-latn-ng",idt:"idt-latn-tl",idu:"idu-latn-zz",ie:"ie-latn-001",ifa:"ifa-latn-ph",ifb:"ifb-latn-ph",ife:"ife-latn-tg",iff:"iff-latn-vu",ifk:"ifk-latn-ph",ifm:"ifm-latn-cg",ifu:"ifu-latn-ph",ify:"ify-latn-ph",ig:"ig-latn-ng",igb:"igb-latn-zz",ige:"ige-latn-zz",igg:"igg-latn-pg",igl:"igl-latn-ng",igm:"igm-latn-pg",ign:"ign-latn-bo",igo:"igo-latn-pg",igs:"igs-latn-001","igs-grek":"igs-grek-001",igw:"igw-latn-ng",ihb:"ihb-latn-id",ihi:"ihi-latn-ng",ihp:"ihp-latn-id",ihw:"ihw-latn-au",ii:"ii-yiii-cn",iin:"iin-latn-au",ijc:"ijc-latn-ng",ije:"ije-latn-ng",ijj:"ijj-latn-zz",ijn:"ijn-latn-ng",ijs:"ijs-latn-ng",ik:"ik-latn-us",iki:"iki-latn-ng",ikk:"ikk-latn-zz",ikl:"ikl-latn-ng",iko:"iko-latn-ng",ikp:"ikp-latn-ng",ikr:"ikr-latn-au",ikt:"ikt-latn-ca","ikt-cans":"ikt-cans-ca",ikv:"ikv-latn-ng",ikw:"ikw-latn-zz",ikx:"ikx-latn-zz",ikz:"ikz-latn-tz",ila:"ila-latn-id",ilb:"ilb-latn-zm",ilg:"ilg-latn-au",ili:"ili-latn-cn","ili-arab":"ili-arab-cn","ili-cyrl":"ili-cyrl-kz",ilk:"ilk-latn-ph",ilm:"ilm-latn-my",ilo:"ilo-latn-ph",ilp:"ilp-latn-ph",ilu:"ilu-latn-id",ilv:"ilv-latn-ng",imi:"imi-latn-pg",iml:"iml-latn-us",imn:"imn-latn-pg",imo:"imo-latn-zz",imr:"imr-latn-id",ims:"ims-latn-it",imt:"imt-latn-ss",imy:"imy-lyci-tr",in:"in-latn-id",inb:"inb-latn-co",ing:"ing-latn-us",inh:"inh-cyrl-ru",inj:"inj-latn-co",inn:"inn-latn-ph",ino:"ino-latn-pg",inp:"inp-latn-pe",int:"int-mymr-mm",io:"io-latn-001",ior:"ior-ethi-et",iou:"iou-latn-zz",iow:"iow-latn-us",ipi:"ipi-latn-pg",ipo:"ipo-latn-pg",iqu:"iqu-latn-pe",iqw:"iqw-latn-ng",ire:"ire-latn-id",irh:"irh-latn-id",iri:"iri-latn-zz",irk:"irk-latn-tz",irn:"irn-latn-br",iru:"iru-taml-in","iru-mlym":"iru-mlym-in",irx:"irx-latn-id",iry:"iry-latn-ph",is:"is-latn-is",isa:"isa-latn-pg",isc:"isc-latn-pe",isd:"isd-latn-ph",ish:"ish-latn-ng",isi:"isi-latn-ng",isk:"isk-arab-af","isk-cyrl":"isk-cyrl-tj",ism:"ism-latn-id",isn:"isn-latn-tz",iso:"iso-latn-ng",ist:"ist-latn-hr",isu:"isu-latn-cm",it:"it-latn-it",itb:"itb-latn-ph",itd:"itd-latn-id",ite:"ite-latn-bo",iti:"iti-latn-ph",itk:"itk-hebr-it",itl:"itl-cyrl-ru",itm:"itm-latn-ng",ito:"ito-latn-bo",itr:"itr-latn-pg",its:"its-latn-ng",itt:"itt-latn-ph",itv:"itv-latn-ph",itw:"itw-latn-ng",itx:"itx-latn-id",ity:"ity-latn-ph",itz:"itz-latn-gt",iu:"iu-cans-ca",ium:"ium-latn-cn","ium-hani":"ium-hani-cn","ium-laoo":"ium-laoo-la","ium-thai":"ium-thai-th",ivb:"ivb-latn-ph",ivv:"ivv-latn-ph",iw:"iw-hebr-il",iwk:"iwk-latn-ph",iwm:"iwm-latn-zz",iwo:"iwo-latn-id",iws:"iws-latn-zz",ixc:"ixc-latn-mx",ixl:"ixl-latn-gt",iya:"iya-latn-ng",iyo:"iyo-latn-cm",iyx:"iyx-latn-cg",izh:"izh-latn-ru",izi:"izi-latn-zz",izr:"izr-latn-ng",izz:"izz-latn-ng",ja:"ja-jpan-jp",jaa:"jaa-latn-br",jab:"jab-latn-zz",jac:"jac-latn-gt",jad:"jad-arab-gn",jae:"jae-latn-pg",jaf:"jaf-latn-ng",jah:"jah-latn-my",jaj:"jaj-latn-sb",jak:"jak-latn-my",jal:"jal-latn-id",jam:"jam-latn-jm",jan:"jan-latn-au",jao:"jao-latn-au",jaq:"jaq-latn-id",jar:"jar-latn-zz",jas:"jas-latn-nc",jat:"jat-arab-af",jau:"jau-latn-id",jax:"jax-latn-id",jay:"jay-latn-au",jaz:"jaz-latn-nc",jbe:"jbe-hebr-il",jbi:"jbi-latn-au",jbj:"jbj-latn-id",jbk:"jbk-latn-pg",jbm:"jbm-latn-ng",jbn:"jbn-arab-ly",jbo:"jbo-latn-001",jbr:"jbr-latn-id",jbt:"jbt-latn-br",jbu:"jbu-latn-zz",jbw:"jbw-latn-au",jct:"jct-cyrl-ua","jct-latn":"jct-latn-ua",jda:"jda-tibt-in",jdg:"jdg-arab-pk",jdt:"jdt-cyrl-ru","jdt-hebr":"jdt-hebr-ru","jdt-latn":"jdt-latn-az",jeb:"jeb-latn-pe",jee:"jee-deva-np",jeh:"jeh-latn-vn","jeh-laoo":"jeh-laoo-la",jei:"jei-latn-id",jek:"jek-latn-ci",jel:"jel-latn-id",jen:"jen-latn-zz",jer:"jer-latn-ng",jet:"jet-latn-pg",jeu:"jeu-latn-td",jgb:"jgb-latn-cd",jge:"jge-geor-ge","jge-hebr":"jge-hebr-il",jgk:"jgk-latn-zz",jgo:"jgo-latn-cm",jhi:"jhi-latn-my",ji:"ji-hebr-ua",jia:"jia-latn-cm",jib:"jib-latn-zz",jic:"jic-latn-hn",jid:"jid-latn-ng",jie:"jie-latn-ng",jig:"jig-latn-au",jil:"jil-latn-pg",jim:"jim-latn-cm",jit:"jit-latn-tz",jiu:"jiu-latn-cn",jiv:"jiv-latn-ec",jiy:"jiy-latn-cn",jje:"jje-hang-kr",jjr:"jjr-latn-ng",jka:"jka-latn-id",jkm:"jkm-mymr-mm","jkm-brai":"jkm-brai-mm","jkm-latn":"jkm-latn-mm",jko:"jko-latn-pg",jku:"jku-latn-ng",jle:"jle-latn-sd",jma:"jma-latn-pg",jmb:"jmb-latn-ng",jmc:"jmc-latn-tz",jmd:"jmd-latn-id",jmi:"jmi-latn-ng",jml:"jml-deva-np",jmn:"jmn-latn-mm",jmr:"jmr-latn-gh",jms:"jms-latn-ng",jmw:"jmw-latn-pg",jmx:"jmx-latn-mx",jna:"jna-takr-in",jnd:"jnd-arab-pk",jng:"jng-latn-au",jni:"jni-latn-ng",jnj:"jnj-latn-et","jnj-ethi":"jnj-ethi-et",jnl:"jnl-deva-in",jns:"jns-deva-in","jns-latn":"jns-latn-in","jns-takr":"jns-takr-in",job:"job-latn-cd",jod:"jod-latn-ci",jog:"jog-arab-pk",jor:"jor-latn-bo",jow:"jow-latn-ml",jpa:"jpa-hebr-ps",jpr:"jpr-hebr-il",jqr:"jqr-latn-pe",jra:"jra-latn-zz",jrr:"jrr-latn-ng",jrt:"jrt-latn-ng",jru:"jru-latn-ve",jua:"jua-latn-br",jub:"jub-latn-ng",jud:"jud-latn-ci",juh:"juh-latn-ng",jui:"jui-latn-au",juk:"juk-latn-ng",jul:"jul-deva-np",jum:"jum-latn-sd",jun:"jun-orya-in",juo:"juo-latn-ng",jup:"jup-latn-br",jur:"jur-latn-br",jut:"jut-latn-dk",juu:"juu-latn-ng",juw:"juw-latn-ng",juy:"juy-orya-in",jv:"jv-latn-id",jvd:"jvd-latn-id",jvn:"jvn-latn-sr",jw:"jw-latn-id",jwi:"jwi-latn-gh",jya:"jya-tibt-cn",jye:"jye-hebr-il",jyy:"jyy-latn-td",ka:"ka-geor-ge",kaa:"kaa-cyrl-uz",kab:"kab-latn-dz",kac:"kac-latn-mm",kad:"kad-latn-zz",kag:"kag-latn-my",kah:"kah-latn-cf",kai:"kai-latn-zz",kaj:"kaj-latn-ng",kak:"kak-latn-ph",kam:"kam-latn-ke",kao:"kao-latn-ml",kap:"kap-cyrl-ru",kaq:"kaq-latn-pe",kav:"kav-latn-br",kaw:"kaw-kawi-id",kax:"kax-latn-id",kay:"kay-latn-br",kba:"kba-latn-au",kbb:"kbb-latn-br",kbc:"kbc-latn-br",kbd:"kbd-cyrl-ru",kbe:"kbe-latn-au",kbh:"kbh-latn-co",kbi:"kbi-latn-id",kbj:"kbj-latn-cd",kbk:"kbk-latn-pg",kbl:"kbl-latn-td",kbm:"kbm-latn-zz",kbn:"kbn-latn-cf",kbo:"kbo-latn-ss",kbp:"kbp-latn-zz",kbq:"kbq-latn-zz",kbr:"kbr-latn-et","kbr-ethi":"kbr-ethi-et",kbs:"kbs-latn-ga",kbt:"kbt-latn-pg",kbu:"kbu-arab-pk",kbv:"kbv-latn-id",kbw:"kbw-latn-pg",kbx:"kbx-latn-zz",kby:"kby-arab-ne",kbz:"kbz-latn-ng",kca:"kca-cyrl-ru",kcb:"kcb-latn-pg",kcc:"kcc-latn-ng",kcd:"kcd-latn-id",kce:"kce-latn-ng",kcf:"kcf-latn-ng",kcg:"kcg-latn-ng",kch:"kch-latn-ng",kci:"kci-latn-ng",kcj:"kcj-latn-gw",kck:"kck-latn-zw",kcl:"kcl-latn-zz",kcm:"kcm-latn-cf",kcn:"kcn-latn-ug",kco:"kco-latn-pg",kcp:"kcp-latn-sd",kcq:"kcq-latn-ng",kcs:"kcs-latn-ng",kct:"kct-latn-zz",kcu:"kcu-latn-tz",kcv:"kcv-latn-cd",kcw:"kcw-latn-cd",kcz:"kcz-latn-tz",kda:"kda-latn-au",kdc:"kdc-latn-tz",kdd:"kdd-latn-au",kde:"kde-latn-tz",kdf:"kdf-latn-pg",kdg:"kdg-latn-cd",kdh:"kdh-latn-tg",kdi:"kdi-latn-ug",kdj:"kdj-latn-ug",kdk:"kdk-latn-nc",kdl:"kdl-latn-zz",kdm:"kdm-latn-ng",kdn:"kdn-latn-zw",kdp:"kdp-latn-ng",kdq:"kdq-beng-in",kdr:"kdr-latn-lt","kdr-cyrl":"kdr-cyrl-ua",kdt:"kdt-thai-th",kdw:"kdw-latn-id",kdx:"kdx-latn-ng",kdy:"kdy-latn-id",kdz:"kdz-latn-cm",kea:"kea-latn-cv",keb:"keb-latn-ga",kec:"kec-latn-sd",ked:"ked-latn-tz",kee:"kee-latn-us",kef:"kef-latn-tg",keg:"keg-latn-sd",keh:"keh-latn-pg",kei:"kei-latn-id",kek:"kek-latn-gt",kel:"kel-latn-cd",kem:"kem-latn-tl",ken:"ken-latn-cm",keo:"keo-latn-ug",ker:"ker-latn-td",kes:"kes-latn-ng",ket:"ket-cyrl-ru",keu:"keu-latn-tg",kew:"kew-latn-pg",kex:"kex-deva-in","kex-gujr":"kex-gujr-in",key:"key-telu-in",kez:"kez-latn-zz",kfa:"kfa-knda-in",kfb:"kfb-deva-in",kfc:"kfc-telu-in",kfd:"kfd-knda-in",kfe:"kfe-taml-in",kff:"kff-latn-in","kff-deva":"kff-deva-in","kff-orya":"kff-orya-in","kff-telu":"kff-telu-in",kfh:"kfh-mlym-in",kfi:"kfi-taml-in","kfi-knda":"kfi-knda-in",kfk:"kfk-deva-in","kfk-takr":"kfk-takr-in",kfl:"kfl-latn-cm",kfm:"kfm-arab-ir",kfn:"kfn-latn-cm",kfo:"kfo-latn-ci",kfp:"kfp-deva-in",kfq:"kfq-deva-in",kfr:"kfr-deva-in",kfs:"kfs-deva-in",kfv:"kfv-latn-in",kfw:"kfw-latn-in",kfx:"kfx-deva-in","kfx-takr":"kfx-takr-in",kfy:"kfy-deva-in",kfz:"kfz-latn-bf",kg:"kg-latn-cd",kga:"kga-latn-ci",kgb:"kgb-latn-id",kge:"kge-latn-id",kgf:"kgf-latn-zz",kgj:"kgj-deva-np",kgk:"kgk-latn-br",kgl:"kgl-latn-au",kgm:"kgm-latn-br",kgo:"kgo-latn-sd",kgp:"kgp-latn-br",kgq:"kgq-latn-id",kgr:"kgr-latn-id",kgs:"kgs-latn-au",kgt:"kgt-latn-ng",kgu:"kgu-latn-pg",kgv:"kgv-latn-id",kgw:"kgw-latn-id",kgx:"kgx-latn-id",kgy:"kgy-deva-np",kha:"kha-latn-in",khb:"khb-talu-cn",khc:"khc-latn-id",khd:"khd-latn-id",khe:"khe-latn-id",khf:"khf-thai-la",khg:"khg-tibt-cn",khh:"khh-latn-id",khj:"khj-latn-ng",khl:"khl-latn-pg",khn:"khn-deva-in",khp:"khp-latn-id",khq:"khq-latn-ml",khr:"khr-latn-in","khr-deva":"khr-deva-in",khs:"khs-latn-zz",kht:"kht-mymr-in",khu:"khu-latn-ao",khv:"khv-cyrl-ru",khw:"khw-arab-pk",khx:"khx-latn-cd",khy:"khy-latn-cd",khz:"khz-latn-zz",ki:"ki-latn-ke",kia:"kia-latn-td",kib:"kib-latn-sd",kic:"kic-latn-us",kid:"kid-latn-cm",kie:"kie-latn-td",kif:"kif-deva-np",kig:"kig-latn-id",kih:"kih-latn-pg",kij:"kij-latn-zz",kil:"kil-latn-ng",kim:"kim-cyrl-ru",kio:"kio-latn-us",kip:"kip-deva-np",kiq:"kiq-latn-id",kis:"kis-latn-pg",kit:"kit-latn-pg",kiu:"kiu-latn-tr",kiv:"kiv-latn-tz",kiw:"kiw-latn-zz",kix:"kix-latn-in",kiy:"kiy-latn-id",kiz:"kiz-latn-tz",kj:"kj-latn-na",kja:"kja-latn-id",kjb:"kjb-latn-gt",kjc:"kjc-latn-id",kjd:"kjd-latn-zz",kje:"kje-latn-id",kjg:"kjg-laoo-la",kjh:"kjh-cyrl-ru",kji:"kji-latn-sb",kjj:"kjj-latn-az",kjk:"kjk-latn-id",kjl:"kjl-deva-np",kjm:"kjm-latn-vn",kjn:"kjn-latn-au",kjo:"kjo-deva-in",kjp:"kjp-mymr-mm","kjp-thai":"kjp-thai-th",kjq:"kjq-latn-us",kjr:"kjr-latn-id",kjs:"kjs-latn-zz",kjt:"kjt-thai-th",kju:"kju-latn-us",kjx:"kjx-latn-pg",kjy:"kjy-latn-zz",kk:"kk-cyrl-kz","kk-af":"kk-arab-af","kk-arab":"kk-arab-cn","kk-cn":"kk-arab-cn","kk-ir":"kk-arab-ir","kk-mn":"kk-arab-mn",kka:"kka-latn-ng",kkb:"kkb-latn-id",kkc:"kkc-latn-zz",kkd:"kkd-latn-ng",kke:"kke-latn-gn","kke-arab":"kke-arab-gn",kkf:"kkf-tibt-in",kkg:"kkg-latn-ph",kkh:"kkh-lana-mm",kki:"kki-latn-tz",kkj:"kkj-latn-cm",kkk:"kkk-latn-sb",kkl:"kkl-latn-id",kkm:"kkm-latn-ng",kko:"kko-latn-sd",kkp:"kkp-latn-au",kkq:"kkq-latn-cd",kkr:"kkr-latn-ng",kks:"kks-latn-ng",kkt:"kkt-deva-np",kku:"kku-latn-ng",kkv:"kkv-latn-id",kkw:"kkw-latn-cg",kkx:"kkx-latn-id",kky:"kky-latn-au",kkz:"kkz-latn-ca",kl:"kl-latn-gl",kla:"kla-latn-us",klb:"klb-latn-mx",klc:"klc-latn-cm",kld:"kld-latn-au",kle:"kle-deva-np",klf:"klf-latn-td",klg:"klg-latn-ph",klh:"klh-latn-pg",kli:"kli-latn-id",klj:"klj-arab-ir",klk:"klk-latn-ng",kll:"kll-latn-ph",klm:"klm-latn-pg",kln:"kln-latn-ke",klo:"klo-latn-ng",klp:"klp-latn-pg",klq:"klq-latn-zz",klr:"klr-deva-np",kls:"kls-latn-pk","kls-arab":"kls-arab-pk",klt:"klt-latn-zz",klu:"klu-latn-lr",klv:"klv-latn-vu",klw:"klw-latn-id",klx:"klx-latn-zz",kly:"kly-latn-id",klz:"klz-latn-id",km:"km-khmr-kh",kma:"kma-latn-gh",kmb:"kmb-latn-ao",kmc:"kmc-latn-cn","kmc-hani":"kmc-hani-cn",kmd:"kmd-latn-ph",kme:"kme-latn-cm",kmf:"kmf-latn-pg",kmg:"kmg-latn-pg",kmh:"kmh-latn-zz",kmi:"kmi-latn-ng",kmj:"kmj-deva-in",kmk:"kmk-latn-ph",kml:"kml-latn-ph",kmm:"kmm-latn-in",kmn:"kmn-latn-pg",kmo:"kmo-latn-zz",kmp:"kmp-latn-cm",kmq:"kmq-latn-et",kms:"kms-latn-zz",kmt:"kmt-latn-id",kmu:"kmu-latn-zz",kmv:"kmv-latn-br",kmw:"kmw-latn-zz",kmx:"kmx-latn-pg",kmy:"kmy-latn-ng",kmz:"kmz-arab-ir",kn:"kn-knda-in",kna:"kna-latn-ng",knb:"knb-latn-ph",knd:"knd-latn-id",kne:"kne-latn-ph",knf:"knf-latn-gw",kni:"kni-latn-ng",knj:"knj-latn-gt",knk:"knk-latn-sl","knk-arab":"knk-arab-sl",knl:"knl-latn-id",knm:"knm-latn-br",kno:"kno-latn-sl",knp:"knp-latn-zz",knq:"knq-latn-my",knr:"knr-latn-pg",kns:"kns-latn-my","kns-thai":"kns-thai-th",knt:"knt-latn-br",knu:"knu-latn-gn",knv:"knv-latn-pg",knw:"knw-latn-na",knx:"knx-latn-id",kny:"kny-latn-cd",knz:"knz-latn-bf",ko:"ko-kore-kr",koa:"koa-latn-pg",koc:"koc-latn-ng",kod:"kod-latn-id",koe:"koe-latn-ss",kof:"kof-latn-ng",kog:"kog-latn-co",koh:"koh-latn-cg",koi:"koi-cyrl-ru",kok:"kok-deva-in",kol:"kol-latn-zz",koo:"koo-latn-ug",kop:"kop-latn-pg",koq:"koq-latn-ga",kos:"kos-latn-fm",kot:"kot-latn-cm",kou:"kou-latn-td",kov:"kov-latn-ng",kow:"kow-latn-ng",koy:"koy-latn-us",koz:"koz-latn-zz",kpa:"kpa-latn-ng",kpc:"kpc-latn-co",kpd:"kpd-latn-id",kpe:"kpe-latn-lr",kpf:"kpf-latn-zz",kpg:"kpg-latn-fm",kph:"kph-latn-gh",kpi:"kpi-latn-id",kpj:"kpj-latn-br",kpk:"kpk-latn-ng",kpl:"kpl-latn-cd",kpm:"kpm-latn-vn",kpn:"kpn-latn-br",kpo:"kpo-latn-zz",kpq:"kpq-latn-id",kpr:"kpr-latn-zz",kps:"kps-latn-id",kpt:"kpt-cyrl-ru",kpu:"kpu-latn-id",kpw:"kpw-latn-pg",kpx:"kpx-latn-zz",kpy:"kpy-cyrl-ru",kpz:"kpz-latn-ug",kqa:"kqa-latn-pg",kqb:"kqb-latn-zz",kqc:"kqc-latn-pg",kqd:"kqd-syrc-iq",kqe:"kqe-latn-ph",kqf:"kqf-latn-zz",kqg:"kqg-latn-bf",kqh:"kqh-latn-tz",kqi:"kqi-latn-pg",kqj:"kqj-latn-pg",kqk:"kqk-latn-bj",kql:"kql-latn-pg",kqm:"kqm-latn-ci",kqn:"kqn-latn-zm",kqo:"kqo-latn-lr",kqp:"kqp-latn-td",kqq:"kqq-latn-br",kqr:"kqr-latn-my",kqs:"kqs-latn-zz",kqt:"kqt-latn-my",kqu:"kqu-latn-za",kqv:"kqv-latn-id",kqw:"kqw-latn-pg",kqx:"kqx-latn-cm",kqy:"kqy-ethi-zz",kqz:"kqz-latn-za",kr:"kr-latn-zz",kra:"kra-deva-np",krb:"krb-latn-us",krc:"krc-cyrl-ru",krd:"krd-latn-tl",kre:"kre-latn-br",krf:"krf-latn-vu",krh:"krh-latn-ng",kri:"kri-latn-sl",krj:"krj-latn-ph",krk:"krk-cyrl-ru",krl:"krl-latn-ru",krn:"krn-latn-lr",krp:"krp-latn-ng",krr:"krr-khmr-kh",krs:"krs-latn-zz",krt:"krt-latn-ne",kru:"kru-deva-in",krv:"krv-khmr-kh",krw:"krw-latn-lr",krx:"krx-latn-sn",kry:"kry-latn-az",krz:"krz-latn-id",ks:"ks-arab-in",ksa:"ksa-latn-ng",ksb:"ksb-latn-tz",ksc:"ksc-latn-ph",ksd:"ksd-latn-zz",kse:"kse-latn-pg",ksf:"ksf-latn-cm",ksg:"ksg-latn-sb",ksh:"ksh-latn-de",ksi:"ksi-latn-pg",ksj:"ksj-latn-zz",ksk:"ksk-latn-us",ksl:"ksl-latn-pg",ksm:"ksm-latn-ng",ksn:"ksn-latn-ph",kso:"kso-latn-ng",ksp:"ksp-latn-cf",ksq:"ksq-latn-ng",ksr:"ksr-latn-zz",kss:"kss-latn-lr",kst:"kst-latn-bf",ksu:"ksu-mymr-in",ksv:"ksv-latn-cd",ksw:"ksw-mymr-mm","ksw-latn":"ksw-latn-mm",ksx:"ksx-latn-id",ksz:"ksz-deva-in",kta:"kta-latn-vn",ktb:"ktb-ethi-zz",ktc:"ktc-latn-ng",ktd:"ktd-latn-au",ktf:"ktf-latn-cd",ktg:"ktg-latn-au",kth:"kth-latn-td",kti:"kti-latn-id",ktj:"ktj-latn-ci",ktk:"ktk-latn-pg",ktl:"ktl-arab-ir",ktm:"ktm-latn-zz",ktn:"ktn-latn-br",kto:"kto-latn-zz",ktp:"ktp-plrd-cn",ktq:"ktq-latn-ph",ktr:"ktr-latn-my",kts:"kts-latn-id",ktt:"ktt-latn-id",ktu:"ktu-latn-cd",ktv:"ktv-latn-vn",ktw:"ktw-latn-us",ktx:"ktx-latn-br",kty:"kty-latn-cd",ktz:"ktz-latn-na",ku:"ku-latn-tr","ku-arab":"ku-arab-iq","ku-lb":"ku-arab-lb","ku-yezi":"ku-yezi-ge",kub:"kub-latn-zz",kuc:"kuc-latn-id",kud:"kud-latn-zz",kue:"kue-latn-zz",kuf:"kuf-laoo-la",kug:"kug-latn-ng",kuh:"kuh-latn-ng",kui:"kui-latn-br",kuj:"kuj-latn-zz",kuk:"kuk-latn-id",kul:"kul-latn-ng",kum:"kum-cyrl-ru",kun:"kun-latn-zz",kuo:"kuo-latn-pg",kup:"kup-latn-zz",kuq:"kuq-latn-br",kus:"kus-latn-zz",kut:"kut-latn-ca",kuu:"kuu-latn-us",kuv:"kuv-latn-id",kuw:"kuw-latn-cf",kux:"kux-latn-au",kuy:"kuy-latn-au",kuz:"kuz-latn-cl",kv:"kv-cyrl-ru",kva:"kva-cyrl-ru",kvb:"kvb-latn-id",kvc:"kvc-latn-pg",kvd:"kvd-latn-id",kve:"kve-latn-my",kvf:"kvf-latn-td",kvg:"kvg-latn-zz",kvh:"kvh-latn-id",kvi:"kvi-latn-td",kvj:"kvj-latn-cm",kvl:"kvl-latn-mm",kvm:"kvm-latn-cm",kvn:"kvn-latn-co",kvo:"kvo-latn-id",kvp:"kvp-latn-id",kvq:"kvq-mymr-mm","kvq-latn":"kvq-latn-mm",kvr:"kvr-latn-id",kvt:"kvt-mymr-mm",kvv:"kvv-latn-id",kvw:"kvw-latn-id",kvx:"kvx-arab-pk",kvy:"kvy-kali-mm",kvz:"kvz-latn-id",kw:"kw-latn-gb",kwa:"kwa-latn-br",kwb:"kwb-latn-ng",kwc:"kwc-latn-cg",kwd:"kwd-latn-sb",kwe:"kwe-latn-id",kwf:"kwf-latn-sb",kwg:"kwg-latn-td",kwh:"kwh-latn-id",kwi:"kwi-latn-co",kwj:"kwj-latn-zz",kwk:"kwk-latn-ca",kwl:"kwl-latn-ng",kwm:"kwm-latn-na",kwn:"kwn-latn-na",kwo:"kwo-latn-zz",kwp:"kwp-latn-ci",kwq:"kwq-latn-zz",kwr:"kwr-latn-id",kws:"kws-latn-cd",kwt:"kwt-latn-id",kwu:"kwu-latn-cm",kwv:"kwv-latn-td",kww:"kww-latn-sr",kwy:"kwy-latn-cd",kwz:"kwz-latn-ao",kxa:"kxa-latn-zz",kxb:"kxb-latn-ci",kxc:"kxc-ethi-zz",kxd:"kxd-latn-bn","kxd-arab":"kxd-arab-bn",kxe:"kxe-latn-zz",kxf:"kxf-mymr-mm","kxf-latn":"kxf-latn-mm",kxi:"kxi-latn-my",kxj:"kxj-latn-td",kxk:"kxk-mymr-mm",kxl:"kxl-deva-in",kxm:"kxm-thai-th",kxn:"kxn-latn-my",kxo:"kxo-latn-br",kxp:"kxp-arab-pk",kxq:"kxq-latn-id",kxr:"kxr-latn-pg",kxt:"kxt-latn-pg",kxv:"kxv-orya-in","kxv-latn":"kxv-latn-in","kxv-telu":"kxv-telu-in",kxw:"kxw-latn-zz",kxx:"kxx-latn-cg",kxy:"kxy-latn-vn",kxz:"kxz-latn-zz",ky:"ky-cyrl-kg","ky-arab":"ky-arab-cn","ky-cn":"ky-arab-cn","ky-latn":"ky-latn-tr","ky-tr":"ky-latn-tr",kya:"kya-latn-tz",kyb:"kyb-latn-ph",kyc:"kyc-latn-pg",kyd:"kyd-latn-id",kye:"kye-latn-zz",kyf:"kyf-latn-ci",kyg:"kyg-latn-pg",kyh:"kyh-latn-us",kyi:"kyi-latn-my",kyj:"kyj-latn-ph",kyk:"kyk-latn-ph",kyl:"kyl-latn-us",kym:"kym-latn-cf",kyn:"kyn-latn-ph",kyo:"kyo-latn-id",kyq:"kyq-latn-td",kyr:"kyr-latn-br",kys:"kys-latn-my",kyt:"kyt-latn-id",kyu:"kyu-kali-mm","kyu-latn":"kyu-latn-mm","kyu-mymr":"kyu-mymr-mm",kyv:"kyv-deva-np",kyw:"kyw-deva-in","kyw-beng":"kyw-beng-in","kyw-orya":"kyw-orya-in",kyx:"kyx-latn-zz",kyy:"kyy-latn-pg",kyz:"kyz-latn-br",kza:"kza-latn-bf",kzb:"kzb-latn-id",kzc:"kzc-latn-ci",kzd:"kzd-latn-id",kze:"kze-latn-pg",kzf:"kzf-latn-id",kzh:"kzh-arab-zz",kzi:"kzi-latn-my",kzj:"kzj-latn-my",kzk:"kzk-latn-sb",kzl:"kzl-latn-id",kzm:"kzm-latn-id",kzn:"kzn-latn-mw",kzo:"kzo-latn-ga",kzp:"kzp-latn-id",kzr:"kzr-latn-zz",kzs:"kzs-latn-my",kzt:"kzt-latn-my",kzu:"kzu-latn-id",kzv:"kzv-latn-id",kzw:"kzw-latn-br",kzx:"kzx-latn-id",kzy:"kzy-latn-cd",kzz:"kzz-latn-id",la:"la-latn-va",laa:"laa-latn-ph",lab:"lab-lina-gr",lac:"lac-latn-mx",lad:"lad-hebr-il",lae:"lae-deva-in","lae-tibt":"lae-tibt-in",lag:"lag-latn-tz",lah:"lah-arab-pk",lai:"lai-latn-mw",laj:"laj-latn-ug",lal:"lal-latn-cd",lam:"lam-latn-zm",lan:"lan-latn-ng",lap:"lap-latn-td",laq:"laq-latn-vn",lar:"lar-latn-gh",las:"las-latn-zz",lau:"lau-latn-id",law:"law-latn-id",lax:"lax-latn-in","lax-beng":"lax-beng-in",laz:"laz-latn-pg",lb:"lb-latn-lu",lbb:"lbb-latn-pg",lbc:"lbc-lisu-cn",lbe:"lbe-cyrl-ru",lbf:"lbf-deva-in","lbf-tibt":"lbf-tibt-cn",lbi:"lbi-latn-cm",lbj:"lbj-tibt-in","lbj-arab":"lbj-arab-in",lbl:"lbl-latn-ph",lbm:"lbm-deva-in",lbn:"lbn-latn-la","lbn-laoo":"lbn-laoo-la",lbo:"lbo-laoo-la","lbo-latn":"lbo-latn-us",lbq:"lbq-latn-pg",lbr:"lbr-deva-np",lbt:"lbt-latn-vn",lbu:"lbu-latn-zz",lbv:"lbv-latn-pg",lbw:"lbw-latn-id",lbx:"lbx-latn-id",lby:"lby-latn-au",lbz:"lbz-latn-au",lcc:"lcc-latn-id",lcd:"lcd-latn-id",lce:"lce-latn-id",lcf:"lcf-latn-id",lch:"lch-latn-ao",lcl:"lcl-latn-id",lcm:"lcm-latn-zz",lcp:"lcp-thai-cn",lcq:"lcq-latn-id",lcs:"lcs-latn-id",lda:"lda-latn-ci",ldb:"ldb-latn-zz",ldd:"ldd-latn-ng",ldg:"ldg-latn-ng",ldh:"ldh-latn-ng",ldi:"ldi-latn-cg",ldj:"ldj-latn-ng",ldk:"ldk-latn-ng",ldl:"ldl-latn-ng",ldm:"ldm-latn-gn",ldn:"ldn-latn-001",ldo:"ldo-latn-ng",ldp:"ldp-latn-ng",ldq:"ldq-latn-ng",lea:"lea-latn-cd",leb:"leb-latn-zm",lec:"lec-latn-bo",led:"led-latn-zz",lee:"lee-latn-zz",lef:"lef-latn-gh",leh:"leh-latn-zm",lei:"lei-latn-pg",lej:"lej-latn-cd",lek:"lek-latn-pg",lel:"lel-latn-cd",lem:"lem-latn-zz",len:"len-latn-hn",leo:"leo-latn-cm",lep:"lep-lepc-in",leq:"leq-latn-zz",ler:"ler-latn-pg",les:"les-latn-cd",let:"let-latn-pg",leu:"leu-latn-zz",lev:"lev-latn-id",lew:"lew-latn-id",lex:"lex-latn-id",ley:"ley-latn-id",lez:"lez-cyrl-ru",lfa:"lfa-latn-cm",lfn:"lfn-latn-001","lfn-cyrl":"lfn-cyrl-001",lg:"lg-latn-ug",lga:"lga-latn-sb",lgb:"lgb-latn-sb",lgg:"lgg-latn-zz",lgh:"lgh-latn-vn",lgi:"lgi-latn-id",lgk:"lgk-latn-vu",lgl:"lgl-latn-sb",lgm:"lgm-latn-cd",lgn:"lgn-latn-et",lgo:"lgo-latn-ss",lgq:"lgq-latn-gh",lgr:"lgr-latn-sb",lgt:"lgt-latn-pg",lgu:"lgu-latn-sb",lgz:"lgz-latn-cd",lha:"lha-latn-vn",lhh:"lhh-latn-id",lhi:"lhi-latn-cn",lhm:"lhm-deva-np",lhn:"lhn-latn-my",lhs:"lhs-syrc-sy",lht:"lht-latn-vu",lhu:"lhu-latn-cn",li:"li-latn-nl",lia:"lia-latn-zz",lib:"lib-latn-pg",lic:"lic-latn-cn",lid:"lid-latn-zz",lie:"lie-latn-cd",lif:"lif-deva-np","lif-limb":"lif-limb-in",lig:"lig-latn-zz",lih:"lih-latn-zz",lij:"lij-latn-it",lik:"lik-latn-cd",lil:"lil-latn-ca",lio:"lio-latn-id",lip:"lip-latn-gh",liq:"liq-latn-et",lir:"lir-latn-lr",lis:"lis-lisu-cn",liu:"liu-latn-sd",liv:"liv-latn-lv",liw:"liw-latn-id",lix:"lix-latn-id",liy:"liy-latn-cf",liz:"liz-latn-cd",lja:"lja-latn-au",lje:"lje-latn-id",lji:"lji-latn-id",ljl:"ljl-latn-id",ljp:"ljp-latn-id",ljw:"ljw-latn-au",ljx:"ljx-latn-au",lka:"lka-latn-tl",lkb:"lkb-latn-ke",lkc:"lkc-latn-vn",lkd:"lkd-latn-br",lke:"lke-latn-ug",lkh:"lkh-tibt-bt",lki:"lki-arab-ir",lkj:"lkj-latn-my",lkl:"lkl-latn-pg",lkm:"lkm-latn-au",lkn:"lkn-latn-vu",lko:"lko-latn-ke",lkr:"lkr-latn-ss",lks:"lks-latn-ke",lkt:"lkt-latn-us",lku:"lku-latn-au",lky:"lky-latn-ss",lla:"lla-latn-ng",llb:"llb-latn-mz",llc:"llc-latn-gn",lld:"lld-latn-it",lle:"lle-latn-zz",llf:"llf-latn-pg",llg:"llg-latn-id",lli:"lli-latn-cg",llj:"llj-latn-au",llk:"llk-latn-my",lll:"lll-latn-pg",llm:"llm-latn-id",lln:"lln-latn-zz",llp:"llp-latn-vu",llq:"llq-latn-id",llu:"llu-latn-sb",llx:"llx-latn-fj",lma:"lma-latn-gn",lmb:"lmb-latn-vu",lmc:"lmc-latn-au",lmd:"lmd-latn-sd",lme:"lme-latn-td",lmf:"lmf-latn-id",lmg:"lmg-latn-pg",lmh:"lmh-deva-np",lmi:"lmi-latn-cd",lmj:"lmj-latn-id",lmk:"lmk-latn-in","lmk-mymr":"lmk-mymr-in",lml:"lml-latn-vu",lmn:"lmn-telu-in",lmo:"lmo-latn-it",lmp:"lmp-latn-zz",lmq:"lmq-latn-id",lmr:"lmr-latn-id",lmu:"lmu-latn-vu",lmv:"lmv-latn-fj",lmw:"lmw-latn-us",lmx:"lmx-latn-cm",lmy:"lmy-latn-id",ln:"ln-latn-cd",lna:"lna-latn-cf",lnb:"lnb-latn-na",lnd:"lnd-latn-id",lnh:"lnh-latn-my",lni:"lni-latn-pg",lnj:"lnj-latn-au",lnl:"lnl-latn-cf",lnm:"lnm-latn-pg",lnn:"lnn-latn-vu",lns:"lns-latn-zz",lnu:"lnu-latn-zz",lnw:"lnw-latn-au",lnz:"lnz-latn-cd",lo:"lo-laoo-la",loa:"loa-latn-id",lob:"lob-latn-bf",loc:"loc-latn-ph",loe:"loe-latn-id",log:"log-latn-cd",loh:"loh-latn-ss",loi:"loi-latn-ci",loj:"loj-latn-zz",lok:"lok-latn-zz",lol:"lol-latn-cd",lom:"lom-latn-lr",lon:"lon-latn-mw",loo:"loo-latn-cd",lop:"lop-latn-ng",loq:"loq-latn-cd",lor:"lor-latn-zz",los:"los-latn-zz",lot:"lot-latn-ss","lot-arab":"lot-arab-ss",lou:"lou-latn-us",low:"low-latn-my",lox:"lox-latn-id",loy:"loy-deva-np","loy-tibt":"loy-tibt-np",loz:"loz-latn-zm",lpa:"lpa-latn-vu",lpe:"lpe-latn-id",lpn:"lpn-latn-mm",lpo:"lpo-plrd-cn","lpo-lisu":"lpo-lisu-cn",lpx:"lpx-latn-ss",lqr:"lqr-latn-ss",lra:"lra-latn-my",lrc:"lrc-arab-ir",lrg:"lrg-latn-au",lri:"lri-latn-ke",lrk:"lrk-arab-pk",lrl:"lrl-arab-ir",lrm:"lrm-latn-ke",lrn:"lrn-latn-id",lro:"lro-latn-sd",lrt:"lrt-latn-id",lrv:"lrv-latn-vu",lrz:"lrz-latn-vu",lsa:"lsa-arab-ir",lsd:"lsd-hebr-il",lse:"lse-latn-cd",lsi:"lsi-latn-mm",lsm:"lsm-latn-ug",lsr:"lsr-latn-pg",lss:"lss-arab-pk",lt:"lt-latn-lt",ltg:"ltg-latn-lv",lth:"lth-latn-ug",lti:"lti-latn-id",ltn:"ltn-latn-br",lto:"lto-latn-ke",lts:"lts-latn-ke",ltu:"ltu-latn-id",lu:"lu-latn-cd",lua:"lua-latn-cd",luc:"luc-latn-ug",lud:"lud-latn-ru",lue:"lue-latn-zm",luf:"luf-latn-pg",lui:"lui-latn-us",luj:"luj-latn-cd",luk:"luk-tibt-bt",lul:"lul-latn-ss",lum:"lum-latn-ao",lun:"lun-latn-zm",luo:"luo-latn-ke",lup:"lup-latn-ga",luq:"luq-latn-cu",lur:"lur-latn-id",lus:"lus-latn-in","lus-beng":"lus-beng-bd","lus-brai":"lus-brai-in",lut:"lut-latn-us",luu:"luu-deva-np",luv:"luv-arab-om",luw:"luw-latn-cm",luy:"luy-latn-ke",luz:"luz-arab-ir",lv:"lv-latn-lv",lva:"lva-latn-tl",lvi:"lvi-latn-la",lvk:"lvk-latn-sb",lvu:"lvu-latn-id",lwa:"lwa-latn-cd",lwe:"lwe-latn-id",lwg:"lwg-latn-ke",lwh:"lwh-latn-vn",lwl:"lwl-thai-th",lwm:"lwm-thai-cn",lwo:"lwo-latn-ss","lwo-za":"lwo-latn-za",lwt:"lwt-latn-id",lww:"lww-latn-vu",lxm:"lxm-latn-pg",lya:"lya-tibt-bt",lyn:"lyn-latn-zm",lzh:"lzh-hans-cn",lzl:"lzl-latn-vu",lzn:"lzn-latn-mm",lzz:"lzz-latn-tr",maa:"maa-latn-mx",mab:"mab-latn-mx",mad:"mad-latn-id",mae:"mae-latn-ng",maf:"maf-latn-cm",mag:"mag-deva-in",mai:"mai-deva-in",maj:"maj-latn-mx",mak:"mak-latn-id",mam:"mam-latn-gt",man:"man-latn-gm","man-gn":"man-nkoo-gn","man-nkoo":"man-nkoo-gn",maq:"maq-latn-mx",mas:"mas-latn-ke",mat:"mat-latn-mx",mau:"mau-latn-mx",mav:"mav-latn-br",maw:"maw-latn-zz",max:"max-latn-id",maz:"maz-latn-mx",mba:"mba-latn-ph",mbb:"mbb-latn-ph",mbc:"mbc-latn-br",mbd:"mbd-latn-ph",mbf:"mbf-latn-sg",mbh:"mbh-latn-zz",mbi:"mbi-latn-ph",mbj:"mbj-latn-br",mbk:"mbk-latn-pg",mbl:"mbl-latn-br",mbm:"mbm-latn-cg",mbn:"mbn-latn-co",mbo:"mbo-latn-zz",mbp:"mbp-latn-co",mbq:"mbq-latn-zz",mbr:"mbr-latn-co",mbs:"mbs-latn-ph",mbt:"mbt-latn-ph",mbu:"mbu-latn-zz",mbv:"mbv-latn-gn",mbw:"mbw-latn-zz",mbx:"mbx-latn-pg",mby:"mby-arab-pk",mbz:"mbz-latn-mx",mca:"mca-latn-py",mcb:"mcb-latn-pe",mcc:"mcc-latn-pg",mcd:"mcd-latn-pe",mce:"mce-latn-mx",mcf:"mcf-latn-pe",mcg:"mcg-latn-ve",mch:"mch-latn-ve",mci:"mci-latn-zz",mcj:"mcj-latn-ng",mck:"mck-latn-ao",mcl:"mcl-latn-co",mcm:"mcm-latn-my",mcn:"mcn-latn-td",mco:"mco-latn-mx",mcp:"mcp-latn-zz",mcq:"mcq-latn-zz",mcr:"mcr-latn-zz",mcs:"mcs-latn-cm",mct:"mct-latn-cm",mcu:"mcu-latn-zz",mcv:"mcv-latn-pg",mcw:"mcw-latn-td",mcx:"mcx-latn-cf",mcy:"mcy-latn-pg",mcz:"mcz-latn-pg",mda:"mda-latn-zz",mdb:"mdb-latn-pg",mdc:"mdc-latn-pg",mdd:"mdd-latn-cm",mde:"mde-arab-zz",mdf:"mdf-cyrl-ru",mdg:"mdg-latn-td",mdh:"mdh-latn-ph",mdi:"mdi-latn-cd",mdj:"mdj-latn-zz",mdk:"mdk-latn-cd",mdm:"mdm-latn-cd",mdn:"mdn-latn-cf",mdp:"mdp-latn-cd",mdq:"mdq-latn-cd",mdr:"mdr-latn-id",mds:"mds-latn-pg",mdt:"mdt-latn-cg",mdu:"mdu-latn-cg",mdv:"mdv-latn-mx",mdw:"mdw-latn-cg",mdx:"mdx-ethi-zz",mdy:"mdy-ethi-et","mdy-latn":"mdy-latn-et",mdz:"mdz-latn-br",mea:"mea-latn-cm",meb:"meb-latn-pg",mec:"mec-latn-au",med:"med-latn-zz",mee:"mee-latn-zz",meh:"meh-latn-mx",mej:"mej-latn-id",mek:"mek-latn-zz",mel:"mel-latn-my",mem:"mem-latn-au",men:"men-latn-sl",meo:"meo-latn-my","meo-arab":"meo-arab-my",mep:"mep-latn-au",meq:"meq-latn-cm",mer:"mer-latn-ke",mes:"mes-latn-td",met:"met-latn-zz",meu:"meu-latn-zz",mev:"mev-latn-lr",mew:"mew-latn-ng",mey:"mey-latn-mr","mey-arab":"mey-arab-mr",mez:"mez-latn-us",mfa:"mfa-arab-th",mfb:"mfb-latn-id",mfc:"mfc-latn-cd",mfd:"mfd-latn-cm",mfe:"mfe-latn-mu",mff:"mff-latn-cm",mfg:"mfg-latn-gn","mfg-arab":"mfg-arab-gn",mfh:"mfh-latn-cm",mfi:"mfi-arab-cm","mfi-latn":"mfi-latn-cm",mfj:"mfj-latn-cm",mfk:"mfk-latn-cm",mfl:"mfl-latn-ng",mfm:"mfm-latn-ng",mfn:"mfn-latn-zz",mfo:"mfo-latn-zz",mfp:"mfp-latn-id",mfq:"mfq-latn-zz",mfr:"mfr-latn-au",mft:"mft-latn-pg",mfu:"mfu-latn-ao",mfv:"mfv-latn-gw",mfw:"mfw-latn-pg",mfx:"mfx-latn-et","mfx-ethi":"mfx-ethi-et",mfy:"mfy-latn-mx",mfz:"mfz-latn-ss",mg:"mg-latn-mg",mgb:"mgb-latn-td",mgc:"mgc-latn-ss",mgd:"mgd-latn-ss","mgd-arab":"mgd-arab-ss",mge:"mge-latn-td",mgf:"mgf-latn-id",mgg:"mgg-latn-cm",mgh:"mgh-latn-mz",mgi:"mgi-latn-ng",mgj:"mgj-latn-ng",mgk:"mgk-latn-id",mgl:"mgl-latn-zz",mgm:"mgm-latn-tl",mgn:"mgn-latn-cf",mgo:"mgo-latn-cm",mgp:"mgp-deva-np",mgq:"mgq-latn-tz",mgr:"mgr-latn-zm",mgs:"mgs-latn-tz",mgt:"mgt-latn-pg",mgu:"mgu-latn-pg",mgv:"mgv-latn-tz",mgw:"mgw-latn-tz",mgy:"mgy-latn-tz",mgz:"mgz-latn-tz",mh:"mh-latn-mh",mhb:"mhb-latn-ga",mhc:"mhc-latn-mx",mhd:"mhd-latn-tz",mhe:"mhe-latn-my",mhf:"mhf-latn-pg",mhg:"mhg-latn-au",mhi:"mhi-latn-zz",mhj:"mhj-arab-af",mhk:"mhk-latn-cm",mhl:"mhl-latn-zz",mhm:"mhm-latn-mz",mhn:"mhn-latn-it",mho:"mho-latn-zm",mhp:"mhp-latn-id",mhq:"mhq-latn-us",mhs:"mhs-latn-id",mht:"mht-latn-ve",mhu:"mhu-latn-in",mhw:"mhw-latn-bw",mhx:"mhx-latn-mm",mhy:"mhy-latn-id",mhz:"mhz-latn-id",mi:"mi-latn-nz",mia:"mia-latn-us",mib:"mib-latn-mx",mic:"mic-latn-ca",mid:"mid-mand-iq",mie:"mie-latn-mx",mif:"mif-latn-zz",mig:"mig-latn-mx",mih:"mih-latn-mx",mii:"mii-latn-mx",mij:"mij-latn-cm",mik:"mik-latn-us",mil:"mil-latn-mx",mim:"mim-latn-mx",min:"min-latn-id",mio:"mio-latn-mx",mip:"mip-latn-mx",miq:"miq-latn-ni",mir:"mir-latn-mx",mit:"mit-latn-mx",miu:"miu-latn-mx",miw:"miw-latn-zz",mix:"mix-latn-mx",miy:"miy-latn-mx",miz:"miz-latn-mx",mjb:"mjb-latn-tl",mjc:"mjc-latn-mx",mjd:"mjd-latn-us",mje:"mje-latn-td",mjg:"mjg-latn-cn",mjh:"mjh-latn-tz",mji:"mji-latn-cn",mjj:"mjj-latn-pg",mjk:"mjk-latn-pg",mjl:"mjl-deva-in","mjl-takr":"mjl-takr-in",mjm:"mjm-latn-pg",mjn:"mjn-latn-pg",mjq:"mjq-mlym-in",mjr:"mjr-mlym-in",mjs:"mjs-latn-ng",mjt:"mjt-deva-in","mjt-beng":"mjt-beng-bd",mju:"mju-telu-in",mjv:"mjv-mlym-in",mjw:"mjw-latn-in",mjx:"mjx-latn-bd","mjx-beng":"mjx-beng-bd",mjy:"mjy-latn-us",mjz:"mjz-deva-np",mk:"mk-cyrl-mk",mka:"mka-latn-ci",mkb:"mkb-deva-in",mkc:"mkc-latn-pg",mke:"mke-deva-in",mkf:"mkf-latn-ng",mki:"mki-arab-zz",mkj:"mkj-latn-fm",mkk:"mkk-latn-cm",mkl:"mkl-latn-zz",mkm:"mkm-thai-th",mkn:"mkn-latn-id",mko:"mko-latn-ng",mkp:"mkp-latn-zz",mkr:"mkr-latn-pg",mks:"mks-latn-mx",mkt:"mkt-latn-nc",mku:"mku-latn-gn",mkv:"mkv-latn-vu",mkw:"mkw-latn-zz",mkx:"mkx-latn-ph",mky:"mky-latn-id",mkz:"mkz-latn-tl",ml:"ml-mlym-in",mla:"mla-latn-vu",mlb:"mlb-latn-cm",mlc:"mlc-latn-vn",mle:"mle-latn-zz",mlf:"mlf-thai-la","mlf-latn":"mlf-latn-la",mlh:"mlh-latn-pg",mli:"mli-latn-id",mlj:"mlj-latn-td",mlk:"mlk-latn-ke",mll:"mll-latn-vu",mln:"mln-latn-sb",mlo:"mlo-latn-sn",mlp:"mlp-latn-zz",mlq:"mlq-latn-sn","mlq-arab":"mlq-arab-sn",mlr:"mlr-latn-cm",mls:"mls-latn-sd",mlu:"mlu-latn-sb",mlv:"mlv-latn-vu",mlw:"mlw-latn-cm",mlx:"mlx-latn-vu",mlz:"mlz-latn-ph",mma:"mma-latn-ng",mmb:"mmb-latn-id",mmc:"mmc-latn-mx",mmd:"mmd-latn-cn","mmd-hans":"mmd-hans-cn","mmd-hant":"mmd-hant-cn",mme:"mme-latn-vu",mmf:"mmf-latn-ng",mmg:"mmg-latn-vu",mmh:"mmh-latn-br",mmi:"mmi-latn-pg",mmm:"mmm-latn-vu",mmn:"mmn-latn-ph",mmo:"mmo-latn-zz",mmp:"mmp-latn-pg",mmq:"mmq-latn-pg",mmr:"mmr-latn-cn",mmt:"mmt-latn-pg",mmu:"mmu-latn-zz",mmv:"mmv-latn-br",mmw:"mmw-latn-vu",mmx:"mmx-latn-zz",mmy:"mmy-latn-td",mmz:"mmz-latn-cd",mn:"mn-cyrl-mn","mn-cn":"mn-mong-cn","mn-mong":"mn-mong-cn",mna:"mna-latn-zz",mnb:"mnb-latn-id",mnd:"mnd-latn-br",mne:"mne-latn-td",mnf:"mnf-latn-zz",mng:"mng-latn-vn",mnh:"mnh-latn-cd",mni:"mni-beng-in",mnj:"mnj-arab-af",mnl:"mnl-latn-vu",mnm:"mnm-latn-pg",mnn:"mnn-latn-vn",mnp:"mnp-latn-cn",mnq:"mnq-latn-my",mnr:"mnr-latn-us",mns:"mns-cyrl-ru",mnu:"mnu-latn-id",mnv:"mnv-latn-sb",mnw:"mnw-mymr-mm",mnx:"mnx-latn-id",mny:"mny-latn-mz",mnz:"mnz-latn-id",mo:"mo-latn-ro",moa:"moa-latn-zz",moc:"moc-latn-ar",mod:"mod-latn-us",moe:"moe-latn-ca",mog:"mog-latn-id",moh:"moh-latn-ca",moi:"moi-latn-ng",moj:"moj-latn-cg",mok:"mok-latn-id",mom:"mom-latn-ni",moo:"moo-latn-vn",mop:"mop-latn-bz",moq:"moq-latn-id",mor:"mor-latn-sd",mos:"mos-latn-bf",mot:"mot-latn-co",mou:"mou-latn-td",mov:"mov-latn-us",mow:"mow-latn-cg",mox:"mox-latn-zz",moy:"moy-latn-et","moy-ethi":"moy-ethi-et",moz:"moz-latn-td",mpa:"mpa-latn-tz",mpb:"mpb-latn-au",mpc:"mpc-latn-au",mpd:"mpd-latn-br",mpe:"mpe-latn-et","mpe-ethi":"mpe-ethi-et",mpg:"mpg-latn-td",mph:"mph-latn-au",mpi:"mpi-latn-cm",mpj:"mpj-latn-au",mpk:"mpk-latn-td",mpl:"mpl-latn-pg",mpm:"mpm-latn-mx",mpn:"mpn-latn-pg",mpo:"mpo-latn-pg",mpp:"mpp-latn-zz",mpq:"mpq-latn-br",mpr:"mpr-latn-sb",mps:"mps-latn-zz",mpt:"mpt-latn-zz",mpu:"mpu-latn-br",mpv:"mpv-latn-pg",mpw:"mpw-latn-br",mpx:"mpx-latn-zz",mpy:"mpy-latn-id",mpz:"mpz-thai-th",mqa:"mqa-latn-id",mqb:"mqb-latn-cm",mqc:"mqc-latn-id",mqe:"mqe-latn-pg",mqf:"mqf-latn-id",mqg:"mqg-latn-id",mqh:"mqh-latn-mx",mqi:"mqi-latn-id",mqj:"mqj-latn-id",mqk:"mqk-latn-ph",mql:"mql-latn-zz",mqm:"mqm-latn-pf",mqn:"mqn-latn-id",mqo:"mqo-latn-id",mqp:"mqp-latn-id",mqq:"mqq-latn-my",mqr:"mqr-latn-id",mqs:"mqs-latn-id",mqu:"mqu-latn-ss",mqv:"mqv-latn-pg",mqw:"mqw-latn-pg",mqx:"mqx-latn-id","mqx-bugi":"mqx-bugi-id",mqy:"mqy-latn-id",mqz:"mqz-latn-pg",mr:"mr-deva-in",mra:"mra-thai-th",mrb:"mrb-latn-vu",mrc:"mrc-latn-us",mrd:"mrd-deva-np",mrf:"mrf-latn-id",mrg:"mrg-latn-in","mrg-beng":"mrg-beng-in","mrg-deva":"mrg-deva-in",mrh:"mrh-latn-in",mrj:"mrj-cyrl-ru",mrk:"mrk-latn-nc",mrl:"mrl-latn-fm",mrm:"mrm-latn-vu",mrn:"mrn-latn-sb",mro:"mro-mroo-bd",mrp:"mrp-latn-vu",mrq:"mrq-latn-pf",mrr:"mrr-deva-in",mrs:"mrs-latn-vu",mrt:"mrt-latn-ng",mru:"mru-latn-cm",mrv:"mrv-latn-pf",mrw:"mrw-latn-ph","mrw-arab":"mrw-arab-ph",mrx:"mrx-latn-id",mry:"mry-latn-ph",mrz:"mrz-latn-id",ms:"ms-latn-my","ms-cc":"ms-arab-cc",msb:"msb-latn-ph",msc:"msc-latn-gn",mse:"mse-latn-td",msf:"msf-latn-id",msg:"msg-latn-id",msh:"msh-latn-mg",msi:"msi-latn-my",msj:"msj-latn-cd",msk:"msk-latn-ph",msl:"msl-latn-id",msm:"msm-latn-ph",msn:"msn-latn-vu",mso:"mso-latn-id",msp:"msp-latn-br",msq:"msq-latn-nc",mss:"mss-latn-id",msu:"msu-latn-pg",msv:"msv-latn-cm",msw:"msw-latn-gw",msx:"msx-latn-pg",msy:"msy-latn-pg",msz:"msz-latn-pg",mt:"mt-latn-mt",mta:"mta-latn-ph",mtb:"mtb-latn-ci",mtc:"mtc-latn-zz",mtd:"mtd-latn-id",mte:"mte-latn-sb",mtf:"mtf-latn-zz",mtg:"mtg-latn-id",mth:"mth-latn-id",mti:"mti-latn-zz",mtj:"mtj-latn-id",mtk:"mtk-latn-cm",mtl:"mtl-latn-ng",mtm:"mtm-cyrl-ru",mtn:"mtn-latn-ni",mto:"mto-latn-mx",mtp:"mtp-latn-bo",mtq:"mtq-latn-vn",mtr:"mtr-deva-in",mts:"mts-latn-pe",mtt:"mtt-latn-vu",mtu:"mtu-latn-mx",mtv:"mtv-latn-pg",mtw:"mtw-latn-ph",mtx:"mtx-latn-mx",mty:"mty-latn-pg",mua:"mua-latn-cm",mub:"mub-latn-td",muc:"muc-latn-cm",mud:"mud-cyrl-ru",mue:"mue-latn-ec",mug:"mug-latn-cm",muh:"muh-latn-ss",mui:"mui-latn-id",muj:"muj-latn-td",muk:"muk-tibt-np",mum:"mum-latn-pg",muo:"muo-latn-cm",muq:"muq-latn-cn",mur:"mur-latn-zz",mus:"mus-latn-us",mut:"mut-deva-in",muu:"muu-latn-ke",muv:"muv-taml-in",mux:"mux-latn-pg",muy:"muy-latn-cm",muz:"muz-ethi-et","muz-latn":"muz-latn-et",mva:"mva-latn-zz",mvd:"mvd-latn-id",mvf:"mvf-mong-cn","mvf-phag":"mvf-phag-cn",mvg:"mvg-latn-mx",mvh:"mvh-latn-td",mvk:"mvk-latn-pg",mvl:"mvl-latn-au",mvn:"mvn-latn-zz",mvo:"mvo-latn-sb",mvp:"mvp-latn-id",mvq:"mvq-latn-pg",mvr:"mvr-latn-id",mvs:"mvs-latn-id",mvt:"mvt-latn-vu",mvu:"mvu-latn-td",mvv:"mvv-latn-my",mvw:"mvw-latn-tz",mvx:"mvx-latn-id",mvy:"mvy-arab-pk",mvz:"mvz-ethi-et","mvz-arab":"mvz-arab-et",mwa:"mwa-latn-pg",mwb:"mwb-latn-pg",mwc:"mwc-latn-pg",mwe:"mwe-latn-tz",mwf:"mwf-latn-au",mwg:"mwg-latn-pg",mwh:"mwh-latn-pg",mwi:"mwi-latn-vu",mwk:"mwk-latn-ml",mwl:"mwl-latn-pt",mwm:"mwm-latn-td",mwn:"mwn-latn-zm",mwo:"mwo-latn-vu",mwp:"mwp-latn-au",mwq:"mwq-latn-mm",mwr:"mwr-deva-in",mws:"mws-latn-ke",mwt:"mwt-mymr-mm","mwt-thai":"mwt-thai-th",mwu:"mwu-latn-ss",mwv:"mwv-latn-id",mww:"mww-hmnp-us",mwz:"mwz-latn-cd",mxa:"mxa-latn-mx",mxb:"mxb-latn-mx",mxc:"mxc-latn-zw",mxd:"mxd-latn-id",mxe:"mxe-latn-vu",mxf:"mxf-latn-cm",mxg:"mxg-latn-ao",mxh:"mxh-latn-cd",mxi:"mxi-latn-es",mxj:"mxj-latn-in",mxk:"mxk-latn-pg",mxl:"mxl-latn-bj",mxm:"mxm-latn-zz",mxn:"mxn-latn-id",mxo:"mxo-latn-zm",mxp:"mxp-latn-mx",mxq:"mxq-latn-mx",mxr:"mxr-latn-my",mxs:"mxs-latn-mx",mxt:"mxt-latn-mx",mxu:"mxu-latn-cm",mxv:"mxv-latn-mx",mxw:"mxw-latn-pg",mxx:"mxx-latn-ci",mxy:"mxy-latn-mx",mxz:"mxz-latn-id",my:"my-mymr-mm",myb:"myb-latn-td",myc:"myc-latn-cd",mye:"mye-latn-ga",myf:"myf-latn-et",myg:"myg-latn-cm",myh:"myh-latn-us",myj:"myj-latn-ss",myk:"myk-latn-zz",myl:"myl-latn-id",mym:"mym-ethi-zz",myp:"myp-latn-br",myr:"myr-latn-pe",myu:"myu-latn-br",myv:"myv-cyrl-ru",myw:"myw-latn-zz",myx:"myx-latn-ug",myy:"myy-latn-co",myz:"myz-mand-ir",mza:"mza-latn-mx",mzd:"mzd-latn-cm",mze:"mze-latn-pg",mzh:"mzh-latn-ar",mzi:"mzi-latn-mx",mzj:"mzj-latn-lr",mzk:"mzk-latn-zz",mzl:"mzl-latn-mx",mzm:"mzm-latn-zz",mzn:"mzn-arab-ir",mzo:"mzo-latn-br",mzp:"mzp-latn-zz",mzq:"mzq-latn-id",mzr:"mzr-latn-br",mzt:"mzt-latn-my",mzu:"mzu-latn-pg",mzv:"mzv-latn-cf",mzw:"mzw-latn-zz",mzx:"mzx-latn-gy",mzz:"mzz-latn-zz",na:"na-latn-nr",naa:"naa-latn-id",nab:"nab-latn-br",nac:"nac-latn-zz",nae:"nae-latn-id",naf:"naf-latn-zz",nag:"nag-latn-in",naj:"naj-latn-gn",nak:"nak-latn-zz",nal:"nal-latn-pg",nam:"nam-latn-au",nan:"nan-hans-cn",nao:"nao-deva-np",nap:"nap-latn-it",naq:"naq-latn-na",nar:"nar-latn-ng",nas:"nas-latn-zz",nat:"nat-latn-ng",naw:"naw-latn-gh",nax:"nax-latn-pg",nay:"nay-latn-au",naz:"naz-latn-mx",nb:"nb-latn-no",nba:"nba-latn-ao",nbb:"nbb-latn-ng",nbc:"nbc-latn-in",nbd:"nbd-latn-cd",nbe:"nbe-latn-in",nbh:"nbh-latn-ng",nbi:"nbi-latn-in",nbj:"nbj-latn-au",nbk:"nbk-latn-pg",nbm:"nbm-latn-cf",nbn:"nbn-latn-id",nbo:"nbo-latn-ng",nbp:"nbp-latn-ng",nbq:"nbq-latn-id",nbr:"nbr-latn-ng",nbt:"nbt-latn-in","nbt-deva":"nbt-deva-in",nbu:"nbu-latn-in",nbv:"nbv-latn-cm",nbw:"nbw-latn-cd",nby:"nby-latn-pg",nca:"nca-latn-zz",ncb:"ncb-latn-in","ncb-deva":"ncb-deva-in",ncc:"ncc-latn-pg",ncd:"ncd-deva-np",nce:"nce-latn-zz",ncf:"ncf-latn-zz",ncg:"ncg-latn-ca",nch:"nch-latn-mx",nci:"nci-latn-mx",ncj:"ncj-latn-mx",nck:"nck-latn-au",ncl:"ncl-latn-mx",ncm:"ncm-latn-pg",ncn:"ncn-latn-pg",nco:"nco-latn-zz",ncq:"ncq-laoo-la","ncq-thai":"ncq-thai-la",ncr:"ncr-latn-cm",nct:"nct-latn-in","nct-beng":"nct-beng-in",ncu:"ncu-latn-zz",ncx:"ncx-latn-mx",ncz:"ncz-latn-us",nd:"nd-latn-zw",nda:"nda-latn-cg",ndb:"ndb-latn-cm",ndc:"ndc-latn-mz",ndd:"ndd-latn-ng",ndf:"ndf-cyrl-ru",ndg:"ndg-latn-tz",ndh:"ndh-latn-tz",ndi:"ndi-latn-ng",ndj:"ndj-latn-tz",ndk:"ndk-latn-cd",ndl:"ndl-latn-cd",ndm:"ndm-latn-td",ndn:"ndn-latn-cg",ndp:"ndp-latn-ug",ndq:"ndq-latn-ao",ndr:"ndr-latn-ng",nds:"nds-latn-de",ndt:"ndt-latn-cd",ndu:"ndu-latn-cm",ndv:"ndv-latn-sn",ndw:"ndw-latn-cd",ndx:"ndx-latn-id",ndy:"ndy-latn-cf","ndy-td":"ndy-latn-td",ndz:"ndz-latn-ss",ne:"ne-deva-np",nea:"nea-latn-id",neb:"neb-latn-zz",nec:"nec-latn-id",ned:"ned-latn-ng",nee:"nee-latn-nc",neg:"neg-cyrl-ru",neh:"neh-tibt-bt",nei:"nei-xsux-tr",nej:"nej-latn-pg",nek:"nek-latn-nc",nem:"nem-latn-nc",nen:"nen-latn-nc",neo:"neo-latn-vn",neq:"neq-latn-mx",ner:"ner-latn-id",net:"net-latn-pg",neu:"neu-latn-001",new:"new-deva-np",nex:"nex-latn-zz",ney:"ney-latn-ci",nez:"nez-latn-us",nfa:"nfa-latn-id",nfd:"nfd-latn-ng",nfl:"nfl-latn-sb",nfr:"nfr-latn-zz",nfu:"nfu-latn-cm",ng:"ng-latn-na",nga:"nga-latn-zz",ngb:"ngb-latn-zz",ngc:"ngc-latn-cd",ngd:"ngd-latn-cf",nge:"nge-latn-cm",ngg:"ngg-latn-cf",ngh:"ngh-latn-za",ngi:"ngi-latn-ng",ngj:"ngj-latn-cm",ngk:"ngk-latn-au",ngl:"ngl-latn-mz",ngm:"ngm-latn-fm",ngn:"ngn-latn-cm",ngp:"ngp-latn-tz",ngq:"ngq-latn-tz",ngr:"ngr-latn-sb",ngs:"ngs-latn-ng",ngt:"ngt-laoo-la",ngu:"ngu-latn-mx",ngv:"ngv-latn-cm",ngw:"ngw-latn-ng",ngx:"ngx-latn-ng",ngy:"ngy-latn-cm",ngz:"ngz-latn-cg",nha:"nha-latn-au",nhb:"nhb-latn-zz",nhc:"nhc-latn-mx",nhd:"nhd-latn-py",nhe:"nhe-latn-mx",nhf:"nhf-latn-au",nhg:"nhg-latn-mx",nhi:"nhi-latn-mx",nhk:"nhk-latn-mx",nhm:"nhm-latn-mx",nhn:"nhn-latn-mx",nho:"nho-latn-pg",nhp:"nhp-latn-mx",nhq:"nhq-latn-mx",nhr:"nhr-latn-bw",nht:"nht-latn-mx",nhu:"nhu-latn-cm",nhv:"nhv-latn-mx",nhw:"nhw-latn-mx",nhx:"nhx-latn-mx",nhy:"nhy-latn-mx",nhz:"nhz-latn-mx",nia:"nia-latn-id",nib:"nib-latn-pg",nid:"nid-latn-au",nie:"nie-latn-td",nif:"nif-latn-zz",nig:"nig-latn-au",nih:"nih-latn-tz",nii:"nii-latn-zz",nij:"nij-latn-id",nil:"nil-latn-id",nim:"nim-latn-tz",nin:"nin-latn-zz",nio:"nio-cyrl-ru",niq:"niq-latn-ke",nir:"nir-latn-id",nis:"nis-latn-pg",nit:"nit-telu-in",niu:"niu-latn-nu",niv:"niv-cyrl-ru","niv-latn":"niv-latn-ru",niw:"niw-latn-pg",nix:"nix-latn-cd",niy:"niy-latn-zz",niz:"niz-latn-zz",nja:"nja-latn-ng",njb:"njb-latn-in",njd:"njd-latn-tz",njh:"njh-latn-in",nji:"nji-latn-au",njj:"njj-latn-cm",njl:"njl-latn-ss",njm:"njm-latn-in",njn:"njn-latn-in",njo:"njo-latn-in",njr:"njr-latn-ng",njs:"njs-latn-id",njt:"njt-latn-sr",nju:"nju-latn-au",njx:"njx-latn-cg",njy:"njy-latn-cm",njz:"njz-latn-in","njz-beng":"njz-beng-in",nka:"nka-latn-zm",nkb:"nkb-latn-in",nkc:"nkc-latn-cm",nkd:"nkd-latn-in",nke:"nke-latn-sb",nkf:"nkf-latn-in",nkg:"nkg-latn-zz",nkh:"nkh-latn-in",nki:"nki-latn-in","nki-beng":"nki-beng-in",nkj:"nkj-latn-id",nkk:"nkk-latn-vu",nkm:"nkm-latn-pg",nkn:"nkn-latn-ao",nko:"nko-latn-zz",nkq:"nkq-latn-gh",nkr:"nkr-latn-fm",nks:"nks-latn-id",nkt:"nkt-latn-tz",nku:"nku-latn-ci",nkv:"nkv-latn-mw",nkw:"nkw-latn-cd",nkx:"nkx-latn-ng",nkz:"nkz-latn-ng",nl:"nl-latn-nl",nla:"nla-latn-cm",nlc:"nlc-latn-id",nle:"nle-latn-ke",nlg:"nlg-latn-sb",nli:"nli-arab-af",nlj:"nlj-latn-cd",nlk:"nlk-latn-id",nlm:"nlm-arab-pk",nlo:"nlo-latn-cd",nlq:"nlq-latn-mm",nlu:"nlu-latn-gh",nlv:"nlv-latn-mx",nlw:"nlw-latn-au",nlx:"nlx-deva-in",nly:"nly-latn-au",nlz:"nlz-latn-sb",nma:"nma-latn-in",nmb:"nmb-latn-vu",nmc:"nmc-latn-td",nmd:"nmd-latn-ga",nme:"nme-latn-in",nmf:"nmf-latn-in",nmg:"nmg-latn-cm",nmh:"nmh-latn-in",nmi:"nmi-latn-ng",nmj:"nmj-latn-cf",nmk:"nmk-latn-vu",nml:"nml-latn-cm",nmm:"nmm-deva-np","nmm-tibt":"nmm-tibt-np",nmn:"nmn-latn-bw",nmo:"nmo-latn-in","nmo-beng":"nmo-beng-in",nmp:"nmp-latn-au",nmq:"nmq-latn-zw",nmr:"nmr-latn-cm",nms:"nms-latn-vu",nmt:"nmt-latn-fm",nmu:"nmu-latn-us",nmv:"nmv-latn-au",nmw:"nmw-latn-pg",nmx:"nmx-latn-pg",nmz:"nmz-latn-zz",nn:"nn-latn-no",nna:"nna-latn-au",nnb:"nnb-latn-cd",nnc:"nnc-latn-td",nnd:"nnd-latn-vu",nne:"nne-latn-ao",nnf:"nnf-latn-zz",nng:"nng-latn-in","nng-beng":"nng-beng-in",nnh:"nnh-latn-cm",nni:"nni-latn-id",nnj:"nnj-latn-et",nnk:"nnk-latn-zz",nnl:"nnl-latn-in",nnm:"nnm-latn-zz",nnn:"nnn-latn-td",nnp:"nnp-wcho-in",nnq:"nnq-latn-tz",nnr:"nnr-latn-au",nnt:"nnt-latn-us",nnu:"nnu-latn-gh",nnv:"nnv-latn-au",nnw:"nnw-latn-bf",nny:"nny-latn-au",nnz:"nnz-latn-cm",no:"no-latn-no",noa:"noa-latn-co",noc:"noc-latn-pg",nod:"nod-lana-th",noe:"noe-deva-in",nof:"nof-latn-pg",nog:"nog-cyrl-ru",noh:"noh-latn-pg",noi:"noi-deva-in",noj:"noj-latn-co",nok:"nok-latn-us",nom:"nom-latn-pe",non:"non-runr-se",nop:"nop-latn-zz",noq:"noq-latn-cd",nos:"nos-yiii-cn",not:"not-latn-pe",nou:"nou-latn-zz",nov:"nov-latn-001",now:"now-latn-tz",noy:"noy-latn-td",npb:"npb-tibt-bt",npg:"npg-latn-mm",nph:"nph-latn-in",npl:"npl-latn-mx",npn:"npn-latn-pg",npo:"npo-latn-in",nps:"nps-latn-id",npu:"npu-latn-in",npx:"npx-latn-sb",npy:"npy-latn-id",nqg:"nqg-latn-bj",nqk:"nqk-latn-bj",nql:"nql-latn-ao",nqm:"nqm-latn-id",nqn:"nqn-latn-pg",nqo:"nqo-nkoo-gn",nqq:"nqq-latn-mm",nqt:"nqt-latn-ng",nqy:"nqy-latn-mm",nr:"nr-latn-za",nra:"nra-latn-ga",nrb:"nrb-latn-zz",nre:"nre-latn-in",nrf:"nrf-latn-je",nrg:"nrg-latn-vu",nri:"nri-latn-in",nrk:"nrk-latn-au",nrl:"nrl-latn-au",nrm:"nrm-latn-my",nrp:"nrp-latn-it",nru:"nru-latn-cn","nru-hans":"nru-hans-cn","nru-hant":"nru-hant-cn",nrx:"nrx-latn-au",nrz:"nrz-latn-pg",nsa:"nsa-latn-in",nsb:"nsb-latn-za",nsc:"nsc-latn-ng",nsd:"nsd-yiii-cn",nse:"nse-latn-zm",nsf:"nsf-yiii-cn",nsg:"nsg-latn-tz",nsh:"nsh-latn-cm",nsk:"nsk-cans-ca",nsm:"nsm-latn-in",nsn:"nsn-latn-zz",nso:"nso-latn-za",nsq:"nsq-latn-us",nss:"nss-latn-zz",nst:"nst-tnsa-in",nsu:"nsu-latn-mx",nsv:"nsv-yiii-cn",nsw:"nsw-latn-vu",nsx:"nsx-latn-ao",nsy:"nsy-latn-id",nsz:"nsz-latn-us",ntd:"ntd-latn-my",nte:"nte-latn-mz",ntg:"ntg-latn-au",nti:"nti-latn-bf",ntj:"ntj-latn-au",ntk:"ntk-latn-tz",ntm:"ntm-latn-zz",nto:"nto-latn-cd",ntp:"ntp-latn-mx",ntr:"ntr-latn-zz",ntu:"ntu-latn-sb",ntx:"ntx-latn-mm",nty:"nty-yiii-vn",ntz:"ntz-arab-ir",nua:"nua-latn-nc",nuc:"nuc-latn-br",nud:"nud-latn-pg",nue:"nue-latn-cd",nuf:"nuf-latn-cn",nug:"nug-latn-au",nuh:"nuh-latn-ng",nui:"nui-latn-zz",nuj:"nuj-latn-ug",nuk:"nuk-latn-ca",num:"num-latn-to",nun:"nun-latn-mm",nuo:"nuo-latn-vn",nup:"nup-latn-zz",nuq:"nuq-latn-pg",nur:"nur-latn-pg",nus:"nus-latn-ss",nut:"nut-latn-vn",nuu:"nuu-latn-cd",nuv:"nuv-latn-zz",nuw:"nuw-latn-fm",nux:"nux-latn-zz",nuy:"nuy-latn-au",nuz:"nuz-latn-mx",nv:"nv-latn-us",nvh:"nvh-latn-vu",nvm:"nvm-latn-pg",nvo:"nvo-latn-cm",nwb:"nwb-latn-zz",nwc:"nwc-newa-np","nwc-brah":"nwc-brah-np","nwc-deva":"nwc-deva-np","nwc-sidd":"nwc-sidd-np",nwe:"nwe-latn-cm",nwg:"nwg-latn-au",nwi:"nwi-latn-vu",nwm:"nwm-latn-ss",nwo:"nwo-latn-au",nwr:"nwr-latn-pg",nww:"nww-latn-tz",nwx:"nwx-deva-np",nxa:"nxa-latn-tl",nxd:"nxd-latn-cd",nxe:"nxe-latn-id",nxg:"nxg-latn-id",nxi:"nxi-latn-tz",nxl:"nxl-latn-id",nxn:"nxn-latn-au",nxo:"nxo-latn-ga",nxq:"nxq-latn-cn",nxr:"nxr-latn-zz",nxx:"nxx-latn-id",ny:"ny-latn-mw",nyb:"nyb-latn-gh",nyc:"nyc-latn-cd",nyd:"nyd-latn-ke",nye:"nye-latn-ao",nyf:"nyf-latn-ke",nyg:"nyg-latn-cd",nyh:"nyh-latn-au",nyi:"nyi-latn-sd",nyj:"nyj-latn-cd",nyk:"nyk-latn-ao",nyl:"nyl-thai-th",nym:"nym-latn-tz",nyn:"nyn-latn-ug",nyo:"nyo-latn-ug",nyp:"nyp-latn-ug",nyq:"nyq-arab-ir",nyr:"nyr-latn-mw",nys:"nys-latn-au",nyt:"nyt-latn-au",nyu:"nyu-latn-mz",nyv:"nyv-latn-au",nyx:"nyx-latn-au",nyy:"nyy-latn-tz",nza:"nza-latn-cm",nzb:"nzb-latn-ga",nzd:"nzd-latn-cd",nzi:"nzi-latn-gh",nzk:"nzk-latn-cf",nzm:"nzm-latn-in",nzu:"nzu-latn-cg",nzy:"nzy-latn-td",nzz:"nzz-latn-ml",oaa:"oaa-cyrl-ru",oac:"oac-cyrl-ru",oar:"oar-syrc-sy",oav:"oav-geor-ge",obi:"obi-latn-us",obk:"obk-latn-ph",obl:"obl-latn-cm",obm:"obm-phnx-jo",obo:"obo-latn-ph",obr:"obr-mymr-mm",obt:"obt-latn-fr",obu:"obu-latn-ng",oc:"oc-latn-fr",oca:"oca-latn-pe",oco:"oco-latn-gb",ocu:"ocu-latn-mx",oda:"oda-latn-ng",odk:"odk-arab-pk",odt:"odt-latn-nl",odu:"odu-latn-ng",ofu:"ofu-latn-ng",ogb:"ogb-latn-ng",ogc:"ogc-latn-zz",ogg:"ogg-latn-ng",ogo:"ogo-latn-ng",ogu:"ogu-latn-ng",oht:"oht-xsux-tr",oia:"oia-latn-id",oie:"oie-latn-ss",oin:"oin-latn-pg",oj:"oj-cans-ca",ojb:"ojb-latn-ca","ojb-cans":"ojb-cans-ca",ojc:"ojc-latn-ca",ojs:"ojs-cans-ca",ojv:"ojv-latn-sb",ojw:"ojw-latn-ca","ojw-cans":"ojw-cans-ca",oka:"oka-latn-ca",okb:"okb-latn-ng",okc:"okc-latn-cd",okd:"okd-latn-ng",oke:"oke-latn-ng",okg:"okg-latn-au",oki:"oki-latn-ke",okk:"okk-latn-pg",okm:"okm-hang-kr",oko:"oko-hani-kr",okr:"okr-latn-zz",oks:"oks-latn-ng",oku:"oku-latn-cm",okv:"okv-latn-zz",okx:"okx-latn-ng",okz:"okz-khmr-kh",ola:"ola-deva-np","ola-tibt":"ola-tibt-cn",old:"old-latn-tz",ole:"ole-tibt-bt",olk:"olk-latn-au",olm:"olm-latn-ng",olo:"olo-latn-ru",olr:"olr-latn-vu",olt:"olt-latn-lt",olu:"olu-latn-ao",om:"om-latn-et",oma:"oma-latn-us",omb:"omb-latn-vu",omc:"omc-latn-pe",omg:"omg-latn-pe",omi:"omi-latn-cd",omk:"omk-cyrl-ru",oml:"oml-latn-cd",omo:"omo-latn-pg",omp:"omp-mtei-in",omr:"omr-modi-in",omt:"omt-latn-ke",omu:"omu-latn-pe",omw:"omw-latn-pg",ona:"ona-latn-ar",one:"one-latn-ca",ong:"ong-latn-zz",oni:"oni-latn-id",onj:"onj-latn-pg",onk:"onk-latn-pg",onn:"onn-latn-zz",ono:"ono-latn-ca",onp:"onp-latn-in","onp-deva":"onp-deva-in",onr:"onr-latn-pg",ons:"ons-latn-zz",ont:"ont-latn-pg",onu:"onu-latn-vu",onx:"onx-latn-id",ood:"ood-latn-us",oon:"oon-deva-in",oor:"oor-latn-za",opa:"opa-latn-ng",opk:"opk-latn-id",opm:"opm-latn-zz",opo:"opo-latn-pg",opt:"opt-latn-mx",opy:"opy-latn-br",or:"or-orya-in",ora:"ora-latn-sb",orc:"orc-latn-ke",ore:"ore-latn-pe",org:"org-latn-ng",orn:"orn-latn-my",oro:"oro-latn-zz",orr:"orr-latn-ng",ors:"ors-latn-my",ort:"ort-telu-in",oru:"oru-arab-zz",orv:"orv-cyrl-ru",orw:"orw-latn-br",orx:"orx-latn-ng",orz:"orz-latn-id",os:"os-cyrl-ge",osa:"osa-osge-us",osc:"osc-ital-it","osc-latn":"osc-latn-it",osi:"osi-java-id",oso:"oso-latn-ng",osp:"osp-latn-es",ost:"ost-latn-cm",osu:"osu-latn-pg",osx:"osx-latn-de",ota:"ota-arab-zz",otb:"otb-tibt-cn",otd:"otd-latn-id",ote:"ote-latn-mx",oti:"oti-latn-br",otk:"otk-orkh-mn",otl:"otl-latn-mx",otm:"otm-latn-mx",otn:"otn-latn-mx",otq:"otq-latn-mx",otr:"otr-latn-sd",ots:"ots-latn-mx",ott:"ott-latn-mx",otu:"otu-latn-br",otw:"otw-latn-ca",otx:"otx-latn-mx",oty:"oty-gran-in",otz:"otz-latn-mx",oub:"oub-latn-lr",oue:"oue-latn-pg",oui:"oui-ougr-143",oum:"oum-latn-pg",ovd:"ovd-latn-se",owi:"owi-latn-pg",owl:"owl-latn-gb",oyd:"oyd-latn-et",oym:"oym-latn-br",oyy:"oyy-latn-pg",ozm:"ozm-latn-zz",pa:"pa-guru-in","pa-arab":"pa-arab-pk","pa-pk":"pa-arab-pk",pab:"pab-latn-br",pac:"pac-latn-vn",pad:"pad-latn-br",pae:"pae-latn-cd",paf:"paf-latn-br",pag:"pag-latn-ph",pah:"pah-latn-br",pai:"pai-latn-ng",pak:"pak-latn-br",pal:"pal-phli-ir","pal-phlp":"pal-phlp-cn",pam:"pam-latn-ph",pao:"pao-latn-us",pap:"pap-latn-cw",paq:"paq-cyrl-tj",par:"par-latn-us",pas:"pas-latn-id",pau:"pau-latn-pw",pav:"pav-latn-br",paw:"paw-latn-us",pax:"pax-latn-br",pay:"pay-latn-hn",paz:"paz-latn-br",pbb:"pbb-latn-co",pbc:"pbc-latn-gy",pbe:"pbe-latn-mx",pbf:"pbf-latn-mx",pbg:"pbg-latn-ve",pbh:"pbh-latn-ve",pbi:"pbi-latn-zz",pbl:"pbl-latn-ng",pbm:"pbm-latn-mx",pbn:"pbn-latn-ng",pbo:"pbo-latn-gw",pbp:"pbp-latn-gn",pbr:"pbr-latn-tz",pbs:"pbs-latn-mx",pbt:"pbt-arab-af",pbv:"pbv-latn-in",pby:"pby-latn-pg",pca:"pca-latn-mx",pcb:"pcb-khmr-kh",pcc:"pcc-latn-cn","pcc-hani":"pcc-hani-cn",pcd:"pcd-latn-fr",pce:"pce-mymr-mm","pce-thai":"pce-thai-th",pcf:"pcf-mlym-in",pcg:"pcg-mlym-in","pcg-knda":"pcg-knda-in","pcg-taml":"pcg-taml-in",pch:"pch-deva-in",pci:"pci-deva-in","pci-orya":"pci-orya-in",pcj:"pcj-telu-in",pck:"pck-latn-in",pcm:"pcm-latn-ng",pcn:"pcn-latn-ng",pcp:"pcp-latn-bo",pcw:"pcw-latn-ng",pda:"pda-latn-pg",pdc:"pdc-latn-us",pdn:"pdn-latn-id",pdo:"pdo-latn-id",pdt:"pdt-latn-ca",pdu:"pdu-latn-mm","pdu-mymr":"pdu-mymr-mm",pea:"pea-latn-id",peb:"peb-latn-us",ped:"ped-latn-zz",pee:"pee-latn-id",peg:"peg-orya-in",pei:"pei-latn-mx",pek:"pek-latn-pg",pel:"pel-latn-id",pem:"pem-latn-cd",peo:"peo-xpeo-ir",pep:"pep-latn-pg",peq:"peq-latn-us",pev:"pev-latn-ve",pex:"pex-latn-zz",pey:"pey-latn-id",pez:"pez-latn-my",pfa:"pfa-latn-fm",pfe:"pfe-latn-cm",pfl:"pfl-latn-de",pga:"pga-latn-ss",pgd:"pgd-khar-pk",pgg:"pgg-deva-in",pgi:"pgi-latn-pg",pgk:"pgk-latn-vu",pgl:"pgl-ogam-ie",pgn:"pgn-ital-it",pgs:"pgs-latn-ng",pgu:"pgu-latn-id",phd:"phd-deva-in",phg:"phg-latn-vn",phh:"phh-latn-vn",phk:"phk-mymr-in",phl:"phl-arab-zz",phm:"phm-latn-mz",phn:"phn-phnx-lb",pho:"pho-laoo-la",phr:"phr-arab-pk",pht:"pht-thai-th",phv:"phv-arab-af",phw:"phw-deva-np",pi:"pi-sinh-in","pi-brah":"pi-brah-in","pi-deva":"pi-deva-in","pi-khar":"pi-khar-in","pi-khmr":"pi-khmr-in","pi-mymr":"pi-mymr-in","pi-thai":"pi-thai-in",pia:"pia-latn-mx",pib:"pib-latn-pe",pic:"pic-latn-ga",pid:"pid-latn-ve",pif:"pif-latn-fm",pig:"pig-latn-pe",pih:"pih-latn-nf",pij:"pij-latn-co",pil:"pil-latn-zz",pim:"pim-latn-us",pin:"pin-latn-pg",pio:"pio-latn-co",pip:"pip-latn-zz",pir:"pir-latn-br",pis:"pis-latn-sb",pit:"pit-latn-au",piu:"piu-latn-au",piv:"piv-latn-sb",piw:"piw-latn-tz",pix:"pix-latn-pg",piy:"piy-latn-ng",piz:"piz-latn-nc",pjt:"pjt-latn-au",pka:"pka-brah-in",pkb:"pkb-latn-ke",pkg:"pkg-latn-pg",pkh:"pkh-latn-bd","pkh-deva":"pkh-deva-bd",pkn:"pkn-latn-au",pko:"pko-latn-ke",pkp:"pkp-latn-ck",pkr:"pkr-mlym-in",pku:"pku-latn-id",pl:"pl-latn-pl",pla:"pla-latn-zz",plb:"plb-latn-vu",plc:"plc-latn-ph",pld:"pld-latn-gb",ple:"ple-latn-id",plg:"plg-latn-ar",plh:"plh-latn-id",plj:"plj-latn-ng",plk:"plk-arab-pk",pll:"pll-mymr-mm",pln:"pln-latn-co",plo:"plo-latn-mx",plr:"plr-latn-ci",pls:"pls-latn-mx",plu:"plu-latn-br",plv:"plv-latn-ph",plw:"plw-latn-ph",plz:"plz-latn-my",pma:"pma-latn-vu",pmb:"pmb-latn-cd",pmd:"pmd-latn-au",pme:"pme-latn-nc",pmf:"pmf-latn-id",pmh:"pmh-brah-in",pmi:"pmi-latn-cn",pmj:"pmj-latn-cn",pml:"pml-latn-tn",pmm:"pmm-latn-cm",pmn:"pmn-latn-cm",pmo:"pmo-latn-id",pmq:"pmq-latn-mx",pmr:"pmr-latn-pg",pms:"pms-latn-it",pmt:"pmt-latn-pf",pmw:"pmw-latn-us",pmx:"pmx-latn-in",pmy:"pmy-latn-id",pmz:"pmz-latn-mx",pna:"pna-latn-my",pnc:"pnc-latn-id",pnd:"pnd-latn-ao",pne:"pne-latn-my",png:"png-latn-zz",pnh:"pnh-latn-ck",pni:"pni-latn-id",pnj:"pnj-latn-au",pnk:"pnk-latn-bo",pnl:"pnl-latn-bf",pnm:"pnm-latn-my",pnn:"pnn-latn-zz",pno:"pno-latn-pe",pnp:"pnp-latn-id",pnq:"pnq-latn-bf",pnr:"pnr-latn-pg",pns:"pns-latn-id",pnt:"pnt-grek-gr",pnv:"pnv-latn-au",pnw:"pnw-latn-au",pny:"pny-latn-cm",pnz:"pnz-latn-cf",poc:"poc-latn-gt",poe:"poe-latn-mx",pof:"pof-latn-cd",pog:"pog-latn-br",poh:"poh-latn-gt",poi:"poi-latn-mx",pok:"pok-latn-br",pom:"pom-latn-us",pon:"pon-latn-fm",poo:"poo-latn-us",pop:"pop-latn-nc",poq:"poq-latn-mx",pos:"pos-latn-mx",pot:"pot-latn-us",pov:"pov-latn-gw",pow:"pow-latn-mx",poy:"poy-latn-tz",ppa:"ppa-deva-in",ppe:"ppe-latn-pg",ppi:"ppi-latn-mx",ppk:"ppk-latn-id",ppl:"ppl-latn-sv",ppm:"ppm-latn-id",ppn:"ppn-latn-pg",ppo:"ppo-latn-zz",ppp:"ppp-latn-cd",ppq:"ppq-latn-pg",pps:"pps-latn-mx",ppt:"ppt-latn-pg",pqa:"pqa-latn-ng",pqm:"pqm-latn-ca",pra:"pra-khar-pk",prc:"prc-arab-af",prd:"prd-arab-ir",pre:"pre-latn-st",prf:"prf-latn-ph",prg:"prg-latn-001",prh:"prh-latn-ph",pri:"pri-latn-nc",prk:"prk-latn-mm",prm:"prm-latn-pg",pro:"pro-latn-fr",prp:"prp-gujr-in",prq:"prq-latn-pe",prr:"prr-latn-br",prt:"prt-thai-th",pru:"pru-latn-id",prw:"prw-latn-pg",prx:"prx-arab-in","prx-tibt":"prx-tibt-in",ps:"ps-arab-af",psa:"psa-latn-id",pse:"pse-latn-id",psh:"psh-arab-af",psi:"psi-arab-af",psm:"psm-latn-bo",psn:"psn-latn-id",psq:"psq-latn-pg",pss:"pss-latn-zz",pst:"pst-arab-pk",psw:"psw-latn-vu",pt:"pt-latn-br",pta:"pta-latn-py",pth:"pth-latn-br",pti:"pti-latn-au",ptn:"ptn-latn-id",pto:"pto-latn-br",ptp:"ptp-latn-zz",ptr:"ptr-latn-vu",ptt:"ptt-latn-id",ptu:"ptu-latn-id",ptv:"ptv-latn-vu",pua:"pua-latn-mx",pub:"pub-latn-in",puc:"puc-latn-id",pud:"pud-latn-id",pue:"pue-latn-ar",puf:"puf-latn-id",pug:"pug-latn-bf",pui:"pui-latn-co",puj:"puj-latn-id",pum:"pum-deva-np",puo:"puo-latn-vn",pup:"pup-latn-pg",puq:"puq-latn-pe",pur:"pur-latn-br",put:"put-latn-id",puu:"puu-latn-ga",puw:"puw-latn-fm",pux:"pux-latn-pg",puy:"puy-latn-us",pwa:"pwa-latn-zz",pwb:"pwb-latn-ng",pwg:"pwg-latn-pg",pwm:"pwm-latn-ph",pwn:"pwn-latn-tw",pwo:"pwo-mymr-mm",pwr:"pwr-deva-in",pww:"pww-thai-th",pxm:"pxm-latn-mx",pye:"pye-latn-ci",pym:"pym-latn-ng",pyn:"pyn-latn-br",pyu:"pyu-latn-tw","pyu-hani":"pyu-hani-tw",pyx:"pyx-mymr-mm",pyy:"pyy-latn-mm",pzh:"pzh-latn-tw",pzn:"pzn-latn-mm",qu:"qu-latn-pe",qua:"qua-latn-us",qub:"qub-latn-pe",quc:"quc-latn-gt",qud:"qud-latn-ec",quf:"quf-latn-pe",qug:"qug-latn-ec",qui:"qui-latn-us",quk:"quk-latn-pe",qul:"qul-latn-bo",qum:"qum-latn-gt",qun:"qun-latn-us",qup:"qup-latn-pe",quq:"quq-latn-es",qur:"qur-latn-pe",qus:"qus-latn-ar",quv:"quv-latn-gt",quw:"quw-latn-ec",qux:"qux-latn-pe",quy:"quy-latn-pe",qva:"qva-latn-pe",qvc:"qvc-latn-pe",qve:"qve-latn-pe",qvh:"qvh-latn-pe",qvi:"qvi-latn-ec",qvj:"qvj-latn-ec",qvl:"qvl-latn-pe",qvm:"qvm-latn-pe",qvn:"qvn-latn-pe",qvo:"qvo-latn-pe",qvp:"qvp-latn-pe",qvs:"qvs-latn-pe",qvw:"qvw-latn-pe",qvz:"qvz-latn-ec",qwa:"qwa-latn-pe",qwc:"qwc-latn-pe",qwh:"qwh-latn-pe",qwm:"qwm-latn-ru","qwm-cyrl":"qwm-cyrl-ru","qwm-runr":"qwm-runr-ru",qws:"qws-latn-pe",qwt:"qwt-latn-us",qxa:"qxa-latn-pe",qxc:"qxc-latn-pe",qxh:"qxh-latn-pe",qxl:"qxl-latn-ec",qxn:"qxn-latn-pe",qxo:"qxo-latn-pe",qxp:"qxp-latn-pe",qxq:"qxq-arab-ir",qxr:"qxr-latn-ec",qxt:"qxt-latn-pe",qxu:"qxu-latn-pe",qxw:"qxw-latn-pe",qya:"qya-latn-001",qyp:"qyp-latn-us",raa:"raa-deva-np",rab:"rab-deva-np",rac:"rac-latn-id",rad:"rad-latn-vn",raf:"raf-deva-np",rag:"rag-latn-ke",rah:"rah-beng-in","rah-latn":"rah-latn-in",rai:"rai-latn-zz",raj:"raj-deva-in",rak:"rak-latn-pg",ram:"ram-latn-br",ran:"ran-latn-id",rao:"rao-latn-zz",rap:"rap-latn-cl",rar:"rar-latn-ck",rav:"rav-deva-np",raw:"raw-latn-mm",rax:"rax-latn-ng",ray:"ray-latn-pf",raz:"raz-latn-id",rbb:"rbb-mymr-mm",rbk:"rbk-latn-ph",rbl:"rbl-latn-ph",rbp:"rbp-latn-au",rcf:"rcf-latn-re",rdb:"rdb-arab-ir",rea:"rea-latn-pg",reb:"reb-latn-id",ree:"ree-latn-my",reg:"reg-latn-tz",rei:"rei-orya-in","rei-telu":"rei-telu-in",rej:"rej-latn-id",rel:"rel-latn-zz",rem:"rem-latn-pe",ren:"ren-latn-vn",res:"res-latn-zz",ret:"ret-latn-id",rey:"rey-latn-bo",rga:"rga-latn-vu",rgn:"rgn-latn-it",rgr:"rgr-latn-pe",rgs:"rgs-latn-vn",rgu:"rgu-latn-id",rhg:"rhg-rohg-mm",rhp:"rhp-latn-pg",ria:"ria-latn-in",rif:"rif-latn-ma",ril:"ril-latn-mm",rim:"rim-latn-tz",rin:"rin-latn-ng",rir:"rir-latn-id",rit:"rit-latn-au",riu:"riu-latn-id",rjg:"rjg-latn-id",rji:"rji-deva-np",rjs:"rjs-deva-np",rka:"rka-khmr-kh",rkb:"rkb-latn-br",rkh:"rkh-latn-ck",rki:"rki-mymr-mm",rkm:"rkm-latn-bf",rkt:"rkt-beng-bd",rkw:"rkw-latn-au",rm:"rm-latn-ch",rma:"rma-latn-ni",rmb:"rmb-latn-au",rmc:"rmc-latn-sk",rmd:"rmd-latn-dk",rme:"rme-latn-gb",rmf:"rmf-latn-fi",rmg:"rmg-latn-no",rmh:"rmh-latn-id",rmi:"rmi-armn-am",rmk:"rmk-latn-pg",rml:"rml-latn-pl","rml-cyrl":"rml-cyrl-by",rmm:"rmm-latn-id",rmn:"rmn-latn-rs","rmn-cyrl":"rmn-cyrl-bg","rmn-grek":"rmn-grek-gr",rmo:"rmo-latn-ch",rmp:"rmp-latn-pg",rmq:"rmq-latn-es",rmt:"rmt-arab-ir",rmu:"rmu-latn-se",rmw:"rmw-latn-gb",rmx:"rmx-latn-vn",rmz:"rmz-mymr-in",rn:"rn-latn-bi",rna:"rna-latn-zz",rnd:"rnd-latn-cd",rng:"rng-latn-mz",rnl:"rnl-latn-in",rnn:"rnn-latn-id",rnr:"rnr-latn-au",rnw:"rnw-latn-tz",ro:"ro-latn-ro",rob:"rob-latn-id",roc:"roc-latn-vn",rod:"rod-latn-ng",roe:"roe-latn-pg",rof:"rof-latn-tz",rog:"rog-latn-vn",rol:"rol-latn-ph",rom:"rom-latn-ro","rom-cyrl":"rom-cyrl-ro",roo:"roo-latn-zz",rop:"rop-latn-au",ror:"ror-latn-id",rou:"rou-latn-td",row:"row-latn-id",rpn:"rpn-latn-vu",rpt:"rpt-latn-pg",rri:"rri-latn-sb",rro:"rro-latn-zz",rrt:"rrt-latn-au",rsk:"rsk-cyrl-rs",rtc:"rtc-latn-mm",rth:"rth-latn-id",rtm:"rtm-latn-fj",rtw:"rtw-deva-in",ru:"ru-cyrl-ru",rub:"rub-latn-ug",ruc:"ruc-latn-ug",rue:"rue-cyrl-ua",ruf:"ruf-latn-tz",rug:"rug-latn-sb",rui:"rui-latn-tz",ruk:"ruk-latn-ng",ruo:"ruo-latn-hr",rup:"rup-latn-ro","rup-grek":"rup-grek-gr",ruq:"ruq-latn-gr",rut:"rut-cyrl-ru","rut-latn":"rut-latn-az",ruu:"ruu-latn-my",ruy:"ruy-latn-ng",ruz:"ruz-latn-ng",rw:"rw-latn-rw",rwa:"rwa-latn-pg",rwk:"rwk-latn-tz",rwl:"rwl-latn-tz",rwm:"rwm-latn-ug",rwo:"rwo-latn-zz",rwr:"rwr-deva-in",rxd:"rxd-latn-au",rxw:"rxw-latn-au",ryu:"ryu-kana-jp",sa:"sa-deva-in",saa:"saa-latn-td",sab:"sab-latn-pa",sac:"sac-latn-us",sad:"sad-latn-tz",sae:"sae-latn-br",saf:"saf-latn-gh",sah:"sah-cyrl-ru",saj:"saj-latn-id",sak:"sak-latn-ga",sam:"sam-samr-ps","sam-hebr":"sam-hebr-ps","sam-syrc":"sam-syrc-ps",sao:"sao-latn-id",saq:"saq-latn-ke",sar:"sar-latn-bo",sas:"sas-latn-id",sat:"sat-olck-in",sau:"sau-latn-id",sav:"sav-latn-sn",saw:"saw-latn-id",sax:"sax-latn-vu",say:"say-latn-ng",saz:"saz-saur-in",sba:"sba-latn-zz",sbb:"sbb-latn-sb",sbc:"sbc-latn-pg",sbd:"sbd-latn-bf",sbe:"sbe-latn-zz",sbg:"sbg-latn-id",sbh:"sbh-latn-pg",sbi:"sbi-latn-pg",sbj:"sbj-latn-td",sbk:"sbk-latn-tz",sbl:"sbl-latn-ph",sbm:"sbm-latn-tz",sbn:"sbn-arab-pk",sbo:"sbo-latn-my",sbp:"sbp-latn-tz",sbq:"sbq-latn-pg",sbr:"sbr-latn-id",sbs:"sbs-latn-na",sbt:"sbt-latn-id",sbu:"sbu-tibt-in","sbu-deva":"sbu-deva-in",sbv:"sbv-latn-it",sbw:"sbw-latn-ga",sbx:"sbx-latn-id",sby:"sby-latn-zm",sbz:"sbz-latn-cf",sc:"sc-latn-it",scb:"scb-latn-vn",sce:"sce-latn-cn","sce-arab":"sce-arab-cn",scf:"scf-latn-pa",scg:"scg-latn-id",sch:"sch-latn-in",sci:"sci-latn-lk",sck:"sck-deva-in",scl:"scl-arab-zz",scn:"scn-latn-it",sco:"sco-latn-gb",scp:"scp-deva-np",scs:"scs-latn-ca","scs-cans":"scs-cans-ca",sct:"sct-laoo-la",scu:"scu-takr-in",scv:"scv-latn-ng",scw:"scw-latn-ng",scx:"scx-grek-it",sd:"sd-arab-pk","sd-deva":"sd-deva-in","sd-in":"sd-deva-in","sd-khoj":"sd-khoj-in","sd-sind":"sd-sind-in",sda:"sda-latn-id",sdb:"sdb-arab-iq",sdc:"sdc-latn-it",sde:"sde-latn-ng",sdf:"sdf-arab-iq",sdg:"sdg-arab-af",sdh:"sdh-arab-ir",sdj:"sdj-latn-cg",sdk:"sdk-latn-pg",sdn:"sdn-latn-it",sdo:"sdo-latn-my",sdq:"sdq-latn-id",sds:"sds-arab-tn",sdu:"sdu-latn-id",sdx:"sdx-latn-my",se:"se-latn-no",sea:"sea-latn-my",seb:"seb-latn-ci",sec:"sec-latn-ca",sed:"sed-latn-vn",see:"see-latn-us",sef:"sef-latn-ci",seg:"seg-latn-tz",seh:"seh-latn-mz",sei:"sei-latn-mx",sej:"sej-latn-pg",sek:"sek-latn-ca","sek-cans":"sek-cans-ca",sel:"sel-cyrl-ru",sen:"sen-latn-bf",seo:"seo-latn-pg",sep:"sep-latn-bf",seq:"seq-latn-bf",ser:"ser-latn-us",ses:"ses-latn-ml",set:"set-latn-id",seu:"seu-latn-id",sev:"sev-latn-ci",sew:"sew-latn-pg",sey:"sey-latn-ec",sez:"sez-latn-mm",sfe:"sfe-latn-ph",sfm:"sfm-plrd-cn",sfw:"sfw-latn-gh",sg:"sg-latn-cf",sga:"sga-ogam-ie",sgb:"sgb-latn-ph",sgc:"sgc-latn-ke",sgd:"sgd-latn-ph",sge:"sge-latn-id",sgh:"sgh-cyrl-tj","sgh-arab":"sgh-arab-af","sgh-latn":"sgh-latn-tj",sgi:"sgi-latn-cm",sgj:"sgj-deva-in",sgm:"sgm-latn-ke",sgp:"sgp-latn-in",sgr:"sgr-arab-ir",sgs:"sgs-latn-lt",sgt:"sgt-tibt-bt",sgu:"sgu-latn-id",sgw:"sgw-ethi-zz",sgy:"sgy-arab-af",sgz:"sgz-latn-zz",sha:"sha-latn-ng",shb:"shb-latn-br",shc:"shc-latn-cd",shd:"shd-arab-pk",she:"she-latn-et",shg:"shg-latn-bw",shh:"shh-latn-us",shi:"shi-tfng-ma",shj:"shj-latn-sd",shk:"shk-latn-zz",shm:"shm-arab-ir",shn:"shn-mymr-mm",sho:"sho-latn-ng",shp:"shp-latn-pe",shq:"shq-latn-zm",shr:"shr-latn-cd",shs:"shs-latn-ca",sht:"sht-latn-us",shu:"shu-arab-zz",shv:"shv-arab-om",shw:"shw-latn-sd",shy:"shy-latn-dz","shy-arab":"shy-arab-dz","shy-tfng":"shy-tfng-dz",shz:"shz-latn-ml",si:"si-sinh-lk",sia:"sia-cyrl-ru",sib:"sib-latn-my",sid:"sid-latn-et",sie:"sie-latn-zm",sif:"sif-latn-bf",sig:"sig-latn-zz",sih:"sih-latn-nc",sii:"sii-latn-in",sij:"sij-latn-pg",sik:"sik-latn-br",sil:"sil-latn-zz",sim:"sim-latn-zz",sip:"sip-tibt-in",siq:"siq-latn-pg",sir:"sir-latn-ng",sis:"sis-latn-us",siu:"siu-latn-pg",siv:"siv-latn-pg",siw:"siw-latn-pg",six:"six-latn-pg",siy:"siy-arab-ir",siz:"siz-arab-eg",sja:"sja-latn-co",sjb:"sjb-latn-id",sjd:"sjd-cyrl-ru",sje:"sje-latn-se",sjg:"sjg-latn-td",sjl:"sjl-latn-in",sjm:"sjm-latn-ph",sjp:"sjp-deva-in","sjp-beng":"sjp-beng-in",sjr:"sjr-latn-zz",sjt:"sjt-cyrl-ru",sju:"sju-latn-se",sjw:"sjw-latn-us",sk:"sk-latn-sk",ska:"ska-latn-us",skb:"skb-thai-th",skc:"skc-latn-zz",skd:"skd-latn-us",ske:"ske-latn-vu",skf:"skf-latn-br",skg:"skg-latn-mg",skh:"skh-latn-id",ski:"ski-latn-id",skj:"skj-deva-np",skm:"skm-latn-pg",skn:"skn-latn-ph",sko:"sko-latn-id",skp:"skp-latn-my",skq:"skq-latn-bf",skr:"skr-arab-pk",sks:"sks-latn-zz",skt:"skt-latn-cd",sku:"sku-latn-vu",skv:"skv-latn-id",skw:"skw-latn-gy",skx:"skx-latn-id",sky:"sky-latn-sb",skz:"skz-latn-id",sl:"sl-latn-si",slc:"slc-latn-co",sld:"sld-latn-zz",slg:"slg-latn-id",slh:"slh-latn-us",sli:"sli-latn-pl",slj:"slj-latn-br",sll:"sll-latn-zz",slm:"slm-latn-ph",sln:"sln-latn-us",slp:"slp-latn-id",slq:"slq-arab-ir",slr:"slr-latn-cn",slu:"slu-latn-id",slw:"slw-latn-pg",slx:"slx-latn-cd",sly:"sly-latn-id",slz:"slz-latn-id",sm:"sm-latn-ws",sma:"sma-latn-se",smb:"smb-latn-pg",smc:"smc-latn-pg",smd:"smd-latn-ao",smf:"smf-latn-pg",smg:"smg-latn-pg",smh:"smh-yiii-cn",smj:"smj-latn-se",smk:"smk-latn-ph",sml:"sml-latn-ph",smn:"smn-latn-fi",smp:"smp-samr-il",smq:"smq-latn-zz",smr:"smr-latn-id",sms:"sms-latn-fi",smt:"smt-latn-in",smu:"smu-khmr-kh",smw:"smw-latn-id",smx:"smx-latn-cd",smy:"smy-arab-ir",smz:"smz-latn-pg",sn:"sn-latn-zw",snb:"snb-latn-my",snc:"snc-latn-zz",sne:"sne-latn-my",snf:"snf-latn-sn",sng:"sng-latn-cd","sng-brai":"sng-brai-cd",sni:"sni-latn-pe",snj:"snj-latn-cf",snk:"snk-latn-ml",snl:"snl-latn-ph",snm:"snm-latn-ug",snn:"snn-latn-co",sno:"sno-latn-us",snp:"snp-latn-zz",snq:"snq-latn-ga",snr:"snr-latn-pg",sns:"sns-latn-vu",snu:"snu-latn-id",snv:"snv-latn-my",snw:"snw-latn-gh",snx:"snx-latn-zz",sny:"sny-latn-zz",snz:"snz-latn-pg",so:"so-latn-so",soa:"soa-tavt-th","soa-thai":"soa-thai-th",sob:"sob-latn-id",soc:"soc-latn-cd",sod:"sod-latn-cd",soe:"soe-latn-cd",sog:"sog-sogd-uz",soi:"soi-deva-np",sok:"sok-latn-zz",sol:"sol-latn-pg",soo:"soo-latn-cd",sop:"sop-latn-cd",soq:"soq-latn-zz",sor:"sor-latn-td",sos:"sos-latn-bf",sou:"sou-thai-th",sov:"sov-latn-pw",sow:"sow-latn-pg",sox:"sox-latn-cm",soy:"soy-latn-zz",soz:"soz-latn-tz",spb:"spb-latn-id",spc:"spc-latn-ve",spd:"spd-latn-zz",spe:"spe-latn-pg",spg:"spg-latn-my",spi:"spi-latn-id",spk:"spk-latn-pg",spl:"spl-latn-zz",spm:"spm-latn-pg",spn:"spn-latn-py",spo:"spo-latn-us",spp:"spp-latn-ml",spq:"spq-latn-pe",spr:"spr-latn-id",sps:"sps-latn-zz",spt:"spt-tibt-in",spv:"spv-orya-in",sq:"sq-latn-al",sqa:"sqa-latn-ng",sqh:"sqh-latn-ng",sqm:"sqm-latn-cf",sqo:"sqo-arab-ir",sqq:"sqq-laoo-la",sqt:"sqt-arab-ye","sqt-latn":"sqt-latn-ye",squ:"squ-latn-ca",sr:"sr-cyrl-rs","sr-me":"sr-latn-me","sr-ro":"sr-latn-ro","sr-ru":"sr-latn-ru","sr-tr":"sr-latn-tr",sra:"sra-latn-pg",srb:"srb-sora-in",sre:"sre-latn-id",srf:"srf-latn-pg",srg:"srg-latn-ph",srh:"srh-arab-cn",sri:"sri-latn-co",srk:"srk-latn-my",srl:"srl-latn-id",srm:"srm-latn-sr",srn:"srn-latn-sr",sro:"sro-latn-it",srq:"srq-latn-bo",srr:"srr-latn-sn",srs:"srs-latn-ca",srt:"srt-latn-id",sru:"sru-latn-br",srv:"srv-latn-ph",srw:"srw-latn-id",srx:"srx-deva-in",sry:"sry-latn-pg",srz:"srz-arab-ir",ss:"ss-latn-za",ssb:"ssb-latn-ph",ssc:"ssc-latn-tz",ssd:"ssd-latn-zz",sse:"sse-latn-ph","sse-arab":"sse-arab-ph",ssf:"ssf-latn-tw",ssg:"ssg-latn-zz",ssh:"ssh-arab-ae",ssj:"ssj-latn-pg",ssl:"ssl-latn-gh",ssm:"ssm-latn-my",ssn:"ssn-latn-ke",sso:"sso-latn-pg",ssq:"ssq-latn-id",sss:"sss-laoo-la","sss-thai":"sss-thai-th",sst:"sst-latn-pg",ssu:"ssu-latn-pg",ssv:"ssv-latn-vu",ssx:"ssx-latn-pg",ssy:"ssy-latn-er",ssz:"ssz-latn-pg",st:"st-latn-za",sta:"sta-latn-zm",stb:"stb-latn-ph",ste:"ste-latn-id",stf:"stf-latn-pg",stg:"stg-latn-vn",sth:"sth-latn-ie",sti:"sti-latn-vn","sti-kh":"sti-latn-kh",stj:"stj-latn-bf",stk:"stk-latn-zz",stl:"stl-latn-nl",stm:"stm-latn-pg",stn:"stn-latn-sb",sto:"sto-latn-ca",stp:"stp-latn-mx",stq:"stq-latn-de",str:"str-latn-ca",sts:"sts-arab-af",stt:"stt-latn-vn",stv:"stv-ethi-et","stv-arab":"stv-arab-et",stw:"stw-latn-fm",sty:"sty-cyrl-ru",su:"su-latn-id",sua:"sua-latn-zz",sub:"sub-latn-cd",suc:"suc-latn-ph",sue:"sue-latn-zz",sug:"sug-latn-pg",sui:"sui-latn-pg",suj:"suj-latn-tz",suk:"suk-latn-tz",suo:"suo-latn-pg",suq:"suq-latn-et","suq-ethi":"suq-ethi-et",sur:"sur-latn-zz",sus:"sus-latn-gn",sut:"sut-latn-ni",suv:"suv-latn-in","suv-beng":"suv-beng-in","suv-deva":"suv-deva-in",suw:"suw-latn-tz",suy:"suy-latn-br",suz:"suz-deva-np",sv:"sv-latn-se",sva:"sva-geor-ge","sva-cyrl":"sva-cyrl-ge","sva-latn":"sva-latn-ge",svb:"svb-latn-pg",svc:"svc-latn-vc",sve:"sve-latn-id",svm:"svm-latn-it",svs:"svs-latn-sb",sw:"sw-latn-tz",swb:"swb-arab-yt",swc:"swc-latn-cd",swf:"swf-latn-cd",swg:"swg-latn-de",swi:"swi-hani-cn",swj:"swj-latn-ga",swk:"swk-latn-mw",swm:"swm-latn-pg",swo:"swo-latn-br",swp:"swp-latn-zz",swq:"swq-latn-cm",swr:"swr-latn-id",sws:"sws-latn-id",swt:"swt-latn-id",swu:"swu-latn-id",swv:"swv-deva-in",sww:"sww-latn-vu",swx:"swx-latn-br",swy:"swy-latn-td",sxb:"sxb-latn-ke",sxe:"sxe-latn-ga",sxn:"sxn-latn-id",sxr:"sxr-latn-tw",sxs:"sxs-latn-ng",sxu:"sxu-latn-de","sxu-runr":"sxu-runr-de",sxw:"sxw-latn-zz",sya:"sya-latn-id",syb:"syb-latn-ph",syc:"syc-syrc-tr",syi:"syi-latn-ga",syk:"syk-latn-ng",syl:"syl-beng-bd",sym:"sym-latn-bf",syn:"syn-syrc-ir",syo:"syo-latn-kh",syr:"syr-syrc-iq",sys:"sys-latn-td",syw:"syw-deva-np",syx:"syx-latn-ga",sza:"sza-latn-my",szb:"szb-latn-id",szc:"szc-latn-my",szd:"szd-latn-my",szg:"szg-latn-cd",szl:"szl-latn-pl",szn:"szn-latn-id",szp:"szp-latn-id",szv:"szv-latn-cm",szw:"szw-latn-id",szy:"szy-latn-tw",ta:"ta-taml-in",taa:"taa-latn-us",tab:"tab-cyrl-ru",tac:"tac-latn-mx",tad:"tad-latn-id",tae:"tae-latn-br",taf:"taf-latn-br",tag:"tag-latn-sd",taj:"taj-deva-np",tak:"tak-latn-ng",tal:"tal-latn-zz",tan:"tan-latn-zz",tao:"tao-latn-tw",tap:"tap-latn-cd",taq:"taq-latn-zz",tar:"tar-latn-mx",tas:"tas-latn-vn",tau:"tau-latn-us",tav:"tav-latn-co",taw:"taw-latn-pg",tax:"tax-latn-td",tay:"tay-latn-tw","tay-hans":"tay-hans-tw","tay-hant":"tay-hant-tw",taz:"taz-latn-sd",tba:"tba-latn-br",tbc:"tbc-latn-zz",tbd:"tbd-latn-zz",tbe:"tbe-latn-sb",tbf:"tbf-latn-zz",tbg:"tbg-latn-zz",tbh:"tbh-latn-au",tbi:"tbi-latn-sd",tbj:"tbj-latn-pg",tbk:"tbk-tagb-ph","tbk-hano":"tbk-hano-ph","tbk-latn":"tbk-latn-ph",tbl:"tbl-latn-ph",tbm:"tbm-latn-cd",tbn:"tbn-latn-co",tbo:"tbo-latn-zz",tbp:"tbp-latn-id",tbs:"tbs-latn-pg",tbt:"tbt-latn-cd",tbu:"tbu-latn-mx",tbv:"tbv-latn-pg",tbw:"tbw-latn-ph",tbx:"tbx-latn-pg",tby:"tby-latn-id",tbz:"tbz-latn-zz",tca:"tca-latn-br",tcb:"tcb-latn-us",tcc:"tcc-latn-tz",tcd:"tcd-latn-gh",tce:"tce-latn-ca",tcf:"tcf-latn-mx",tcg:"tcg-latn-id",tch:"tch-latn-tc",tci:"tci-latn-zz",tck:"tck-latn-ga",tcm:"tcm-latn-id",tcn:"tcn-tibt-np",tco:"tco-mymr-mm",tcp:"tcp-latn-mm",tcq:"tcq-latn-id",tcs:"tcs-latn-au",tcu:"tcu-latn-mx",tcw:"tcw-latn-mx",tcx:"tcx-taml-in",tcy:"tcy-knda-in",tcz:"tcz-latn-in",tda:"tda-tfng-ne","tda-arab":"tda-arab-ne","tda-latn":"tda-latn-ne",tdb:"tdb-deva-in","tdb-beng":"tdb-beng-in","tdb-kthi":"tdb-kthi-in",tdc:"tdc-latn-co",tdd:"tdd-tale-cn",tde:"tde-latn-ml",tdg:"tdg-deva-np",tdh:"tdh-deva-np",tdi:"tdi-latn-id",tdj:"tdj-latn-id",tdk:"tdk-latn-ng",tdl:"tdl-latn-ng",tdm:"tdm-latn-gy",tdn:"tdn-latn-id",tdo:"tdo-latn-ng",tdq:"tdq-latn-ng",tdr:"tdr-latn-vn",tds:"tds-latn-id",tdt:"tdt-latn-tl",tdu:"tdu-latn-my",tdv:"tdv-latn-ng",tdx:"tdx-latn-mg",tdy:"tdy-latn-ph",te:"te-telu-in",tea:"tea-latn-my",teb:"teb-latn-ec",tec:"tec-latn-ke",ted:"ted-latn-zz",tee:"tee-latn-mx",teg:"teg-latn-ga",teh:"teh-latn-ar",tei:"tei-latn-pg",tek:"tek-latn-cd",tem:"tem-latn-sl",ten:"ten-latn-co",teo:"teo-latn-ug",tep:"tep-latn-mx",teq:"teq-latn-sd",ter:"ter-latn-br",tes:"tes-java-id",tet:"tet-latn-tl",teu:"teu-latn-ug",tev:"tev-latn-id",tew:"tew-latn-us",tex:"tex-latn-ss",tey:"tey-latn-sd",tfi:"tfi-latn-zz",tfn:"tfn-latn-us",tfo:"tfo-latn-id",tfr:"tfr-latn-pa",tft:"tft-latn-id",tg:"tg-cyrl-tj","tg-arab":"tg-arab-pk","tg-pk":"tg-arab-pk",tga:"tga-latn-ke",tgb:"tgb-latn-my",tgc:"tgc-latn-zz",tgd:"tgd-latn-ng",tge:"tge-deva-np",tgf:"tgf-tibt-bt",tgh:"tgh-latn-tt",tgi:"tgi-latn-pg",tgj:"tgj-latn-in",tgn:"tgn-latn-ph",tgo:"tgo-latn-zz",tgp:"tgp-latn-vu",tgq:"tgq-latn-my",tgs:"tgs-latn-vu",tgt:"tgt-latn-ph","tgt-hano":"tgt-hano-ph","tgt-tagb":"tgt-tagb-ph",tgu:"tgu-latn-zz",tgv:"tgv-latn-br",tgw:"tgw-latn-ci",tgx:"tgx-latn-ca",tgy:"tgy-latn-ss",tgz:"tgz-latn-au",th:"th-thai-th",thd:"thd-latn-au",the:"the-deva-np",thf:"thf-deva-np",thh:"thh-latn-mx",thi:"thi-tale-la",thk:"thk-latn-ke",thl:"thl-deva-np",thm:"thm-thai-th",thp:"thp-latn-ca","thp-dupl":"thp-dupl-ca",thq:"thq-deva-np",thr:"thr-deva-np",ths:"ths-deva-np",tht:"tht-latn-ca",thu:"thu-latn-ss",thv:"thv-latn-dz","thv-arab":"thv-arab-dz","thv-tfng":"thv-tfng-dz",thy:"thy-latn-ng",thz:"thz-latn-ne","thz-tfng":"thz-tfng-ne",ti:"ti-ethi-et",tic:"tic-latn-sd",tif:"tif-latn-zz",tig:"tig-ethi-er",tih:"tih-latn-my",tii:"tii-latn-cd",tij:"tij-deva-np",tik:"tik-latn-zz",til:"til-latn-us",tim:"tim-latn-zz",tin:"tin-cyrl-ru",tio:"tio-latn-zz",tip:"tip-latn-id",tiq:"tiq-latn-bf",tis:"tis-latn-ph",tit:"tit-latn-co",tiu:"tiu-latn-ph",tiv:"tiv-latn-ng",tiw:"tiw-latn-au",tix:"tix-latn-us",tiy:"tiy-latn-ph",tja:"tja-latn-lr",tjg:"tjg-latn-id",tji:"tji-latn-cn",tjj:"tjj-latn-au",tjl:"tjl-mymr-mm",tjn:"tjn-latn-ci",tjo:"tjo-arab-dz",tjp:"tjp-latn-au",tjs:"tjs-latn-cn",tju:"tju-latn-au",tjw:"tjw-latn-au",tk:"tk-latn-tm",tka:"tka-latn-br",tkb:"tkb-deva-in",tkd:"tkd-latn-tl",tke:"tke-latn-mz",tkf:"tkf-latn-br",tkg:"tkg-latn-mg",tkl:"tkl-latn-tk",tkp:"tkp-latn-sb",tkq:"tkq-latn-ng",tkr:"tkr-latn-az",tks:"tks-arab-ir",tkt:"tkt-deva-np",tku:"tku-latn-mx",tkv:"tkv-latn-pg",tkw:"tkw-latn-sb",tkx:"tkx-latn-id",tkz:"tkz-latn-vn",tl:"tl-latn-ph",tla:"tla-latn-mx",tlb:"tlb-latn-id",tlc:"tlc-latn-mx",tld:"tld-latn-id",tlf:"tlf-latn-zz",tlg:"tlg-latn-id",tli:"tli-latn-us","tli-cyrl":"tli-cyrl-us",tlj:"tlj-latn-ug",tlk:"tlk-latn-id",tll:"tll-latn-cd",tlm:"tlm-latn-vu",tln:"tln-latn-id",tlp:"tlp-latn-mx",tlq:"tlq-latn-mm",tlr:"tlr-latn-sb",tls:"tls-latn-vu",tlt:"tlt-latn-id",tlu:"tlu-latn-id",tlv:"tlv-latn-id",tlx:"tlx-latn-zz",tly:"tly-latn-az",tma:"tma-latn-td",tmb:"tmb-latn-vu",tmc:"tmc-latn-td",tmd:"tmd-latn-pg",tme:"tme-latn-br",tmf:"tmf-latn-py",tmg:"tmg-latn-id",tmh:"tmh-latn-ne",tmi:"tmi-latn-vu",tmj:"tmj-latn-id",tmk:"tmk-deva-np",tml:"tml-latn-id",tmm:"tmm-latn-vn",tmn:"tmn-latn-id",tmo:"tmo-latn-my",tmq:"tmq-latn-pg",tmr:"tmr-syrc-il",tmt:"tmt-latn-vu",tmu:"tmu-latn-id",tmv:"tmv-latn-cd",tmw:"tmw-latn-my",tmy:"tmy-latn-zz",tmz:"tmz-latn-ve",tn:"tn-latn-za",tna:"tna-latn-bo",tnb:"tnb-latn-co",tnc:"tnc-latn-co",tnd:"tnd-latn-co",tng:"tng-latn-td",tnh:"tnh-latn-zz",tni:"tni-latn-id",tnk:"tnk-latn-vu",tnl:"tnl-latn-vu",tnm:"tnm-latn-id",tnn:"tnn-latn-vu",tno:"tno-latn-bo",tnp:"tnp-latn-vu",tnq:"tnq-latn-pr",tnr:"tnr-latn-sn",tns:"tns-latn-pg",tnt:"tnt-latn-id",tnv:"tnv-cakm-bd",tnw:"tnw-latn-id",tnx:"tnx-latn-sb",tny:"tny-latn-tz",to:"to-latn-to",tob:"tob-latn-ar",toc:"toc-latn-mx",tod:"tod-latn-gn",tof:"tof-latn-zz",tog:"tog-latn-mw",toh:"toh-latn-mz",toi:"toi-latn-zm",toj:"toj-latn-mx",tok:"tok-latn-001",tol:"tol-latn-us",tom:"tom-latn-id",too:"too-latn-mx",top:"top-latn-mx",toq:"toq-latn-zz",tor:"tor-latn-cd",tos:"tos-latn-mx",tou:"tou-latn-vn",tov:"tov-arab-ir",tow:"tow-latn-us",tox:"tox-latn-pw",toy:"toy-latn-id",toz:"toz-latn-cm",tpa:"tpa-latn-pg",tpc:"tpc-latn-mx",tpe:"tpe-latn-bd","tpe-beng":"tpe-beng-bd",tpf:"tpf-latn-id",tpg:"tpg-latn-id",tpi:"tpi-latn-pg",tpj:"tpj-latn-py",tpk:"tpk-latn-br",tpl:"tpl-latn-mx",tpm:"tpm-latn-zz",tpn:"tpn-latn-br",tpp:"tpp-latn-mx",tpr:"tpr-latn-br",tpt:"tpt-latn-mx",tpu:"tpu-khmr-kh",tpv:"tpv-latn-mp",tpx:"tpx-latn-mx",tpy:"tpy-latn-br",tpz:"tpz-latn-zz",tqb:"tqb-latn-br",tql:"tql-latn-vu",tqm:"tqm-latn-pg",tqn:"tqn-latn-us",tqo:"tqo-latn-zz",tqp:"tqp-latn-pg",tqt:"tqt-latn-mx",tqu:"tqu-latn-sb",tqw:"tqw-latn-us",tr:"tr-latn-tr",tra:"tra-arab-af",trb:"trb-latn-pg",trc:"trc-latn-mx",tre:"tre-latn-id",trf:"trf-latn-tt",trg:"trg-hebr-il",trh:"trh-latn-pg",tri:"tri-latn-sr",trj:"trj-latn-td",trl:"trl-latn-gb",trm:"trm-arab-af",trn:"trn-latn-bo",tro:"tro-latn-in",trp:"trp-latn-in","trp-beng":"trp-beng-in",trq:"trq-latn-mx",trr:"trr-latn-pe",trs:"trs-latn-mx",trt:"trt-latn-id",tru:"tru-latn-tr",trv:"trv-latn-tw",trw:"trw-arab-pk",trx:"trx-latn-my",try:"try-latn-in",trz:"trz-latn-br",ts:"ts-latn-za",tsa:"tsa-latn-cg",tsb:"tsb-latn-et",tsc:"tsc-latn-mz",tsd:"tsd-grek-gr",tsf:"tsf-deva-np",tsg:"tsg-latn-ph",tsh:"tsh-latn-cm",tsi:"tsi-latn-ca",tsj:"tsj-tibt-bt",tsl:"tsl-latn-vn",tsp:"tsp-latn-bf",tsr:"tsr-latn-vu",tst:"tst-latn-ml",tsu:"tsu-latn-tw",tsv:"tsv-latn-ga",tsw:"tsw-latn-zz",tsx:"tsx-latn-pg",tsz:"tsz-latn-mx",tt:"tt-cyrl-ru",ttb:"ttb-latn-ng",ttc:"ttc-latn-gt",ttd:"ttd-latn-zz",tte:"tte-latn-zz",ttf:"ttf-latn-cm",tth:"tth-laoo-la",tti:"tti-latn-id",ttj:"ttj-latn-ug",ttk:"ttk-latn-co",ttl:"ttl-latn-zm",ttm:"ttm-latn-ca",ttn:"ttn-latn-id",tto:"tto-laoo-la",ttp:"ttp-latn-id",ttr:"ttr-latn-zz",tts:"tts-thai-th",ttt:"ttt-latn-az",ttu:"ttu-latn-pg",ttv:"ttv-latn-pg",ttw:"ttw-latn-my",tty:"tty-latn-id",tua:"tua-latn-pg",tub:"tub-latn-us",tuc:"tuc-latn-pg",tud:"tud-latn-br",tue:"tue-latn-co",tuf:"tuf-latn-co",tug:"tug-latn-td",tuh:"tuh-latn-zz",tui:"tui-latn-cm",tuj:"tuj-latn-id",tul:"tul-latn-zz",tum:"tum-latn-mw",tun:"tun-latn-us",tuo:"tuo-latn-br",tuq:"tuq-latn-zz",tus:"tus-latn-ca",tuu:"tuu-latn-us",tuv:"tuv-latn-ke",tux:"tux-latn-br",tuy:"tuy-latn-ke",tuz:"tuz-latn-bf",tva:"tva-latn-sb",tvd:"tvd-latn-zz",tve:"tve-latn-id",tvk:"tvk-latn-vu",tvl:"tvl-latn-tv",tvm:"tvm-latn-id",tvn:"tvn-mymr-mm",tvo:"tvo-latn-id",tvs:"tvs-latn-ke",tvt:"tvt-latn-in",tvu:"tvu-latn-zz",tvw:"tvw-latn-id",tvx:"tvx-latn-tw",twa:"twa-latn-us",twb:"twb-latn-ph",twd:"twd-latn-nl",twe:"twe-latn-id",twf:"twf-latn-us",twg:"twg-latn-id",twh:"twh-latn-zz",twl:"twl-latn-mz",twm:"twm-deva-in",twn:"twn-latn-cm",two:"two-latn-bw",twp:"twp-latn-pg",twq:"twq-latn-ne",twr:"twr-latn-mx",twt:"twt-latn-br",twu:"twu-latn-id",tww:"tww-latn-pg",twx:"twx-latn-mz",twy:"twy-latn-id",txa:"txa-latn-my",txe:"txe-latn-id",txg:"txg-tang-cn",txi:"txi-latn-br",txj:"txj-latn-ng",txm:"txm-latn-id",txn:"txn-latn-id",txo:"txo-toto-in",txq:"txq-latn-id",txs:"txs-latn-id",txt:"txt-latn-id",txu:"txu-latn-br",txx:"txx-latn-my",txy:"txy-latn-mg",ty:"ty-latn-pf",tya:"tya-latn-zz",tye:"tye-latn-ng",tyh:"tyh-latn-vn",tyi:"tyi-latn-cg",tyj:"tyj-latn-vn",tyl:"tyl-latn-vn",tyn:"tyn-latn-id",typ:"typ-latn-au",tyr:"tyr-tavt-vn",tys:"tys-latn-vn",tyt:"tyt-latn-vn","tyt-tavt":"tyt-tavt-vn",tyu:"tyu-latn-bw",tyv:"tyv-cyrl-ru",tyx:"tyx-latn-cg",tyy:"tyy-latn-ng",tyz:"tyz-latn-vn",tzh:"tzh-latn-mx",tzj:"tzj-latn-gt",tzl:"tzl-latn-001",tzm:"tzm-latn-ma",tzn:"tzn-latn-id",tzo:"tzo-latn-mx",tzx:"tzx-latn-pg",uam:"uam-latn-br",uar:"uar-latn-pg",uba:"uba-latn-ng",ubi:"ubi-latn-td",ubl:"ubl-latn-ph",ubr:"ubr-latn-pg",ubu:"ubu-latn-zz",uda:"uda-latn-ng",ude:"ude-cyrl-ru",udg:"udg-mlym-in",udi:"udi-aghb-ru",udj:"udj-latn-id",udl:"udl-latn-cm",udm:"udm-cyrl-ru",udu:"udu-latn-sd",ues:"ues-latn-id",ufi:"ufi-latn-pg",ug:"ug-arab-cn","ug-cyrl":"ug-cyrl-kz","ug-kz":"ug-cyrl-kz","ug-mn":"ug-cyrl-mn",uga:"uga-ugar-sy",ugb:"ugb-latn-au",uge:"uge-latn-sb",ugh:"ugh-cyrl-ru",ugo:"ugo-thai-th",uha:"uha-latn-ng",uhn:"uhn-latn-id",uis:"uis-latn-pg",uiv:"uiv-latn-cm",uji:"uji-latn-ng",uk:"uk-cyrl-ua",uka:"uka-latn-id",ukg:"ukg-latn-pg",ukh:"ukh-latn-cf",uki:"uki-orya-in",ukk:"ukk-latn-mm",ukp:"ukp-latn-ng",ukq:"ukq-latn-ng",uku:"uku-latn-ng",ukv:"ukv-latn-ss",ukw:"ukw-latn-ng",uky:"uky-latn-au",ula:"ula-latn-ng",ulb:"ulb-latn-ng",ulc:"ulc-cyrl-ru",ule:"ule-latn-ar",ulf:"ulf-latn-id",uli:"uli-latn-fm",ulk:"ulk-latn-au",ulm:"ulm-latn-id",uln:"uln-latn-pg",ulu:"ulu-latn-id",ulw:"ulw-latn-ni",uma:"uma-latn-us",umb:"umb-latn-ao",umd:"umd-latn-au",umg:"umg-latn-au",umi:"umi-latn-my",umm:"umm-latn-ng",umn:"umn-latn-mm",umo:"umo-latn-br",ump:"ump-latn-au",umr:"umr-latn-au",ums:"ums-latn-id",una:"una-latn-pg",und:"en-latn-us","und-002":"en-latn-ng","und-003":"en-latn-us","und-005":"pt-latn-br","und-009":"en-latn-au","und-011":"en-latn-ng","und-013":"es-latn-mx","und-014":"sw-latn-tz","und-015":"ar-arab-eg","und-017":"sw-latn-cd","und-018":"en-latn-za","und-019":"en-latn-us","und-021":"en-latn-us","und-029":"es-latn-cu","und-030":"zh-hans-cn","und-034":"hi-deva-in","und-035":"id-latn-id","und-039":"it-latn-it","und-053":"en-latn-au","und-054":"en-latn-pg","und-057":"en-latn-gu","und-061":"sm-latn-ws","und-142":"zh-hans-cn","und-143":"uz-latn-uz","und-145":"ar-arab-sa","und-150":"ru-cyrl-ru","und-151":"ru-cyrl-ru","und-154":"en-latn-gb","und-155":"de-latn-de","und-202":"en-latn-ng","und-419":"es-latn-419","und-ad":"ca-latn-ad","und-adlm":"ff-adlm-gn","und-ae":"ar-arab-ae","und-af":"fa-arab-af","und-aghb":"udi-aghb-ru","und-ahom":"aho-ahom-in","und-al":"sq-latn-al","und-am":"hy-armn-am","und-ao":"pt-latn-ao","und-aq":"und-latn-aq","und-ar":"es-latn-ar","und-arab":"ar-arab-eg","und-arab-cc":"ms-arab-cc","und-arab-cn":"ug-arab-cn","und-arab-gb":"ur-arab-gb","und-arab-id":"ms-arab-id","und-arab-in":"ur-arab-in","und-arab-kh":"cja-arab-kh","und-arab-mm":"rhg-arab-mm","und-arab-mn":"kk-arab-mn","und-arab-mu":"ur-arab-mu","und-arab-ng":"ha-arab-ng","und-arab-pk":"ur-arab-pk","und-arab-tg":"apd-arab-tg","und-arab-th":"mfa-arab-th","und-arab-tj":"fa-arab-tj","und-arab-tr":"apc-arab-tr","und-arab-yt":"swb-arab-yt","und-armi":"arc-armi-ir","und-armn":"hy-armn-am","und-as":"sm-latn-as","und-at":"de-latn-at","und-avst":"ae-avst-ir","und-aw":"nl-latn-aw","und-ax":"sv-latn-ax","und-az":"az-latn-az","und-ba":"bs-latn-ba","und-bali":"ban-bali-id","und-bamu":"bax-bamu-cm","und-bass":"bsq-bass-lr","und-batk":"bbc-batk-id","und-bd":"bn-beng-bd","und-be":"nl-latn-be","und-beng":"bn-beng-bd","und-bf":"fr-latn-bf","und-bg":"bg-cyrl-bg","und-bh":"ar-arab-bh","und-bhks":"sa-bhks-in","und-bi":"rn-latn-bi","und-bj":"fr-latn-bj","und-bl":"fr-latn-bl","und-bn":"ms-latn-bn","und-bo":"es-latn-bo","und-bopo":"zh-bopo-tw","und-bq":"pap-latn-bq","und-br":"pt-latn-br","und-brah":"pka-brah-in","und-brai":"fr-brai-fr","und-bt":"dz-tibt-bt","und-bugi":"bug-bugi-id","und-buhd":"bku-buhd-ph","und-bv":"und-latn-bv","und-by":"be-cyrl-by","und-cakm":"ccp-cakm-bd","und-cans":"iu-cans-ca","und-cari":"xcr-cari-tr","und-cd":"sw-latn-cd","und-cf":"fr-latn-cf","und-cg":"fr-latn-cg","und-ch":"de-latn-ch","und-cham":"cjm-cham-vn","und-cher":"chr-cher-us","und-chrs":"xco-chrs-uz","und-ci":"fr-latn-ci","und-cl":"es-latn-cl","und-cm":"fr-latn-cm","und-cn":"zh-hans-cn","und-co":"es-latn-co","und-copt":"cop-copt-eg","und-cp":"und-latn-cp","und-cpmn":"und-cpmn-cy","und-cpmn-cy":"und-cpmn-cy","und-cprt":"grc-cprt-cy","und-cr":"es-latn-cr","und-cu":"es-latn-cu","und-cv":"pt-latn-cv","und-cw":"pap-latn-cw","und-cy":"el-grek-cy","und-cyrl":"ru-cyrl-ru","und-cyrl-al":"mk-cyrl-al","und-cyrl-ba":"sr-cyrl-ba","und-cyrl-ge":"ab-cyrl-ge","und-cyrl-gr":"mk-cyrl-gr","und-cyrl-md":"uk-cyrl-md","und-cyrl-ro":"bg-cyrl-ro","und-cyrl-sk":"uk-cyrl-sk","und-cyrl-tr":"kbd-cyrl-tr","und-cyrl-xk":"sr-cyrl-xk","und-cz":"cs-latn-cz","und-de":"de-latn-de","und-deva":"hi-deva-in","und-deva-bt":"ne-deva-bt","und-deva-fj":"hif-deva-fj","und-deva-mu":"bho-deva-mu","und-deva-pk":"btv-deva-pk","und-diak":"dv-diak-mv","und-dj":"aa-latn-dj","und-dk":"da-latn-dk","und-do":"es-latn-do","und-dogr":"doi-dogr-in","und-dupl":"fr-dupl-fr","und-dz":"ar-arab-dz","und-ea":"es-latn-ea","und-ec":"es-latn-ec","und-ee":"et-latn-ee","und-eg":"ar-arab-eg","und-egyp":"egy-egyp-eg","und-eh":"ar-arab-eh","und-elba":"sq-elba-al","und-elym":"arc-elym-ir","und-er":"ti-ethi-er","und-es":"es-latn-es","und-et":"am-ethi-et","und-ethi":"am-ethi-et","und-eu":"en-latn-ie","und-ez":"de-latn-ez","und-fi":"fi-latn-fi","und-fo":"fo-latn-fo","und-fr":"fr-latn-fr","und-ga":"fr-latn-ga","und-ge":"ka-geor-ge","und-geor":"ka-geor-ge","und-gf":"fr-latn-gf","und-gh":"ak-latn-gh","und-gl":"kl-latn-gl","und-glag":"cu-glag-bg","und-gn":"fr-latn-gn","und-gong":"wsg-gong-in","und-gonm":"esg-gonm-in","und-goth":"got-goth-ua","und-gp":"fr-latn-gp","und-gq":"es-latn-gq","und-gr":"el-grek-gr","und-gran":"sa-gran-in","und-grek":"el-grek-gr","und-grek-tr":"bgx-grek-tr","und-gs":"und-latn-gs","und-gt":"es-latn-gt","und-gujr":"gu-gujr-in","und-guru":"pa-guru-in","und-gw":"pt-latn-gw","und-hanb":"zh-hanb-tw","und-hang":"ko-hang-kr","und-hani":"zh-hani-cn","und-hano":"hnn-hano-ph","und-hans":"zh-hans-cn","und-hant":"zh-hant-tw","und-hant-ca":"yue-hant-ca","und-hebr":"he-hebr-il","und-hebr-se":"yi-hebr-se","und-hebr-ua":"yi-hebr-ua","und-hebr-us":"yi-hebr-us","und-hira":"ja-hira-jp","und-hk":"zh-hant-hk","und-hluw":"hlu-hluw-tr","und-hm":"und-latn-hm","und-hmng":"hnj-hmng-la","und-hmnp":"hnj-hmnp-us","und-hn":"es-latn-hn","und-hr":"hr-latn-hr","und-ht":"ht-latn-ht","und-hu":"hu-latn-hu","und-hung":"hu-hung-hu","und-ic":"es-latn-ic","und-id":"id-latn-id","und-il":"he-hebr-il","und-in":"hi-deva-in","und-iq":"ar-arab-iq","und-ir":"fa-arab-ir","und-is":"is-latn-is","und-it":"it-latn-it","und-ital":"ett-ital-it","und-jamo":"ko-jamo-kr","und-java":"jv-java-id","und-jo":"ar-arab-jo","und-jp":"ja-jpan-jp","und-jpan":"ja-jpan-jp","und-kali":"eky-kali-mm","und-kana":"ja-kana-jp","und-kawi":"kaw-kawi-id","und-ke":"sw-latn-ke","und-kg":"ky-cyrl-kg","und-kh":"km-khmr-kh","und-khar":"pra-khar-pk","und-khmr":"km-khmr-kh","und-khoj":"sd-khoj-in","und-kits":"zkt-kits-cn","und-km":"ar-arab-km","und-knda":"kn-knda-in","und-kore":"ko-kore-kr","und-kp":"ko-kore-kp","und-kr":"ko-kore-kr","und-kthi":"bho-kthi-in","und-kw":"ar-arab-kw","und-kz":"ru-cyrl-kz","und-la":"lo-laoo-la","und-lana":"nod-lana-th","und-laoo":"lo-laoo-la","und-laoo-au":"hnj-laoo-au","und-laoo-cn":"hnj-laoo-cn","und-laoo-fr":"hnj-laoo-fr","und-laoo-gf":"hnj-laoo-gf","und-laoo-mm":"hnj-laoo-mm","und-laoo-sr":"hnj-laoo-sr","und-laoo-th":"hnj-laoo-th","und-laoo-us":"hnj-laoo-us","und-laoo-vn":"hnj-laoo-vn","und-latn-af":"tk-latn-af","und-latn-am":"ku-latn-am","und-latn-cn":"za-latn-cn","und-latn-cy":"tr-latn-cy","und-latn-dz":"fr-latn-dz","und-latn-et":"en-latn-et","und-latn-ge":"ku-latn-ge","und-latn-ir":"tk-latn-ir","und-latn-km":"fr-latn-km","und-latn-ma":"fr-latn-ma","und-latn-mk":"sq-latn-mk","und-latn-mm":"kac-latn-mm","und-latn-mo":"pt-latn-mo","und-latn-mr":"fr-latn-mr","und-latn-ru":"krl-latn-ru","und-latn-sy":"fr-latn-sy","und-latn-tn":"fr-latn-tn","und-latn-tw":"trv-latn-tw","und-latn-ua":"pl-latn-ua","und-lb":"ar-arab-lb","und-lepc":"lep-lepc-in","und-li":"de-latn-li","und-limb":"lif-limb-in","und-lina":"lab-lina-gr","und-linb":"grc-linb-gr","und-lisu":"lis-lisu-cn","und-lk":"si-sinh-lk","und-ls":"st-latn-ls","und-lt":"lt-latn-lt","und-lu":"fr-latn-lu","und-lv":"lv-latn-lv","und-ly":"ar-arab-ly","und-lyci":"xlc-lyci-tr","und-lydi":"xld-lydi-tr","und-ma":"ar-arab-ma","und-mahj":"hi-mahj-in","und-maka":"mak-maka-id","und-mand":"myz-mand-ir","und-mani":"xmn-mani-cn","und-marc":"bo-marc-cn","und-mc":"fr-latn-mc","und-md":"ro-latn-md","und-me":"sr-latn-me","und-medf":"dmf-medf-ng","und-mend":"men-mend-sl","und-merc":"xmr-merc-sd","und-mero":"xmr-mero-sd","und-mf":"fr-latn-mf","und-mg":"mg-latn-mg","und-mk":"mk-cyrl-mk","und-ml":"bm-latn-ml","und-mlym":"ml-mlym-in","und-mm":"my-mymr-mm","und-mn":"mn-cyrl-mn","und-mo":"zh-hant-mo","und-modi":"mr-modi-in","und-mong":"mn-mong-cn","und-mq":"fr-latn-mq","und-mr":"ar-arab-mr","und-mroo":"mro-mroo-bd","und-mt":"mt-latn-mt","und-mtei":"mni-mtei-in","und-mu":"mfe-latn-mu","und-mult":"skr-mult-pk","und-mv":"dv-thaa-mv","und-mx":"es-latn-mx","und-my":"ms-latn-my","und-mymr":"my-mymr-mm","und-mymr-in":"kht-mymr-in","und-mymr-th":"mnw-mymr-th","und-mz":"pt-latn-mz","und-na":"af-latn-na","und-nagm":"unr-nagm-in","und-nand":"sa-nand-in","und-narb":"xna-narb-sa","und-nbat":"arc-nbat-jo","und-nc":"fr-latn-nc","und-ne":"ha-latn-ne","und-newa":"new-newa-np","und-ni":"es-latn-ni","und-nkoo":"man-nkoo-gn","und-nl":"nl-latn-nl","und-no":"nb-latn-no","und-np":"ne-deva-np","und-nshu":"zhx-nshu-cn","und-ogam":"sga-ogam-ie","und-olck":"sat-olck-in","und-om":"ar-arab-om","und-orkh":"otk-orkh-mn","und-orya":"or-orya-in","und-osge":"osa-osge-us","und-osma":"so-osma-so","und-ougr":"oui-ougr-143","und-pa":"es-latn-pa","und-palm":"arc-palm-sy","und-pauc":"ctd-pauc-mm","und-pe":"es-latn-pe","und-perm":"kv-perm-ru","und-pf":"fr-latn-pf","und-pg":"tpi-latn-pg","und-ph":"fil-latn-ph","und-phag":"lzh-phag-cn","und-phli":"pal-phli-ir","und-phlp":"pal-phlp-cn","und-phnx":"phn-phnx-lb","und-pk":"ur-arab-pk","und-pl":"pl-latn-pl","und-plrd":"hmd-plrd-cn","und-pm":"fr-latn-pm","und-pr":"es-latn-pr","und-prti":"xpr-prti-ir","und-ps":"ar-arab-ps","und-pt":"pt-latn-pt","und-pw":"pau-latn-pw","und-py":"gn-latn-py","und-qa":"ar-arab-qa","und-qo":"en-latn-dg","und-re":"fr-latn-re","und-rjng":"rej-rjng-id","und-ro":"ro-latn-ro","und-rohg":"rhg-rohg-mm","und-rs":"sr-cyrl-rs","und-ru":"ru-cyrl-ru","und-runr":"non-runr-se","und-rw":"rw-latn-rw","und-sa":"ar-arab-sa","und-samr":"smp-samr-il","und-sarb":"xsa-sarb-ye","und-saur":"saz-saur-in","und-sc":"fr-latn-sc","und-sd":"ar-arab-sd","und-se":"sv-latn-se","und-sgnw":"ase-sgnw-us","und-shaw":"en-shaw-gb","und-shrd":"sa-shrd-in","und-si":"sl-latn-si","und-sidd":"sa-sidd-in","und-sind":"sd-sind-in","und-sinh":"si-sinh-lk","und-sj":"nb-latn-sj","und-sk":"sk-latn-sk","und-sm":"it-latn-sm","und-sn":"fr-latn-sn","und-so":"so-latn-so","und-sogd":"sog-sogd-uz","und-sogo":"sog-sogo-uz","und-sora":"srb-sora-in","und-soyo":"cmg-soyo-mn","und-sr":"nl-latn-sr","und-st":"pt-latn-st","und-sund":"su-sund-id","und-sv":"es-latn-sv","und-sy":"ar-arab-sy","und-sylo":"syl-sylo-bd","und-syrc":"syr-syrc-iq","und-tagb":"tbw-tagb-ph","und-takr":"doi-takr-in","und-tale":"tdd-tale-cn","und-talu":"khb-talu-cn","und-taml":"ta-taml-in","und-tang":"txg-tang-cn","und-tavt":"blt-tavt-vn","und-td":"fr-latn-td","und-telu":"te-telu-in","und-tf":"fr-latn-tf","und-tfng":"zgh-tfng-ma","und-tg":"fr-latn-tg","und-tglg":"fil-tglg-ph","und-th":"th-thai-th","und-thaa":"dv-thaa-mv","und-thai":"th-thai-th","und-thai-cn":"lcp-thai-cn","und-thai-kh":"kdt-thai-kh","und-thai-la":"kdt-thai-la","und-tibt":"bo-tibt-cn","und-tirh":"mai-tirh-in","und-tj":"tg-cyrl-tj","und-tk":"tkl-latn-tk","und-tl":"pt-latn-tl","und-tm":"tk-latn-tm","und-tn":"ar-arab-tn","und-tnsa":"nst-tnsa-in","und-to":"to-latn-to","und-toto":"txo-toto-in","und-tr":"tr-latn-tr","und-tv":"tvl-latn-tv","und-tw":"zh-hant-tw","und-tz":"sw-latn-tz","und-ua":"uk-cyrl-ua","und-ug":"sw-latn-ug","und-ugar":"uga-ugar-sy","und-uy":"es-latn-uy","und-uz":"uz-latn-uz","und-va":"it-latn-va","und-vaii":"vai-vaii-lr","und-ve":"es-latn-ve","und-vith":"sq-vith-al","und-vn":"vi-latn-vn","und-vu":"bi-latn-vu","und-wara":"hoc-wara-in","und-wcho":"nnp-wcho-in","und-wf":"fr-latn-wf","und-ws":"sm-latn-ws","und-xk":"sq-latn-xk","und-xpeo":"peo-xpeo-ir","und-xsux":"akk-xsux-iq","und-ye":"ar-arab-ye","und-yezi":"ku-yezi-ge","und-yiii":"ii-yiii-cn","und-yt":"fr-latn-yt","und-zanb":"cmg-zanb-mn","und-zw":"sn-latn-zw",une:"une-latn-ng",ung:"ung-latn-au",uni:"uni-latn-pg",unk:"unk-latn-br",unm:"unm-latn-us",unn:"unn-latn-au",unr:"unr-beng-in","unr-deva":"unr-deva-np","unr-np":"unr-deva-np",unu:"unu-latn-pg",unx:"unx-beng-in",unz:"unz-latn-id",uok:"uok-latn-zz",uon:"uon-latn-tw",upi:"upi-latn-pg",upv:"upv-latn-vu",ur:"ur-arab-pk",ura:"ura-latn-pe",urb:"urb-latn-br",urc:"urc-latn-au",ure:"ure-latn-bo",urf:"urf-latn-au",urg:"urg-latn-pg",urh:"urh-latn-ng",uri:"uri-latn-zz",urk:"urk-thai-th",urm:"urm-latn-pg",urn:"urn-latn-id",uro:"uro-latn-pg",urp:"urp-latn-br",urr:"urr-latn-vu",urt:"urt-latn-zz",uru:"uru-latn-br",urv:"urv-latn-pg",urw:"urw-latn-zz",urx:"urx-latn-pg",ury:"ury-latn-id",urz:"urz-latn-br",usa:"usa-latn-zz",ush:"ush-arab-pk",usi:"usi-latn-bd","usi-beng":"usi-beng-bd",usk:"usk-latn-cm",usp:"usp-latn-gt",uss:"uss-latn-ng",usu:"usu-latn-pg",uta:"uta-latn-ng",ute:"ute-latn-us",uth:"uth-latn-zz",utp:"utp-latn-sb",utr:"utr-latn-zz",utu:"utu-latn-pg",uum:"uum-grek-ge","uum-cyrl":"uum-cyrl-ge",uur:"uur-latn-vu",uve:"uve-latn-nc",uvh:"uvh-latn-zz",uvl:"uvl-latn-zz",uwa:"uwa-latn-au",uya:"uya-latn-ng",uz:"uz-latn-uz","uz-af":"uz-arab-af","uz-arab":"uz-arab-af","uz-cn":"uz-cyrl-cn",uzs:"uzs-arab-af",vaa:"vaa-taml-in",vae:"vae-latn-cf",vaf:"vaf-arab-ir",vag:"vag-latn-zz",vah:"vah-deva-in",vai:"vai-vaii-lr",vaj:"vaj-latn-na",val:"val-latn-pg",vam:"vam-latn-pg",van:"van-latn-zz",vao:"vao-latn-vu",vap:"vap-latn-in",var:"var-latn-mx",vas:"vas-deva-in","vas-gujr":"vas-gujr-in",vau:"vau-latn-cd",vav:"vav-deva-in","vav-gujr":"vav-gujr-in",vay:"vay-deva-np",vbb:"vbb-latn-id",vbk:"vbk-latn-ph",ve:"ve-latn-za",vec:"vec-latn-it",vem:"vem-latn-ng",veo:"veo-latn-us",vep:"vep-latn-ru",ver:"ver-latn-ng",vgr:"vgr-arab-pk",vi:"vi-latn-vn",vic:"vic-latn-sx",vid:"vid-latn-tz",vif:"vif-latn-cg",vig:"vig-latn-bf",vil:"vil-latn-ar",vin:"vin-latn-tz",vit:"vit-latn-ng",viv:"viv-latn-zz",vka:"vka-latn-au",vkj:"vkj-latn-td",vkk:"vkk-latn-id",vkl:"vkl-latn-id",vkm:"vkm-latn-br",vkn:"vkn-latn-ng",vko:"vko-latn-id",vkp:"vkp-latn-in","vkp-deva":"vkp-deva-in",vkt:"vkt-latn-id",vku:"vku-latn-au",vkz:"vkz-latn-ng",vlp:"vlp-latn-vu",vls:"vls-latn-be",vma:"vma-latn-au",vmb:"vmb-latn-au",vmc:"vmc-latn-mx",vmd:"vmd-knda-in",vme:"vme-latn-id",vmf:"vmf-latn-de",vmg:"vmg-latn-pg",vmh:"vmh-arab-ir",vmi:"vmi-latn-au",vmj:"vmj-latn-mx",vmk:"vmk-latn-mz",vml:"vml-latn-au",vmm:"vmm-latn-mx",vmp:"vmp-latn-mx",vmq:"vmq-latn-mx",vmr:"vmr-latn-mz",vms:"vms-latn-id",vmu:"vmu-latn-au",vmw:"vmw-latn-mz",vmx:"vmx-latn-mx",vmy:"vmy-latn-mx",vmz:"vmz-latn-mx",vnk:"vnk-latn-sb",vnm:"vnm-latn-vu",vnp:"vnp-latn-vu",vo:"vo-latn-001",vor:"vor-latn-ng",vot:"vot-latn-ru",vra:"vra-latn-vu",vro:"vro-latn-ee",vrs:"vrs-latn-sb",vrt:"vrt-latn-vu",vto:"vto-latn-id",vum:"vum-latn-ga",vun:"vun-latn-tz",vut:"vut-latn-zz",vwa:"vwa-latn-cn","vwa-mymr":"vwa-mymr-cn",wa:"wa-latn-be",waa:"waa-latn-us",wab:"wab-latn-pg",wac:"wac-latn-us",wad:"wad-latn-id",wae:"wae-latn-ch",waf:"waf-latn-br",wag:"wag-latn-pg",wah:"wah-latn-id",wai:"wai-latn-id",waj:"waj-latn-zz",wal:"wal-ethi-et",wam:"wam-latn-us",wan:"wan-latn-zz",wap:"wap-latn-gy",waq:"waq-latn-au",war:"war-latn-ph",was:"was-latn-us",wat:"wat-latn-pg",wau:"wau-latn-br",wav:"wav-latn-ng",waw:"waw-latn-br",wax:"wax-latn-pg",way:"way-latn-sr",waz:"waz-latn-pg",wba:"wba-latn-ve",wbb:"wbb-latn-id",wbe:"wbe-latn-id",wbf:"wbf-latn-bf",wbh:"wbh-latn-tz",wbi:"wbi-latn-tz",wbj:"wbj-latn-tz",wbk:"wbk-arab-af",wbl:"wbl-latn-pk","wbl-arab":"wbl-arab-af","wbl-cyrl":"wbl-cyrl-tj",wbm:"wbm-latn-cn",wbp:"wbp-latn-au",wbq:"wbq-telu-in",wbr:"wbr-deva-in",wbt:"wbt-latn-au",wbv:"wbv-latn-au",wbw:"wbw-latn-id",wca:"wca-latn-br",wci:"wci-latn-zz",wdd:"wdd-latn-ga",wdg:"wdg-latn-pg",wdj:"wdj-latn-au",wdk:"wdk-latn-au",wdt:"wdt-latn-ca",wdu:"wdu-latn-au",wdy:"wdy-latn-au",wec:"wec-latn-ci",wed:"wed-latn-pg",weg:"weg-latn-au",weh:"weh-latn-cm",wei:"wei-latn-pg",wem:"wem-latn-bj",weo:"weo-latn-id",wep:"wep-latn-de",wer:"wer-latn-zz",wes:"wes-latn-cm",wet:"wet-latn-id",weu:"weu-latn-mm",wew:"wew-latn-id",wfg:"wfg-latn-id",wga:"wga-latn-au",wgb:"wgb-latn-pg",wgg:"wgg-latn-au",wgi:"wgi-latn-zz",wgo:"wgo-latn-id",wgu:"wgu-latn-au",wgy:"wgy-latn-au",wha:"wha-latn-id",whg:"whg-latn-zz",whk:"whk-latn-id",whu:"whu-latn-id",wib:"wib-latn-zz",wic:"wic-latn-us",wie:"wie-latn-au",wif:"wif-latn-au",wig:"wig-latn-au",wih:"wih-latn-au",wii:"wii-latn-pg",wij:"wij-latn-au",wik:"wik-latn-au",wil:"wil-latn-au",wim:"wim-latn-au",win:"win-latn-us",wir:"wir-latn-br",wiu:"wiu-latn-zz",wiv:"wiv-latn-zz",wiy:"wiy-latn-us",wja:"wja-latn-zz",wji:"wji-latn-zz",wka:"wka-latn-tz",wkd:"wkd-latn-id",wkr:"wkr-latn-au",wkw:"wkw-latn-au",wky:"wky-latn-au",wla:"wla-latn-pg",wlg:"wlg-latn-au",wlh:"wlh-latn-tl",wli:"wli-latn-id",wlm:"wlm-latn-gb",wlo:"wlo-arab-id",wlr:"wlr-latn-vu",wls:"wls-latn-wf",wlu:"wlu-latn-au",wlv:"wlv-latn-ar",wlw:"wlw-latn-id",wlx:"wlx-latn-gh",wma:"wma-latn-ng",wmb:"wmb-latn-au",wmc:"wmc-latn-pg",wmd:"wmd-latn-br",wme:"wme-deva-np",wmh:"wmh-latn-tl",wmi:"wmi-latn-au",wmm:"wmm-latn-id",wmn:"wmn-latn-nc",wmo:"wmo-latn-zz",wms:"wms-latn-id",wmt:"wmt-latn-au",wmw:"wmw-latn-mz","wmw-arab":"wmw-arab-mz",wmx:"wmx-latn-pg",wnb:"wnb-latn-pg",wnc:"wnc-latn-zz",wnd:"wnd-latn-au",wne:"wne-arab-pk",wng:"wng-latn-id",wni:"wni-arab-km",wnk:"wnk-latn-id",wnm:"wnm-latn-au",wnn:"wnn-latn-au",wno:"wno-latn-id",wnp:"wnp-latn-pg",wnu:"wnu-latn-zz",wnw:"wnw-latn-us",wny:"wny-latn-au",wo:"wo-latn-sn",woa:"woa-latn-au",wob:"wob-latn-zz",woc:"woc-latn-pg",wod:"wod-latn-id",woe:"woe-latn-fm",wof:"wof-latn-gm","wof-arab":"wof-arab-gm",wog:"wog-latn-pg",woi:"woi-latn-id",wok:"wok-latn-cm",wom:"wom-latn-ng",won:"won-latn-cd",woo:"woo-latn-id",wor:"wor-latn-id",wos:"wos-latn-zz",wow:"wow-latn-id",wpc:"wpc-latn-ve",wrb:"wrb-latn-au",wrg:"wrg-latn-au",wrh:"wrh-latn-au",wri:"wri-latn-au",wrk:"wrk-latn-au",wrl:"wrl-latn-au",wrm:"wrm-latn-au",wro:"wro-latn-au",wrp:"wrp-latn-id",wrr:"wrr-latn-au",wrs:"wrs-latn-zz",wru:"wru-latn-id",wrv:"wrv-latn-pg",wrw:"wrw-latn-au",wrx:"wrx-latn-id",wrz:"wrz-latn-au",wsa:"wsa-latn-id",wsg:"wsg-gong-in",wsi:"wsi-latn-vu",wsk:"wsk-latn-zz",wsr:"wsr-latn-pg",wss:"wss-latn-gh",wsu:"wsu-latn-br",wsv:"wsv-arab-af",wtf:"wtf-latn-pg",wth:"wth-latn-au",wti:"wti-latn-et",wtk:"wtk-latn-pg",wtm:"wtm-deva-in",wtw:"wtw-latn-id","wtw-bugi":"wtw-bugi-id",wua:"wua-latn-au",wub:"wub-latn-au",wud:"wud-latn-tg",wul:"wul-latn-id",wum:"wum-latn-ga",wun:"wun-latn-tz",wur:"wur-latn-au",wut:"wut-latn-pg",wuu:"wuu-hans-cn",wuv:"wuv-latn-zz",wux:"wux-latn-au",wuy:"wuy-latn-id",wwa:"wwa-latn-zz",wwb:"wwb-latn-au",wwo:"wwo-latn-vu",wwr:"wwr-latn-au",www:"www-latn-cm",wxw:"wxw-latn-au",wyb:"wyb-latn-au",wyi:"wyi-latn-au",wym:"wym-latn-pl",wyn:"wyn-latn-us",wyr:"wyr-latn-br",wyy:"wyy-latn-fj",xaa:"xaa-latn-es",xab:"xab-latn-ng",xai:"xai-latn-br",xaj:"xaj-latn-br",xak:"xak-latn-ve",xal:"xal-cyrl-ru",xam:"xam-latn-za",xan:"xan-ethi-et",xao:"xao-latn-vn",xar:"xar-latn-pg",xas:"xas-cyrl-ru",xat:"xat-latn-br",xau:"xau-latn-id",xav:"xav-latn-br",xaw:"xaw-latn-us",xay:"xay-latn-id",xbb:"xbb-latn-au",xbd:"xbd-latn-au",xbe:"xbe-latn-au",xbg:"xbg-latn-au",xbi:"xbi-latn-zz",xbj:"xbj-latn-au",xbm:"xbm-latn-fr",xbn:"xbn-latn-my",xbp:"xbp-latn-au",xbr:"xbr-latn-id",xbw:"xbw-latn-br",xby:"xby-latn-au",xch:"xch-latn-us",xco:"xco-chrs-uz",xcr:"xcr-cari-tr",xda:"xda-latn-au",xdk:"xdk-latn-au",xdo:"xdo-latn-ao",xdq:"xdq-cyrl-ru",xdy:"xdy-latn-id",xed:"xed-latn-cm",xeg:"xeg-latn-za",xem:"xem-latn-id",xer:"xer-latn-br",xes:"xes-latn-zz",xet:"xet-latn-br",xeu:"xeu-latn-pg",xgb:"xgb-latn-ci",xgd:"xgd-latn-au",xgg:"xgg-latn-au",xgi:"xgi-latn-au",xgm:"xgm-latn-au",xgu:"xgu-latn-au",xgw:"xgw-latn-au",xh:"xh-latn-za",xhe:"xhe-arab-pk",xhm:"xhm-khmr-kh",xhv:"xhv-latn-vn",xii:"xii-latn-za",xin:"xin-latn-gt",xir:"xir-latn-br",xis:"xis-orya-in",xiy:"xiy-latn-br",xjb:"xjb-latn-au",xjt:"xjt-latn-au",xka:"xka-arab-pk",xkb:"xkb-latn-bj",xkc:"xkc-arab-ir",xkd:"xkd-latn-id",xke:"xke-latn-id",xkg:"xkg-latn-ml",xkj:"xkj-arab-ir",xkl:"xkl-latn-id",xkn:"xkn-latn-id",xkp:"xkp-arab-ir",xkq:"xkq-latn-id",xkr:"xkr-latn-br",xks:"xks-latn-id",xkt:"xkt-latn-gh",xku:"xku-latn-cg",xkv:"xkv-latn-bw",xkw:"xkw-latn-id",xkx:"xkx-latn-pg",xky:"xky-latn-my",xkz:"xkz-latn-bt",xla:"xla-latn-zz",xlc:"xlc-lyci-tr",xld:"xld-lydi-tr",xly:"xly-elym-ir",xma:"xma-latn-so",xmb:"xmb-latn-cm",xmc:"xmc-latn-mz",xmd:"xmd-latn-cm",xmf:"xmf-geor-ge",xmg:"xmg-latn-cm",xmh:"xmh-latn-au",xmj:"xmj-latn-cm",xmm:"xmm-latn-id",xmn:"xmn-mani-cn",xmo:"xmo-latn-br",xmp:"xmp-latn-au",xmq:"xmq-latn-au",xmr:"xmr-merc-sd",xmt:"xmt-latn-id",xmu:"xmu-latn-au",xmv:"xmv-latn-mg",xmw:"xmw-latn-mg",xmx:"xmx-latn-id",xmy:"xmy-latn-au",xmz:"xmz-latn-id",xna:"xna-narb-sa",xnb:"xnb-latn-tw",xni:"xni-latn-au",xnj:"xnj-latn-tz",xnk:"xnk-latn-au",xnm:"xnm-latn-au",xnn:"xnn-latn-ph",xnq:"xnq-latn-mz",xnr:"xnr-deva-in",xnt:"xnt-latn-us",xnu:"xnu-latn-au",xny:"xny-latn-au",xnz:"xnz-latn-eg","xnz-arab":"xnz-arab-eg",xoc:"xoc-latn-ng",xod:"xod-latn-id",xog:"xog-latn-ug",xoi:"xoi-latn-pg",xok:"xok-latn-br",xom:"xom-latn-sd","xom-ethi":"xom-ethi-et",xon:"xon-latn-zz",xoo:"xoo-latn-br",xop:"xop-latn-pg",xor:"xor-latn-br",xow:"xow-latn-pg",xpa:"xpa-latn-au",xpb:"xpb-latn-au",xpd:"xpd-latn-au",xpf:"xpf-latn-au",xpg:"xpg-grek-tr",xph:"xph-latn-au",xpi:"xpi-ogam-gb",xpj:"xpj-latn-au",xpk:"xpk-latn-br",xpl:"xpl-latn-au",xpm:"xpm-cyrl-ru",xpn:"xpn-latn-br",xpo:"xpo-latn-mx",xpq:"xpq-latn-us",xpr:"xpr-prti-ir",xpt:"xpt-latn-au",xpv:"xpv-latn-au",xpw:"xpw-latn-au",xpx:"xpx-latn-au",xpz:"xpz-latn-au",xra:"xra-latn-br",xrb:"xrb-latn-zz",xrd:"xrd-latn-au",xre:"xre-latn-br",xrg:"xrg-latn-au",xri:"xri-latn-br",xrm:"xrm-cyrl-ru",xrn:"xrn-cyrl-ru",xrr:"xrr-latn-it",xru:"xru-latn-au",xrw:"xrw-latn-pg",xsa:"xsa-sarb-ye",xsb:"xsb-latn-ph",xse:"xse-latn-id",xsh:"xsh-latn-ng",xsi:"xsi-latn-zz",xsm:"xsm-latn-zz",xsn:"xsn-latn-ng",xsp:"xsp-latn-pg",xsq:"xsq-latn-mz",xsr:"xsr-deva-np",xss:"xss-cyrl-ru",xsu:"xsu-latn-ve",xsy:"xsy-latn-tw",xta:"xta-latn-mx",xtb:"xtb-latn-mx",xtc:"xtc-latn-sd",xtd:"xtd-latn-mx",xte:"xte-latn-id",xth:"xth-latn-au",xti:"xti-latn-mx",xtj:"xtj-latn-mx",xtl:"xtl-latn-mx",xtm:"xtm-latn-mx",xtn:"xtn-latn-mx",xtp:"xtp-latn-mx",xts:"xts-latn-mx",xtt:"xtt-latn-mx",xtu:"xtu-latn-mx",xtv:"xtv-latn-au",xtw:"xtw-latn-br",xty:"xty-latn-mx",xub:"xub-taml-in","xub-knda":"xub-knda-in","xub-mlym":"xub-mlym-in",xud:"xud-latn-au",xuj:"xuj-taml-in",xul:"xul-latn-au",xum:"xum-latn-it","xum-ital":"xum-ital-it",xun:"xun-latn-au",xuo:"xuo-latn-td",xut:"xut-latn-au",xuu:"xuu-latn-na",xve:"xve-ital-it",xvi:"xvi-arab-af",xvn:"xvn-latn-es",xvo:"xvo-latn-it",xvs:"xvs-latn-it",xwa:"xwa-latn-br",xwd:"xwd-latn-au",xwe:"xwe-latn-zz",xwj:"xwj-latn-au",xwk:"xwk-latn-au",xwl:"xwl-latn-bj",xwo:"xwo-cyrl-ru",xwr:"xwr-latn-id",xwt:"xwt-latn-au",xww:"xww-latn-au",xxb:"xxb-latn-gh",xxk:"xxk-latn-id",xxm:"xxm-latn-au",xxr:"xxr-latn-br",xxt:"xxt-latn-id",xya:"xya-latn-au",xyb:"xyb-latn-au",xyj:"xyj-latn-au",xyk:"xyk-latn-au",xyl:"xyl-latn-br",xyt:"xyt-latn-au",xyy:"xyy-latn-au",xzh:"xzh-marc-cn",xzp:"xzp-latn-mx",yaa:"yaa-latn-pe",yab:"yab-latn-br",yac:"yac-latn-id",yad:"yad-latn-pe",yae:"yae-latn-ve",yaf:"yaf-latn-cd",yag:"yag-latn-cl",yai:"yai-cyrl-tj",yaj:"yaj-latn-cf",yak:"yak-latn-us",yal:"yal-latn-gn","yal-arab":"yal-arab-gn",yam:"yam-latn-zz",yan:"yan-latn-ni",yao:"yao-latn-mz",yap:"yap-latn-fm",yaq:"yaq-latn-mx",yar:"yar-latn-ve",yas:"yas-latn-zz",yat:"yat-latn-zz",yau:"yau-latn-ve",yav:"yav-latn-cm",yaw:"yaw-latn-br",yax:"yax-latn-ao",yay:"yay-latn-zz",yaz:"yaz-latn-zz",yba:"yba-latn-zz",ybb:"ybb-latn-cm",ybe:"ybe-latn-cn","ybe-ougr":"ybe-ougr-cn",ybh:"ybh-deva-np",ybi:"ybi-deva-np",ybj:"ybj-latn-ng",ybl:"ybl-latn-ng",ybm:"ybm-latn-pg",ybn:"ybn-latn-br",ybo:"ybo-latn-pg",ybx:"ybx-latn-pg",yby:"yby-latn-zz",ycl:"ycl-latn-cn",ycn:"ycn-latn-co",yda:"yda-latn-au",yde:"yde-latn-pg",ydg:"ydg-arab-pk",ydk:"ydk-latn-pg",yea:"yea-mlym-in","yea-knda":"yea-knda-in",yec:"yec-latn-de",yee:"yee-latn-pg",yei:"yei-latn-cm",yej:"yej-grek-il",yel:"yel-latn-cd",yer:"yer-latn-zz",yes:"yes-latn-ng",yet:"yet-latn-id",yeu:"yeu-telu-in",yev:"yev-latn-pg",yey:"yey-latn-bw",yga:"yga-latn-au",ygi:"ygi-latn-au",ygl:"ygl-latn-pg",ygm:"ygm-latn-pg",ygp:"ygp-plrd-cn",ygr:"ygr-latn-zz",ygu:"ygu-latn-au",ygw:"ygw-latn-zz",yhd:"yhd-hebr-il",yi:"yi-hebr-001",yia:"yia-latn-au",yig:"yig-yiii-cn",yih:"yih-hebr-de",yii:"yii-latn-au",yij:"yij-latn-au",yil:"yil-latn-au",yim:"yim-latn-in",yir:"yir-latn-id",yis:"yis-latn-pg",yiv:"yiv-yiii-cn",yka:"yka-latn-ph","yka-arab":"yka-arab-ph",ykg:"ykg-cyrl-ru",yki:"yki-latn-id",ykk:"ykk-latn-pg",ykm:"ykm-latn-pg",yko:"yko-latn-zz",ykr:"ykr-latn-pg",yky:"yky-latn-cf",yla:"yla-latn-pg",ylb:"ylb-latn-pg",yle:"yle-latn-zz",ylg:"ylg-latn-zz",yli:"yli-latn-id",yll:"yll-latn-zz",ylr:"ylr-latn-au",ylu:"ylu-latn-pg",yly:"yly-latn-nc",ymb:"ymb-latn-pg",yme:"yme-latn-pe",ymg:"ymg-latn-cd",ymk:"ymk-latn-mz","ymk-arab":"ymk-arab-mz",yml:"yml-latn-zz",ymm:"ymm-latn-so",ymn:"ymn-latn-id",ymo:"ymo-latn-pg",ymp:"ymp-latn-pg",yna:"yna-plrd-cn",ynd:"ynd-latn-au",yng:"yng-latn-cd",ynk:"ynk-cyrl-ru",ynl:"ynl-latn-pg",ynq:"ynq-latn-ng",yns:"yns-latn-cd",ynu:"ynu-latn-co",yo:"yo-latn-ng",yob:"yob-latn-pg",yog:"yog-latn-ph",yoi:"yoi-jpan-jp",yok:"yok-latn-us",yol:"yol-latn-gb",yom:"yom-latn-cd",yon:"yon-latn-zz",yot:"yot-latn-ng",yoy:"yoy-thai-th",yra:"yra-latn-pg",yrb:"yrb-latn-zz",yre:"yre-latn-zz",yrk:"yrk-cyrl-ru",yrl:"yrl-latn-br",yrm:"yrm-latn-au",yro:"yro-latn-br",yrs:"yrs-latn-id",yrw:"yrw-latn-pg",yry:"yry-latn-au",ysd:"ysd-yiii-cn",ysn:"ysn-yiii-cn",ysp:"ysp-yiii-cn",ysr:"ysr-cyrl-ru",yss:"yss-latn-zz",ysy:"ysy-plrd-cn",ytw:"ytw-latn-pg",yty:"yty-latn-au",yua:"yua-latn-mx",yub:"yub-latn-au",yuc:"yuc-latn-us",yud:"yud-hebr-il",yue:"yue-hant-hk","yue-cn":"yue-hans-cn","yue-hans":"yue-hans-cn",yuf:"yuf-latn-us",yug:"yug-cyrl-ru",yui:"yui-latn-co",yuj:"yuj-latn-zz",yul:"yul-latn-cf",yum:"yum-latn-us",yun:"yun-latn-ng",yup:"yup-latn-co",yuq:"yuq-latn-bo",yur:"yur-latn-us",yut:"yut-latn-zz",yuw:"yuw-latn-zz",yux:"yux-cyrl-ru",yuz:"yuz-latn-bo",yva:"yva-latn-id",yvt:"yvt-latn-ve",ywa:"ywa-latn-pg",ywg:"ywg-latn-au",ywn:"ywn-latn-br",ywq:"ywq-plrd-cn","ywq-yiii":"ywq-yiii-cn",ywr:"ywr-latn-au",ywu:"ywu-plrd-cn","ywu-yiii":"ywu-yiii-cn",yww:"yww-latn-au",yxa:"yxa-latn-au",yxg:"yxg-latn-au",yxl:"yxl-latn-au",yxm:"yxm-latn-au",yxu:"yxu-latn-au",yxy:"yxy-latn-au",yyr:"yyr-latn-au",yyu:"yyu-latn-pg",za:"za-latn-cn",zaa:"zaa-latn-mx",zab:"zab-latn-mx",zac:"zac-latn-mx",zad:"zad-latn-mx",zae:"zae-latn-mx",zaf:"zaf-latn-mx",zag:"zag-latn-sd",zah:"zah-latn-ng",zaj:"zaj-latn-tz",zak:"zak-latn-tz",zam:"zam-latn-mx",zao:"zao-latn-mx",zap:"zap-latn-mx",zaq:"zaq-latn-mx",zar:"zar-latn-mx",zas:"zas-latn-mx",zat:"zat-latn-mx",zau:"zau-tibt-in","zau-arab":"zau-arab-in",zav:"zav-latn-mx",zaw:"zaw-latn-mx",zax:"zax-latn-mx",zay:"zay-latn-et","zay-ethi":"zay-ethi-et",zaz:"zaz-latn-ng",zba:"zba-arab-001",zbc:"zbc-latn-my",zbe:"zbe-latn-my",zbt:"zbt-latn-id",zbu:"zbu-latn-ng",zbw:"zbw-latn-my",zca:"zca-latn-mx",zch:"zch-hani-cn",zdj:"zdj-arab-km",zea:"zea-latn-nl",zeg:"zeg-latn-pg",zeh:"zeh-hani-cn",zen:"zen-tfng-mr","zen-arab":"zen-arab-mr",zga:"zga-latn-tz",zgb:"zgb-hani-cn",zgh:"zgh-tfng-ma",zgm:"zgm-hani-cn",zgn:"zgn-hani-cn",zgr:"zgr-latn-pg",zh:"zh-hans-cn","zh-au":"zh-hant-au","zh-bn":"zh-hant-bn","zh-bopo":"zh-bopo-tw","zh-gb":"zh-hant-gb","zh-gf":"zh-hant-gf","zh-hanb":"zh-hanb-tw","zh-hant":"zh-hant-tw","zh-hk":"zh-hant-hk","zh-id":"zh-hant-id","zh-mo":"zh-hant-mo","zh-pa":"zh-hant-pa","zh-pf":"zh-hant-pf","zh-ph":"zh-hant-ph","zh-sr":"zh-hant-sr","zh-th":"zh-hant-th","zh-tw":"zh-hant-tw","zh-us":"zh-hant-us","zh-vn":"zh-hant-vn",zhd:"zhd-hani-cn","zhd-latn":"zhd-latn-vn",zhi:"zhi-latn-ng",zhn:"zhn-latn-cn","zhn-hani":"zhn-hani-cn",zhw:"zhw-latn-cm",zhx:"zhx-nshu-cn",zia:"zia-latn-zz",zik:"zik-latn-pg",zil:"zil-latn-gn",zim:"zim-latn-td",zin:"zin-latn-tz",ziw:"ziw-latn-tz",ziz:"ziz-latn-ng",zka:"zka-latn-id",zkb:"zkb-cyrl-ru",zkd:"zkd-latn-mm",zko:"zko-cyrl-ru",zkp:"zkp-latn-br",zkt:"zkt-kits-cn",zku:"zku-latn-au",zkz:"zkz-cyrl-ru",zla:"zla-latn-cd",zlj:"zlj-hani-cn","zlj-latn":"zlj-latn-cn",zlm:"zlm-latn-tg",zln:"zln-hani-cn",zlq:"zlq-hani-cn",zma:"zma-latn-au",zmb:"zmb-latn-cd",zmc:"zmc-latn-au",zmd:"zmd-latn-au",zme:"zme-latn-au",zmf:"zmf-latn-cd",zmg:"zmg-latn-au",zmh:"zmh-latn-pg",zmi:"zmi-latn-my",zmj:"zmj-latn-au",zmk:"zmk-latn-au",zml:"zml-latn-au",zmm:"zmm-latn-au",zmn:"zmn-latn-ga",zmo:"zmo-latn-sd",zmp:"zmp-latn-cd",zmq:"zmq-latn-cd",zmr:"zmr-latn-au",zms:"zms-latn-cd",zmt:"zmt-latn-au",zmu:"zmu-latn-au",zmv:"zmv-latn-au",zmw:"zmw-latn-cd",zmx:"zmx-latn-cg",zmy:"zmy-latn-au",zmz:"zmz-latn-cd",zna:"zna-latn-td",zne:"zne-latn-zz",zng:"zng-latn-vn",znk:"znk-latn-au",zns:"zns-latn-ng",zoc:"zoc-latn-mx",zoh:"zoh-latn-mx",zom:"zom-latn-in",zoo:"zoo-latn-mx",zoq:"zoq-latn-mx",zor:"zor-latn-mx",zos:"zos-latn-mx",zpa:"zpa-latn-mx",zpb:"zpb-latn-mx",zpc:"zpc-latn-mx",zpd:"zpd-latn-mx",zpe:"zpe-latn-mx",zpf:"zpf-latn-mx",zpg:"zpg-latn-mx",zph:"zph-latn-mx",zpi:"zpi-latn-mx",zpj:"zpj-latn-mx",zpk:"zpk-latn-mx",zpl:"zpl-latn-mx",zpm:"zpm-latn-mx",zpn:"zpn-latn-mx",zpo:"zpo-latn-mx",zpp:"zpp-latn-mx",zpq:"zpq-latn-mx",zpr:"zpr-latn-mx",zps:"zps-latn-mx",zpt:"zpt-latn-mx",zpu:"zpu-latn-mx",zpv:"zpv-latn-mx",zpw:"zpw-latn-mx",zpx:"zpx-latn-mx",zpy:"zpy-latn-mx",zpz:"zpz-latn-mx",zqe:"zqe-hani-cn","zqe-latn":"zqe-latn-cn",zrn:"zrn-latn-td",zro:"zro-latn-ec",zrp:"zrp-hebr-fr",zrs:"zrs-latn-id",zsa:"zsa-latn-pg",zsr:"zsr-latn-mx",zsu:"zsu-latn-pg",zte:"zte-latn-mx",ztg:"ztg-latn-mx",ztl:"ztl-latn-mx",ztm:"ztm-latn-mx",ztn:"ztn-latn-mx",ztp:"ztp-latn-mx",ztq:"ztq-latn-mx",zts:"zts-latn-mx",ztt:"ztt-latn-mx",ztu:"ztu-latn-mx",ztx:"ztx-latn-mx",zty:"zty-latn-mx",zu:"zu-latn-za",zua:"zua-latn-ng",zuh:"zuh-latn-pg",zum:"zum-arab-om",zun:"zun-latn-us",zuy:"zuy-latn-cm",zyg:"zyg-hani-cn",zyj:"zyj-latn-cn","zyj-hani":"zyj-hani-cn",zyn:"zyn-hani-cn",zyp:"zyp-latn-mm",zza:"zza-latn-tr",zzj:"zzj-hani-cn"},os={}.hasOwnProperty;function ls(b){const{language:p,script:v,region:T}=b;let w;var A,N;return v&&T&&(w=ss[jr({language:p,script:v,region:T})])?(b.script=void 0,b.region=void 0):v&&(w=ss[jr({language:p,script:v})])?b.script=void 0:T&&(w=ss[jr({language:p,region:T})])?b.region=void 0:p&&(w=ss[p]),w&&(b.language=void 0,A=b,N=Rr(w),A.language||(A.language=N.language),A.script||(A.script=N.script),A.region||(A.region=N.region),N.variants&&A.variants.push(...N.variants)),jr(b)}function cs(b,p){const v={},T=Rr(String(b||"").toLowerCase(),v),w=jr(T);if(!w)return w;let A=-1;for(;++A<po.length;){let N=po[A].from;N.slice(0,4)==="und-"&&T.language&&(N=T.language+N.slice(3)),go(w,N).length>0&&kh(T,N,po[A].to)}for(A=-1;++A<Ii.length;)Tc(T,Ii[A].from.field,Ii[A].from.value)&&wc(T,Ii[A].to.field,Ii[A].to.value);if((function(N){ls(N);const{language:C,script:x,region:B}=N;if(!C)return N;const q=jr({language:C,script:x,region:B});q===ls(Rr(C))?(N.script=void 0,N.region=void 0):B&&q===ls(Rr(C+"-"+B))?N.script=void 0:x&&q===ls(Rr(C+"-"+x))&&(N.region=void 0)})(T),T.variants.sort(),T.extensions.sort(Ih),v.warning){let N;for(N in yo)if(os.call(yo,N)){const C=yo[N],x=T[N];if(x&&os.call(C,x)){const B=C[x];v.warning("Deprecated "+N+" `"+x+"`, expected one of `"+B.join("`, `")+"`",-1,7)}}}return T.script&&(T.script=T.script.charAt(0).toUpperCase()+T.script.slice(1)),T.region&&(T.region=T.region.toUpperCase()),jr(T)}function kh(b,p,v){const T=Rr(p),w=Rr(v),A=[],N=T.language;let C;for(C in T)if(os.call(T,C)){const x=T[C];x&&Tc(b,C,x)&&A.push(C)}for(C in w)if(os.call(w,C)){const x=w[C];N&&x&&(A.includes(C)||!b[C])&&wc(b,C,C==="language"&&x==="und"?N:x)}}function Tc(b,p,v){let T,w=!1;if(v){const A=b[p];if(T=A,Array.isArray(A)){T=[];let N=-1;for(;++N<A.length;){const C=A[N];v.includes(C)?w=!0:T.push(C)}}else A===v&&(T=null,w=!0);b[p]=T}return w}function wc(b,p,v){const T=b[p];if(Array.isArray(T)){const w=Array.isArray(v)?v:[v];let A=-1;for(;++A<w.length;){const N=w[A];T.includes(N)||T.push(N)}}else b[p]=v}function Ih(b,p){return b.singleton>p.singleton?1:b.singleton<p.singleton?-1:0}function Rh(b,p){return p+10<=b.length&&b[p]===73&&b[p+1]===68&&b[p+2]===51&&b[p+3]<255&&b[p+4]<255&&b[p+6]<128&&b[p+7]<128&&b[p+8]<128&&b[p+9]<128}function _c(b,p){let v=0;return v=(127&b[p])<<21,v|=(127&b[p+1])<<14,v|=(127&b[p+2])<<7,v|=127&b[p+3],v}function xh(b,p){return p+10<=b.length&&b[p]===51&&b[p+1]===68&&b[p+2]===73&&b[p+3]<255&&b[p+4]<255&&b[p+6]<128&&b[p+7]<128&&b[p+8]<128&&b[p+9]<128}function bo(b,p=0,v=1/0){return(function(T,w,A,N){const C=(x=T)instanceof ArrayBuffer?x:x.buffer;var x;let B=1;"BYTES_PER_ELEMENT"in N&&(B=N.BYTES_PER_ELEMENT);const q=($=T)&&$.buffer instanceof ArrayBuffer&&$.byteLength!==void 0&&$.byteOffset!==void 0?T.byteOffset:0,I=(q+T.byteLength)/B,P=(q+w)/B,D=Math.floor(Math.max(0,Math.min(P,I)));var $;return new N(C,D,Math.floor(Math.min(D+Math.max(A,0),I))-D)})(b,p,v,Uint8Array)}function rr(b,p=!1){const v=p?b.indexOf(0):b.length,T=(function(w,A={}){let N;N=w instanceof ArrayBuffer?new DataView(w):new DataView(w.buffer,w.byteOffset,w.byteLength);let C=0,{encoding:x}=A;if(!x){const D=N.getUint8(0),$=N.getUint8(1);D==239&&$==187&&N.getUint8(2)==191?(x=Pa,C=3):D==254&&$==255?(x=ma,C=2):D==255&&$==254?(x=ga,C=2):x=Pa}if(typeof TextDecoder<"u")return new TextDecoder(x).decode(N);const{byteLength:B}=N,q=x!==ma;let I,P="";for(;C<B;){switch(x){case Pa:if(I=N.getUint8(C),I<128)C++;else if(I>=194&&I<=223)if(C+1<B){const D=N.getUint8(C+1);D>=128&&D<=191?(I=(31&I)<<6|63&D,C+=2):C++}else C++;else if(I>=224&&I<=239)if(C+2<=B-1){const D=N.getUint8(C+1),$=N.getUint8(C+2);D>=128&&D<=191&&$>=128&&$<=191?(I=(15&I)<<12|(63&D)<<6|63&$,C+=3):C++}else C++;else if(I>=240&&I<=244)if(C+3<=B-1){const D=N.getUint8(C+1),$=N.getUint8(C+2),J=N.getUint8(C+3);D>=128&&D<=191&&$>=128&&$<=191&&J>=128&&J<=191?(I=(7&I)<<18|(63&D)<<12|(63&$)<<6|63&J,C+=4):C++}else C++;else C++;break;case ma:case Yn:case ga:I=N.getUint16(C,q),C+=2}P+=String.fromCodePoint(I)}return P})(new DataView(b.buffer,b.byteOffset,v),{encoding:Pa});return p?T:T.replace(/\0/g,"")}function Ch(b){return b.type==="PRIV"?(function(p){if(p.size<2)return;const v=rr(p.data,!0),T=new Uint8Array(p.data.subarray(v.length+1));return{key:p.type,info:v,data:T.buffer}})(b):b.type[0]==="W"?(function(p){if(p.type==="WXXX"){if(p.size<2)return;let T=1;const w=rr(p.data.subarray(T),!0);T+=w.length+1;const A=rr(p.data.subarray(T));return{key:p.type,info:w,data:A}}const v=rr(p.data);return{key:p.type,info:"",data:v}})(b):b.type==="APIC"?(function(p){const v={key:p.type,description:"",data:"",mimeType:null,pictureType:null};if(p.size<2)return;if(p.data[0]!==3)return void console.log("Ignore frame with unrecognized character encoding");const T=p.data.subarray(1).indexOf(0);if(T===-1)return;const w=rr(bo(p.data,1,T)),A=p.data[2+T],N=p.data.subarray(3+T).indexOf(0);if(N===-1)return;const C=rr(bo(p.data,3+T,N));let x;var B;return x=w==="-->"?rr(bo(p.data,4+T+N)):(B=p.data.subarray(4+T+N))instanceof ArrayBuffer?B:B.byteOffset==0&&B.byteLength==B.buffer.byteLength?B.buffer:new Uint8Array(B).buffer,v.mimeType=w,v.pictureType=A,v.description=C,v.data=x,v})(b):(function(p){if(p.size<2)return;if(p.type==="TXXX"){let T=1;const{data:w}=p,A=rr(w.subarray(T),!0);T+=A.length+1;const N=rr(w.subarray(T));return{key:p.type,info:A,data:N}}const v=rr(p.data.subarray(1));return{key:p.type,info:"",data:v}})(b)}function Lh(b){const p=String.fromCharCode(b[0],b[1],b[2],b[3]),v=_c(b,4);return{type:p,size:v,data:b.subarray(10,10+v)}}const us=10,Ph=10;function Ac(){let b,p,v,T,w,A,N;const C=this.context;function x(G,U){const F=U?U.index:0,ve=p.getAdaptationsForType(w[F].mpd.manifest,F,G);if(!ve||ve.length===0)return null;if(ve.length>1&&U){for(let ke=0,Ee=ve.length;ke<Ee;ke++)if(te=ve[ke],p.getRolesForAdaptation(te).filter((function(Re){return Re.schemeIdUri===l.default.DASH_ROLE_SCHEME_ID&&Re.value===Se.default.MAIN}))[0])return ve[ke]}var te;return ve[0]}function B(G,U,F,ve,te,ke){let Ee,Re,Oe,Le,Q,ee,oe=[];if(!ve||ve.length===0)return[];const ae=p.getAdaptationsForPeriod(U);for(Le=0,ee=ve.length;Le<ee;Le++)if(Ee=ve[Le],Oe=p.getIndexForAdaptation(Ee,G,F.index),Re=Z(ae[Oe]),ke){let ie=Re.accessibility.length;for(Q=0;Q<ie;Q++){if(!Re)continue;let me=Re.accessibility[Q];if(me.schemeIdUri===A.ACCESSIBILITY_CEA608_SCHEME)if(me.value&&me.value!==""){let K=me.value.split(";");if(K[0].substring(0,2)==="CC")for(Q=0;Q<K.length;Q++)Re||(Re=Z.call(this,ae[Oe])),re(Re,K[Q].substring(0,3),K[Q].substring(4)),oe.push(Re),Re=null;else for(Q=0;Q<K.length;Q++)Re||(Re=Z.call(this,ae[Oe])),re(Re,"CC"+(Q+1),K[Q]),oe.push(Re),Re=null}else re(Re,A.CC1,"eng"),oe.push(Re),Re=null}}else te===A.IMAGE?(Re.type=A.IMAGE,oe.push(Re),Re=null):Re&&oe.push(Re);if(T.get().streaming.includePreselectionsInMediainfoArray){const ie=p.getPreselectionsForPeriod(U);for(Le=0,ee=ie.length;Le<ee;Le++){const me=ie[Le];me.hasOwnProperty("type")&&me.type===te&&(Re=V(ie[Le]),Re&&oe.push(Re))}}return oe}function q(G){const U=I(G);return p.getRegularPeriods(U)}function I(G){const U=D(G);return p.getMpd(U)}function P(){w=[]}function D(G){return G||(w.length>0?w[0].mpd.manifest:null)}function $(G){try{const U=J(G.streamInfo,w),F=p.getAdaptationsForPeriod(U);return G&&G.streamInfo&&G.streamInfo.id!==void 0&&F?F[G.index]:null}catch{return null}}function J(G,U){const F=U.length;for(let ve=0;ve<F;ve++){let te=U[ve];if(G&&G.id===te.id)return te}return null}function Z(G){if(!G)return null;let U=new is;const F=G.period.mpd.manifest.Period[G.period.index].AdaptationSet[G.index];U.id=G.id,U.index=G.index,U.codec=p.getCodec(F);const ve=T.get().streaming.enhancement.codecs;return U.type=ve.some((te=>U.codec?.includes(te)))?l.default.ENHANCEMENT:G.type,U.streamInfo=le(G.period),U.representationCount=p.getRepresentationCount(F),U.labels=p.getLabelsForAdaptation(F),U.lang=p.getLanguageForAdaptation(F),U.segmentAlignment=p.getSegmentAlignment(F),U.subSegmentAlignment=p.getSubSegmentAlignment(F),U.viewpoint=p.getViewpointForAdaptation(F),U.accessibility=p.getAccessibilityForAdaptation(F),U.accessibility.filter((function(te){if(te.schemeIdUri&&te.schemeIdUri.search("cea-608")>=0&&N!==void 0)return!0}))[0]&&(U.embeddedCaptions=!0),U.audioChannelConfiguration=p.getAudioChannelConfigurationForAdaptation(F),U.audioChannelConfiguration.length===0&&F.Representation&&F.Representation.length>0&&(U.audioChannelConfiguration=p.getAudioChannelConfigurationForRepresentation(F.Representation[0])),U.roles=p.getRolesForAdaptation(F),U.mimeType=p.getMimeType(F),U.contentProtection=p.getContentProtectionByAdaptation(F),U.bitrateList=p.getBitrateListForAdaptation(F),U.selectionPriority=p.getSelectionPriority(F),U.contentProtection&&U.contentProtection.length>0&&(U.contentProtection=(function(te,ke){if(!te||!te.length||!ke)return te;const Ee=p.getContentProtectionByManifest(ke);if(!Ee||!Ee.length)return te;const Re=Ee.reduce(((Oe,Le)=>(Le.refId&&Oe.set(Le.refId,Le),Oe)),new Map);return te.map((Oe=>{if(Oe.ref){const Le=Re.get(Oe.ref);Le&&Oe.mergeAttributesFromReference(Le)}return Oe}))})(U.contentProtection,G.period.mpd.manifest),U.contentProtection=(function(te){const ke=te.map((Ee=>Ee.cencDefaultKid)).filter((Ee=>Ee!==null));if(ke.length){const Ee=ke[0];te.forEach((Re=>{Re.keyId=Ee}))}return te})(U.contentProtection),U.normalizedKeyIds=(function(te){const ke=new Set;return te.forEach((Ee=>{Ee.cencDefaultKid&&typeof Ee.cencDefaultKid=="string"&&ke.add(Ee.cencDefaultKid.replace(/-/g,"").toLowerCase())})),ke})(U.contentProtection)),U.isText=p.getIsText(F),U.essentialProperties=p.getCombinedEssentialPropertiesForAdaptationSet(F),U.supplementalProperties=p.getCombinedSupplementalPropertiesForAdaptationSet(F),U.isFragmented=p.getIsFragmented(F),U.isEmbedded=!1,U.adaptationSetSwitchingCompatibleIds=(function(te){if(!te||!te.supplementalProperties)return[];let ke=[];const Ee=te.supplementalProperties.filter((Re=>Re.schemeIdUri===Se.default.ADAPTATION_SET_SWITCHING_SCHEME_ID_URI));return Ee&&Ee.length>0&&(ke=Ee[0].value.toString().split(",").map((Re=>Re))),ke})(U),U.segmentSequenceProperties=p.getSegmentSequencePropertiesForAdaptationSet(F),U}function V(G){if(!G)return null;let U=new is;const F=G.period.mpd.manifest.Period[G.period.index].Preselection[G.index],ve=G.period.mpd.manifest.Period[G.period.index].AdaptationSet,te=p.getAdaptationsForPeriod(G.period);return U=Z(p.getMainAdaptationSetForPreselection(F,te)),U&&(U.isPreselection=!0,U.tag=G.tag,U.id=G.id,U.codec=p.getCodecForPreselection(F,ve),U.selectionPriority=p.getSelectionPriority(F),U.labels=p.getLabelsForAdaptation(F),U.lang=p.getLanguageForAdaptation(F),U.viewpoint=p.getViewpointForAdaptation(F),U.accessibility=p.getAccessibilityForAdaptation(F),U.audioChannelConfiguration=p.getAudioChannelConfigurationForAdaptation(F),U.roles=p.getRolesForAdaptation(F),U.essentialProperties=p.getCombinedEssentialPropertiesForAdaptationSet(F),U.supplementalProperties=p.getCombinedSupplementalPropertiesForAdaptationSet(F)),U}function re(G,U,F){G.id=U,G.index=100+parseInt(U.substring(2,3)),G.type=A.TEXT,G.codec="cea-608-in-SEI",G.isEmbedded=!0,G.isFragmented=!1,G.lang=cs(F),G.roles=[{schemeIdUri:"urn:mpeg:dash:role:2011",value:"caption"}]}function le(G){let U=new yc;return U.id=G.id,U.index=G.index,U.start=G.start,U.duration=G.duration,U.manifestInfo=(function(F){let ve=new Eh;return ve.dvrWindowSize=F.timeShiftBufferDepth,ve.loadedTime=F.manifest.loadedTime,ve.availableFrom=F.availabilityStartTime,ve.minBufferTime=F.manifest.minBufferTime,ve.maxFragmentDuration=F.maxSegmentDuration,ve.duration=p.getDuration(F.manifest),ve.isDynamic=p.getIsDynamic(F.manifest),ve.serviceDescriptions=p.getServiceDescriptions(F.manifest),ve.protocol=F.manifest.protocol,ve})(G.mpd),U.isLast=G.mpd.manifest.Period.length===1||Math.abs(U.start+U.duration-U.manifestInfo.duration)<1,U.isEncrypted=G.isEncrypted,U}function ue(){if(!A)throw new Error("setConfig function has to be called previously")}function be(G){return w.length>0?w[0].mpd.manifest.Period[G]:null}function X(G,U,F){let ve,te,ke,Ee,Re,Oe;if(G){for(te=G.AdaptationSet,Re=0;Re<te.length;Re+=1)for(ve=te[Re],Ee=ve.Representation,Oe=0;Oe<Ee.length;Oe+=1)if(ke=Ee[Oe],U===ke.id)return F?Oe:ke}return null}return b={applyPatchToManifest:function(G,U){v.getPatchOperations(U).forEach((F=>{let ve=F.getMpdTarget(G);if(ve===null)return;let{name:te,target:ke,leaf:Ee}=ve;if(F.xpath.findsAttribute()||te==="__text"){switch(F.action){case"add":case"replace":ke[te]=F.value;break;case"remove":delete ke[te]}return}let Re=(ke[te]||[]).indexOf(Ee),Oe=F.position==="prepend"||F.position==="before";if(F.action==="remove"||F.action==="replace")if(Array.isArray(ke[te])){if(Re!=-1){let Le=ke[te];Le.splice(Re,1),Le.length>0?ke[te]=Le:delete ke[te]}}else delete ke[te];F.action!=="add"&&F.action!=="replace"||Object.keys(F.value).forEach((Le=>{let Q=F.value[Le],ee=ke[Le]||[];if(ee.length===0&&ke[Le]&&ee.push(ke[Le]),ee.length===0)ee=Q;else{let oe=ee.length;oe=Le==te&&Re!=-1?Re+(Oe?0:1)+(F.action==="replace"?-1:0):Oe?0:ee.length,ee.splice.apply(ee,[oe,0].concat(Q))}ke[Le]=ee}))}))},areMediaInfosEqual:function(G,U){if(!G||!U)return!1;const F=G.id===U.id,ve=G.codec===U.codec,te=JSON.stringify(G.viewpoint)===JSON.stringify(U.viewpoint),ke=G.lang===U.lang,Ee=JSON.stringify(G.roles)===JSON.stringify(U.roles),Re=JSON.stringify(G.accessibility)===JSON.stringify(U.accessibility),Oe=JSON.stringify(G.audioChannelConfiguration)===JSON.stringify(U.audioChannelConfiguration);return F&&ve&&te&&ke&&Ee&&Re&&Oe},getAllMediaInfoForType:function(G,U,F){let ve=w,te=F,ke=[];if(te)ue(),ve=q(te);else{if(!(w.length>0))return ke;te=w[0].mpd.manifest}const Ee=J(G,ve);let Re=p.getAdaptationsForType(te,G?G.index:null,U);return ke=B(te,Ee,G,Re,U),U===A.TEXT&&(Re=p.getAdaptationsForType(te,G?G.index:null,A.VIDEO),ke=ke.concat(B(te,Ee,G,Re,U,!0))),ke},getAvailabilityStartTime:function(G){const U=I(G);return p.getAvailabilityStartTime(U)},getBandwidthForRepresentation:function(G,U){let F;return F=X(be(U),G),F?F.bandwidth:null},getBaseURLsFromElement:function(G){return p.getBaseURLsFromElement(G)},getCodec:function(G,U,F){return p.getCodec(G,U,F)},getCodecForPreselection:function(G,U){return p.getCodecForPreselection(G,U)},getContentSteering:function(G){return p.getContentSteering(G)},getDuration:function(G){const U=D(G);return p.getDuration(U)},getEssentialProperties:function(G){try{return p.getEssentialProperties(G)}catch{return[]}},getEvent:function(G,U,F,ve){try{if(!G||!U||isNaN(F)||!ve)return null;const te=G.scheme_id_uri,ke=G.value;if(!U[te+"/"+ke])return null;const Ee=new da,Re=G.timescale||1,Oe=ve.adaptation.period.start,Le=U[te+"/"+ke],Q=isNaN(ve.presentationTimeOffset)?isNaN(Le.presentationTimeOffset)?0:Le.presentationTimeOffset:ve.presentationTimeOffset;let ee,oe=G.presentation_time_delta/Re;ee=G.version===0?Oe+F-Q+oe:Oe-Q+oe;const ae=G.event_duration/Re,ie=G.id,me=G.message_data;return Ee.eventStream=Le,Ee.eventStream.value=ke,Ee.eventStream.timescale=Re,Ee.duration=ae,Ee.id=ie,Ee.calculatedPresentationTime=ee,Ee.messageData=me,Ee.presentationTimeDelta=oe,Ee.parsedMessageData=te===l.default.ID3_SCHEME_ID_URI?(function(K){let ge=0;const _e=[];for(;Rh(K,ge);){const xe=_c(K,ge+6);K[ge+5]>>6&1&&(ge+=us),ge+=us;const Me=ge+xe;for(;ge+Ph<Me;){const Ne=Lh(K.subarray(ge)),Ge=Ch(Ne);Ge&&_e.push(Ge),ge+=Ne.size+us}xh(K,ge)&&(ge+=us)}return _e})(me):null,Ee}catch{return null}},getEventsFor:function(G,U,F){let ve=[];if(w.length>0){const te=w[0].mpd.manifest;if(G instanceof yc){const ke=J(G,w);ve=p.getEventsForPeriod(ke)}else if(G instanceof is){const ke=J(F,w);ve=p.getEventStreamForAdaptationSet(te,$(G),ke)}else if(G instanceof Xt){const ke=J(F,w);ve=p.getEventStreamForRepresentation(te,U,ke)}}return ve},getFramerate:function(G){return p.getFramerate(G)},getIndexForRepresentation:function(G,U){return(function(F,ve){const te=X(F,ve,!0);return te!==null?te:-1})(be(U),G)},getIsDVB:function(G){return p.hasProfile(G,"urn:dvb:dash:profile:dvb-dash:2014")},getIsDynamic:function(G){const U=D(G);return p.getIsDynamic(U)},getIsPatch:function(G){return v.getIsPatch(G)},getIsTextTrack:function(G){return p.getIsText(G)},getIsTypeOf:function(G,U){return p.getIsTypeOf(G,U)},getLocation:function(G){return p.getLocation(G)},getMainAdaptationForType:x,getMainAdaptationSetForPreselection:function(G,U){return p.getMainAdaptationSetForPreselection(G,U)},getCommonRepresentationForPreselection:function(G,U){return p.getCommonRepresentationForPreselection(G,U)},getManifestUpdatePeriod:function(G,U=0){return p.getManifestUpdatePeriod(G,U)},getMediaInfoForType:function(G,U){if(w.length===0||!G)return null;let F=J(G,w);if(!F)return null;const ve=p.getAdaptationsForPeriod(F);let te=x(U,G);return te?Z(ve[p.getIndexForAdaptation(te,w[0].mpd.manifest,G.index)]):null},getMpd:I,getPatchLocation:function(G){const U=p.getPatchLocation(G),F=p.getPublishTime(G);return U&&U.length!==0&&F?U.filter((ve=>isNaN(ve.ttl)||F.getTime()+ve.ttl>new Date().getTime())):[]},getPeriodById:function(G){if(!G||w.length===0)return null;const U=w.filter((F=>F.id===G));return U&&U.length>0?U[0]:null},getPreselectionIsTypeOf:function(G,U,F){return p.getPreselectionIsTypeOf(G,U,F)},getProducerReferenceTimes:function(G,U){let F,ve;const te=J(G,w);return F=U?U.id:null,w.length>0&&te&&(ve=F?p.getAdaptationForId(F,w[0].mpd.manifest,te.index):p.getAdaptationForIndex(U?U.index:null,w[0].mpd.manifest,te.index)),ve?p.getProducerReferenceTimesForAdaptation(ve):[]},getPublishTime:function(G){return p.getPublishTime(G)},getRealAdaptation:function(G,U){let F,ve;const te=J(G,w);return F=U?U.id:null,w.length>0&&te&&(ve=F?p.getAdaptationForId(F,w[0].mpd.manifest,te.index):p.getAdaptationForIndex(U?U.index:null,w[0].mpd.manifest,te.index)),ve},getRealPeriodByIndex:function(G){return p.getRealPeriodForIndex(G,w[0].mpd.manifest)},getRegularPeriods:q,getRepresentationSortFunction:function(){return p.getRepresentationSortFunction()},getStreamsInfo:function(G,U){const F=[];let ve=w;if(G&&(ue(),ve=q(G)),ve.length>0){(!U||U>ve.length)&&(U=ve.length);for(let te=0;te<U;te++)F.push(le(ve[te]))}return F},getSuggestedPresentationDelay:function(){const G=w.length>0?w[0].mpd:null;return p.getSuggestedPresentationDelay(G)},getSupplementalCodecs:function(G){const U=G[Se.default.SUPPLEMENTAL_CODECS];return U?U.split(" ").map((F=>G.mimeType+';codecs="'+F+'"')):[]},getUTCTimingSources:function(){const G=D();return p.getUTCTimingSources(G)},getVoRepresentations:function(G){let U;const F=$(G);return U=p.getRepresentationsForAdaptation(F,G),U},isPatchValid:function(G,U){let F=p.getId(G),ve=v.getMpdId(U),te=p.getPublishTime(G),ke=v.getPublishTime(U),Ee=v.getOriginalPublishTime(U);return!!(F&&ve&&F==ve&&te&&Ee&&te.getTime()==Ee.getTime()&&ke&&te.getTime()<ke.getTime())},reset:P,setConfig:function(G){G&&(G.constants&&(A=G.constants),G.cea608parser&&(N=G.cea608parser),G.errHandler&&p.setConfig({errHandler:G.errHandler}),G.BASE64&&p.setConfig({BASE64:G.BASE64}))},updatePeriods:function(G){if(!G)return null;ue(),w=q(G)}},p=xn(C).getInstance(),v=wh(C).getInstance(),T=(0,h.default)(C).getInstance(),P(),b}Ac.__dashjs_factory_name="DashAdapter";var Nh=n.default.getSingletonFactory(Ac);class Mh{static round10(p,v){return(function(T,w,A){return A===void 0||+A==0?Math[T](w):(A=+A,(w=+w)===null||isNaN(w)||typeof A!="number"||A%1!=0?NaN:(w=w.toString().split("e"),+((w=(w=Math[T](+(w[0]+"e"+(w[1]?+w[1]-A:-A)))).toString().split("e"))[0]+"e"+(w[1]?+w[1]+A:A))))})("round",p,v)}}var Dh=class{constructor(){this.TcpList=[],this.HttpList=[],this.RepSwitchList=[],this.BufferLevel=[],this.BufferState=[],this.PlayList=[],this.DroppedFrames=[],this.SchedulingInfo=[],this.DVRInfo=[],this.ManifestUpdate=[],this.RequestsQueue=null,this.DVBErrors=[]}},Oh=class{constructor(){this.t=null,this.mt=null,this.to=null,this.lto=null}},zh=class{constructor(){this.t=null,this.level=null}},Uh=class{constructor(){this.target=null,this.state=i.BUFFER_EMPTY}},Bh=class{constructor(){this.time=null,this.range=null,this.manifestInfo=null}},Fh=class{constructor(){this.time=null,this.droppedFrames=null}};class qh{constructor(){this.mediaType=null,this.type=null,this.requestTime=null,this.fetchTime=null,this.availabilityStartTime=null,this.presentationStartTime=0,this.clientTimeOffset=0,this.currentTime=null,this.buffered=null,this.latency=0,this.streamInfo=[],this.representationInfo=[]}}class jh{constructor(){this.id=null,this.index=null,this.start=null,this.duration=null}}class Hh{constructor(){this.id=null,this.index=null,this.mediaType=null,this.presentationTimeOffset=null,this.startNumber=null}}var Gh=class{constructor(){this.mediaType=null,this.t=null,this.type=null,this.startTime=null,this.availabilityStartTime=null,this.duration=null,this.bandwidth=null,this.range=null,this.state=null}},Yh=class{constructor(){this.loadingRequests=[],this.executedRequests=[]}};function Sc(b){const p=(b=b||{}).settings;let v,T,w=this.context,A=(0,y.default)(w).getInstance();function N(){A.trigger(u.default.METRICS_CHANGED)}function C(D){A.trigger(u.default.METRIC_CHANGED,{mediaType:D}),N()}function x(D,$,J){A.trigger(u.default.METRIC_UPDATED,{mediaType:D,metric:$,value:J}),C(D)}function B(D,$,J){A.trigger(u.default.METRIC_ADDED,{mediaType:D,metric:$,value:J}),C(D)}function q(D,$){let J=null;return D&&(T.hasOwnProperty(D)?J=T[D]:$||(J=new Dh,T[D]=J)),J}function I(D,$,J){let Z=q(D);Z!==null&&(Z[$].push(J),Z[$].length>p.get().streaming.metrics.maxListDepth&&Z[$].shift())}function P(D,$,J){I(D,$,J),B(D,$,J)}return v={addBufferLevel:function(D,$,J){let Z=new zh;Z.t=$,Z.level=J,P(D,i.BUFFER_LEVEL,Z)},addBufferState:function(D,$,J){let Z=new Uh;Z.target=J,Z.state=$,P(D,i.BUFFER_STATE,Z)},addDVBErrors:function(D){P(l.default.STREAM,i.DVB_ERRORS,D)},addDVRInfo:function(D,$,J,Z){let V=new Bh;V.time=$,V.range=Z,V.manifestInfo=J,P(D,i.DVR_INFO,V)},addDroppedFrames:function(D,$){let J=new Fh,Z=q(D).DroppedFrames;$&&(J.time=$.creationTime,J.droppedFrames=$.droppedVideoFrames,Z.length>0&&Z[Z.length-1]==J||P(D,i.DROPPED_FRAMES,J))},addHttpRequest:function D($,J,Z,V){let re=new ye.HTTPRequest;J.url&&J.url!==$.url&&(D({mediaType:$.mediaType,type:$.type,url:$.url,serviceLocation:null,range:$.range,startDate:$.startDate,firstByteDate:null,endDate:null,duration:$.duration,fileLoaderType:$.fileLoaderType,resourceTimingValues:$.resourceTimingValues},{url:null,status:null,headers:null},null,V),re.actualurl=J.url),re.tcpid=null,re.type=$.type,re.url=$.url,re.range=$.range||null,re.trequest=$.startDate,re.tresponse=$.firstByteDate,re.responsecode=J.status,re.cmsd=V,re._tfinish=$.endDate,re._stream=$.mediaType,re._mediaduration=$.duration,re._responseHeaders="";for(const le in J.headers)re._responseHeaders+=le+": "+J.headers[le]+`\r
`;re._serviceLocation=$.serviceLocation||null,re._fileLoaderType=$.fileLoaderType,re._resourceTimingValues=$.resourceTimingValues,re._streamId=$&&$.representation&&$.representation.mediaInfo&&$.representation.mediaInfo.streamInfo?$.representation.mediaInfo.streamInfo.id:null,Z?Z.forEach((le=>{(function(ue,be,X,G){let U=new ye.HTTPRequestTrace;U.s=be,U.d=X,U.b=G,ue.trace.push(U),ue.interval||(ue.interval=0),ue.interval+=X})(re,le.s,le.d,le.b,le.t)})):(delete re.interval,delete re.trace),P($.mediaType,i.HTTP_REQUEST,re)},addManifestUpdate:function(D,$,J,Z){let V=new qh;V.mediaType=D,V.type=$,V.requestTime=J,V.fetchTime=Z,I(l.default.STREAM,i.MANIFEST_UPDATE,V),B(D,i.MANIFEST_UPDATE,V)},addManifestUpdateRepresentationInfo:function(D,$,J){if(D&&D.representationInfo){const Z=new Hh;Z.id=$?$.id:null,Z.index=$?$.index:null,Z.mediaType=J,Z.startNumber=$?$.startNumber:null,Z.presentationTimeOffset=$?$.presentationTimeOffset:null,D.representationInfo.push(Z),x(D.mediaType,i.MANIFEST_UPDATE_TRACK_INFO,D)}},addManifestUpdateStreamInfo:function(D,$,J,Z,V){if(D){let re=new jh;re.id=$,re.index=J,re.start=Z,re.duration=V,D.streamInfo.push(re),x(D.mediaType,i.MANIFEST_UPDATE_STREAM_INFO,D)}},addPlayList:function(D){D.trace&&Array.isArray(D.trace)?D.trace.forEach(($=>{$.hasOwnProperty("subreplevel")&&!$.subreplevel&&delete $.subreplevel})):delete D.trace,P(l.default.STREAM,i.PLAY_LIST,D)},addRepresentationSwitch:function(D,$,J,Z,V){let re=new Oh;re.t=$,re.mt=J,re.to=Z,V?re.lto=V:delete re.lto,P(D,i.TRACK_SWITCH,re)},addRequestsQueue:function(D,$,J){let Z=new Yh;Z.loadingRequests=$,Z.executedRequests=J,q(D).RequestsQueue=Z,B(D,i.REQUESTS_QUEUE,Z)},addSchedulingInfo:function(D,$,J,Z,V,re,le,ue,be){let X=new Gh;X.mediaType=D,X.t=$,X.type=J,X.startTime=Z,X.availabilityStartTime=V,X.duration=re,X.bandwidth=le,X.range=ue,X.state=be,P(D,i.SCHEDULING_INFO,X)},clearAllCurrentMetrics:function(){T={},N()},clearCurrentMetricsForType:function(D){delete T[D],C(D)},getMetricsFor:q,updateManifestUpdateInfo:function(D,$){if(D){for(let J in $)D[J]=$[J];x(D.mediaType,i.MANIFEST_UPDATE,D)}}},T={},v}Sc.__dashjs_factory_name="MetricsModel";var Kh=n.default.getSingletonFactory(Sc);class xr{constructor(){this.start=null,this.mstart=null,this.starttype=null,this.trace=[]}}xr.INITIAL_PLAYOUT_START_REASON="initial_playout",xr.SEEK_START_REASON="seek",xr.RESUME_FROM_PAUSE_START_REASON="resume",xr.METRICS_COLLECTION_START_REASON="metrics_collection_start";class pa{constructor(){this.representationid=null,this.subreplevel=null,this.start=null,this.mstart=null,this.duration=null,this.playbackspeed=null,this.stopreason=null}}function kc(b){b=b||{};const p=this.context;let v,T,w,A,N=b.metricsModel;function C(q){const I=N.getMetricsFor(q,!0);if(!I)return null;const P=I.HttpList;let D,$=null;if(!P||P.length<=0)return null;for(D=P.length-1;D>=0;){if(P[D].responsecode){$=P[D];break}D--}return $}function x(q){const I=N.getMetricsFor(q,!0);return I&&I.HttpList?I.HttpList:[]}function B(q,I){if(!q)return null;const P=q[I];return P&&P.length!==0?P[P.length-1]:null}return v={getCurrentRepresentationSwitch:function(q){return B(N.getMetricsFor(q,!0),i.TRACK_SWITCH)},getCurrentBufferState:function(q){return B(N.getMetricsFor(q,!0),i.BUFFER_STATE)},getCurrentBufferLevel:function(q){const I=B(N.getMetricsFor(q,!0),i.BUFFER_LEVEL);return I?Mh.round10(I.level/1e3,-3):0},getCurrentHttpRequest:C,getHttpRequests:x,getCurrentDroppedFrames:function(){return B(N.getMetricsFor(l.default.VIDEO,!0),i.DROPPED_FRAMES)},getCurrentSchedulingInfo:function(q){return B(N.getMetricsFor(q,!0),i.SCHEDULING_INFO)},getCurrentDVRInfo:function(q){return B(q?N.getMetricsFor(q,!0):N.getMetricsFor(l.default.VIDEO,!0)||N.getMetricsFor(l.default.AUDIO,!0),i.DVR_INFO)},getCurrentManifestUpdate:function(){return B(N.getMetricsFor(l.default.STREAM),i.MANIFEST_UPDATE)},getLatestFragmentRequestHeaderValueByID:function(q,I){if(!I)return null;let P={},D=C(q);D&&(P=at.default.parseHttpHeaders(D._responseHeaders));const $=P[I.toLowerCase()];return $===void 0?null:$},getLatestMPDRequestHeaderValueByID:function(q){if(!q)return null;let I,P,D,$={};for(I=x(l.default.STREAM),D=I.length-1;D>=0;D--)if(P=I[D],P.type===ye.HTTPRequest.MPD_TYPE){$=at.default.parseHttpHeaders(P._responseHeaders);break}const J=$[q.toLowerCase()];return J===void 0?null:J},addRepresentationSwitch:function(q,I,P,D,$){N.addRepresentationSwitch(q,I,P,D,$)},addDVRInfo:function(q,I,P,D){N.addDVRInfo(q,I,P,D)},updateManifestUpdateInfo:function(q){const I=this.getCurrentManifestUpdate();N.updateManifestUpdateInfo(I,q)},addManifestUpdateStreamInfo:function(q){if(q){const I=this.getCurrentManifestUpdate();N.addManifestUpdateStreamInfo(I,q.id,q.index,q.start,q.duration)}},addManifestUpdateRepresentationInfo:function(q,I){if(q){const P=this.getCurrentManifestUpdate();N.addManifestUpdateRepresentationInfo(P,q,I)}},addManifestUpdate:function(q){N.addManifestUpdate(l.default.STREAM,q.type,q.startDate,q.endDate)},addHttpRequest:function(q,I,P,D,$,J){const Z={status:P,headers:D,url:I};N.addHttpRequest(q,Z,$,J)},addSchedulingInfo:function(q,I){N.addSchedulingInfo(q.mediaType,new Date,q.type,q.startTime,q.availabilityStartTime,q.duration,q.bandwidth,q.range,I)},addRequestsQueue:function(q,I,P){N.addRequestsQueue(q,I,P)},addBufferLevel:function(q,I,P){N.addBufferLevel(q,I,P)},addBufferState:function(q,I,P){N.addBufferState(q,I,P)},addDroppedFrames:function(q){N.addDroppedFrames(l.default.VIDEO,q)},addPlayList:function(){A&&(N.addPlayList(A),A=null)},addDVBErrors:function(q){N.addDVBErrors(q)},createPlaylistMetrics:function(q,I){A=new xr,A.start=new Date,A.mstart=q,A.starttype=I},createPlaylistTraceMetrics:function(q,I,P){T===!0&&(T=!1,w=new pa,w.representationid=q,w.start=new Date,w.mstart=I,w.playbackspeed=P!==null?P.toString():null)},updatePlayListTraceMetrics:function(q){if(w)for(let I in w)w[I]=q[I]},pushPlayListTraceMetrics:function(q,I){if(T===!1&&A&&w&&w.start){const P=w.start;w.duration=q.getTime()-P.getTime(),w.stopreason=I,A.trace.push(w),T=!0}},clearAllCurrentMetrics:function(){N.clearAllCurrentMetrics()}},N=N||Kh(p).getInstance({settings:b.settings}),T=!0,w=null,A=null,v}pa.REPRESENTATION_SWITCH_STOP_REASON="representation_switch",pa.REBUFFERING_REASON="rebuffering",pa.USER_REQUEST_STOP_REASON="user_request",pa.END_OF_PERIOD_STOP_REASON="end_of_period",pa.END_OF_CONTENT_STOP_REASON="end_of_content",pa.METRICS_COLLECTION_STOP_REASON="metrics_collection_end",pa.FAILURE_STOP_REASON="failure",kc.__dashjs_factory_name="DashMetrics";var $h=n.default.getSingletonFactory(kc);function Ic(){let b;const p=this.context,v=(0,y.default)(p).getInstance();return b={error:function(T){v.trigger(u.default.ERROR,{error:T})}},b}Ic.__dashjs_factory_name="ErrorHandler";var Vh=n.default.getSingletonFactory(Ic),Wh=t(5560);function Rc(){const b=this.context,p=(0,y.default)(b).getInstance();let v,T,w,A,N,C,x,B,q,I,P,D;function $(){D.debug("Stopping the gap controller"),N&&(clearInterval(N),N=null),(function(){p.off(u.default.WALLCLOCK_TIME_UPDATED,le,this),p.off(u.default.INITIAL_STREAM_SWITCH,re,this),p.off(u.default.PLAYBACK_SEEKING,J,this),p.off(u.default.BUFFER_REPLACEMENT_STARTED,Z,v),p.off(u.default.TRACK_CHANGE_RENDERED,V,v)})(),N=null,C=NaN,A=0,I=null,P={}}function J(){I&&(clearTimeout(I),I=null)}function Z(X){try{if(X.streamId!==B.getActiveStreamInfo().id||X.mediaType!==l.default.VIDEO&&X.mediaType!==l.default.AUDIO)return;X.streamId===B.getActiveStreamInfo().id&&(P[X.mediaType]=!0)}catch(G){D.error(G)}}function V(X){X&&X.mediaType&&(P[X.mediaType]=!1)}function re(){N||(function(){try{N||(D.debug("Starting the gap controller"),N=setInterval((()=>{ue()&&be(x.getTime())}),100))}catch{}})()}function le(){if(ue(w.get().streaming.gaps.enableSeekFix)&&(A++,A>=10)){const X=x.getTime();T===X?be(X,!0):(T=X,C=NaN),A=0}}function ue(X=!1){if(!B.getActiveStream())return!1;const G=Object.keys(P).some((F=>P[F])),U=!!X&&(function(){const F=B.getActiveStream(),ve=parseFloat((F.getStartTime()+F.getDuration()).toFixed(5));return x.getTime()+w.get().streaming.gaps.threshold>=ve})();return!G&&w.get().streaming.gaps.jumpGaps&&B.getActiveStreamProcessors().length>0&&(!x.isSeeking()||U)&&!x.isPaused()&&!B.getIsStreamSwitchInProgress()&&!B.getHasMediaOrInitialisationError()}function be(X,G=!1){const U=w.get().streaming.gaps.enableStallFix,F=w.get().streaming.gaps.stallSeek,ve=w.get().streaming.gaps.smallGapLimit,te=w.get().streaming.gaps.jumpLargeGaps,ke=w.get().streaming.gaps.seekOffset,Ee=q.getBufferRange();let Re,Oe=NaN,Le=!1;if(Re=(function(ee,oe){try{if(!ee||ee.length<=1&&oe>0)return NaN;let ae=NaN,ie=0;for(;isNaN(ae)&&ie<ee.length;){const me=ie>0?ee.end(ie-1):0;oe<ee.start(ie)&&me-oe<w.get().streaming.gaps.threshold&&(ae=ie),ie+=1}return ae}catch{return null}})(Ee,X),!isNaN(Re)){const ee=Ee.start(Re),oe=ee-X;oe>0&&(oe<=ve||te)&&(Oe=ee)}const Q=x.getTimeToStreamEnd();if(isNaN(Oe)&&G&&isFinite(Q)&&!isNaN(Q)&&Q<ve&&(Oe=parseFloat(x.getStreamEndTime().toFixed(5)),Le=!0),U&&isNaN(Oe)&&G&&isNaN(Re)&&(function(ee,oe){for(let ae=0,ie=ee.length;ae<ie;ae++)if(oe>=ee.start(ae)&&oe<=ee.end(ae))return!0;return!1})(Ee,X)&&(F===0?(D.warn("Toggle play pause to break stall"),q.pause(),q.play()):(D.warn(`Jumping ${F}s to break stall`),Oe=X+F)),Oe>0&&C!==Oe&&Oe>X&&!I){const ee=Oe-X;if(Le){const oe=B.getStreamForTime(Oe),ae=oe&&!!oe.getPreloaded();D.warn(`Jumping to end of stream because of gap from ${X} to ${Oe}. Gap duration: ${ee}`),x.seek(Oe+ke,!0,ae)}else{const oe=x.getIsDynamic(),ae=Re>0?Ee.end(Re-1):X,ie=oe?1e3*Math.max(0,ee-.1):0;I=window.setTimeout((()=>{x.seek(Oe+ke,!0,!0);const me=B.getActiveStream();me&&D.warn(`Jumping gap occuring in period ${me.getStreamId()} starting at ${ae} and ending at ${Oe}. Jumping by: ${Oe+ke-ae}`),I=null}),ie)}C=Oe}}return v={reset:$,setConfig:function(X){X&&(X.settings&&(w=X.settings),X.playbackController&&(x=X.playbackController),X.streamController&&(B=X.streamController),X.videoModel&&(q=X.videoModel))},initialize:function(){(function(){p.on(u.default.WALLCLOCK_TIME_UPDATED,le,this),p.on(u.default.INITIAL_STREAM_SWITCH,re,this),p.on(u.default.PLAYBACK_SEEKING,J,this),p.on(u.default.BUFFER_REPLACEMENT_STARTED,Z,v),p.on(u.default.TRACK_CHANGE_RENDERED,V,v)})()}},D=(0,c.default)(b).getInstance().getLogger(v),$(),v}Rc.__dashjs_factory_name="GapController";var Qh=n.default.getSingletonFactory(Rc),xc=class extends ne{constructor(b,p){super(),this.url=b||null,this.type=p||null,this.mediaType=l.default.STREAM,this.responseType=""}};function Cc(b){b=b||{};const p=this.context,v=(0,y.default)(p).getInstance();let T,w=ri(p).create({errHandler:b.errHandler,dashMetrics:b.dashMetrics,mediaPlayerModel:b.mediaPlayerModel,errors:Yt});return T={load:function(A,N,C){const x=function(B,q){N.resolved=!0,N.resolvedContent=B||null,v.trigger(u.default.XLINK_ELEMENT_LOADED,{element:N,resolveObject:C,error:B||q?null:new Bt.default(Yt.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE,Yt.XLINK_LOADER_LOADING_FAILURE_ERROR_MESSAGE+A)})};if(A==="urn:mpeg:dash:resolve-to-zero:2013")x(null,!0);else{const B=new xc(A,ye.HTTPRequest.XLINK_EXPANSION_TYPE);w.load({request:B,success:function(q){x(q)},error:function(){x(null)}})}},reset:function(){w&&(w.abort(),w=null)}},T}Cc.__dashjs_factory_name="XlinkLoader";var Xh=n.default.getClassFactory(Cc);const oi="onLoad";function Lc(b){b=b||{};let p=this.context,v=(0,y.default)(p).getInstance();const T=Un(p).getInstance();let w,A,N,C;function x(D,$,J){let Z,V,re={};re.elements=D,re.type=$,re.resolveType=J,re.elements.length===0&&q(re);for(let le=0;le<re.elements.length;le++)Z=re.elements[le],V=T.isHTTPURL(Z.url)?Z.url:Z.originalContent.BaseURL+Z.url,C.load(V,Z,re)}function B(D){let $,J,Z="";if($=D.element,J=D.resolveObject,$.resolvedContent){let V=0;$.resolvedContent.indexOf("<?xml")===0&&(V=$.resolvedContent.indexOf("?>")+2),Z=$.resolvedContent.substr(0,V)+"<response>"+$.resolvedContent.substr(V)+"</response>",$.resolvedContent=A.parseXml(Z).response}(function(V){let re,le;for(re=0;re<V.elements.length;re++)if(le=V.elements[re],le.resolved===!1)return!1;return!0})(J)&&q(J)}function q(D){let $,J,Z=[];if((function(V){let re,le,ue,be,X,G,U=[];for(be=V.elements.length-1;be>=0;be--){if(re=V.elements[be],le=re.type,re.resolvedContent){if(re.resolvedContent)for(X=0;X<re.resolvedContent[le].length;X++)ue=re.resolvedContent[le][X],U.push(ue)}else delete re.originalContent["xlink:actuate"],delete re.originalContent["xlink:href"],U.push(re.originalContent);for(re.parentElement[le].splice(re.index,1),G=0;G<U.length;G++)re.parentElement[le].splice(re.index+G,0,U[G]);U=[]}V.elements.length>0&&A.getIron().run(N)})(D),D.resolveType==="onActuate"&&v.trigger(u.default.XLINK_READY,{manifest:N}),D.resolveType===oi)switch(D.type){case Se.default.PERIOD:for($=0;$<N[Se.default.PERIOD].length;$++)J=N[Se.default.PERIOD][$],J.hasOwnProperty(Se.default.ADAPTATION_SET)&&(Z=Z.concat(I(J[Se.default.ADAPTATION_SET],J,Se.default.ADAPTATION_SET,oi))),J.hasOwnProperty(Se.default.EVENT_STREAM)&&(Z=Z.concat(I(J[Se.default.EVENT_STREAM],J,Se.default.EVENT_STREAM,oi)));x(Z,Se.default.ADAPTATION_SET,oi);break;case Se.default.ADAPTATION_SET:v.trigger(u.default.XLINK_READY,{manifest:N})}}function I(D,$,J,Z){let V,re,le,ue=[];for(re=D.length-1;re>=0;re--)V=D[re],V.hasOwnProperty("xlink:href")&&V["xlink:href"]==="urn:mpeg:dash:resolve-to-zero:2013"&&D.splice(re,1);for(re=0;re<D.length;re++)V=D[re],V.hasOwnProperty("xlink:href")&&V.hasOwnProperty("xlink:actuate")&&V["xlink:actuate"]===Z&&(le=P(V["xlink:href"],$,J,re,Z,V),ue.push(le));return ue}function P(D,$,J,Z,V,re){return{url:D,parentElement:$,type:J,index:Z,resolveType:V,originalContent:re,resolvedContent:null,resolved:!1}}return w={resolveManifestOnLoad:function(D){let $;N=D,N.Period?($=I(N.Period,N,Se.default.PERIOD,oi),x($,Se.default.PERIOD,oi)):v.trigger(u.default.XLINK_READY,{manifest:N})},setParser:function(D){D&&(A=D)},reset:function(){v.off(u.default.XLINK_ELEMENT_LOADED,B,w),C&&(C.reset(),C=null)}},v.on(u.default.XLINK_ELEMENT_LOADED,B,w),C=Xh(p).create({errHandler:b.errHandler,dashMetrics:b.dashMetrics,mediaPlayerModel:b.mediaPlayerModel,settings:b.settings}),w}Lc.__dashjs_factory_name="XlinkController";var Jh=n.default.getClassFactory(Lc);function Pc(b){function p(w,A){for(let N in w)A.hasOwnProperty(N)||(A[N]=w[N])}function v(w,A,N){for(let C=0,x=w.length;C<x;++C){const B=w[C];if(A[B.name])if(N[B.name]){if(B.merge){const q=A[B.name],I=N[B.name];typeof q=="object"&&typeof I=="object"?p(q,I):N[B.name]=q+I}}else N[B.name]=A[B.name]}}function T(w,A){for(let N=0,C=w.children.length;N<C;++N){const x=w.children[N],B=A[x.name];if(B)for(let q=0,I=B.length;q<I;++q){const P=B[q];v(w.properties,A,P),T(x,P)}}}return{run:function(w){if(w===null||typeof w!="object")return w;if(w.Period&&"period"in b){const A=b.period,N=w.Period;for(let C=0,x=N.length;C<x;++C){const B=N[C];if(T(A,B),"adaptationset"in b){const q=B.AdaptationSet;if(q){const I=b.adaptationset;for(let P=0,D=q.length;P<D;++P)T(I,q[P])}}}}return w}}}Pc.__dashjs_factory_name="ObjectIron";var Zh=n.default.getClassFactory(Pc),ds=class{constructor(b,p){this._test=b,this._converter=p}get test(){return this._test}get converter(){return this._converter}};const Nc=/^([-])?P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/;var em=class extends ds{constructor(){super(((b,p,v)=>{const T=[Se.default.MIN_BUFFER_TIME,Se.default.MEDIA_PRESENTATION_DURATION,Se.default.MINIMUM_UPDATE_PERIOD,Se.default.TIMESHIFT_BUFFER_DEPTH,Se.default.MAX_SEGMENT_DURATION,Se.default.MAX_SUBSEGMENT_DURATION,Se.default.SUGGESTED_PRESENTATION_DELAY,Se.default.START,l.default.START_TIME,Se.default.DURATION],w=T.length;for(let A=0;A<w;A++)if(p===T[A])return Nc.test(v);return!1}),(b=>{const p=Nc.exec(b);let v=31536e3*parseFloat(p[3]||0)+2592e3*parseFloat(p[5]||0)+86400*parseFloat(p[7]||0)+3600*parseFloat(p[9]||0)+60*parseFloat(p[11]||0)+parseFloat(p[13]||0);return p[1]!==void 0&&(v=-v),v}))}};const Mc=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})(?::?)([0-9]{2}))?/;var tm=class extends ds{constructor(){super(((b,p,v)=>Mc.test(v)),(b=>{const p=Mc.exec(b);let v;if(v=Date.UTC(parseInt(p[1],10),parseInt(p[2],10)-1,parseInt(p[3],10),parseInt(p[4],10),parseInt(p[5],10),p[6]&&parseInt(p[6],10)||0,p[7]&&1e3*parseFloat(p[7])||0),p[9]&&p[10]){const T=60*parseInt(p[9],10)+parseInt(p[10],10);v+=(p[8]==="+"?-1:1)*T*60*1e3}return new Date(v)}))}};const nm=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,am=[Se.default.ID];var rm=class extends ds{constructor(){super(((b,p,v)=>nm.test(v)&&am.indexOf(p)===-1),(b=>parseFloat(b)))}},im=class extends ds{constructor(){super(((b,p)=>{const v={[Se.default.ADAPTATION_SET]:[Se.default.LANG],[Se.default.REPRESENTATION]:[Se.default.LANG],[Se.default.CONTENT_COMPONENT]:[Se.default.LANG],[Se.default.LABEL]:[Se.default.LANG],[Se.default.GROUP_LABEL]:[Se.default.LANG]};if(v.hasOwnProperty(b)){let T=v[b];return T!==void 0&&T.indexOf(p)>=0}return!1}),(b=>cs(b)||String(b)))}},sm=class{constructor(b){var p;this._name=b,this._merge=(p=b)&&p.length&&p.charAt(0)===p.charAt(0).toUpperCase()}get name(){return this._name}get merge(){return this._merge}},li=class{constructor(b,p,v){this._name=b||"",this._properties=[],this._children=v||[],Array.isArray(p)&&p.forEach((T=>{this._properties.push(new sm(T))}))}get name(){return this._name}get children(){return this._children}get properties(){return this._properties}},om=class extends li{constructor(){const b=[Se.default.AUDIO_CHANNEL_CONFIGURATION,Se.default.AUDIO_SAMPLING_RATE,Se.default.CODECS,Se.default.CODING_DEPENDENCY,Se.default.CONTENT_PROTECTION,Se.default.FRAMERATE,Se.default.FRAME_PACKING,Se.default.HEIGHT,Se.default.INBAND_EVENT_STREAM,Se.default.MAXIMUM_SAP_PERIOD,Se.default.MAX_PLAYOUT_RATE,Se.default.MIME_TYPE,Se.default.PROFILES,Se.default.SAR,Se.default.SCAN_TYPE,Se.default.SEGMENT_PROFILES,Se.default.SEGMENT_SEQUENCE_PROPERTIES,Se.default.START_WITH_SAP,Se.default.WIDTH];super(Se.default.ADAPTATION_SET,b,[new li(Se.default.REPRESENTATION,b,[new li(Se.default.SUB_REPRESENTATION,b)])])}},lm=class extends li{constructor(){const b=[Se.default.SEGMENT_BASE,Se.default.SEGMENT_TEMPLATE,Se.default.SEGMENT_LIST];super(Se.default.PERIOD,b,[new li(Se.default.ADAPTATION_SET,b,[new li(Se.default.REPRESENTATION,b)])])}};const cm=[Se.default.ACCESSIBILITY,Se.default.ADAPTATION_SET,Se.default.ADD,Se.default.AUDIO_CHANNEL_CONFIGURATION,Se.default.BASE_URL,Se.default.CONTENT_COMPONENT,Se.default.CONTENT_PROTECTION,Se.default.CONTENT_STEERING,Se.default.ESSENTIAL_PROPERTY,Se.default.EVENT,Se.default.EVENT_STREAM,Se.default.INBAND_EVENT_STREAM,Se.default.LABEL,Se.default.LOCATION,Se.default.METRICS,Se.default.PATCH_LOCATION,Se.default.PERIOD,Se.default.PRESELECTION,Se.default.PRODUCER_REFERENCE_TIME,Se.default.REMOVE,Se.default.REPLACE,Se.default.REPORTING,Se.default.REPRESENTATION,Se.default.ROLE,Se.default.S,Se.default.SEGMENT_SEQUENCE_PROPERTIES,Se.default.SEGMENT_URL,Se.default.SERVICE_DESCRIPTION,Se.default.SUPPLEMENTAL_PROPERTY,Se.default.UTC_TIMING];function Dc(b){b=b||{};const p=this.context,v=b.debug;let T,w,A,N;function C(x){try{const B=(function(q){const I=(function(D,$={}){let J=$.pos||0;const Z=D.length,V=!!$.keepComments,re=!!$.keepWhitespace,le="<",ue=60,be=">",X=62,G=45,U=47,F=63,ve=33,te=39,ke=34,Ee=91,Re=93,Oe=`\r
	>/= `;function Le(me,K="#text"){return{nodeName:K,nodeValue:me,attributes:{},childNodes:[]}}function Q(me=""){const K=[];for(;D[J];)if(D.charCodeAt(J)==ue){if(D.charCodeAt(J+1)===U){const _e=J+2;if(J=D.indexOf(be,J),!D.startsWith(me,_e)){const xe=D.substring(0,J).split(`
`);throw new Error(`Unexpected close tag
Line: `+(xe.length-1)+`
Column: `+(xe[xe.length-1].length+1)+`
Char: `+D[J])}return J+1&&(J+=1),K}if(D.charCodeAt(J+1)===F){J=D.indexOf(be,J),J++;continue}if(D.charCodeAt(J+1)===ve){if(D.charCodeAt(J+2)==G){const _e=J;for(;J!==-1&&(D.charCodeAt(J)!==X||D.charCodeAt(J-1)!=G||D.charCodeAt(J-2)!=G||J==-1);)J=D.indexOf(be,J+1);J===-1&&(J=Z),V&&K.push(Le(D.substring(_e,J+1),"#comment"))}else{if(D.charCodeAt(J+2)===Ee&&D.charCodeAt(J+8)===Ee&&D.startsWith("CDATA",J+3)){const _e=D.indexOf("]]>",J);_e==-1?(K.push(Le(D.substr(J+9),"#cdata")),J=Z):(K.push(Le(D.substring(J+9,_e),"#cdata")),J=_e+3);continue}{const _e=J+1;J+=2;let xe=!1;for(;(D.charCodeAt(J)!==X||xe===!0)&&D[J];)D.charCodeAt(J)===Ee?xe=!0:xe===!0&&D.charCodeAt(J)===Re&&(xe=!1),J++;K.push(Le(D.substring(_e,J),"#doctype"))}}J++;continue}const ge=ae();K.push(ge)}else{const ge=ee();if(re)ge.length>0&&K.push(Le(ge));else{const _e=ge.trim();_e.length>0&&K.push(Le(_e))}J++}return K}function ee(){const me=J;return J=D.indexOf(le,J)-1,J===-2&&(J=Z),za(D.slice(me,J+1))}function oe(){const me=J;for(;Oe.indexOf(D[J])===-1&&D[J];)J++;return D.slice(me,J)}function ae(){J++;const me=oe();let K=me,ge=null;const _e=me.indexOf(":");_e!==-1&&(ge=me.slice(0,_e),K=me.slice(_e+1));const xe=(function(){const Ge={};for(;D.charCodeAt(J)!==X&&D[J];){const Ze=D.charCodeAt(J);if(Ze>64&&Ze<91||Ze>96&&Ze<123){const ht=oe();let wt="",Wt=D.charCodeAt(J);for(;Wt!==te&&Wt!==ke;)J++,Wt=D.charCodeAt(J);if(Wt===te||Wt===ke){if(wt=ie(),J===-1)throw new Error("Missing closing quote")}else J--;Ge[ht]=za(wt)}J++}return Ge})();let Me=[];const Ne=D.charCodeAt(J-1);return J++,Ne!==U&&(Me=Q(me)),{nodeName:me,nodeValue:null,attributes:xe,childNodes:Me,prefix:ge,localName:K}}function ie(){const me=D[J],K=J+1;return J=D.indexOf(me,K),D.slice(K,J)}return{nodeName:"#document",nodeValue:null,childNodes:Q(""),attributes:{}}})(q),P=I.childNodes.find((D=>D.nodeName==="MPD"||D.nodeName==="Patch"))||I.childNodes[0];return(function D($){$.nodeName.indexOf(":")!==-1&&($.__prefix=$.prefix,$.nodeName=$.localName);const{childNodes:J,attributes:Z,nodeName:V}=$;$.tagName=V;for(let le in Z){let ue=Z[le];if(V==="S")ue=parseInt(ue);else for(let be=0,X=A.length;be<X;be++){const G=A[be];if(G.test(V,le,ue)){ue=G.converter(ue);break}}$[le]=ue}const re=J?.length;for(let le=0;le<re;le++){const ue=J[le];if(ue.nodeName==="#text"){$.__text=ue.nodeValue;continue}D(ue);const{nodeName:be}=ue;Array.isArray($[be])?$[be].push(ue):cm.indexOf(be)!==-1?($[be]||($[be]=[]),$[be].push(ue)):$[be]=ue}$.__children=J})(P),P})(x);return{[B.tagName]:B}}catch{return null}}return T={getIron:function(){return N},parseXml:C,parse:function(x){let B;const q=window.performance.now();if(B=C(x),!B)throw new Error("failed to parse the manifest");B.Patch?(B=B.Patch,B.add&&B.add.forEach((P=>N.run(P))),B.replace&&B.replace.forEach((P=>N.run(P)))):(B=B.MPD,N.run(B));const I=window.performance.now();return w.info("Parsing complete: "+(I-q).toPrecision(3)+"ms"),B.protocol="DASH",B}},w=v.getLogger(T),A=[new em,new tm,new rm,new im],N=Zh(p).create({adaptationset:new om,period:new lm}),T}Dc.__dashjs_factory_name="DashParser";var um=n.default.getClassFactory(Dc);function Oc(b){b=b||{};const p=this.context,v=b.debug,T=b.settings,w=(0,y.default)(p).getInstance(),A=Un(p).getInstance();let N,C,x,B,q,I=b.mssHandler,P=b.errHandler;function D($){w.trigger(u.default.INTERNAL_MANIFEST_LOADED,{manifest:$.manifest})}return N={load:function($,J=null,Z=null){const V=new Date,re=new xc($,ye.HTTPRequest.MPD_TYPE);J&&(re.serviceLocation=J),Z&&(re.queryParams=Z),re.startDate||(re.startDate=V),w.trigger(u.default.MANIFEST_LOADING_STARTED,{request:re}),x.load({request:re,success:function(le,ue,be){if(!B)return;let X,G,U;if(be&&be!==$?(G=A.parseBaseUrl(be),X=be):(A.isRelative($)&&($=A.resolve($,window.location.href)),G=A.parseBaseUrl($)),ue!="No Content")if(q===null&&(q=(function(F){let ve=null;return F.indexOf("SmoothStreamingMedia")>-1?(I&&(ve=I.createMssParser(),I.createMssFragmentProcessor(),I.registerEvents()),ve):F.indexOf("MPD")>-1||F.indexOf("Patch")>-1?um(p).create({debug:v}):ve})(le)),q!==null){B.setParser(q);try{U=q.parse(le)}catch{return void w.trigger(u.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new Bt.default(Yt.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,Yt.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+`${$}`)})}if(U){if(U.url=X||$,U.originalUrl||(U.originalUrl=U.url),T&&T.get().streaming.enableManifestDurationMismatchFix&&U.mediaPresentationDuration&&U.Period.length>1){const F=U.Period.reduce(((ve,te)=>ve+te.duration),0);!isNaN(F)&&U.mediaPresentationDuration>F&&(C.warn("Media presentation duration greater than duration of all periods. Setting duration to total period duration"),U.mediaPresentationDuration=F)}U.baseUri=G,U.loadedTime=new Date,B.resolveManifestOnLoad(U),w.trigger(u.default.ORIGINAL_MANIFEST_LOADED,{originalManifest:le})}else w.trigger(u.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new Bt.default(Yt.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,Yt.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+`${$}`)})}else w.trigger(u.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new Bt.default(Yt.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,Yt.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+`${$}`)});else w.trigger(u.default.INTERNAL_MANIFEST_LOADED,{manifest:null})},error:function(le,ue,be){w.trigger(u.default.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new Bt.default(Yt.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE,Yt.MANIFEST_LOADER_LOADING_FAILURE_ERROR_MESSAGE+`${$}, ${be}`)})}})},reset:function(){w.off(u.default.XLINK_READY,D,N),I&&I.reset(),B&&(B.reset(),B=null),x&&(x.abort(),x=null)}},C=v.getLogger(N),w.on(u.default.XLINK_READY,D,N),x=ri(p).create({errHandler:b.errHandler,dashMetrics:b.dashMetrics,mediaPlayerModel:b.mediaPlayerModel,urlUtils:A,constants:l.default,dashConstants:Se.default,errors:Yt,requestTimeout:b.settings.get().streaming.manifestRequestTimeout}),B=Jh(p).create({errHandler:P,dashMetrics:b.dashMetrics,mediaPlayerModel:b.mediaPlayerModel,settings:b.settings}),q=null,N}Oc.__dashjs_factory_name="ManifestLoader";var dm=n.default.getClassFactory(Oc);function zc(){let b,p,v=this.context,T=(0,y.default)(v).getInstance();return b={getValue:function(){return p},setValue:function(w){p=w,w&&T.trigger(u.default.MANIFEST_LOADED,{data:w})}},b}zc.__dashjs_factory_name="ManifestModel";var fm=n.default.getSingletonFactory(zc);function Uc(){const b=this.context,p=(0,h.default)(b).getInstance();let v,T,w;return v={select:function(A){if(!A||A.length===0)return null;let N=null;return p.get().streaming.applyContentSteering&&(N=(function(C){const x=w.getCurrentSteeringResponseData();return x&&x.pathwayPriority&&x.pathwayPriority.length>0?(function(B=[],q=[]){let I=0,P=null;for(;I<B.length;){const D=B[I],$=q.findIndex((J=>J.serviceLocation&&J.serviceLocation===D));if($!==-1&&!T.contains(q[$].serviceLocation)){P=q[$];break}I+=1}return P})(x.pathwayPriority,C):null})(A)),N||(N=(function(C){return C[0]})(A)),N},setConfig:function(A){A.blacklistController&&(T=A.blacklistController),A.contentSteeringController&&(w=A.contentSteeringController)},reset:function(){T.reset()}},T=tn(b).create({updateEventName:u.default.SERVICE_LOCATION_LOCATION_BLACKLIST_CHANGED,addBlacklistEventName:u.default.SERVICE_LOCATION_LOCATION_BLACKLIST_ADD}),w=co(b).getInstance(),v}Uc.__dashjs_factory_name="LocationSelector";var hm=n.default.getClassFactory(Uc);function Bc(){const b=this.context,p=(0,y.default)(b).getInstance(),v=Un(b).getInstance();let T,w,A,N,C,x,B,q,I,P,D,$,J,Z,V;function re(){J=NaN,q=!1,x=!0,B=!1,le()}function le(){Z!==null&&(clearTimeout(Z),Z=null)}function ue(Ee){le(),B||(isNaN(Ee)&&!isNaN(J)&&(Ee=1e3*J),isNaN(Ee)||(P.debug("Refresh manifest in "+Ee+" milliseconds."),Z=setTimeout(G,Ee)))}function be(Ee=!1){q=!0;const Re=$.getValue();let Oe=Re.url;Oe&&(Oe=at.default.removeQueryParameterFromUrl(Oe,l.default.CMCD_QUERY_KEY));let Le=null;const Q=T.getPatchLocation(Re),ee=I.select(Q);let oe=null;if(ee&&!Ee)Oe=ee.url,Le=ee.serviceLocation,oe=ee.queryParams;else{const ae=(function(me){const K=T.getLocation(me),ge=w.getSynthesizedLocationElements(K);return K.concat(ge)})(Re),ie=I.select(ae);ie&&(Oe=ie.url,Le=ie.serviceLocation,oe=ie.queryParams)}v.isRelative(Oe)&&(Oe=v.resolve(Oe,Re.url)),D.load(Oe,Le,oe)}function X(Ee){if(Ee){if(T.getIsPatch(Ee)){let Le=Ee;Ee=$.getValue();let Q=T.isPatchValid(Ee,Le),ee=Q;if(Q){let oe=T.getPublishTime(Ee);T.applyPatchToManifest(Ee,Le);let ae=T.getPublishTime(Ee);ee=oe.getTime()!==ae.getTime()}if(!ee)return P.debug("Patch provided is invalid, performing full manifest refresh"),void be(!0);Ee.loadedTime=new Date}}else(Ee=$.getValue()).loadedTime=new Date;if($.getValue()&&$.getValue().type===Se.default.DYNAMIC&&Ee.type===Se.default.STATIC)return p.trigger(u.default.DYNAMIC_TO_STATIC),q=!1,void(B=!0);$.setValue(Ee);const Re=new Date,Oe=(Re.getTime()-Ee.loadedTime.getTime())/1e3;J=T.getManifestUpdatePeriod(Ee,Oe),1e3*J>2147483647&&(J=2147483647e-3),p.trigger(u.default.MANIFEST_UPDATED,{manifest:Ee}),P.info("Manifest has been refreshed at "+Re+"["+Re.getTime()/1e3+"] "),x||ue()}function G(){x||(q?ue(V.get().streaming.manifestUpdateRetryInterval):be())}function U(Ee){if(Ee.error)Ee.error.code===Yt.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE&&N.error(Ee.error);else{const Re=Ee.manifest;(function(Oe){(function(Le){const Q=A.getExternalSubtitles();if(!Q||Q.length===0)return;const ee=Le&&Le.Period?Le.Period.length:0;Q.forEach((oe=>{if(oe.periodId===null&&ee>1)P.warn(`External subtitle with id ${oe.id} has no periodId and the MPD contains more than one period. Unable to add the external subtitle as it is not clear which period shall be used.`);else if(ee===1)F(Le.Period[0],oe);else{const ae=Le.Period.find((ie=>ie.id===oe.periodId));ae?F(ae,oe):P.warn(`External subtitle with id ${oe.id} has periodId ${oe.periodId} but the MPD does not contain a period with that id. Unable to add the external subtitle.`)}}))})(Oe)})(Re),X(Re)}}function F(Ee,Re){if(!Ee||!Ee.AdaptationSet)return Ee;Ee.AdaptationSet.push(Re.serializeToMpdParserFormat())}function ve(){x=!1,ue()}function te(){x=!V.get().streaming.scheduling.scheduleWhilePaused,x&&le()}function ke(){q=!1}return C={getIsUpdating:function(){return q},initialize:function(){re(),p.on(u.default.STREAMS_COMPOSED,ke,this),p.on(d.default.PLAYBACK_STARTED,ve,this),p.on(d.default.PLAYBACK_PAUSED,te,this),p.on(u.default.INTERNAL_MANIFEST_LOADED,U,this)},refreshManifest:be,reset:function(){p.off(d.default.PLAYBACK_STARTED,ve,this),p.off(d.default.PLAYBACK_PAUSED,te,this),p.off(u.default.STREAMS_COMPOSED,ke,this),p.off(u.default.INTERNAL_MANIFEST_LOADED,U,this),re()},setConfig:function(Ee){Ee&&(Ee.manifestModel&&($=Ee.manifestModel),Ee.adapter&&(T=Ee.adapter),Ee.manifestLoader&&(D=Ee.manifestLoader),Ee.errHandler&&(N=Ee.errHandler),Ee.locationSelector&&(I=Ee.locationSelector),Ee.settings&&(V=Ee.settings),Ee.contentSteeringController&&(w=Ee.contentSteeringController),Ee.customParametersModel&&(A=Ee.customParametersModel))},setManifest:function(Ee){X(Ee)}},P=(0,c.default)(b).getInstance().getLogger(C),I=hm(b).create(),A=(0,so.default)(b).getInstance(),C}Bc.__dashjs_factory_name="ManifestUpdater";var Fc=n.default.getClassFactory(Bc);function Eo(){const b=this.context,p=(0,y.default)(b).getInstance();let v,T,w,A,N,C,x,B,q,I,P;function D(K){if(!(K&&K.currentRepresentation&&K.currentRepresentation.mediaInfo&&K.currentRepresentation.mediaInfo.type))return;const ge=K.currentRepresentation.mediaInfo.type;x[ge]=K.currentRepresentation}function $(K,ge){return K&&w[ge]&&w[ge][K]?w[ge][K].list:[]}function J(K,ge){return K&&w[ge]&&w[ge][K]?w[ge][K].current:null}function Z(K,ge={}){if(!K||!K.streamInfo)return;const _e=K.type,xe=K.streamInfo.id,Me=J(_e,xe);if(w[xe]&&w[xe][_e]&&(w[xe][_e].current=K,w[xe][_e].current&&(_e!==l.default.TEXT&&!le(K,Me)||_e===l.default.TEXT&&K.isFragmented)&&p.trigger(u.default.CURRENT_TRACK_CHANGED,{oldMediaInfo:Me,newMediaInfo:K,switchMode:A.get().streaming.trackSwitchMode[_e],options:ge},{streamId:xe}),!ge.hasOwnProperty("noSettingsSave")||!ge.noSettingsSave)){let Ne=(function(Ge){const Ze={lang:Ge.lang,viewpoint:Ge.viewpoint,roles:Ge.roles,accessibility:Ge.accessibility,audioChannelConfiguration:Ge.audioChannelConfiguration,codec:Ge.codec};return Ze.lang||Ze.viewpoint||Ze.role&&Ze.role.length>0||Ze.accessibility&&Ze.accessibility.length>0||Ze.audioChannelConfiguration&&Ze.audioChannelConfiguration.length>0?Ze:null})(K);if(!Ne||!w[xe][_e].storeLastSettings)return;Ne.roles&&(Ne.role=Ne.roles[0],delete Ne.roles),Ne.accessibility&&(Ne.accessibility=Ne.accessibility[0]),Ne.audioChannelConfiguration&&(Ne.audioChannelConfiguration=Ne.audioChannelConfiguration[0]),C[_e]=Ne,P.setSavedMediaSettings(_e,Ne)}}function V(K,ge){K&&ge&&(N[K]=ge)}function re(K){return K?N[K]:null}function le(K,ge){if(!K&&!ge)return!0;if(!K||!ge||K.isPreselection!==ge.isPreselection)return!1;const _e=K.id===ge.id,xe=JSON.stringify(K.viewpoint)===JSON.stringify(ge.viewpoint),Me=K.lang===ge.lang,Ne=K.codec===ge.codec,Ge=JSON.stringify(K.roles)===JSON.stringify(ge.roles),Ze=JSON.stringify(K.accessibility)===JSON.stringify(ge.accessibility),ht=JSON.stringify(K.audioChannelConfiguration)===JSON.stringify(ge.audioChannelConfiguration);return _e&&Ne&&xe&&Me&&Ge&&Ze&&ht}function ue(){w={},C={},x={},N={audio:null,video:null,text:null},p.off(d.default.REPRESENTATION_SWITCH,D,v)}function be(K,ge,_e){let xe=[];return K.forEach((function(Me){ge(_e,Me)&&xe.push(Me)})),xe.length!==0||ge===ve&&A.get().streaming.assumeDefaultRoleAsMain&&me(_e.role,{schemeIdUri:l.default.DASH_ROLE_SCHEME_ID,value:Se.default.MAIN})&&(T.info("no track with Role set to main - assuming main as default and searching again"),xe=be(K,te,null),xe.length!==0)?xe:(T.info("Filter-Function ("+ge.name+") resulted in no tracks; setting ignored"),K)}function X(K,ge){try{return!K.lang||K.lang instanceof RegExp?ge.lang.match(K.lang):ge.lang!==""&&go(ge.lang,cs(K.lang)).length>0}catch{return!1}}function G(K,ge){return K.index===void 0||K.index===null||ge.index===K.index}function U(K,ge){return K.id===void 0||K.id===null||ge.id===K.id}function F(K,ge){return!K.viewpoint||!!ge.viewpoint.filter((function(_e){return me(_e,K.viewpoint)}))[0]}function ve(K,ge,_e=!1){return!!ge.roles&&(!K.role||!!ge.roles.filter((function(xe){return me(xe,K.role)}))[0]||ge.type===l.default.AUDIO&&_e)}function te(K,ge){return!ge.roles||ge.roles.length===0}function ke(K,ge){let _e;return _e=K.accessibility?!!ge.accessibility.filter((function(xe){return me(xe,K.accessibility)}))[0]:!ge.accessibility.length,_e}function Ee(K,ge){return!K.audioChannelConfiguration||!!ge.audioChannelConfiguration.filter((function(_e){return me(_e,K.audioChannelConfiguration)}))[0]}function Re(K,ge){return!K.codec||K.codec===ge.codec}function Oe(K){let ge=0,_e=[];return K.forEach((xe=>{isNaN(xe.selectionPriority)||(xe.selectionPriority>ge?(ge=xe.selectionPriority,_e=[xe]):xe.selectionPriority===ge&&_e.push(xe))})),_e}function Le(K){let ge,_e=0,xe=[];return K.forEach((function(Me){ge=Math.max.apply(Math,Me.bitrateList.map((function(Ne){return Ne.bandwidth}))),ge>_e?(_e=ge,xe=[Me]):ge===_e&&xe.push(Me)})),xe}function Q(K){return K[0]&&K[0].type===l.default.VIDEO?(function(ge){let _e,xe=1/0,Me=[];return ge.forEach((function(Ne){_e=Ne.bitrateList.reduce((function(Ze,ht){const wt=Math.max(1,ht.width*ht.height);return Ze+ht.bandwidth/wt}),0)/Ne.bitrateList.length,_e<xe?(xe=_e,Me=[Ne]):_e===xe&&Me.push(Ne)})),Me})(K):K[0]&&K[0].type===l.default.AUDIO?(function(ge){let _e=1/0,xe=[];return ge.forEach((function(Me){let Ne=Me.audioChannelConfiguration.reduce((function(Ze,ht){return Ze+(cc(ht)||0)}),0)/Me.audioChannelConfiguration.length;Me.hasOwnProperty("supplementalProperties")&&Me.supplementalProperties.some((Ze=>Ze.schemeIdUri==="tag:dolby.com,2018:dash:EC3_ExtensionType:2018"&&Ze.value==="JOC"))&&(Ne=16),Ne||(Ne=1);let Ge=Me.bitrateList.reduce((function(Ze,ht){return Ze+ht.bandwidth/Ne}),0)/Me.bitrateList.length;Ge<_e?(_e=Ge,xe=[Me]):Ge===_e&&xe.push(Me)})),xe})(K):K}function ee(K){let ge,_e=0,xe=[];return K.forEach((function(Me){ge=Me.representationCount,ge>_e?(_e=ge,xe=[Me]):ge===_e&&xe.push(Me)})),xe}function oe(K,ge){if(K===l.default.TEXT)return(function(Me){if(!Me||Me.length===0)return null;const Ne=Me.filter((Ge=>!(Ge&&Ge.roles&&Ge.roles.length>0)||Ge.roles.every((Ze=>Ze.schemeIdUri!==l.default.DASH_ROLE_SCHEME_ID||Ze.value!==Se.default.FORCED_SUBTITLE))));return Ne.length>0?Ne[0]:Me[0]})(ge);let _e;const xe=B.getCustomInitialTrackSelectionFunction();if(_e=(function(Me){try{let Ne;return Ne=(function(Ge){try{const Ze=Ge.filter((ht=>{const wt=ht.type;return ht.bitrateList.some((Wt=>{const At=q.getAbrBitrateParameter("maxBitrate",wt),Vt=q.getAbrBitrateParameter("minBitrate",wt);return!(At>-1&&Wt.bandwidth>1e3*At||Vt>-1&&Wt.bandwidth<1e3*Vt)}))}));return Ze.length>0?Ze:Ge}catch(Ze){return T.error(Ze),Ge}})(Me),Ne=(function(Ge){try{if(!A.get().streaming.abr.limitBitrateByPortal)return Ge;const{elementWidth:Ze}=I.getVideoElementSize(),ht=Ge.filter((wt=>wt.type!==l.default.VIDEO||wt.bitrateList.some((Wt=>Wt.width<=Ze))));return ht.length>0?ht:Ge}catch(Ze){return T.error(Ze),Ge}})(Ne),Ne}catch(Ne){return T.error(Ne),Me}})(ge),xe&&typeof xe=="function")_e=xe(_e);else if(x[K])_e=(function(Me,Ne){if(!Me||Me.length===0||!Ne||!x[Ne])return Me;const Ge=x[Ne].bandwidth;if(!Ge||isNaN(Ge))return Me;let Ze={min:NaN,track:null};return Me.forEach((ht=>{ht.bitrateList.forEach((wt=>{const Wt=Math.abs(wt.bandwidth-Ge);(isNaN(Ze.min)||Wt<Ze.min)&&(Ze.min=Wt,Ze.track=ht)}))})),Ze.track?[Ze.track]:Me})(_e,K);else if(A.get().streaming.ignoreSelectionPriority||(T.info("Trying to find track with highest selectionPriority"),_e=(function(Me){return Oe(Me)})(_e)),_e.length>1&&A.get().streaming.prioritizeRoleMain&&(T.info("Trying to find a main track"),_e=be(_e,ve,{role:{schemeIdUri:l.default.DASH_ROLE_SCHEME_ID,value:Se.default.MAIN}})),_e.length>1){T.info("Selecting track based on selectionModeForInitialTrack");let Me=A.get().streaming.selectionModeForInitialTrack;switch(Me){case l.default.TRACK_SELECTION_MODE_HIGHEST_BITRATE:_e=(function(Ne){let Ge=Le(Ne);return Ge.length>1&&(Ge=ee(Ge)),Ge})(_e);break;case l.default.TRACK_SELECTION_MODE_FIRST_TRACK:_e=ae(_e);break;case l.default.TRACK_SELECTION_MODE_HIGHEST_EFFICIENCY:_e=ie(_e);break;case l.default.TRACK_SELECTION_MODE_WIDEST_RANGE:_e=(function(Ne){let Ge=ee(Ne);return Ge.length>1&&(Ge=Le(Ne)),Ge})(_e);break;case l.default.TRACK_SELECTION_MODE_LOWEST_STARTUP_DELAY:_e=(function(Ne){let Ge=Ne.filter((Ze=>!(!Ze.segmentSequenceProperties||Ze.segmentSequenceProperties.length===0)&&Ze.segmentSequenceProperties.some((ht=>ht.cadence===1&&(ht.sapType===0||ht.sapType===1)))));return ie(Ge.length>0?Ge:Ne)})(_e);break;default:T.warn(`Track selection mode ${Me} is not supported. Falling back to TRACK_SELECTION_MODE_FIRST_TRACK`),_e=ae(_e)}}return _e.length>0?_e[0]:ge[0]}function ae(K){return K[0]}function ie(K){let ge=Q(K);return ge.length>1&&(ge=Le(ge)),ge}function me(K,ge){return!(!K||!ge)&&JSON.stringify({schemeIdUri:K.schemeIdUri,value:K.value})===JSON.stringify({schemeIdUri:ge.schemeIdUri,value:ge.value})}return v={addTrack:function(K){if(!K)return;T.info("addTrack with track.codec='"+K.codec+"', track.type='"+K.type+"'");const ge=K.type;if((_e=ge)!==l.default.AUDIO&&_e!==l.default.VIDEO&&_e!==l.default.TEXT&&_e!==l.default.IMAGE)return;var _e;let xe=K.streamInfo.id;w[xe]||(w[xe]=(function(){const Ne=A.get().streaming.saveLastMediaSettingsForCurrentStreamingSession;return{audio:{list:[],storeLastSettings:Ne,current:null},video:{list:[],storeLastSettings:Ne,current:null},text:{list:[],storeLastSettings:Ne,current:null},image:{list:[],storeLastSettings:Ne,current:null}}})());const Me=w[xe][ge].list;for(let Ne=0,Ge=Me.length;Ne<Ge;++Ne)if(le(Me[Ne],K))return;Me.push(K)},areTracksEqual:le,clearDataForStream:function(K){w[K]&&delete w[K]},getCurrentTrackFor:J,getInitialSettings:re,getTracksFor:$,getTracksWithHighestSelectionPriority:Oe,getTracksWithHighestBitrate:Le,getTracksWithHighestEfficiency:Q,getTracksWithWidestRange:ee,initialize:function(){p.on(d.default.REPRESENTATION_SWITCH,D,v)},isCurrentTrack:function(K){if(!K)return!1;const ge=K.type,_e=K.streamInfo.id;return w[_e]&&w[_e][ge]&&le(w[_e][ge].current,K)},matchSettings:function(K,ge,_e=!1){try{let xe=!1;if(K.lang){if(K.lang instanceof RegExp)xe=ge.lang.match(K.lang);else if(ge.lang!==""){const wt=cs(K.lang);wt&&(xe=go(ge.lang,wt).length>0)}}else xe=!0;const Me=K.index===void 0||K.index===null||ge.index===K.index,Ne=!K.viewpoint||!!ge.viewpoint.filter((function(wt){return me(wt,K.viewpoint)}))[0],Ge=!K.role||!!ge.roles.filter((function(wt){return me(wt,K.role)}))[0];let Ze=!K.accessibility||!!ge.accessibility.filter((function(wt){return me(wt,K.accessibility)}))[0],ht=!K.audioChannelConfiguration||!!ge.audioChannelConfiguration.filter((function(wt){return me(wt,K.audioChannelConfiguration)}))[0];return xe&&Me&&Ne&&(Ge||ge.type===l.default.AUDIO&&_e)&&Ze&&ht}catch{return!1}},matchSettingsAccessibility:ke,matchSettingsAudioChannelConfig:Ee,matchSettingsIndex:G,matchSettingsLang:X,matchSettingsRole:ve,matchSettingsViewPoint:F,reset:ue,saveTextSettingsDisabled:function(){P.setSavedMediaSettings(l.default.TEXT,null)},selectInitialTrack:oe,setConfig:function(K){K&&(K.domStorage&&(P=K.domStorage),K.settings&&(A=K.settings),K.customParametersModel&&(B=K.customParametersModel),K.mediaPlayerModel&&(q=K.mediaPlayerModel),K.videoModel&&(I=K.videoModel))},setInitialMediaSettingsForType:function(K,ge){let _e=C[K]||re(K);const xe=$(K,ge.id);let Me=[];_e&&Object.keys(_e).length!==0||(_e=P.getSavedMediaSettings(K),_e&&delete _e.codec,V(K,_e)),xe&&xe.length!==0&&(Me=A.get().streaming.includePreselectionsForInitialTrackSelection?Array.from(xe):xe.filter((Ne=>!Ne.isPreselection)),_e&&(T.info("Filtering "+Me.length+" "+K+" tracks based on settings"),Me=be(Me,U,_e),Me=be(Me,X,_e),Me=be(Me,G,_e),Me=be(Me,F,_e),K===l.default.AUDIO&&C[K]||(Me=be(Me,ve,_e)),Me=be(Me,ke,_e),Me=be(Me,Ee,_e),Me=be(Me,Re,_e),T.info("Filtering "+K+" tracks ended, found "+Me.length+" matching track(s).")),Me.length>1?Z(oe(K,Me)):Z(Me[0]))},setInitialSettings:V,setTrack:Z},T=(0,c.default)(b).getInstance().getLogger(v),ue(),v}Eo.__dashjs_factory_name="MediaController";const qc=n.default.getSingletonFactory(Eo);n.default.updateSingletonFactory(Eo.__dashjs_factory_name,qc);var mm=qc;function jc(){let b,p,v,T;const w=this.context,A=(0,h.default)(w).getInstance();function N(I,P){return isNaN(I)?0:I>0?(P&&p.warn("Supplied minimum playback rate is a positive value when it should be negative or 0. The supplied rate will not be applied and set to 0: 100% playback speed."),0):I<-.5?(P&&p.warn("Supplied minimum playback rate is out of range and will be limited to -0.5: -50% playback speed."),-.5):I}function C(I,P){return isNaN(I)?0:I<0?(P&&p.warn("Supplied maximum playback rate is a negative value when it should be negative or 0. The supplied rate will not be applied and set to 0: 100% playback speed."),0):I>1?(P&&p.warn("Supplied maximum playback rate is out of range and will be limited to 1: 200% playback speed."),1):I}function x(){const I=B(),P=v.getLiveDelay();return!isNaN(P)&&P>0?Math.min(I,P):I}function B(){return A.get().streaming.buffer.bufferTimeDefault>0?A.get().streaming.buffer.bufferTimeDefault:q()?20:12}function q(){return A.get().streaming.buffer.fastSwitchEnabled!==null?A.get().streaming.buffer.fastSwitchEnabled:!v.getLowLatencyModeEnabled()}return b={getAbrBitrateParameter:function(I,P){try{const D=A.get().streaming.abr[I][P];if(!isNaN(D)&&D!==-1)return D;const $=T.getServiceDescriptionSettings();return $&&$[I]&&!isNaN($[I][P])?$[I][P]:-1}catch{return-1}},getBufferTimeDefault:x,getBufferTimeDefaultUnadjusted:B,getCatchupMaxDrift:function(){if(!isNaN(A.get().streaming.liveCatchup.maxDrift)&&A.get().streaming.liveCatchup.maxDrift>=0)return A.get().streaming.liveCatchup.maxDrift;const I=T.getServiceDescriptionSettings();return I&&I.liveCatchup&&!isNaN(I.liveCatchup.maxDrift)&&I.liveCatchup.maxDrift>=0?I.liveCatchup.maxDrift:12},getCatchupModeEnabled:function(){return A.get().streaming.liveCatchup.enabled!==null?A.get().streaming.liveCatchup.enabled:v.getInitialCatchupModeActivated()},getCatchupPlaybackRates:function(I){const P=A.get().streaming.liveCatchup.playbackRate;if(!isNaN(P.min)||!isNaN(P.max))return{min:N(P.min,I),max:C(P.max,I)};const D=T.getServiceDescriptionSettings();if(D&&D.liveCatchup&&(!isNaN(D.liveCatchup.playbackRate.min)||!isNaN(D.liveCatchup.playbackRate.max))){const $=D.liveCatchup.playbackRate;return{min:N($.min,I),max:C($.max,I)}}return{min:-.5,max:.5}},getFastSwitchEnabled:q,getInitialBufferLevel:function(){const I=A.get().streaming.buffer.initialBufferLevel;return isNaN(I)||I<0?0:Math.min(x(),I)},getRetryAttemptsForType:function(I){const P=isNaN(A.get().streaming.retryAttempts.lowLatencyMultiplyFactor)?5:A.get().streaming.retryAttempts.lowLatencyMultiplyFactor;return v.getLowLatencyModeEnabled()?A.get().streaming.retryAttempts[I]*P:A.get().streaming.retryAttempts[I]},getRetryIntervalsForType:function(I){const P=isNaN(A.get().streaming.retryIntervals.lowLatencyReductionFactor)?10:A.get().streaming.retryIntervals.lowLatencyReductionFactor;return v.getLowLatencyModeEnabled()?A.get().streaming.retryIntervals[I]/P:A.get().streaming.retryIntervals[I]},getScheduleTimeout:function(){return v.getLowLatencyModeEnabled()?A.get().streaming.scheduling.lowLatencyTimeout:A.get().streaming.scheduling.defaultTimeout},reset:function(){},setConfig:function(I){I.playbackController&&(v=I.playbackController),I.serviceDescriptionController&&(T=I.serviceDescriptionController)}},p=(0,c.default)(w).getInstance().getLogger(b),b}jc.__dashjs_factory_name="MediaPlayerModel";var gm=n.default.getSingletonFactory(jc);function Hc(){const b=this.context,p=(0,y.default)(b).getInstance();let v,T,w,A,N,C,x,B,q,I,P,D,$,J,Z,V,re,le,ue,be,X,G,U,F;function ve(){Re(),Z=!1,I=0,J=0,T=0,$=!1,D=!1,A=!1,re=NaN,q=NaN,U&&(p.off(u.default.DATA_UPDATE_COMPLETED,Ne,N),p.off(u.default.MANIFEST_UPDATED,Qe,N),p.off(u.default.STREAMS_COMPOSED,bt,N),p.off(d.default.PLAYBACK_ENDED,Kt,N),p.off(d.default.STREAM_INITIALIZING,Ut,N),p.off(d.default.REPRESENTATION_SWITCH,je,N),p.off(d.default.BUFFER_LEVEL_STATE_CHANGED,ht,N),Me(),U.removeEventListener("canplay",Ge),U.removeEventListener("canplaythrough",Ze),U.removeEventListener("ended",gt),U.removeEventListener("error",gn),U.removeEventListener("loadeddata",pt),U.removeEventListener("loadedmetadata",We),U.removeEventListener("pause",Vt),U.removeEventListener("play",wt),U.removeEventListener("playing",At),U.removeEventListener("progress",cn),U.removeEventListener("ratechange",pn),U.removeEventListener("seeked",kn),U.removeEventListener("seeking",on),U.removeEventListener("stalled",_t),U.removeEventListener("timeupdate",vn),U.removeEventListener("volumechange",St),U.removeEventListener("waiting",Wt)),F=null,U=null,X=null,x=null}function te(Je=null){return parseFloat((ke(Je)-ee()).toFixed(5))}function ke(Je){const Rt=Je||X;return Rt.start+Rt.duration}function Ee(Je=!1){X&&U&&U.getElement()?(Je&&x&&Q(ee()),U.play()):Z=!0}function Re(){X&&U&&U.pause()}function Oe(Je,Rt=!1,Lt=!1,Ce=!1){X&&U&&U.getElement()&&Je!==(isNaN(re)?U.getTime():re)&&(C=Lt===!0,C||(re=Je),P.info("Requesting seek to time: "+Je+(C?" (internal)":"")),x&&Ce&&Q(Je),U.setCurrentTime(Je,Rt))}function Le(){if(!X||!U||!x)return;const Je=be&&be.hasVideoTrack()?l.default.VIDEO:l.default.AUDIO,Rt=w.getCurrentDVRInfo(Je);return Rt&&Rt.range?Rt.range.end:0}function Q(Je){const Rt=new Date(G.getClientReferenceTime()),Lt=v.getRegularPeriods()[0];I=G.calcPresentationTimeFromWallTime(Rt,Lt)-Je}function ee(){return X&&U?U.getTime():null}function oe(){return X&&U?U.isPaused():null}function ae(){return X&&U?U.isSeeking():null}function ie(){return X&&U?U.isStalled():null}function me(){return X&&U?U.getPlaybackRate():null}function K(){return X&&U?U.getEnded():null}function ge(){return x}function _e(Je=null){if(oe()||!x||U.getReadyState()===0||ae()||$)return;Je||(Je=be.hasVideoTrack()?l.default.VIDEO:l.default.AUDIO);const Rt=ee(),Lt=(function(Ce,rt){const Pt=w.getCurrentDVRInfo(rt),zt=Pt?Pt.range:null;let yn;return zt?(yn=Ce>zt.end?Math.max(zt.end-I,zt.start):Ce>0&&Ce+.25<zt.start&&Math.abs(Ce-zt.start)<31536e4?D?Math.max(zt.end-I,zt.start):zt.start:Ce,yn):NaN})(Rt,Je);!isNaN(Lt)&&Lt!==Rt&&!ae()&&(ie()||V||U.getReadyState()===1)&&(P.debug(`UpdateCurrentTime: Seek to actual time: ${Lt} from currentTime: ${Rt}`),Oe(Lt,!1,!1))}function xe(){F===null&&(F=setInterval((()=>{(function(){if(p.trigger(u.default.WALLCLOCK_TIME_UPDATED,{isDynamic:x,time:new Date}),ge()){const Je=Date.now();(isNaN(q)||Je>q+ue.get().streaming.liveUpdateTimeThresholdInMilliseconds)&&(be.addDVRMetric(),oe()?(function(){const Rt=Date.now();(!B||Rt>B+500)&&(B=Rt,vn())})():_e(),q=Je)}})()}),ue.get().streaming.wallclockTimeUpdateInterval))}function Me(){clearInterval(F),F=null}function Ne(Je){const Rt=Je.currentRepresentation,Lt=Rt?Rt.mediaInfo.streamInfo:null;Lt!==null&&X.id===Lt.id&&(X=Lt)}function Ge(){p.trigger(u.default.CAN_PLAY)}function Ze(){p.trigger(u.default.CAN_PLAY_THROUGH)}function ht(Je){Je.streamId===be.getActiveStreamInfo().id&&(V=Je.state===i.BUFFER_EMPTY,ue.get().streaming.buffer.setStallState&&U.setStallState(Je.mediaType,Je.state===i.BUFFER_EMPTY))}function wt(){P.info("Native video element event: play"),_e(),xe(),p.trigger(u.default.PLAYBACK_STARTED,{startTime:ee()})}function Wt(){P.info("Native video element event: waiting"),p.trigger(u.default.PLAYBACK_WAITING,{playingTime:ee()})}function At(){P.info("Native video element event: playing"),C=!1,p.trigger(u.default.PLAYBACK_PLAYING,{playingTime:ee()})}function Vt(){P.info("Native video element event: pause"),p.trigger(u.default.PLAYBACK_PAUSED,{ended:K()})}function on(){if(C)return;let Je=ee();isNaN(re)||re===Je||(Je=re),re=NaN,P.info("Seeking to: "+Je),xe(),p.trigger(u.default.PLAYBACK_SEEKING,{seekTime:Je,streamId:X.id})}function kn(){P.info("Native video element event: seeked"),C=!1,p.trigger(u.default.PLAYBACK_SEEKED,{streamId:X.id})}function vn(){X&&p.trigger(u.default.PLAYBACK_TIME_UPDATED,{timeToEnd:te(),time:ee(),streamId:X.id})}function cn(){p.trigger(u.default.PLAYBACK_PROGRESS,{streamId:X.id})}function pn(){const Je=me();P.info("Native video element event: ratechange: ",Je),p.trigger(u.default.PLAYBACK_RATE_CHANGED,{playbackRate:Je})}function We(){P.info("Native video element event: loadedmetadata"),p.trigger(u.default.PLAYBACK_METADATA_LOADED),xe()}function pt(){P.info("Native video element event: loadeddata"),p.trigger(u.default.PLAYBACK_LOADED_DATA)}function gt(){P.info("Native video element event: ended"),Re(),Me();const Je=be?be.getActiveStreamInfo():null;Je&&p.trigger(u.default.PLAYBACK_ENDED,{isLast:Je.isLast})}function St(){p.trigger(u.default.PLAYBACK_VOLUME_CHANGED)}function Kt(Je){if(F&&Je.isLast){P.info("onPlaybackEnded -- PLAYBACK_ENDED but native video element didn't fire ended");const Rt=Je.seekTime?Je.seekTime:ke();U.setCurrentTime(Rt),Re(),Me()}}function gn(Je){const Rt=Je.target||Je.srcElement;p.trigger(u.default.PLAYBACK_ERROR,{error:Rt.error})}function ot(){x=!1}function _t(Je){p.trigger(u.default.PLAYBACK_STALLED,{e:Je})}function Ut(Je){var Rt;(Rt=Je.mediaInfo)&&Rt.supplementalProperties&&Rt.supplementalProperties.find((Lt=>Lt.schemeIdUri===l.default.SUPPLEMENTAL_PROPERTY_DVB_LL_SCHEME))&&(P.debug("Low Latency critical SupplementalProperty set: Enabling low Latency"),D=!0)}function je(Je){const Rt=be.getActiveStreamInfo();Je&&Rt&&Je.currentRepresentation&&Je.streamId&&Je.streamId===Rt.id&&Je.mediaType&&(Je.mediaType===l.default.VIDEO||Je.mediaType===l.default.AUDIO)&&(D=Je.currentRepresentation.availabilityTimeComplete===!1,D&&!A&&(A=!0))}function Qe(){$=!0}function bt(){$=!1}return N={computeAndSetLiveDelay:function(Je,Rt){let Lt,Ce,rt;const Pt=!isNaN(Je)&&isFinite(Je)?Je:NaN;let zt=v.getSuggestedPresentationDelay();const yn=le.getServiceDescriptionSettings();return Lt=isNaN(ue.get().streaming.delay.liveDelay)?ue.get().streaming.delay.liveDelayFragmentCount===null||isNaN(ue.get().streaming.delay.liveDelayFragmentCount)||isNaN(Pt)?yn&&!isNaN(yn.liveDelay)&&yn.liveDelay>0?yn.liveDelay:ue.get().streaming.delay.useSuggestedPresentationDelay===!0&&zt!==null&&!isNaN(zt)&&zt>0?zt:isNaN(Pt)?Rt&&!isNaN(Rt.minBufferTime)?4*Rt.minBufferTime:4*X.manifestInfo.minBufferTime:4*Pt:Pt*ue.get().streaming.delay.liveDelayFragmentCount:ue.get().streaming.delay.liveDelay,rt=v.getAvailabilityStartTime(),rt!==null&&(T=rt),Ce=Rt&&Rt.dvrWindowSize>0?Math.min(Lt,Rt.dvrWindowSize):Lt,I=Ce,J=Ce,Ce},getAvailabilityStartTime:function(){return T},getBufferLevel:function(Je=null){let Rt=null;return be.getActiveStreamProcessors().forEach((Lt=>{if(!Je||Je.length===0||Je.indexOf(Lt.getType())===-1){const Ce=Lt.getBufferLevel();Rt=Rt===null?Ce:Math.min(Rt,Ce)}})),Rt},getCurrentLiveLatency:function(){if(!x||isNaN(T))return NaN;let Je=ee();if(isNaN(Je)||Je===0)return 0;const Rt=new Date().getTime()+1e3*G.getClientTimeOffset();return Math.max(((Rt-T-1e3*Je)/1e3).toFixed(3),0)},getEnded:K,getInitialCatchupModeActivated:function(){return A},getIsDynamic:ge,getIsManifestUpdateInProgress:function(){return $},getLiveDelay:function(){return I},getLowLatencyModeEnabled:function(){return D},getOriginalLiveDelay:function(){return J},getPlaybackRate:me,getPlaybackStalled:function(){return V},getPlayedRanges:function(){return X&&U?U.getPlayedRanges():null},getStreamController:function(){return be},getStreamEndTime:ke,getTime:ee,getTimeToStreamEnd:te,initialize:function(Je,Rt){X=Je,Rt!==!0&&(U.addEventListener("canplay",Ge),U.addEventListener("canplaythrough",Ze),U.addEventListener("ended",gt),U.addEventListener("error",gn),U.addEventListener("loadeddata",pt),U.addEventListener("loadedmetadata",We),U.addEventListener("pause",Vt),U.addEventListener("play",wt),U.addEventListener("playing",At),U.addEventListener("progress",cn),U.addEventListener("ratechange",pn),U.addEventListener("seeked",kn),U.addEventListener("seeking",on),U.addEventListener("stalled",_t),U.addEventListener("timeupdate",vn),U.addEventListener("volumechange",St),U.addEventListener("waiting",Wt),x=X.manifestInfo.isDynamic,V=!1,C=!1,p.on(u.default.DATA_UPDATE_COMPLETED,Ne,N),p.on(u.default.MANIFEST_UPDATED,Qe,N),p.on(u.default.STREAMS_COMPOSED,bt,N),p.on(d.default.PLAYBACK_ENDED,Kt,N,{priority:y.default.EVENT_PRIORITY_HIGH}),p.on(d.default.STREAM_INITIALIZING,Ut,N),p.on(d.default.REPRESENTATION_SWITCH,je,N),p.on(d.default.BUFFER_LEVEL_STATE_CHANGED,ht,N),p.on(d.default.DYNAMIC_TO_STATIC,ot,N),Z&&(Z=!1,Ee()))},isPaused:oe,isProgressing:function(Je=500){return new Promise((Rt=>{let Lt=-1,Ce=null;const rt=zt=>{clearTimeout(Ce),Ce=null,p.off(d.default.PLAYBACK_TIME_UPDATED,Pt,N),Rt(zt)},Pt=zt=>{Lt<0?Lt=zt.time:zt.time>Lt+.1&&rt(!0)};Ce=setTimeout((()=>{rt(!1)}),Je),p.on(d.default.PLAYBACK_TIME_UPDATED,Pt,N)}))},isSeeking:ae,isStalled:ie,pause:Re,play:Ee,reset:ve,seek:Oe,seekToCurrentLive:function(Je=!1,Rt=!1,Lt=!1){const Ce=Le();Ce!==0&&Oe(Ce-I,Je,Rt,Lt)},seekToOriginalLive:function(Je=!1,Rt=!1,Lt=!1){const Ce=Le();Ce!==0&&(I=J,Oe(Ce-I,Je,Rt,Lt))},setConfig:function(Je){Je&&(Je.streamController&&(be=Je.streamController),Je.serviceDescriptionController&&(le=Je.serviceDescriptionController),Je.dashMetrics&&(w=Je.dashMetrics),Je.adapter&&(v=Je.adapter),Je.videoModel&&(U=Je.videoModel),Je.timelineConverter&&(G=Je.timelineConverter),Je.settings&&(ue=Je.settings))},updateCurrentTime:_e},P=(0,c.default)(b).getInstance().getLogger(N),ve(),N}Hc.__dashjs_factory_name="PlaybackController";var pm=n.default.getSingletonFactory(Hc),Gc=class{constructor(){this.availabilityEndTime=NaN,this.availabilityStartTime=NaN,this.duration=NaN,this.index=null,this.indexRange=null,this.isPartialSegment=!1,this.media=null,this.mediaRange=null,this.mediaUrl=null,this.mediaStartTime=NaN,this.presentationStartTime=NaN,this.replacementNumber=NaN,this.replacementTime=null,this.representation=null,this.wallStartTime=NaN}assignAttributes(b){for(let p in b)b.hasOwnProperty(p)&&this.hasOwnProperty(p)&&(this[p]=b[p])}},vo=class extends Gc{constructor(){super()}};function Yc(){const b=this.context;let p,v,T,w,A,N,C,x,B,q,I,P;function D(V,re,le,ue){let be=null;const X=V?P.resolve(V.path):null,G=ue||{init:!0,url:X?X.url:void 0,range:{start:0,end:1500},searching:!1,bytesLoaded:0,bytesToLoad:1500,mediaType:re,representation:V};v.debug("Start searching for initialization.");const U=Z(G);C.load({request:U,success:function(F){if(G.bytesLoaded=G.range.end,be=w.findInitRange(F),!be)return G.range.end=G.bytesLoaded+G.bytesToLoad,D(V,re,le,G);V.range=be,le(V)},error:function(){le(V)}}),v.debug("Perform init search: "+G.url)}function $(V,re,le,ue,be,X){if(le&&(le.start===void 0||le.end===void 0)){const Ee=le?le.toString().split("-"):null;le=Ee?{start:parseFloat(Ee[0]),end:parseFloat(Ee[1])}:null}be=be||J;let G=null,U=null;const F=!!le,ve=V?P.resolve(V.path):null,te={init:!1,url:ve?ve.url:void 0,range:F?le:{start:0,end:1500},searching:!F,bytesLoaded:X?X.bytesLoaded:0,bytesToLoad:1500,mediaType:re,representation:V},ke=Z(te);C.load({request:ke,success:function(Ee){const Re=te.bytesToLoad,Oe=Ee.byteLength;if(te.bytesLoaded=te.range.end-te.range.start,G=w.parse(Ee),U=G.getBox("sidx"),U&&U.isComplete){const Le=U.references;let Q,ee;if(Le!=null&&Le.length>0&&(Q=Le[0].reference_type===1),Q){let oe,ae,ie,me,K;v.debug("Initiate multiple SIDX load."),te.range.end=te.range.start+U.size;let ge=[],_e=0,xe=(U.offset||te.range.start)+U.size;const Me=function(Ne){Ne?(ge=ge.concat(Ne),_e++,_e>=ae&&(ge.sort((function(Ge,Ze){return Ge.startTime-Ze.startTime<0?-1:0})),be(ge,V,ue))):be(null,V,ue)};for(oe=0,ae=Le.length;oe<ae;oe++)ie=xe,me=xe+Le[oe].referenced_size-1,xe+=Le[oe].referenced_size,K={start:ie,end:me},$(V,re,K,ue,Me,te)}else v.debug("Parsing segments from SIDX. representation "+re+" - id: "+V.id+" for range : "+te.range.start+" - "+te.range.end),ee=(function(oe,ae){const ie=oe.references,me=ie.length,K=oe.timescale;let ge=oe.earliest_presentation_time,_e=ae.range.start+oe.offset+oe.first_offset+oe.size;const xe=[];let Me,Ne,Ge,Ze;for(let ht=0;ht<me;ht++)Ge=ie[ht].subsegment_duration,Ze=ie[ht].referenced_size,Me=new vo,Me.duration=Ge,Me.startTime=ge,Me.timescale=K,Ne=_e+Ze-1,Me.mediaRange=_e+"-"+Ne,xe.push(Me),ge+=Ge,_e+=Ze;return xe})(U,te),be(ee,V,ue)}else{if(U)te.range.start=U.offset||te.range.start,te.range.end=te.range.start+(U.size||Re);else{if(Oe<te.bytesLoaded)return void be(null,V,ue);{const Le=G.getLastBox();Le&&Le.size?(te.range.start=Le.offset+Le.size,te.range.end=te.range.start+Re):te.range.end+=Re}}$(V,re,te.range,ue,null,te)}},error:function(){be(null,V,ue)}}),v.debug(`Perform SIDX load for type ${re} : ${te.url} with range ${te.range.start} - ${te.range.end}`)}function J(V,re,le){le({segments:V,representation:re,error:V?void 0:new Bt.default(x.SEGMENT_BASE_LOADER_ERROR_CODE,x.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})}function Z(V){if(!V.url)return;const re=new ne;return re.setInfo(V),re}return p={setConfig:function(V){V.baseURLController&&(P=V.baseURLController),V.dashMetrics&&(A=V.dashMetrics),V.mediaPlayerModel&&(N=V.mediaPlayerModel),V.errHandler&&(T=V.errHandler),V.boxParser&&(w=V.boxParser),V.debug&&(v=V.debug.getLogger(p)),V.errors&&(x=V.errors),V.urlUtils&&(I=V.urlUtils),V.constants&&(B=V.constants),V.dashConstants&&(q=V.dashConstants)},initialize:function(){C=ri(b).create({errHandler:T,dashMetrics:A,mediaPlayerModel:N,boxParser:w,errors:x,urlUtils:I,constants:B,dashConstants:q})},loadInitialization:function(V,re){return new Promise((le=>{D(V,re,le)}))},loadSegments:function(V,re,le){return new Promise((ue=>{$(V,re,le,ue)}))},reset:function(){C&&(C.abort(),C=null)}},p}Yc.__dashjs_factory_name="SegmentBaseLoader";var ym=n.default.getSingletonFactory(Yc);function Kc(b){let p;b=b||{};let v=new DataView(b.data),T=0;function w(N,C){let x,B,q=!0,I=0;if(C===void 0&&(C=!1),N.tag>16777215?(v.getUint32(T)!==N.tag&&(q=!1),I=4):N.tag>65535?(x=v.getUint16(T),B=v.getUint8(T+2),256*x+B!==N.tag&&(q=!1),I=3):N.tag>255?(v.getUint16(T)!==N.tag&&(q=!1),I=2):(v.getUint8(T)!==N.tag&&(q=!1),I=1),!q&&N.required&&!C)throw new Error("required tag not found");return q&&(T+=I),q}function A(N){let C=1,x=128,B=-1,q=0,I=v.getUint8(T),P=0;for(P=0;P<8;P+=1){if((I&x)===x){q=N===void 0?I&~x:I,B=P;break}x>>=1}for(P=0;P<B;P+=1,C+=1)q=q<<8|255&v.getUint8(T+C);return T+=C,q}return p={getPos:function(){return T},setPos:function(N){T=N},consumeTag:w,consumeTagAndSize:function(N,C){let x=w(N,C);return x&&A(),x},parseTag:function(N){let C;return w(N),C=A(),p[N.parse](C)},skipOverElement:function(N,C){let x,B=w(N,C);return B&&(x=A(),T+=x),B},getMatroskaCodedNum:A,getMatroskaFloat:function(N){let C;switch(N){case 4:C=v.getFloat32(T),T+=4;break;case 8:C=v.getFloat64(T),T+=8}return C},getMatroskaUint:function(N){if(N>4)return(function(x){const B=Math.floor(Number.MAX_SAFE_INTEGER/256);let q=0;for(let I=0;I<x;I+=1){if(q>B)throw new Error("Value exceeds safe integer limit");q*=256;const P=v.getUint8(T+I);if(q>Number.MAX_SAFE_INTEGER-P)throw new Error("Value exceeds safe integer limit");q+=P}return T+=x,q})(N);let C=0;for(let x=0;x<N;x+=1)C<<=8,C|=255&v.getUint8(T+x);return T+=N,C>>>0},moreData:function(){return T<v.byteLength}},p}Kc.__dashjs_factory_name="EBMLParser";var $c=n.default.getClassFactory(Kc);function Vc(){const b=this.context;let p,v,T,w,A,N,C,x,B;function q(I){const P=new ne;return P.setInfo(I),P}return p={setConfig:function(I){if(!(I.baseURLController&&I.dashMetrics&&I.mediaPlayerModel&&I.errHandler))throw new Error(l.default.MISSING_CONFIG_ERROR);B=I.baseURLController,A=I.dashMetrics,N=I.mediaPlayerModel,w=I.errHandler,x=I.errors,v=I.debug.getLogger(p)},initialize:function(){C=ri(b).create({errHandler:w,dashMetrics:A,mediaPlayerModel:N,errors:x})},loadInitialization:function(I,P){return new Promise((D=>{let $=null,J=I?B.resolve(I.path):null,Z=I?I.range.split("-"):null,V={range:{start:Z?parseFloat(Z[0]):null,end:Z?parseFloat(Z[1]):null},request:$,url:J?J.url:void 0,init:!0,mediaType:P};v.info("Start loading initialization."),$=q(V),C.load({request:$,success:function(){D(I)},error:function(){D(I)}}),v.debug("Perform init load: "+V.url)}))},loadSegments:function(I,P,D){return new Promise(($=>{let J=null,Z=I?B.resolve(I.path):null,V=Z?Z.url:void 0;J=q({bytesLoaded:0,bytesToLoad:8192,range:{start:0,end:8192},request:J,url:V,init:!1,mediaType:P,representation:I}),v.debug("Parsing ebml header"),C.load({request:J,success:function(re){(function(le,ue,be,X){if(!le||le.byteLength===0)return void X(null);let G,U,F,ve,te=$c(b).create({data:le}),ke=be?be.split("-"):null,Ee=null,Re={url:ue,range:{start:ke?parseFloat(ke[0]):null,end:ke?parseFloat(ke[1]):null},request:Ee};for(v.debug("Parse EBML header: "+Re.url),te.skipOverElement(T.EBML),te.consumeTag(T.Segment),F=te.getMatroskaCodedNum(),F+=te.getPos(),ve=te.getPos();te.moreData()&&!te.consumeTagAndSize(T.Segment.Info,!0);)if(!(te.skipOverElement(T.Segment.SeekHead,!0)||te.skipOverElement(T.Segment.Tracks,!0)||te.skipOverElement(T.Segment.Cues,!0)||te.skipOverElement(T.Void,!0)))throw new Error("no valid top level element found");for(;G===void 0;){let Oe=te.getMatroskaCodedNum(!0),Le=te.getMatroskaCodedNum();Oe===T.Segment.Info.Duration.tag?G=te[T.Segment.Info.Duration.parse](Le):te.setPos(te.getPos()+Le)}Ee=q(Re),C.load({request:Ee,success:function(Oe){U=(function(Le,Q,ee,oe){let ae,ie,me,K,ge,_e,xe,Me;for(ie=(function(Ne){let Ge,Ze,ht=[],wt=$c(b).create({data:Ne});for(wt.consumeTagAndSize(T.Segment.Cues);wt.moreData()&&wt.consumeTagAndSize(T.Segment.Cues.CuePoint,!0);){for(Ge={},Ge.CueTime=wt.parseTag(T.Segment.Cues.CuePoint.CueTime),Ge.CueTracks=[];wt.moreData()&&wt.consumeTag(T.Segment.Cues.CuePoint.CueTrackPositions,!0);){const Wt=wt.getMatroskaCodedNum(),At=wt.getPos();if(Ze={},Ze.Track=wt.parseTag(T.Segment.Cues.CuePoint.CueTrackPositions.CueTrack),Ze.Track===0)throw new Error("Cue track cannot be 0");Ze.ClusterPosition=wt.parseTag(T.Segment.Cues.CuePoint.CueTrackPositions.CueClusterPosition),Ge.CueTracks.push(Ze),wt.setPos(At+Wt)}if(Ge.CueTracks.length===0)throw new Error("Mandatory cuetrack not found");ht.push(Ge)}if(ht.length===0)throw new Error("mandatory cuepoint not found");return ht})(Le),me=[],ge=0,_e=ie.length;ge<_e;ge+=1)K=new vo,ae=0,ae=ge<ie.length-1?ie[ge+1].CueTime-ie[ge].CueTime:oe-ie[ge].CueTime,K.duration=ae,K.startTime=ie[ge].CueTime,K.timescale=1e3,xe=ie[ge].CueTracks[0].ClusterPosition+Q,Me=ge<ie.length-1?ie[ge+1].CueTracks[0].ClusterPosition+Q-1:ee-1,K.mediaRange=xe+"-"+Me,me.push(K);return v.debug("Parsed cues: "+me.length+" cues."),me})(Oe,ve,F,G),X(U)},error:function(){v.error("Download Error: Cues "+Re.url),X(null)}}),v.debug("Perform cues load: "+Re.url+" bytes="+Re.range.start+"-"+Re.range.end)})(re,V,D,(function(le){$({segments:le,representation:I,error:le?void 0:new Bt.default(x.SEGMENT_BASE_LOADER_ERROR_CODE,x.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})}))},error:function(){$({representation:I,error:new Bt.default(x.SEGMENT_BASE_LOADER_ERROR_CODE,x.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})}})}))},reset:function(){C&&(C.abort(),C=null)}},T={EBML:{tag:440786851,required:!0},Segment:{tag:408125543,required:!0,SeekHead:{tag:290298740,required:!0},Info:{tag:357149030,required:!0,TimecodeScale:{tag:2807729,required:!0,parse:"getMatroskaUint"},Duration:{tag:17545,required:!0,parse:"getMatroskaFloat"}},Tracks:{tag:374648427,required:!0},Cues:{tag:475249515,required:!0,CuePoint:{tag:187,required:!0,CueTime:{tag:179,required:!0,parse:"getMatroskaUint"},CueTrackPositions:{tag:183,required:!0,CueTrack:{tag:247,required:!0,parse:"getMatroskaUint"},CueClusterPosition:{tag:241,required:!0,parse:"getMatroskaUint"}}}}},Void:{tag:236,required:!0}},p}Vc.__dashjs_factory_name="WebmSegmentBaseLoader";var bm=n.default.getSingletonFactory(Vc);function Wc(b){b=b||{};const p=this.context,v=b.eventBus,T=b.events,w=b.dashMetrics,A=b.mediaPlayerModel,N=b.errHandler,C=b.baseURLController,x=b.debug,B=b.boxParser,q=b.errors;let I,P,D;function $(J){return(J?J.split("/")[1]:"").toLowerCase()==="webm"}return I={initialize:function(){P.initialize(),D.initialize()},getSegmentBaseInitSegment:function(J){return $(J.representation.mimeType)?D.loadInitialization(J.representation,J.mediaType):P.loadInitialization(J.representation,J.mediaType)},getSegmentList:function(J){return $(J.mimeType)?D.loadSegments(J.representation,J.mediaType,J.representation?J.representation.indexRange:null):P.loadSegments(J.representation,J.mediaType,J.representation?J.representation.indexRange:null)},reset:function(){P.reset(),D.reset()}},P=ym(p).getInstance(),D=bm(p).getInstance(),P.setConfig({baseURLController:C,dashMetrics:w,mediaPlayerModel:A,errHandler:N,eventBus:v,events:T,errors:q,debug:x,boxParser:B}),D.setConfig({baseURLController:C,dashMetrics:w,mediaPlayerModel:A,errHandler:N,eventBus:v,events:T,errors:q,debug:x}),I}Wc.__dashjs_factory_name="SegmentBaseController";var Em=n.default.getSingletonFactory(Wc);const vm=[l.default.SERVICE_DESCRIPTION_DVB_LL_SCHEME],Qc="video",Xc="audio";function Jc(){const b=this.context;let p,v,T,w,A;function N(){v={liveDelay:NaN,liveCatchup:{maxDrift:NaN,playbackRate:{min:NaN,max:NaN}},minBitrate:{},maxBitrate:{},initialBitrate:{},contentSteering:null,clientDataReporting:null},T=[]}function C(x,B,q){try{v[x][B]=q/1e3}catch(I){w.error(I)}}return p={getServiceDescriptionSettings:function(){return v},getProducerReferenceTimeOffsets:function(){return T},calculateProducerReferenceTimeOffsets:function(x){try{let B=[];if(x&&x.length>0){const q=[l.default.VIDEO,l.default.AUDIO,l.default.TEXT],I=A.getAvailabilityStartTime()/1e3;x.forEach((P=>{const D=q.reduce((($,J)=>$.concat(A.getAllMediaInfoForType(P,J))),[]).reduce((($,J)=>(A.getProducerReferenceTimes(P,J).forEach((Z=>{const V=A.getVoRepresentations(J);if(V&&V.length>0&&V[0].adaptation&&V[0].segmentInfoType===Se.default.SEGMENT_TEMPLATE){const re=V[0],le=new Date(Z[Se.default.WALL_CLOCK_TIME]).getTime()/1e3-(Z[Se.default.PRESENTATION_TIME]/re[Se.default.TIMESCALE]-re[Se.default.PRESENTATION_TIME_OFFSET]+P.start),ue=I-le;$.push({id:Z[Se.default.ID],to:ue})}})),$)),[]);B=B.concat(D)}))}T=B}catch(B){w.error(B),T=[]}},applyServiceDescription:function(x){if(!x||!x.serviceDescriptions)return;const B=x.serviceDescriptions.filter((P=>vm.includes(P.schemeIdUri))),q=x.serviceDescriptions.filter((P=>P.schemeIdUri==null));let I=B.length>0?B[B.length-1]:q[q.length-1];I&&(I.latency&&I.latency.target>0&&(function(P){let D;if(P.schemeIdUri,l.default.SERVICE_DESCRIPTION_DVB_LL_SCHEME,D=(function($){return{liveDelay:$.latency.target/1e3,maxDrift:!isNaN($.latency.max)&&$.latency.max>$.latency.target?($.latency.max-$.latency.target+500)/1e3:NaN,referenceId:$.latency.referenceId||NaN}})(P),T.length>0){let{to:$,id:J}=(function(Z){let V,re=0,le=T.filter((ue=>ue.id===Z.referenceId));return le.length===0?(re=T.length>0?T[0].to:0,V=T[0].id||NaN):(re=le[0].to||0,V=le[0].id||NaN),{to:re,id:V}})(D);v.liveDelay=D.liveDelay-$,v.liveCatchup.maxDrift=D.maxDrift,w.debug(`
                Found latency properties coming from service description. Applied time offset of ${$} from ProducerReferenceTime element with id ${J}.
                Live Delay: ${D.liveDelay-$}, Live catchup max drift: ${D.maxDrift}
            `)}else v.liveDelay=D.liveDelay,v.liveCatchup.maxDrift=D.maxDrift,w.debug(`Found latency properties coming from service description: Live Delay: ${D.liveDelay}, Live catchup max drift: ${D.maxDrift}`)})(I),I.playbackRate&&(function(P){const D=P.playbackRate.min?Math.round(1e3*(P.playbackRate.min-1))/1e3:NaN,$=P.playbackRate.max?Math.round(1e3*(P.playbackRate.max-1))/1e3:NaN;v.liveCatchup.playbackRate.min=D,v.liveCatchup.playbackRate.max=$,w.debug(`Found latency properties coming from service description: Live catchup min playback rate: ${D}`),w.debug(`Found latency properties coming from service description: Live catchup max playback rate: ${$}`)})(I),I.operatingQuality,I.operatingBandwidth&&(function(P){if(!P||!P.operatingBandwidth||!P.operatingBandwidth.mediaType||P.operatingBandwidth.mediaType==="all")return;const D={};D.minBandwidth=P.operatingBandwidth.min,D.maxBandwidth=P.operatingBandwidth.max,D.targetBandwidth=P.operatingBandwidth.target;const $=[];P.operatingBandwidth.mediaType===Qc||P.operatingBandwidth.mediaType===Xc?$.push(P.operatingBandwidth.mediaType):P.operatingBandwidth.mediaType==="any"&&($.push(Xc),$.push(Qc)),$.forEach((J=>{isNaN(D.minBandwidth)||C("minBitrate",J,D.minBandwidth),isNaN(D.maxBandwidth)||C("maxBitrate",J,D.maxBandwidth),isNaN(D.targetBandwidth)||C("initialBitrate",J,D.targetBandwidth)}))})(I),I.contentSteering&&(function(P){v.contentSteering=P.contentSteering})(I),I.clientDataReporting&&(function(P){v.clientDataReporting=P.clientDataReporting})(I))},reset:function(){N()},setConfig:function(x){x&&x.adapter&&(A=x.adapter)}},w=(0,c.default)(b).getInstance().getLogger(p),N(),p}Jc.__dashjs_factory_name="ServiceDescriptionController";var Tm=n.default.getSingletonFactory(Jc);class wm{constructor(p){this._ranges=[];for(const v of p){const T=this._ranges,w={start:v.start,end:v.end},A=T.length?T[T.length-1]:null;!A||w.start>A.end?T.push(w):A.end=w.end}}get length(){return this._ranges.length}start(p){return this._ranges[p].start}end(p){return this._ranges[p].end}}var Zc=class{constructor(b,p){this.eventBus=p,this.mimeType=b,this.updating=!1,this.chunks=[],this.appendWindowStart=0,this.appendWindowEnd=1/0,this.timestampOffset=0,this.mode="segments"}appendBuffer(b,p,v){if(this.updating)throw new Error("SourceBuffer is currently updating");this.updating=!0,this.eventBus.trigger("externalSourceBufferUpdateStart",{mimeType:this.mimeType,request:"appendBuffer",data:b,start:p,end:v}),Number.isNaN(p)||(this.chunks.push({data:b,start:p,end:v}),this.chunks.sort(((T,w)=>T.start-w.start))),setTimeout((()=>{this.updating=!1,this.eventBus.trigger("externalSourceBufferUpdating",{mimeType:this.mimeType}),this.eventBus.trigger("externalSourceBufferUpdateEnd",{mimeType:this.mimeType})}),10)}abort(){this.updating&&(this.updating=!1,this.eventBus.trigger("externalSourceBufferAbort",{mimeType:this.mimeType}),this.eventBus.trigger("externalSourceBufferUpdateEnd",{mimeType:this.mimeType}))}remove(b,p){if(this.updating)throw new Error("SourceBuffer is currently updating");this.updating=!0,this.eventBus.trigger("externalSourceBufferUpdateStart",{mimeType:this.mimeType,request:"remove",start:b,end:p}),this.chunks=this.chunks.filter((v=>v.end<=b||v.start>=p)),setTimeout((()=>{this.updating=!1,this.eventBus.trigger("externalSourceBufferUpdating",{mimeType:this.mimeType}),this.eventBus.trigger("externalSourceBufferUpdateEnd",{mimeType:this.mimeType})}),10)}get buffered(){return new wm(this.chunks)}},_m=class{constructor(b){this.eventBus=b,this.reset()}get duration(){return this._duration}set duration(b){if(this._readyState!=="open")throw new Error("ExternalMediaSource is not open");this._duration=b}get readyState(){return this._readyState}addSourceBuffer(b){if(this._readyState!=="open")throw new Error("ExternalMediaSource is not open");const p=new Zc(b,this.eventBus);return this.sourceBuffers.set(p,b),p}removeSourceBuffer(b){if(!this.sourceBuffers.has(b))throw new Error("ExternalSourceBuffer not found");this.sourceBuffers.delete(b)}open(){this._readyState="open",this.eventBus.trigger("externalMediaSourceOpen",{})}endOfStream(){if(this._readyState!=="open")throw new Error("ExternalMediaSource is not open");this._readyState="ended",this.eventBus.trigger("externalMediaSourceEnded",{})}close(){this._readyState="closed",this.eventBus.trigger("externalMediaSourceClosed",{})}reset(){this.sourceBuffers=new Map,this._duration=NaN,this._readyState="closed"}},Am=class{constructor(){this.streamId=null,this.segmentType=null,this.index=NaN,this.bytes=null,this.start=NaN,this.end=NaN,this.duration=NaN,this.representation=null,this.endFragment=null}},Sm=class extends ne{constructor(b){super(b),this.checkForExistenceOnly=!0}};function eu(b){b=b||{};const p=this.context,v=b.eventBus,T=b.events,w=b.urlUtils,A=b.errors,N=b.streamId;let C,x;return C={abort:function(){x&&x.abort()},checkForExistence:function(B){const q=function(I){v.trigger(T.CHECK_FOR_EXISTENCE_COMPLETED,{request:B,exists:I})};if(B){let I=new Sm(B.url);x.load({request:I,success:function(){q(!0)},error:function(){q(!1)}})}else q(!1)},load:function(B){const q=function(I,P){v.trigger(T.LOADING_COMPLETED,{request:B,response:I||null,error:P||null,sender:C})};B?x.load({request:B,progress:function(I){v.trigger(T.LOADING_PROGRESS,{request:B,stream:I.stream,streamId:N}),I.data&&v.trigger(T.LOADING_DATA_PROGRESS,{request:B,response:I.data||null,error:null,sender:C})},success:function(I){q(I)},error:function(I,P,D){q(void 0,new Bt.default(A.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE,D,P))},abort:function(I){I&&v.trigger(T.LOADING_ABANDONED,{mediaType:I.mediaType,request:I,sender:C})}}):q(void 0,new Bt.default(A.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE,A.FRAGMENT_LOADER_NULL_REQUEST_ERROR_MESSAGE))},reset:function(){x&&(x.abort(),x.reset(),x=null)},resetInitialSettings:function(){x&&x.resetInitialSettings()}},x=ri(p).create({errHandler:b.errHandler,errors:A,dashMetrics:b.dashMetrics,mediaPlayerModel:b.mediaPlayerModel,urlUtils:w,constants:l.default,boxParser:b.boxParser,dashConstants:b.dashConstants,requestTimeout:b.settings.get().streaming.fragmentRequestTimeout}),C}eu.__dashjs_factory_name="FragmentLoader";var km=n.default.getClassFactory(eu);function tu(b){b=b||{};const p=this.context,v=(0,y.default)(p).getInstance(),T=b.errHandler,w=b.mediaPlayerModel,A=b.dashMetrics,N=(0,c.default)(p).getInstance(),C=b.streamInfo;let x,B,q;function I(){return C.id}function P(){for(let $ in q)q[$].reset();q={}}function D($){if(!$.sender)return;const J=$.request,Z=$.response,V=J.isInitializationRequest(),re=J.representation.mediaInfo.streamInfo;if($.error&&(J.mediaType===l.default.AUDIO||J.mediaType===l.default.VIDEO||J.mediaType===l.default.TEXT&&J.representation.mediaInfo.isFragmented)&&v.trigger(u.default.SERVICE_LOCATION_BASE_URL_BLACKLIST_ADD,{entry:$.request.serviceLocation}),!Z||!re)return void B.warn("No "+J.mediaType+" bytes to push or stream is inactive.");const le=(function(ue,be,X,G){const U=new Am;return U.streamId=X,U.segmentType=be.type,U.start=be.startTime,U.duration=be.duration,U.end=U.start+U.duration,U.bytes=ue,U.index=be.index,U.representation=be.representation,U.endFragment=G,U})(Z,J,C.id,$.type!==u.default.FRAGMENT_LOADING_PROGRESS);v.trigger(V?u.default.INIT_FRAGMENT_LOADED:u.default.MEDIA_FRAGMENT_LOADED,{chunk:le,request:J},{streamId:re.id,mediaType:J.mediaType})}return x={getStreamId:I,getModel:function($){let J=q[$];return J||(J=Ue(p).create({streamInfo:C,type:$,dashMetrics:A,fragmentLoader:km(p).create({dashMetrics:A,mediaPlayerModel:w,errHandler:T,settings:b.settings,boxParser:b.boxParser,eventBus:v,events:u.default,errors:Yt,dashConstants:b.dashConstants,urlUtils:b.urlUtils,streamId:I()}),debug:N,eventBus:v,events:u.default}),q[$]=J),J},reset:function(){v.off(d.default.FRAGMENT_LOADING_COMPLETED,D,this),v.off(d.default.FRAGMENT_LOADING_PROGRESS,D,this),P()}},B=N.getLogger(x),P(),v.on(d.default.FRAGMENT_LOADING_COMPLETED,D,x),v.on(d.default.FRAGMENT_LOADING_PROGRESS,D,x),x}tu.__dashjs_factory_name="FragmentController";var Im=n.default.getClassFactory(tu),hr=class{constructor(b){this.newMediaInfo=b.newMediaInfo,this.previouslySelectedRepresentation=b.previouslySelectedRepresentation,this.newRepresentation=b.newRepresentation}};function nu(b){const p=this.context,v=(0,h.default)(p).getInstance(),T=b.textController,w=b.eventBus;let A,N,C,x,B,q,I=[],P=[],D=!1,$=b.mediaSource,J=null;function Z(te){return te.mimeType+';codecs="'+te.codecs+'"'}function V(te){return x=T.getTextSourceBuffer(te),Promise.resolve()}function re(){if(typeof x.addEventListener=="function")try{x.addEventListener("updateend",U,!1),x.addEventListener("error",F,!1),x.addEventListener("abort",F,!1)}catch{q=setInterval(U,50)}else q=setInterval(U,50)}function le(){try{typeof x.removeEventListener=="function"&&(x.removeEventListener("updateend",U,!1),x.removeEventListener("error",F,!1),x.removeEventListener("abort",F,!1)),clearInterval(q)}catch(te){C.error(te)}}function ue(te){return new Promise((ke=>{x&&v.get().streaming.buffer.useAppendWindow?ve((()=>{try{if(!x)return void ke();let Ee=$.duration,Re=0;te&&!isNaN(te.start)&&!isNaN(te.duration)&&isFinite(te.duration)&&(Ee=te.start+te.duration),te&&!isNaN(te.start)&&(Re=te.start),x.appendWindowEnd===Ee&&x.appendWindowStart===Re||(x.appendWindowStart=0,x.appendWindowEnd=Ee+.01,x.appendWindowStart=Math.max(Re-.1,0),C.debug(`Updated append window for ${B.type}. Set start to ${x.appendWindowStart} and end to ${x.appendWindowEnd}`)),ke()}catch{C.warn("Failed to set append window"),ke()}})):ke()}))}function be(te){return new Promise((ke=>{x?ve((()=>{try{x.timestampOffset===te||isNaN(te)||(x.timestampOffset=te,C.debug(`Set MSE timestamp offset to ${te}`)),ke()}catch{ke()}})):ke()}))}function X(){if(!D&&P.length>0){D=!0;const te=P[0];P.splice(0,1);const ke=function(){D=!1,P.length>0&&X.call(this),te&&te.data&&te.data.segmentType&&te.data.segmentType!==ye.HTTPRequest.INIT_SEGMENT_TYPE&&delete te.data.bytes,te.promise.resolve({chunk:te.data})};try{if(J=te.request,te.data.bytes.byteLength===0)ke.call(this);else{try{C.debug(`Appending ${te.data.segmentType} from period ${te.data.streamId} to buffer. Request URL: ${te.request.url}, Representation: ID: ${te.data.representation.id}, bitrate: ${te.data.representation.bitrateInKbit}`)}catch{}x instanceof Zc?x.appendBuffer(te.data.bytes,te.data.start,te.data.end):x.appendBuffer?x.appendBuffer(te.data.bytes):x.append(te.data.bytes,te.data),ve(ke.bind(this))}}catch(Ee){C.fatal('SourceBuffer append failed "'+Ee+'"'),P.length>0?X():D=!1,delete te.data.bytes,te.promise.reject({chunk:te.data,error:new Bt.default(Ee.code,Ee.message)})}}}function G(){I.length>0&&!x.updating&&(I.shift()(),G())}function U(){x.updating||G()}function F(te){const ke=te.target||{};(function(Ee,Re){let Oe=Re||{};w.trigger(Ee,Oe,{streamId:B.streamInfo.id,mediaType:N})})(u.default.SOURCE_BUFFER_ERROR,{error:ke,lastRequestAppended:J})}function ve(te){try{I.push(te),x&&!x.updating&&G()}catch(ke){C.error(ke)}}return A={abort:function(){return new Promise((te=>{try{P=[],$.readyState==="open"?ve((()=>{try{x&&x.abort(),te()}catch{te()}})):(x&&x.setTextTrack&&$.readyState==="ended"&&x.abort(),te())}catch{te()}}))},abortBeforeAppend:function(){return new Promise((te=>{ve((()=>{const ke=x.appendWindowStart,Ee=x.appendWindowEnd;x&&(x.abort(),x.appendWindowStart=ke,x.appendWindowEnd=Ee),te()}))}))},append:function(te,ke=null){return new Promise(((Ee,Re)=>{te?(P.push({data:te,promise:{resolve:Ee,reject:Re},request:ke}),ve(X.bind(this))):Re({chunk:te,error:new Bt.default(Yt.APPEND_ERROR_CODE,Yt.APPEND_ERROR_MESSAGE)})}))},changeType:function(te){const ke=Z(te);return new Promise((Ee=>{ve((()=>{x.changeType&&(C.debug(`Changing SourceBuffer codec to ${ke}`),x.changeType(ke)),Ee()}))}))},getAllBufferRanges:function(){try{return x?.buffered}catch(te){return C.error("getAllBufferRanges exception: "+te.message),null}},getBuffer:function(){return x},getType:function(){return N},initializeForFirstUse:function(te,ke){B=te;const Ee=te.streamInfo;N=B.type;const Re=ke?Z(ke):te.codec;try{if(Re.match(/application\/mp4;\s*codecs="(stpp|wvtt).*"/i))return V(Ee);x=$.addSourceBuffer(Re),re();const Oe=[];return Oe.push(ue(B.streamInfo)),ke&&ke.mseTimeOffset!==void 0&&Oe.push(be(ke.mseTimeOffset)),Promise.all(Oe)}catch(Oe){return B.type==l.default.TEXT&&!B.isFragmented||Re.indexOf('codecs="stpp')!==-1||Re.indexOf('codecs="vtt')!==-1||Re.indexOf("text/vtt")!==-1?V(Ee):Promise.reject(Oe)}},initializeForStreamSwitch:function(te,ke,Ee){B=te,N=B.type,(function(Re){x=Re.getBuffer()})(Ee),re()},remove:function(te){return new Promise(((ke,Ee)=>{const Re=te.start,Oe=te.end;Re>=0&&Oe>Re?ve((function(){try{x.remove(Re,Oe),ve((function(){ke({from:Re,to:Oe,unintended:!1}),te.resolve&&te.resolve()}))}catch(Le){Ee({from:Re,to:Oe,unintended:!1,error:new Bt.default(Yt.REMOVE_ERROR_CODE,Yt.REMOVE_ERROR_MESSAGE)}),te.reject&&te.reject(Le)}})):ke()}))},removeEventListeners:le,reset:function(){if(x){try{I=[],le(),D=!1,P=[],x.getClassName&&x.getClassName()==="TextSourceBuffer"||(C.debug("Removing sourcebuffer from media source"),$.removeSourceBuffer(x))}catch{}x=null}J=null},updateAppendWindow:ue,updateTimestampOffset:be},C=(0,c.default)(p).getInstance().getLogger(A),A}nu.__dashjs_factory_name="SourceBufferSink";var au=n.default.getClassFactory(nu);function ru(b){const p=this.context;let v,T,w,A=[],N=b;function C(x,B){return A=A.filter((q=>!((isNaN(B)||q.start<B)&&(isNaN(x)||q.end>x)))),Promise.resolve()}return v={getAllBufferRanges:function(){let x=[];for(let q=0;q<A.length;q++){let I=A[q];x.length===0||I.start>x[x.length-1].end?x.push({start:I.start,end:I.end}):x[x.length-1].end=I.end}const B={start:function(q){return x[q].start},end:function(q){return x[q].end}};return Object.defineProperty(B,"length",{get:function(){return x.length}}),B},append:function(x){return x.segmentType!=="InitializationSegment"?(A.push(x),A.sort((function(B,q){return B.start-q.start})),w=null):w=x,T.debug("PreBufferSink appended chunk s: "+x.start+"; e: "+x.end),N&&N({chunk:x}),Promise.resolve()},remove:C,abort:function(){return Promise.resolve()},discharge:function(x,B){const q=(function(I,P){return A.filter((D=>(isNaN(P)||D.start<P)&&(isNaN(I)||D.end>I)))})(x,B);return w&&(q.push(w),w=null),C(x,B),q},reset:function(){A=[],w=null,N=null},updateTimestampOffset:function(){return Promise.resolve()},waitForUpdateEnd:function(x){x()},getBuffer:function(){return this}},T=(0,c.default)(p).getInstance().getLogger(v),v}ru.__dashjs_factory_name="PreBufferSink";var Rm=n.default.getClassFactory(ru);function iu(){let b={};return{save:function(p){const v=p.streamId,T=p.representation.id;b[v]=b[v]||{},b[v][T]=p},extract:function(p,v){return b&&b[p]&&b[p][v]?b[p][v]:null},reset:function(){b={}}}}iu.__dashjs_factory_name="InitCache";var To=n.default.getSingletonFactory(iu);const wo=.01,su="BufferController";function ou(b){const p=(b=b||{}).capabilities,v=this.context,T=(0,y.default)(v).getInstance(),w=b.fragmentModel,A=b.playbackController,N=b.representationController,C=b.settings,x=b.streamInfo,B=b.textController,q=b.type;let I,P,D,$,J,Z,V,re,le,ue,be,X,G,U,F,ve,te,ke,Ee,Re,Oe;function Le(je,Qe=null){return new Promise(((bt,Je)=>{Z=je,le&&Qe&&typeof le.discharge=="function"?(ue=le,Q(Qe).then((()=>{bt()})).catch((Rt=>{Je(Rt)}))):bt()}))}function Q(je,Qe=new Map,bt){return new Promise(((Je,Rt)=>{ke&&je?Z?(be=!1,(function(Lt,Ce,rt){return new Promise((Pt=>{le=au(v).create({mediaSource:Z,textController:B,eventBus:T}),(function(zt,yn,ut){const Ht=N.getCurrentRepresentation();let dn=null;return q!==l.default.VIDEO&&q!==l.default.AUDIO||(dn=yn.get(q)),dn?(function(ln,En,mn,jn){le.initializeForStreamSwitch(ln,En,mn);const Jn=[];return Jn.push(le.abortBeforeAppend()),Jn.push(We()),Jn.push(ge(En,jn)),En&&En.mseTimeOffset!==void 0&&Jn.push(pn(En)),Promise.allSettled(Jn)})(zt,Ht,dn,ut):(function(ln,En){return le.initializeForFirstUse(ln,En)})(zt,Ht)})(Lt,Ce,rt).then((()=>pn(N.getCurrentRepresentation()))).then((()=>{Pt(le)})).catch((zt=>{P.warn("Caught error on create SourceBuffer: "+zt),Pt(le)}))}))})(je,Qe,bt).then((Lt=>{Je(Lt)})).catch((Lt=>{Rt(Lt)}))):(be=!0,(function(){return new Promise(((Lt,Ce)=>{le=Rm(v).create(me.bind(this)),pn(N.getCurrentRepresentation()).then((()=>{Lt(le)})).catch((()=>{Ce()}))}))})().then((Lt=>{Je(Lt)})).catch((Lt=>{Rt(Lt)}))):Je(null)}))}function ee(je){C.get().streaming.cacheInitSegments&&(P.info("Init fragment finished loading saving to",q+"'s init cache"),ke.save(je.chunk)),P.debug(`Appending init fragment for type ${q}, representationId ${je.chunk.representation.id} and bandwidth ${je.chunk.representation.bandwidth}`),ae(je.chunk)}function oe(je){ae(je.chunk,je.request)}function ae(je,Qe=null){le&&(le.append(je,Qe).then((bt=>{me(bt)})).catch((bt=>{me(bt)})),je.representation.mediaInfo.type===l.default.VIDEO&&_t(u.default.VIDEO_CHUNK_RECEIVED,{chunk:je}))}function ie(je){if(je&&je.length>0)for(let Qe=0,bt=je.length;Qe<bt;Qe++)P.debug("Buffered range: "+je.start(Qe)+" - "+je.end(Qe)+", currentTime = ",A.getTime())}function me(je){if(je.error)return je.error.code===22&&(function(){if(te=!0,J=.8*Kt(),P.warn("Quota exceeded, Critical Buffer: "+J),J>0){const Je=Math.max(.2*J,1),Rt=J-Je,Lt=Math.min(C.get().streaming.buffer.bufferTimeAtTopQuality,.9*Rt),Ce=Math.min(C.get().streaming.buffer.bufferTimeAtTopQualityLongForm,.9*Rt),rt={streaming:{buffer:{bufferToKeep:parseFloat(Je.toFixed(5)),bufferTimeAtTopQuality:parseFloat(Lt.toFixed(5)),bufferTimeAtTopQualityLongForm:parseFloat(Ce.toFixed(5))}}};C.update(rt)}})(),void(je.error.code!==22&&ot()||(P.warn("Clearing playback buffer to overcome quota exceed situation"),_t(u.default.QUOTA_EXCEEDED,{criticalBufferLevel:J,quotaExceededTime:je.chunk.start}),kn(on())));if(!le||(ht(),te=!1,U=je.chunk,!U||!U.endFragment))return;U&&!isNaN(U.index)&&(V=Math.max(U.index,V),wt());const Qe=le.getAllBufferRanges();U.segmentType===ye.HTTPRequest.MEDIA_SEGMENT_TYPE&&(ie(Qe),Me(),(function(){if(isNaN(Oe)||be)return;if(q!==l.default.AUDIO&&q!==l.default.VIDEO)return void(Oe=NaN);const Je=A.getTime(),Rt=Ze(Je,0),Lt=Ze(Oe,0);if(Rt&&Lt&&Rt.start===Lt.start)return void(Oe=NaN);const Ce=N.getCurrentRepresentation().segmentDuration,rt=Ze(Oe,Ce);rt&&(C.get().streaming.buffer.enableSeekDecorrelationFix&&Math.abs(Je-Oe)>Ce?Oe<=rt.end&&A.seek(Math.max(Oe,rt.start),!1,!0):Je<rt.start&&A.seek(rt.start,!1,!0))})());let bt=!1;X&&(X.indexOf(U)>0&&(bt=!0),X=null),U&&!bt&&_t(u.default.BYTES_APPENDED_END_FRAGMENT,{startTime:U.start,index:U.index,bufferedRanges:Qe,segmentType:U.segmentType,mediaType:q,representationId:U.representation.id})}function K(je,Qe){const bt=[];return bt.push(pn(je)),bt.push(le?le.abort():Promise.resolve()),bt.push(ge(je,Qe)),Promise.allSettled(bt)}function ge(je,Qe){if(!je||!Qe)return P.warn("BufferController._changeCodec() is missing the information about the Representations. Doing nothing"),Promise.resolve();if(je&&Qe&&je.mimeType===Qe.mimeType&&je.codecFamily===Qe.codecFamily)return P.debug(`Switching to new codec ${je.codecs} without changeType as previous codec ${Qe.codecs} is compatible.`),Promise.resolve();if(!C.get().streaming.buffer.useChangeType||!p.supportsChangeType())return P.debug("changeType() not available"),Promise.resolve();P.debug(`Using changeType() to switch from codec ${Qe.codecs} to ${je.codecs}`);const bt=je.dependentRepresentation?je.dependentRepresentation:je;return le.changeType(bt)}function _e(){return new Promise(((je,Qe)=>{let bt=xe();if(!bt||bt.length===0)return Me(),void je();kn(bt).then((()=>{je()})).catch((Je=>{Qe(Je)}))}))}function xe(je){const Qe=[],bt=le.getAllBufferRanges();if(!bt||bt.length===0)return Qe;if(!je&&je!==0||isNaN(je))Qe.push({start:bt.start(0),end:bt.end(bt.length-1)+.5});else{const Je=(function(Lt,Ce){const rt=C.get().streaming.buffer.bufferToKeep,Pt=Ce.start(0);if(Lt-Pt>rt){let zt=Math.max(0,Lt-rt);const yn=w.getRequests({state:Ue.FRAGMENT_MODEL_EXECUTED,time:Lt,threshold:wo})[0];if(yn&&(zt=Math.min(yn.startTime,zt)),zt>0)return{start:Pt,end:zt}}return null})(je,bt),Rt=(function(Lt,Ce){const rt=Ce.end(Ce.length-1)+.5,Pt=gn(Lt),zt=x.manifestInfo.duration>=C.get().streaming.buffer.longFormContentDurationThreshold?C.get().streaming.buffer.bufferTimeAtTopQualityLongForm:C.get().streaming.buffer.bufferTimeAtTopQuality;let yn=isNaN(Pt)?Lt:Math.min(Pt,Lt+zt);if(yn>=Ce.end(Ce.length-1))return null;const ut=w.getRequests({state:Ue.FRAGMENT_MODEL_EXECUTED,time:Lt,threshold:wo})[0];if(ut&&(yn=Math.max(ut.startTime+ut.duration,yn)),C.get().streaming.buffer.avoidCurrentTimeRangePruning){for(let Ht=0;Ht<Ce.length;Ht++)if(Ce.start(Ht)<=Lt&&Lt<=Ce.end(Ht)&&Ce.start(Ht)<=yn&&yn<=Ce.end(Ht)){let dn=yn;yn=Ht+1<Ce.length?Ce.start(Ht+1):Ce.end(Ht)+1,P.debug("Buffered range ["+Ce.start(Ht)+", "+Ce.end(Ht)+"] overlaps with targetTime "+Lt+" and range to be pruned ["+dn+", "+rt+"], using ["+yn+", "+rt+"] instead"+(yn<rt?"":" (no actual pruning)"));break}}return yn<Ce.end(Ce.length-1)?{start:yn,end:rt}:null})(je,bt);Je&&Qe.push(Je),Rt&&Qe.push(Rt)}return Qe}function Me(){(!Re||q===l.default.TEXT&&B.isTextEnabled())&&ht()}function Ne(){Wt()}function Ge(){Wt(),Oe=NaN}function Ze(je,Qe){if(!le)return null;const bt=le.getAllBufferRanges();let Je,Rt,Lt=0,Ce=0,rt=null,Pt=null,zt=0;const yn=isNaN(Qe)?.15:Qe;if(bt!=null){for(Rt=0,Je=bt.length;Rt<Je;Rt++)if(Lt=bt.start(Rt),Ce=bt.end(Rt),rt===null)zt=Math.abs(Lt-je),(je>=Lt&&je<Ce||zt<=yn)&&(rt=Lt,Pt=Ce);else{if(zt=Lt-Pt,!(zt<=yn))break;Pt=Ce}if(rt!==null)return{start:rt,end:Pt}}return null}function ht(){if(A){let je=A.getTime()||0;be&&(je=isNaN(Oe)?0:Oe);const Qe=C.get().streaming.gaps.jumpGaps&&!isNaN(C.get().streaming.gaps.smallGapLimit)?C.get().streaming.gaps.smallGapLimit:NaN;$=Math.max((function(bt,Je){let Rt,Lt;return C.get().streaming.gaps.jumpGaps&&(Je=C.get().streaming.gaps.smallGapLimit),Rt=Ze(bt,Je),Lt=Rt===null?0:Rt.end-bt,Lt})(je,Qe),0),_t(u.default.BUFFER_LEVEL_UPDATED,{mediaType:q,bufferLevel:$}),Wt()}}function wt(){const je=V>=re-1,Qe=A.getTimeToStreamEnd(x)-$<1e-5;!je&&!Qe||D||(St(!0),P.debug(`checkIfBufferingCompleted trigger BUFFERING_COMPLETED for stream id ${x.id} and type ${q}`))}function Wt(){if(q!==l.default.AUDIO&&q!==l.default.VIDEO)return;const je=A.getLowLatencyModeEnabled()?C.get().streaming.buffer.lowLatencyStallThreshold:C.get().streaming.buffer.stallThreshold;$<=je&&!D?At(i.BUFFER_EMPTY):(D||$>je)&&At(i.BUFFER_LOADED)}function At(je){G===je||je===i.BUFFER_EMPTY&&A.getTime()===0||q===l.default.TEXT&&!B.isTextEnabled()||(G=je,_t(u.default.BUFFER_LEVEL_STATE_CHANGED,{state:je}),_t(je===i.BUFFER_LOADED?u.default.BUFFER_LOADED:u.default.BUFFER_EMPTY),P.debug(je===i.BUFFER_LOADED?"Got enough buffer to start":"Waiting for more buffer before starting playback"))}function Vt(){le&&q!==l.default.TEXT&&(D||kn(on()))}function on(){const je=[],Qe=le.getAllBufferRanges();if(!Qe||Qe.length===0)return je;const bt=A.getTime();let Je=Math.max(0,bt-C.get().streaming.buffer.bufferToKeep);const Rt=w.getRequests({state:Ue.FRAGMENT_MODEL_EXECUTED,time:bt,threshold:wo})[0];if(Rt)Je=Math.min(Rt.startTime,Je);else if(bt===0&&A.getIsDynamic())return[];if(Qe.start(0)<=Je){const Lt={start:0,end:Je};for(let Ce=0;Ce<Qe.length&&Qe.end(Ce)<=Je;Ce++)Lt.end=Qe.end(Ce);Lt.start<Lt.end&&je.push(Lt)}return je}function kn(je){return new Promise(((Qe,bt)=>{if(!je||!le||je.length===0)return ht(),void Qe();const Je=[];je.forEach((Rt=>{Je.push((function(Lt){return new Promise(((Ce,rt)=>{Lt.resolve=Ce,Lt.reject=rt,Ee.push(Lt)}))})(Rt))})),ve||vn(),Promise.all(Je).then((()=>{Qe()})).catch((Rt=>{bt(Rt)}))}))}function vn(){try{if(Ee.length===0||!le)return P.debug("Nothing to prune, halt pruning"),Ee=[],void(ve=!1);const je=le.getBuffer();if(!je||!je.buffered||je.buffered.length===0)return P.debug("SourceBuffer is empty (or does not exist), halt pruning"),Ee=[],void(ve=!1);const Qe=Ee.shift();P.debug(`${q}: Removing buffer from: ${Qe.start} to ${Qe.end}`),ve=!0,A.getTime()<Qe.end&&St(!1),le.remove(Qe).then((bt=>{cn(bt)})).catch((bt=>{cn(bt)}))}catch{ve=!1}}function cn(je){P.debug("onRemoved buffer from:",je.from,"to",je.to),le&&(ie(le.getAllBufferRanges()),Ee.length===0&&(ve=!1,ht()),je.unintended&&(P.warn("Detected unintended removal from:",je.from,"to",je.to,"setting streamprocessor time to",je.from),_t(u.default.SEEK_TARGET,{time:je.from})),ve?vn():(Re?Re=!1:ht(),_t(u.default.BUFFER_CLEARED,{from:je.from,to:je.to,unintended:je.unintended,hasEnoughSpaceToAppend:ot(),quotaExceeded:te})))}function pn(je){return new Promise((Qe=>{je&&je.mseTimeOffset!==void 0&&le&&le.updateTimestampOffset?le.updateTimestampOffset(je.mseTimeOffset).then((()=>{Qe()})).catch((()=>{Qe()})):Qe()}))}function We(){return le&&!D?le.updateAppendWindow(x):Promise.resolve()}function pt(){F++,F*(C.get().streaming.wallclockTimeUpdateInterval/1e3)>=C.get().streaming.buffer.bufferPruningInterval&&(F=0,Vt())}function gt(){Wt()}function St(je){D=je,D?_t(u.default.BUFFERING_COMPLETED):re=Number.POSITIVE_INFINITY}function Kt(){try{const je=le.getAllBufferRanges();let Qe,bt,Je=0;if(!je)return Je;for(bt=0,Qe=je.length;bt<Qe;bt++)Je+=je.end(bt)-je.start(bt);return Je}catch{return 0}}function gn(je){try{let Qe=je;const bt=le.getAllBufferRanges();if(!bt||bt.length===0)return NaN;let Je=0;for(;Qe===je&&Je<bt.length;){const Rt=bt.start(Je),Lt=bt.end(Je);Qe>=Rt&&Qe<=Lt&&(Qe=Lt),Je+=1}return Qe===je?NaN:Qe}catch{return NaN}}function ot(){const je=Kt();return isNaN(je)||je<J}function _t(je,Qe){let bt=Qe||{};T.trigger(je,bt,{streamId:x.id,mediaType:q})}function Ut(je,Qe){if(J=Number.POSITIVE_INFINITY,G=void 0,re=Number.POSITIVE_INFINITY,V=0,U=null,D=!1,ve=!1,te=!1,$=0,F=0,Ee=[],Oe=NaN,be=!1,le){let bt=le;le=null,je||(Qe?bt.removeEventListeners():bt.abort().then((()=>{bt.reset(Qe),bt=null})))}Re=!1}return I={appendInitSegmentFromCache:function(je){const Qe=ke.extract(x.id,je);return!!Qe&&(P.debug(`Appending init fragment for type ${q}, representationId ${Qe.representation.id} and bandwidth ${Qe.representation.bandwidth}`),ae(Qe),!0)},clearBuffers:kn,createBufferSink:Q,dischargePreBuffer:function(){if(le&&ue&&typeof ue.discharge=="function"){const je=ue.getAllBufferRanges();if(je.length>0){let Je="Beginning "+q+"PreBuffer discharge, adding buffer for:";for(let Rt=0;Rt<je.length;Rt++)Je+=" start: "+je.start(Rt)+", end: "+je.end(Rt)+";";P.debug(Je)}else P.debug("PreBuffer discharge requested, but there were no media segments in the PreBuffer.");X=[];let Qe=ue.discharge(),bt=null;for(let Je=0;Je<Qe.length;Je++){const Rt=Qe[Je];if(Rt.segmentType!==ye.HTTPRequest.INIT_SEGMENT_TYPE){const Lt=ke.extract(Rt.streamId,Rt.representation.id);Lt&&bt!==Lt&&(X.push(Lt),le.append(Lt),bt=Lt)}X.push(Rt),le.append(Rt)}ue.reset(),ue=null}},getAllRangesWithSafetyFactor:xe,getBuffer:function(){return le},getBufferControllerType:function(){return su},getBufferLevel:function(){return $},getContinuousBufferTimeForTargetTime:gn,getIsBufferingCompleted:function(){return D},getIsPruningInProgress:function(){return ve},getMediaSource:function(){return Z},getRangeAt:Ze,getStreamId:function(){return x.id},getType:function(){return q},hasBufferAtTime:function(je){try{const Qe=le.getAllBufferRanges();if(!Qe||Qe.length===0)return!1;let bt=0;for(;bt<Qe.length;){const Je=Qe.start(bt),Rt=Qe.end(bt);if(je>=Je&&je<=Rt)return!0;bt+=1}return!1}catch(Qe){return P.error(Qe),!1}},initialize:function(je){Le(je),T.on(u.default.INIT_FRAGMENT_LOADED,ee,I),T.on(u.default.MEDIA_FRAGMENT_LOADED,oe,I),T.on(u.default.WALLCLOCK_TIME_UPDATED,pt,I),T.on(d.default.PLAYBACK_PLAYING,Ge,I),T.on(d.default.PLAYBACK_PROGRESS,Me,I),T.on(d.default.PLAYBACK_TIME_UPDATED,Me,I),T.on(d.default.PLAYBACK_RATE_CHANGED,gt,I),T.on(d.default.PLAYBACK_STALLED,Ne,I)},prepareForAbandonQualitySwitch:function(je,Qe){return K(je,Qe)},prepareForDefaultQualitySwitch:function(je,Qe){return K(je,Qe)},prepareForFastQualitySwitch:function(je,Qe){return K(je,Qe)},prepareForForceReplacementQualitySwitch:function(je,Qe){return new Promise((bt=>{const Je=[];Je.push(le.abort()),Je.push(We()),Je.push(_e()),Je.push(pn(je)),Je.push(ge(je,Qe)),Promise.allSettled(Je).then((()=>{St(!1),bt()}))}))},prepareForNonReplacementTrackSwitch:function(je,Qe){return new Promise((bt=>{const Je=[];Je.push(We()),Je.push(ge(je,Qe)),Promise.allSettled(Je).then((()=>{bt()}))}))},prepareForPlaybackSeek:function(){return D&&St(!1),le.abort()},prepareForReplacementTrackSwitch:function(je,Qe){return new Promise((bt=>{const Je=[];Je.push(le.abort()),Je.push(We()),Je.push(ge(je,Qe)),Je.push(_e()),Je.push(pn(je)),Promise.allSettled(Je).then((()=>{St(!1),bt()}))}))},pruneAllSafely:_e,pruneBuffer:Vt,reset:function(je,Qe){T.off(u.default.INIT_FRAGMENT_LOADED,ee,this),T.off(u.default.MEDIA_FRAGMENT_LOADED,oe,this),T.off(u.default.WALLCLOCK_TIME_UPDATED,pt,this),T.off(d.default.PLAYBACK_PLAYING,Ge,this),T.off(d.default.PLAYBACK_PROGRESS,Me,this),T.off(d.default.PLAYBACK_TIME_UPDATED,Me,this),T.off(d.default.PLAYBACK_RATE_CHANGED,gt,this),T.off(d.default.PLAYBACK_STALLED,Ne,this),Ut(je,Qe)},segmentRequestingCompleted:function(je){isNaN(je)||(re=je,wt())},setIsBufferingCompleted:St,setMediaSource:Le,setSeekTarget:function(je){Oe=je},updateAppendWindow:We,updateBufferTimestampOffset:pn},P=(0,c.default)(v).getInstance().getLogger(I),ke=To(v).getInstance(),Ut(),I}ou.__dashjs_factory_name=su;var xm=n.default.getClassFactory(ou);const lu="NotFragmentedTextBufferController";function cu(b){b=b||{};const p=this.context,v=(0,y.default)(p).getInstance(),T=b.textController,w=b.errHandler,A=b.streamInfo,N=b.type;let C,x,B,q,I,P;function D(Z){q=Z}function $(Z){x!==Z&&(x=Z,x&&(function(V){let re={};v.trigger(V,re,{streamId:A.id,mediaType:N})})(u.default.BUFFERING_COMPLETED))}function J(Z){Z.chunk.bytes&&!x&&(P.save(Z.chunk),I.append(Z.chunk),$(!0))}return C={initialize:function(Z){D(Z)},getStreamId:function(){return A.id},getType:function(){return N},getBufferControllerType:function(){return lu},createBufferSink:function(Z){return new Promise(((V,re)=>{try{I=au(p).create({mediaSource:q,textController:T,eventBus:v}),I.initializeForFirstUse(Z),B||(I.getBuffer()&&typeof I.getBuffer().initialize=="function"&&I.getBuffer().initialize(),B=!0),V(I)}catch(le){w.error(new Bt.default(Yt.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,Yt.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+N)),re(le)}}))},dischargePreBuffer:function(){},getBuffer:function(){return I},getBufferLevel:function(){return 0},getRangeAt:function(){return null},pruneBuffer:function(){},hasBufferAtTime:function(){return!0},getAllRangesWithSafetyFactor:function(){return[]},getContinuousBufferTimeForTargetTime:function(){return Number.POSITIVE_INFINITY},setMediaSource:D,getMediaSource:function(){return q},appendInitSegmentFromCache:function(Z){return P.extract(A.id,Z)!==null},getIsBufferingCompleted:function(){return x},setIsBufferingCompleted:$,getIsPruningInProgress:function(){return!1},reset:function(Z){v.off(u.default.INIT_FRAGMENT_LOADED,J,C),!Z&&I&&(I.abort(),I.reset(),I=null)},clearBuffers:function(){return Promise.resolve()},prepareForPlaybackSeek:function(){return Promise.resolve()},prepareForReplacementTrackSwitch:function(){return x=!1,Promise.resolve()},setSeekTarget:function(){},updateAppendWindow:function(){return Promise.resolve()},pruneAllSafely:function(){return Promise.resolve()},updateBufferTimestampOffset:function(){return Promise.resolve()},segmentRequestingCompleted:function(){}},B=!1,q=null,x=!1,P=To(p).getInstance(),v.on(u.default.INIT_FRAGMENT_LOADED,J,C),C}cu.__dashjs_factory_name=lu;var Cm=n.default.getClassFactory(cu);function uu(b){b=b||{};const p=this.context,v=(0,y.default)(p).getInstance(),T=b.dashMetrics,w=b.mediaPlayerModel,A=b.fragmentModel,N=b.abrController,C=b.playbackController,x=b.textController,B=b.type,q=b.bufferController,I=b.representationController,P=b.settings;let D,$,J,Z,V,re,le,ue,be,X,G,U;function F(){le=(0,c.default)(p).getInstance().getLogger(Z),ie(),X=b.streamInfo}function ve(){ue=!0}function te(){ue=!1}function ke(me){if(q.getIsBufferingCompleted())return;Ee();const K=isNaN(me)?0:me;be=setTimeout(Re,K)}function Ee(){be&&(clearTimeout(be),be=null)}function Re(){const me=w.getScheduleTimeout();try{if((function(){try{return B===l.default.TEXT&&!x.isTextEnabled()||C.isPaused()&&(!C.getStreamController().getInitialPlayback()||!C.getStreamController().getAutoPlay())&&!P.get().streaming.scheduling.scheduleWhilePaused}catch{return!1}})())return void Ee();(function(){try{return!!ue&&I.getCurrentRepresentation()&&(re==null||G||(function(){const K=I.getCurrentRepresentation();if(!B||!K)return!0;let ge=K&&K.segmentDuration&&!isNaN(K.segmentDuration)?K.segmentDuration:0;const _e=T.getCurrentBufferLevel(B),xe=Oe();return(xe<=ge||C.getLowLatencyModeEnabled()||B===l.default.AUDIO&&$)&&(ge=0),_e+ge<xe})())}catch{return!1}})()?(function(){if(N.handlePendingManualQualitySwitch(X.id,B))return;let K=!1;D&&(K=N.checkPlaybackQuality(B,X.id)),K||(function(){const ge=I.getCurrentRepresentation();J||ge.id!==re||G?(function(_e){G?(le.debug("Switch track for "+B+", representation id = "+_e.id),G=!1):le.debug("Quality has changed, get init request for representationid = "+_e.id),v.trigger(u.default.INIT_FRAGMENT_NEEDED,{representationId:_e.id,sender:Z},{streamId:X.id,mediaType:B}),D=!1,J=!1})(ge):(le.debug(`Media segment needed for ${B} and stream id ${X.id}`),v.trigger(u.default.MEDIA_FRAGMENT_NEEDED,{},{streamId:X.id,mediaType:B}),D=!0)})()})():ke(me)}catch{ke(me)}}function Oe(){let me=NaN;const K=I.getCurrentRepresentation();return B&&K&&(me=B===l.default.TEXT?(function(){try{if(x.isTextEnabled()){const ge=I.getCurrentRepresentation();if(isNaN(ge.fragmentDuration)){const _e=T.getCurrentSchedulingInfo(i.SCHEDULING_INFO);return _e?_e.duration:0}return ge.fragmentDuration}return 0}catch{return 0}})():B===l.default.AUDIO&&$?(function(){try{const ge=T.getCurrentBufferLevel(l.default.VIDEO),_e=I.getCurrentRepresentation();return isNaN(_e.fragmentDuration)?ge+1:Math.max(ge+1,_e.fragmentDuration)}catch{return 0}})():(function(){try{const ge=P.get().streaming.enhancement.enabled?I.getCurrentCompositeRepresentation():I.getCurrentRepresentation(),_e=ge.mediaInfo.streamInfo;return N.isPlayingAtTopQuality(ge)?_e.manifestInfo.duration>=P.get().streaming.buffer.longFormContentDurationThreshold?P.get().streaming.buffer.bufferTimeAtTopQualityLongForm:P.get().streaming.buffer.bufferTimeAtTopQuality:w.getBufferTimeDefaultUnadjusted()}catch{return w.getBufferTimeDefaultUnadjusted()}})()),me}function Le(){Q(!0)}function Q(me){if(C&&A){const K=A.getRequests({state:Ue.FRAGMENT_MODEL_EXECUTED,time:C.getTime(),threshold:0})[0];K&&C.getTime()>=K.startTime&&((!V.representation||K.representation.mediaInfo.type===V.representation.mediaInfo.type&&K.representation.mediaInfo.index!==V.representation.mediaInfo.index)&&me&&(function(ge){le.debug(`Track change rendered for streamId ${X.id} and type ${B}`),v.trigger(u.default.TRACK_CHANGE_RENDERED,{mediaType:B,oldMediaInfo:V&&V.representation&&V.representation.mediaInfo?V.representation.mediaInfo:null,newMediaInfo:ge.representation.mediaInfo,streamId:X.id})})(K),V.representation&&K.representation.id===V.representation.id||!me||(function(ge){le.debug(`Quality change rendered for streamId ${X.id} and type ${B}`),v.trigger(u.default.QUALITY_CHANGE_RENDERED,{mediaType:B,oldRepresentation:V.representation?V.representation:null,newRepresentation:ge.representation,streamId:X.id})})(K),V.representation=K.representation)}}function ee(){A.abortRequests(),Ee()}function oe(){P.get().streaming.scheduling.scheduleWhilePaused||ke()}function ae(me){T.updatePlayListTraceMetrics({playbackspeed:me.playbackRate.toString()})}function ie(){D=!0,U=0,re=null,V={representation:null},G=!1,J=!1,ue=!0}return Z={clearScheduleTimer:Ee,getBufferTarget:Oe,getPlaybackController:function(){return C},getStreamId:function(){return X.id},getSwitchTrack:function(){return G},getTimeToLoadDelay:function(){return U},getType:function(){return B},initialize:function(me){$=me,v.on(u.default.URL_RESOLUTION_FAILED,ee,Z),v.on(d.default.PLAYBACK_STARTED,oe,Z),v.on(d.default.PLAYBACK_RATE_CHANGED,ae,Z),v.on(d.default.PLAYBACK_TIME_UPDATED,Le,Z),v.on(d.default.MANAGED_MEDIA_SOURCE_START_STREAMING,ve,Z),v.on(d.default.MANAGED_MEDIA_SOURCE_END_STREAMING,te,Z)},reset:function(){v.off(u.default.URL_RESOLUTION_FAILED,ee,Z),v.off(d.default.PLAYBACK_STARTED,oe,Z),v.off(d.default.PLAYBACK_RATE_CHANGED,ae,Z),v.off(d.default.PLAYBACK_TIME_UPDATED,Le,Z),v.off(d.default.MANAGED_MEDIA_SOURCE_START_STREAMING,ve,Z),v.off(d.default.MANAGED_MEDIA_SOURCE_END_STREAMING,te,Z),Ee(),Q(!1),ie(),X=null},setShouldCheckPlaybackQuality:function(me){D=me},setInitSegmentRequired:function(me){J=me},setLastInitializedRepresentationId:function(me){re=me},setup:F,setSwitchTrack:function(me){G=me},setTimeToLoadDelay:function(me){U=me},startScheduleTimer:ke},F(),Z}uu.__dashjs_factory_name="ScheduleController";var Lm=n.default.getClassFactory(uu);const Pm=/\$(RepresentationID|Number|SubNumber|Bandwidth|Time)?(?:%0([0-9]+)([diouxX]))?\$/g;var Nm=class extends Gc{constructor(){super(),this.isPartialSegment=!0,this.replacementSubNumber=NaN,this.totalNumberOfPartialSegments=NaN}};function du(b){return b?b.totalNumberOfPartialSegments&&!isNaN(b.totalNumberOfPartialSegments)&&b.totalNumberOfPartialSegments>0&&!isNaN(b.subNumberOfPartialSegmentToRequest)?(function(p){const v=(function(T,w){const A=new Nm,N=T.segmentDurationInSeconds/T.totalNumberOfPartialSegments,{representation:C,timelineConverter:x,isDynamic:B,index:q,totalNumberOfPartialSegments:I}=T,P=fu({representation:C,segmentDurationInSeconds:N,presentationStartTime:T.presentationStartTime+w*N,presentationEndTime:T.presentationStartTime+(w+1)*N,timelineConverter:x,isDynamic:B,mediaTimeInSeconds:T.mediaTimeInSeconds+w*N,index:q});return A.assignAttributes(P),A.replacementSubNumber=w,A.totalNumberOfPartialSegments=I,A})(p,p.subNumberOfPartialSegmentToRequest);return hu(v,p),v})(b):(function(p){const v=new vo,T=fu(p);return v.assignAttributes(T),hu(v,p),v})(b):null}function fu(b){const{representation:p,segmentDurationInSeconds:v,presentationStartTime:T,presentationEndTime:w,mediaTimeInSeconds:A,timelineConverter:N,isDynamic:C,index:x}=b,B={availabilityEndTime:N.calcAvailabilityEndTimeFromPresentationTime(w+v,p,C),availabilityStartTime:N.calcAvailabilityStartTimeFromPresentationTime(w,p,C),duration:v,index:x,mediaStartTime:A,presentationStartTime:T,replacementNumber:p.startNumber+x,representation:p};return B.wallStartTime=N.calcWallTimeForSegment(B,C),B}function hu(b,p){const{tManifest:v,mediaTime:T,mediaUrl:w,mediaRange:A}=p;b.replacementTime=v||T,b.media=Ri(w,b.representation.id,b.replacementNumber,b.replacementSubNumber,b.representation.bandwidth,b.replacementTime),b.mediaRange=A,b.mediaUrl=w}function mu(b,p,v,T){const w=p.adaptation.period;if(isFinite(w.duration)&&w.start+w.duration<=v.presentationStartTime)return!1;if(T){if(p.availabilityTimeOffset==="INF")return!0;const A=b.getClientReferenceTime();return v.availabilityStartTime.getTime()<=A&&(!isFinite(v.availabilityEndTime)||v.availabilityEndTime.getTime()>=A)}return!0}function Ri(b,p,v,T,w,A){return b&&(function(N,C,x,B,q,I){return N.replace(Pm,((P,D,$,J)=>{let Z,V;switch(D){case void 0:return"$";case"RepresentationID":Z=C;break;case"Number":Z=x;break;case"SubNumber":Z=B;break;case"Bandwidth":Z=q;break;case"Time":if(typeof I=="string")return I;Z=I&&Math.round(I);break;default:Z=null}if(Z==null)return P;switch(J){case void 0:case"d":case"i":case"u":V=Z.toString();break;case"o":V=Z.toString(8);break;case"x":V=Z.toString(16);break;case"X":V=Z.toString(16).toUpperCase();break;default:V=Z.toString()}const re=parseInt($,10)||1;return V.padStart(re,"0")}))})(b,p,v,T,w,A)}function gu(b){const{index:p,isDynamic:v,mediaRange:T,mediaTime:w,mediaUrl:A,representation:N,subNumberOfPartialSegmentToRequest:C,timelineConverter:x,totalNumberOfPartialSegments:B}=b;let q,I,P;q=N.segmentDuration,isNaN(q)&&(q=N.adaptation.period.duration),I=parseFloat((N.adaptation.period.start+p*q).toFixed(5)),P=parseFloat((I+q).toFixed(5));const D=du({index:p,isDynamic:v,mediaRange:T,mediaTime:w,mediaTimeInSeconds:x.calcMediaTimeFromPresentationTime(I,N),mediaUrl:A,presentationEndTime:P,presentationStartTime:I,representation:N,segmentDurationInSeconds:q,subNumberOfPartialSegmentToRequest:C,timelineConverter:x,totalNumberOfPartialSegments:B});return mu(x,N,D,v)?D:null}function _o(b){const{durationInTimescale:p,fTimescale:v,index:T,subNumberOfPartialSegmentToRequest:w,isDynamic:A,mediaRange:N,mediaTime:C,mediaUrl:x,totalNumberOfPartialSegments:B,representation:q,tManifest:I,timelineConverter:P}=b,D=C/v,$=p/v;let J=P.calcPresentationTimeFromMediaTime(D,q),Z=du({representation:q,segmentDurationInSeconds:$,presentationStartTime:J,presentationEndTime:J+$,mediaTimeInSeconds:D,timelineConverter:P,isDynamic:A,index:T,totalNumberOfPartialSegments:B,subNumberOfPartialSegmentToRequest:w,mediaUrl:x,mediaRange:N,tManifest:I,mediaTime:C});return mu(P,q,Z,A)?Z:null}function Ao(b){return b.k}function pu(b){const p=(b=b||{}).eventBus,v=b.events,T=b.abrController,w=b.dashMetrics,A=b.playbackController,N=b.timelineConverter,C=b.type,x=b.streamInfo,B=b.segmentsController,q=b.isDynamic;let I,P,D;function $(){return C}function J(){return D?.mediaInfo.type===C?D:(function(){let X=D?.dependentRepresentation;if(X){if(!X.mediaInfo)throw new Error("dependentRepresentation has no mediaInfo!");if(X.mediaInfo.type===C)return X}return null})()}function Z(){D=null,P=[]}function V(X){return new Promise(((G,U)=>{const F=X.hasInitialization(),ve=X.hasSegments(),te=[];te.push(B.updateInitData(X,F)),te.push(B.updateSegmentData(X,ve)),Promise.all(te).then((ke=>{var Ee;ke[0]&&!ke[0].error&&(X=(function(Re,Oe){return Oe&&!Oe.error&&Oe.representation?Oe.representation:Re})(X,ke[0])),ke[1]&&!ke[1].error&&(X=(function(Re,Oe){if(!Oe||Oe.error)return;const Le=Oe.segments,Q=[];let ee,oe,ae,ie,me=0;for(ee=0,oe=Le?Le.length:0;ee<oe;ee++)ae=Le[ee],ie=_o({durationInTimescale:ae.duration,fTimescale:ae.timescale,index:me,isDynamic:q,mediaRange:ae.mediaRange,mediaTime:ae.startTime,mediaUrl:ae.media,representation:Re,timelineConverter:N}),ie&&(Q.push(ie),ie=null,me++);return Q.length>0&&(Re.segments=Q),Re})(X,ke[1])),X.fragmentDuration=X.segmentDuration?X.segmentDuration:X.segments&&X.segments.length>0?X.segments[0].duration:NaN,(Ee=X).mediaFinishedInformation=B.getMediaFinishedInformation(Ee),(function(Re){let Oe,Le=w.getCurrentManifestUpdate(),Q=!1;if(Le){for(let ee=0;ee<Le.representationInfo.length;ee++)if(Oe=Le.representationInfo[ee],Oe.index===Re.index&&Oe.mediaType===$()){Q=!0;break}Q||w.addManifestUpdateRepresentationInfo(Re,$())}})(X),G()})).catch((ke=>{U(ke)}))}))}function re(X){if(!P||P.length===0)return null;const G=P.filter((U=>U.id===X));return G.length>0?G[0]:null}function le(X){p.trigger(v.DATA_UPDATE_COMPLETED,{currentRepresentation:D,error:X},{streamId:x.id,mediaType:C})}function ue(X){D&&D.id===X.id||(function(G){(function(){if(!(T&&w&&A&&N))throw new Error(l.default.MISSING_CONFIG_ERROR)})();const U=new Date,F=1e3*A.getTime();G&&w.addRepresentationSwitch(G.adaptation.type,U,F,G.id),p.trigger(d.default.REPRESENTATION_SWITCH,{mediaType:C,streamId:x.id,currentRepresentation:G},{streamId:x.id,mediaType:C})})(X),D=X}function be(X){if(X.newDuration){const G=J();G&&G.adaptation.period&&(G.adaptation.period.duration=X.newDuration)}}return I={getCurrentCompositeRepresentation:function(){return D},getCurrentRepresentation:J,getRepresentationById:re,getStreamId:function(){return x.id},getType:$,prepareQualityChange:function(X){const G=P.filter((U=>U.id===X.id));G.length>0&&ue(G[0])},reset:function(){p.off(d.default.MANIFEST_VALIDITY_CHANGED,be,I),Z()},updateData:function(X,G,U){return new Promise(((F,ve)=>{if(P=X,ue(re(U)),C!==l.default.VIDEO&&C!==l.default.ENHANCEMENT&&C!==l.default.AUDIO&&(C!==l.default.TEXT||!G))return le(),void F();const te=[];for(let ke=0,Ee=P.length;ke<Ee;ke++){const Re=P[ke];te.push(V(Re))}Promise.all(te).then((()=>{(function(){T.setPlaybackQuality(C,x,D);const ke=w.getCurrentDVRInfo(C);ke&&w.updateManifestUpdateInfo({latency:ke.range.end-A.getTime()}),le()})(),F()})).catch((ke=>{ve(ke)}))}))}},Z(),p.on(d.default.MANIFEST_VALIDITY_CHANGED,be,I),I}pu.__dashjs_factory_name="RepresentationController";var Mm=n.default.getClassFactory(pu);function yu(b){const p=(b=b||{}).eventBus,v=b.debug,T=b.urlUtils,w=b.type,A=b.streamInfo,N=b.segmentsController,C=b.timelineConverter,x=b.baseURLController;let B,q,I,P,D;function $(){return w}function J(){I=null}function Z(X,G,U){const F=x.resolve(U.path);let ve,te,ke={};return F&&G!==F.url&&T.isRelative(G)?(ve=F.url,te=F.serviceLocation,ke=F.queryParams,G&&(ve=T.resolve(G,ve))):ve=G,!T.isRelative(ve)&&(X.url=ve,X.serviceLocation=te,X.queryParams=ke,!0)}function V(X,G,U){let F=null;if(!G||!G.segmentInfoType)return F;const ve=N.getSegmentByTime(G,U);return ve&&(I=ve,q.debug("Index for time "+U+" is "+ve.index),F=re(0,ve)),F}function re(X,G){if(G==null)return null;const U=new ne,F=G.representation,ve=F.bandwidth,te=Ri(G.media,F.id,G.replacementNumber,G.replacementSubNumber,ve,G.replacementTime);return U.adaptationIndex=F.adaptation.index,U.availabilityEndTime=G.availabilityEndTime,U.availabilityStartTime=G.availabilityStartTime,U.availabilityTimeComplete=F.availabilityTimeComplete,U.bandwidth=F.bandwidth,U.duration=G.duration,U.index=G.index,U.isPartialSegmentRequest=G.isPartialSegment,U.mediaStartTime=G.mediaStartTime,U.mediaType=$(),U.presentationStartTime=G.presentationStartTime,U.range=G.mediaRange,U.representation=F,U.startTime=G.presentationStartTime,U.timescale=F.timescale,U.type=ye.HTTPRequest.MEDIA_SEGMENT_TYPE,U.wallStartTime=G.wallStartTime,Z(U,te,F)?U:void 0}function le(X){if(!X)return{indexToRequest:0,subNumberOfPartialSegmentToRequest:NaN};const G=X.isPartialSegment,U=!isNaN(X.replacementSubNumber),F=!isNaN(X.totalNumberOfPartialSegments);if(G&&U&&F){const ve=X.replacementSubNumber+1;return ve<X.totalNumberOfPartialSegments?{indexToRequest:X.index,subNumberOfPartialSegmentToRequest:ve}:{indexToRequest:X.index+1,subNumberOfPartialSegmentToRequest:0}}return{indexToRequest:X.index+1,subNumberOfPartialSegmentToRequest:NaN}}function ue(X,G,U,F){let ve=null;const te=N.getSegmentByIndex(G,U,F,I);if(te)ve=re(0,te),I=te;else{if(P&&!D)return q.debug($()+" No segment found at index: "+U+". Wait for next loop"),null;D=!0}return ve}function be(){q.debug("Dynamic stream complete"),D=!0}return B={getCurrentIndex:function(){return I?I.index:-1},getInitRequest:function(X,G){return G?(function(U,F,ve){const te=new ne,ke=F.adaptation.period,Ee=ke.start;if(te.mediaType=ve,te.type=ye.HTTPRequest.INIT_SEGMENT_TYPE,te.range=F.range,te.availabilityStartTime=C.calcAvailabilityStartTimeFromPresentationTime(Ee,F,P),te.availabilityEndTime=C.calcAvailabilityEndTimeFromPresentationTime(Ee+ke.duration,F,P),te.representation=F,Z(te,F.initialization,F))return te.url=Ri(te.url,F.id,void 0,void 0,F.bandwidth),te})(0,G,$()):null},getLastSegment:function(){return I},getNextSegmentRequest:function(X,G){if(!G||!G.segmentInfoType)return null;if((function(ve){return ve&&I&&ve.endNumber&&I.replacementNumber&&I.replacementNumber>=ve.endNumber})(G))return D=!0,null;let{indexToRequest:U,subNumberOfPartialSegmentToRequest:F}=le(I);return ue(0,G,U,F)},getNextSegmentRequestIdempotent:function(X,G){let U=null,{indexToRequest:F,subNumberOfPartialSegmentToRequest:ve}=le(I);const te=N.getSegmentByIndex(G,F,ve,I);return te?(U=re(0,te),U):null},getSegmentRequestForTime:V,getStreamId:function(){return A.id},getStreamInfo:function(){return A},getType:$,getValidTimeAheadOfTargetTime:function(X,G,U,F){try{if(isNaN(X)||!G||!U)return NaN;if(X<0&&(X=0),isNaN(F)&&(F=.5),V(0,U,X))return X;if(U.adaptation.period.start+U.adaptation.period.duration<X)return NaN;const ve=isFinite(U.adaptation.period.duration)?U.adaptation.period.start+U.adaptation.period.duration:X+30;let te=Math.min(X+F,ve),ke=NaN,Ee=null;for(;te<=ve;){let Re=null;if(te<=ve&&(Re=V(0,U,te)),Re){ke=te,Ee=Re;break}te+=F}if(Ee){const Re=Ee.startTime+Ee.duration;return X>Ee.startTime&&Re-X>F?X:!isNaN(Ee.startTime)&&X<Ee.startTime&&ke>Ee.startTime?Ee.startTime+.001:Math.min(Re-F,ke)}return ke}catch{return NaN}},initialize:function(X){P=X,D=!1,N.initialize(X)},isLastSegmentRequested:function(X,G){return!X||!I?!1:D?!0:!isFinite(X.adaptation.period.duration)||I.presentationStartTime+I.duration>G?!1:X.mediaFinishedInformation&&!isNaN(X.mediaFinishedInformation.numberOfSegments)&&!isNaN(I.index)&&I.index>=X.mediaFinishedInformation.numberOfSegments-1&&(!P||X.segmentInfoType===Se.default.SEGMENT_TEMPLATE||P&&X.segmentInfoType===Se.default.SEGMENT_LIST&&X.adaptation.period.nextPeriodId)?!0:!!(P&&X.adaptation.period.nextPeriodId&&X.segmentInfoType===Se.default.SEGMENT_TIMELINE&&X.mediaFinishedInformation&&!isNaN(X.mediaFinishedInformation.mediaTimeOfLastSignaledSegment)&&I&&!isNaN(I.mediaStartTime)&&!isNaN(I.duration)&&I.mediaStartTime+I.duration>=X.mediaFinishedInformation.mediaTimeOfLastSignaledSegment-.05)},repeatSegmentRequest:function(X,G){return G&&G.segmentInfoType?ue(0,G,I?I.index:0,I&&I.isPartialSegment&&!isNaN(I.replacementSubNumber)?I.replacementSubNumber:NaN):null},reset:function(){J(),p.off(d.default.DYNAMIC_TO_STATIC,be,B)}},q=v.getLogger(B),J(),p.on(d.default.DYNAMIC_TO_STATIC,be,B),B}yu.__dashjs_factory_name="DashHandler";var bu=n.default.getClassFactory(yu);function Eu(b,p){const v=(b=b||{}).timelineConverter,T=b.dashMetrics;let w;function A(C,x){if((function(){if(!v)throw new Error(l.default.MISSING_CONFIG_ERROR)})(),!C)return null;x===void 0&&(x=null);let B=null;const q=v.calcMediaTimeFromPresentationTime(x,C);return(function(I,P){const D=(function(ve){return ve.adaptation.period.mpd.manifest.Period[ve.adaptation.period.index].AdaptationSet[ve.adaptation.index].Representation[ve.index].SegmentTemplate||ve.adaptation.period.mpd.manifest.Period[ve.adaptation.period.index].AdaptationSet[ve.adaptation.index].Representation[ve.index].SegmentList})(I),$=D.SegmentTimeline,J=D.SegmentURL;let Z,V,re,le,ue,be,X=0,G=-1;be=I.timescale,Z=$.S;let U=!1;const F=Z.length;for(re=0;re<F&&!U;re++)for(V=Z[re],ue=0,V.hasOwnProperty("r")&&(ue=V.r),V.hasOwnProperty("t")&&(X=V.t),ue<0&&(ue=N(I,Z[re+1],V,be,X/be)),le=0;le<=ue&&!U;le++)G++,U=P({mediaTime:X,segmentBase:D,segmentURL:J,currentSElement:V,sElementCounterIncludingRepeats:G,sElementCounter:re}),U&&(I.segmentDuration=V.d/be),X+=V.d})(C,(function(I){const P=C.timescale;return(function(D,$){const{mediaTime:J,segmentBase:Z,segmentURL:V,currentSElement:re,sElementCounterIncludingRepeats:le,sElementCounter:ue}=$,be=re.d,X=C.timescale;return D<J+be&&D>=J&&((function(G){const{segmentBase:U,segmentURL:F,sElementCounter:ve,currentSElement:te,mediaTime:ke,durationInTimescale:Ee,fTimescale:Re,requiredMediaTimeInTimescaleUnits:Oe,sElementCounterIncludingRepeats:Le}=G;let Q=(function(ie,me,K){let ge=ie.media;return me&&(ge=me[K].media||""),ge})(U,F,ve),ee=(function(ie,me,K){let ge=ie.mediaRange;return me&&(ge=me[K].mediaRange),ge})(te,F,ve);const oe=Ao(te),ae=(function(ie){if(!ie||ie.totalNumberOfPartialSegments===void 0||isNaN(ie.totalNumberOfPartialSegments)||ie.totalNumberOfPartialSegments<1)return;const{durationInTimescale:me,requiredMediaTimeInTimescaleUnits:K,mediaTime:ge,totalNumberOfPartialSegments:_e}=ie,xe=me/_e;for(let Me=0;Me<_e;Me++){const Ne=ge+Me*xe;if(K>=Ne&&K<Ne+xe)return Me}return NaN})({durationInTimescale:Ee,requiredMediaTimeInTimescaleUnits:Oe,mediaTime:ke,totalNumberOfPartialSegments:oe});B=_o({timelineConverter:v,isDynamic:p,representation:C,mediaTime:ke,durationInTimescale:Ee,fTimescale:Re,mediaUrl:Q,mediaRange:ee,index:Le,tManifest:te.tManifest,totalNumberOfPartialSegments:oe,subNumberOfPartialSegmentToRequest:ae})})({segmentBase:Z,segmentURL:V,sElementCounter:ue,currentSElement:re,mediaTime:J,durationInTimescale:be,fTimescale:X,requiredMediaTimeInTimescaleUnits:D,sElementCounterIncludingRepeats:le}),!0)})(parseFloat((q*P).toPrecision(15)),I)})),B}function N(C,x,B,q,I){let P;if(x&&x.hasOwnProperty("t"))P=x.t/q;else try{let D=0;if(isNaN(C.adaptation.period.start)||isNaN(C.adaptation.period.duration)||!isFinite(C.adaptation.period.duration)){const $=T.getCurrentDVRInfo();D=isNaN($.end)?0:$.end}else D=C.adaptation.period.start+C.adaptation.period.duration;P=v.calcMediaTimeFromPresentationTime(D,C),C.segmentDuration=B.d/q}catch{P=0}return Math.max(Math.ceil((P-I)/(B.d/q))-1,0)}return w={getMediaFinishedInformation:function(C){if(!C)return 0;const x=(C.adaptation.period.mpd.manifest.Period[C.adaptation.period.index].AdaptationSet[C.adaptation.index].Representation[C.index].SegmentTemplate||C.adaptation.period.mpd.manifest.Period[C.adaptation.period.index].AdaptationSet[C.adaptation.index].Representation[C.index].SegmentList).SegmentTimeline;let B,q,I,P,D,$,J=0,Z=0,V=0;$=C.timescale,B=x.S;const re=B.length;for(I=0;I<re;I++)for(q=B[I],D=0,q.hasOwnProperty("r")&&(D=q.r),q.hasOwnProperty("t")&&(J=q.t,Z=J/$),D<0&&(D=N(C,B[I+1],q,$,Z)),P=0;P<=D;P++)V++,J+=q.d,Z=J/$;return{numberOfSegments:V,mediaTimeOfLastSignaledSegment:Z}},getSegmentByIndex:function(C,x){return C?A(C,x&&!isNaN(x.presentationStartTime)?x.presentationStartTime+x.duration+.01:0):null},getSegmentByTime:A},w}Eu.__dashjs_factory_name="TimelineSegmentsGetter";var Dm=n.default.getClassFactory(Eu);function vu(b,p){const v=(b=b||{}).timelineConverter;let T;function w(N,C,x){if(!N)return null;const B=A(N),q=Ao(B);q!==void 0&&q>=0&&(x=x!==void 0&&x<q?x:0);const I=gu({index:C=Math.max(C,0),isDynamic:p,mediaTime:Math.round(C*N.segmentDuration*N.timescale,10),mediaUrl:B.media,representation:N,subNumberOfPartialSegmentToRequest:x,timelineConverter:v,totalNumberOfPartialSegments:q});return I&&N.endNumber&&I.replacementNumber>N.endNumber?null:I}function A(N){return N.adaptation.period.mpd.manifest.Period[N.adaptation.period.index].AdaptationSet[N.adaptation.index].Representation[N.index].SegmentTemplate}return T={getMediaFinishedInformation:function(N){const C={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};if(!N)return C;const x=N.segmentDuration;return isNaN(x)?C.numberOfSegments=1:C.numberOfSegments=Math.ceil(N.adaptation.period.duration/x),C},getSegmentByIndex:w,getSegmentByTime:function(N,C){if(!N)return null;const x=N.segmentDuration;if(isNaN(x))return null;let B=v.calcPeriodRelativeTimeFromMpdRelativeTime(N,C);const q=A(N),I=Math.floor(B/x),P=(function(D){if(!D||D.totalNumberOfPartialSegments===void 0||isNaN(D.totalNumberOfPartialSegments)||D.totalNumberOfPartialSegments<1)return;const{totalNumberOfPartialSegments:$,representation:J,requestedTimeRelativeToPeriodStart:Z,indexWithoutStartNumber:V}=D,re=V*J.segmentDuration,le=J.segmentDuration/$,ue=Z-re;let be=Math.floor(ue/le);return be=Math.max(0,Math.min(be,$-1)),be})({totalNumberOfPartialSegments:Ao(q),representation:N,requestedTimeRelativeToPeriodStart:B,indexWithoutStartNumber:I});return w(N,I,P)}},T}vu.__dashjs_factory_name="TemplateSegmentsGetter";var Om=n.default.getClassFactory(vu);function Tu(b,p){const v=(b=b||{}).timelineConverter;let T;function w(){if(!v||!v.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(l.default.MISSING_CONFIG_ERROR)}function A(N,C){if(w(),!N)return null;const x=N.adaptation.period.mpd.manifest.Period[N.adaptation.period.index].AdaptationSet[N.adaptation.index].Representation[N.index].SegmentList,B=x.SegmentURL.length,q=N&&!isNaN(N.startNumber)?N.startNumber:1,I=Math.max(q-1,0),P=Math.max(C-I,0);let D=null;if(P<B){const $=x.SegmentURL[P];D=gu({index:C,isDynamic:p,mediaRange:$.mediaRange,mediaTime:(q+C-1)*N.segmentDuration,representation:N,timelineConverter:v}),D&&(D.media=$.media?$.media:"",D.indexRange=$.indexRange)}return D}return T={getSegmentByIndex:A,getSegmentByTime:function(N,C){if(w(),!N)return null;const x=N.segmentDuration;if(isNaN(x))return null;const B=v.calcPeriodRelativeTimeFromMpdRelativeTime(N,C);return A(N,Math.floor(B/x))},getMediaFinishedInformation:function(N){const C={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};if(!N)return C;const x=N.adaptation.period.mpd.manifest.Period[N.adaptation.period.index].AdaptationSet[N.adaptation.index].Representation[N.index].SegmentList,B=N&&!isNaN(N.startNumber)?N.startNumber:1,q=Math.max(B-1,0);return C.numberOfSegments=q+x.SegmentURL.length,C}},T}Tu.__dashjs_factory_name="ListSegmentsGetter";var zm=n.default.getClassFactory(Tu);function wu(b){const p=(b=b||{}).timelineConverter;let v;function T(){if(!p||!p.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(l.default.MISSING_CONFIG_ERROR)}function w(A,N){if(T(),!A)return null;const C=A.segments?A.segments.length:-1;let x;if(N<C&&(x=A.segments[N],x&&x.index===N))return x;for(let B=0;B<C;B++)if(x=A.segments[B],x&&x.index===N)return x;return null}return v={getSegmentByIndex:w,getSegmentByTime:function(A,N){T();const C=(function(x,B){if(!x)return-1;const q=x.segments,I=q?q.length:null;let P,D,$,J,Z,V=-1;if(q&&I>0){for(Z=0;Z<I;Z++)if(D=q[Z],$=D.presentationStartTime,J=D.duration,P=J/2,B+P>=$&&B-P<$+J){V=D.index;break}}return V})(A,N);return w(A,C)},getMediaFinishedInformation:function(A){const N={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};return A&&A.segments&&(N.numberOfSegments=A.segments.length),N}},v}wu.__dashjs_factory_name="SegmentBaseGetter";var Um=n.default.getClassFactory(wu);function _u(b){b=b||{};const p=this.context,v=b.dashConstants,T=b.type,w=b.segmentBaseController;let A,N;function C(x){return x?x.segments?N[v.SEGMENT_BASE]:N[x.segmentInfoType]:null}return A={initialize:function(x){N[v.SEGMENT_TIMELINE]=Dm(p).create(b,x),N[v.SEGMENT_TEMPLATE]=Om(p).create(b,x),N[v.SEGMENT_LIST]=zm(p).create(b,x),N[v.SEGMENT_BASE]=Um(p).create(b,x)},updateInitData:function(x,B){return B?Promise.resolve():w.getSegmentBaseInitSegment({representation:x,mediaType:T})},updateSegmentData:function(x,B){return B?Promise.resolve():w.getSegmentList({mimeType:x.mimeType,representation:x,mediaType:T})},getSegmentByIndex:function(x,B,q,I){const P=C(x);return P?x.segmentInfoType?x.segmentInfoType===v.SEGMENT_TIMELINE?P.getSegmentByIndex(x,I):x.segmentInfoType===v.SEGMENT_TEMPLATE?P.getSegmentByIndex(x,B,q):P.getSegmentByIndex(x,B):P.getSegmentByIndex(x,B):null},getSegmentByTime:function(x,B){const q=C(x);return q?q.getSegmentByTime(x,B):null},getMediaFinishedInformation:function(x){const B=C(x);return B?B.getMediaFinishedInformation(x):{numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN}}},N={},A}_u.__dashjs_factory_name="SegmentsController";var Au=n.default.getClassFactory(_u);function Su(){let b;return b={ntpToUTC:function(p){const v=new Date(Date.UTC(1900,0,1,0,0,0));return new Date(v.getTime()+p).getTime()}},b}Su.__dashjs_factory_name="TimeUtils";var Bm=n.default.getSingletonFactory(Su);function ku(b){b=b||{};let p,v,T,w,A,N,C,x,B,q,I,P,D,$,J,Z,V,re,le=this.context,ue=(0,y.default)(le).getInstance(),be=b.abrController,X=b.adapter,G=b.boxParser,U=b.capabilities,F=b.dashMetrics,ve=b.errHandler,te=b.fragmentModel,ke=b.manifestModel,Ee=b.mediaController,Re=b.mediaPlayerModel,Oe=b.mimeType,Le=b.playbackController,Q=b.segmentBlacklistController,ee=b.settings,oe=b.streamInfo,ae=b.textController,ie=b.timelineConverter,me=b.type;function K(){return oe.id}function ge(){return me}function _e(){q=[],w=null,v=0,V=!1,Z=!1,P=!1,N=null,re=!1,Vt()}function xe(ut){return!isNaN(ut)&&!isNaN(oe.duration)&&isFinite(oe.duration)&&ut>=oe.start+oe.duration}function Me(ut,Ht=!0){if(ut.sender){if(Le.getIsManifestUpdateInProgress())Ze();else if((!w.isText||ae.isTextEnabled())&&p&&ut.representationId&&!p.appendInitSegmentFromCache(ut.representationId)){const dn=D.getCurrentRepresentation();if(dn.range===0)return void Ne();const ln=A?A.getInitRequest(w,dn):null;ln?te.executeRequest(ln):Ht&&($.setInitSegmentRequired(!0),Ze())}}}function Ne(ut,Ht=!0){if(Le.getIsManifestUpdateInProgress()||p.getIsPruningInProgress())return void Ze();let dn=(function(){let ln;if(isNaN(v)||ge()===l.default.TEXT&&!ae.isTextEnabled())return null;if(A){const En=bt();ln=V?A.getSegmentRequestForTime(w,En,v):Z?A.repeatSegmentRequest(w,En):A.getNextSegmentRequest(w,En)}return ln})();dn?(V=!1,Z=!1,(function(ln){isNaN(ln.startTime+ln.duration)||(v=ln.startTime+ln.duration),ln.delayLoadingTime=new Date().getTime()+$.getTimeToLoadDelay(),$.setTimeToLoadDelay(0),(function(En){let mn=En.url;return En.range&&(mn=mn.concat("_",En.range)),Q.contains(mn)})(ln)?(B.warn(`Fragment request url ${ln.url} for stream id ${oe.id} and media type ${me} is on the ignore list and will be skipped`),Ze()):(B.debug(`Next fragment request url for stream id ${oe.id} and media type ${me} is ${ln.url} with request range ${ln.range}`),te.executeRequest(ln))})(dn)):(function(ln){const En=D.getCurrentRepresentation();try{if(ee.get().streaming.gaps.enableSeekFix&&(V||Le.getTime()===0)){let mn;if(x?x&&En.segmentInfoType===Se.default.SEGMENT_TIMELINE&&(mn=(function(jn){return A.getValidTimeAheadOfTargetTime(v,w,jn,ee.get().streaming.gaps.threshold)})(En)):mn=(function(jn){let Jn=A.getValidTimeAheadOfTargetTime(v,w,jn,ee.get().streaming.gaps.threshold);return isNaN(Jn)&&v>=jn.adaptation.period.mpd.mediaPresentationDuration-jn.segmentDuration&&(Jn=v-.1),Jn})(En),!isNaN(mn)&&mn!==v)return void(function(jn,Jn){Le.isSeeking()||Le.getTime()===0?(B.warn(`Adjusting playback time ${jn} because of gap in the manifest. Seeking by ${jn-v}`),Le.seek(jn,!1,!1)):(B.warn(`Adjusting buffering time ${jn} because of gap in the manifest. Adjusting time by ${jn-v}`),zt(jn),Jn&&Ze())})(mn,ln)}}catch(mn){B.error(mn)}Ge()||ln&&Ze()})(Ht)}function Ge(){const ut=D.getCurrentRepresentation(),Ht=A.isLastSegmentRequested(ut,v);if(Ht){const dn=A.getCurrentIndex();B.debug(`Segment requesting for stream ${oe.id} has finished`),ue.trigger(u.default.STREAM_REQUESTING_COMPLETED,{segmentIndex:dn},{streamId:oe.id,mediaType:me}),p.segmentRequestingCompleted(dn),Qe()}return Ht}function Ze(){const ut=Re.getScheduleTimeout();$.startScheduleTimer(ut)}function ht(ut){F.addBufferState(me,ut.state,$.getBufferTarget()),ut.state!==i.BUFFER_EMPTY||Le.isSeeking()||(B.info("Buffer is empty! Stalling!"),F.pushPlayListTraceMetrics(new Date,pa.REBUFFERING_REASON))}function wt(ut){te.syncExecutedRequestsWithBufferedRange(p.getBuffer().getAllBufferRanges(),oe.duration),ut.quotaExceeded&&ut.from>Le.getTime()&&zt(ut.from),ut.hasEnoughSpaceToAppend&&ut.quotaExceeded&&$.startScheduleTimer()}function Wt(ut){if(!ut||!ut.lastRequestAppended||!ut.lastRequestAppended.url)return;let Ht=ut.lastRequestAppended.url;ut.lastRequestAppended.range&&(Ht=Ht.concat("_",ut.lastRequestAppended.range)),B.warn(`Blacklisting segment with url ${Ht}`),Q.add(Ht)}function At(ut){if(B.debug(`Appended bytes for ${ut.mediaType} and stream id ${ut.streamId}`),ut.segmentType===ye.HTTPRequest.INIT_SEGMENT_TYPE){const Ht=ut.representationId;$.setLastInitializedRepresentationId(Ht),B.info("["+me+"] lastInitializedRepresentationId changed to "+Ht)}I&&I.enabled?pt(I.newRepresentation,I.oldRepresentation):re||$.startScheduleTimer(0)}function Vt(){I={newRepresentation:null,oldRepresentation:null,enabled:!1}}function on(ut){return new Promise((Ht=>{if(!D)return Promise.resolve();let dn=null;var ln;dn=ut.newRepresentation?{selectedRepresentation:(ln=ut).newRepresentation,currentMediaInfo:ln.newMediaInfo}:w!==null&&X.areMediaInfosEqual(w,ut.newMediaInfo)?(function(mn){return{currentMediaInfo:mn.newMediaInfo,selectedRepresentation:D.getCurrentRepresentation()}})(ut):(function(mn){let jn=NaN;return jn=!ee.get().streaming.abr.autoSwitchBitrate[mn.newMediaInfo.type]&&mn.previouslySelectedRepresentation?mn.previouslySelectedRepresentation.bitrateInKbit:be.getInitialBitrateFor(me),{selectedRepresentation:be.getOptimalRepresentationForBitrate(mn.newMediaInfo,jn,!1),currentMediaInfo:mn.newMediaInfo}})(ut),kn(dn.currentMediaInfo),ue.trigger(),(function(mn){N&&mn.selectedRepresentation.dependentRepresentation&&(B.info("["+me+"] selectMediaInfo : call selectMediaInfo on enhancementStreamProcessor for index = "+mn.selectedRepresentation.absoluteIndex),N.selectMediaInfo(new hr({newMediaInfo:mn.selectedRepresentation.mediaInfo,newRepresentation:mn.selectedRepresentation})))})(dn);const En=be.getPossibleVoRepresentations(w,!1);return D.updateData(En,w.isFragmented,dn.selectedRepresentation.id).then((()=>{(function(){const mn=D.getCurrentCompositeRepresentation();p.getIsBufferingCompleted()||p.updateBufferTimestampOffset(mn)})(),Ht()})).catch((mn=>{B.error(mn),Ht()}))}))}function kn(ut){X.areMediaInfosEqual(w,ut)||ue.trigger(d.default.NEW_TRACK_SELECTED,{value:ut}),w=ut,be.handleNewMediaInfo(w),ue.trigger(u.default.MEDIAINFO_UPDATED,{mediaType:me,streamId:oe.id,currentMediaInfo:w})}function vn(ut){const Ht=ut.newRepresentation,dn=ut.oldRepresentation,ln=yn();Ht&&dn||B.warn("_handleDifferentSwitchTypes() is missing the target representations"),ut.reason&&ut.reason.forceReplace?(function(En,mn){te.abortRequests(),ue.trigger(u.default.BUFFER_REPLACEMENT_STARTED,{mediaType:me,streamId:oe.id},{mediaType:me,streamId:oe.id}),$.setShouldCheckPlaybackQuality(!1),p.prepareForForceReplacementQualitySwitch(En,mn).then((()=>{cn()})).catch((()=>{cn()}))})(Ht,dn):ut&&ut.reason&&ut.reason.forceAbandon?(function(En,mn){p.prepareForAbandonQualitySwitch(En,mn).then((()=>{pn()})).catch((()=>{pn()}))})(Ht,dn):!Re.getFastSwitchEnabled()||ln&&ln.isPartialSegment?pt(Ht,dn):(function(En,mn){const jn=Le.getTime();let Jn=1.5*(isNaN(En.fragmentDuration)?1:En.fragmentDuration);const $a=te.getRequests({state:Ue.FRAGMENT_MODEL_EXECUTED,time:jn+Jn,threshold:0})[0];if($a&&!w.isText){const Va=p.getBufferLevel(),ir=be.getAbandonmentStateFor(oe.id,me);$a.bandwidth<En.bandwidth&&Va>=Jn&&ir===i.ALLOW_LOAD?p.prepareForFastQualitySwitch(En,mn).then((()=>{We(jn,Jn)})).catch((()=>{We(jn,Jn)})):pt(En,mn)}else pt(En,mn)})(Ht,dn),F.pushPlayListTraceMetrics(new Date,pa.REPRESENTATION_SWITCH_STOP_REASON),F.createPlaylistTraceMetrics(Ht.id,1e3*Le.getTime(),Le.getPlaybackRate())}function cn(){Ce(),Vt(),P=!1}function pn(){te.abortRequests(),Z=!0,$.setShouldCheckPlaybackQuality(!1),$.startScheduleTimer(),P=!1}function We(ut,Ht){te.abortRequests(),zt(ut+Ht),$.setShouldCheckPlaybackQuality(!1),$.startScheduleTimer(),P=!1}function pt(ut,Ht){const dn=te.getRequests({state:Ue.FRAGMENT_MODEL_LOADING});if(dn&&dn.length>0)return B.debug("Preparing for default quality switch: Waiting for ongoing segment request to be finished before applying switch."),I.newRepresentation=ut,I.oldRepresentation=Ht,void(I.enabled=!0);p.prepareForDefaultQualitySwitch(ut,Ht).then((()=>{gt()})).catch((()=>{gt()}))}function gt(){$.setShouldCheckPlaybackQuality(!1),w.segmentAlignment||w.subSegmentAlignment?$.startScheduleTimer():rt(),Vt(),P=!1}function St(ut){B.info("onFragmentLoadingAbandoned request: "+ut.request.url+" has been aborted"),Le.isSeeking()||$.getSwitchTrack()||P||(B.info("onFragmentLoadingAbandoned request: "+ut.request.url+" has to be downloaded again, origin is not seeking process or switch track call"),ut.request&&ut.request.isInitializationRequest()?$.setInitSegmentRequired(!0):zt(ut.request.startTime+ut.request.duration/2),$.startScheduleTimer(0))}function Kt(ut){B.info("OnFragmentLoadingCompleted for stream id "+oe.id+" and media type "+me+" - Url:",ut.request?ut.request.url:"undefined",ut.request.range?", Range:"+ut.request.range:""),w.isText&&$.startScheduleTimer(0),ut.error&&ut.request.serviceLocation&&(function(Ht){B.info("Fragment loading completed with an error"),Ht&&Ht.request&&Ht.request.type&&(Ht.request.type===ye.HTTPRequest.INIT_SEGMENT_TYPE?Me({representationId:Ht.request.representation.id,sender:{}},!1):Ht.request.type===ye.HTTPRequest.MEDIA_SEGMENT_TYPE&&(zt(Ht.request.startTime+Ht.request.duration/2),Ne(0,!1)))})(ut)}function gn(){zt(Le.getTime()),je().startScheduleTimer()}function ot(ut){const Ht=ut.currentTrackInfo;if(!Ht)return;const dn=q.find((ln=>ln.index===Ht.index&&ln.lang===Ht.lang));dn&&on(new hr({newMediaInfo:dn})).then((()=>{p.setIsBufferingCompleted(!1),zt(Le.getTime()),$.setInitSegmentRequired(!0),$.startScheduleTimer()}))}function _t(ut){zt(ut.quotaExceededTime),Qe()}function Ut(){return p?p.getBuffer():null}function je(){return $}function Qe(){$&&$.clearScheduleTimer()}function bt(ut=NaN){let Ht;return isNaN(ut)?Ht=D?D.getCurrentRepresentation():null:((0,ct.checkInteger)(ut),Ht=D?D.getRepresentationById(ut):null),Ht}function Je(){return!!p&&p.getIsBufferingCompleted()}function Rt(ut){if(!ee.get().streaming.enableManifestTimescaleMismatchFix)return;const Ht=ut.chunk,dn=Ht.bytes,ln=bt(Ht.representation.id);ln&&(ln.timescale=G.getMediaTimescaleFromMoov(dn))}function Lt(ut){const Ht=ut.chunk,dn=Ht.bytes,ln=bt(Ht.representation.id);if(ln){let En;if(ee.get().streaming.parseInbandPrft&&ut.request.type===ye.HTTPRequest.MEDIA_SEGMENT_TYPE){En=En||G.parse(dn);const Jn=(function($a,Va){const ir=$a.getBoxes("prft"),Yr=[];return ir.forEach((Cr=>{Yr.push((function(Ba,Lr){let Fa="unknown";switch(Ba.flags){case 0:Fa=Se.default.PRODUCER_REFERENCE_TIME_TYPE.ENCODER;break;case 16:Fa=Se.default.PRODUCER_REFERENCE_TIME_TYPE.APPLICATION;break;case 24:Fa=Se.default.PRODUCER_REFERENCE_TIME_TYPE.CAPTURED}let Wa=1e3*Ba.ntp_timestamp_sec+Ba.ntp_timestamp_frac/2**32*1e3;return Wa=Bm(le).getInstance().ntpToUTC(Wa),{type:Fa,ntpTimestamp:Wa,mediaTime:Ba.media_time/Lr}})(Cr,Va))})),Yr})(En,ln.timescale);Jn&&Jn.length&&ue.trigger(d.default.INBAND_PRFT,{data:Jn},{streamId:oe.id,mediaType:me})}const mn=X.getEventsFor(ln.mediaInfo,null,oe),jn=X.getEventsFor(ln,ln,oe);if(mn&&mn.length>0||jn&&jn.length>0){const Jn=ut.request;En=En||G.parse(dn);const $a=(function(Va,ir,Yr,Cr){try{const Ba={},Lr=[],Fa=Yr.concat(Cr);for(let Ia=0,di=Fa.length;Ia<di;Ia++)Ba[Fa[Ia].schemeIdUri+"/"+Fa[Ia].value]=Fa[Ia];const Wa=Va.getBoxes("emsg");if(!Wa||Wa.length===0)return Lr;const qa=Va.getBox("sidx"),ui=!qa||isNaN(qa.earliest_presentation_time)||isNaN(qa.timescale)?ir&&!isNaN(ir.mediaStartTime)?ir.mediaStartTime:0:qa.earliest_presentation_time/qa.timescale,gs=Math.max(ui,0),ps=D.getCurrentRepresentation();for(let Ia=0,di=Wa.length;Ia<di;Ia++){const Kr=X.getEvent(Wa[Ia],Ba,gs,ps);Kr&&Lr.push(Kr)}return Lr}catch{return[]}})(En,Jn,mn,jn);ue.trigger(u.default.INBAND_EVENTS,{events:$a},{streamId:oe.id})}}}function Ce(){const ut=Le.getTime();ee.get().streaming.buffer.flushBufferAtTrackSwitch&&Le.seek(ut+.001,!1,!0),zt(ut),p.setSeekTarget(ut),$.startScheduleTimer()}function rt(){const ut=Le.getTime(),Ht=p.getContinuousBufferTimeForTargetTime(ut);zt(isNaN(Ht)?ut:Ht),$.startScheduleTimer()}function Pt(ut){ut&&!isNaN(ut.time)&&(zt(ut.time),p.setSeekTarget(ut.time))}function zt(ut){v=ut,V=!0}function yn(){return A.getLastSegment()}return C={checkAndHandleCompletedBuffering:Ge,clearScheduleTimer:Qe,createBufferSinks:function(ut,Ht){const dn=Ut();return dn?Promise.resolve(dn):p?p.createBufferSink(w,ut,Ht):Promise.resolve(null)},dischargePreBuffer:function(){p.dischargePreBuffer()},finalisePlayList:function(ut,Ht){F.pushPlayListTraceMetrics(ut,Ht)},getAllMediaInfos:function(){return q},getBuffer:Ut,getBufferController:function(){return p},getBufferLevel:function(){return p?p.getBufferLevel():0},getFragmentModel:function(){return te},getLastSegment:yn,getMediaInfo:function(){return w},getMediaSource:function(){return p.getMediaSource()},getRepresentation:bt,getRepresentationController:function(){return D},getScheduleController:je,getStreamId:K,getStreamInfo:function(){return oe},getType:ge,initialize:function(ut,Ht,dn){J=Au(le).create({events:u.default,eventBus:ue,streamInfo:oe,timelineConverter:ie,dashConstants:Se.default,segmentBaseController:b.segmentBaseController,type:me}),A=bu(le).create({baseURLController:b.baseURLController,boxParser:G,constants:l.default,dashConstants:Se.default,dashMetrics:F,debug:(0,c.default)(le).getInstance(),errHandler:ve,errors:Yt,eventBus:ue,events:u.default,mediaPlayerModel:Re,segmentsController:J,settings:ee,streamInfo:oe,timelineConverter:ie,type:me,urlUtils:Un(le).getInstance()}),x=oe.manifestInfo.isDynamic,A.initialize(x),be.registerStreamType(me,C),D=Mm(le).create({abrController:be,adapter:X,dashConstants:Se.default,dashMetrics:F,errors:Yt,eventBus:ue,events:u.default,isDynamic:x,playbackController:Le,segmentsController:J,streamInfo:oe,timelineConverter:ie,type:me}),p=(function(ln,En){let mn=null;return ln?(mn=ln!==l.default.TEXT||En?xm(le).create({abrController:be,capabilities:U,errHandler:ve,fragmentModel:te,manifestModel:ke,mediaController:Ee,mediaPlayerModel:Re,playbackController:Le,representationController:D,settings:ee,streamInfo:oe,textController:ae,type:ln}):Cm(le).create({errHandler:ve,fragmentModel:te,mimeType:Oe,settings:ee,streamInfo:oe,textController:ae,type:ln}),mn):(ve.error(new Bt.default(Yt.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,Yt.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+"not properly defined")),null)})(me,dn),p&&p.initialize(ut),$=Lm(le).create({abrController:be,adapter:X,bufferController:p,dashMetrics:F,fragmentModel:te,mediaController:Ee,mediaPlayerModel:Re,mimeType:Oe,playbackController:Le,representationController:D,settings:ee,streamInfo:oe,textController:ae,type:me}),T=Ht,$.initialize(Ht),v=0,V=!1,Z=!1},isBufferingCompleted:Je,prepareInnerPeriodPlaybackSeeking:function(ut){return new Promise((Ht=>{if(p.hasBufferAtTime(ut.seekTime))return p.pruneBuffer(),xe(p.getContinuousBufferTimeForTargetTime(ut.seekTime))&&p.setIsBufferingCompleted(!0),void Ht();Qe(),te.abortRequests(),p.prepareForPlaybackSeek().then((()=>{const dn=p.getAllRangesWithSafetyFactor(ut.seekTime);return p.clearBuffers(dn)})).then((()=>{const dn=p.getContinuousBufferTimeForTargetTime(ut.seekTime);if(xe(dn))p.setIsBufferingCompleted(!0),Ht();else{const ln=isNaN(dn)?ut.seekTime:dn;zt(ln),p.setSeekTarget(ln);const En=[];En.push(p.updateAppendWindow());const mn=bt();En.push(p.updateBufferTimestampOffset(mn)),Promise.all(En).then((()=>{$.setInitSegmentRequired(!0),$.setShouldCheckPlaybackQuality(!1),$.startScheduleTimer(),Ht()}))}})).catch((dn=>{B.error(dn)}))}))},prepareOuterPeriodPlaybackSeeking:function(){return new Promise(((ut,Ht)=>{try{Qe(),te.abortRequests(),p.prepareForPlaybackSeek().then((()=>p.pruneAllSafely())).then((()=>{ut()}))}catch(dn){Ht(dn)}}))},prepareQualityChange:function(ut){ut.newRepresentation&&((function(Ht){if(N)N.prepareQualityChange(Ht);else if(me===l.default.ENHANCEMENT){const dn=Ht.oldRepresentation.mediaInfo.type,ln=Ht.newRepresentation.mediaInfo.type;if(dn===l.default.ENHANCEMENT&&ln===l.default.VIDEO)return B.info("Stop "+me+" stream processor"),$.reset(),!0;if(dn===l.default.VIDEO&&ln===l.default.ENHANCEMENT)return B.info("Start "+me+" stream processor"),on(new hr({newMediaInfo:Ht.newRepresentation.mediaInfo,newRepresentation:Ht.newRepresentation})).then((()=>{$.setup(),$.initialize(T),$.startScheduleTimer()})),!0}return!1})(ut)||(I&&I.enabled&&B.warn(`Canceling queued representation switch to ${I.newRepresentation.id} for ${me}`),ut.isAdaptationSetSwitch?(B.debug(`Preparing quality switch to different AdaptationSet for type ${me} from representation id ${ut.oldRepresentation.id} to ${ut.newRepresentation.id}`),(function(Ht){const dn=Ht.newRepresentation;P=!0,Qe(),$.setSwitchTrack(!0);const ln=dn.mediaInfo;kn(ln),on(new hr({newMediaInfo:ln,newRepresentation:dn})).then((()=>{vn(Ht)}))})(ut)):(B.debug(`Preparing quality within the same AdaptationSet for type ${me} from representation id ${ut.oldRepresentation.id} to ${ut.newRepresentation.id}`),(function(Ht){const dn=Ht.newRepresentation;P=!0,Qe(),D.prepareQualityChange(dn),vn(Ht)})(ut))))},prepareTrackSwitch:function(ut,Ht=!1){return new Promise((dn=>{B.debug(`Preparing track switch for type ${me}`);const ln=me===l.default.TEXT||Ht||ee.get().streaming.trackSwitchMode[me]===l.default.TRACK_SWITCH_MODE_ALWAYS_REPLACE&&Le.getTimeToStreamEnd(oe)>ee.get().streaming.buffer.stallThreshold;p.getIsBufferingCompleted()&&!ln?(function(En){return new Promise((mn=>{const jn=D.getCurrentRepresentation();p.prepareForNonReplacementTrackSwitch(jn,En).then((()=>{ue.trigger(u.default.BUFFERING_COMPLETED,{},{streamId:oe.id,mediaType:me}),mn()})).catch((()=>{ue.trigger(u.default.BUFFERING_COMPLETED,{},{streamId:oe.id,mediaType:me}),mn()}))}))})(ut).then((()=>{dn()})):($.setSwitchTrack(!0),ln?(function(En){return new Promise((mn=>{ue.trigger(u.default.BUFFER_REPLACEMENT_STARTED,{mediaType:me,streamId:oe.id},{mediaType:me,streamId:oe.id}),te.abortRequests();const jn=bt();p.prepareForReplacementTrackSwitch(jn,En).then((()=>{Ce(),mn()})).catch((()=>{Ce(),mn()}))}))})(ut).then((()=>{dn()})):(function(En){return new Promise((mn=>{const jn=()=>{const Jn=te.getRequests({state:Ue.FRAGMENT_MODEL_LOADING});if(Jn&&Jn.length!==0)ue.once(d.default.FRAGMENT_LOADING_COMPLETED,jn,C);else{const $a=bt();p.prepareForNonReplacementTrackSwitch($a,En).then((()=>{rt(),mn()})).catch((Va=>{B.error(Va),rt(),mn()}))}};jn()}))})(ut).then((()=>{dn()})))}))},probeNextRequest:function(){const ut=bt();return A.getNextSegmentRequestIdempotent(w,ut)},reset:function(ut,Ht){A&&A.reset(),p&&(p.reset(ut,Ht),p=null),$&&($.reset(),$=null),D&&(D.reset(),D=null),J&&(J=null),be&&be.unRegisterStreamType(K(),me),ue.off(u.default.BUFFER_CLEARED,wt,C),ue.off(u.default.BUFFER_LEVEL_STATE_CHANGED,ht,C),ue.off(u.default.BYTES_APPENDED_END_FRAGMENT,At,C),ue.off(u.default.FRAGMENT_LOADING_ABANDONED,St,C),ue.off(u.default.FRAGMENT_LOADING_COMPLETED,Kt,C),ue.off(u.default.INIT_FRAGMENT_LOADED,Rt,C),ue.off(u.default.INIT_FRAGMENT_NEEDED,Me,C),ue.off(u.default.MEDIA_FRAGMENT_LOADED,Lt,C),ue.off(u.default.MEDIA_FRAGMENT_NEEDED,Ne,C),ue.off(u.default.QUOTA_EXCEEDED,_t,C),ue.off(u.default.SEEK_TARGET,Pt,C),ue.off(u.default.SET_FRAGMENTED_TEXT_AFTER_DISABLED,gn,C),ue.off(u.default.SET_NON_FRAGMENTED_TEXT,ot,C),ue.off(u.default.SOURCE_BUFFER_ERROR,Wt,C),_e(),me=null,oe=null},selectMediaInfo:on,setEnhancementStreamProcessor:function(ut){N=ut,B.info("enhancementStreamProcessor = "+N)},setExplicitBufferingTime:zt,setMediaInfoArray:function(ut){q=ut},setMediaSource:function(ut){return p.setMediaSource(ut,w)},setTrackSwitchInProgress:function(ut){re=ut},updateStreamInfo:function(ut){return oe=ut,Je()?Promise.resolve():p.updateAppendWindow()}},B=(0,c.default)(le).getInstance().getLogger(C),_e(),ue.on(u.default.BUFFER_CLEARED,wt,C),ue.on(u.default.BUFFER_LEVEL_STATE_CHANGED,ht,C),ue.on(u.default.BYTES_APPENDED_END_FRAGMENT,At,C),ue.on(u.default.FRAGMENT_LOADING_ABANDONED,St,C),ue.on(u.default.FRAGMENT_LOADING_COMPLETED,Kt,C),ue.on(u.default.INIT_FRAGMENT_LOADED,Rt,C),ue.on(u.default.INIT_FRAGMENT_NEEDED,Me,C),ue.on(u.default.MEDIA_FRAGMENT_LOADED,Lt,C),ue.on(u.default.MEDIA_FRAGMENT_NEEDED,Ne,C),ue.on(u.default.QUOTA_EXCEEDED,_t,C),ue.on(u.default.SEEK_TARGET,Pt,C),ue.on(u.default.SET_FRAGMENTED_TEXT_AFTER_DISABLED,gn,C),ue.on(u.default.SET_NON_FRAGMENTED_TEXT,ot,C),ue.on(u.default.SOURCE_BUFFER_ERROR,Wt,C),C}ku.__dashjs_factory_name="StreamProcessor";var Fm=n.default.getClassFactory(ku),qm=class{constructor(){this.url=null,this.width=null,this.height=null,this.x=null,this.y=null}},jm=class{constructor(){this.bitrate=0,this.width=0,this.height=0,this.tilesHor=0,this.tilesVert=0,this.widthPerTile=0,this.heightPerTile=0,this.startNumber=0,this.segmentDuration=0,this.timescale=0,this.templateUrl="",this.id=""}};function Iu(b){const p=this.context,v=b.adapter,T=b.baseURLController,w=b.streamInfo,A=b.timelineConverter,N=b.debug,C=b.eventBus,x=b.events,B=b.dashConstants,q=Un(p).getInstance();let I,P,D,$,J,Z,V,re,le;function ue(X,G){const U=new jm;U.id=X.id,U.bitrate=X.bandwidth,U.width=X.width,U.height=X.height,U.tilesHor=1,U.tilesVert=1,X.essentialProperties&&X.essentialProperties.forEach((F=>{if(l.default.THUMBNAILS_SCHEME_ID_URIS.indexOf(F.schemeIdUri)>=0&&F.value){const ve=F.value.split("x");ve.length!==2||isNaN(ve[0])||isNaN(ve[1])||(U.tilesHor=parseInt(ve[0],10),U.tilesVert=parseInt(ve[1],10))}})),G?V.updateSegmentData(X).then((F=>{(function(ve,te,ke){let Ee=[];const Re=(function(Oe,Le){const Q=[];let ee,oe,ae,ie,me=0;for(ee=0,oe=Oe.segments.length;ee<oe;ee++)ae=Oe.segments[ee],ie=_o({durationInTimescale:ae.duration,fTimescale:ae.timescale,index:me,isDynamic:v.getIsDynamic(),mediaRange:ae.mediaRange,mediaTime:ae.startTime,mediaUrl:ae.media,representation:Le,timelineConverter:A}),ie&&(Q.push(ie),ie=null,me++);return Q})(ke,te);te.segments=Re,te.fragmentDuration=te.segmentDuration||(te.segments&&te.segments.length>0?te.segments[0].duration:NaN),ve.segmentDuration=te.segments[0].duration,ve.readThumbnail=function(Oe,Le){let Q=null;Ee.some((ee=>{if(ee.start<=Oe&&ee.end>Oe)return Q=ee.url,!0})),Q?Le(Q):te.segments.some((ee=>{if(ee.mediaStartTime<=Oe&&ee.mediaStartTime+ee.duration>Oe){const oe=T.resolve(te.path),ae=new oo({method:"get",url:oe.url,responseType:"arraybuffer",customData:{request:{range:ee.mediaRange},onloadend:function(me){let K=le.getSamplesInfo(me.target.response),ge=new Blob([me.target.response.slice(K.sampleList[0].offset,K.sampleList[0].offset+K.sampleList[0].size)],{type:"image/jpeg"}),_e=window.URL.createObjectURL(ge);Ee.push({start:ee.mediaStartTime,end:ee.mediaStartTime+ee.duration,url:_e}),Le&&Le(_e)}}}),ie=new lo({request:ae});return re.load(ae,ie),!0}}))}})(U,X,F)})):(U.startNumber=X.startNumber,U.segmentDuration=X.segmentDuration,U.timescale=X.timescale,U.templateUrl=(function(F){const ve=q.isRelative(F.media)?q.resolve(F.media,T.resolve(F.path).url):F.media;return ve?Ri(ve,F.id):""})(X)),U.tilesHor>0&&U.tilesVert>0&&(U.widthPerTile=U.width/U.tilesHor,U.heightPerTile=U.height/U.tilesVert,P.push(U))}function be(){P=[],D=[],J=-1,Z=null,$&&($.reset(),$=null)}return I={addTracks:function(){if(!w||!v||(Z=v.getMediaInfoForType(w,l.default.IMAGE),!Z))return;const X=v.getVoRepresentations(Z);X&&X.length>0&&X.forEach((G=>{(G.segmentInfoType===Se.default.SEGMENT_TEMPLATE&&G.segmentDuration>0&&G.media||G.segmentInfoType===Se.default.SEGMENT_TIMELINE)&&ue(G),G.segmentInfoType===Se.default.SEGMENT_BASE&&ue(G,!0),D.push(G)})),P.length>0&&P.sort(((G,U)=>G.bitrate-U.bitrate))},getCurrentTrack:function(){return J<0?null:P[J]},getCurrentTrackIndex:function(){return J},getRepresentations:function(){return D},getThumbnailRequestForTime:function(X){let G;const U=v.getVoRepresentations(Z);for(let F=0;F<U.length;F++)if(P[J].id===U[F].id){G=U[F];break}return $.getSegmentRequestForTime(Z,G,X)},getTracks:function(){return P},reset:be,setTrackById:function(X){if(!P||P.length===0)return;const G=P.findIndex((U=>U.id===X));G!==-1&&(J=G)},setTrackByIndex:function(X){P&&P.length!==0&&(X>=P.length&&(X=P.length-1),J=X)}},be(),re=Qt(p).create({}),le=rs(p).getInstance(),V=Au(p).create({events:x,eventBus:C,streamInfo:w,timelineConverter:A,dashConstants:B,dashMetrics:b.dashMetrics,segmentBaseController:b.segmentBaseController,type:l.default.IMAGE}),$=bu(p).create({streamInfo:w,type:l.default.IMAGE,timelineConverter:A,segmentsController:V,baseURLController:T,debug:N,eventBus:C,events:x,dashConstants:B,urlUtils:q}),$.initialize(!!v&&v.getIsDynamic()),I}Iu.__dashjs_factory_name="ThumbnailTracks";var Hm=n.default.getClassFactory(Iu);function Ru(b){const p=this.context,v=b.streamInfo;let T,w;function A(C){w.setTrackByIndex(C)}function N(){w&&w.reset()}return T={getCurrentTrack:function(){return w.getCurrentTrack()},getCurrentTrackIndex:function(){return w.getCurrentTrackIndex()},getPossibleVoRepresentations:function(){return w.getRepresentations()},getStreamId:function(){return v.id},initialize:function(){w.addTracks();const C=w.getTracks();C&&C.length>0&&A(0)},provide:function(C,x){if(typeof x!="function")return;const B=w.getCurrentTrack();let q,I;if(!B||B.segmentDuration<=0||C==null)return void x(null);I=w.getThumbnailRequestForTime(C),I&&(B.segmentDuration=I.duration),q=C%B.segmentDuration;const P=Math.floor(q*B.tilesHor*B.tilesVert/B.segmentDuration),D=new qm;if(D.width=Math.floor(B.widthPerTile),D.height=Math.floor(B.heightPerTile),D.x=Math.floor(P%B.tilesHor)*B.widthPerTile,D.y=Math.floor(P/B.tilesHor)*B.heightPerTile,"readThumbnail"in B)return B.readThumbnail(C,($=>{D.url=$,x(D)}));if(I)D.url=I.url,B.segmentDuration=NaN;else{const $=Math.floor(C/B.segmentDuration);D.url=(function(J,Z){const V=Z+J.startNumber;return Ri(J.templateUrl,void 0,V,void 0,J.bandwidth,(V-1)*J.segmentDuration*J.timescale)})(B,$)}x(D)},reset:N,setTrackByIndex:A,setTrackById:function(C){w.setTrackById(C)}},N(),w=Hm(p).create({streamInfo:v,adapter:b.adapter,baseURLController:b.baseURLController,timelineConverter:b.timelineConverter,debug:b.debug,eventBus:b.eventBus,events:b.events,dashConstants:b.dashConstants,dashMetrics:b.dashMetrics,segmentBaseController:b.segmentBaseController}),T}Ru.__dashjs_factory_name="ThumbnailController";var Gm=n.default.getClassFactory(Ru);const Ym=[l.default.VIDEO,l.default.AUDIO,l.default.TEXT,l.default.MUXED,l.default.IMAGE];function xu(b){b=b||{};const p=this.context,v=(0,y.default)(p).getInstance(),T=Un(p).getInstance(),w=b.manifestModel,A=b.mediaPlayerModel,N=b.dashMetrics,C=b.manifestUpdater,x=b.adapter,B=b.timelineConverter,q=b.capabilities,I=b.errHandler,P=b.abrController,D=b.playbackController,$=b.throughputController,J=b.eventController,Z=b.mediaController,V=b.protectionController,re=b.textController,le=b.videoModel;let ue=b.streamInfo;const be=b.settings;let X,G,U,F,ve,te,ke,Ee,Re,Oe,Le,Q,ee,oe,ae,ie;function me(ot,_t,Ut){return new Promise(((je,Qe)=>{ht(),Wt();let bt=le.getElement();const Je=[];Ym.forEach((Rt=>{if((Rt!==l.default.TEXT||ot)&&(Rt!==l.default.VIDEO||!bt||bt&&/^VIDEO$/i.test(bt.nodeName))){const Lt=Ut.find((Ce=>Ce.mediaInfo.type===Rt));Je.push(K(Rt,ot,Lt))}})),Promise.all(Je).then((()=>(function(Rt){return new Promise((Lt=>{const Ce={},rt=oe.map((Pt=>{const zt=Pt.getRepresentation();return Pt.createBufferSinks(Rt,zt)}));Promise.all(rt).then((Pt=>{Pt.forEach((zt=>{zt&&(Ce[zt.getType()]=zt)})),Lt(Ce)})).catch((()=>{Lt(Ce)}))}))})(_t))).then((Rt=>{if(oe.length===0){const Lt="No streams to play.";I.error(new Bt.default(Yt.MANIFEST_ERROR_ID_NOSTREAMS_CODE,Lt,w.getValue())),Le.fatal(Lt)}else St();ot&&re.createTracks(ue),je(Rt)})).catch((Rt=>{Qe(Rt)}))}))}function K(ot,_t,Ut){let je,Qe=x.getAllMediaInfoForType(ue,ot),bt=[],Je=null,Rt=-1;if(!Qe||Qe.length===0)return Le.info("No "+ot+" data."),Promise.resolve();ot===l.default.VIDEO&&(te=!0),ot===l.default.AUDIO&&(F=!0);for(let Ce=0,rt=Qe.length;Ce<rt;Ce++)Je=Qe[Ce],ot===l.default.TEXT&&Je.isEmbedded&&(re.addEmbeddedTrack(ue,Je),bt.push(Je)),ge(Je)&&Z.addTrack(Je),Je.type===l.default.ENHANCEMENT&&(Rt=Ce);if(bt.length>0&&(Z.setInitialMediaSettingsForType(ot,ue),re.addMediaInfosToBuffer(ue,ot,bt)),Qe=Qe.filter((Ce=>!Ce.isEmbedded)),Qe.length===0)return Promise.resolve();if(ot===l.default.IMAGE)return ae=Gm(p).create({streamInfo:ue,adapter:x,baseURLController:b.baseURLController,timelineConverter:b.timelineConverter,debug:G,eventBus:v,events:u.default,dashConstants:Se.default,dashMetrics:b.dashMetrics,segmentBaseController:b.segmentBaseController}),ae.initialize(),Promise.resolve();v.trigger(u.default.STREAM_INITIALIZING,{streamInfo:ue,mediaInfo:Je}),Z.setInitialMediaSettingsForType(ot,ue);let Lt=_e(Qe,_t,ot);if(Rt>=0){let Ce=new _m(v);Ce.open(),Ce.duration=ue.manifestInfo.duration;let rt=_e(Qe,Ce,l.default.ENHANCEMENT);rt.selectMediaInfo(new hr({newMediaInfo:Qe[Rt]})),Lt.setEnhancementStreamProcessor(rt)}if(je=Z.getCurrentTrackFor(ot,ue.id),je){const Ce=ot===l.default.TEXT&&je.isEmbedded?Qe[0]:je,rt=new hr({newMediaInfo:Ce,previouslySelectedRepresentation:Ut});return Lt.selectMediaInfo(rt)}return Promise.resolve()}function ge(ot){const _t=ot?ot.type:null;let Ut;return _t===l.default.MUXED?(Ut="Multiplexed representations are intentionally not supported, as they are not compliant with the DASH-AVC/264 guidelines",Le.fatal(Ut),I.error(new Bt.default(Yt.MANIFEST_ERROR_ID_MULTIPLEXED_CODE,Ut,w.getValue())),!1):!(_t!==l.default.TEXT&&_t!==l.default.IMAGE&&ot.contentProtection&&ot.contentProtection.length>0&&!q.supportsEncryptedMedia()&&(I.error(new Bt.default(Yt.CAPABILITY_MEDIAKEYS_ERROR_CODE,Yt.CAPABILITY_MEDIAKEYS_ERROR_MESSAGE)),1))}function _e(ot,_t,Ut){const je=ot&&ot.length>0?ot.filter((Ce=>Ce.type===Ut))[0]:null;let Qe=U.getModel(je?je.type:null);const bt=je?je.type:null,Je=je?je.mimeType:null,Rt=je?je.isFragmented:null;let Lt=Fm(p).create({abrController:P,adapter:x,baseURLController:b.baseURLController,boxParser:X,capabilities:q,dashMetrics:b.dashMetrics,errHandler:I,fragmentModel:Qe,manifestModel:w,mediaController:Z,mediaPlayerModel:A,mimeType:Je,playbackController:D,segmentBaseController:b.segmentBaseController,segmentBlacklistController:ee,settings:be,streamInfo:ue,textController:re,throughputController:$,timelineConverter:B,type:bt});return Lt.initialize(_t,te,Rt),oe.push(Lt),Lt.setMediaInfoArray(ot),bt===l.default.TEXT&&re.addMediaInfosToBuffer(ue,bt,ot,Qe),Lt}function xe(ot){let _t=oe?oe.length:0;for(let Ut=0;Ut<_t;Ut++){let je=oe[Ut].getFragmentModel();je.abortRequests(),je.resetInitialSettings(),oe[Ut].reset(!1,ot)}re&&re.deactivateStream(ue),ae&&(ae.reset(),ae=null),oe=[],Ee=!1,ve=!1,Kt(!1),Ne(!1),v.trigger(u.default.STREAM_DEACTIVATED,{streamInfo:ue})}function Me(ot){xe(ot),Oe=!1,te=!1,F=!1,Re=!1,ie=[]}function Ne(ot){Re=ot}function Ge(){return ue?ue.start:NaN}function Ze(){return ue?ue.id:null}function ht(){if(!le||!P)throw new Error(l.default.MISSING_CONFIG_ERROR)}function wt(ot){ot.error&&(I.error(ot.error),Le.fatal(ot.error.message))}function Wt(){if(J){const ot=x.getEventsFor(ue);ot&&ot.length>0&&J.addInlineEvents(ot,ue.id)}}function At(ot){let _t=Vt(ot);return _t?_t.getMediaInfo():null}function Vt(ot){return ot?oe.find((_t=>_t.getType()===ot)):null}function on(){let ot=pt();const _t=ot.length;if(_t!==0){for(let Ut=0;Ut<_t;Ut++)if(!ot[Ut].isBufferingCompleted()&&(ot[Ut].getType()===l.default.AUDIO||ot[Ut].getType()===l.default.VIDEO))return void Le.debug("onBufferingCompleted - One streamProcessor has finished but",ot[Ut].getType(),"one is not buffering completed");Le.debug("onBufferingCompleted - trigger STREAM_BUFFERING_COMPLETED"),ve=!0,v.trigger(u.default.STREAM_BUFFERING_COMPLETED,{streamInfo:ue},{streamInfo:ue})}else Le.warn("onBufferingCompleted - can't trigger STREAM_BUFFERING_COMPLETED because no streamProcessor is defined")}function kn(ot){J&&J.addInbandEvents(ot.events,ue.id)}function vn(){St()}function cn(){Wt()}function pn(ot){return ot&&ot.type?We(ot.type):null}function We(ot){return ot?pt().filter((function(_t){return _t.getType()===ot}))[0]:null}function pt(){let ot,_t,Ut=[];for(let je=0;je<oe.length;je++)_t=oe[je],ot=_t.getType(),ot!==l.default.AUDIO&&ot!==l.default.VIDEO&&ot!==l.default.TEXT&&ot!==l.default.ENHANCEMENT||Ut.push(_t);return Ut}function gt(){const ot=oe.length;for(let _t=0;_t<ot&&oe[_t];_t++)oe[_t].getScheduleController().startScheduleTimer()}function St(){const ot=oe.length;if(V){V.clearMediaInfoArray();for(let _t=0;_t<ot&&oe[_t];_t++){const Ut=oe[_t].getType(),je=oe[_t].getMediaInfo();if(Ut===l.default.AUDIO||Ut===l.default.VIDEO||Ut===l.default.TEXT&&je&&je.isFragmented){let Qe=oe[_t].getMediaInfo();Qe&&V.initializeForMedia(Qe)}}V.handleKeySystemFromManifest()}Oe||(Oe=!0,le.waitForReadyState(l.default.VIDEO_ELEMENT_READY_STATES.HAVE_METADATA,(()=>{v.trigger(u.default.STREAM_INITIALIZED,{streamInfo:ue})})))}function Kt(ot){Q=ot}function gn(){return Q}return ke={activate:function(ot,_t,Ut=[]){return new Promise(((je,Qe)=>{if(!Ee)return gn()?(Ee=!0,v.trigger(u.default.STREAM_ACTIVATED,{streamInfo:ue}),void je()):void(function(bt,Je,Rt=[]){return me(bt,Je,Rt)})(ot,_t,Ut).then((()=>{Ee=!0,Ut&&Ut.length>0&&gt(),v.trigger(u.default.STREAM_ACTIVATED,{streamInfo:ue}),je()})).catch((bt=>{Qe(bt)}));je()}))},checkAndHandleCompletedBuffering:function(){ve||oe.forEach((ot=>{ot.checkAndHandleCompletedBuffering()}))},deactivate:xe,getAdapter:function(){return x},getCurrentMediaInfoForType:function(ot){const _t=We(ot);return _t?_t.getMediaInfo():null},getCurrentRepresentationForType:function(ot){const _t=We(ot);return _t?_t.getRepresentation():null},getDuration:function(){return ue?ue.duration:NaN},getHasAudioTrack:function(){return F},getHasFinishedBuffering:function(){return ve},getHasVideoTrack:function(){return te},getId:Ze,getIsActive:function(){return Ee},getIsEndedEventSignaled:function(){return Re},getPreloaded:gn,getRepresentationForTypeById:function(ot,_t){let Ut;if(ot===l.default.IMAGE){if(!ae)return null;Ut=ae.getPossibleVoRepresentations()}else Ut=(function(bt){let Je=Vt(bt);return Je?Je.getAllMediaInfos():[]})(ot).flatMap((bt=>P.getPossibleVoRepresentationsFilteredBySettings(bt,!0)));if(!Ut||Ut.length===0)return null;const je=Ut.filter((Qe=>Qe.id===_t));return je&&je.length>0?je[0]:null},getRepresentationForTypeByIndex:function(ot,_t){let Ut;if(ot===l.default.IMAGE){if(!ae)return null;Ut=ae.getPossibleVoRepresentations()}else{const je=At(ot);Ut=P.getPossibleVoRepresentationsFilteredBySettings(je,!0)}return Ut[_t=Math.max(Math.min(_t,Ut.length-1),0)]},getRepresentationsByType:function(ot){if(ht(),ot===l.default.IMAGE)return ae?ae.getPossibleVoRepresentations():[];const _t=At(ot);return P.getPossibleVoRepresentationsFilteredBySettings(_t,!0)},getStartTime:Ge,getStreamId:function(){return ue?ue.id:null},getStreamInfo:function(){return ue},getStreamProcessors:pt,getThumbnailController:function(){return ae},initialize:function(){v.on(u.default.BUFFERING_COMPLETED,on,ke),v.on(u.default.INBAND_EVENTS,kn,ke),v.on(u.default.DATA_UPDATE_COMPLETED,vn,ke),v.on(d.default.PLAYBACK_SEEKED,cn,ke),V&&(v.on(u.default.KEY_ERROR,wt,ke),v.on(u.default.SERVER_CERTIFICATE_UPDATED,wt,ke),v.on(u.default.LICENSE_REQUEST_COMPLETE,wt,ke),v.on(u.default.KEY_SYSTEM_SELECTED,wt,ke),v.on(u.default.KEY_SESSION_CREATED,wt,ke)),re.initializeForStream(ue),v.trigger(u.default.STREAM_UPDATED,{streamInfo:ue})},initializeForTextWithMediaSource:function(ot){return new Promise(((_t,Ut)=>{K(l.default.TEXT,ot,null).then((()=>(function(){const je=We(l.default.TEXT);return je?je.createBufferSinks():Promise.resolve()})())).then((()=>{re.createTracks(ue),_t()})).catch((je=>{Ut(je)}))}))},prepareQualityChange:function(ot){const _t=We(ot.mediaType);_t&&_t.prepareQualityChange(ot)},prepareTrackChange:function(ot){if(!Ee||!ue)return;ve=!1;let _t=ot.newMediaInfo,Ut=w.getValue(),je=pn(_t);if(!je)return;let Qe=D.getTime();if(Le.info("Stream -  Process track changed at current time "+Qe),Ut.refreshManifestOnSwitchTrack)ie.push(ot),C.getIsUpdating()||(Le.debug("Stream -  Refreshing manifest for switch track"),C.refreshManifest());else{je.clearScheduleTimer(),je.setTrackSwitchInProgress(!0);const bt=je.getRepresentation();je.selectMediaInfo(new hr({newMediaInfo:_t})).then((()=>{const Je=!!(ot&&ot.options&&ot.options.hasOwnProperty("replaceBuffer"))&&ot.options.replaceBuffer;return je.prepareTrackSwitch(bt,Je)})).then((()=>{je.setTrackSwitchInProgress(!1)}))}},reset:function(ot){U&&(U.reset(),U=null),P&&ue&&P.clearDataForStream(ue.id),ee&&(ee.reset(),ee=null),re&&ue&&re.clearDataForStream(ue.id),Z&&ue&&Z.clearDataForStream(ue.id),Me(ot),ue=null,v.off(u.default.BUFFERING_COMPLETED,on,ke),v.off(u.default.INBAND_EVENTS,kn,ke),v.off(u.default.DATA_UPDATE_COMPLETED,vn,ke),v.off(d.default.PLAYBACK_SEEKED,cn,ke),V&&(v.off(u.default.KEY_ERROR,wt,ke),v.off(u.default.SERVER_CERTIFICATE_UPDATED,wt,ke),v.off(u.default.LICENSE_REQUEST_COMPLETE,wt,ke),v.off(u.default.KEY_SYSTEM_SELECTED,wt,ke),v.off(u.default.KEY_SESSION_CREATED,wt,ke))},setIsEndedEventSignaled:Ne,setMediaSource:function(ot){return new Promise(((_t,Ut)=>{const je=[];for(let Qe=0;Qe<oe.length;)ge(oe[Qe].getMediaInfo())?(je.push(oe[Qe].setMediaSource(ot)),Qe++):(oe[Qe].reset(),oe.splice(Qe,1));Promise.all(je).then((()=>{for(let Qe=0;Qe<oe.length;Qe++)oe[Qe].dischargePreBuffer();if(oe.length===0){const Qe="No streams to play.";I.error(new Bt.default(Yt.MANIFEST_ERROR_ID_NOSTREAMS_CODE,Qe+"nostreams",w.getValue())),Le.fatal(Qe)}_t()})).catch((Qe=>{Le.error(Qe),Ut(Qe)}))}))},startPreloading:function(ot,_t,Ut=[]){return new Promise(((je,Qe)=>{gn()?Qe():(Le.info(`[startPreloading] Preloading next stream with id ${Ze()}`),Kt(!0),me(ot,_t,Ut).then((()=>{for(let bt=0;bt<oe.length&&oe[bt];bt++)oe[bt].setExplicitBufferingTime(Ge()),oe[bt].getScheduleController().startScheduleTimer();je()})).catch((()=>{Kt(!1),Qe()})))}))},startScheduleControllers:gt,triggerProtectionError:function(ot){wt(ot)},updateData:function(ot){return new Promise((_t=>{ue=ot,J&&Wt();let Ut,je=[];for(let Qe=0,bt=oe.length;Qe<bt;Qe++){let Je=oe[Qe];const Rt=Je.getMediaInfo();je.push(Je.updateStreamInfo(ue));let Lt=x.getAllMediaInfoForType(ue,Je.getType());if(Lt=Lt.filter((Ce=>!Ce.isEmbedded)),Je.setMediaInfoArray(Lt),Lt)for(let Ce=0;Ce<Lt.length;Ce++)x.areMediaInfosEqual(Rt,Lt[Ce])&&je.push(Je.selectMediaInfo(new hr({newMediaInfo:Lt[Ce]})))}Promise.all(je).then((()=>{let Qe=[];for(;ie.length>0;){let bt=ie.pop(),Je=bt.newMediaInfo;if(Ut=pn(bt.oldMediaInfo),!Ut)return;const Rt=Ut.getRepresentation();Ut.setTrackSwitchInProgress(!0),Qe.push(Ut.prepareTrackSwitch(Rt)),Qe.push(Ut.selectMediaInfo(new hr({newMediaInfo:Je})))}return Promise.all(Qe)})).then((()=>{St(),Ut&&Ut.setTrackSwitchInProgress(!1),v.trigger(u.default.STREAM_UPDATED,{streamInfo:ue}),_t()})).catch((Qe=>{I.error(Qe)}))}))}},(function(){try{G=(0,c.default)(p).getInstance(),Le=G.getLogger(ke),Me(),X=rs(p).getInstance(),ee=tn(p).create({updateEventName:u.default.SEGMENT_LOCATION_BLACKLIST_CHANGED,addBlacklistEventName:u.default.SEGMENT_LOCATION_BLACKLIST_ADD}),U=Im(p).create({streamInfo:ue,mediaPlayerModel:A,dashMetrics:N,errHandler:I,settings:be,boxParser:X,dashConstants:Se.default,urlUtils:T})}catch(ot){throw ot}})(),ke}xu.__dashjs_factory_name="Stream";var Km=n.default.getClassFactory(xu);function So(){const b=this.context,p=(0,y.default)(b).getInstance(),v=Un(b).getInstance();let T,w,A,N,C,x,B,q,I,P,D,$,J,Z,V,re;function le(){q=[],I=[],P=null,D=null,J=null,$=NaN,A=!1,N=!1,Z=C.get().streaming.utcSynchronization.timeBetweenSyncAttempts}function ue(){C.get().streaming.utcSynchronization.enabled&&!A&&!N&&J&&J.value&&J.schemeIdUri&&!isNaN($)&&!isNaN(C.get().streaming.utcSynchronization.backgroundAttempts)&&(D&&(Date.now()-D)/1e3<30||(q=[],N=!0,be(isNaN(C.get().streaming.utcSynchronization.backgroundAttempts)?2:C.get().streaming.utcSynchronization.backgroundAttempts)))}function be(oe){try{if(oe<=0)return void Q();const ae=Date.now();x[J.schemeIdUri](J.value,(function(ie){const me=Date.now(),K=G(ae,me,ie);q.push(K),be(oe-1)}),(function(){Q()}))}catch{Q()}}function X(oe=null){let ae=oe||0;if(!I||I.length===0||ae>=I.length)return void U();let ie=I[ae];if(ie)if(x.hasOwnProperty(ie.schemeIdUri)){const me=new Date().getTime();x[ie.schemeIdUri](ie.value,(function(K){const ge=new Date().getTime(),_e=G(me,ge,K);J=ie,U(_e)}),(function(){X(ae+1)}))}else X(ae+1);else U()}function G(oe,ae,ie){return ie-(ae-(ae-oe)/2)}function U(oe=NaN){let ae=isNaN(oe);ae&&C.get().streaming.utcSynchronization.useManifestDateHeaderTimeSource?(function(){let ie=B.getLatestMPDRequestHeaderValueByID("Date"),me=ie!==null?new Date(ie).getTime():Number.NaN;isNaN(me)?Le(!0):Le(!1,me-Date.now())})():Le(ae,oe)}function F(oe){let ae=Date.parse(oe);return isNaN(ae)&&(ae=(function(ie){let me,K,ge=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+\-])([0-9]{2})([0-9]{2}))?/.exec(ie);return me=Date.UTC(parseInt(ge[1],10),parseInt(ge[2],10)-1,parseInt(ge[3],10),parseInt(ge[4],10),parseInt(ge[5],10),ge[6]&&(parseInt(ge[6],10)||0),ge[7]&&1e3*parseFloat(ge[7])||0),ge[9]&&ge[10]&&(K=60*parseInt(ge[9],10)+parseInt(ge[10],10),me+=(ge[8]==="+"?-1:1)*K*60*1e3),new Date(me).getTime()})(oe)),ae}function ve(oe){return Date.parse(oe)}function te(oe){return Date.parse(oe)}function ke(oe,ae,ie){ie()}function Ee(oe,ae,ie){let me=F(oe);isNaN(me)?ie():ae(me)}function Re(oe,ae,ie,me,K){let ge,_e,xe=!1,Me=new XMLHttpRequest,Ne=K?ye.HTTPRequest.HEAD:ye.HTTPRequest.GET,Ge=ae.match(/\S+/g);if(ae=Ge.shift(),ge=function(){xe||(xe=!0,Ge.length?Re(oe,Ge.join(" "),ie,me,K):me())},_e=function(){let Ze,ht;Me.status===200&&(Ze=K?Me.getResponseHeader("Date"):Me.response,ht=oe(Ze),isNaN(ht)||(ie(ht),xe=!0))},v.isRelative(ae)){const Ze=re.resolve();Ze&&(ae=v.resolve(ae,Ze.url))}Me.open(Ne,ae),Me.timeout=5e3,Me.onload=_e,Me.onloadend=ge,Me.send()}function Oe(oe,ae,ie){Re(te,oe,ae,ie,!0)}function Le(oe,ae){if(isNaN($)||isNaN(ae)||oe||(function(me){try{const K=ee(me),ge=isNaN(Z)?30:Z,_e=isNaN(C.get().streaming.utcSynchronization.timeBetweenSyncAttemptsAdjustmentFactor)?2:C.get().streaming.utcSynchronization.timeBetweenSyncAttemptsAdjustmentFactor,xe=isNaN(C.get().streaming.utcSynchronization.maximumTimeBetweenSyncAttempts)?600:C.get().streaming.utcSynchronization.maximumTimeBetweenSyncAttempts,Me=isNaN(C.get().streaming.utcSynchronization.minimumTimeBetweenSyncAttempts)?2:C.get().streaming.utcSynchronization.minimumTimeBetweenSyncAttempts;let Ne;K?(Ne=Math.min(ge*_e,xe),w.debug(`Increasing timeBetweenSyncAttempts to ${Ne}`)):(Ne=Math.max(ge/_e,Me),w.debug(`Decreasing timeBetweenSyncAttempts to ${Ne}`)),Z=Ne}catch{}})(ae),!oe&&!isNaN(ae)){P=Date.now(),A=!1;const me=isNaN($);$=ae,me&&ue(),w.debug(`Completed UTC sync. Setting client - server offset to ${ae}`)}oe&&(J=null,A=!1,V.error(new Bt.default(Yt.TIME_SYNC_FAILED_ERROR_CODE,Yt.TIME_SYNC_FAILED_ERROR_MESSAGE)));const ie=C.get().streaming.utcSynchronization.artificialTimeOffsetToApply;p.trigger(u.default.UPDATE_TIME_SYNC_OFFSET,{offset:ae+ie}),p.trigger(u.default.TIME_SYNCHRONIZATION_COMPLETED)}function Q(){if(!q||q.length===0)return;const oe=q.reduce(((ae,ie)=>ae+ie),0)/q.length;ee(oe)?w.debug("Completed background UTC sync. Offset is within allowed threshold and is not adjusted."):(w.debug(`Completed background UTC sync. Setting client - server offset to ${oe}`),$=oe,p.trigger(u.default.UPDATE_TIME_SYNC_OFFSET,{offset:$})),N=!1,D=Date.now()}function ee(oe){try{if(isNaN($))return!0;const ae=C.get().streaming.utcSynchronization.maximumAllowedDrift&&!isNaN(C.get().streaming.utcSynchronization.maximumAllowedDrift)?C.get().streaming.utcSynchronization.maximumAllowedDrift:100;return oe>=$-ae&&oe<=$+ae}catch{return!0}}return T={initialize:function(){le(),x={"urn:mpeg:dash:utc:http-head:2014":Oe,"urn:mpeg:dash:utc:http-xsdate:2014":Re.bind(null,F),"urn:mpeg:dash:utc:http-iso:2014":Re.bind(null,ve),"urn:mpeg:dash:utc:direct:2014":Ee,"urn:mpeg:dash:utc:http-head:2012":Oe,"urn:mpeg:dash:utc:http-xsdate:2012":Re.bind(null,F),"urn:mpeg:dash:utc:http-iso:2012":Re.bind(null,ve),"urn:mpeg:dash:utc:direct:2012":Ee,"urn:mpeg:dash:utc:http-ntp:2014":ke,"urn:mpeg:dash:utc:ntp:2014":ke,"urn:mpeg:dash:utc:sntp:2014":ke}},attemptSync:function(oe,ae){I=oe,A||((function(ie){try{if(!ie||!C.get().streaming.utcSynchronization.enabled)return!1;const me=isNaN(Z)?30:Z;return!(P&&me&&!isNaN(me))||(Date.now()-P)/1e3>=me}catch{return!0}})(ae)?(A=!0,X()):p.trigger(u.default.TIME_SYNCHRONIZATION_COMPLETED))},setConfig:function(oe){oe&&(oe.dashMetrics&&(B=oe.dashMetrics),oe.baseURLController&&(re=oe.baseURLController),oe.errHandler&&(V=oe.errHandler),oe.settings&&(C=oe.settings))},reset:function(){le(),p.off(u.default.ATTEMPT_BACKGROUND_SYNC,ue,T)}},w=(0,c.default)(b).getInstance().getLogger(T),p.on(u.default.ATTEMPT_BACKGROUND_SYNC,ue,T),T}So.__dashjs_factory_name="TimeSyncController";const ko=n.default.getSingletonFactory(So);ko.HTTP_TIMEOUT_MS=5e3,n.default.updateSingletonFactory(So.__dashjs_factory_name,ko);var $m=ko;function Cu(){let b,p,v,T,w;const A=this.context,N=(0,y.default)(A).getInstance();return b={attachMediaSource:function(C){let x=window.URL.createObjectURL(p);return C.setSource(x),T==="managedMediaSource"&&(C.setDisableRemotePlayback(!0),p.addEventListener("startstreaming",(()=>{N.trigger(d.default.MANAGED_MEDIA_SOURCE_START_STREAMING)})),p.addEventListener("endstreaming",(()=>{N.trigger(d.default.MANAGED_MEDIA_SOURCE_END_STREAMING)}))),x},createMediaSource:function(){let C="WebKitMediaSource"in window,x="MediaSource"in window;return"ManagedMediaSource"in window?(p=new ManagedMediaSource,T="managedMediaSource",w.info("Created ManagedMediaSource")):x?(p=new MediaSource,T="mediaSource",w.info("Created MediaSource")):C&&(p=new WebKitMediaSource,w.info("Created WebkitMediaSource")),p},detachMediaSource:function(C){C.setSource(null)},setConfig:function(C){C&&C.settings&&(v=C.settings)},setDuration:function C(x){p&&p.readyState==="open"&&(x===null&&isNaN(x)||p.duration!==x&&(x!==1/0||v.get().streaming.buffer.mediaSourceDurationInfinity||(x=Math.pow(2,32)),(function(B){let q=B.sourceBuffers;for(let I=0;I<q.length;I++)if(q[I].updating)return!0;return!1})(p)?setTimeout(C.bind(null,x),50):(w.info("Set MediaSource duration:"+x),p.duration=x)))},setSeekable:function(C,x){p&&typeof p.setLiveSeekableRange=="function"&&typeof p.clearLiveSeekableRange=="function"&&p.readyState==="open"&&C>=0&&C<x&&(p.clearLiveSeekableRange(),p.setLiveSeekableRange(C,x))},signalEndOfStream:function(C){if(!C||C.readyState!=="open")return;let x=C.sourceBuffers;for(let B=0;B<x.length;B++)if(x[B].updating||x[B].buffered.length===0)return;w.info("call to mediaSource endOfStream"),C.endOfStream()}},w=(0,c.default)(A).getInstance().getLogger(b),b}Cu.__dashjs_factory_name="MediaSourceController";var Vm=n.default.getSingletonFactory(Cu);function Lu(){const b="urn:mpeg:dash:event:2012",v="urn:mpeg:dash:event:callback:2015",A="discarded",N="updated",C="added",x=this.context,B=(0,y.default)(x).getInstance();let q,I,P,D,$,J,Z,V,re,le,ue;function be(){if(!Z||!V)throw new Error("setConfig function has to be called previously")}function X(){ue=!1,P={},D={},$=null,le=!1,J=Date.now()/1e3}function G(){try{if(!le){le=!0;const Le=V.getTime();let Q=Le-J;Q=J>0?Math.max(0,Q):0,U(D,Q,Le),U(P,Q,Le),F(D),F(P),J=Le,le=!1}}catch(Le){le=!1,I.error(Le)}}function U(Le,Q,ee){try{Ee(Le,function(ae){if(ae!==void 0){const ie=isNaN(ae.duration)?0:ae.duration;ae.calculatedPresentationTime<=ee&&ae.calculatedPresentationTime+Q+ie>=ee?Oe(ae,d.default.EVENT_MODE_ON_START):(Re(ee,ie+Q,ae.calculatedPresentationTime)||(function(me){try{const K=me.eventStream.period.start+me.eventStream.period.duration;return me.calculatedPresentationTime>K}catch(K){return I.error(K),!1}})(ae))&&(I.debug(`Removing event ${ae.id} from period ${ae.eventStream.period.id} as it is expired or invalid`),(function(me,K){try{const ge=K.eventStream.schemeIdUri,_e=K.eventStream.period.id,xe=K.eventStream.value,Me=K.id;me[_e][ge]=me[_e][ge].filter((Ne=>xe&&Ne.eventStream.value&&Ne.eventStream.value!==xe||Ne.id!==Me)),me[_e][ge].length===0&&delete me[_e][ge]}catch(ge){I.error(ge)}})(Le,ae))}})}catch(oe){I.error(oe)}}function F(Le){try{for(const Q in Le)Le.hasOwnProperty(Q)&&Object.keys(Le[Q]).length===0&&delete Le[Q]}catch(Q){I.error(Q)}}function ve(Le,Q,ee=!1){const oe=Le.eventStream.schemeIdUri,ae=Le.eventStream.value,ie=Le.id;let me=A;Q[oe]||(Q[oe]=[]);const K=Q[oe].findIndex((ge=>(!ae||ge.eventStream.value&&ge.eventStream.value===ae)&&ge.id===ie));if(K===-1)Q[oe].push(Le),Le.triggeredReceivedEvent=!1,Le.triggeredStartEvent=!1,me=C;else if(ee){const ge=Q[oe][K];Le.triggeredReceivedEvent=ge.triggeredReceivedEvent,Le.triggeredStartEvent=ge.triggeredStartEvent,Q[oe][K]=Le,me=N}return me}function te(Le){try{if(Le.eventStream.value==1){const Q=Le.calculatedPresentationTime;let ee;ee=Le.calculatedPresentationTime==4294967295?NaN:Le.calculatedPresentationTime+Le.duration,B.trigger(d.default.MANIFEST_VALIDITY_CHANGED,{id:Le.id,validUntil:Q,newDuration:ee,newManifestValidAfter:NaN},{mode:d.default.EVENT_MODE_ON_START})}}catch(Q){I.error(Q)}}function ke(Le){try{const Q=V.getTime();Ee(Le,(function(ee){const oe=ee.eventStream&&ee.eventStream.period&&!isNaN(ee.eventStream.period.duration)?ee.eventStream.period.duration:NaN,ae=ee.eventStream&&ee.eventStream.period&&!isNaN(ee.eventStream.period.start)?ee.eventStream.period.start:NaN;if(isNaN(oe)||isNaN(ae))return;const ie=ee.calculatedPresentationTime;Math.abs(ie-Q)<300&&Oe(ee,d.default.EVENT_MODE_ON_START)}))}catch(Q){I.error(Q)}}function Ee(Le,Q){try{if(Le){const ee=Object.keys(Le);for(let oe=0;oe<ee.length;oe++){const ae=Le[ee[oe]],ie=Object.keys(ae);for(let me=0;me<ie.length;me++)ae[ie[me]].forEach((K=>{K!==void 0&&Q(K)}))}}}catch(ee){I.error(ee)}}function Re(Le,Q,ee){try{return Le-Q>ee}catch(oe){return I.error(oe),!1}}function Oe(Le,Q){try{const ee=V.getTime(),oe=Le.id;if(Q===d.default.EVENT_MODE_ON_RECEIVE&&!Le.triggeredReceivedEvent)return I.debug(`Received event ${oe}`),Le.triggeredReceivedEvent=!0,void B.trigger(Le.eventStream.schemeIdUri,{event:Le},{mode:Q});Le.triggeredStartEvent||(Le.eventStream.schemeIdUri===b&&Le.eventStream.value==1?Le.duration===0&&Le.presentationTimeDelta===0||(I.debug(`Starting manifest refresh event ${oe} at ${ee}`),(function(){try{be(),Z.refreshManifest()}catch(ae){I.error(ae)}})()):Le.eventStream.schemeIdUri===v&&Le.eventStream.value==1?(I.debug(`Starting callback event ${oe} at ${ee}`),(function(ae){try{let ie=Qt(x).create({});const me=new oo({method:"get",url:ae,responseType:"arraybuffer",customData:{}}),K=new lo({request:me});ie.load(me,K)}catch(ie){I.error(ie)}})(Le.messageData instanceof Uint8Array?at.default.uint8ArrayToString(Le.messageData):Le.messageData)):(I.debug(`Starting event ${oe} from period ${Le.eventStream.period.id} at ${ee}`),B.trigger(Le.eventStream.schemeIdUri,{event:Le},{mode:Q}),re.get().streaming.events.deleteEventMessageDataTimeout>-1&&setTimeout((()=>{delete Le.messageData,delete Le.parsedMessageData}),re.get().streaming.events.deleteEventMessageDataTimeout)),Le.triggeredStartEvent=!0)}catch(ee){I.error(ee)}}return q={addInlineEvents:function(Le,Q){try{if(be(),P[Q]||(P[Q]={}),Le)for(let ee=0;ee<Le.length;ee++){let oe=Le[ee];if(!Re(V.getTime(),isNaN(oe.duration)?0:oe.duration,oe.calculatedPresentationTime)){let ae=ve(oe,P[Q],!0);ae===C?(I.debug(`Added inline event with id ${oe.id} from period ${Q}`),Oe(oe,d.default.EVENT_MODE_ON_RECEIVE)):ae===N&&I.debug(`Updated inline event with id ${oe.id} from period ${Q}`)}}}catch(ee){throw ee}},addInbandEvents:function(Le,Q){try{be(),D[Q]||(D[Q]={});for(let ee=0;ee<Le.length;ee++){let oe=Le[ee];Re(V.getTime(),isNaN(oe.duration)?0:oe.duration,oe.calculatedPresentationTime)||(ve(oe,D[Q],!1)===C?(oe.eventStream.schemeIdUri===b&&te(oe),I.debug(`Added inband event with id ${oe.id} from period ${Q}`),Oe(oe,d.default.EVENT_MODE_ON_RECEIVE)):I.debug(`Inband event with scheme_id_uri ${oe.eventStream.schemeIdUri}, value ${oe.eventStream.value}, period id ${Q} and event id ${oe.id} was ignored because it has been added before.`))}G()}catch(ee){throw ee}},getInbandEvents:function(){return D},getInlineEvents:function(){return P},start:function(){try{be(),I.debug("Start Event Controller");const Le=re.get().streaming.events.eventControllerRefreshDelay;ue||isNaN(Le)||(ue=!0,$=setInterval(G,Le))}catch(Le){throw Le}},setConfig:function(Le){try{if(!Le)return;Le.manifestUpdater&&(Z=Le.manifestUpdater),Le.playbackController&&(V=Le.playbackController),Le.settings&&(re=Le.settings)}catch(Q){throw Q}},reset:function(){(function(){try{$!==null&&ue&&(clearInterval($),$=null,ue=!1,(function(){try{ke(D),ke(P)}catch(Le){I.error(Le)}})())}catch(Le){throw Le}})(),X()}},I=(0,c.default)(x).getInstance().getLogger(q),X(),q}Lu.__dashjs_factory_name="EventController";var Wm=n.default.getSingletonFactory(Lu),ci={LEVELS:{WARNING:"Warning",ERROR:"Error"},EVENTS:{NO_UTC_TIMING_ELEMENT:{key:"NO_UTC_TIMING_ELEMENT",message:"No UTCTiming element is present in the manifest. You may experience playback failures. For a detailed validation use https://conformance.dashif.org/"},NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE:{key:"NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE",message:'SMPTE 2052-1:2013 defines the attribute name as "imageType" and does not define "imagetype"'},INVALID_DVR_WINDOW:{key:"INVALID_DVR_WINDOW",message:"No valid segment found when applying a specification compliant DVR window calculation. Using SegmentTimeline entries as a fallback."}}},Pu=t(445),Nu=t(1923);function Mu(){const b=this.context,p=(0,y.default)(b).getInstance();let v,T,w,A,N,C,x,B,q,I,P,D,$,J,Z,V,re,le,ue,be,X,G,U,F,ve,te,ke,Ee,Re,Oe,Le,Q,ee,oe,ae,ie,me,K,ge,_e,xe,Me,Ne,Ge,Ze,ht,wt,Wt;function At(){if(!(C&&C.hasOwnProperty("load")&&G&&G.hasOwnProperty("initialize")&&G.hasOwnProperty("reset")&&G.hasOwnProperty("getClientTimeOffset")&&x&&X&&q&&ae))throw new Error(l.default.MISSING_CONFIG_ERROR)}function Vt(){(function(){try{const Xe=B.getStreamsInfo();if(!F&&Xe.length===0)throw new Error("There are no periods in the MPD");F&&Xe.length>0&&q.updateManifestUpdateInfo({currentTime:ae.getTime(),buffered:oe.getBufferRange(),presentationStartTime:Xe[0].start,clientTimeOffset:G.getClientTimeOffset()}),U.length>0&&(function(Jt){Jt.length!==0?U=U.filter((sn=>{const Tn=Jt.filter((Cn=>Cn.id===sn.getId())).length>0||sn.getId()===F.getId();return Tn||(T.debug(`Removing stream ${sn.getId()}`),sn.reset(!0),sn=null),Tn})):T.warn("No periods included in the current manifest. Skipping the filtering of outdated stream objects.")})(Xe);const xt=[];for(let Jt=0,sn=Xe.length;Jt<sn;Jt++){const Tn=Xe[Jt];xt.push(kn(Tn)),q.addManifestUpdateStreamInfo(Tn)}Promise.all(xt).then((()=>new Promise(((Jt,sn)=>{F?Jt():vn(Xe,Jt,sn)})))).then((()=>{p.trigger(u.default.STREAMS_COMPOSED),yn()})).catch((Jt=>{throw Jt}))}catch(Xe){X.error(new Bt.default(Yt.MANIFEST_ERROR_ID_NOSTREAMS_CODE,Xe.message+" nostreamscomposed",x.getValue())),Q=!0,Ia()}})()}function on(){Ze=!0}function kn(Xe){let xt=ui(Xe.id);return xt?xt.updateData(Xe):(xt=Km(b).create({manifestModel:x,mediaPlayerModel:me,dashMetrics:q,manifestUpdater:N,adapter:B,timelineConverter:G,capabilities:w,capabilitiesFilter:A,errHandler:X,baseURLController:$,segmentBaseController:J,textController:te,abrController:V,playbackController:ae,throughputController:re,eventController:ue,mediaController:le,protectionController:ve,videoModel:oe,streamInfo:Xe,settings:Ge}),U.push(xt),xt.initialize(),Promise.resolve())}function vn(Xe,xt,Jt){try{bt();const sn=q.getCurrentDVRInfo().range;if(sn.end<sn.start)return void(function(Cn,Qn,Qa,ja){ht&&clearTimeout(ht);const fi=Math.min(1e3*(-1*(Cn.end-Cn.start)+2),2147483647);T.debug(`Waiting for ${fi} ms before playback can start`),p.trigger(u.default.AST_IN_FUTURE,{delay:fi}),ht=setTimeout((()=>{vn(Qn,Qa,ja)}),fi)})(sn,Xe,xt,Jt);Ge.get().streaming.applyProducerReferenceTime&&ie.calculateProducerReferenceTimeOffsets(Xe);const Tn=Xe[0].manifestInfo;if(Ge.get().streaming.applyServiceDescription&&ie.applyServiceDescription(Tn),B.getIsDynamic()){const Cn=Jn(0,Tn);ae.computeAndSetLiveDelay(Cn,Tn)}(Ge.get().streaming.applyContentSteering&&D.shouldQueryBeforeStart()?D.loadSteeringData():Promise.resolve()).then((()=>{const Cn=x.getValue();Cn&&$.update(Cn),cn(),xt()})).catch((Cn=>{T.error(Cn),cn(),xt()}))}catch(sn){Jt(sn)}}function cn(){const Xe=(function(){let sn;return sn=B.getIsDynamic()?(function(){let Tn;const Cn=q.getCurrentDVRInfo();Tn=(Cn&&Cn.range?Cn.range.end:0)-ae.getOriginalLiveDelay();const Qn=Cn?Cn.range:null;if(Qn){if(isNaN(wt)&&wt.toString().indexOf("posix:")===-1){const ja=En(!0);isNaN(ja)||(T.info(`Start time from URI parameters: ${ja}`),Tn=Math.min(Tn,ja))}else{T.info(`Start time provided by the app: ${wt}`);const ja=mn(!0,wt);isNaN(ja)||(Tn=Math.min(Tn,ja))}const Qa=Ge.get().streaming.timeShiftBuffer.calcFromSegmentTimeline?.1:0;Tn=Math.max(Tn,Qn.start+Qa)}return Tn})():(function(){let Tn=Kr()[0].getStreamInfo().start;if(isNaN(wt)){const Cn=En(!1);isNaN(Cn)||(T.info(`Start time from URI parameters: ${Cn}`),Tn=Math.max(Tn,Cn))}else{T.info(`Start time provided by the app: ${wt}`);const Cn=mn(!1,wt);isNaN(Cn)||(Tn=Math.max(Tn,Cn))}return Tn})(),sn})();let xt=Qe(Xe);const Jt=xt!==null?xt:U[0];p.trigger(u.default.INITIAL_STREAM_SWITCH,{startTime:Xe}),pn(Jt,null,Xe),Me||(Me=setInterval((function(){!Oe&&ae.getTimeToStreamEnd()<=0&&!ae.isSeeking()&&p.trigger(u.default.PLAYBACK_ENDED,{isLast:qa().isLast})}),200))}function pn(Xe,xt,Jt){try{if(Oe||!Xe||xt===Xe&&Xe.getIsActive())return;Oe=!0,p.trigger(u.default.PERIOD_SWITCH_STARTED,{fromStreamInfo:xt?xt.getStreamInfo():null,toStreamInfo:Xe.getStreamInfo()});let sn=!1,Tn=[],Cn=St(xt);F=Xe,xt&&(sn=Ut(Xe,xt),Tn=gt(xt),xt.deactivate(sn)),Jt=isNaN(Jt)?!sn&&xt?Xe.getStreamInfo().start:NaN:Jt,T.info(`Switch to stream ${Xe.getId()}. Seektime is ${Jt}, current playback time is ${ae.getTime()}. Seamless period switch is set to ${sn}`),Ne=Ne.filter((Qn=>Qn.getId()!==F.getId())),ae.initialize(qa(),!!xt),oe.getElement()?We({seekTime:Jt,keepBuffers:sn,sourceBufferSinksFromPreviousPeriod:Cn,streamActivated:!1,representationsFromPreviousPeriod:Tn}):pt({seekTime:Jt,keepBuffers:sn,sourceBufferSinksFromPreviousPeriod:Cn})}catch{Oe=!1}}function We(Xe){let xt;function Jt(){if(!ee||ee.readyState!=="open")return;T.debug("MediaSource is open!"),window.URL.revokeObjectURL(xt),ee.removeEventListener("sourceopen",Jt),ee.removeEventListener("webkitsourceopen",Jt),ln();const Tn=q.getCurrentDVRInfo();I.setSeekable(Tn.range.start,Tn.range.end),Xe.streamActivated?(isNaN(Xe.seekTime)||ae.seek(Xe.seekTime,!0,!0),F.setMediaSource(ee).then((()=>{F.initializeForTextWithMediaSource(ee)}))):pt(Xe)}function sn(){ee.addEventListener("sourceopen",Jt,!1),ee.addEventListener("webkitsourceopen",Jt,!1),xt=I.attachMediaSource(oe),T.debug("MediaSource attached to element.  Waiting on open...")}ee?Xe.keepBuffers?pt(Xe):(I.detachMediaSource(oe),sn()):(ee=I.createMediaSource(),sn())}function pt(Xe){const xt=Xe.representationsFromPreviousPeriod||[];F.activate(ee,Xe.sourceBufferSinksFromPreviousPeriod,xt).then((()=>{isNaN(Xe.seekTime)||(p.trigger(u.default.SEEK_TARGET,{time:Xe.seekTime},{streamId:F.getId()}),ae.seek(Xe.seekTime,!1,!0),F.startScheduleControllers()),Oe=!1,p.trigger(u.default.PERIOD_SWITCH_COMPLETED,{toStreamInfo:qa()})}))}function gt(Xe){return(Xe?Xe.getStreamProcessors():[]).map((xt=>xt.getRepresentation()))}function St(Xe){const xt=new Map;return Xe&&(Xe?Xe.getStreamProcessors():[]).forEach((Jt=>{const sn=Jt.getBuffer();sn&&xt.set(sn.getType(),sn)})),xt}function Kt(Xe){const xt=Qe(Xe.seekTime);xt&&xt!==F?xt&&xt!==F&&(gn(xt),(function(Jt,sn){const Tn=Jt&&!isNaN(Jt.seekTime)?Jt.seekTime:NaN,Cn=F.getStreamProcessors().map((Qn=>Qn.prepareOuterPeriodPlaybackSeeking(Jt)));Promise.all(Cn).then((()=>{pn(sn,F,Tn)})).catch((Qn=>{X.error(Qn)}))})(Xe,xt)):(gn(),(function(Jt){F.getStreamProcessors().forEach((sn=>sn.prepareInnerPeriodPlaybackSeeking(Jt))),Cr(pa.USER_REQUEST_STOP_REASON)})(Xe)),Ba(xr.SEEK_START_REASON)}function gn(Xe=null){ot()}function ot(){Ne&&Ne.length>0&&(Ne.forEach((Xe=>{Xe.deactivate(!0)})),Ne=[])}function _t(Xe){if(Xe.newMediaInfo.streamInfo.id===F.getId()){if(ot(),Ge.get().streaming.buffer.resetSourceBuffersForTrackSwitch&&Xe.oldMediaInfo&&Xe.oldMediaInfo.codec!==Xe.newMediaInfo.codec){const xt=ae.getTime();return F.deactivate(!1),void We({seekTime:xt,keepBuffers:!1,streamActivated:!1})}F.prepareTrackChange(Xe)}}function Ut(Xe,xt){try{return Ge.get().streaming.buffer.reuseExistingSourceBuffers&&(w.isProtectionCompatible(xt.getStreamInfo(),Xe.getStreamInfo())||Ze)&&w.supportsChangeType()&&Ge.get().streaming.buffer.useChangeType}catch{return!1}}function je(Xe,xt=null){if(!ee||Xe.getPreloaded()||!Ut(Xe,xt))return;const Jt=gt(xt),sn=St(xt);Xe.startPreloading(ee,sn,Jt).then((()=>{Ne.push(Xe)}))}function Qe(Xe){if(isNaN(Xe))return null;const xt=U.length;for(let Jt=0;Jt<xt;Jt++){const sn=U[Jt];if(Xe<parseFloat((sn.getStartTime()+sn.getDuration()).toFixed(5)))return sn}return null}function bt(){try{const Xe=B.getIsDynamic(),xt=B.getStreamsInfo()[0].manifestInfo,Jt=ae.getTime(),sn=G.calcTimeShiftBufferWindow(U,Xe),Tn=Ht();if(sn.start===void 0||sn.end===void 0)return;Tn&&Tn.length!==0?Tn.forEach((Cn=>{q.addDVRInfo(Cn.getType(),Jt,xt,sn)})):q.addDVRInfo(l.default.VIDEO,Jt,xt,sn)}catch{}}function Je(Xe){if(_e&&Re){const xt=me.getInitialBufferLevel(),Jt=[l.default.TEXT];(isNaN(xt)||xt<=ae.getBufferLevel(Jt)||B.getIsDynamic()&&xt>ae.getLiveDelay())&&(_e=!1,Ba(xr.INITIAL_PLAYOUT_START_REASON),ae.play())}Xe&&Xe.mediaType&&q.addBufferLevel(Xe.mediaType,new Date,1e3*Xe.bufferLevel)}function Rt(Xe){Xe.streamInfo.id===F.getId()&&ot(),ui(Xe.streamInfo.id).prepareQualityChange(Xe)}function Lt(){if(B.getIsDynamic()&&ae.getOriginalLiveDelay()!==0&&F){const Xe=B.getStreamsInfo();if(Xe.length>0){const xt=Xe[0].manifestInfo,Jt=Jn(0,xt);ae.computeAndSetLiveDelay(Jt,xt)}}}function Ce(){if(ir()){const Xe=oe.getPlaybackQuality();Xe&&q.addDroppedFrames(Xe)}}function rt(){T.debug("[onPlaybackStarted]"),!_e&&ge&&Ba(xr.RESUME_FROM_PAUSE_START_REASON),_e&&(_e=!1),xe&&(xe=!1,Ge.get().streaming.applyContentSteering&&!D.shouldQueryBeforeStart()&&D.loadSteeringData()),ge=!1}function Pt(Xe){T.debug("[onPlaybackPaused]"),Xe.ended||(ge=!0,Cr(pa.USER_REQUEST_STOP_REASON))}function zt(Xe){T.debug(`Stream with id ${Xe.streamInfo.id} finished buffering`);const xt=Xe.streamInfo.isLast;ee&&xt?(T.info("[onStreamBufferingCompleted] calls signalEndOfStream of mediaSourceController."),I.signalEndOfStream(ee)):yn()}function yn(){if(!F)return;if(!F.getHasFinishedBuffering())return void F.checkAndHandleCompletedBuffering();const Xe=(function(Jt=null){try{const sn=Jt||F||null;if(sn){const Tn=sn.getStreamInfo();return U.filter((function(Cn){const Qn=Cn.getStreamInfo();return Qn.start>Tn.start&&Tn.id!==Qn.id}))}}catch{return[]}})(F);let xt=0;for(;xt<Xe.length;){const Jt=Xe[xt],sn=xt===0?F:Xe[xt-1];!Jt.getPreloaded()&&sn.getHasFinishedBuffering()&&je(Jt,sn),xt+=1}}function ut(){Me&&(clearInterval(Me),Me=null)}function Ht(){return F?F.getStreamProcessors():[]}function dn(Xe){if(F&&!F.getIsEndedEventSignaled()){F.setIsEndedEventSignaled(!0);const xt=(function(Jt=null){const sn=Jt||F||null;if(!sn)return null;const Tn=sn.getStreamInfo(),Cn=Tn.start;let Qn=0,Qa=-1,ja=NaN;for(;Qn<U.length;){const fi=U[Qn].getStreamInfo(),Co=fi.start-Cn;Co>0&&(isNaN(ja)||Co<ja)&&Tn.id!==fi.id&&(ja=Co,Qa=Qn),Qn+=1}return Qa>=0?U[Qa]:null})();xt?(T.debug(`StreamController onEnded, found next stream with id ${xt.getStreamInfo().id}. Switching from ${F.getStreamInfo().id} to ${xt.getStreamInfo().id}`),pn(xt,F,NaN)):(T.debug("StreamController no next stream found"),F.setIsEndedEventSignaled(!1)),Cr(xt?pa.END_OF_PERIOD_STOP_REASON:pa.END_OF_CONTENT_STOP_REASON)}Xe&&Xe.isLast&&(ut(),D.stopSteeringRequestTimer())}function ln(Xe){const xt=Xe||qa().manifestInfo.duration;I.setDuration(xt)}function En(Xe){const xt=Z.getURIFragmentData();if(!xt||!xt.t)return NaN;const Jt=Kr()[0].getStreamInfo().start;return xt.t=xt.t.split(",")[0],jn(Xe,xt.t,Jt)}function mn(Xe,xt){let Jt=0;return Xe||(Jt=Kr()[0].getStreamInfo().start),jn(Xe,xt,Jt)}function jn(Xe,xt,Jt){const sn=B.getRegularPeriods()[0],Tn=xt.toString(),Cn=Tn.indexOf("posix:")!==-1?Tn.substring(6)==="now"?Date.now()/1e3:parseFloat(Tn.substring(6)):NaN;return Xe&&!isNaN(Cn)?G.calcPresentationTimeFromWallTime(new Date(1e3*Cn),sn):parseFloat(Tn)+Jt}function Jn(Xe,xt){try{let Jt=NaN;return xt&&!isNaN(xt.maxFragmentDuration)&&isFinite(xt.maxFragmentDuration)?xt.maxFragmentDuration:isFinite(Jt)?Jt:NaN}catch{return NaN}}function $a(){const Xe=x.getValue();$.initialize(Xe)}function Va(Xe){if(Xe.error)Q=!0,Ia();else{T.info("Manifest updated... updating data system wide.");const xt=Xe.manifest;B.updatePeriods(xt),A.filterUnsupportedFeatures(xt).then((()=>{$.initialize(xt);let Jt=B.getUTCTimingSources();!B.getIsDynamic()||Jt&&Jt.length!==0||p.trigger(d.default.CONFORMANCE_VIOLATION,{level:ci.LEVELS.WARNING,event:ci.EVENTS.NO_UTC_TIMING_ELEMENT});let sn=B.getIsDynamic()?Jt.concat(K.getUTCTimingSources()):Jt;P.attemptSync(sn,B.getIsDynamic()),Ee.createFinalQueryStrings(xt)}))}}function ir(){return!!F&&F.getHasVideoTrack()}function Yr(){return!!F&&F.getHasAudioTrack()}function Cr(Xe,xt){xt=xt||new Date,Ht().forEach((Jt=>{Jt.finalisePlayList(xt,Xe)})),q.addPlayList()}function Ba(Xe){q.createPlaylistMetrics(1e3*ae.getTime(),Xe)}function Lr(Xe){ve.updateKeyStatusesMap(Xe),(function(){const xt=Ht();let Jt=!1;xt.forEach((sn=>{const Tn=sn.getMediaInfo();!Tn||w.areKeyIdsUsable(Tn)?Tn&&w.areKeyIdsExpired(Tn)&&(function(Cn){const Qn=ui(Cn.getStreamId());Qn&&Qn.triggerProtectionError({error:new Bt.default(Nu.default.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE,Nu.default.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE)})})(sn):(Jt=!0,(function(Cn){const Qn=Cn.getAllMediaInfos().filter((Qa=>w.areKeyIdsUsable(Qa)));if(Qn&&Qn.length!==0)le.setTrack(Qn[0],{replaceBuffer:!0});else{const Qa=Cn.getType();X.error(new Bt.default(Yt.NO_SUPPORTED_KEY_IDS,`Type: ${Qa}: ${Yt.NO_SUPPORTED_KEY_IDS_MESSAGE}`))}})(sn))})),Jt&&(ae.getTime()===0?p.once(d.default.FRAGMENT_LOADING_COMPLETED,(()=>{Fa()}),v):ae.isProgressing(500).then((sn=>{sn||Fa()})))})()}function Fa(){const Xe=ae.getTime();ae.seek(Xe+.01,!1,!1)}function Wa(Xe){if(!Xe.error)return;let xt;switch(Xe.error.code){case 1:xt="MEDIA_ERR_ABORTED";break;case 2:xt="MEDIA_ERR_NETWORK";break;case 3:xt="MEDIA_ERR_DECODE",Wt.counts.mediaErrorDecode+=1;break;case 4:xt="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:xt="MEDIA_ERR_ENCRYPTED";break;default:xt="UNKNOWN"}xt==="MEDIA_ERR_DECODE"&&Ge.get().errors.recoverAttempts.mediaErrorDecode>=Wt.counts.mediaErrorDecode?(function(){T.error("A MEDIA_ERR_DECODE occured: Resetting the MediaSource");const Jt=ae.getTime();F.deactivate(!1),T.info(`MediaSource has been resetted. Resuming playback from time ${Jt}`),We({seekTime:Jt,keepBuffers:!1,streamActivated:!1})})():(Le=!0,Xe.error.message&&(xt+=" ("+Xe.error.message+")"),Xe.error.msExtendedCode&&(xt+=" (0x"+(Xe.error.msExtendedCode>>>0).toString(16).toUpperCase()+")"),T.fatal("Video Element Error: "+xt),Xe.error&&T.fatal(Xe.error),X.error(new Bt.default(Xe.error.code,xt)),Ia())}function qa(){return F?F.getStreamInfo():null}function ui(Xe){for(let xt=0,Jt=U.length;xt<Jt;xt++)if(U[xt].getId()===Xe)return U[xt];return null}function gs(Xe){isNaN(Xe.newDuration)||ln(Xe.newDuration)}function ps(){U=[],wt=NaN,ve=null,Oe=!1,F=null,Le=!1,Q=!1,_e=!0,xe=!0,ge=!1,Re=!0,Me=null,Ze=!1,Ne=[],ht=null,Wt={counts:{mediaErrorDecode:0}}}function Ia(){At(),P.reset(),Cr(Le||Q?pa.FAILURE_STOP_REASON:pa.USER_REQUEST_STOP_REASON);for(let Xe=0,xt=U?U.length:0;Xe<xt;Xe++)U[Xe].reset(Le);p.off(d.default.PLAYBACK_TIME_UPDATED,Ce,v),p.off(d.default.PLAYBACK_SEEKING,Kt,v),p.off(d.default.PLAYBACK_ERROR,Wa,v),p.off(d.default.PLAYBACK_STARTED,rt,v),p.off(d.default.PLAYBACK_PAUSED,Pt,v),p.off(d.default.PLAYBACK_ENDED,dn,v),p.off(d.default.METRIC_ADDED,di,v),p.off(d.default.MANIFEST_VALIDITY_CHANGED,gs,v),p.off(d.default.BUFFER_LEVEL_UPDATED,Je,v),p.off(d.default.QUALITY_CHANGE_REQUESTED,Rt,v),p.off(d.default.CONTENT_STEERING_REQUEST_COMPLETED,$a,v),u.default.KEY_SESSION_UPDATED&&p.off(u.default.KEY_SESSION_UPDATED,on,v),p.off(u.default.MANIFEST_UPDATED,Va,v),p.off(u.default.STREAM_BUFFERING_COMPLETED,zt,v),p.off(u.default.TIME_SYNCHRONIZATION_COMPLETED,Vt,v),p.off(u.default.CURRENT_TRACK_CHANGED,_t,v),p.off(u.default.SETTING_UPDATED_LIVE_DELAY,Lt,v),p.off(u.default.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT,Lt,v),p.off(Pu.default.INTERNAL_KEY_STATUSES_CHANGED,Lr,v),$.reset(),N.reset(),ue.reset(),q.clearAllCurrentMetrics(),x.setValue(null),C.reset(),G.reset(),be.reset(),ee&&(I.detachMediaSource(oe),ee=null),oe=null,ve&&(ve=null,ke=null,x.getValue()&&p.trigger(u.default.PROTECTION_DESTROYED,{data:x.getValue().url})),ut(),p.trigger(u.default.STREAM_TEARDOWN_COMPLETE),ps()}function di(Xe){if(Xe.metric===i.DVR_INFO){const xt=Yr()?l.default.AUDIO:l.default.VIDEO;Xe.mediaType===xt&&I.setSeekable(Xe.value.range.start,Xe.value.range.end)}}function Kr(){return U}return v={addDVRMetric:bt,getActiveStream:function(){return F},getActiveStreamInfo:qa,getActiveStreamProcessors:Ht,getAutoPlay:function(){return Re},getHasMediaOrInitialisationError:function(){return Le||Q},getInitialPlayback:function(){return _e},getIsStreamSwitchInProgress:function(){return Oe},getStreamById:ui,getStreamForTime:Qe,getStreams:Kr,getTimeRelativeToStreamId:function(Xe,xt){let Jt=null,sn=0,Tn=0,Cn=null;for(let Qn=0;Qn<U.length;Qn++){if(Jt=U[Qn],Tn=Jt.getStartTime(),Cn=Jt.getDuration(),Number.isFinite(Tn)&&(sn=Tn),Jt.getId()===xt)return Xe-sn;Number.isFinite(Cn)&&(sn+=Cn)}return null},hasAudioTrack:Yr,hasVideoTrack:ir,initialize:function(Xe,xt){At(),Re=Xe,ke=xt,G.initialize(),N=Fc(b).create(),N.setConfig({manifestModel:x,adapter:B,manifestLoader:C,errHandler:X,settings:Ge,contentSteeringController:D}),N.initialize(),ue=Wm(b).getInstance(),ue.setConfig({manifestUpdater:N,playbackController:ae,settings:Ge}),ue.start(),Ee=Ql(b).getInstance(),P.setConfig({dashMetrics:q,baseURLController:$,errHandler:X,settings:Ge}),P.initialize(),I.setConfig({settings:Ge}),ve&&(p.trigger(u.default.PROTECTION_CREATED,{controller:ve}),ve.setMediaElement(oe.getElement()),ke&&ve.setProtectionData(ke)),p.on(d.default.PLAYBACK_TIME_UPDATED,Ce,v),p.on(d.default.PLAYBACK_SEEKING,Kt,v),p.on(d.default.PLAYBACK_ERROR,Wa,v),p.on(d.default.PLAYBACK_STARTED,rt,v),p.on(d.default.PLAYBACK_PAUSED,Pt,v),p.on(d.default.PLAYBACK_ENDED,dn,v),p.on(d.default.METRIC_ADDED,di,v),p.on(d.default.MANIFEST_VALIDITY_CHANGED,gs,v),p.on(d.default.BUFFER_LEVEL_UPDATED,Je,v),p.on(d.default.QUALITY_CHANGE_REQUESTED,Rt,v),p.on(d.default.CONTENT_STEERING_REQUEST_COMPLETED,$a,v),u.default.KEY_SESSION_UPDATED&&p.on(u.default.KEY_SESSION_UPDATED,on,v),p.on(u.default.MANIFEST_UPDATED,Va,v),p.on(u.default.STREAM_BUFFERING_COMPLETED,zt,v),p.on(u.default.TIME_SYNCHRONIZATION_COMPLETED,Vt,v),p.on(u.default.CURRENT_TRACK_CHANGED,_t,v),p.on(u.default.SETTING_UPDATED_LIVE_DELAY,Lt,v),p.on(u.default.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT,Lt,v),p.on(Pu.default.INTERNAL_KEY_STATUSES_CHANGED,Lr,v)},load:function(Xe,xt=NaN){At(),wt=xt,C.load(Xe)},loadWithManifest:function(Xe,xt=NaN){(function(){if(!N||!N.hasOwnProperty("setManifest"))throw new Error("initialize function has to be called previously")})(),wt=xt,N.setManifest(Xe)},refreshManifest:function(){N.getIsUpdating()||N.refreshManifest()},reset:Ia,setConfig:function(Xe){Xe&&(Xe.capabilities&&(w=Xe.capabilities),Xe.capabilitiesFilter&&(A=Xe.capabilitiesFilter),Xe.manifestLoader&&(C=Xe.manifestLoader),Xe.manifestModel&&(x=Xe.manifestModel),Xe.mediaPlayerModel&&(me=Xe.mediaPlayerModel),Xe.customParametersModel&&(K=Xe.customParametersModel),Xe.protectionController&&(ve=Xe.protectionController),Xe.adapter&&(B=Xe.adapter),Xe.dashMetrics&&(q=Xe.dashMetrics),Xe.errHandler&&(X=Xe.errHandler),Xe.timelineConverter&&(G=Xe.timelineConverter),Xe.videoModel&&(oe=Xe.videoModel),Xe.playbackController&&(ae=Xe.playbackController),Xe.throughputController&&(re=Xe.throughputController),Xe.serviceDescriptionController&&(ie=Xe.serviceDescriptionController),Xe.contentSteeringController&&(D=Xe.contentSteeringController),Xe.textController&&(te=Xe.textController),Xe.abrController&&(V=Xe.abrController),Xe.mediaController&&(le=Xe.mediaController),Xe.settings&&(Ge=Xe.settings),Xe.baseURLController&&($=Xe.baseURLController),Xe.uriFragmentModel&&(Z=Xe.uriFragmentModel),Xe.segmentBaseController&&(J=Xe.segmentBaseController),Xe.manifestUpdater&&(N=Xe.manifestUpdater))},setProtectionData:function(Xe){ke=Xe,ve&&ve.setProtectionData(ke)},switchToVideoElement:function(Xe){F&&(ae.initialize(qa()),We({seekTime:Xe,keepBuffers:!1,streamActivated:!0}))}},T=(0,c.default)(b).getInstance().getLogger(v),P=$m(b).getInstance(),I=Vm(b).getInstance(),be=To(b).getInstance(),ps(),v}Mu.__dashjs_factory_name="StreamController";var Du=n.default.getSingletonFactory(Mu),Qm=class extends is{constructor(){super(),this.captionData=null,this.label=null,this.defaultTrack=!1,this.kind=null,this.isFragmented=!1,this.isEmbedded=!1,this.isTTML=null}},Xm=t(7377);function Ou(){let b,p=0;function v(x){let B="";for(let q=0;q<x.length;++q)B+=x[q].uchar;return B.length-B.replace(/^\s+/,"").length}function T(x){return"left: "+3.125*x.x+"%; top: "+6.66*x.y1+"%; width: "+(100-3.125*x.x)+"%; height: "+6.66*Math.max(x.y2-1-x.y1,1)+"%; align-items: flex-start; overflow: visible; -webkit-writing-mode: horizontal-tb;"}function w(x){return x==="red"?"rgb(255, 0, 0)":x==="green"?"rgb(0, 255, 0)":x==="blue"?"rgb(0, 0, 255)":x==="cyan"?"rgb(0, 255, 255)":x==="magenta"?"rgb(255, 0, 255)":x==="yellow"?"rgb(255, 255, 0)":x==="white"?"rgb(255, 255, 255)":x==="black"?"rgb(0, 0, 0)":x}function A(x,B){const q=x.videoHeight/15;return B?"font-size: "+q+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; color: "+(B.foreground?w(B.foreground):"rgb(255, 255, 255)")+"; font-style: "+(B.italics?"italic":"normal")+"; text-decoration: "+(B.underline?"underline":"none")+"; white-space: pre; background-color: "+(B.background?w(B.background):"transparent")+";":"font-size: "+q+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; justify-content: flex-start; text-align: left; color: rgb(255, 255, 255); font-style: normal; white-space: pre; line-height: normal; font-weight: normal; text-decoration: none; width: 100%; display: flex;"}function N(x){return x.replace(/^\s+/g,"")}function C(x){return x.replace(/\s+$/g,"")}return b={createHTMLCaptionsFromScreen:function(x,B,q,I){let P=null,D=null,$=!1,J=-1,Z={start:B,end:q,spans:[]},V="style_cea608_white_black";const re={},le={},ue=[];let be,X;for(be=0;be<15;++be){const U=I.rows[be];let F="",ve=null;if(U.isEmpty()===!1){const te=v(U.chars);P===null&&(P={x:te,y1:be,y2:be+1,p:[]}),te!==J&&$&&(P.p.push(Z),Z={start:B,end:q,spans:[]},P.y2=be,P.name="region_"+P.x+"_"+P.y1+"_"+P.y2,re.hasOwnProperty(P.name)===!1?(ue.push(P),re[P.name]=P):(D=re[P.name],D.p.contat(P.p)),P={x:te,y1:be,y2:be+1,p:[]});for(let ke=0;ke<U.chars.length;++ke){const Ee=U.chars[ke],Re=Ee.penState;if(ve===null||!Re.equals(ve)){F.trim().length>0&&(Z.spans.push({name:V,line:F,row:be}),F="");let Oe="style_cea608_"+Re.foreground+"_"+Re.background;Re.underline&&(Oe+="_underline"),Re.italics&&(Oe+="_italics"),le.hasOwnProperty(Oe)||(le[Oe]=JSON.parse(JSON.stringify(Re))),ve=Re,V=Oe}F+=Ee.uchar}F.trim().length>0&&Z.spans.push({name:V,line:F,row:be}),$=!0,J=te}else $=!1,J=-1,P&&(P.p.push(Z),Z={start:B,end:q,spans:[]},P.y2=be,P.name="region_"+P.x+"_"+P.y1+"_"+P.y2,re.hasOwnProperty(P.name)===!1?(ue.push(P),re[P.name]=P):(D=re[P.name],D.p.contat(P.p)),P=null)}P&&(P.p.push(Z),P.y2=be+1,P.name="region_"+P.x+"_"+P.y1+"_"+P.y2,re.hasOwnProperty(P.name)===!1?(ue.push(P),re[P.name]=P):(D=re[P.name],D.p.contat(P.p)),P=null);const G=[];for(be=0;be<ue.length;++be){const U=ue[be],F="sub_cea608_"+p++,ve=document.createElement("div");ve.id=F;const te=T(U);ve.style.cssText="position: absolute; margin: 0; display: flex; box-sizing: border-box; pointer-events: none;"+te;const ke=document.createElement("div");ke.className="paragraph bodyStyle",ke.style.cssText=A(x);const Ee=document.createElement("div");Ee.className="cueUniWrapper",Ee.style.cssText="unicode-bidi: normal; direction: ltr;";for(let Oe=0;Oe<U.p.length;++Oe){const Le=U.p[Oe];let Q=0;for(X=0;X<Le.spans.length;++X){let ee=Le.spans[X];if(ee.line.length>0){if(X!==0&&Q!=ee.row){const me=document.createElement("br");me.className="lineBreak",Ee.appendChild(me)}let oe=!1;Q===ee.row&&(oe=!0),Q=ee.row;const ae=le[ee.name],ie=document.createElement("span");ie.className="spanPadding "+ee.name+" customSpanColor",ie.style.cssText=A(x,ae),X!==0&&oe?X===Le.spans.length-1?ie.textContent=C(ee.line):ie.textContent=ee.line:Le.spans.length>1&&X<Le.spans.length-1&&ee.row===Le.spans[X+1].row?ie.textContent=N(ee.line):ie.textContent=ee.line.trim(),Ee.appendChild(ie)}}}ke.appendChild(Ee),ve.appendChild(ke);const Re={bodyStyle:["%",90]};for(const Oe in le)le.hasOwnProperty(Oe)&&(Re[Oe]=["%",90]);G.push({type:"html",start:B,end:q,cueHTMLElement:ve,cueID:F,cellResolution:[32,15],isFromCEA608:!0,fontSize:Re,lineHeight:{},linePadding:{}})}return G}},b}Ou.__dashjs_factory_name="EmbeddedTextHtmlRender";var Jm=n.default.getSingletonFactory(Ou),fs=class{constructor(){this.time=null,this.verboseLevel=0}log(b,p){if(this.verboseLevel>=b){const v=typeof p=="function"?p():p;console.log(`${this.time} [${b}] ${v}`)}}},zu=class{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(b){for(const p of["foreground","underline","italics","background","flash"])Object.prototype.hasOwnProperty.call(b,p)&&(this[p]=b[p])}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(b){return this.foreground===b.foreground&&this.underline===b.underline&&this.italics===b.italics&&this.background===b.background&&this.flash===b.flash}copy(b){this.foreground=b.foreground,this.underline=b.underline,this.italics=b.italics,this.background=b.background,this.flash=b.flash}},Zm=class{constructor(){this.uchar=" ",this.penState=new zu}reset(){this.uchar=" ",this.penState.reset()}setChar(b,p){this.uchar=b,this.penState.copy(p)}setPenState(b){this.penState.copy(b)}equals(b){return this.uchar===b.uchar&&this.penState.equals(b.penState)}copy(b){this.uchar=b.uchar,this.penState.copy(b.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}};const mr=100,eg={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499};function Uu(b){return String.fromCharCode(eg[b]||b)}var tg=class{constructor(b=new fs){this.chars=[],this.cueStartTime=null,this.pos=0,this.currPenState=new zu;for(let p=0;p<mr;p++)this.chars.push(new Zm);this.logger=b}equals(b){for(let p=0;p<mr;p++)if(!this.chars[p].equals(b.chars[p]))return!1;return!0}copy(b){for(let p=0;p<mr;p++)this.chars[p].copy(b.chars[p])}isEmpty(){let b=!0;for(let p=0;p<mr;p++)if(!this.chars[p].isEmpty()){b=!1;break}return b}setCursor(b){this.pos!==b&&(this.pos=b),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>mr&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=mr)}moveCursor(b){const p=this.pos+b;if(b>1)for(let v=this.pos+1;v<p+1;v++)this.chars[v].setPenState(this.currPenState);this.setCursor(p)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(b){b>=144&&this.backSpace();const p=Uu(b);this.pos>=mr?this.logger.log(0,(()=>"Cannot insert "+b.toString(16)+" ("+p+") at position "+this.pos+". Skipping it!")):(this.chars[this.pos].setChar(p,this.currPenState),this.moveCursor(1))}clearFromPos(b){let p;for(p=b;p<mr;p++)this.chars[p].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const b=[];let p=!0;for(let v=0;v<mr;v++){const T=this.chars[v].uchar;T!==" "&&(p=!1),b.push(T)}return p?"":b.join("")}setPenStyles(b){this.currPenState.setStyles(b),this.chars[this.pos].setPenState(this.currPenState)}};const Hr=15;var Io=class{constructor(b=new fs){this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null;for(let p=0;p<Hr;p++)this.rows.push(new tg(b));this.logger=b}reset(){for(let b=0;b<Hr;b++)this.rows[b].clear();this.currRow=14}equals(b){let p=!0;for(let v=0;v<Hr;v++)if(!this.rows[v].equals(b.rows[v])){p=!1;break}return p}copy(b){for(let p=0;p<Hr;p++)this.rows[p].copy(b.rows[p])}isEmpty(){let b=!0;for(let p=0;p<Hr;p++)if(!this.rows[p].isEmpty()){b=!1;break}return b}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(b){this.rows[this.currRow].insertChar(b)}setPen(b){this.rows[this.currRow].setPenStyles(b)}moveCursor(b){this.rows[this.currRow].moveCursor(b)}setCursor(b){this.logger.log(2,"setCursor: "+b),this.rows[this.currRow].setCursor(b)}setPAC(b){this.logger.log(2,(()=>"pacData = "+JSON.stringify(b)));let p=b.row-1;if(this.nrRollUpRows&&p<this.nrRollUpRows-1&&(p=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==p){for(let N=0;N<Hr;N++)this.rows[N].clear();const w=this.currRow+1-this.nrRollUpRows,A=this.lastOutputScreen;if(A){const N=A.rows[w].cueStartTime,C=this.logger.time;if(N!==null&&C!==null&&N<C)for(let x=0;x<this.nrRollUpRows;x++)this.rows[p-this.nrRollUpRows+x+1].copy(A.rows[w+x])}}this.currRow=p;const v=this.rows[this.currRow];if(b.indent!==null){const w=b.indent,A=Math.max(w-1,0);v.setCursor(b.indent),b.color=v.chars[A].penState.foreground}const T={foreground:b.color,underline:b.underline,italics:b.italics,background:"black",flash:!1};this.setPen(T)}setBkgData(b){this.logger.log(2,(()=>"bkgData = "+JSON.stringify(b))),this.backSpace(),this.setPen(b),this.insertChar(32)}setRollUpRows(b){this.nrRollUpRows=b}rollUp(){if(this.nrRollUpRows===null)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,(()=>this.getDisplayText()));const b=this.currRow+1-this.nrRollUpRows,p=this.rows.splice(b,1)[0];p.clear(),this.rows.splice(this.currRow,0,p),this.logger.log(2,"Rolling up")}getDisplayText(b){b=b||!1;const p=[];let v="",T=-1;for(let w=0;w<Hr;w++){const A=this.rows[w].getTextString();A&&(T=w+1,b?p.push("Row "+T+": '"+A+"'"):p.push(A.trim()))}return p.length>0&&(v=b?"["+p.join(" | ")+"]":p.join(`
`)),v}getTextAndFormat(){return this.rows}},Bu=class{constructor(b,p,v=new fs){this.chNr=b,this.outputFilter=p,this.mode=null,this.displayedMemory=new Io(v),this.nonDisplayedMemory=new Io(v),this.lastOutputScreen=new Io(v),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=v,this.logger.log(2,"new Cea608Channel("+this.chNr+")")}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter?.reset?.(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(b){this.outputFilter=b}setPAC(b){this.writeScreen.setPAC(b)}setBkgData(b){this.writeScreen.setBkgData(b)}setMode(b){b!==this.mode&&(this.mode=b,this.logger.log(2,(()=>"MODE="+b)),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.setRollUpRows(null),this.nonDisplayedMemory.setRollUpRows(null)),this.mode=b)}insertChars(b){for(const v of b)this.writeScreen.insertChar(v);const p=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,(()=>p+": "+this.writeScreen.getDisplayText(!0))),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(1,(()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0))),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(b){this.logger.log(2,"RU("+b+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(b)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const b=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=b,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,(()=>"DISP: "+this.displayedMemory.getDisplayText()))}this.outputDataUpdate(!0)}ccTO(b){this.logger.log(2,"TO("+b+") - Tab Offset"),this.writeScreen.moveCursor(b)}ccMIDROW(b){const p={flash:!1};p.underline=b%2==1,p.italics=b>=46,p.italics?p.foreground="white":p.foreground=["white","green","blue","cyan","red","yellow","magenta"][Math.floor(b/2)-16],this.logger.log(2,"MIDROW: "+JSON.stringify(p)),this.writeScreen.setPen(p)}outputDataUpdate(b=!1){const p=this.logger.time;p!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,p,this.lastOutputScreen),b&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:p):this.cueStartTime=p,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(b){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,b,this.displayedMemory),this.cueStartTime=b))}};const ng=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];function ag(b,p,v){return v.a===b&&v.b===p}function Gr(b){const p=[];for(const v of b)p.push(v.toString(16));return p}const rg={17:2,18:4,21:6,22:8,23:10,19:13,20:15},ig={25:2,26:4,29:6,30:8,31:10,27:13,28:15},sg={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},og={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14};function hs(b,p,v){v.a=b,v.b=p}var Fu=class{constructor(b,p,v){this.currentChannel=0,this.cmdHistory={a:null,b:null},this.lastTime=null;const T=this.logger=new fs;this.channels=[null,new Bu(b,p,T),new Bu(b+1,v,T)]}addData(b,p){this.lastTime=b,this.logger.time=b;for(let v=0;v<p.length;v+=2){const T=127&p[v],w=127&p[v+1];let A=!1,N=null;if(this.lastTime!==null&&(b=this.lastTime+.5*v*1001/3e4,this.logger.time=b),T===0&&w===0)continue;this.logger.log(3,(()=>"["+Gr([p[v],p[v+1]])+"] -> ("+Gr([T,w])+")"));const C=this.cmdHistory;if(T>=16&&T<=31){if(ag(T,w,C)){hs(null,null,C),this.logger.log(3,(()=>"Repeated command ("+Gr([T,w])+") is dropped"));continue}hs(T,w,this.cmdHistory),A=this.parseCmd(T,w),A||(A=this.parseMidrow(T,w)),A||(A=this.parsePAC(T,w)),A||(A=this.parseBackgroundAttributes(T,w))}else hs(null,null,C);if(!A&&(N=this.parseChars(T,w),N.length)){const x=this.currentChannel;x&&x>0?this.channels[x].insertChars(N):this.logger.log(2,"No channel found yet. TEXT-MODE?")}A||N||this.logger.log(2,(()=>"Couldn't parse cleaned data "+Gr([T,w])+" orig: "+Gr([p[v],p[v+1]])))}}parseCmd(b,p){if(!((b===20||b===28||b===21||b===29)&&p>=32&&p<=47||(b===23||b===31)&&p>=33&&p<=35))return!1;const v=b===20||b===21||b===23?1:2,T=this.channels[v];return b===20||b===21||b===28||b===29?p===32?T.ccRCL():p===33?T.ccBS():p===34?T.ccAOF():p===35?T.ccAON():p===36?T.ccDER():p===37?T.ccRU(2):p===38?T.ccRU(3):p===39?T.ccRU(4):p===40?T.ccFON():p===41?T.ccRDC():p===42?T.ccTR():p===43?T.ccRTD():p===44?T.ccEDM():p===45?T.ccCR():p===46?T.ccENM():p===47&&T.ccEOC():T.ccTO(p-32),this.currentChannel=v,!0}parseMidrow(b,p){let v=0;if((b===17||b===25)&&p>=32&&p<=47){if(v=b===17?1:2,v!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const T=this.channels[v];return!!T&&(T.ccMIDROW(p),this.logger.log(3,(()=>"MIDROW ("+Gr([b,p])+")")),!0)}return!1}parsePAC(b,p){let v;if(!((b>=17&&b<=23||b>=25&&b<=31)&&p>=64&&p<=127||(b===16||b===24)&&p>=64&&p<=95))return!1;const T=b<=23?1:2;v=p>=64&&p<=95?T===1?sg[b]:og[b]:T===1?rg[b]:ig[b];const w=this.channels[T];return!!w&&(w.setPAC(this.interpretPAC(v,p)),this.currentChannel=T,!0)}interpretPAC(b,p){let v;const T={color:null,italics:!1,indent:null,underline:!1,row:b};return v=p>95?p-96:p-64,T.underline=!(1&~v),v<=13?T.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(v/2)]:v<=15?(T.italics=!0,T.color="white"):T.indent=4*Math.floor((v-16)/2),T}parseChars(b,p){let v,T=[],w=null;if(b>=25?(v=2,w=b-8):(v=1,w=b),w>=17&&w<=19){let A;A=w===17?p+80:w===18?p+112:p+144,this.logger.log(2,(()=>"Special char '"+Uu(A)+"' in channel "+v)),T=[A]}else b>=32&&b<=127&&(T=p===0?[b]:[b,p]);return T&&this.logger.log(3,(()=>"Char codes =  "+Gr(T).join(","))),T}parseBackgroundAttributes(b,p){if(!((b===16||b===24)&&p>=32&&p<=47||(b===23||b===31)&&p>=45&&p<=47))return!1;let v;const T={};b===16||b===24?(v=Math.floor((p-32)/2),T.background=ng[v],p%2==1&&(T.background=T.background+"_semi")):p===45?T.background="transparent":(T.foreground="black",p===47&&(T.underline=!0));const w=b<=23?1:2;return this.channels[w].setBkgData(T),!0}reset(){for(let b=0;b<Object.keys(this.channels).length;b++){const p=this.channels[b];p&&p.reset()}hs(null,null,this.cmdHistory)}cueSplitAtTime(b){for(const p of this.channels)p&&p.cueSplitAtTime(b)}};function lg(b,p,v){const T=[];for(let w=p;w<v;w++)w+2<v&&b.getUint8(w)===0&&b.getUint8(w+1)===0&&b.getUint8(w+2)===3?(T.push(0),T.push(0),w+=2):T.push(b.getUint8(w));return new DataView(new Uint8Array(T).buffer)}function cg(b,p,v,T){return!(b!==4||p<8)&&v.getUint8(T)===181&&v.getUint16(T+1)===49&&v.getUint32(T+3)===1195456820&&v.getUint8(T+7)===3}function ug(b,p){return(127&b)>0||(127&p)>0}function dg(b,p){let v=0;for(;v<b.byteLength;){let w,A=0,N=0;do A+=w=b.getUint8(v++);while(w===255);do N+=w=b.getUint8(v++);while(w===255);if(cg(A,N,b,v)){const C=v+10,x=C+3*(31&b.getUint8(C-2));for(let B=C;B<x;B+=3){const q=b.getUint8(B);if(4&q){const I=3&q;if((T=I)===0||T===1){const P=b.getUint8(B+1),D=b.getUint8(B+2);ug(P,D)&&p[I].push(P,D)}}}}v+=N}var T}function fg(b,p,v){let T=0,w=0;const A=[[],[]];for(let N=p;N<p+v-5&&(T=b.getUint32(N),w=31&b.getUint8(N+4),!(N+5+T>p+v));N++)w===6&&N+5+T<=b.byteLength&&dg(lg(b,N+5,N+5+T),A),N+=T+3;return A}function qu(b){const p=b.errHandler,v=b.manifestModel,T=b.mediaController,w=b.videoModel,A=b.textTracks,N=b.vttParser,C=b.vttCustomRenderingParser,x=b.ttmlParser,B=b.streamInfo,q=b.settings,I=this.context,P=(0,y.default)(I).getInstance();let D,$,J,Z,V,re,le,ue,be,X,G,U,F,ve,te,ke,Ee,Re=!1;function Oe(){re=null,ue=NaN,be=[],X=null,le=!1,V=[],Z=null}function Le(_e){const xe={};xe[Se.default.SUBTITLE]="subtitles",xe[Se.default.CAPTION]="captions",xe[Se.default.FORCED_SUBTITLE]="subtitles";const Me=new Qm;for(let Ne in _e)Me[Ne]=_e[Ne];Me.defaultTrack=(function(Ne){let Ge=!1;return U.length>1&&Ne.isEmbedded?Ge=Ne.id&&Ne.id===l.default.CC1:U.length===1?Ne.id&&typeof Ne.id=="string"&&Ne.id.substring(0,2)==="CC"&&(Ge=!0):U.length===0&&(Ge=Ne.index===V[0].index),Ge})(_e),Me.isTTML=(function(Ne){return Ne.codec&&Ne.codec.search(l.default.STPP)>=0||Ne.mimeType&&Ne.mimeType.search(l.default.TTML)>=0})(_e),Me.kind=(function(Ne,Ge){let Ze=Ne.roles&&Ne.roles.length>0?Ge[Ne.roles[0].value]:Ge.caption;return Ze=Object.values(Ge).includes(Ze)?Ze:Ge.caption,Ze})(_e,xe),A.addTextTrackInfo(Me)}function Q(_e){const xe=_e.chunk;xe.representation.mediaInfo.embeddedCaptions&&oe(xe.bytes,xe)}function ee(_e){G=_e}function oe(_e,xe){const Me=xe.representation.mediaInfo,Ne=Me.type,Ge=Me.mimeType,Ze=Me.codec||Ge;Ze?Me.codec.indexOf("application/mp4")!==-1?(function(ht,wt,Wt){let At,Vt;if(wt.segmentType==="InitializationSegment")le=!0,ue=J.getMediaTimescaleFromMoov(ht);else{if(!le)return;Vt=J.getSamplesInfo(ht),At=Vt.sampleList,At.length>0&&(X=At[0].cts-wt.start*ue),Wt.search(l.default.STPP)>=0?(function(on,kn,vn){let cn,pn;for(Z=Z!==null?Z:me(vn),cn=0;cn<kn.length;cn++){const We=kn[cn],pt=We.cts,gt=ie(),St=gt+pt/ue,Kt=St+We.duration/ue;D.buffered.add(St,Kt);const gn=new DataView(on,We.offset,We.subSizes[0]);let ot=ki.Utils.dataViewToString(gn,l.default.UTF8);const _t=[];let Ut=We.offset+We.subSizes[0];for(pn=1;pn<We.subSizes.length;pn++){const je=new Uint8Array(on,Ut,We.subSizes[pn]),Qe=String.fromCharCode.apply(null,je);_t.push(Qe),Ut+=We.subSizes[pn]}try{const je=v.getValue().ttmlTimeIsRelative?pt/ue:0,Qe=Z.parse(ot,je,pt/ue,(pt+We.duration)/ue,_t);A.addCaptions(G,gt,Qe)}catch(je){re.removeExecutedRequestsBeforeTime(),K(),$.error("TTML parser error: "+je)}}})(ht,At,Wt):(function(on,kn){let vn,cn,pn;const We=[];for(vn=0;vn<kn.length;vn++){const pt=kn[vn];pt.cts-=X;const gt=ie()+pt.cts/ue,St=gt+pt.duration/ue;D.buffered.add(gt,St);const Kt=on.slice(pt.offset,pt.offset+pt.size),gn=ki.parseBuffer(Kt);for(cn=0;cn<gn.boxes.length;cn++){const ot=gn.boxes[cn];if($.debug("VTT box1: "+ot.type),ot.type!=="vtte"&&ot.type==="vttc"){$.debug("VTT vttc boxes.length = "+ot.boxes.length);let _t={styles:{}};for(pn=0;pn<ot.boxes.length;pn++){const Ut=ot.boxes[pn];if($.debug("VTT box2: "+Ut.type),Ut.type==="payl")_t.start=pt.cts/ue,_t.end=(pt.cts+pt.duration)/ue,_t.data=Ut.cue_text;else if(Ut.type==="sttg"&&Ut.settings&&Ut.settings!=="")try{const je=Ut.settings.split(" ");_t.styles=N.getCaptionStyles(je)}catch{}}_t&&_t.data&&(We.push(_t),$.debug(`VTT  ${_t.start} - ${_t.end} :  ${_t.data}`))}}}We.length>0&&A.addCaptions(G,0,We)})(ht,At)}})(_e,xe,Ze):Ne===l.default.VIDEO?(function(ht,wt){let Wt,At;if(wt.segmentType===ye.HTTPRequest.INIT_SEGMENT_TYPE)F===0&&(F=J.getMediaTimescaleFromMoov(ht));else if(wt.segmentType===ye.HTTPRequest.MEDIA_SEGMENT_TYPE){if(F===0)return void $.warn("CEA-608: No timescale for embeddedTextTrack yet");At=J.getSamplesInfo(ht);const Vt=At.lastSequenceNumber,on=Math.trunc(wt.start),kn=Math.trunc(wt.end);if(ke[0]||ke[1]||(function(){let vn;for(let cn=0;cn<U.length;cn++){if(vn=A.getTrackIdxForId(U[cn].id),vn===-1)return void $.warn("CEA-608: data before track is ready.");const pn=ae(vn);ke[cn]=new Fu(cn+1,{newCue:pn},null)}})(),F){if((function(cn,pn,We,pt,gt){return cn!==null&&pn!==null&&pt!==null&&gt!==null&&(pn===cn?pt!==gt:pn!==cn+We)})(ve,Vt,At.numSequences,te,on))for(Wt=0;Wt<ke.length;Wt++)ke[Wt]&&ke[Wt].reset();const vn=(function(cn,pn){if(pn.length===0)return null;const We={splits:[],fields:[[],[]]},pt=new DataView(cn);for(let gt=0;gt<pn.length;gt++){const St=pn[gt],Kt=fg(pt,St.offset,St.size);let gn=null,ot=0;for(let _t=0;_t<2;_t++)if(Kt[_t].length>0){St.cts!==gn?ot=0:ot+=1;const Ut=ie();We.fields[_t].push([St.cts+Ut*F,Kt[_t],ot]),gn=St.cts}}return We.fields.forEach((function(gt){gt.sort((function(St,Kt){return St[0]===Kt[0]?St[2]-Kt[2]:St[0]-Kt[0]}))})),We})(ht,At.sampleList);for(let cn=0;cn<ke.length;cn++){const pn=vn.fields[cn],We=ke[cn];if(We)for(Wt=0;Wt<pn.length;Wt++)We.addData(pn[Wt][0]/F,pn[Wt][1])}ve=Vt,te=kn}}})(_e,xe):(function(ht,wt,Wt){let At,Vt;const on=new DataView(ht,0,ht.byteLength);Vt=ki.Utils.dataViewToString(on,l.default.UTF8);try{At=me(Wt).parse(Vt,0),A.addCaptions(A.getCurrentTrackIdx(),0,At),D.buffered&&D.buffered.add(wt.start,wt.end)}catch(kn){p.error(new Bt.default(Yt.TIMED_TEXT_ERROR_ID_PARSE_CODE,Yt.TIMED_TEXT_ERROR_MESSAGE_PARSE+kn.message,Vt))}})(_e,xe,Ze):$.error("No text type defined")}function ae(_e){return function(xe,Me,Ne){let Ge;Ge=w.getTTMLRenderingDiv()?Ee.createHTMLCaptionsFromScreen(w.getElement(),xe,Me,Ne):[{start:xe,end:Me,data:Ne.getDisplayText(),styles:{}}],Ge&&A.addCaptions(_e,0,Ge)}}function ie(){return isNaN(D.timestampOffset)?0:D.timestampOffset}function me(_e){let xe;return _e.search(l.default.VTT)>=0?xe=q.get().streaming.text.webvtt.customRenderingEnabled&&C?C:N:(_e.search(l.default.TTML)>=0||_e.search(l.default.STPP)>=0)&&(xe=x),xe}function K(_e,xe){_e===void 0&&_e===xe&&(_e=D.buffered.start(0),xe=D.buffered.end(D.buffered.length-1)),D.buffered.remove(_e,xe),A.deleteCuesFromTrackIdx(G,_e,xe)}function ge(_e){U.forEach((function(xe){const Me=A.getTrackIdxForId(xe.id);Me>=0&&A.deleteCuesFromTrackIdx(Me,_e.from,_e.to)}))}return D={initialize:function(){Re||(U=[],G=null,F=0,ke=[],ve=null,te=null,Re=!0,Ee=Jm(I).getInstance(),P.on(u.default.VIDEO_CHUNK_RECEIVED,Q,D),P.on(u.default.BUFFER_CLEARED,ge,D))},addMediaInfos:function(_e,xe,Me){if(V=V.concat(xe),_e===l.default.TEXT&&xe[0].isFragmented&&!xe[0].isEmbedded){re=Me,D.buffered=(0,Xm.default)(I).create(),be=T.getTracksFor(l.default.TEXT,B.id).filter((Ge=>Ge.isFragmented));const Ne=T.getCurrentTrackFor(l.default.TEXT,B.id);for(let Ge=0;Ge<be.length;Ge++)if(be[Ge]===Ne){ee(Ge);break}}for(let Ne=0;Ne<xe.length;Ne++)Le(xe[Ne])},resetMediaInfos:function(){V=[]},getStreamId:function(){return B.id},append:oe,abort:function(){},addEmbeddedTrack:function(_e){if(Re&&_e)if(_e.id===l.default.CC1||_e.id===l.default.CC3){for(let xe=0;xe<U.length;xe++)if(U[xe].id===_e.id)return;U.push(_e)}else $.warn("Embedded track "+_e.id+" not supported!")},resetEmbedded:function(){P.off(u.default.VIDEO_CHUNK_RECEIVED,Q,D),P.off(u.default.BUFFER_CLEARED,ge,D),A&&A.deleteAllTextTracks(),Re=!1,U=[],ke=[null,null],ve=null,te=null},getConfig:function(){return{fragmentModel:re,fragmentedTracks:be,videoModel:w}},setCurrentFragmentedTrackIdx:ee,remove:K,reset:function(){Oe(),V=[],J=null}},$=(0,c.default)(I).getInstance().getLogger(D),J=rs(I).getInstance(),Oe(),D}qu.__dashjs_factory_name="TextSourceBuffer";var hg=n.default.getClassFactory(qu);class mg{constructor(){this.root=null,this.size=0}addCue(p){const v={start:p.startTime,end:p.endTime,cue:p,maxEnd:p.endTime,left:null,right:null,height:1},[T,w]=this._insert(v,this.root);this.root=T,w&&this.size++}removeCue(p){const[v,T]=this._remove(p,this.root);return this.root=v,T&&this.size--,T}findCuesInRange(p,v){const T=[];return this._searchRange(this.root,p,v,T),T}findCuesAtTime(p){return this.findCuesInRange(p,p)}getAllCues(){const p=[];return this._inorderTraversal(this.root,p),p}getSize(){return this.size}clear(){this.root=null,this.size=0}_compareCues(p,v){return p.startTime!==v.startTime?p.startTime-v.startTime:p.endTime!==v.endTime?p.endTime-v.endTime:typeof VTTCue<"u"&&p instanceof VTTCue&&v instanceof VTTCue||p.text&&v.text?p.text.localeCompare(v.text):0}_compareIntervals(p,v){return this._compareCues(p.cue,v.cue)}_insert(p,v){if(!v)return[p,!0];const T=this._compareIntervals(p,v);if(T<0){const[A]=this._insert(p,v.left);v.left=A}else{if(!(T>0))return[v,!1];{const[A]=this._insert(p,v.right);v.right=A}}v.height=1+Math.max(this._getHeight(v.left),this._getHeight(v.right)),v.maxEnd=Math.max(v.maxEnd,p.maxEnd);const w=this._getBalance(v);return w>1?(this._compareIntervals(p,v.left)<0||(v.left=this._leftRotate(v.left)),[this._rightRotate(v),!0]):w<-1?(this._compareIntervals(p,v.right)>0||(v.right=this._rightRotate(v.right)),[this._leftRotate(v),!0]):[v,!0]}_searchRange(p,v,T,w){p&&(this._overlaps(p,v,T)&&w.push(p.cue),p.left&&p.left.maxEnd>=v&&this._searchRange(p.left,v,T,w),p.right&&p.start<=T&&this._searchRange(p.right,v,T,w))}_inorderTraversal(p,v){p&&(this._inorderTraversal(p.left,v),v.push(p.cue),this._inorderTraversal(p.right,v))}_overlaps(p,v,T){if(T===v){const w=v;return p.start<=w&&w<p.end}return p.start<T&&v<p.end}_getHeight(p){return p?p.height:0}_getBalance(p){return p?this._getHeight(p.left)-this._getHeight(p.right):0}_leftRotate(p){const v=p.right,T=v.left;return v.left=p,p.right=T,p.height=1+Math.max(this._getHeight(p.left),this._getHeight(p.right)),v.height=1+Math.max(this._getHeight(v.left),this._getHeight(v.right)),p.maxEnd=Math.max(p.end,p.left?p.left.maxEnd:0,p.right?p.right.maxEnd:0),v.maxEnd=Math.max(v.end,v.left?v.left.maxEnd:0,v.right?v.right.maxEnd:0),v}_rightRotate(p){const v=p.left,T=v.right;return v.right=p,p.left=T,p.height=1+Math.max(this._getHeight(p.left),this._getHeight(p.right)),v.height=1+Math.max(this._getHeight(v.left),this._getHeight(v.right)),p.maxEnd=Math.max(p.end,p.left?p.left.maxEnd:0,p.right?p.right.maxEnd:0),v.maxEnd=Math.max(v.end,v.left?v.left.maxEnd:0,v.right?v.right.maxEnd:0),v}_remove(p,v){if(!v)return[null,!1];const T=this._compareCues(p,v.cue);if(T<0){const[w,A]=this._remove(p,v.left);return v.left=w,A&&this._updateNode(v),[v,A]}if(T>0){const[w,A]=this._remove(p,v.right);return v.right=w,A&&this._updateNode(v),[v,A]}if(v.left||v.right){if(v.left){if(v.right){const w=this._findMin(v.right);v.cue=w.cue,v.start=w.start,v.end=w.end;const[A]=this._remove(w.cue,v.right);return v.right=A,this._updateNode(v),[v,!0]}return[v.left,!0]}return[v.right,!0]}return[null,!0]}_findMin(p){for(;p.left;)p=p.left;return p}_updateNode(p){p.height=1+Math.max(this._getHeight(p.left),this._getHeight(p.right)),p.maxEnd=Math.max(p.end,p.left?p.left.maxEnd:0,p.right?p.right.maxEnd:0)}}var Ro=t(7640);const ju=["text","align","fontSize","id","isd","line","lineAlign","lineHeight","linePadding","position","positionAlign","region","size","snapToLines","vertical"];function Hu(b){const p=this.context,v=(0,y.default)(p).getInstance(),T=b.videoModel,w=b.streamInfo,A=b.settings;let N,C,x,B,q,I,P,D,$,J,Z,V,re,le,ue,be,X,G,U,F;const ve=new Map;function te(We){const pt=We.kind,gt=We.id!==void 0?We.id:We.lang,St=We.lang,Kt=We.isTTML,gn=We.isEmbedded;return T.addTextTrack(pt,gt,St,Kt,gn)}function ke(We,pt,gt,St,Kt,gn){let ot=0,_t=0;We/pt>gt/St?(_t=pt,ot=_t/St*gt):(ot=We,_t=ot/gt*St);let Ut=0,je=0,Qe=0,bt=0;return ot/_t>Kt?(bt=_t,Qe=_t*Kt):(Qe=ot,bt=ot/Kt),Ut=(We-Qe)/2,je=(pt-bt)/2,gn?{x:Ut+.1*Qe,y:je+.1*bt,w:.8*Qe,h:.8*bt}:{x:Ut,y:je,w:Qe,h:bt}}function Ee(We,pt){const gt=T.getClientWidth(),St=T.getClientHeight(),Kt=T.getVideoWidth(),gn=T.getVideoHeight(),ot=T.getVideoRelativeOffsetTop(),_t=T.getVideoRelativeOffsetLeft();if(Kt!==0&&gn!==0){let Ut=Kt/gn,je=!1;We.isFromCEA608&&(Ut=3.5/3,je=!0);const Qe=ke.call(this,gt,St,Kt,gn,Ut,je),bt=Qe.w,Je=Qe.h,Rt=Qe.x,Lt=Qe.y;if(bt!=$||Je!=J||Rt!=P||Lt!=D||pt){if(P=Rt+_t,D=Lt+ot,$=bt,J=Je,Z){const rt=Z.style;rt&&(rt.left=P+"px",rt.top=D+"px",rt.width=$+"px",rt.height=J+"px",rt.zIndex=le&&document[le]||ue?X:null,v.trigger(d.default.CAPTION_CONTAINER_RESIZE))}const Ce=We.activeCues;if(Ce){const rt=Ce.length;for(let Pt=0;Pt<rt;++Pt){const zt=Ce[Pt];zt.scaleCue(zt)}}}}}function Re(We){const pt=$,gt=J;let St,Kt,gn,ot,_t;if(We.cellResolution){const Ut=[pt/We.cellResolution[0],gt/We.cellResolution[1]];if(We.linePadding){for(St in We.linePadding)if(We.linePadding.hasOwnProperty(St)){Kt=(We.linePadding[St]*Ut[0]).toString();const je=document.getElementsByClassName("spanPadding");for(let Qe=0;Qe<je.length;Qe++)je[Qe].style.cssText=je[Qe].style.cssText.replace(/(padding-left\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+Kt),je[Qe].style.cssText=je[Qe].style.cssText.replace(/(padding-right\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+Kt)}}if(We.fontSize){for(St in We.fontSize)if(We.fontSize.hasOwnProperty(St)){We.fontSize[St][0]==="%"?gn=We.fontSize[St][1]/100:We.fontSize[St][0]==="c"&&(gn=We.fontSize[St][1]),Kt=(gn*Ut[1]).toString(),_t=St!=="defaultFontSize"?document.getElementsByClassName(St):document.getElementsByClassName("paragraph");for(let je=0;je<_t.length;je++)_t[je].style.cssText=_t[je].style.cssText.replace(/(font-size\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+Kt)}if(We.lineHeight){for(St in We.lineHeight)if(We.lineHeight.hasOwnProperty(St)){We.lineHeight[St][0]==="%"?ot=We.lineHeight[St][1]/100:We.fontSize[St][0]==="c"&&(ot=We.lineHeight[St][1]),Kt=(ot*Ut[1]).toString(),_t=document.getElementsByClassName(St);for(let je=0;je<_t.length;je++)_t[je].style.cssText=_t[je].style.cssText.replace(/(line-height\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+Kt)}}}}if(We.isd){let Ut=document.getElementById(We.cueID);Ut&&Z.removeChild(Ut),Le(We)}}function Oe(We,pt){const gt=/^(urn:)(mpeg:[a-z0-9][a-z0-9-]{0,31}:)(subs:)([0-9]+)$/,St=/^#(.*)$/;if(gt.test(pt)){const Kt=gt.exec(pt),gn=parseInt(Kt[4],10)-1;return"data:image/png;base64,"+btoa(We.images[gn])}if(St.test(pt)){const Kt=St.exec(pt)[1];return"data:image/png;base64,"+We.embeddedImages[Kt]}return pt}function Le(We){if(Z){cn.call(this);const pt=document.createElement("div");Z.appendChild(pt),be=(0,Ro.renderHTML)(We.isd,pt,(function(gt){return Oe(We,gt)}),Z.clientHeight,Z.clientWidth,A.get().streaming.text.imsc.displayForcedOnlyMode,(function(gt){C.info("renderCaption :",gt)}),be,A.get().streaming.text.imsc.enableRollUp),pt.id=We.cueID,v.trigger(d.default.CAPTION_RENDERED,{captionDiv:pt,currentTrackIdx:I})}}function Q(We,pt){const gt=pt.findCuesInRange(We.startTime-.1,We.endTime+.1);for(const St of gt)if(ee(We,St)&&oe(We,St,ju)||ee(St,We)&&oe(We,St,ju))return St;return null}function ee(We,pt){return!!pt&&pt.endTime>=We.startTime}function oe(We,pt,gt){for(let St=0;St<gt.length;St++){const Kt=gt[St];if(JSON.stringify(We[Kt])!==JSON.stringify(pt[Kt]))return!1}return!0}function ae(We,pt){pt&&pt.forEach((gt=>{gt.kind&&gt.kind==="image"&&(gt.src=Oe(We,gt.src)),ae(We,gt.contents)}))}function ie(We,pt,gt){const St=ht(We),Kt=ve.get(St),gn=A.get().streaming.text.dispatchForManualRendering;if(St&&Kt&&Array.isArray(gt)&&gt.length!==0){for(let Ut=0;Ut<gt.length;Ut++){let je=null;const Qe=gt[Ut];if(St.cellResolution=Qe.cellResolution,St.isFromCEA608=Qe.isFromCEA608,isNaN(Qe.start)||isNaN(Qe.end)||(gn?je=me(Qe,pt):Me(Qe)&&Z?je=_e(Qe,pt,St):Qe.data&&(je=xe(Qe,pt,St))),je){if(A.get().streaming.text.extendSegmentedCues){const bt=Q(je,Kt.allCues);bt&&(Kt.allCues.removeCue(bt),_t=je,(ot=bt).startTime=Math.min(ot.startTime,_t.startTime),ot.endTime=Math.max(ot.endTime,_t.endTime),je=ot)}Kt.allCues.addCue(je)}else C.error("Impossible to display subtitles. You might have missed setting a TTML rendering div via player.attachTTMLRenderingDiv(TTMLRenderingDiv)")}var ot,_t;on()}}function me(We,pt){let gt=Ne(We,pt);return gt.onenter=function(){Me(We)&&F&&F.cueID!==gt.cueID&&ge(F),delete gt.type,F=gt,K(gt)},gt.onexit=function(){ge(gt),F=null},gt}function K(We){v.trigger(d.default.CUE_ENTER,We)}function ge(We){v.trigger(d.default.CUE_EXIT,{cueID:We.cueID})}function _e(We,pt,gt){const St=this;let Kt=Ne(We,pt);return Z.style.left=P+"px",Z.style.top=D+"px",Z.style.width=$+"px",Z.style.height=J+"px",Kt.onenter=function(){gt.mode===l.default.TEXT_SHOWING&&(this.isd?(U?requestAnimationFrame((()=>Le(this))):Le(this),C.debug("Cue enter id:"+this.cueID)):(Z.appendChild(this.cueHTMLElement),Re.call(St,this),v.trigger(d.default.CAPTION_RENDERED,{captionDiv:this.cueHTMLElement,currentTrackIdx:I})))},Kt.onexit=function(){if(Z){const gn=Z.childNodes;for(let ot=0;ot<gn.length;++ot)gn[ot].id===this.cueID&&(C.debug("Cue exit id:"+gn[ot].id),Z.removeChild(gn[ot]),--ot)}},Kt}function xe(We,pt,gt){let St=Ne(We,pt);if(We.styles)try{We.styles.align!==void 0&&"align"in St&&(St.align=We.styles.align),We.styles.line!==void 0&&"line"in St&&(St.line=We.styles.line),We.styles.lineAlign!==void 0&&(St.lineAlign=We.styles.lineAlign),We.styles.snapToLines!==void 0&&"snapToLines"in St&&(St.snapToLines=We.styles.snapToLines),We.styles.position!==void 0&&"position"in St&&(St.position=We.styles.position),We.styles.positionAlign!==void 0&&(St.positionAlign=We.styles.positionAlign),We.styles.size!==void 0&&"size"in St&&(St.size=We.styles.size)}catch(Kt){C.error(Kt)}return St.onenter=function(){gt.mode===l.default.TEXT_SHOWING&&v.trigger(d.default.CAPTION_RENDERED,{currentTrackIdx:I})},St}function Me(We){return We.type==="html"}function Ne(We,pt){return Me(We)?(function(gt,St){let Kt=new x(gt.start+St,gt.end+St,"");return Kt.cueHTMLElement=gt.cueHTMLElement,Kt.isd=gt.isd,Kt.images=gt.images,Kt.embeddedImages=gt.embeddedImages,Kt.cueID=gt.cueID,Kt.scaleCue=Re.bind(self),Kt.cellResolution=gt.cellResolution,Kt.lineHeight=gt.lineHeight,Kt.linePadding=gt.linePadding,Kt.fontSize=gt.fontSize,Kt.isd&&ae(Kt,Kt.isd.contents),Kt})(We,pt):(function(gt,St){let Kt=new x(gt.start-St,gt.end-St,gt.data);return Kt.cueID=at.default.generateUuid(),Kt})(We,pt)}function Ge(We){if(V){const pt=V.childNodes;for(let gt=0;gt<pt.length;++gt)pt[gt].id===We.cueID&&(V.removeChild(pt[gt]),--gt)}}function Ze(){const We=T.getTextTracks(),pt=[];for(const gt of We)gt.manualMode===l.default.TEXT_SHOWING&&pt.push(gt);return pt}function ht(We){return We>=0&&B[We]?T.getTextTrack(B[We].kind,B[We].id,B[We].lang,B[We].isTTML,B[We].isEmbedded):null}function wt(We){if(We===I)return;I=We;const pt=ht(I);Wt.call(this,pt),re&&(clearInterval(re),re=null),pt&&pt.renderingType==="html"&&(Ee.call(this,pt,!0),window.ResizeObserver?(G=new window.ResizeObserver((()=>{Ee.call(this,pt,!0)})),G.observe(T.getElement())):re=setInterval(Ee.bind(this,pt),500))}function Wt(We){cn.call(this),We&&We.renderingType==="html"?kn.call(this):vn.call(this)}function At(We,pt,gt,St=!0){return!!We&&(isNaN(pt)||(St?We.startTime:We.endTime)>=pt)&&(isNaN(gt)||(St?We.endTime:We.startTime)<=gt)}function Vt(We,pt,gt,St=!0){if(!We)return;if(We.cues&&We.cues.length>0)for(let gn=We.cues.length-1;gn>=0;gn--)At(We.cues[gn],pt,gt,St)&&(We.cues[gn].onexit&&We.cues[gn].onexit(),We.removeCue(We.cues[gn]));const Kt=ve.get(We);if(Kt){const gn=Kt.activeCues,ot=gn.filter((_t=>_t.startTime>=pt&&_t.endTime<=gt));ot.forEach((_t=>{A.get().streaming.text.dispatchForManualRendering?ge(_t):Ge(_t)})),Kt.activeCues=gn.filter((_t=>!ot.includes(_t)))}}function on(){for(const We of ve.values())We.lastCueWindowUpdate=-1/0}function kn(){let We=document.getElementById("native-cue-style");if(We)return;We=document.createElement("style"),We.id="native-cue-style",document.head.appendChild(We);const pt=We.sheet,gt=T.getElement();try{gt&&(gt.id?pt.insertRule("#"+gt.id+"::cue {background: transparent}",0):gt.classList.length!==0?pt.insertRule("."+gt.className+"::cue {background: transparent}",0):pt.insertRule("video::cue {background: transparent}",0))}catch(St){C.info(""+St.message)}}function vn(){const We=document.getElementById("native-cue-style");We&&document.head.removeChild(We)}function cn(){if(Z)for(;Z.firstChild;)Z.removeChild(Z.firstChild)}function pn(){return B}return N={addCaptions:ie,addTextTrackInfo:function(We){B.push(We)},createTracks:function(){B.sort((function(pt,gt){return pt.index-gt.index})),Z=T.getTTMLRenderingDiv(),V=T.getVttRenderingDiv();let We=-1;for(let pt=0;pt<B.length;pt++){const gt=te(B[pt]);q.push(gt),B[pt].defaultTrack&&(gt.default=!0,We=pt);const St=ht(pt);St&&(St.mode=l.default.TEXT_SHOWING,Z&&(B[pt].isTTML||B[pt].isEmbedded)?St.renderingType="html":St.renderingType="default",ve.set(St,{allCues:new mg,lastCueWindowUpdate:-1/0,activeCues:[]})),ie(pt,0,B[pt].captionData),v.trigger(d.default.TEXT_TRACK_ADDED)}if(wt.call(this,We),We>=0){let pt=function(){const gt=ht(We);gt&&gt.renderingType==="html"&&Ee.call(this,gt,!0),v.off(d.default.PLAYBACK_METADATA_LOADED,pt,this)};v.on(d.default.PLAYBACK_METADATA_LOADED,pt,this);for(let gt=0;gt<B.length;gt++){const St=ht(gt);if(St){const Kt=A.get().streaming.text.dispatchForManualRendering;St.mode=gt!==We||Kt?l.default.TEXT_HIDDEN:l.default.TEXT_SHOWING,St.manualMode=gt===We?l.default.TEXT_SHOWING:l.default.TEXT_HIDDEN}}}v.trigger(u.default.TEXT_TRACKS_QUEUE_INITIALIZED,{index:I,tracks:B,streamId:w.id})},deleteAllTextTracks:function(){const We=q?q.length:0;for(let pt=0;pt<We;pt++){const gt=ht(pt);gt&&Vt.call(this,gt,w.start,w.start+w.duration,!1)}q=[],B=[],re&&(clearInterval(re),re=null),G&&T&&(G.unobserve(T.getElement()),G=null),I=-1,cn.call(this),ve.clear()},deleteCuesFromTrackIdx:function(We,pt,gt){const St=ht(We);St&&Vt(St,pt,gt)},disableManualTracks:function(){const We=Ze();if(We&&We.length>0){const pt=We[0],gt=ve.get(pt);if(!gt)return;gt.activeCues.forEach((St=>{A.get().streaming.text.dispatchForManualRendering?ge(St):Ge(St)})),gt.activeCues=[]}},getCurrentTrackIdx:function(){return I},getCurrentTextTrackInfo:function(){return B[I]},getStreamId:function(){return w.id},getTextTrackInfos:pn,getTrackIdxForId:function(We){let pt=-1;for(let gt=0;gt<B.length;gt++)if(B[gt].id===We){pt=gt;break}return pt},initialize:function(){typeof window<"u"&&typeof navigator<"u"&&(x=window.VTTCue||window.TextTrackCue,B=[],q=[],I=-1,P=0,D=0,$=0,J=0,Z=null,V=null,re=null,ue=!1,X=2147483647,be=null,U="requestAnimationFrame"in window,ve.clear(),document.fullscreenElement!==void 0?le="fullscreenElement":document.webkitIsFullScreen!==void 0?le="webkitIsFullScreen":document.msFullscreenElement?le="msFullscreenElement":document.mozFullScreen&&(le="mozFullScreen"))},manualCueProcessing:function(We){const pt=Ze();if(pt&&pt.length>0){const gt=pt[0],St=ve.get(gt);if(!St)return;const Kt=St.activeCues,gn=St.allCues.findCuesAtTime(We),ot=Kt.filter((Ut=>!gn.includes(Ut))),_t=gn.filter((Ut=>!Kt.includes(Ut)));ot.forEach((Ut=>{A.get().streaming.text.dispatchForManualRendering?ge(Ut):Ge(Ut)})),_t.forEach((Ut=>{A.get().streaming.text.dispatchForManualRendering?K(Ut):WebVTT.processCues(window,[Ut],V,Ut.cueID)})),St.activeCues=gn}},setCurrentTrackIdx:wt,setModeForTrackIdx:function(We,pt){const gt=ht(We);gt&&gt.mode!==pt&&(gt.mode=pt),gt&&gt.manualMode!==pt&&(gt.manualMode=pt)},updateTextTrackWindow:function(We,pt=!1){const gt=pn(),St=A.get().streaming.text.webvtt.customRenderingEnabled;for(let Kt=0;Kt<gt.length;Kt++){const gn=gt[Kt],ot=ht(Kt),_t=ve.get(ot);if(!ot||!_t||!gn.isEmbedded&&St)continue;const{bufferToKeep:Ut,bufferPruningInterval:je}=A.get().streaming.buffer,Qe=Date.now();if((Qe-_t.lastCueWindowUpdate)/1e3<je&&!pt)continue;const bt=T.getPlaybackRate()||1,Je=Math.max(0,We-Ut/bt),Rt=We+2*je/bt;if(ot.cues)for(;ot.cues.length>0;)ot.removeCue(ot.cues[0]);ot.mode!==l.default.TEXT_DISABLED&&_t.allCues.findCuesInRange(Je,Rt).forEach((Lt=>{ot.addCue(Lt)})),_t.lastCueWindowUpdate=Qe}},invalidateCueWindow:on},C=(0,c.default)(p).getInstance().getLogger(N),N}Hu.__dashjs_factory_name="TextTracks";var gg=n.default.getClassFactory(Hu);function Gu(){const b=this.context;let p,v,T,w,A,N;function C(I){const P=I.split(":"),D=P.length-1;return I=60*parseInt(P[D-1],10)+parseFloat(P[D]),D===2&&(I+=3600*parseInt(P[0],10)),I}function x(I){const P=I.split(w),D=P[1].split(N);return D.shift(),P[1]=D[0],D.shift(),{cuePoints:P,styles:B(D)}}function B(I){const P={};return I.forEach((function(D){const $=D.split(":");if($.length>1){const[J,Z]=$;switch(J){case"align":case"A":P.align=Z;break;case"line":case"L":const[V,re]=Z.split(","),le=V.endsWith("%");P.line=V==="auto"?V:parseInt(V,10),le&&(P.snapToLines=!1),re&&(P.lineAlign=re);break;case"position":case"P":const[ue,be]=Z.split(",");P.position=parseInt(ue,10),be&&(P.positionAlign=be);break;case"size":case"S":P.size=parseInt(Z,10)}}})),P}function q(I,P){let D,$=P,J="",Z="";for(;I[$]!==""&&$<I.length;)$++;if(D=$-P,D>1)for(let V=0;V<D;V++){if(Z=I[P+V],Z.match(w)){J="";break}J+=Z,V!==D-1&&(J+=`
`)}else Z=I[P],Z.match(w)||(J=Z);return J}return p={parse:function(I){const P=[];let D,$;if(!I)return P;D=(I=I.split(T)).length,$=-1;for(let J=0;J<D;J++){let Z=I[J];if(Z.length>0&&Z!=="WEBVTT"&&Z.match(w)){const V=x(Z),re=V.cuePoints,le=V.styles,ue=q(I,J+1),be=C(re[0].replace(A,"")),X=C(re[1].replace(A,""));!isNaN(be)&&!isNaN(X)&&be>=$&&X>be?ue!==""?($=be,P.push({start:be,end:X,data:ue,styles:le})):v.error("Skipping cue due to empty/malformed cue text"):v.error("Skipping cue due to incorrect cue timing")}}return P},getCaptionStyles:B},v=(0,c.default)(b).getInstance().getLogger(p),T=/(?:\r\n|\r|\n)/gm,w=/-->/,A=/(^[\s]+|[\s]+$)/g,N=/\s\b/g,p}Gu.__dashjs_factory_name="VTTParser";var pg=n.default.getSingletonFactory(Gu);function Yu(){let b,p;return b={parse:function(v){let T=[];return p.oncue=function(w){w.start=w.startTime,w.end=w.endTime,w.data=w.text,w.styles={align:w.align,line:w.line,position:w.position,size:w.size},T.push(w)},p.parse(v),T}},(function(){try{window&&window.WebVTT&&window.WebVTT.Parser&&(p=new window.WebVTT.Parser(window,window.vttjs,window.WebVTT.StringDecoder()))}catch{}})(),b}Yu.__dashjs_factory_name="VttCustomRenderingParser";var yg=n.default.getSingletonFactory(Yu);function Ku(){const b=this.context,p=(0,y.default)(b).getInstance();let v,T,w=0;function A(){const N="cue_TTML_"+w;return w++,N}return v={parse:function(N,C,x,B,q){let I="";const P=[];let D,$,J;const Z={},V={};let re="",le="",ue={onOpenTag:function(G,U,F){if(F[" imagetype"]&&!F[" imageType"]&&(p.trigger(d.default.CONFORMANCE_VIOLATION,{level:ci.LEVELS.ERROR,event:ci.EVENTS.NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE}),F[" imageType"]=F[" imagetype"]),U==="image"&&(G==="http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt"||G==="http://www.smpte-ra.org/schemas/2052-1/2013/smpte-tt")){if(!F[" imageType"]||F[" imageType"].value!=="PNG")return void T.warn("smpte-tt imageType != PNG. Discarded");re=F["http://www.w3.org/XML/1998/namespace id"].value}},onCloseTag:function(){re&&(V[re]=le.trim()),le="",re=""},onText:function(G){re&&(le+=G)}};if(!N)throw I="no ttml data to parse",new Error(I);Z.data=N,p.trigger(u.default.TTML_TO_PARSE,Z);let be=(0,Ro.fromXML)(Z.data,(function(G){I=G}),ue);p.trigger(u.default.TTML_PARSED,{ttmlString:Z.data,ttmlDoc:be});const X=be.getMediaTimeEvents();for(J=0;J<X.length;J++){let G=(0,Ro.generateISD)(be,X[J],(function(U){I=U}));G.contents.some((U=>U.contents.length))&&(D=X[J]+C,$=X[J+1]+C,D<$&&P.push({start:D,end:$,type:"html",cueID:A(),isd:G,images:q,embeddedImages:V}))}if(I!=="")throw T.error(I),new Error(I);return P}},T=(0,c.default)(b).getInstance().getLogger(v),v}Ku.__dashjs_factory_name="TTMLParser";var bg=n.default.getSingletonFactory(Ku);function $u(b){let p=this.context;const v=(0,y.default)(p).getInstance(),T=Un(p).getInstance(),w=b.adapter,A=b.baseURLController,N="error",C="loaded",x="unloaded";let B,q,I;function P(J,Z){let V,re,le=!1;if(A.resolve()){const X=w.getVoRepresentations(J);X&&X.length>0&&(V=A.resolve(X[0].path).url)}const ue=J.essentialProperties.filter((X=>X.schemeIdUri&&X.schemeIdUri===l.default.FONT_DOWNLOAD_DVB_SCHEME)),be=J.supplementalProperties.filter((X=>X.schemeIdUri&&X.schemeIdUri===l.default.FONT_DOWNLOAD_DVB_SCHEME));ue.length>0?(le=!0,re=ue):re=be,re.forEach((X=>{if((function(F){return!(!(F.value&&parseInt(F.value)===1&&F.dvbUrl&&F.dvbUrl.length>0&&F.dvbFontFamily&&F.dvbFontFamily.length>0&&F.dvbMimeType)||F.dvbMimeType!==l.default.OFF_MIMETYPE&&F.dvbMimeType!==l.default.WOFF_MIMETYPE)})(X)){let F=(G=X.dvbUrl,U=V,T.isPathAbsolute(G)?G:T.isRelative(G)?U?T.resolve(G,U):T.resolve(G):G);I.push({fontFamily:X.dvbFontFamily,url:F,mimeType:X.dvbMimeType,trackId:J.id,streamId:Z,isEssential:le,status:x,fontFace:new FontFace(X.dvbFontFamily,`url(${F})`,{display:"swap"})})}var G,U}))}function D(J,Z){const V=I[J];I[J]={...V,status:Z}}function $(){I=[]}return B={addFontsFromTracks:function(J,Z){if(J&&Array.isArray(J)&&Z)for(let V=0;V<J.length;V++)P(J[V],Z)},downloadFonts:function(){for(let J=0;J<I.length;J++){let Z=I[J];document.fonts.add(Z.fontFace),v.trigger(d.default.DVB_FONT_DOWNLOAD_ADDED,Z),Z.fontFace.load().then((()=>{D(J,C),v.trigger(d.default.DVB_FONT_DOWNLOAD_COMPLETE,Z)}),(V=>{D(J,N),q.debug("Font download error: ",V),v.trigger(d.default.DVB_FONT_DOWNLOAD_FAILED,Z)}))}},getFonts:function(){return I},getFontsForTrackId:function(J){return I.filter((Z=>Z.trackId&&Z.trackId===J))},reset:function(){(function(){for(const J of I){let Z=document.fonts.delete(J.fontFace);q.debug(`Removal of fontFamily: ${J.fontFamily} was ${Z?"successful":"unsuccessful"}`)}})(),$()}},q=(0,c.default)(p).getInstance().getLogger(B),$(),B}$u.__dashjs_factory_name="DVBFonts";var Eg=n.default.getClassFactory($u);function Vu(b){let p=this.context;const v=b.adapter,T=b.errHandler,w=b.manifestModel,A=b.mediaController,N=b.baseURLController,C=b.videoModel,x=b.settings;let B,q,I,P,D,$,J,Z,V,re,le,ue,be,X;function G(ae){if(X.error(`Could not download ${ae.isEssential?"an essential":"a"} font - fontFamily: ${ae.fontFamily}, url: ${ae.url}`),ae.isEssential){let ie=P[ae.streamId].getTrackIdxForId(ae.trackId);P[ae.streamId].setModeForTrackIdx(ie,l.default.TEXT_DISABLED)}}function U(ae){if(X.debug(`Successfully downloaded ${ae.isEssential?"an essential":"a"} font - fontFamily: ${ae.fontFamily}, url: ${ae.url}`),ae.isEssential){let ie=P[ae.streamId].getTrackIdxForId(ae.trackId);ie===P[ae.streamId].getCurrentTrackIdx()?P[ae.streamId].setModeForTrackIdx(ie,l.default.TEXT_SHOWING):P[ae.streamId].setModeForTrackIdx(ie,l.default.TEXT_HIDDEN)}}function F(ae){let ie=ae.tracks,me=ae.index;const K=ae.streamId;if(x.get().streaming.text.defaultEnabled===!1&&!Re()||ue)Oe(K,-1);else{const ge=A.getCurrentTrackFor(l.default.TEXT,K);if(ge){const _e={lang:ge.lang,role:ge.roles[0],index:ge.index,codec:ge.codec,accessibility:ge.accessibility[0]};ie.some(((xe,Me)=>{if(A.matchSettings(_e,xe))return Oe(K,Me),me=Me,!0}))}V=!1}q[K].lastEnabledIndex=me,Z.trigger(d.default.TEXT_TRACKS_ADDED,{enabled:Re(),index:me,tracks:ie,streamId:K}),le=!0,be.addFontsFromTracks(ie,K),be.getFonts().forEach((ge=>{if(ge.isEssential){let _e=P[ge.streamId].getTrackIdxForId(ge.trackId);P[ge.streamId].setModeForTrackIdx(_e,l.default.TEXT_DISABLED)}})),be.downloadFonts()}function ve(ae){try{const ie=ae.streamId,me=P[ie];if(!me||isNaN(ae.time))return;me.updateTextTrackWindow(ae.time),x.get().streaming.text.webvtt.customRenderingEnabled&&me.manualCueProcessing(ae.time)}catch{}}function te(ae){try{const ie=ae.streamId;if(!P[ie])return;P[ie].disableManualTracks()}catch{}}function ke(ae){try{const ie=P[ae.streamId];if(!ie)return;const me=C.getTime()||0;ie.updateTextTrackWindow(me,!0)}catch(ie){X.error(ie)}}function Ee(ae){try{if(!ae||!ae.mediaType||ae.mediaType!==l.default.AUDIO||!ae.currentMediaInfo)return;const ie=P[ae.streamId].getCurrentTextTrackInfo();let me=NaN;V?me=Le(ae.streamId):Q(ie)&&ae.currentMediaInfo.lang&&ae.currentMediaInfo.lang!==ie.lang&&(me=Le(ae.streamId),isNaN(me)&&(me=-1)),isNaN(me)||Oe(ae.streamId,me)}catch(ie){X.error(ie)}}function Re(){let ae=!0;return V&&!re&&(ae=!1),ae}function Oe(ae,ie){V=ie===-1,V&&A&&A.saveTextSettingsDisabled();let me=ee(ae);if(me===ie||!P[ae])return;P[ae].disableManualTracks(),P[ae].invalidateCueWindow();let K=P[ae].getCurrentTextTrackInfo(),ge=K?C.getTextTrack(K.kind,K.id,K.lang,K.isTTML,K.isEmbedded):null;ge&&ge.mode!==l.default.TEXT_DISABLED&&P[ae].setModeForTrackIdx(me,l.default.TEXT_HIDDEN),P[ae].setCurrentTrackIdx(ie),K=P[ae].getCurrentTextTrackInfo();const _e=x.get().streaming.text.dispatchForManualRendering;if(K&&!_e&&K.mode!==l.default.TEXT_DISABLED&&P[ae].setModeForTrackIdx(ie,l.default.TEXT_SHOWING),K&&K.isFragmented&&!K.isEmbedded)(function(xe,Me,Ne){if(!I[xe])return;let Ge=I[xe].getConfig().fragmentedTracks;for(let Ze=0;Ze<Ge.length;Ze++){let ht=Ge[Ze];if(Me.lang===ht.lang&&(ht.id?Me.id===ht.id:Me.index===ht.index)){let wt=A.getCurrentTrackFor(l.default.TEXT,xe);(ht.id?wt.id!==ht.id:wt.index!==ht.index)?(P[xe].deleteCuesFromTrackIdx(Ne),I[xe].setCurrentFragmentedTrackIdx(Ze)):Ne===-1&&Z.trigger(u.default.SET_FRAGMENTED_TEXT_AFTER_DISABLED,{},{streamId:xe,mediaType:l.default.TEXT})}}})(ae,K,me);else if(K&&!K.isFragmented)(function(xe,Me){Z.trigger(u.default.SET_NON_FRAGMENTED_TEXT,{currentTrackInfo:Me},{streamId:xe,mediaType:l.default.TEXT})})(ae,K);else if(!K&&V){const xe=Le(ae);return void(isNaN(xe)||Oe(ae,xe))}A.setTrack(K)}function Le(ae){const ie=(function(ge){return P[ge].getTextTrackInfos().filter(((_e,xe)=>(_e._indexToSelect=xe,!!(_e&&_e.roles&&_e.roles.length>0)&&Q(_e))))})(ae);if(!ie||ie.length<=0)return NaN;const me=A.getCurrentTrackFor(l.default.AUDIO,ae);if(!me)return NaN;const K=ie.find((ge=>me.lang===ge.lang));return K?K._indexToSelect:NaN}function Q(ae){return!(!ae||!ae.roles||ae.roles.length===0)&&ae.roles.some((ie=>ie.schemeIdUri===l.default.DASH_ROLE_SCHEME_ID&&ie.value===Se.default.FORCED_SUBTITLE))}function ee(ae){return P[ae].getCurrentTrackIdx()}function oe(){I={},P={},q={},V=!0,le=!1,ue=!1}return B={addEmbeddedTrack:function(ae,ie){const me=ae.id;I[me]&&I[me].addEmbeddedTrack(ie)},addMediaInfosToBuffer:function(ae,ie,me,K=null){const ge=ae.id;I[ge]&&I[ge].addMediaInfos(ie,me,K)},createTracks:function(ae){const ie=ae.id;P[ie]&&P[ie].createTracks()},deactivateStream:function(ae){if(!ae)return;const ie=ae.id;I[ie]&&I[ie].resetMediaInfos(),P[ie]&&P[ie].deleteAllTextTracks()},enableForcedTextStreaming:function(ae){return(0,ct.checkParameterType)(ae,"boolean"),re=ae,!0},enableText:function(ae,ie){return(0,ct.checkParameterType)(ie,"boolean"),Re()!==ie&&(ie&&Oe(ae,q[ae].lastEnabledIndex),ie||(q[ae].lastEnabledIndex=ee(ae),le?Oe(ae,-1):ue=!0)),!0},getAllTracksAreDisabled:function(){return V},getCurrentTrackIdx:ee,getTextSourceBuffer:function(ae){const ie=ae.id;if(I&&I[ie])return I[ie]},initialize:function(){be=Eg(p).create({adapter:v,baseURLController:N}),Z.on(u.default.TEXT_TRACKS_QUEUE_INITIALIZED,F,B),Z.on(u.default.DVB_FONT_DOWNLOAD_FAILED,G,B),Z.on(u.default.DVB_FONT_DOWNLOAD_COMPLETE,U,B),Z.on(u.default.MEDIAINFO_UPDATED,Ee,B),Z.on(u.default.PLAYBACK_TIME_UPDATED,ve,B),x.get().streaming.text.webvtt.customRenderingEnabled&&Z.on(u.default.PLAYBACK_SEEKING,te,B),Z.on(u.default.PLAYBACK_SEEKED,ke,B)},initializeForStream:function(ae){const ie=ae.id,me=gg(p).create({videoModel:C,settings:x,streamInfo:ae});me.initialize(),P[ie]=me;const K=hg(p).create({errHandler:T,adapter:v,dvbFonts:be,manifestModel:w,mediaController:A,videoModel:C,textTracks:me,vttParser:D,vttCustomRenderingParser:$,ttmlParser:J,streamInfo:ae,settings:x});K.initialize(),I[ie]=K,q[ie]={},q[ie].lastEnabledIndex=-1},isTextEnabled:Re,reset:function(){Object.keys(I).forEach((ae=>{I[ae].resetEmbedded(),I[ae].reset()})),be.reset(),oe(),Z.off(u.default.TEXT_TRACKS_QUEUE_INITIALIZED,F,B),Z.off(u.default.DVB_FONT_DOWNLOAD_FAILED,G,B),Z.off(u.default.DVB_FONT_DOWNLOAD_COMPLETE,U,B),Z.off(u.default.MEDIAINFO_UPDATED,Ee,B),Z.off(u.default.PLAYBACK_TIME_UPDATED,ve,B),x.get().streaming.text.webvtt.customRenderingEnabled&&Z.off(u.default.PLAYBACK_SEEKING,te,B),Z.off(u.default.PLAYBACK_SEEKED,ke,B)},setTextTrack:Oe,clearDataForStream:function(ae){I[ae]&&(I[ae].resetEmbedded(),I[ae].reset(),delete I[ae]),P[ae]&&(P[ae].deleteAllTextTracks(),delete P[ae]),q[ae]&&delete q[ae]}},re=!1,le=!1,ue=!1,D=pg(p).getInstance(),$=yg(p).getInstance(),J=bg(p).getInstance(),Z=(0,y.default)(p).getInstance(),X=(0,c.default)(p).getInstance().getLogger(B),oe(),B}Vu.__dashjs_factory_name="TextController";var vg=n.default.getClassFactory(Vu);function Wu(b){b=b||{};const p=this.context,v=(0,c.default)(p).getInstance(),T=b.settings,w=(0,y.default)(p).getInstance();let A,N,C,x,B,q;function I(){return navigator&&navigator.connection&&!isNaN(navigator.connection.downlink)&&navigator.connection.downlink>0?1e3*navigator.connection.downlink:NaN}function P(J,Z,V,re){const le=Math.pow(.5,V/re.fast);J.fastEstimate=(1-le)*Z+le*J.fastEstimate;const ue=Math.pow(.5,V/re.slow);J.slowEstimate=(1-ue)*Z+ue*J.slowEstimate,J.totalWeight+=V}function D(){A={},N={},C={},x={}}const $={addEntry:function(J,Z){try{if(!(J&&Z&&Z.trace&&Z.trace.length))return;(function(le){A[le]=A[le]||[],N[le]=N[le]||[],C[le]=C[le]||{fastEstimate:0,slowEstimate:0,totalWeight:0},x[le]=x[le]||{fastEstimate:0,slowEstimate:0,totalWeight:0}})(J);const V=Z.tresponse.getTime()-Z.trequest.getTime()||1;let re=(function(le,ue){return le._fileLoaderType&&le._fileLoaderType===l.default.FILE_LOADER_TYPES.FETCH?(function(be){const X=be.trace.reduce(((F,ve)=>F+ve.b[0]),0),G=be.trace.reduce(((F,ve)=>F+ve.d),0);let U=NaN;return T.get().streaming.abr.throughput.useNetworkInformationApi.fetch&&(U=I()),isNaN(U)&&(U=Math.round(8*X/G)),{downloadedBytes:X,value:U,downloadTimeInMs:G}})(le):(function(be,X){let G=NaN,U=NaN,F=!1;if(T.get().streaming.abr.throughput.useResourceTimingApi&&be._resourceTimingValues)G=be._resourceTimingValues.transferSize,U=be._resourceTimingValues.responseEnd-be._resourceTimingValues.responseStart,F=!0;else{if(be.trace.length<=1)return{throughput:NaN,downloadTimeInMs:NaN};G=be.trace.reduce(((te,ke)=>te+ke.b[0]),0)-be.trace[0].b[0],U=Math.max(be.trace.reduce(((te,ke)=>te+ke.d),0)-be.trace[0].d,1)}let ve=NaN;if(!F&&T.get().streaming.abr.throughput.useNetworkInformationApi.xhr&&(ve=I()),isNaN(ve)){const te=T.get().streaming.abr.throughput.useDeadTimeLatency?U:U+X;ve=Math.round(8*G/te)}return{downloadedBytes:G,value:ve,downloadTimeInMs:U}})(le,ue)})(Z,V);if(re.latencyInMs=V,isNaN(re.value)||!isFinite(re.value))return;if(Z.cmsd){const le=Z.cmsd.dynamic&&Z.cmsd.dynamic.etp?Z.cmsd.dynamic.etp:null;if(le){const ue=T.get().streaming.cmsd.abr.etpWeightRatio;ue>0&&ue<=1&&(re.value=re.value*(1-ue)+le*ue)}}if((function(le,ue,be){return T.get().streaming.abr.throughput.useResourceTimingApi&&be._resourceTimingValues?be._resourceTimingValues.transferSize===0&&be._resourceTimingValues.decodedBodySize>0:!isNaN(ue)&&(le===l.default.VIDEO?ue<T.get().streaming.cacheLoadThresholds[l.default.VIDEO]:le===l.default.AUDIO?ue<T.get().streaming.cacheLoadThresholds[l.default.AUDIO]:void 0)})(J,Z._tfinish.getTime()-Z.trequest.getTime(),Z))return void q.debug(`${J} Assuming segment ${Z.url} came from cache, ignoring it for throughput calculation`);q.debug(`Added throughput entry for ${J}: ${re.value} kbit/s`),re.serviceLocation=Z._serviceLocation,A[J].push(re),N[J].push({value:V}),(function(le){A[le].length>T.get().streaming.abr.throughput.sampleSettings.maxMeasurementsToKeep&&A[le].shift(),N[le].length>T.get().streaming.abr.throughput.sampleSettings.maxMeasurementsToKeep&&N[le].shift()})(J),w.trigger(d.default.THROUGHPUT_MEASUREMENT_STORED,{throughputValues:re}),Z.type!==ye.HTTPRequest.MPD_TYPE&&(P(C[J],re.value,T.get().streaming.abr.throughput.ewma.weightDownloadTimeMultiplicationFactor*re.downloadTimeInMs,B.bandwidthHalfLife),P(x[J],V,1,B.latencyHalfLife))}catch(V){q.error(V)}},getThroughputDict:function(J){return J?A[J]:A},getEwmaThroughputDict:function(J){return J?C[J]:C},getEwmaLatencyDict:function(J){return J?x[J]:x},getEwmaHalfLife:function(){return B},getLatencyDict:function(J){return J?N[J]:N},reset:D};return q=v.getLogger($),B={bandwidthHalfLife:{fast:T.get().streaming.abr.throughput.ewma.throughputFastHalfLifeSeconds,slow:T.get().streaming.abr.throughput.ewma.throughputSlowHalfLifeSeconds},latencyHalfLife:{fast:T.get().streaming.abr.throughput.ewma.latencyFastHalfLifeCount,slow:T.get().streaming.abr.throughput.ewma.latencySlowHalfLifeCount}},D(),$}Wu.__dashjs_factory_name="ThroughputModel";var Tg=n.default.getClassFactory(Wu);function Qu(){const b=this.context,p=(0,y.default)(b).getInstance();let v,T,w;function A(){performance.clearResourceTimings()}function N(le){le.metric!==i.HTTP_REQUEST||!le.value||le.value.type!==ye.HTTPRequest.MPD_TYPE&&(le.value.type!==ye.HTTPRequest.MEDIA_SEGMENT_TYPE||le.mediaType!==l.default.AUDIO&&le.mediaType!==l.default.VIDEO)||v.addEntry(le.mediaType,le.value)}function C(le,ue,be=null,X=NaN){let G,U=null,F=v.getEwmaHalfLife(),ve=null,te=!0;switch(be||(be=w.get().streaming.abr.throughput.averageCalculationMode),le){case l.default.THROUGHPUT_TYPES.BANDWIDTH:U=be===l.default.THROUGHPUT_CALCULATION_MODES.EWMA?v.getEwmaThroughputDict(ue):v.getThroughputDict(ue),ve=F.bandwidthHalfLife,te=!0,X=isNaN(X)?T.getIsDynamic()?w.get().streaming.abr.throughput.sampleSettings.live:w.get().streaming.abr.throughput.sampleSettings.vod:X;break;case l.default.THROUGHPUT_TYPES.LATENCY:U=be===l.default.THROUGHPUT_CALCULATION_MODES.EWMA?v.getEwmaLatencyDict(ue):v.getLatencyDict(ue),ve=F.latencyHalfLife,te=!1,X=isNaN(X)?w.get().streaming.abr.throughput.sampleSettings.averageLatencySampleAmount:X}if(!U||U.length===0)return NaN;switch(be){case l.default.THROUGHPUT_CALCULATION_MODES.ARITHMETIC_MEAN:return G=x(U,X,le),B(U,G);case l.default.THROUGHPUT_CALCULATION_MODES.BYTE_SIZE_WEIGHTED_ARITHMETIC_MEAN:return G=x(U,X,le),q(U,G);case l.default.THROUGHPUT_CALCULATION_MODES.DATE_WEIGHTED_ARITHMETIC_MEAN:return G=x(U,X,le),I(U,G);case l.default.THROUGHPUT_CALCULATION_MODES.HARMONIC_MEAN:return G=x(U,X,le),P(U,G);case l.default.THROUGHPUT_CALCULATION_MODES.BYTE_SIZE_WEIGHTED_HARMONIC_MEAN:return G=x(U,X,le),D(U,G);case l.default.THROUGHPUT_CALCULATION_MODES.DATE_WEIGHTED_HARMONIC_MEAN:return G=x(U,X,le),$(U,G);case l.default.THROUGHPUT_CALCULATION_MODES.EWMA:return J(U,ve,te);case l.default.THROUGHPUT_CALCULATION_MODES.ZLEMA:return G=x(U,X,le),Z(U,G)}}function x(le,ue,be){if(le){if(ue>=le.length)ue=le.length;else if(be===l.default.THROUGHPUT_TYPES.BANDWIDTH&&w.get().streaming.abr.throughput.sampleSettings.enableSampleSizeAdjustment)for(let X=1;X<ue;++X){const G=le[le.length-X].value/le[le.length-X-1].value;if((G>=w.get().streaming.abr.throughput.sampleSettings.increaseScale||G<=w.get().streaming.abr.throughput.sampleSettings.decreaseScale)&&(ue+=1)===le.length)break}}else ue=0;return ue}function B(le,ue){let be=le;return ue!==0&&be&&be.length!==0?(be=be.slice(-ue),be.reduce(((X,G)=>X+G.value),0)/be.length):NaN}function q(le,ue){let be=le;if(ue===0||!be||be.length===0)return NaN;be=be.slice(-ue);let X=0;return be.reduce(((G,U)=>{let F=Math.sqrt(U.downloadedBytes);return X+=F,G+U.value*F}),0)/X}function I(le,ue){let be=le;if(ue===0||!be||be.length===0)return NaN;be=be.slice(-ue);let X=0;return be.reduce(((G,U,F)=>{let ve=F+1;return X+=ve,G+U.value*ve}),0)/X}function P(le,ue){let be=le;if(ue===0||!be||be.length===0)return NaN;be=be.slice(-ue);const X=be.reduce(((G,U)=>G+1/U.value),0);return be.length/X}function D(le,ue){let be=le;if(ue===0||!be||be.length===0)return NaN;be=be.slice(-ue);let X=0;const G=be.reduce(((U,F)=>{let ve=Math.sqrt(F.downloadedBytes);return X+=ve,U+1/F.value*ve}),0);return X/G}function $(le,ue){let be=le;if(ue===0||!be||be.length===0)return NaN;be=be.slice(-ue);let X=0;const G=be.reduce(((U,F,ve)=>{let te=ve+1;return X+=te,U+1/F.value*te}),0);return X/G}function J(le,ue,be=!0){if(!le||le.totalWeight<=0)return NaN;const X=le.fastEstimate/(1-Math.pow(.5,le.totalWeight/ue.fast)),G=le.slowEstimate/(1-Math.pow(.5,le.totalWeight/ue.slow));return be?Math.min(X,G):Math.max(X,G)}function Z(le,ue){if(ue===0||!le||le.length===0)return NaN;let be=le.slice(-ue).map((F=>F.value)),X=2/(be.length+1),G=be[be.length-1],U=be[be.length-1];for(let F=0;F<be.length;F++)G=X*be[F]+(1-X)*G,U=X*G+(1-X)*U;return U}function V(le,ue=null,be=NaN){const X=C(l.default.THROUGHPUT_TYPES.BANDWIDTH,le,ue,be);return Math.round(X)}const re={getArithmeticMean:B,getAverageLatency:function(le,ue=null,be=NaN){const X=C(l.default.THROUGHPUT_TYPES.LATENCY,le,ue,be);return Math.round(X)},getAverageThroughput:V,getByteSizeWeightedArithmeticMean:q,getByteSizeWeightedHarmonicMean:D,getDateWeightedArithmeticMean:I,getDateWeightedHarmonicMean:$,getEwma:J,getHarmonicMean:P,getRawThroughputData:function(le){return le?v.getThroughputDict(le):[]},getSafeAverageThroughput:function(le,ue=null,be=NaN){let X=V(le,ue,be);return isNaN(X)||(X*=w.get().streaming.abr.throughput.bandwidthSafetyFactor),X},getZlema:Z,initialize:function(){v=Tg(b).create({settings:w}),p.on(d.default.METRIC_ADDED,N,re),window.performance?.addEventListener?.("resourcetimingbufferfull",A)},reset:function(){v.reset(),p.off(d.default.METRIC_ADDED,N,re),window.performance?.removeEventListener?.("resourcetimingbufferfull",A)},setConfig:function(le){le.settings&&(w=le.settings),le.playbackController&&(T=le.playbackController)}};return re}Qu.__dashjs_factory_name="ThroughputController";var wg=n.default.getSingletonFactory(Qu);function Xu(){const b=this.context,p=(0,y.default)(b).getInstance(),v=(0,h.default)(b).getInstance();let T,w,A,N;function C(V){N=V}function x(V,re,le,ue){let be,X=re.adaptation.period.mpd;const G=X.availabilityStartTime;if(ue)be=le&&X.timeShiftBufferDepth!==Number.POSITIVE_INFINITY?new Date(G.getTime()+1e3*(V+X.timeShiftBufferDepth)):X.availabilityEndTime;else if(le){const U=re.availabilityTimeOffset;be=new Date(G.getTime()+1e3*(V-U))}else be=G;return be}function B(V,re){return(V.getTime()-re.mpd.availabilityStartTime.getTime()+1e3*N)/1e3}function q(V,re){return V+(re.adaptation.period.start-re.presentationTimeOffset)}function I(V){const re={start:NaN,end:NaN},le=V[0].getAdapter().getRegularPeriods()[0],ue=B(new Date,le);if(!V||V.length===0)return{range:re,now:ue};V.forEach((X=>{let G=X.getCurrentRepresentationForType(l.default.VIDEO);if(G||(G=X.getCurrentRepresentationForType(l.default.AUDIO)),!G){const F=X.getAdapter(),ve=F.getMediaInfoForType(X.getStreamInfo(),l.default.VIDEO)||F.getMediaInfoForType(X.getStreamInfo(),l.default.AUDIO);G=F.getVoRepresentations(ve)[0]}let U={start:NaN,end:NaN};if(G)if(G.segmentInfoType===Se.default.SEGMENT_TIMELINE)U=(function(F){const ve=F.adaptation.period.mpd.manifest.Period[F.adaptation.period.index].AdaptationSet[F.adaptation.index],te=w.getRepresentationFor(F.index,ve),ke=te.SegmentTemplate||te.SegmentList,Ee=ke.SegmentTimeline,Re=ke.timescale,Oe=Ee.S,Le={start:0,end:0},Q=Oe[0].t,ee=!isNaN(Q),oe=ee?Q:0;let ae,ie,me,K,ge=0;for(ee&&(Le.start=q(oe/Re,F)),me=0,K=Oe.length;me<K;me++)ae=Oe[me],ie=0,ae.hasOwnProperty("r")&&(ie=ae.r),ge+=ae.d*(1+ie);return Le.end=q((oe+ge)/Re,F),Le})(G);else{const F=G.adaptation.period;U.start=F.start,U.end=Math.max(ue,F.start+F.duration)}!isNaN(U.start)&&(isNaN(re.start)||re.start>U.start)&&(re.start=U.start),!isNaN(U.end)&&(isNaN(re.end)||re.end<U.end)&&(re.end=U.end)})),re.end=Math.min(ue,re.end);const be=D(V,re.end,!0);return re.end=isNaN(be)?re.end:be,re.start=le&&le.mpd&&le.mpd.timeShiftBufferDepth&&!isNaN(le.mpd.timeShiftBufferDepth)&&!isNaN(re.end)?Math.max(re.end-le.mpd.timeShiftBufferDepth,re.start):re.start,re.start=D(V,re.start),{range:re,now:ue}}function P(V,re){A=V-re.end}function D(V,re,le=!1){try{let ue=0,be=!1,X=NaN;for(;!be&&ue<V.length;){const G=V[ue].getStreamInfo();G.start<=re&&(!isFinite(G.duration)||G.start+G.duration>=re)?(X=re,be=!0):!le&&G.start>re&&(isNaN(X)||G.start<X)?X=G.start:le&&G.start+G.duration<re&&(isNaN(X)||G.start+G.duration>X)&&(X=G.start+G.duration),ue+=1}return X}catch{return re}}function $(V){V.offset===void 0||isNaN(V.offset)||C(V.offset/1e3)}function J(){N=0,A=0}function Z(){p.off(u.default.UPDATE_TIME_SYNC_OFFSET,$,this),J()}return T={calcAvailabilityEndTimeFromPresentationTime:function(V,re,le){return x(V,re,le,!0)},calcAvailabilityStartTimeFromPresentationTime:function(V,re,le){return x(V,re,le)},calcMediaTimeFromPresentationTime:function(V,re){return V-re.adaptation.period.start+re.presentationTimeOffset},calcPeriodRelativeTimeFromMpdRelativeTime:function(V,re){return re-V.adaptation.period.start},calcPresentationTimeFromMediaTime:q,calcPresentationTimeFromWallTime:B,calcTimeShiftBufferWindow:function(V,re){if(!re)return(function(le){const ue={start:NaN,end:NaN};let be=0,X=NaN;return le.forEach((G=>{const U=G.getStreamInfo();be+=U.duration,(isNaN(X)||U.start<X)&&(X=U.start)})),ue.start=X,ue.end=X+be,ue})(V);if(v.get().streaming.timeShiftBuffer.calcFromSegmentTimeline){const le=I(V);return P(le.now,le.range),le.range}return(function(le){const ue={start:NaN,end:NaN};if(!le||le.length===0)return ue;const be=le[0].getAdapter().getRegularPeriods()[0],X=B(new Date,be),G=be.mpd.timeShiftBufferDepth,U=isNaN(G)?0:X-G;if(ue.start=D(le,U),ue.end=!isNaN(ue.start)&&X<ue.start?X:D(le,X,!0),!isNaN(G)&&ue.end<X-G&&(ue.end=NaN),v.get().streaming.timeShiftBuffer.fallbackToSegmentTimeline){const F=I(le);if(F.range.end<ue.start)return p.trigger(d.default.CONFORMANCE_VIOLATION,{level:ci.LEVELS.WARNING,event:ci.EVENTS.INVALID_DVR_WINDOW}),P(F.now,F.range),F.range}return ue})(V)},calcWallTimeForSegment:function(V,re){let le,ue,be;return re&&(le=V.representation.adaptation.period.mpd.suggestedPresentationDelay,ue=V.presentationStartTime+le,be=new Date(V.availabilityStartTime.getTime()+1e3*ue)),be},getClientReferenceTime:function(){return Date.now()-1e3*A+1e3*N},getClientTimeOffset:function(){return N},initialize:function(){J(),p.on(u.default.UPDATE_TIME_SYNC_OFFSET,$,this)},reset:Z,setClientTimeOffset:C,setConfig:function(V){V&&V.dashManifestModel&&(w=V.dashManifestModel)}},w=xn(b).getInstance(),Z(),T}Xu.__dashjs_factory_name="TimelineConverter";var _g=n.default.getSingletonFactory(Xu),Ag=class{constructor(){this.t=null,this.xywh=null,this.track=null,this.id=null,this.s=null,this.r=null}};function Ju(){let b,p;return b={initialize:function(v){if(p=new Ag,!v)return null;const T=v.indexOf("#");if(T!==-1){const w=v.substr(T+1).split("&");for(let A=0,N=w.length;A<N;++A){const C=w[A],x=C.indexOf("=");if(x!==-1){const B=C.substring(0,x);p.hasOwnProperty(B)&&(p[B]=C.substr(x+1))}}}},getURIFragmentData:function(){return p}},b}Ju.__dashjs_factory_name="URIFragmentModel";var Sg=n.default.getSingletonFactory(Ju);const kg=new Map([[l.default.VIDEO_ELEMENT_READY_STATES.HAVE_METADATA,"loadedmetadata"],[l.default.VIDEO_ELEMENT_READY_STATES.HAVE_CURRENT_DATA,"loadeddata"],[l.default.VIDEO_ELEMENT_READY_STATES.HAVE_FUTURE_DATA,"canplay"],[l.default.VIDEO_ELEMENT_READY_STATES.HAVE_ENOUGH_DATA,"canplaythrough"]]);function Zu(){let b,p,v,T,w,A,N,C,x,B,q,I;const P=this.context,D=(0,y.default)(P).getInstance(),$=[];function J(te,ke=!1){v&&(ke?v.playbackRate=te:ve(l.default.VIDEO_ELEMENT_READY_STATES.HAVE_FUTURE_DATA,(()=>{v.playbackRate=te})))}function Z(){return $.length>0}function V(te){let ke=$.indexOf(te);if(te!==null&&(ke!==-1&&$.splice(ke,1),B.get().streaming.buffer.syntheticStallEvents.enabled&&v&&!Z())){const Ee=()=>{if(J(A||1,B.get().streaming.buffer.syntheticStallEvents.ignoreReadyState),!v.paused){const Re=document.createEvent("Event");Re.initEvent("playing",!0,!1),v.dispatchEvent(Re)}};B.get().streaming.buffer.syntheticStallEvents.ignoreReadyState?Ee():(C&&C.func&&C.event&&ue(C.event,C.func),C=ve(l.default.VIDEO_ELEMENT_READY_STATES.HAVE_FUTURE_DATA,Ee))}}function re(){if(v&&Z()&&v.playbackRate===0){const te=document.createEvent("Event");te.initEvent("waiting",!0,!1),v.dispatchEvent(te)}}function le(te,ke){v&&v.addEventListener(te,ke)}function ue(te,ke){v&&v.removeEventListener(te,ke)}function be(){return v?v.readyState:NaN}function X(){return v?v.buffered:null}function G(){return v?v.clientWidth:NaN}function U(){return v?v.clientHeight:NaN}function F(te,ke,Ee,Re,Oe){if(v){for(let Le=0;Le<v.textTracks.length;Le++)if(v.textTracks[Le].kind===te&&(!ke||v.textTracks[Le].label==ke)&&v.textTracks[Le].language===Ee&&v.textTracks[Le].isTTML===Re&&v.textTracks[Le].isEmbedded===Oe)return v.textTracks[Le]}return null}function ve(te,ke){return te===l.default.VIDEO_ELEMENT_READY_STATES.HAVE_NOTHING||be()>=te?(ke(),null):(function(Ee,Re){const Oe=()=>{ue(Ee,Oe),Re(Ee)};return le(Ee,Oe),{func:Oe,event:Ee}})(kg.get(te),ke)}return T={addEventListener:le,addTextTrack:function(te,ke,Ee,Re,Oe){if(!v)return null;let Le=F(te,ke,Ee,Re,Oe);return Le||(Le=v.addTextTrack(te,ke,Ee),Le.isEmbedded=Oe,Le.isTTML=Re),Le},appendChild:function(te){v&&(v.appendChild(te),te.isTTML!==void 0&&(v.textTracks[v.textTracks.length-1].isTTML=te.isTTML,v.textTracks[v.textTracks.length-1].isEmbedded=te.isEmbedded))},getBufferRange:X,getClientHeight:U,getClientWidth:G,getElement:function(){return v},getEnded:function(){return v?v.ended:null},getPlaybackQuality:function(){if(!v)return null;let te="webkitDroppedFrameCount"in v&&"webkitDecodedFrameCount"in v,ke=null;return"getVideoPlaybackQuality"in v?ke=v.getVideoPlaybackQuality():te&&(ke={droppedVideoFrames:v.webkitDroppedFrameCount,totalVideoFrames:v.webkitDroppedFrameCount+v.webkitDecodedFrameCount,creationTime:new Date}),ke},getPlaybackRate:function(){return v?v.playbackRate:null},getPlayedRanges:function(){return v?v.played:null},getReadyState:be,getSource:function(){return v?v.src:null},getTTMLRenderingDiv:function(){return b},getTextTrack:F,getTextTracks:function(){return v?v.textTracks:[]},getTime:function(){return v?isNaN(p)?v.currentTime:p:null},getVideoElementSize:function(){const te=B.get().streaming.abr.usePixelRatioInLimitBitrateByPortal&&window.hasOwnProperty("devicePixelRatio")?window.devicePixelRatio:1;return{elementWidth:G()*te,elementHeight:U()*te}},getVideoHeight:function(){return v?v.videoHeight:NaN},getVideoRelativeOffsetLeft:function(){if(v){const te=v.parentNode.host||v.parentNode;return te?v.getBoundingClientRect().left-te.getBoundingClientRect().left:NaN}return NaN},getVideoRelativeOffsetTop:function(){if(v){const te=v.parentNode.host||v.parentNode;return te?v.getBoundingClientRect().top-te.getBoundingClientRect().top:NaN}return NaN},getVideoWidth:function(){return v?v.videoWidth:NaN},getVttRenderingDiv:function(){return I},initialize:function(){D.on(u.default.PLAYBACK_PLAYING,re,this)},isPaused:function(){return v?v.paused:null},isSeeking:function(){return v?v.seeking||!isNaN(p):null},isStalled:Z,pause:function(){v&&(v.pause(),v.autoplay=!1)},play:function(){if(v){v.autoplay=!0;const te=v.play();te&&te.catch&&typeof Promise<"u"&&te.catch((ke=>{ke.name==="NotAllowedError"&&D.trigger(u.default.PLAYBACK_NOT_ALLOWED),w.warn(`Caught pending play exception - continuing (${ke})`)}))}},removeChild:function(te){v&&v.removeChild(te)},removeEventListener:ue,reset:function(){clearTimeout(q),D.off(u.default.PLAYBACK_PLAYING,re,this),$.length=0,(function(){try{N&&v&&(N.unobserve(v),N.disconnect(),N=null)}catch{}})()},setConfig:function(te){te&&te.settings&&(B=te.settings)},setCurrentTime:function(te,ke){v&&(x&&x.func&&x.event&&ue(x.event,x.func),p=te,x=ve(l.default.VIDEO_ELEMENT_READY_STATES.HAVE_METADATA,(()=>{if(v)if(v.currentTime!==p)try{p=ke?(function(Ee){const Re=X();let Oe=Ee,Le=9999999999;if(Re)for(let Q=0;Q<Re.length;Q++){const ee=Re.start(Q),oe=Re.end(Q),ae=Math.abs(ee-Ee),ie=Math.abs(oe-Ee);if(Ee>=ee&&Ee<=oe)return Ee;ae<Le&&(Le=ae,Oe=ee),ie<Le&&(Le=ie,Oe=oe)}return Oe})(p):p,isNaN(p)||(v.currentTime=p),p=NaN}catch(Ee){v.readyState===0&&Ee.code===Ee.INVALID_STATE_ERR&&(q=setTimeout((function(){v.currentTime=p,p=NaN}),400))}else p=NaN})))},setDisableRemotePlayback:function(te){v&&(v.disableRemotePlayback=te)},setElement:function(te){if(!(te==null||te&&/^(VIDEO|AUDIO)$/i.test(te.nodeName)))throw"element is not video or audio DOM type!";v=te,(function(ke){try{if(!N||!ke)return;N.observe(ke)}catch{}})(v)},setPlaybackRate:J,setSource:function(te){v&&(te?v.src=te:(v.removeAttribute("src"),v.load()))},setStallState:function(te,ke){(function(Ee,Re){Re?(function(Oe){if(Oe!==null&&v&&!v.seeking&&$.indexOf(Oe)===-1&&($.push(Oe),B.get().streaming.buffer.syntheticStallEvents.enabled&&v&&$.length===1&&(B.get().streaming.buffer.syntheticStallEvents.ignoreReadyState||be()>=l.default.VIDEO_ELEMENT_READY_STATES.HAVE_FUTURE_DATA))){A=v.playbackRate,J(0,!0);const Le=document.createEvent("Event");Le.initEvent("waiting",!0,!1),v.dispatchEvent(Le)}})(Ee):V(Ee)})(te,ke)},setTTMLRenderingDiv:function(te){b=te,b.style.position="absolute",b.style.display="flex",b.style.overflow="hidden",b.style.pointerEvents="none",b.style.top=0,b.style.left=0},setVttRenderingDiv:function(te){I=te},waitForReadyState:ve},w=(0,c.default)(P).getInstance().getLogger(T),B=(0,h.default)(P).getInstance(),p=NaN,(function(){try{N=new ResizeObserver((()=>{D.trigger(u.default.VIDEO_ELEMENT_RESIZED)}))}catch{}})(),T}Zu.__dashjs_factory_name="VideoModel";var Ig=n.default.getSingletonFactory(Zu),Rg=t(8986);function xo(){const b="You must first call initialize() and set a source before calling this method",p="You must first call initialize() and set a valid source and view before calling this method",v="You must first call attachView() to set the video element before calling this method",T="You must first call attachSource() with a valid source before calling this method",w="MediaPlayer not initialized!",A=this.context,N=(0,y.default)(A).getInstance();let C=(0,h.default)(A).getInstance();const x=(0,c.default)(A).getInstance({settings:C});let B,q,I,P,D,$,J,Z,V,re,le,ue,be,X,G,U,F,ve,te,ke,Ee,Re,Oe,Le,Q,ee,oe,ae,ie,me,K,ge,_e,xe,Me,Ne,Ge,Ze,ht,wt,Wt;function At(){_t(null),gn(null),P=null,G&&(G.reset(),G=null),U&&(U.reset(),U=null),Ee&&Ee.reset(),C.reset(),ve&&(ve.reset(),ve=null)}function Vt(){return!!I&&!!Ge.getElement()}function on(){return(0,Rg.getVersionString)()}function kn(){if(!J)throw p;return ie.isPaused()}function vn(){if(!J)throw p;return ie.getIsDynamic()}function cn(Ce){const rt=ee&&ee.hasVideoTrack()?l.default.VIDEO:l.default.AUDIO;let Pt=_e.getCurrentDVRInfo(rt);return Pt?pn(Pt.range.start+Ce,Pt):0}function pn(Ce,rt){let Pt=ie.getOriginalLiveDelay();return Ce>rt.range.end-Pt&&(Ce=rt.range.end-Pt),Ce}function We(Ce=""){if(!J)throw p;let rt=Kt().currentTime;return Ce!==""&&(rt=ee.getTimeRelativeToStreamId(rt,Ce)),rt}function pt(Ce){(0,ct.checkParameterType)(Ce,"boolean"),Z=Ce}function gt(){Ee.restoreDefaultUTCTimingSources()}function St(){return _e}function Kt(){if(!Ge.getElement())throw v;return Ge.getElement()}function gn(Ce){if(!D)throw w;Ge.setElement(Ce),Ce&&(Je(),(function(){if(U||typeof dashjs>"u")return;let rt=dashjs.MetricsReporting;typeof rt=="function"&&(U=rt(A).create().createMetricsReporting({debug:x,eventBus:N,mediaElement:Kt(),adapter:te,dashMetrics:_e,mediaPlayerModel:ke,events:u.default,constants:l.default,metricsConstants:i}))})(),(function(){if(F||typeof dashjs>"u")return;let rt=dashjs.MssHandler;typeof rt=="function"&&(Yt.extend(rt.errors),F=rt(A).create({eventBus:N,mediaPlayerModel:ke,dashMetrics:_e,manifestModel:xe,playbackController:ie,streamController:ee,protectionController:G,baseURLController:Oe,errHandler:Re,events:u.default,constants:l.default,debug:x,initSegmentType:ye.HTTPRequest.INIT_SEGMENT_TYPE,BASE64:lt,ISOBoxer:ki,settings:C}))})(),ee&&ee.switchToVideoElement(V)),J&&(je(),Qe()),Lt(V)}function ot(Ce){if(!$)throw b;let rt=ee.getActiveStreamInfo();return rt?X.getTracksFor(Ce,rt.id).filter((Pt=>!G||G.areKeyIdsUsable(Pt.normalizedKeyIds))):[]}function _t(Ce,rt=NaN){if(!D)throw w;typeof Ce=="string"&&Ze.initialize(Ce),rt==null&&(rt=NaN),isNaN(rt)||(rt=Math.max(0,rt)),V=rt,I=Ce,($||J)&&(je(),Qe()),Vt()&&Lt(V)}function Ut(){if(!$)throw b;let Ce=ee.getActiveStreamInfo();return Ce?ee.getStreamById(Ce.id):null}function je(){J=!1,$=!1,te.reset(),ee.reset(),ae.reset(),ge.reset(),ie.reset(),me.reset(),K.reset(),re.reset(),le.reset(),X.reset(),wt.reset(),G&&(C.get().streaming.protection.keepProtectionMediaKeys?G.stop():(G.reset(),G=null,Je())),oe.reset(),Me.reset(),Ne.reset()}function Qe(){Ee.resetPlaybackSessionSpecificSettings()}function bt(){return dm(A).create({debug:x,errHandler:Re,dashMetrics:_e,mediaPlayerModel:ke,mssHandler:F,settings:C})}function Je(){if(G)return G;if(typeof dashjs>"u")return null;let Ce=dashjs.Protection;if(typeof Ce=="function"){let rt=Ce(A).create();return u.default.extend(Ce.events),d.default.extend(Ce.events,{publicOnly:!0}),Yt.extend(Ce.errors),G=rt.createProtectionSystem({debug:x,errHandler:Re,videoModel:Ge,customParametersModel:Ee,capabilities:Le,eventBus:N,events:u.default,BASE64:lt,constants:l.default,cmcdModel:Me,settings:C}),Le||(Le=(0,oc.default)(A).getInstance()),Le.setProtectionController(G),G}return null}function Rt(){if(!D)throw w;if(ve)return ve;if(typeof dashjs>"u")return null;let Ce=dashjs.OfflineController;if(typeof Ce=="function"){u.default.extend(Ce.events),d.default.extend(Ce.events,{publicOnly:!0}),Yt.extend(Ce.errors);const rt=bt(),Pt=Fc(A).create();return Pt.setConfig({manifestModel:xe,adapter:te,manifestLoader:rt,errHandler:Re,contentSteeringController:K}),ve=Ce(A).create({debug:x,manifestUpdater:Pt,baseURLController:Oe,manifestLoader:rt,manifestModel:xe,mediaPlayerModel:ke,abrController:re,playbackController:ie,adapter:te,errHandler:Re,dashMetrics:_e,timelineConverter:be,segmentBaseController:wt,schemeLoaderFactory:ue,eventBus:N,events:u.default,errors:Yt,constants:l.default,settings:C,dashConstants:Se.default,urlUtils:Un(A).getInstance()}),ve}return null}function Lt(Ce=NaN){ve&&ve.resetRecords(),!$&&I&&($=!0,q.info("Streaming Initialized"),(function(){const rt=bt();ee||(ee=Du(A).getInstance()),oe||(oe=vg(A).create({errHandler:Re,manifestModel:xe,adapter:te,mediaController:X,baseURLController:Oe,videoModel:Ge,settings:C})),Q.setConfig({capabilities:Le,customParametersModel:Ee,adapter:te,settings:C,protectionController:G,manifestModel:xe,errHandler:Re}),ee.setConfig({capabilities:Le,capabilitiesFilter:Q,manifestLoader:rt,manifestModel:xe,mediaPlayerModel:ke,customParametersModel:Ee,protectionController:G,textController:oe,adapter:te,dashMetrics:_e,errHandler:Re,timelineConverter:be,videoModel:Ge,playbackController:ie,serviceDescriptionController:me,contentSteeringController:K,abrController:re,throughputController:le,mediaController:X,settings:C,baseURLController:Oe,uriFragmentModel:Ze,segmentBaseController:wt}),ae.setConfig({settings:C,playbackController:ie,streamController:ee,videoModel:Ge,timelineConverter:be,adapter:te}),ie.setConfig({streamController:ee,serviceDescriptionController:me,dashMetrics:_e,adapter:te,videoModel:Ge,timelineConverter:be,settings:C}),ge.setConfig({streamController:ee,playbackController:ie,mediaPlayerModel:ke,videoModel:Ge,settings:C}),le.setConfig({settings:C,playbackController:ie}),re.setConfig({streamController:ee,capabilities:Le,domStorage:ht,mediaPlayerModel:ke,customParametersModel:Ee,throughputController:le,cmsdModel:Ne,dashMetrics:_e,adapter:te,videoModel:Ge,settings:C}),Me.setConfig({abrController:re,dashMetrics:_e,playbackController:ie,serviceDescriptionController:me,throughputController:le}),Wt.setConfig({serviceDescriptionController:me}),Ne.setConfig({}),X.initialize(),le.initialize(),re.initialize(),ee.initialize(Z,P),oe.initialize(),ae.initialize(),ge.initialize(),Me.initialize(Z),Ne.initialize(),K.initialize(),wt.initialize()})(),typeof I=="string"?ee.load(I,Ce):ee.loadWithManifest(I,Ce)),!J&&Vt()&&(J=!0,N.trigger(d.default.PLAYBACK_INITIALIZED),q.info("Playback Initialized"))}return B={addABRCustomRule:function(Ce,rt,Pt){Ee.addAbrCustomRule(Ce,rt,Pt)},addExternalSubtitle:function(Ce){Ce instanceof Wh.default||q.error("Invalid external subtitle object. Must be an instance of dashjs.ExternalSubtitle"),Ee.addExternalSubtitle(Ce)},addRequestInterceptor:function(Ce){Ee.addRequestInterceptor(Ce)},addResponseInterceptor:function(Ce){Ee.addResponseInterceptor(Ce)},addUTCTimingSource:function(Ce,rt){Ee.addUTCTimingSource(Ce,rt)},attachProtectionController:function(Ce){G=Ce},attachSource:_t,attachTTMLRenderingDiv:function(Ce){if(!Ge.getElement())throw v;Ge.setTTMLRenderingDiv(Ce)},attachView:gn,attachVttRenderingDiv:function(Ce){if(!Ge.getElement())throw v;Ge.setVttRenderingDiv(Ce)},clearDefaultUTCTimingSources:function(){Ee.clearDefaultUTCTimingSources()},convertToTimeCode:function(Ce){Ce=Math.max(Ce,0);let rt=Math.floor(Ce/3600),Pt=Math.floor(Ce%3600/60),zt=Math.floor(Ce%3600%60);return(rt===0?"":rt<10?"0"+rt.toString()+":":rt.toString()+":")+(Pt<10?"0"+Pt.toString():Pt.toString())+":"+(zt<10?"0"+zt.toString():zt.toString())},destroy:function(){At(),n.default.deleteSingletonInstances(A)},duration:function(){if(!J)throw p;let Ce=Kt().duration;if(ie.getIsDynamic()){const rt=ee&&ee.hasVideoTrack()?l.default.VIDEO:l.default.AUDIO;let Pt=_e.getCurrentDVRInfo(rt);Ce=Pt?Pt.range.end-Pt.range.start:0}return Ce},enableForcedTextStreaming:function(Ce){return!(!ee.getActiveStreamInfo()||!oe)&&oe.enableForcedTextStreaming(Ce)},enableText:function(Ce){const rt=ee.getActiveStreamInfo();return!(!rt||!oe)&&oe.enableText(rt.id,Ce)},extend:function(Ce,rt,Pt){n.default.extend(Ce,rt,Pt,A)},formatUTC:function(Ce,rt,Pt,zt=!1){const yn=new Date(1e3*Ce),ut=yn.toLocaleDateString(rt),Ht=yn.toLocaleTimeString(rt,{hour12:Pt});return zt?Ht+" "+ut:Ht},getABRCustomRules:function(){return Ee.getAbrCustomRules()},getActiveStream:Ut,getAutoPlay:function(){return Z},getAvailableBaseUrls:function(){const Ce=xe.getValue();return Ce?Oe.getBaseUrls(Ce):[]},getAvailableLocations:function(){const Ce=xe.getValue();if(!Ce)return[];const rt=te.getLocation(Ce),Pt=K.getSynthesizedLocationElements(rt);return rt.concat(Pt)},getAverageLatency:function(Ce=l.default.VIDEO,rt=null,Pt=NaN){return le?le.getAverageLatency(Ce,rt,Pt):0},getAverageThroughput:function(Ce=l.default.VIDEO,rt=null,Pt=NaN){return le?le.getAverageThroughput(Ce,rt,Pt):0},getBufferLength:function(Ce){const rt=[l.default.VIDEO,l.default.AUDIO,l.default.TEXT];if(Ce)return rt.indexOf(Ce)!==-1?St().getCurrentBufferLevel(Ce)||NaN:(q.warn("getBufferLength requested for invalid type"),NaN);{const Pt=rt.map((zt=>ot(zt).length>0?St().getCurrentBufferLevel(zt):Number.MAX_VALUE)).reduce(((zt,yn)=>Math.min(zt,yn)));return Pt===Number.MAX_VALUE?NaN:Pt}},getCurrentLiveLatency:function(){if(!D)throw w;return J?ie.getCurrentLiveLatency():NaN},getCurrentRepresentationForType:function(Ce){if(!$)throw b;if(Ce!==l.default.IMAGE&&Ce!==l.default.VIDEO&&Ce!==l.default.AUDIO)return null;const rt=Ut();if(!rt)return null;if(Ce===l.default.IMAGE){const Pt=rt.getThumbnailController();return Pt?Pt.getCurrentTrack():-1}return rt.getCurrentRepresentationForType(Ce)},getCurrentSteeringResponseData:function(){if(K)return K.getCurrentSteeringResponseData()},getCurrentTextTrackIndex:function(){let Ce=NaN;const rt=ee.getActiveStreamInfo();if(rt&&oe)return Ce=oe.getCurrentTrackIdx(rt.id),Ce},getCurrentTrackFor:function(Ce){if(!$)throw b;let rt=ee.getActiveStreamInfo();return rt?X.getCurrentTrackFor(Ce,rt.id):null},getDashAdapter:function(){return te},getDashMetrics:St,getDebug:function(){return x},getDvrSeekOffset:cn,getDvrWindow:function(){if(!J)throw p;const Ce=ee&&ee.hasVideoTrack()?l.default.VIDEO:l.default.AUDIO;let rt=_e.getCurrentDVRInfo(Ce);if(!rt)return{};let Pt=0;const zt=ie.getIsDynamic();return zt&&(Pt=rt.manifestInfo.availableFrom.getTime()/1e3),{start:rt.range.start,end:rt.range.end,startAsUtc:zt?Pt+rt.range.start:NaN,endAsUtc:zt?Pt+rt.range.end:NaN,size:rt.range.end-rt.range.start}},getExternalSubtitles:function(){Ee.getExternalSubtitles()},getInitialMediaSettingsFor:function(Ce){if(!D)throw w;return X.getInitialSettings(Ce)},getLowLatencyModeEnabled:function(){if(!J)throw p;return ie.getLowLatencyModeEnabled()},getManifest:function(){return xe.getValue()},getOfflineController:function(){return Rt()},getPlaybackRate:function(){return Kt().playbackRate},getProtectionController:function(){return Je()},getRawThroughputData:function(Ce=l.default.VIDEO){return le?le.getRawThroughputData(Ce):[]},getRepresentationsByType:function(Ce,rt=null){if(!$)throw b;let Pt=rt?ee.getStreamById(rt):Ut();return Pt?Pt.getRepresentationsByType(Ce):[]},getSafeAverageThroughput:function(Ce=l.default.VIDEO,rt=null,Pt=NaN){return le?le.getSafeAverageThroughput(Ce,rt,Pt):0},getSettings:function(){return C.get()},getSource:function(){if(!I)throw T;return I},getStreamsFromManifest:function(Ce){if(!$)throw b;return te.getStreamsInfo(Ce)},getTTMLRenderingDiv:function(){return Ge?Ge.getTTMLRenderingDiv():null},getTargetLiveDelay:function(){if(!J)throw p;return ie.getOriginalLiveDelay()},getTracksFor:ot,getTracksForTypeFromManifest:function(Ce,rt,Pt){if(!$)throw b;return(Pt=Pt||te.getStreamsInfo(rt,1)[0])?te.getAllMediaInfoForType(Pt,Ce,rt):[]},getVersion:on,getVideoElement:Kt,getVolume:function(){return Kt().volume},getXHRWithCredentialsForType:function(Ce){return Ee.getXHRWithCredentialsForType(Ce)},initialize:function(Ce,rt,Pt,zt=NaN){Le||(Le=(0,oc.default)(A).getInstance(),Le.setConfig({settings:C,protectionController:G})),Re||(Re=Vh(A).getInstance()),Le.supportsMediaSource()?(D||(D=!0,be=_g(A).getInstance(),le||(le=wg(A).getInstance()),re||(re=Rn(A).getInstance()),ue||(ue=Zl(A).getInstance()),ie||(ie=pm(A).getInstance()),X||(X=mm(A).getInstance()),ee||(ee=Du(A).getInstance()),ae||(ae=Qh(A).getInstance()),ge||(ge=ph(A).getInstance()),me||(me=Tm(A).getInstance()),K||(K=co(A).getInstance()),Q||(Q=gh(A).getInstance()),te=Nh(A).getInstance(),xe=fm(A).getInstance(),Me=jl(A).getInstance(),Ne=Yl(A).getInstance(),Wt=Vl(A).getInstance(),_e=$h(A).getInstance({settings:C}),ht=bh(A).getInstance({settings:C}),te.setConfig({constants:l.default,cea608parser:new Fu,errHandler:Re,BASE64:lt}),Oe||(Oe=fh(A).create()),Oe.setConfig({adapter:te,contentSteeringController:K}),me.setConfig({adapter:te}),wt||(wt=Em(A).getInstance({dashMetrics:_e,mediaPlayerModel:ke,errHandler:Re,baseURLController:Oe,events:u.default,eventBus:N,debug:x,boxParser:rs(A).getInstance(),errors:Yt})),X.setConfig({domStorage:ht,settings:C,mediaPlayerModel:ke,customParametersModel:Ee,videoModel:Ge}),ke.setConfig({playbackController:ie,serviceDescriptionController:me}),K.setConfig({adapter:te,errHandler:Re,dashMetrics:_e,mediaPlayerModel:ke,manifestModel:xe,serviceDescriptionController:me,throughputController:le,eventBus:N}),gt(),pt(Pt===void 0||Pt),Rt()),Ce&&gn(Ce),rt&&_t(rt,zt),q.info("[dash.js "+on()+"] MediaPlayer has been initialized")):Re.error(new Bt.default(Yt.CAPABILITY_MEDIASOURCE_ERROR_CODE,Yt.CAPABILITY_MEDIASOURCE_ERROR_MESSAGE))},isDynamic:vn,isMuted:function(){return Kt().muted},isPaused:kn,isReady:Vt,isSeeking:function(){if(!J)throw p;return ie.isSeeking()},isTextEnabled:function(){const Ce=ee.getActiveStreamInfo();return!(!Ce||!oe)&&oe.isTextEnabled(Ce)},off:function(Ce,rt,Pt){N.off(Ce,rt,Pt)},on:function(Ce,rt,Pt,zt){N.on(Ce,rt,Pt,zt)},pause:function(){if(!J)throw p;ie.pause()},play:function(){if(!J)throw p;(!Z||kn()&&J)&&ie.play(!0)},preload:function(){if(!Ge.getElement()&&!$){if(!I)throw T;Lt(V)}},provideThumbnail:function(Ce,rt){if(typeof rt!="function")return;if(Ce<0)return void rt(null);const Pt=ie.getIsDynamic()?cn(Ce):Ce,zt=ee.getStreamForTime(Pt);if(zt===null)return void rt(null);const yn=zt.getThumbnailController();if(yn)return yn.provide(Pt,rt);rt(null)},refreshManifest:function(Ce){if(!D)throw w;if(!Vt())return Ce(null,T);let rt=this;if(typeof Ce=="function"){const Pt=function(zt){N.off(u.default.INTERNAL_MANIFEST_LOADED,Pt,rt),zt.error?Ce(null,zt.error):Ce(zt.manifest)};N.on(u.default.INTERNAL_MANIFEST_LOADED,Pt,rt)}ee.refreshManifest()},registerCustomCapabilitiesFilter:function(Ce){Ee.registerCustomCapabilitiesFilter(Ce)},registerLicenseRequestFilter:function(Ce){Ee.registerLicenseRequestFilter(Ce)},registerLicenseResponseFilter:function(Ce){Ee.registerLicenseResponseFilter(Ce)},removeABRCustomRule:function(Ce){Ee.removeAbrCustomRule(Ce)},removeAllABRCustomRule:function(){Ee.removeAllAbrCustomRule()},removeExternalSubtitleById:function(Ce){Ee.removeExternalSubtitleById(Ce)},removeExternalSubtitleByUrl:function(Ce){Ee.removeExternalSubtitleByUrl(Ce)},removeRequestInterceptor:function(Ce){Ee.removeRequestInterceptor(Ce)},removeResponseInterceptor:function(Ce){Ee.removeResponseInterceptor(Ce)},removeUTCTimingSource:function(Ce,rt){Ee.removeUTCTimingSource(Ce,rt)},reset:At,resetCustomInitialTrackSelectionFunction:function(){Ee.resetCustomInitialTrackSelectionFunction(null)},resetSettings:function(){C.reset()},restoreDefaultUTCTimingSources:gt,retrieveManifest:function(Ce,rt){let Pt=bt(),zt=this;const yn=function(ut){ut.error?rt(null,ut.error):rt(ut.manifest),N.off(u.default.INTERNAL_MANIFEST_LOADED,yn,zt),Pt.reset()};N.on(u.default.INTERNAL_MANIFEST_LOADED,yn,zt),Ze.initialize(Ce),Pt.load(Ce)},seek:function(Ce){if(!J)throw p;if((0,ct.checkParameterType)(Ce,"number"),isNaN(Ce))throw l.default.BAD_ARGUMENT_ERROR;Ce<0&&(Ce=0);let rt=ie.getIsDynamic()?cn(Ce):Ce;const Pt=Kt();!ie.getIsDynamic()&&Pt.duration&&(rt=Math.min(Pt.duration,rt)),ie.seek(rt,!1,!1,!0)},seekToOriginalLive:function(){J&&vn()&&ie.seekToOriginalLive()},seekToPresentationTime:function(Ce){if(!J)throw p;if((0,ct.checkParameterType)(Ce,"number"),isNaN(Ce))throw l.default.BAD_ARGUMENT_ERROR;Ce<0&&(Ce=0);const rt=Kt();if(!ie.getIsDynamic()&&rt.duration&&(Ce=Math.min(rt.duration,Ce)),ie.getIsDynamic()){const Pt=ee&&ee.hasVideoTrack()?l.default.VIDEO:l.default.AUDIO;let zt=_e.getCurrentDVRInfo(Pt);if(!zt)return;(Ce=pn(Ce,zt))<zt.range.start&&(Ce=zt.range.start)}ie.seek(Ce,!1,!1,!0)},setAutoPlay:pt,setConfig:function(Ce){Ce&&(Ce.capabilities&&(Le=Ce.capabilities),Ce.capabilitiesFilter&&(Q=Ce.capabilitiesFilter),Ce.streamController&&(ee=Ce.streamController),Ce.textController&&(oe=Ce.textController),Ce.gapController&&(ae=Ce.gapController),Ce.throughputController&&(le=Ce.throughputController),Ce.playbackController&&(ie=Ce.playbackController),Ce.serviceDescriptionController&&(me=Ce.serviceDescriptionController),Ce.contentSteeringController&&(K=Ce.contentSteeringController),Ce.clientDataReportingController&&(Wt=Ce.clientDataReportingController),Ce.catchupController&&(ge=Ce.catchupController),Ce.mediaPlayerModel&&(ke=Ce.mediaPlayerModel),Ce.customParametersModel&&(Ee=Ce.customParametersModel),Ce.abrController&&(re=Ce.abrController),Ce.schemeLoaderFactory&&(ue=Ce.schemeLoaderFactory),Ce.mediaController&&(X=Ce.mediaController),Ce.settings&&(C=Ce.settings),Ce.dashMetrics&&(_e=Ce.dashMetrics))},setCurrentTrack:function(Ce,rt=!1){if(!$)throw b;!G||G.areKeyIdsUsable(Ce.normalizedKeyIds)?X.setTrack(Ce,{noSettingsSave:rt}):q.error(`Can not switch to track with index ${Ce.index} because key is not usable`)},setCustomInitialTrackSelectionFunction:function(Ce){Ee.setCustomInitialTrackSelectionFunction(Ce)},setInitialMediaSettingsFor:function(Ce,rt){if(!D)throw w;let Pt=(function(zt){const yn=C.get().streaming.defaultSchemeIdUri;let ut={};function Ht(dn,ln,En){let mn={};if(ln){if(ln instanceof Array)throw"Array type not supported for settings!";return ln instanceof Object?(mn.schemeIdUri=ln.schemeIdUri?ln.schemeIdUri:"",mn.value=ln.value?ln.value:""):(mn.schemeIdUri=En,mn.value=ln,q.warn("No schemeIdUri provided for "+dn+', using default "'+En+'"')),mn}return null}return zt.id!==void 0&&(ut.id=zt.id),zt.lang!==void 0&&(ut.lang=zt.lang),isNaN(zt.index)||(ut.index=zt.index),zt.viewpoint!==void 0&&(ut.viewpoint=Ht("viewpoint",zt.viewpoint,yn.viewpoint)),zt.audioChannelConfiguration!==void 0&&(ut.audioChannelConfiguration=Ht("audioChannelConfiguration",zt.audioChannelConfiguration,yn.audioChannelConfiguration)),zt.role!==void 0&&zt.role!==null&&(ut.role=Ht("role",zt.role,yn.role),ut.role.schemeIdUri===l.default.DASH_ROLE_SCHEME_ID&&ut.role.value==="Main"&&(ut.role.value=Se.default.MAIN)),zt.accessibility!==void 0&&(ut.accessibility=Ht("accessibility",zt.accessibility,yn.accessibility)),ut})(rt);X.setInitialSettings(Ce,Pt)},setMute:function(Ce){(0,ct.checkParameterType)(Ce,"boolean"),Kt().muted=Ce},setPlaybackRate:function(Ce){Kt().playbackRate=Ce},setProtectionData:function(Ce){P=Ce,ee&&ee.setProtectionData(P)},setRepresentationForTypeById:function(Ce,rt,Pt=!1){if(Ce!==l.default.IMAGE&&Ce!==l.default.VIDEO&&Ce!==l.default.AUDIO)return;if(!$)throw b;const zt=Ut();if(zt)if(Ce===l.default.IMAGE){const yn=zt.getThumbnailController();yn&&yn.setTrackById(rt)}else{const yn=zt.getRepresentationForTypeById(Ce,rt);yn&&re.manuallySetPlaybackQuality(Ce,ee.getActiveStreamInfo(),yn,{forceReplace:Pt})}},setRepresentationForTypeByIndex:function(Ce,rt,Pt=!1){if(Ce!==l.default.IMAGE&&Ce!==l.default.VIDEO&&Ce!==l.default.AUDIO)return;if(!$)throw b;const zt=Ut();if(zt)if(Ce===l.default.IMAGE){const yn=zt.getThumbnailController();yn&&yn.setTrackByIndex(rt)}else{const yn=zt.getRepresentationForTypeByIndex(Ce,rt);yn&&re.manuallySetPlaybackQuality(Ce,ee.getActiveStreamInfo(),yn,{forceReplace:Pt})}},setTextTrack:function(Ce){if(!J)throw p;const rt=ee.getActiveStreamInfo();rt&&oe&&oe.setTextTrack(rt.id,Ce)},setVolume:function(Ce){if(typeof Ce!="number"||isNaN(Ce)||Ce<0||Ce>1)throw l.default.BAD_ARGUMENT_ERROR;Kt().volume=Ce},setXHRWithCredentialsForType:function(Ce,rt){Ee.setXHRWithCredentialsForType(Ce,rt)},time:We,timeAsUTC:function(){if(!J)throw p;if(!ie.getIsDynamic()||We()<0)return NaN;const Ce=ee&&ee.hasVideoTrack()?l.default.VIDEO:l.default.AUDIO;let rt,Pt,zt=_e.getCurrentDVRInfo(Ce);return zt?(rt=zt.manifestInfo.availableFrom.getTime()/1e3,Pt=rt+We(),Pt):0},timeInDvrWindow:function(){if(!J)throw p;if(!ie.getIsDynamic())return We();let Ce=Kt().currentTime;const rt=ee&&ee.hasVideoTrack()?l.default.VIDEO:l.default.AUDIO;let Pt=_e.getCurrentDVRInfo(rt);return Ce=Pt===null||Ce===0?0:Math.max(0,Ce-Pt.range.start),Ce},trigger:function(Ce,rt,Pt){N.trigger(Ce,rt,Pt)},triggerSteeringRequest:function(){if(K)return K.loadSteeringData()},unregisterCustomCapabilitiesFilter:function(Ce){Ee.unregisterCustomCapabilitiesFilter(Ce)},unregisterLicenseRequestFilter:function(Ce){Ee.unregisterLicenseRequestFilter(Ce)},unregisterLicenseResponseFilter:function(Ce){Ee.unregisterLicenseResponseFilter(Ce)},updateSettings:function(Ce){C.update(Ce)},updateSource:function(Ce){I=Ce,ee.load(I)}},q=x.getLogger(B),D=!1,J=!1,$=!1,Z=!0,V=NaN,G=null,ve=null,P=null,te=null,wt=null,u.default.extend(d.default),ke=gm(A).getInstance(),Ee=(0,so.default)(A).getInstance(),Ge=Ig(A).getInstance(),Ze=Sg(A).getInstance(),B}xo.__dashjs_factory_name="MediaPlayer";const ms=n.default.getClassFactory(xo);ms.events=d.default,ms.errors=Yt,n.default.updateClassFactory(xo.__dashjs_factory_name,ms);var xg=ms},1191:function(o,e,t){t.r(e);var n=t(7252);class r extends n.default{constructor(){super(),this.AST_IN_FUTURE="astInFuture",this.BASE_URLS_UPDATED="baseUrlsUpdated",this.BUFFER_EMPTY="bufferStalled",this.BUFFER_LOADED="bufferLoaded",this.BUFFER_LEVEL_STATE_CHANGED="bufferStateChanged",this.BUFFER_LEVEL_UPDATED="bufferLevelUpdated",this.DVB_FONT_DOWNLOAD_ADDED="dvbFontDownloadAdded",this.DVB_FONT_DOWNLOAD_COMPLETE="dvbFontDownloadComplete",this.DVB_FONT_DOWNLOAD_FAILED="dvbFontDownloadFailed",this.DYNAMIC_TO_STATIC="dynamicToStatic",this.ERROR="error",this.FRAGMENT_LOADING_COMPLETED="fragmentLoadingCompleted",this.FRAGMENT_LOADING_PROGRESS="fragmentLoadingProgress",this.FRAGMENT_LOADING_STARTED="fragmentLoadingStarted",this.FRAGMENT_LOADING_ABANDONED="fragmentLoadingAbandoned",this.LOG="log",this.MANIFEST_LOADING_STARTED="manifestLoadingStarted",this.MANIFEST_LOADING_FINISHED="manifestLoadingFinished",this.MANIFEST_LOADED="manifestLoaded",this.METRICS_CHANGED="metricsChanged",this.METRIC_CHANGED="metricChanged",this.METRIC_ADDED="metricAdded",this.METRIC_UPDATED="metricUpdated",this.PERIOD_SWITCH_STARTED="periodSwitchStarted",this.PERIOD_SWITCH_COMPLETED="periodSwitchCompleted",this.QUALITY_CHANGE_REQUESTED="qualityChangeRequested",this.QUALITY_CHANGE_RENDERED="qualityChangeRendered",this.NEW_TRACK_SELECTED="newTrackSelected",this.TRACK_CHANGE_RENDERED="trackChangeRendered",this.STREAM_INITIALIZING="streamInitializing",this.STREAM_UPDATED="streamUpdated",this.STREAM_ACTIVATED="streamActivated",this.STREAM_DEACTIVATED="streamDeactivated",this.STREAM_INITIALIZED="streamInitialized",this.STREAM_TEARDOWN_COMPLETE="streamTeardownComplete",this.TEXT_TRACKS_ADDED="allTextTracksAdded",this.TEXT_TRACK_ADDED="textTrackAdded",this.CUE_ENTER="cueEnter",this.CUE_EXIT="cueExit",this.THROUGHPUT_MEASUREMENT_STORED="throughputMeasurementStored",this.TTML_PARSED="ttmlParsed",this.TTML_TO_PARSE="ttmlToParse",this.CAPTION_RENDERED="captionRendered",this.CAPTION_CONTAINER_RESIZE="captionContainerResize",this.CAN_PLAY="canPlay",this.CAN_PLAY_THROUGH="canPlayThrough",this.PLAYBACK_ENDED="playbackEnded",this.PLAYBACK_ERROR="playbackError",this.PLAYBACK_INITIALIZED="playbackInitialized",this.PLAYBACK_NOT_ALLOWED="playbackNotAllowed",this.PLAYBACK_METADATA_LOADED="playbackMetaDataLoaded",this.PLAYBACK_LOADED_DATA="playbackLoadedData",this.PLAYBACK_PAUSED="playbackPaused",this.PLAYBACK_PLAYING="playbackPlaying",this.PLAYBACK_PROGRESS="playbackProgress",this.PLAYBACK_RATE_CHANGED="playbackRateChanged",this.PLAYBACK_SEEKED="playbackSeeked",this.PLAYBACK_SEEKING="playbackSeeking",this.PLAYBACK_STALLED="playbackStalled",this.PLAYBACK_STARTED="playbackStarted",this.PLAYBACK_TIME_UPDATED="playbackTimeUpdated",this.PLAYBACK_VOLUME_CHANGED="playbackVolumeChanged",this.PLAYBACK_WAITING="playbackWaiting",this.MANIFEST_VALIDITY_CHANGED="manifestValidityChanged",this.EVENT_MODE_ON_START="eventModeOnStart",this.EVENT_MODE_ON_RECEIVE="eventModeOnReceive",this.CONFORMANCE_VIOLATION="conformanceViolation",this.REPRESENTATION_SWITCH="representationSwitch",this.ADAPTATION_SET_REMOVED_NO_CAPABILITIES="adaptationSetRemovedNoCapabilities",this.CONTENT_STEERING_REQUEST_COMPLETED="contentSteeringRequestCompleted",this.INBAND_PRFT="inbandPrft",this.MANAGED_MEDIA_SOURCE_START_STREAMING="managedMediaSourceStartStreaming",this.MANAGED_MEDIA_SOURCE_END_STREAMING="managedMediaSourceEndStreaming"}}let i=new r;e.default=i},5212:function(o,e,t){t.r(e),e.default={STREAM:"stream",VIDEO:"video",ENHANCEMENT:"enhancement",AUDIO:"audio",TEXT:"text",MUXED:"muxed",IMAGE:"image",STPP:"stpp",TTML:"ttml",VTT:"vtt",WVTT:"wvtt",CONTENT_STEERING:"contentSteering",LIVE_CATCHUP_MODE_DEFAULT:"liveCatchupModeDefault",LIVE_CATCHUP_MODE_LOLP:"liveCatchupModeLoLP",MOVING_AVERAGE_SLIDING_WINDOW:"slidingWindow",MOVING_AVERAGE_EWMA:"ewma",BAD_ARGUMENT_ERROR:"Invalid Arguments",MISSING_CONFIG_ERROR:"Missing config parameter(s)",TRACK_SWITCH_MODE_ALWAYS_REPLACE:"alwaysReplace",TRACK_SWITCH_MODE_NEVER_REPLACE:"neverReplace",TRACK_SELECTION_MODE_FIRST_TRACK:"firstTrack",TRACK_SELECTION_MODE_HIGHEST_BITRATE:"highestBitrate",TRACK_SELECTION_MODE_HIGHEST_EFFICIENCY:"highestEfficiency",TRACK_SELECTION_MODE_LOWEST_STARTUP_DELAY:"lowestStartupDelay",TRACK_SELECTION_MODE_WIDEST_RANGE:"widestRange",CMCD_QUERY_KEY:"CMCD",CMCD_MODE_QUERY:"query",CMCD_MODE_HEADER:"header",CMCD_AVAILABLE_KEYS:["br","d","ot","tb","bl","dl","mtp","nor","nrr","su","bs","rtp","cid","pr","sf","sid","st","v"],CMCD_V2_AVAILABLE_KEYS:["msd","ltc"],CMCD_AVAILABLE_REQUESTS:["segment","mpd","xlink","steering","other"],INITIALIZE:"initialize",TEXT_SHOWING:"showing",TEXT_HIDDEN:"hidden",TEXT_DISABLED:"disabled",ACCESSIBILITY_CEA608_SCHEME:"urn:scte:dash:cc:cea-608:2015",CC1:"CC1",CC3:"CC3",UTF8:"utf-8",SCHEME_ID_URI:"schemeIdUri",START_TIME:"starttime",SERVICE_DESCRIPTION_DVB_LL_SCHEME:"urn:dvb:dash:lowlatency:scope:2019",SUPPLEMENTAL_PROPERTY_DVB_LL_SCHEME:"urn:dvb:dash:lowlatency:critical:2019",CTA_5004_2023_SCHEME:"urn:mpeg:dash:cta-5004:2023",THUMBNAILS_SCHEME_ID_URIS:["http://dashif.org/thumbnail_tile","http://dashif.org/guidelines/thumbnail_tile"],FONT_DOWNLOAD_DVB_SCHEME:"urn:dvb:dash:fontdownload:2014",COLOUR_PRIMARIES_SCHEME_ID_URI:"urn:mpeg:mpegB:cicp:ColourPrimaries",URL_QUERY_INFO_SCHEME:"urn:mpeg:dash:urlparam:2014",EXT_URL_QUERY_INFO_SCHEME:"urn:mpeg:dash:urlparam:2016",MATRIX_COEFFICIENTS_SCHEME_ID_URI:"urn:mpeg:mpegB:cicp:MatrixCoefficients",TRANSFER_CHARACTERISTICS_SCHEME_ID_URI:"urn:mpeg:mpegB:cicp:TransferCharacteristics",SEGMENT_SEQUENCE_REPRESENTATION_SCHEME_ID_URI:"urn:mpeg:dash:ssr:2023",HDR_METADATA_FORMAT_SCHEME_ID_URI:"urn:dvb:dash:hdr-dmi",HDR_METADATA_FORMAT_VALUES:{ST2094_10:"ST2094-10",SL_HDR2:"SL-HDR2",ST2094_40:"ST2094-40"},MEDIA_CAPABILITIES_API:{COLORGAMUT:{SRGB:"srgb",P3:"p3",REC2020:"rec2020"},TRANSFERFUNCTION:{SRGB:"srgb",PQ:"pq",HLG:"hlg"},HDR_METADATATYPE:{SMPTE_ST_2094_10:"smpteSt2094-10",SLHDR2:"slhdr2",SMPTE_ST_2094_40:"smpteSt2094-40"}},XML:"XML",ARRAY_BUFFER:"ArrayBuffer",DVB_REPORTING_URL:"dvb:reportingUrl",DVB_PROBABILITY:"dvb:probability",OFF_MIMETYPE:"application/font-sfnt",WOFF_MIMETYPE:"application/font-woff",VIDEO_ELEMENT_READY_STATES:{HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},FILE_LOADER_TYPES:{FETCH:"fetch_loader",XHR:"xhr_loader"},THROUGHPUT_TYPES:{LATENCY:"throughput_type_latency",BANDWIDTH:"throughput_type_bandwidth"},THROUGHPUT_CALCULATION_MODES:{EWMA:"throughputCalculationModeEwma",ZLEMA:"throughputCalculationModeZlema",ARITHMETIC_MEAN:"throughputCalculationModeArithmeticMean",BYTE_SIZE_WEIGHTED_ARITHMETIC_MEAN:"throughputCalculationModeByteSizeWeightedArithmeticMean",DATE_WEIGHTED_ARITHMETIC_MEAN:"throughputCalculationModeDateWeightedArithmeticMean",HARMONIC_MEAN:"throughputCalculationModeHarmonicMean",BYTE_SIZE_WEIGHTED_HARMONIC_MEAN:"throughputCalculationModeByteSizeWeightedHarmonicMean",DATE_WEIGHTED_HARMONIC_MEAN:"throughputCalculationModeDateWeightedHarmonicMean"},LOW_LATENCY_DOWNLOAD_TIME_CALCULATION_MODE:{MOOF_PARSING:"lowLatencyDownloadTimeCalculationModeMoofParsing",DOWNLOADED_DATA:"lowLatencyDownloadTimeCalculationModeDownloadedData",AAST:"lowLatencyDownloadTimeCalculationModeAast"},RULES_TYPES:{QUALITY_SWITCH_RULES:"qualitySwitchRules",ABANDON_FRAGMENT_RULES:"abandonFragmentRules"},QUALITY_SWITCH_RULES:{BOLA_RULE:"BolaRule",THROUGHPUT_RULE:"ThroughputRule",INSUFFICIENT_BUFFER_RULE:"InsufficientBufferRule",SWITCH_HISTORY_RULE:"SwitchHistoryRule",DROPPED_FRAMES_RULE:"DroppedFramesRule",LEARN_TO_ADAPT_RULE:"L2ARule",LOL_PLUS_RULE:"LoLPRule"},ABANDON_FRAGMENT_RULES:{ABANDON_REQUEST_RULE:"AbandonRequestsRule"},ID3_SCHEME_ID_URI:"https://aomedia.org/emsg/ID3",COMMON_ACCESS_TOKEN_HEADER:"common-access-token",DASH_ROLE_SCHEME_ID:"urn:mpeg:dash:role:2011",CODEC_FAMILIES:{MP3:"mp3",AAC:"aac",AC3:"ac3",EC3:"ec3",DTSX:"dtsx",DTSC:"dtsc",AVC:"avc",HEVC:"hevc"}}},2861:function(o,e,t){t.r(e),e.default={CLEARKEY_KEYSTEM_STRING:"org.w3.clearkey",WIDEVINE_KEYSTEM_STRING:"com.widevine.alpha",PLAYREADY_KEYSTEM_STRING:"com.microsoft.playready",PLAYREADY_RECOMMENDATION_KEYSTEM_STRING:"com.microsoft.playready.recommendation",WIDEVINE_UUID:"edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",PLAYREADY_UUID:"9a04f079-9840-4286-ab92-e65be0885f95",CLEARKEY_UUID:"e2719d58-a985-b3c9-781a-b030af78d30e",W3C_CLEARKEY_UUID:"1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",INITIALIZATION_DATA_TYPE_CENC:"cenc",INITIALIZATION_DATA_TYPE_KEYIDS:"keyids",INITIALIZATION_DATA_TYPE_WEBM:"webm",ENCRYPTION_SCHEME_CENC:"cenc",ENCRYPTION_SCHEME_CBCS:"cbcs",MEDIA_KEY_MESSAGE_TYPES:{LICENSE_REQUEST:"license-request",LICENSE_RENEWAL:"license-renewal",LICENSE_RELEASE:"license-release",INDIVIDUALIZATION_REQUEST:"individualization-request"},ROBUSTNESS_STRINGS:{WIDEVINE:{SW_SECURE_CRYPTO:"SW_SECURE_CRYPTO",SW_SECURE_DECODE:"SW_SECURE_DECODE",HW_SECURE_CRYPTO:"HW_SECURE_CRYPTO",HW_SECURE_DECODE:"HW_SECURE_DECODE",HW_SECURE_ALL:"HW_SECURE_ALL"}},MEDIA_KEY_STATUSES:{USABLE:"usable",EXPIRED:"expired",RELEASED:"released",OUTPUT_RESTRICTED:"output-restricted",OUTPUT_DOWNSCALED:"output-downscaled",STATUS_PENDING:"status-pending",INTERNAL_ERROR:"internal-error"}}},4469:function(o,e,t){t.r(e),t.d(e,{default:function(){return L}});class n{constructor(){this.mpdurl=null,this.errorcode=null,this.terror=null,this.url=null,this.ipaddress=null,this.servicelocation=null}}n.SSL_CONNECTION_FAILED_PREFIX="SSL",n.DNS_RESOLUTION_FAILED="C00",n.HOST_UNREACHABLE="C01",n.CONNECTION_REFUSED="C02",n.CONNECTION_ERROR="C03",n.CORRUPT_MEDIA_ISOBMFF="M00",n.CORRUPT_MEDIA_OTHER="M01",n.BASE_URL_CHANGED="F00",n.BECAME_REPORTER="S00";var r=n,i=t(913),c=t(138);function h(ne){let H,De;const Ye=(ne=ne||{}).eventBus,qe=ne.dashMetrics,Fe=ne.metricsConstants,Ue=ne.events;function Ke(Tt){let yt=new r;if(De){for(const Zt in Tt)Tt.hasOwnProperty(Zt)&&(yt[Zt]=Tt[Zt]);yt.mpdurl||(yt.mpdurl=De.originalUrl||De.url),yt.terror||(yt.terror=new Date),qe.addDVBErrors(yt)}}function tt(Tt){Tt.error||(De=Tt.manifest)}function nt(Tt){Ke({errorcode:r.BASE_URL_CHANGED,servicelocation:Tt.entry})}function dt(){Ke({errorcode:r.BECAME_REPORTER})}function Gt(Tt){var yt;Tt.metric===Fe.HTTP_REQUEST&&((yt=Tt.value).responsecode===0||yt.responsecode==null||yt.responsecode>=400||yt.responsecode<100||yt.responsecode>=600)&&Ke({errorcode:yt.responsecode||r.CONNECTION_ERROR,url:yt.url,terror:yt.tresponse,servicelocation:yt._serviceLocation})}function vt(Tt){let yt;switch(Tt.error?Tt.error.code:0){case MediaError.MEDIA_ERR_NETWORK:yt=r.CONNECTION_ERROR;break;case MediaError.MEDIA_ERR_DECODE:yt=r.CORRUPT_MEDIA_OTHER;break;default:return}Ke({errorcode:yt})}return H={initialize:function(){Ye.on(Ue.MANIFEST_UPDATED,tt,H),Ye.on(Ue.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED,nt,H),Ye.on(Ue.METRIC_ADDED,Gt,H),Ye.on(Ue.METRIC_UPDATED,Gt,H),Ye.on(Ue.PLAYBACK_ERROR,vt,H),Ye.on(i.default.BECAME_REPORTING_PLAYER,dt,H)},reset:function(){Ye.off(Ue.MANIFEST_UPDATED,tt,H),Ye.off(Ue.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED,nt,H),Ye.off(Ue.METRIC_ADDED,Gt,H),Ye.off(Ue.METRIC_UPDATED,Gt,H),Ye.off(Ue.PLAYBACK_ERROR,vt,H),Ye.off(i.default.BECAME_REPORTING_PLAYER,dt,H)}},H}h.__dashjs_factory_name="DVBErrorsTranslator";var f=c.default.getSingletonFactory(h),g=t(7377);function y(ne){ne=ne||{};let H,De,Ye=!1,qe=this.context,Fe=ne.mediaElement;return H={initialize:function(Ue){Ue&&Ue.length&&(Ue.forEach((Ke=>{let tt=Ke.starttime,nt=tt+Ke.duration;De.add(tt,nt)})),Ye=!!Ue[0]._useWallClockTime)},reset:function(){De.clear()},isEnabled:function(){let Ue,Ke=De.length;if(!Ke)return!0;Ue=Ye?new Date().getTime()/1e3:Fe.currentTime;for(let tt=0;tt<Ke;tt+=1){let nt=De.start(tt),dt=De.end(tt);if(nt<=Ue&&Ue<dt)return!0}return!1}},De=(0,g.default)(qe).create(),H}y.__dashjs_factory_name="RangeController";var u=c.default.getClassFactory(y);function l(){return{serialise:function ne(H){let De,Ye,qe=[],Fe=[];for(De in H)if(H.hasOwnProperty(De)&&De.indexOf("_")!==0){if(Ye=H[De],Ye==null&&(Ye=""),Array.isArray(Ye)){if(!Ye.length)continue;Fe=[],Ye.forEach((function(Ue){let Ke=Object.prototype.toString.call(Ue).slice(8,-1)!=="Object";Fe.push(Ke?Ue:ne(Ue))})),Ye=Fe.map(encodeURIComponent).join(",")}else typeof Ye=="string"?Ye=encodeURIComponent(Ye):Ye instanceof Date?Ye=Ye.toISOString():typeof Ye=="number"&&(Ye=Math.round(Ye));qe.push(De+"="+Ye)}return qe.join("&")}}}l.__dashjs_factory_name="MetricSerialiser";var d=c.default.getSingletonFactory(l);function m(){let ne,H,De,Ye=window.crypto||window.msCrypto,qe=Uint32Array,Fe=Math.pow(2,8*qe.BYTES_PER_ELEMENT)-1;function Ue(){Ye&&(ne||(ne=new qe(10)),Ye.getRandomValues(ne),H=0)}return De={random:function(Ke,tt){let nt;return Ke||(Ke=0),tt||(tt=1),Ye?(H===ne.length&&Ue(),nt=ne[H]/Fe,H+=1):nt=Math.random(),nt*(tt-Ke)+Ke}},Ue(),De}m.__dashjs_factory_name="RNG";var E=c.default.getSingletonFactory(m),S=t(1926);function _(ne){let H;ne=ne||{};let De,Ye,qe,Fe,Ue,Ke,tt,nt=this.context,dt=[];const Gt=ne.metricsConstants;function vt(){Fe=!1,Ue=!1,Ke=null,tt=null}return H={report:function(Tt,yt){Array.isArray(yt)||(yt=[yt]),Ue&&tt.isEnabled()&&yt.forEach((function(Zt){let _n=De.serialise(Zt);Tt!==Gt.DVB_ERRORS&&(_n=`metricname=${Tt}&${_n}`),_n=`${Ke}?${_n}`,(function(An,Sn,wn){let Rn=new XMLHttpRequest;Rn.withCredentials=Ye.getXHRWithCredentialsForType(Gt.HTTP_REQUEST_DVB_REPORTING_TYPE);const mt=function(){let st=dt.indexOf(Rn);st!==-1&&(dt.splice(st,1),!(Rn.status>=200&&Rn.status<300)&&wn&&wn())};dt.push(Rn);try{Rn.open("GET",An),Rn.onloadend=mt,Rn.onerror=mt,Rn.send()}catch{Rn.onerror()}})(_n,0,(function(){Ue=!1}))}))},initialize:function(Tt,yt){let Zt;if(tt=yt,Ke=Tt.dvbReportingUrl,!Ke)throw new Error("required parameter missing (dvb:reportingUrl)");Fe||(Zt=Tt.dvbProbability,Zt&&(Zt===1e3||Zt/1e3>=qe.random())&&(Ue=!0),Fe=!0)},reset:function(){vt()}},De=d(nt).getInstance(),qe=E(nt).getInstance(),Ye=(0,S.default)(nt).getInstance(),vt(),H}_.__dashjs_factory_name="DVBReporting";var M=c.default.getClassFactory(_);function R(ne){ne=ne||{};const H={"urn:dvb:dash:reporting:2014":M},De=this.context;let Ye;const qe=ne.debug?ne.debug.getLogger(Ye):{},Fe=ne.metricsConstants,Ue=ne.mediaPlayerModel||{};return Ye={create:function(Ke,tt){let nt;try{nt=H[Ke.schemeIdUri](De).create({metricsConstants:Fe,mediaPlayerModel:Ue}),nt.initialize(Ke,tt)}catch(dt){nt=null,qe.error(`ReportingFactory: could not create Reporting with schemeIdUri ${Ke.schemeIdUri} (${dt.message})`)}return nt},register:function(Ke,tt){H[Ke]=tt},unregister:function(Ke){delete H[Ke]}},Ye}R.__dashjs_factory_name="ReportingFactory";var W=c.default.getSingletonFactory(R);function fe(ne){let H,De=[];const Ye=W(this.context).getInstance(ne);return H={initialize:function(qe,Fe){qe.some((Ue=>{let Ke=Ye.create(Ue,Fe);if(Ke)return De.push(Ke),!0}))},reset:function(){De.forEach((qe=>qe.reset())),De=[]},report:function(qe,Fe){De.forEach((Ue=>Ue.report(qe,Fe)))}},H}fe.__dashjs_factory_name="ReportingController";var ye=c.default.getClassFactory(fe);function Y(){return{reconstructFullMetricName:function(ne,H,De){let Ye=ne;return H&&(Ye+="("+H,De&&De.length&&(Ye+=","+De),Ye+=")"),Ye},validateN:function(ne){if(!ne)throw new Error("missing n");if(isNaN(ne))throw new Error("n is NaN");if(ne<0)throw new Error("n must be positive");return ne}}}Y.__dashjs_factory_name="HandlerHelpers";var j=c.default.getSingletonFactory(Y);function se(ne){let H,De,Ye,qe,Fe,Ue;ne=ne||{};let Ke=this.context,tt=j(Ke).getInstance(),nt=[];const dt=ne.metricsConstants;function Gt(){let vt=(function(){try{return Object.keys(nt).map((Tt=>nt[Tt])).reduce(((Tt,yt)=>Tt.level<yt.level?Tt:yt))}catch{return}})();vt&&Ue!==vt.t&&(Ue=vt.t,De.report(qe,vt))}return H={initialize:function(vt,Tt,yt){Tt&&(Ye=tt.validateN(yt),De=Tt,qe=tt.reconstructFullMetricName(vt,yt),Fe=setInterval(Gt,Ye))},reset:function(){clearInterval(Fe),Fe=null,Ye=0,De=null,Ue=null},handleNewMetric:function(vt,Tt,yt){vt===dt.BUFFER_LEVEL&&(nt[yt]=Tt)}},H}se.__dashjs_factory_name="BufferLevelHandler";var Te=c.default.getClassFactory(se),Ae=c.default.getClassFactory((function(ne){let H,De,Ye=(ne=ne||{}).eventBus;const qe=ne.metricsConstants;function Fe(){Ye.off(i.default.METRICS_INITIALISATION_COMPLETE,Fe,this),Ye.trigger(i.default.BECAME_REPORTING_PLAYER)}return H={initialize:function(Ue,Ke){Ke&&(De=Ke,Ye.on(i.default.METRICS_INITIALISATION_COMPLETE,Fe,this))},reset:function(){De=null},handleNewMetric:function(Ue,Ke){Ue===qe.DVB_ERRORS&&De&&De.report(Ue,Ke)}},H}));function ze(ne){let H,De,Ye,qe,Fe,Ue;ne=ne||{};let Ke=[],tt=j(this.context).getInstance();const nt=ne.metricsConstants;function dt(){var Gt=Ke;Gt.length&&De&&De.report(Fe,Gt),Ke=[]}return H={initialize:function(Gt,vt,Tt,yt){vt&&(Ye=tt.validateN(Tt),De=vt,yt&&yt.length&&(qe=yt),Fe=tt.reconstructFullMetricName(Gt,Tt,yt),Ue=setInterval(dt,Ye))},reset:function(){clearInterval(Ue),Ue=null,Ye=null,qe=null,Ke=[],De=null},handleNewMetric:function(Gt,vt){Gt===nt.HTTP_REQUEST&&(qe&&qe!==vt.type||Ke.push(vt))}},H}ze.__dashjs_factory_name="HttpListHandler";var de=c.default.getClassFactory(ze);function we(){let ne,H,De;return ne={initialize:function(Ye,qe){H=Ye,De=qe},reset:function(){De=null,H=void 0},handleNewMetric:function(Ye,qe){Ye===H&&De&&De.report(H,qe)}},ne}we.__dashjs_factory_name="GenericMetricHandler";var ce=c.default.getClassFactory(we);function he(ne){let H;const De=(ne=ne||{}).debug?ne.debug.getLogger(H):{};let Ye=/([a-zA-Z]*)(\(([0-9]*)(\,\s*([a-zA-Z]*))?\))?/;const qe=this.context;let Fe={BufferLevel:Te,DVBErrors:Ae,HttpList:de,PlayList:ce,RepSwitchList:ce,TcpList:ce};return H={create:function(Ue,Ke){var tt,nt=Ue.match(Ye);if(nt){try{(tt=Fe[nt[1]](qe).create({eventBus:ne.eventBus,metricsConstants:ne.metricsConstants})).initialize(nt[1],Ke,nt[3],nt[5])}catch(dt){tt=null,De.error(`MetricsHandlerFactory: Could not create handler for type ${nt[1]} with args ${nt[3]}, ${nt[5]} (${dt.message})`)}return tt}},register:function(Ue,Ke){Fe[Ue]=Ke},unregister:function(Ue){delete Fe[Ue]}},H}he.__dashjs_factory_name="MetricsHandlerFactory";var Pe=c.default.getSingletonFactory(he);function $e(ne){ne=ne||{};let H,De=[];const Ye=this.context,qe=ne.eventBus,Fe=ne.events;let Ue=Pe(Ye).getInstance({debug:ne.debug,eventBus:ne.eventBus,metricsConstants:ne.metricsConstants});function Ke(tt){De.forEach((nt=>{nt.handleNewMetric(tt.metric,tt.value,tt.mediaType)}))}return H={initialize:function(tt,nt){tt.split(",").forEach(((dt,Gt,vt)=>{let Tt;if(dt.indexOf("(")!==-1&&dt.indexOf(")")===-1){let yt=vt[Gt+1];yt&&yt.indexOf("(")===-1&&yt.indexOf(")")!==-1&&(dt+=","+yt,delete vt[Gt+1])}Tt=Ue.create(dt,nt),Tt&&De.push(Tt)})),qe.on(Fe.METRIC_ADDED,Ke,H),qe.on(Fe.METRIC_UPDATED,Ke,H)},reset:function(){qe.off(Fe.METRIC_ADDED,Ke,H),qe.off(Fe.METRIC_UPDATED,Ke,H),De.forEach((tt=>tt.reset())),De=[]}},H}$e.__dashjs_factory_name="MetricsHandlersController";var He=c.default.getClassFactory($e);function et(ne){let H,De,Ye,qe;ne=ne||{};let Fe=this.context;function Ue(){H&&H.reset(),De&&De.reset(),Ye&&Ye.reset()}return qe={initialize:function(Ke){try{Ye=u(Fe).create({mediaElement:ne.mediaElement}),Ye.initialize(Ke.Range),De=ye(Fe).create({debug:ne.debug,metricsConstants:ne.metricsConstants,mediaPlayerModel:ne.mediaPlayerModel}),De.initialize(Ke.Reporting,Ye),H=He(Fe).create({debug:ne.debug,eventBus:ne.eventBus,metricsConstants:ne.metricsConstants,events:ne.events}),H.initialize(Ke.metrics,De)}catch(tt){throw Ue(),tt}},reset:Ue},qe}et.__dashjs_factory_name="MetricsController";var Ve=c.default.getClassFactory(et),Et=class{constructor(){this.metrics="",this.Range=[],this.Reporting=[]}},Nt=class{constructor(){this.starttime=0,this.duration=1/0,this._useWallClockTime=!1}},$t=class{constructor(){this.schemeIdUri="",this.value="",this.dvbReportingUrl="",this.dvbProbability=1e3}};function Ie(ne){let H,De=(ne=ne||{}).adapter;const Ye=ne.constants;return H={getMetrics:function(qe){let Fe=[];return qe&&qe.Metrics&&qe.Metrics.forEach((Ue=>{var Ke=new Et,tt=De.getIsDynamic(qe);Ue.hasOwnProperty("metrics")&&(Ke.metrics=Ue.metrics,Ue.Range&&Ue.Range.forEach((nt=>{var dt=new Nt;dt.starttime=(function(Gt,vt,Tt){let yt,Zt,_n=0;return vt?_n=De.getAvailabilityStartTime(Gt)/1e3:(yt=De.getRegularPeriods(Gt),yt.length&&(_n=yt[0].start)),Zt=_n,Tt&&Tt.hasOwnProperty(Ye.START_TIME)&&(Zt+=Tt.starttime),Zt})(qe,tt,nt),nt.hasOwnProperty("duration")?dt.duration=nt.duration:dt.duration=De.getDuration(qe),dt._useWallClockTime=tt,Ke.Range.push(dt)})),Ue.Reporting&&(Ue.Reporting.forEach((nt=>{var dt=new $t;nt.hasOwnProperty(Ye.SCHEME_ID_URI)&&(dt.schemeIdUri=nt.schemeIdUri,nt.hasOwnProperty("value")&&(dt.value=nt.value),nt.hasOwnProperty(Ye.DVB_REPORTING_URL)&&(dt.dvbReportingUrl=nt[Ye.DVB_REPORTING_URL]),nt.hasOwnProperty(Ye.DVB_PROBABILITY)&&(dt.dvbProbability=nt[Ye.DVB_PROBABILITY]),Ke.Reporting.push(dt))})),Fe.push(Ke)))})),Fe}},H}Ie.__dashjs_factory_name="ManifestParsing";var pe=c.default.getSingletonFactory(Ie);function Be(ne){let H;ne=ne||{};let De={},Ye=this.context,qe=ne.eventBus;const Fe=ne.events;function Ue(tt){if(tt.error)return;let nt=Object.keys(De);pe(Ye).getInstance({adapter:ne.adapter,constants:ne.constants}).getMetrics(tt.manifest).forEach((dt=>{const Gt=JSON.stringify(dt);if(De.hasOwnProperty(Gt))nt.splice(Gt,1);else try{let vt=Ve(Ye).create(ne);vt.initialize(dt),De[Gt]=vt}catch{}})),nt.forEach((dt=>{De[dt].reset(),delete De[dt]})),qe.trigger(i.default.METRICS_INITIALISATION_COMPLETE)}function Ke(){Object.keys(De).forEach((tt=>{De[tt].reset()})),De={}}return H={reset:function(){qe.off(Fe.MANIFEST_UPDATED,Ue,H),qe.off(Fe.STREAM_TEARDOWN_COMPLETE,Ke,H)}},qe.on(Fe.MANIFEST_UPDATED,Ue,H),qe.on(Fe.STREAM_TEARDOWN_COMPLETE,Ke,H),H}Be.__dashjs_factory_name="MetricsCollectionController";var O=c.default.getClassFactory(Be);function z(){let ne,H,De=this.context;return ne={createMetricsReporting:function(Ye){return H=f(De).getInstance({eventBus:Ye.eventBus,dashMetrics:Ye.dashMetrics,metricsConstants:Ye.metricsConstants,events:Ye.events}),H.initialize(),O(De).create(Ye)},getReportingFactory:function(){return W(De).getInstance()},getMetricsHandlerFactory:function(){return Pe(De).getInstance()}},ne}z.__dashjs_factory_name="MetricsReporting";const k=c.default.getClassFactory(z);k.events=i.default,c.default.updateClassFactory(z.__dashjs_factory_name,k);var L=k},913:function(o,e,t){t.r(e);var n=t(7252);class r extends n.default{constructor(){super(),this.METRICS_INITIALISATION_COMPLETE="internal_metricsReportingInitialized",this.BECAME_REPORTING_PLAYER="internal_becameReportingPlayer",this.CMCD_DATA_GENERATED="cmcdDataGenerated"}}let i=new r;e.default=i},1926:function(o,e,t){t.r(e);var n=t(5717),r=t(138),i=t(8261),c=t(656),h=t(5212),f=t(5560);function g(){let y,u,l,d,m,E,S,_,M,R,W;const fe=this.context,ye=(0,i.default)(fe).getInstance();function Y(){d=[],m=[],E=[],S=[],_=[],W=[],M=null,u=[],R=new Set}function j(de,we){let ce=-1;de.some(((he,Pe)=>{if(he===we)return ce=Pe,!0})),ce<0||de.splice(ce,1)}function se(de){let we;for(we=0;we<W.length;we++)if(W[we].rulename===de)return we;return-1}function Te(de,we){let ce=!1;return R.forEach((he=>{he[de]===we&&(ce=!0)})),ce}function Ae(de,we){ze(de,we);let ce=new n.default;ce.schemeIdUri=de,ce.value=we,u.push(ce)}function ze(de,we){(0,c.checkParameterType)(de,"string"),(0,c.checkParameterType)(we,"string"),u.forEach((function(ce,he){ce.schemeIdUri===de&&ce.value===we&&u.splice(he,1)}))}return y={addAbrCustomRule:function(de,we,ce){if(typeof de!="string"||de!==h.default.RULES_TYPES.ABANDON_FRAGMENT_RULES&&de!==h.default.RULES_TYPES.QUALITY_SWITCH_RULES||typeof we!="string")throw h.default.BAD_ARGUMENT_ERROR;let he=se(we);he===-1?W.push({type:de,rulename:we,rule:ce}):(W[he].type=de,W[he].rule=ce)},addExternalSubtitle:function(de){if(!(de&&de.id!==void 0&&de.url&&de.language&&de.mimeType&&de.bandwidth!==void 0))return;const we=new f.default(de);Te("url",we.url)||Te("id",we.id)||R.add(we)},addRequestInterceptor:function(de){d.push(de)},addResponseInterceptor:function(de){m.push(de)},addUTCTimingSource:Ae,clearDefaultUTCTimingSources:function(){u=[]},getAbrCustomRules:function(){return W},getCustomCapabilitiesFilters:function(){return _},getCustomInitialTrackSelectionFunction:function(){return M},getExternalSubtitles:function(){return R},getLicenseRequestFilters:function(){return E},getLicenseResponseFilters:function(){return S},getRequestInterceptors:function(){return d},getResponseInterceptors:function(){return m},getUTCTimingSources:function(){return u},getXHRWithCredentialsForType:function(de){const we=l[de];return we===void 0?l.default:we},registerCustomCapabilitiesFilter:function(de){_.push(de)},registerLicenseRequestFilter:function(de){E.push(de)},registerLicenseResponseFilter:function(de){S.push(de)},removeAbrCustomRule:function(de){if(de){let we=se(de);we!==-1&&W.splice(we,1)}else W=[]},removeAllAbrCustomRule:function(){W=[]},removeExternalSubtitleById:function(de){R.forEach((we=>{we.id===de&&R.delete(we)}))},removeExternalSubtitleByUrl:function(de){R.forEach((we=>{we.url===de&&R.delete(we)}))},removeRequestInterceptor:function(de){j(d,de)},removeResponseInterceptor:function(de){j(m,de)},removeUTCTimingSource:ze,reset:function(){Y()},resetCustomInitialTrackSelectionFunction:function(){M=null},resetPlaybackSessionSpecificSettings:function(){R=new Set},restoreDefaultUTCTimingSources:function(){let de=ye.get().streaming.utcSynchronization.defaultTimingSource;Ae(de.scheme,de.value)},setConfig:function(){},setCustomInitialTrackSelectionFunction:function(de){M=de},setXHRWithCredentialsForType:function de(we,ce){we?l[we]=!!ce:Object.keys(l).forEach((he=>{de(he,ce)}))},unregisterCustomCapabilitiesFilter:function(de){j(_,de)},unregisterLicenseRequestFilter:function(de){j(E,de)},unregisterLicenseResponseFilter:function(de){j(S,de)}},l={default:!1},Y(),y}g.__dashjs_factory_name="CustomParametersModel",e.default=r.default.getSingletonFactory(g)},3888:function(o,e,t){t.r(e),t.d(e,{default:function(){return Rn}});var n=t(8854),r=t(2861);const i={prefixes:["clearkey","dashif","ck"]};class c{static findMp4ProtectionElement(st){let it=null;for(let lt=0;lt<st.length;++lt){let ft=st[lt];ft.schemeIdUri&&ft.schemeIdUri.toLowerCase()===n.default.MP4_PROTECTION_SCHEME&&ft.value&&(ft.value.toLowerCase()===r.default.ENCRYPTION_SCHEME_CENC||ft.value.toLowerCase()===r.default.ENCRYPTION_SCHEME_CBCS)&&(it=ft)}return it}static getPSSHData(st){let it=8,lt=new DataView(st),ft=lt.getUint8(it);return it+=20,ft>0&&(it+=4+16*lt.getUint32(it)),it+=4,st.slice(it)}static getPSSHForKeySystem(st,it){let lt=c.parsePSSHList(it);return st&&lt.hasOwnProperty(st.uuid.toLowerCase())?lt[st.uuid.toLowerCase()]:null}static parseInitDataFromContentProtection(st,it){return"pssh"in st&&st.pssh?(st.pssh.__text=st.pssh.__text.replace(/\r?\n|\r/g,"").replace(/\s+/g,""),it.decodeArray(st.pssh.__text).buffer):null}static parsePSSHList(st){if(st==null)return[];let it=new DataView(st.buffer||st),lt={},ft=0;for(;;){let kt,Ot,Ft,It,Ct,jt,Yt=ft;if(ft>=it.buffer.byteLength)break;if(kt=it.getUint32(ft),Ot=ft+kt,ft+=4,it.getUint32(ft)===1886614376)if(ft+=4,Ft=it.getUint8(ft),Ft===0||Ft===1){for(ft++,ft+=3,It="",Ct=0;Ct<4;Ct++)jt=it.getUint8(ft+Ct).toString(16),It+=jt.length===1?"0"+jt:jt;for(ft+=4,It+="-",Ct=0;Ct<2;Ct++)jt=it.getUint8(ft+Ct).toString(16),It+=jt.length===1?"0"+jt:jt;for(ft+=2,It+="-",Ct=0;Ct<2;Ct++)jt=it.getUint8(ft+Ct).toString(16),It+=jt.length===1?"0"+jt:jt;for(ft+=2,It+="-",Ct=0;Ct<2;Ct++)jt=it.getUint8(ft+Ct).toString(16),It+=jt.length===1?"0"+jt:jt;for(ft+=2,It+="-",Ct=0;Ct<6;Ct++)jt=it.getUint8(ft+Ct).toString(16),It+=jt.length===1?"0"+jt:jt;ft+=6,It=It.toLowerCase(),ft+=4,lt[It]=it.buffer.slice(Yt,Ot),ft=Ot}else ft=Ot;else ft=Ot}return lt}static getLicenseServerUrlFromMediaInfo(st,it){try{if(!st||st.length===0)return null;let lt=0,ft=null;for(;lt<st.length&&!ft;){const kt=st[lt];if(kt&&kt.contentProtection&&kt.contentProtection.length>0){const Ot=kt.contentProtection.filter((Ft=>Ft.schemeIdUri&&Ft.schemeIdUri===it));if(Ot&&Ot.length>0){let Ft=0;for(;Ft<Ot.length&&!ft;){const It=Ot[Ft];It.laUrl&&It.laUrl.__prefix&&i.prefixes.includes(It.laUrl.__prefix)&&It.laUrl.__text&&(ft=It.laUrl.__text),Ft+=1}}}lt+=1}return ft}catch{return null}}static hexKidToBufferSource(st){const it=st.replace(/-/g,"");return new Uint8Array(it.match(/[\da-f]{2}/gi).map((function(lt){return parseInt(lt,16)}))).buffer}}var h=c,f=class{constructor(mt,st){this.contentType=mt,this.robustness=st}},g=class{constructor(mt,st,it,lt,ft,kt){this.initDataTypes=kt&&kt.length>0?kt:[r.default.INITIALIZATION_DATA_TYPE_CENC],mt&&mt.length&&(this.audioCapabilities=mt),st&&st.length&&(this.videoCapabilities=st),this.distinctiveIdentifier=it,this.persistentState=lt,this.sessionTypes=ft}},y=t(1923),u=t(1944),l=class{constructor(mt,st,it,lt,ft,kt,Ot,Ft){this.url=mt,this.method=st,this.responseType=it,this.headers=lt,this.withCredentials=ft,this.messageType=kt,this.sessionId=Ot,this.data=Ft}},d=class{constructor(mt,st,it){this.url=mt,this.headers=st,this.data=it}},m=t(7568),E=t(7263),S=t(5212),_=t(138);function M(mt){const st=(mt=mt||{}).BASE64,it=mt.cmcdModel,lt=mt.constants,ft=mt.customParametersModel,kt=mt.debug,Ot=mt.eventBus,Ft=mt.events,It=mt.protectionKeyController,Ct=mt.settings;let jt,Yt,Mt,tn,hn,un,an,Pn,Bt,ct,at,qt,Qt=mt.protectionModel,fn=[];function Nn(){if(!(Ot&&Ot.hasOwnProperty("on")&&It&&It.hasOwnProperty("getSupportedKeySystemMetadataFromContentProtection")))throw new Error("Missing config parameter(s)")}function Mn(Dt,Xt){at||tn?at&&ra():(function(rn,Ln){if(tn)return;var In;tn=!0;const Un=(function(Fn){const zn=[];for(let xn=0;xn<Fn.length;xn++){const Yn=qn(Fn[xn]);zn.push({ks:Fn[xn].ks,configs:[Yn],protData:Fn[xn].protData})}return zn})(rn=(In=rn).sort(((Fn,zn)=>(jt&&jt[Fn.ks.systemString]&&jt[Fn.ks.systemString].priority>=0?jt[Fn.ks.systemString].priority:In.length)-(jt&&jt[zn.ks.systemString]&&jt[zn.ks.systemString].priority>=0?jt[zn.ks.systemString].priority:In.length))));let $n;Qt.requestKeySystemAccess(Un).then((Fn=>($n=Fn.data,(function(zn){let xn=zn&&zn.selectedSystemString?zn.selectedSystemString:zn.keySystem.systemString;return an.info("DRM: KeySystem Access Granted for system string ("+xn+")!  Selecting key system..."),Qt.selectKeySystem(zn)})($n)))).then((Fn=>{(function(zn,xn){try{at=zn,tn=!1,Ot.trigger(Ft.KEY_SYSTEM_SELECTED,{data:xn});const Yn=ia(at);Yn&&Yn.serverCertificate&&Yn.serverCertificate.length>0&&Qt.setServerCertificate(st.decodeArray(Yn.serverCertificate).buffer),ra()}catch(Yn){an.error(Yn)}})(Fn,$n)})).catch((Fn=>{(function(zn,xn){at=null,tn=!1,xn||Ot.trigger(Ft.KEY_SYSTEM_SELECTED,{data:null,error:new u.default(y.default.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE,y.default.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE+"Error selecting key system! -- "+zn.error)})})(Fn,Ln)}))})(Dt,Xt)}function ra(){let Dt;for(let rn=0;rn<Bt.length;rn++)for(Dt=0;Dt<Bt[rn].length;Dt++)if(at===Bt[rn][Dt].ks){Xt=Bt[rn][Dt],It.isClearKey(at)&&(function(Ln){if(Ln.protData&&Ln.protData.hasOwnProperty("clearkeys")&&Object.keys(Ln.protData.clearkeys).length!==0){const In={kids:Object.keys(Ln.protData.clearkeys)};Ln.initData=new TextEncoder().encode(JSON.stringify(In))}})(Xt),Xt.sessionId?Xn(Xt):Xt.initData!==null&&Se(Xt);break}var Xt;Bt=[]}function qn(Dt){const Xt=Dt.protData,rn=[],Ln=[],In=Xt&&Xt.initDataTypes&&Xt.initDataTypes.length>0?Xt.initDataTypes:[r.default.INITIALIZATION_DATA_TYPE_CENC],Un=Xt&&Xt.audioRobustness&&Xt.audioRobustness.length>0?Xt.audioRobustness:ct,$n=Xt&&Xt.videoRobustness&&Xt.videoRobustness.length>0?Xt.videoRobustness:ct,Fn=Dt.sessionType,zn=Xt&&Xt.distinctiveIdentifier?Xt.distinctiveIdentifier:"optional",xn=Xt&&Xt.persistentState?Xt.persistentState:Fn==="temporary"?"optional":"required";return Pn.forEach((Yn=>{Yn.type===lt.AUDIO?rn.push(new f(Yn.codec,Un)):Yn.type===lt.VIDEO&&Ln.push(new f(Yn.codec,$n))})),new g(rn,Ln,zn,xn,[Fn],In)}function Xn(Dt){Nn(),Qt.loadKeySession(Dt)}function Se(Dt){if(Dt&&(function(rn){if(!rn)return!1;try{const Ln=Qt.getSessionTokens();for(let In=0;In<Ln.length;In++)if(Ln[In].getKeyId()===rn)return!0;return!1}catch{return!1}})(Dt.keyId))return;(function(){if(!Ct)return;const rn=Ct.get().streaming.protection.keepProtectionMediaKeys,Ln=Ct.get().streaming.protection.keepProtectionMediaKeysMaximumOpenSessions;if(typeof Ln!="number"||Ln<=0)return;if(!rn)return void an.warn("DRM: keepProtectionMediaKeysMaximumOpenSessions is set to "+Ln+", but keepProtectionMediaKeys is not enabled. Therefore, keepProtectionMediaKeysMaximumOpenSessions will be ignored.");if(!Qt||typeof Qt.getSessionTokens!="function")return;const In=Qt.getSessionTokens()||[];if(In.length<Ln)return;const Un=In[0];Un&&(an.info("DRM: Maximum number of open MediaKeySessions reached ("+Ln+"), closing oldest session."),Da(Un))})();const Xt=h.getPSSHForKeySystem(at,Dt?Dt.initData:null);if(Xt){if(ca(Xt))return;try{Dt.initData=Xt,Qt.createKeySession(Dt)}catch(rn){Ot.trigger(Ft.KEY_SESSION_CREATED,{data:null,error:new u.default(y.default.KEY_SESSION_CREATED_ERROR_CODE,y.default.KEY_SESSION_CREATED_ERROR_MESSAGE+rn.message)})}}else Dt&&Dt.initData?Qt.createKeySession(Dt):Ot.trigger(Ft.KEY_SESSION_CREATED,{data:null,error:new u.default(y.default.KEY_SESSION_CREATED_ERROR_CODE,y.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Selected key system is "+(at?at.systemString:null)+".  needkey/encrypted event contains no initData corresponding to that key system!")})}function ia(Dt){if(Dt){const Xt=Dt.systemString;if(jt)return Xt in jt?jt[Xt]:null}return null}function ca(Dt){if(!Dt)return!1;try{const Xt=Qt.getAllInitData();for(let rn=0;rn<Xt.length;rn++)if(It.initDataEquals(Dt,Xt[rn]))return an.debug("DRM: Ignoring initData because we have already seen it!"),!0;return!1}catch{return!1}}function Da(Dt){Nn(),Qt.closeKeySession(Dt)}function sa(Dt){Nn(),Dt?(Qt.setMediaElement(Dt),Ot.on(Ft.NEED_KEY,_a,Yt)):Dt===null&&(Qt.setMediaElement(Dt),Ot.off(Ft.NEED_KEY,_a,Yt))}function Oa(Dt){an.debug("DRM: onKeyMessage");const Xt=Dt.data;Ot.trigger(Ft.KEY_MESSAGE,{data:Xt});const rn=Xt.messageType?Xt.messageType:r.default.MEDIA_KEY_MESSAGE_TYPES.LICENSE_REQUEST,Ln=Xt.message,In=Xt.sessionToken,Un=ia(at),$n=It.getLicenseServerModelInstance(at,Un,rn),Fn={sessionToken:In,messageType:rn};if(Ln&&Ln.byteLength!==0){if(!$n)return an.debug("DRM: License server request not required for this message (type = "+Dt.data.messageType+").  Session ID = "+In.getSessionId()),void da(Fn);if(It.isClearKey(at)){const zn=It.processClearKeyLicenseRequest(at,Un,Ln);if(zn&&zn.keyPairs&&zn.keyPairs.length>0)return an.debug("DRM: ClearKey license request handled by application!"),da(Fn),void Qt.updateKeySession(In,zn)}(function(zn,xn,Yn){const ma=zn.sessionToken,ga=zn.messageType?zn.messageType:r.default.MEDIA_KEY_MESSAGE_TYPES.LICENSE_REQUEST,Pa={sessionToken:ma,messageType:ga},Ga=at?at.systemString:null;let dr=(function(Wn,Sr,qr,Ua,Ji){let Sa=null;const Zi=Ua.message;if(Wn&&Wn.serverURL){const Ya=Wn.serverURL;typeof Ya=="string"&&Ya!==""?Sa=Ya:typeof Ya=="object"&&Ya.hasOwnProperty(Sr)&&(Sa=Ya[Sr])}else if(Wn&&Wn.laURL&&Wn.laURL!=="")Sa=Wn.laURL;else if(Sa=h.getLicenseServerUrlFromMediaInfo(Pn,at.schemeIdURI),!Sa&&!It.isClearKey(at)){const Ya=h.getPSSHData(qr.initData);Sa=at.getLicenseServerURLFromInitData(Ya),Sa||(Sa=Ua.laURL)}return Sa=Ji.getServerURLFromMessage(Sa,Zi,Sr),Sa})(Yn,ga,ma,zn,xn);if(!dr)return void da(Pa,new u.default(y.default.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE,y.default.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE));const za={};let Aa=!1;Yn&&wr(za,Yn.httpRequestHeaders);const Ar=zn.message;wr(za,at.getRequestHeadersFromMessage(Ar)),Object.keys(za).forEach((Wn=>{Wn.toLowerCase()==="authorization"&&(Aa=!0)})),Yn&&typeof Yn.withCredentials=="boolean"&&(Aa=Yn.withCredentials);const fa=function(Wn){if(Qt)if(Wn.status>=200&&Wn.status<=299){const Sr=E.default.parseHttpHeaders(Wn.getAllResponseHeaders?Wn.getAllResponseHeaders():null);let qr=new d(Wn.responseURL,Sr,Wn.response);_r(ft.getLicenseResponseFilters(),qr).then((()=>{const Ua=xn.getLicenseMessage(qr.data,Ga,ga);Ua!==null?(da(Pa),Qt.updateKeySession(ma,Ua)):La(Wn,Pa,Ga,ga,xn)}))}else La(Wn,Pa,Ga,ga,xn)},Wi=function(Wn){da(Pa,new u.default(y.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,y.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+Ga+' update, XHR aborted. status is "'+Wn.statusText+'" ('+Wn.status+"), readyState is "+Wn.readyState))},Vn=function(Wn){da(Pa,new u.default(y.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,y.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+Ga+' update, XHR error. status is "'+Wn.statusText+'" ('+Wn.status+"), readyState is "+Wn.readyState))},vi=at.getLicenseRequestFromMessage(Ar),Ti=xn.getHTTPMethod(ga),wi=xn.getResponseType(Ga,ga),_i=Yn&&!isNaN(Yn.httpTimeout)?Yn.httpTimeout:8e3,Qi=ma.getSessionId()||null;let Ai=new l(dr,Ti,wi,za,Aa,ga,Qi,vi);const Xi=isNaN(Ct.get().streaming.retryAttempts[m.HTTPRequest.LICENSE])?3:Ct.get().streaming.retryAttempts[m.HTTPRequest.LICENSE];_r(ft.getLicenseRequestFilters(),Ai).then((()=>{Fr(Ai,Xi,_i,fa,Wi,Vn)}))})(Xt,$n,Un)}else da(Fn,new u.default(y.default.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE,y.default.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE))}function da(Dt,Xt=null){Ot.trigger(Ft.LICENSE_REQUEST_COMPLETE,{data:Dt,error:Xt})}function Fr(Dt,Xt,rn,Ln,In,Un){const $n=new XMLHttpRequest,Fn=it.getCmcdParametersFromManifest();if(it.isCmcdEnabled()&&(Fn.mode?Fn.mode:Ct.get().streaming.cmcd.mode)===S.default.CMCD_MODE_QUERY){const xn=it.getQueryParameter({url:Dt.url,type:m.HTTPRequest.LICENSE});xn&&(Dt.url=E.default.addAdditionalQueryParameterToUrl(Dt.url,[xn]))}$n.open(Dt.method,Dt.url,!0),$n.responseType=Dt.responseType,$n.withCredentials=Dt.withCredentials,rn>0&&($n.timeout=rn);for(const xn in Dt.headers)$n.setRequestHeader(xn,Dt.headers[xn]);if(it.isCmcdEnabled()&&(Fn.mode?Fn.mode:Ct.get().streaming.cmcd.mode)===S.default.CMCD_MODE_HEADER){const xn=it.getHeaderParameters({url:Dt.url,type:m.HTTPRequest.LICENSE});if(xn)for(const Yn in xn){let ma=xn[Yn];ma&&$n.setRequestHeader(Yn,ma)}}const zn=function(){Xt--;const xn=isNaN(Ct.get().streaming.retryIntervals[m.HTTPRequest.LICENSE])?1e3:Ct.get().streaming.retryIntervals[m.HTTPRequest.LICENSE];hn=setTimeout((function(){Fr(Dt,Xt,rn,Ln,In,Un)}),xn)};$n.onload=function(){un=null,this.status>=200&&this.status<=299||Xt<=0?Ln(this):(an.warn("License request failed ("+this.status+"). Retrying it... Pending retries: "+Xt),zn())},$n.ontimeout=$n.onerror=function(){un=null,Xt<=0?Un(this):(an.warn("License request network request failed . Retrying it... Pending retries: "+Xt),zn())},$n.onabort=function(){In(this)},Ot.trigger(Ft.LICENSE_REQUEST_SENDING,{url:Dt.url,headers:Dt.headers,payload:Dt.data,sessionId:Dt.sessionId}),un=$n,$n.send(Dt.data)}function tr(){un&&(un.onloadend=un.onerror=un.onprogress=void 0,un.abort(),un=null),hn&&(clearTimeout(hn),hn=null)}function wr(Dt,Xt){if(Xt)for(const rn in Xt)Dt[rn]=Xt[rn]}function La(Dt,Xt,rn,Ln,In){let Un="NONE",$n=null;Dt.response&&(Un=In.getErrorResponse(Dt.response,rn,Ln),$n={serverResponse:Dt.response||null,responseCode:Dt.status||null,responseText:Dt.statusText||null}),da(Xt,new u.default(y.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,y.default.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+rn+' update, XHR complete. status is "'+Dt.statusText+'" ('+Dt.status+"), readyState is "+Dt.readyState+".  Response is "+Un,$n))}function _r(Dt,Xt){return Dt?Dt.reduce(((rn,Ln)=>rn.then((()=>Ln(Xt)))),Promise.resolve()):Promise.resolve()}function _a(Dt,Xt){if(Ct.get().streaming.protection.ignoreEmeEncryptedEvent)return;if(an.debug("DRM: onNeedKey"),Dt.key.initDataType!==r.default.INITIALIZATION_DATA_TYPE_CENC)return void an.warn("DRM:  Only 'cenc' initData is supported!  Ignoring initData of type: "+Dt.key.initDataType);if(Pn.length===0&&(an.warn("DRM: onNeedKey called before initializeForMedia, wait until initialized"),(Xt=Xt===void 0?1:Xt+1)<5))return void fn.push(setTimeout((()=>{_a(Dt,Xt)}),500));let rn=Dt.key.initData;if(ArrayBuffer.isView(rn)&&(rn=rn.buffer),at){const In=h.getPSSHForKeySystem(at,rn);if(In&&ca(In))return}an.debug("DRM: initData:",String.fromCharCode.apply(null,new Uint8Array(rn)));const Ln=It.getSupportedKeySystemMetadataFromSegmentPssh(rn,jt,qt);Ln.length!==0?(function(In){Bt.push(In),Mn(In,!1)})(Ln):an.debug("DRM: Received needkey event with initData, but we don't support any of the key systems!")}function ur(Dt,Xt){if(Dt.size<=0)return!1;if(Xt.size>0&&[...Dt].every((Ln=>{const In=Xt.get(Ln);return In!==void 0&&In!==""})))return!0;const rn=Qt.getSessionTokens();if(rn&&rn.length>0){const Ln=rn.filter((In=>[...Dt].includes(In.normalizedKeyId)));if(Ln.some((In=>!In.hasTriggeredKeyStatusMapUpdate))||Ln.length===0)return!1}return!Ct.get().streaming.protection.ignoreKeyStatuses&&Dt&&Dt.size>0&&Xt&&Xt.size>0}return Yt={areKeyIdsExpired:function(Dt){try{return!!ur(Dt,Mt)&&[...Dt].every((Xt=>Mt.get(Xt)===r.default.MEDIA_KEY_STATUSES.EXPIRED))}catch(Xt){return an.error(Xt),!1}},areKeyIdsUsable:function(Dt){try{return!ur(Dt,Mt)||[...Dt].some((Xt=>{const rn=Mt.get(Xt);return rn&&rn!==r.default.MEDIA_KEY_STATUSES.INTERNAL_ERROR&&rn!==r.default.MEDIA_KEY_STATUSES.OUTPUT_RESTRICTED}))}catch(Xt){return an.error(Xt),!0}},clearMediaInfoArray:function(){Pn=[]},closeKeySession:Da,createKeySession:Se,getKeySystems:function(){return It?It.getKeySystems():[]},getSupportedKeySystemMetadataFromContentProtection:function(Dt){return Nn(),It.getSupportedKeySystemMetadataFromContentProtection(Dt,jt,qt)},handleKeySystemFromManifest:function(){if(!Pn||Pn.length===0)return;let Dt=[];Pn.forEach((Xt=>{const rn=It.getSupportedKeySystemMetadataFromContentProtection(Xt.contentProtection,jt,qt);rn.length>0&&(Dt.length===0&&(Dt=rn),Bt.push(rn))})),Dt&&Dt.length>0&&Mn(Dt,!0)},initializeForMedia:function(Dt){if(!Dt)throw new Error("mediaInfo can not be null or undefined");Nn(),Pn.push(Dt)},loadKeySession:Xn,removeKeySession:function(Dt){Nn(),Qt.removeKeySession(Dt)},reset:function(){Ot.off(Ft.INTERNAL_KEY_MESSAGE,Oa,Yt),Nn(),tr(),sa(null),at=null,tn=!1,Mt=new Map,Qt&&(Qt.reset(),Qt=null),fn.forEach((Dt=>clearTimeout(Dt))),fn=[],Pn=[],Bt=[]},setKeySystems:function(Dt){It&&It.setKeySystems(Dt)},setMediaElement:sa,setProtectionData:function(Dt){jt=Dt,It.setProtectionData(Dt)},setRobustnessLevel:function(Dt){ct=Dt},setServerCertificate:function(Dt){return Nn(),Qt.setServerCertificate(Dt)},setSessionType:function(Dt){qt=Dt},stop:function(){tr(),Qt&&Qt.stop()},updateKeyStatusesMap:function(Dt){try{if(!Dt||!Dt.sessionToken||!Dt.parsedKeyStatuses)return;Dt.sessionToken.hasTriggeredKeyStatusMapUpdate=!0;const Xt=Dt.parsedKeyStatuses,rn=E.default.parseUserAgent(),Ln=rn&&rn.browser&&rn.browser.name&&rn.browser.name.toLowerCase()==="edge";Xt.forEach((In=>{Ln&&at.uuid===r.default.PLAYREADY_UUID&&In.keyId&&In.keyId.byteLength===16&&(function($n){const Fn=E.default.bufferSourceToDataView($n),zn=Fn.getUint32(0,!0),xn=Fn.getUint16(4,!0),Yn=Fn.getUint16(6,!0);Fn.setUint32(0,zn,!1),Fn.setUint16(4,xn,!1),Fn.setUint16(6,Yn,!1)})(In.keyId);const Un=E.default.bufferSourceToHex(In.keyId).slice(0,32);Un&&Un!==""&&Mt.set(Un,In.status)})),Ot.trigger(Ft.KEY_STATUSES_MAP_UPDATED,{keyStatusMap:Mt})}catch(Xt){an.error(Xt)}}},an=kt.getLogger(Yt),Bt=[],Pn=[],qt="temporary",ct="",un=null,hn=null,Mt=new Map,Ot.on(Ft.INTERNAL_KEY_MESSAGE,Oa,Yt),Yt}M.__dashjs_factory_name="ProtectionController";var R=_.default.getClassFactory(M),W=class{constructor(mt,st){this.keyID=mt,this.key=st}},fe=class{constructor(mt,st){if(st&&st!=="persistent"&&st!=="temporary")throw new Error("Invalid ClearKey key set type!  Must be one of 'persistent' or 'temporary'");this.keyPairs=mt,this.type=st}toJWK(){let mt,st=this.keyPairs.length,it={keys:[]};for(mt=0;mt<st;mt++){let Ft={kty:"oct",alg:"A128KW",kid:this.keyPairs[mt].keyID,k:this.keyPairs[mt].key};it.keys.push(Ft)}this.type&&(it.type=this.type);let lt=JSON.stringify(it);const ft=lt.length;let kt=new ArrayBuffer(ft),Ot=new Uint8Array(kt);for(mt=0;mt<ft;mt++)Ot[mt]=lt.charCodeAt(mt);return kt}};const ye=r.default.CLEARKEY_UUID,Y=r.default.CLEARKEY_KEYSTEM_STRING,j="urn:uuid:"+ye;function se(mt){let st;const it=(mt=mt||{}).BASE64;return st={uuid:ye,schemeIdURI:j,systemString:Y,getInitData:function(lt,ft){try{let kt=h.parseInitDataFromContentProtection(lt,it);if(!kt&&ft){const Ot={kids:[(function(Ft){try{let It=Ft.replace(/-/g,"");return It=btoa(It.match(/\w{2}/g).map((Ct=>String.fromCharCode(parseInt(Ct,16)))).join("")),It.replace(/=/g,"").replace(/\//g,"_").replace(/\+/g,"-")}catch{return null}})(ft.cencDefaultKid)]};kt=new TextEncoder().encode(JSON.stringify(Ot))}return kt}catch{return null}},getRequestHeadersFromMessage:function(){return{"Content-Type":"application/json"}},getLicenseRequestFromMessage:function(lt){return JSON.stringify(JSON.parse(String.fromCharCode.apply(null,new Uint8Array(lt))))},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getClearKeysFromProtectionData:function(lt,ft){let kt=null;if(lt){const Ot=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(ft))),Ft=[];for(let It=0;It<Ot.kids.length;It++){const Ct=Ot.kids[It],jt=lt.clearkeys&&lt.clearkeys.hasOwnProperty(Ct)?lt.clearkeys[Ct]:null;if(!jt)throw new Error("DRM: ClearKey keyID ("+Ct+") is not known!");Ft.push(new W(Ct,jt))}kt=new fe(Ft)}return kt}},st}se.__dashjs_factory_name="KeySystemClearKey";var Te=_.default.getSingletonFactory(se);const Ae=r.default.W3C_CLEARKEY_UUID,ze=r.default.CLEARKEY_KEYSTEM_STRING,de="urn:uuid:"+Ae;function we(mt){let st;const it=mt.BASE64,lt=mt.debug.getLogger(st);return st={uuid:Ae,schemeIdURI:de,systemString:ze,getInitData:function(ft){return h.parseInitDataFromContentProtection(ft,it)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(ft){return new Uint8Array(ft)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getClearKeysFromProtectionData:function(ft,kt){let Ot=null;if(ft){const Ft=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(kt))),It=[];for(let Ct=0;Ct<Ft.kids.length;Ct++){const jt=Ft.kids[Ct],Yt=ft.clearkeys&&ft.clearkeys.hasOwnProperty(jt)?ft.clearkeys[jt]:null;if(!Yt)throw new Error("DRM: ClearKey keyID ("+jt+") is not known!");It.push(new W(jt,Yt))}Ot=new fe(It),lt.warn("ClearKey schemeIdURI is using W3C Common PSSH systemID (1077efec-c0b2-4d02-ace3-3c1e52e2fb4b) in Content Protection. See DASH-IF IOP v4.1 section 7.6.2.4")}return Ot}},st}we.__dashjs_factory_name="KeySystemW3CClearKey";var ce=_.default.getSingletonFactory(we);const he=r.default.WIDEVINE_UUID,Pe=r.default.WIDEVINE_KEYSTEM_STRING,$e="urn:uuid:"+he;function He(mt){let st;const it=(mt=mt||{}).BASE64;return st={uuid:he,schemeIdURI:$e,systemString:Pe,getInitData:function(lt){return h.parseInitDataFromContentProtection(lt,it)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(lt){return new Uint8Array(lt)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null}},st}He.__dashjs_factory_name="KeySystemWidevine";var et=_.default.getSingletonFactory(He);const Ve=r.default.PLAYREADY_UUID,Et=r.default.PLAYREADY_KEYSTEM_STRING,Nt="urn:uuid:"+Ve;function $t(mt){let st,it="utf-16";const lt=(mt=mt||{}).BASE64,ft=mt.settings;function kt(){if(!lt||!lt.hasOwnProperty("decodeArray")||!lt.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}return st={uuid:Ve,schemeIdURI:Nt,systemString:Et,getInitData:function(Ot){const Ft=new Uint8Array([112,115,115,104,0,0,0,0]),It=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);let Ct,jt,Yt,Mt,tn,hn=0,un=null;if(kt(),!Ot)return null;if("pssh"in Ot&&Ot.pssh)return h.parseInitDataFromContentProtection(Ot,lt);if("pro"in Ot&&Ot.pro)un=lt.decodeArray(Ot.pro.__text);else{if(!("prheader"in Ot)||!Ot.prheader)return null;un=lt.decodeArray(Ot.prheader.__text)}return Ct=un.length,jt=4+Ft.length+It.length+4+Ct,Yt=new ArrayBuffer(jt),Mt=new Uint8Array(Yt),tn=new DataView(Yt),tn.setUint32(hn,jt),hn+=4,Mt.set(Ft,hn),hn+=Ft.length,Mt.set(It,hn),hn+=It.length,tn.setUint32(hn,Ct),hn+=4,Mt.set(un,hn),hn+=Ct,Mt.buffer},getRequestHeadersFromMessage:function(Ot){let Ft,It;const Ct={},jt=new DOMParser;if(ft&&ft.get().streaming.protection.detectPlayreadyMessageFormat&&it==="utf-16"&&Ot&&Ot.byteLength%2==1)return Ct["Content-Type"]="text/xml; charset=utf-8",Ct;const Yt=it==="utf-16"?new Uint16Array(Ot):new Uint8Array(Ot);Ft=String.fromCharCode.apply(null,Yt),It=jt.parseFromString(Ft,"application/xml");const Mt=It.getElementsByTagName("name"),tn=It.getElementsByTagName("value");for(let hn=0;hn<Mt.length;hn++)Ct[Mt[hn].childNodes[0].nodeValue]=tn[hn].childNodes[0].nodeValue;return Ct.hasOwnProperty("Content")&&(Ct["Content-Type"]=Ct.Content,delete Ct.Content),Ct.hasOwnProperty("Content-Type")||(Ct["Content-Type"]="text/xml; charset=utf-8"),Ct},getLicenseRequestFromMessage:function(Ot){let Ft=null;const It=new DOMParser;if(ft&&ft.get().streaming.protection.detectPlayreadyMessageFormat&&it==="utf-16"&&Ot&&Ot.byteLength%2==1)return Ot;const Ct=it==="utf-16"?new Uint16Array(Ot):new Uint8Array(Ot);kt();const jt=String.fromCharCode.apply(null,Ct),Yt=It.parseFromString(jt,"application/xml");if(!Yt.getElementsByTagName("PlayReadyKeyMessage")[0])return Ot;{const Mt=Yt.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;Mt&&(Ft=lt.decode(Mt))}return Ft},getLicenseServerURLFromInitData:function(Ot){if(Ot){const Ft=new DataView(Ot),It=Ft.getUint16(4,!0);let Ct=6;const jt=new DOMParser;for(let Yt=0;Yt<It;Yt++){const Mt=Ft.getUint16(Ct,!0);Ct+=2;const tn=Ft.getUint16(Ct,!0);if(Ct+=2,Mt!==1){Ct+=tn;continue}const hn=Ot.slice(Ct,Ct+tn),un=String.fromCharCode.apply(null,new Uint16Array(hn)),an=jt.parseFromString(un,"application/xml");if(an.getElementsByTagName("LA_URL")[0]){const Pn=an.getElementsByTagName("LA_URL")[0].childNodes[0].nodeValue;if(Pn)return Pn}if(an.getElementsByTagName("LUI_URL")[0]){const Pn=an.getElementsByTagName("LUI_URL")[0].childNodes[0].nodeValue;if(Pn)return Pn}}}return null},getCDMData:function(Ot){let Ft,It,Ct,jt;if(kt(),!Ot)return null;for(Ft=[],jt=0;jt<Ot.length;++jt)Ft.push(Ot.charCodeAt(jt)),Ft.push(0);for(Ft=String.fromCharCode.apply(null,Ft),Ft=lt.encode(Ft),It='<PlayReadyCDMData type="LicenseAcquisition"><LicenseAcquisition version="1.0" Proactive="false"><CustomData encoding="base64encoded">%CUSTOMDATA%</CustomData></LicenseAcquisition></PlayReadyCDMData>'.replace("%CUSTOMDATA%",Ft),Ct=[],jt=0;jt<It.length;++jt)Ct.push(It.charCodeAt(jt)),Ct.push(0);return new Uint8Array(Ct).buffer},setPlayReadyMessageFormat:function(Ot){if(Ot!=="utf-8"&&Ot!=="utf-16")throw new Error('Specified message format is not one of "utf-8" or "utf-16"');it=Ot}},st}$t.__dashjs_factory_name="KeySystemPlayReady";var Ie=_.default.getSingletonFactory($t);function pe(mt){const st=(mt=mt||{}).BASE64,it={};let lt;return it[r.default.WIDEVINE_KEYSTEM_STRING]={responseType:"json",getLicenseMessage:function(ft){return st.decodeArray(ft.license)},getErrorResponse:function(ft){return ft}},it[r.default.PLAYREADY_KEYSTEM_STRING]={responseType:"arraybuffer",getLicenseMessage:function(ft){return ft},getErrorResponse:function(ft){return String.fromCharCode.apply(null,new Uint8Array(ft))}},lt={getServerURLFromMessage:function(ft){return ft},getHTTPMethod:function(){return"POST"},getResponseType:function(ft){return it[ft].responseType},getLicenseMessage:function(ft,kt){return(function(){if(!st||!st.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")})(),it[kt].getLicenseMessage(ft)},getErrorResponse:function(ft,kt){return it[kt].getErrorResponse(ft)}},lt}pe.__dashjs_factory_name="DRMToday";var Be=_.default.getSingletonFactory(pe);function O(){let mt;const st="http://schemas.xmlsoap.org/soap/envelope/";function it(kt){const Ot=String.fromCharCode.apply(null,new Uint8Array(kt));return decodeURIComponent(escape(Ot))}function lt(kt){if(window.DOMParser){const Ot=it(kt),Ft=new window.DOMParser().parseFromString(Ot,"text/xml"),It=Ft?Ft.getElementsByTagNameNS(st,"Envelope")[0]:null,Ct=It?It.getElementsByTagNameNS(st,"Body")[0]:null;if(Ct&&Ct.getElementsByTagNameNS(st,"Fault")[0])return null}return kt}function ft(kt){let Ot="",Ft="",It="",Ct=-1,jt=-1;if(window.DOMParser){const Mt=it(kt),tn=new window.DOMParser().parseFromString(Mt,"text/xml"),hn=tn?tn.getElementsByTagNameNS(st,"Envelope")[0]:null,un=hn?hn.getElementsByTagNameNS(st,"Body")[0]:null,an=un?un.getElementsByTagNameNS(st,"Fault")[0]:null,Pn=an?an.getElementsByTagName("detail")[0]:null,Bt=Pn?Pn.getElementsByTagName("Exception")[0]:null;let ct=null;if(an===null)return Mt;ct=an.getElementsByTagName("faultstring")[0].firstChild,Ot=ct?ct.nodeValue:null,Bt!==null&&(ct=Bt.getElementsByTagName("StatusCode")[0],Ft=ct?ct.firstChild.nodeValue:null,ct=Bt.getElementsByTagName("Message")[0],It=ct?ct.firstChild.nodeValue:null,Ct=It?It.lastIndexOf("[")+1:-1,jt=It?It.indexOf("]"):-1,It=It?It.substring(Ct,jt):"")}let Yt=`code: ${Ft}, name: ${Ot}`;return It&&(Yt+=`, message: ${It}`),Yt}return mt={getServerURLFromMessage:function(kt){return kt},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(kt){return lt.call(this,kt)},getErrorResponse:function(kt){return ft.call(this,kt)}},mt}O.__dashjs_factory_name="PlayReady";var z=_.default.getSingletonFactory(O);function k(){let mt;return mt={getServerURLFromMessage:function(st){return st},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(st){return st},getErrorResponse:function(st){return String.fromCharCode.apply(null,new Uint8Array(st))}},mt}k.__dashjs_factory_name="Widevine";var L=_.default.getSingletonFactory(k);function ne(){let mt;return mt={getServerURLFromMessage:function(st){return st},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"json"},getLicenseMessage:function(st){if(!st.hasOwnProperty("keys"))return null;let it=[];for(let lt=0;lt<st.keys.length;lt++){let ft=st.keys[lt],kt=ft.kid.replace(/=/g,""),Ot=ft.k.replace(/=/g,"");it.push(new W(kt,Ot))}return new fe(it)},getErrorResponse:function(st){return String.fromCharCode.apply(null,new Uint8Array(st))}},mt}ne.__dashjs_factory_name="ClearKey";var H=_.default.getSingletonFactory(ne),De=class{constructor(mt){this.ks=mt.ks,this.keyId=mt.keyId,this.initData=mt.initData,this.protData=mt.protData,this.cdmData=mt.cdmData,this.sessionId=mt.sessionId,this.sessionType=mt.sessionType}};function Ye(){let mt,st,it,lt,ft,kt,Ot,Ft,It=this.context;function Ct(Mt,tn){return tn&&Mt in tn?tn[Mt]:null}function jt(Mt,tn){return Mt&&Mt.sessionId?Mt.sessionId:tn&&tn.sessionId?tn.sessionId:null}function Yt(Mt,tn){return Mt&&Mt.sessionType?Mt.sessionType:tn}return mt={getKeySystemBySystemString:function(Mt){for(let tn=0;tn<lt.length;tn++)if(lt[tn].systemString===Mt)return lt[tn];return null},getKeySystems:function(){return lt},getLicenseServerModelInstance:function(Mt,tn,hn){if(hn===r.default.MEDIA_KEY_MESSAGE_TYPES.LICENSE_RELEASE||hn===r.default.MEDIA_KEY_MESSAGE_TYPES.INDIVIDUALIZATION_REQUEST)return null;let un=null;return tn&&tn.hasOwnProperty("drmtoday")?un=Be(It).getInstance({BASE64:ft}):Mt.systemString===r.default.WIDEVINE_KEYSTEM_STRING?un=L(It).getInstance():Mt.systemString===r.default.PLAYREADY_KEYSTEM_STRING?un=z(It).getInstance():Mt.systemString===r.default.CLEARKEY_KEYSTEM_STRING&&(un=H(It).getInstance()),un},getSupportedKeySystemMetadataFromContentProtection:function(Mt,tn,hn){let un,an,Pn,Bt,ct=[];if(!Mt||!Mt.length)return ct;const at=h.findMp4ProtectionElement(Mt);for(Pn=0;Pn<lt.length;Pn++){an=lt[Pn];const qt=Ct(an.systemString,tn);for(Bt=0;Bt<Mt.length;Bt++)if(un=Mt[Bt],un.schemeIdUri.toLowerCase()===an.schemeIdURI){let Qt=an.getInitData(un,at);const fn=new De({ks:lt[Pn],keyId:un.keyId,initData:Qt,protData:qt,cdmData:an.getCDMData(qt?qt.cdmData:null),sessionId:jt(qt,un),sessionType:Yt(qt,hn)});qt?ct.unshift(fn):ct.push(fn)}}return ct},getSupportedKeySystemMetadataFromSegmentPssh:function(Mt,tn,hn){let un,an,Pn=[],Bt=h.parsePSSHList(Mt);for(let ct=0;ct<lt.length;++ct){un=lt[ct],an=un.systemString;const at=Ct(an,tn);un.uuid in Bt&&Pn.push({ks:un,initData:Bt[un.uuid],protData:at,cdmData:un.getCDMData(at?at.cdmData:null),sessionId:jt(at),sessionType:Yt(at,hn)})}return Pn},initDataEquals:function(Mt,tn){if(Mt.byteLength===tn.byteLength){let hn=new Uint8Array(Mt),un=new Uint8Array(tn);for(let an=0;an<hn.length;an++)if(hn[an]!==un[an])return!1;return!0}return!1},initialize:function(){let Mt;lt=[],Mt=Ie(It).getInstance({BASE64:ft,settings:kt}),lt.push(Mt),Mt=et(It).getInstance({BASE64:ft}),lt.push(Mt),Mt=Te(It).getInstance({BASE64:ft}),lt.push(Mt),Ot=Mt,Mt=ce(It).getInstance({BASE64:ft,debug:st}),lt.push(Mt),Ft=Mt},isClearKey:function(Mt){return Mt===Ot||Mt===Ft},processClearKeyLicenseRequest:function(Mt,tn,hn){try{return Mt.getClearKeysFromProtectionData(tn,hn)}catch{return it.error("Failed to retrieve clearkeys from ProtectionData"),null}},setConfig:function(Mt){Mt&&(Mt.debug&&(st=Mt.debug,it=st.getLogger(mt)),Mt.BASE64&&(ft=Mt.BASE64),Mt.settings&&(kt=Mt.settings))},setKeySystems:function(Mt){lt=Mt},setProtectionData:function(Mt){for(var tn,hn,un=0;un<lt.length;un++){var an=lt[un];an.hasOwnProperty("init")&&an.init((tn=an.systemString,hn=void 0,hn=null,Mt&&(hn=tn in Mt?Mt[tn]:null),hn))}}},mt}Ye.__dashjs_factory_name="ProtectionKeyController";var qe=_.default.getSingletonFactory(Ye),Fe=t(445),Ue=class{constructor(mt,st){this.initData=mt,this.initDataType=st}},Ke=class{constructor(mt,st,it,lt){this.sessionToken=mt,this.message=st,this.defaultURL=it,this.messageType=lt||r.default.MEDIA_KEY_MESSAGE_TYPES.LICENSE_REQUEST}},tt=class{constructor(mt,st){this.keySystem=mt,this.ksConfiguration=st,this.nativeMediaKeySystemAccessObject=null,this.selectedSystemString=null}};const nt={};function dt(mt){mt=mt||{};const st=this.context,it=mt.eventBus,lt=mt.events,ft=mt.debug;let kt,Ot,Ft,It,Ct,jt,Yt,Mt;function tn(ct,at,qt,Qt){if(navigator.requestMediaKeySystemAccess===void 0||typeof navigator.requestMediaKeySystemAccess!="function"){const qn="Insecure origins are not allowed";return it.trigger(lt.KEY_SYSTEM_ACCESS_COMPLETE,{error:qn}),void Qt({error:qn})}const fn=ct[at].protData&&ct[at].protData.systemStringPriority?ct[at].protData.systemStringPriority:null,Nn=ct[at].configs,Mn=ct[at].ks;let ra=Mn.systemString;(function(qn,Xn){return new Promise(((Se,ia)=>{hn(qn,Xn,0,Se,ia)}))})(fn||(nt[ra]?nt[ra]:[ra]),Nn).then((qn=>{const Xn=qn&&qn.nativeMediaKeySystemAccessObject&&typeof qn.nativeMediaKeySystemAccessObject.getConfiguration=="function"?qn.nativeMediaKeySystemAccessObject.getConfiguration():null,Se=new tt(Mn,Xn);Se.selectedSystemString=qn.selectedSystemString,Se.nativeMediaKeySystemAccessObject=qn.nativeMediaKeySystemAccessObject,it.trigger(lt.KEY_SYSTEM_ACCESS_COMPLETE,{data:Se}),qt({data:Se})})).catch((qn=>{if(at+1<ct.length)tn(ct,at+1,qt,Qt);else{const Xn="Key system access denied! ";it.trigger(lt.KEY_SYSTEM_ACCESS_COMPLETE,{error:Xn+qn.message}),Qt({error:Xn+qn.message})}}))}function hn(ct,at,qt,Qt,fn){const Nn=ct[qt];Ot.debug(`Requesting key system access for system string ${Nn}`),navigator.requestMediaKeySystemAccess(Nn,at).then((Mn=>{Qt({nativeMediaKeySystemAccessObject:Mn,selectedSystemString:Nn})})).catch((Mn=>{qt+1<ct.length?hn(ct,at,qt+1,Qt,fn):fn(Mn)}))}function un(ct){if(!ct||!ct.session)return Promise.resolve;const at=ct.session;return at.removeEventListener("keystatuseschange",ct),at.removeEventListener("message",ct),at.close()}function an(ct){for(let at=0;at<jt.length;at++)if(jt[at]===ct){jt.splice(at,1);break}}function Pn(ct,at){const qt={session:ct,keyId:at.keyId,normalizedKeyId:at&&at.keyId&&typeof at.keyId=="string"?at.keyId.replace(/-/g,"").toLowerCase():"",initData:at.initData,sessionId:at.sessionId,sessionType:at.sessionType,hasTriggeredKeyStatusMapUpdate:!1,handleEvent:function(Qt){switch(Qt.type){case"keystatuseschange":this._onKeyStatusesChange(Qt);break;case"message":this._onKeyMessage(Qt)}},_onKeyStatusesChange:function(Qt){it.trigger(lt.KEY_STATUSES_CHANGED,{data:this});const fn=[];Qt.target.keyStatuses.forEach((function(){fn.push(Bt(arguments))})),it.trigger(lt.INTERNAL_KEY_STATUSES_CHANGED,{parsedKeyStatuses:fn,sessionToken:qt})},_onKeyMessage:function(Qt){let fn=ArrayBuffer.isView(Qt.message)?Qt.message.buffer:Qt.message;it.trigger(lt.INTERNAL_KEY_MESSAGE,{data:new Ke(this,fn,void 0,Qt.messageType)})},getKeyId:function(){return this.keyId},getSessionId:function(){return ct.sessionId},getSessionType:function(){return this.sessionType},getExpirationTime:function(){return ct.expiration},getKeyStatuses:function(){return ct.keyStatuses},getUsable:function(){let Qt=!1;return ct.keyStatuses.forEach((function(){Bt(arguments).status===r.default.MEDIA_KEY_STATUSES.USABLE&&(Qt=!0)})),Qt}};return ct.addEventListener("keystatuseschange",qt),ct.addEventListener("message",qt),ct.closed.then((()=>{an(qt),Ot.debug("DRM: Session closed.  SessionID = "+qt.getSessionId()),it.trigger(lt.KEY_SESSION_CLOSED,{data:qt.getSessionId()})})),jt.push(qt),qt}function Bt(ct){let at,qt;return ct&&ct.length>0&&(ct[0]&&(typeof ct[0]=="string"?at=ct[0]:qt=ct[0]),ct[1]&&(typeof ct[1]=="string"?at=ct[1]:qt=ct[1])),{status:at,keyId:qt}}return kt={closeKeySession:function(ct){un(ct).catch((function(at){an(ct),it.trigger(lt.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+ct.getSessionId()+") "+at.name})}))},createKeySession:function(ct){if(!Ft||!Ct)throw new Error("Can not create sessions until you have selected a key system");const at=Ct.createSession(ct.sessionType),qt=Pn(at,ct),Qt=Ft.systemString===r.default.CLEARKEY_KEYSTEM_STRING&&(ct.initData||ct.protData&&ct.protData.clearkeys)?r.default.INITIALIZATION_DATA_TYPE_KEYIDS:r.default.INITIALIZATION_DATA_TYPE_CENC;at.generateRequest(Qt,ct.initData).then((function(){Ot.debug("DRM: Session created.  SessionID = "+qt.getSessionId()),it.trigger(lt.KEY_SESSION_CREATED,{data:qt})})).catch((function(fn){an(qt),it.trigger(lt.KEY_SESSION_CREATED,{data:null,error:new u.default(y.default.KEY_SESSION_CREATED_ERROR_CODE,y.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Error generating key request -- "+fn.name)})}))},getAllInitData:function(){const ct=[];for(let at=0;at<jt.length;at++)jt[at].initData&&ct.push(jt[at].initData);return ct},getSessionTokens:function(){return jt},loadKeySession:function(ct){if(!Ft||!Ct)throw new Error("Can not load sessions until you have selected a key system");const at=ct.sessionId;for(let fn=0;fn<jt.length;fn++)if(at===jt[fn].sessionId)return void Ot.warn("DRM: Ignoring session ID because we have already seen it!");const qt=Ct.createSession(ct.sessionType),Qt=Pn(qt,ct);Qt.hasTriggeredKeyStatusMapUpdate=!0,qt.load(at).then((function(fn){fn?(Ot.debug("DRM: Session loaded.  SessionID = "+Qt.getSessionId()),it.trigger(lt.KEY_SESSION_CREATED,{data:Qt})):(an(Qt),it.trigger(lt.KEY_SESSION_CREATED,{data:null,error:new u.default(y.default.KEY_SESSION_CREATED_ERROR_CODE,y.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session! Invalid Session ID ("+at+")")}))})).catch((function(fn){an(Qt),it.trigger(lt.KEY_SESSION_CREATED,{data:null,error:new u.default(y.default.KEY_SESSION_CREATED_ERROR_CODE,y.default.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session ("+at+")! "+fn.name)})}))},removeKeySession:function(ct){ct.session.remove().then((function(){Ot.debug("DRM: Session removed.  SessionID = "+ct.getSessionId()),it.trigger(lt.KEY_SESSION_REMOVED,{data:ct.getSessionId()})}),(function(at){it.trigger(lt.KEY_SESSION_REMOVED,{data:null,error:"Error removing session ("+ct.getSessionId()+"). "+at.name})}))},requestKeySystemAccess:function(ct){return new Promise(((at,qt)=>{tn(ct,0,at,qt)}))},reset:function(){const ct=jt.length;let at;if(ct!==0){const qt=function(Qt){an(Qt),jt.length===0&&(It?(It.removeEventListener("encrypted",Yt),It.setMediaKeys(null).then((function(){it.trigger(lt.TEARDOWN_COMPLETE)}))):it.trigger(lt.TEARDOWN_COMPLETE))};for(let Qt=0;Qt<ct;Qt++)at=jt[Qt],(function(fn){un(at),qt(fn)})(at)}else it.trigger(lt.TEARDOWN_COMPLETE)},selectKeySystem:function(ct){return new Promise(((at,qt)=>{ct.nativeMediaKeySystemAccessObject.createMediaKeys().then((Qt=>(Ft=ct.keySystem,Ct=Qt,It?It.setMediaKeys(Ct):Promise.resolve()))).then((()=>{at(Ft)})).catch((function(){qt({error:"Error selecting keys system ("+ct.keySystem.systemString+")! Could not create MediaKeys -- TODO"})}))}))},setMediaElement:function(ct){It!==ct&&(It&&(It.removeEventListener("encrypted",Yt),It.setMediaKeys&&It.setMediaKeys(null)),It=ct,It&&(It.addEventListener("encrypted",Yt),It.setMediaKeys&&Ct&&It.setMediaKeys(Ct)))},setServerCertificate:function(ct){return new Promise((at=>{Ct.setServerCertificate(ct).then((function(){Ot.info("DRM: License server certificate successfully updated."),it.trigger(lt.SERVER_CERTIFICATE_UPDATED),at()})).catch((qt=>{it.trigger(lt.SERVER_CERTIFICATE_UPDATED,{error:new u.default(y.default.SERVER_CERTIFICATE_UPDATED_ERROR_CODE,y.default.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE+qt.name)}),at()}))}))},stop:function(){let ct;for(let at=0;at<jt.length;at++)ct=jt[at],ct.getUsable()||(un(ct),an(ct))},updateKeySession:function(ct,at){const qt=ct.session;Mt.isClearKey(Ft)&&(at=at.toJWK()),qt.update(at).then((()=>{it.trigger(lt.KEY_SESSION_UPDATED)})).catch((function(Qt){it.trigger(lt.KEY_ERROR,{error:new u.default(y.default.MEDIA_KEYERR_CODE,"Error sending update() message! "+Qt.name,ct)})}))}},Ot=ft.getLogger(kt),Ft=null,It=null,Ct=null,jt=[],Mt=qe(st).getInstance(),Yt={handleEvent:function(ct){if(ct.type==="encrypted"&&ct.initData){let at=ArrayBuffer.isView(ct.initData)?ct.initData.buffer:ct.initData;it.trigger(lt.NEED_KEY,{key:new Ue(at,ct.initDataType)})}}},kt}nt[r.default.PLAYREADY_KEYSTEM_STRING]=[r.default.PLAYREADY_KEYSTEM_STRING,r.default.PLAYREADY_RECOMMENDATION_KEYSTEM_STRING],nt[r.default.WIDEVINE_KEYSTEM_STRING]=[r.default.WIDEVINE_KEYSTEM_STRING],nt[r.default.CLEARKEY_KEYSTEM_STRING]=[r.default.CLEARKEY_KEYSTEM_STRING],dt.__dashjs_factory_name="DefaultProtectionModel";var Gt=_.default.getClassFactory(dt);function vt(mt){mt=mt||{};const st=this.context,it=mt.eventBus,lt=mt.events,ft=mt.debug,kt=mt.api;let Ot,Ft,It,Ct,jt,Yt,Mt,tn,hn;function un(){try{for(let Bt=0;Bt<Mt.length;Bt++)an(Mt[Bt]);It&&It.removeEventListener(kt.needkey,tn),it.trigger(lt.TEARDOWN_COMPLETE)}catch(Bt){it.trigger(lt.TEARDOWN_COMPLETE,{error:"Error tearing down key sessions and MediaKeys! -- "+Bt.message})}}function an(Bt){const ct=Bt.session;ct.removeEventListener(kt.error,Bt),ct.removeEventListener(kt.message,Bt),ct.removeEventListener(kt.ready,Bt),ct.removeEventListener(kt.close,Bt);for(let at=0;at<Mt.length;at++)if(Mt[at]===Bt){Mt.splice(at,1);break}ct[kt.release]()}function Pn(){let Bt=null;const ct=function(){It.removeEventListener("loadedmetadata",Bt),It[kt.setMediaKeys](jt),it.trigger(lt.VIDEO_ELEMENT_SELECTED)};It.readyState>=1?ct():(Bt=ct.bind(this),It.addEventListener("loadedmetadata",Bt))}return Ot={getAllInitData:function(){const Bt=[];for(let ct=0;ct<Mt.length;ct++)Bt.push(Mt[ct].initData);return Bt},getSessionTokens:function(){return Mt},requestKeySystemAccess:function(Bt){return new Promise(((ct,at)=>{let qt=!1;for(let Qt=0;Qt<Bt.length;Qt++){const fn=Bt[Qt].ks.systemString,Nn=Bt[Qt].configs;let Mn=null,ra=null;for(let qn=0;qn<Nn.length;qn++){const Xn=Nn[qn].audioCapabilities,Se=Nn[qn].videoCapabilities;if(Xn&&Xn.length!==0){Mn=[];for(let sa=0;sa<Xn.length;sa++)window[kt.MediaKeys].isTypeSupported(fn,Xn[sa].contentType)&&Mn.push(Xn[sa])}if(Se&&Se.length!==0){ra=[];for(let sa=0;sa<Se.length;sa++)window[kt.MediaKeys].isTypeSupported(fn,Se[sa].contentType)&&ra.push(Se[sa])}if(!Mn&&!ra||Mn&&Mn.length===0||ra&&ra.length===0)continue;qt=!0;const ia=new g(Mn,ra),ca=hn.getKeySystemBySystemString(fn),Da=new tt(ca,ia);it.trigger(lt.KEY_SYSTEM_ACCESS_COMPLETE,{data:Da}),ct({data:Da});break}}if(!qt){const Qt="Key system access denied! -- No valid audio/video content configurations detected!";it.trigger(lt.KEY_SYSTEM_ACCESS_COMPLETE,{error:Qt}),at({error:Qt})}}))},selectKeySystem:function(Bt){return new Promise(((ct,at)=>{try{jt=Bt.mediaKeys=new window[kt.MediaKeys](Bt.keySystem.systemString),Ct=Bt.keySystem,Yt=Bt,It&&Pn(),ct(Ct)}catch{at({error:"Error selecting keys system ("+Ct.systemString+")! Could not create MediaKeys -- TODO"})}}))},setMediaElement:function(Bt){It!==Bt&&(It&&It.removeEventListener(kt.needkey,tn),It=Bt,It&&(It.addEventListener(kt.needkey,tn),jt&&Pn()))},createKeySession:function(Bt){if(!Ct||!jt||!Yt)throw new Error("Can not create sessions until you have selected a key system");let ct=null;if(Yt.ksConfiguration.videoCapabilities&&Yt.ksConfiguration.videoCapabilities.length>0&&(ct=Yt.ksConfiguration.videoCapabilities[0]),ct===null&&Yt.ksConfiguration.audioCapabilities&&Yt.ksConfiguration.audioCapabilities.length>0&&(ct=Yt.ksConfiguration.audioCapabilities[0]),ct===null)throw new Error("Can not create sessions for unknown content types.");const at=ct.contentType,qt=jt.createSession(at,new Uint8Array(Bt.initData),Bt.cdmData?new Uint8Array(Bt.cdmData):null),Qt=(function(fn,Nn){return{session:fn,keyId:Nn.keyId,normalizedKeyId:Nn&&Nn.keyId&&typeof Nn.keyId=="string"?Nn.keyId.replace(/-/g,"").toLowerCase():"",initData:Nn.initData,hasTriggeredKeyStatusMapUpdate:!1,getKeyId:function(){return this.keyId},getSessionId:function(){return this.session.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"},getKeyStatuses:function(){return{size:0,has:()=>!1,get:()=>{}}},handleEvent:function(Mn){switch(Mn.type){case kt.error:let ra="KeyError";it.trigger(lt.KEY_ERROR,{error:new u.default(y.default.MEDIA_KEYERR_CODE,ra,this)});break;case kt.message:let qn=ArrayBuffer.isView(Mn.message)?Mn.message.buffer:Mn.message;it.trigger(lt.INTERNAL_KEY_MESSAGE,{data:new Ke(this,qn,Mn.destinationURL)});break;case kt.ready:Ft.debug("DRM: Key added."),it.trigger(lt.KEY_ADDED);break;case kt.close:Ft.debug("DRM: Session closed.  SessionID = "+this.getSessionId()),it.trigger(lt.KEY_SESSION_CLOSED,{data:this.getSessionId()})}}}})(qt,Bt);qt.addEventListener(kt.error,Qt),qt.addEventListener(kt.message,Qt),qt.addEventListener(kt.ready,Qt),qt.addEventListener(kt.close,Qt),Mt.push(Qt),Ft.debug("DRM: Session created.  SessionID = "+Qt.getSessionId()),it.trigger(lt.KEY_SESSION_CREATED,{data:Qt})},updateKeySession:function(Bt,ct){const at=Bt.session;hn.isClearKey(Ct)?at.update(new Uint8Array(ct.toJWK())):at.update(new Uint8Array(ct)),it.trigger(lt.KEY_SESSION_UPDATED)},closeKeySession:an,setServerCertificate:function(){return Promise.resolve()},loadKeySession:function(){},removeKeySession:function(){},stop:un,reset:un},Ft=ft.getLogger(Ot),It=null,Ct=null,jt=null,Yt=null,Mt=[],hn=qe(st).getInstance(),tn={handleEvent:function(Bt){if(Bt.type===kt.needkey&&Bt.initData){const ct=ArrayBuffer.isView(Bt.initData)?Bt.initData.buffer:Bt.initData;it.trigger(lt.NEED_KEY,{key:new Ue(ct,r.default.INITIALIZATION_DATA_TYPE_CENC)})}}},Ot}vt.__dashjs_factory_name="ProtectionModel_3Feb2014";var Tt=_.default.getClassFactory(vt);function yt(mt){mt=mt||{};const st=this.context,it=mt.eventBus,lt=mt.events,ft=mt.debug,kt=mt.api,Ot=mt.errHandler;let Ft,It,Ct,jt,Yt,Mt,tn,hn,un;function an(){Ct&&ct();for(let at=0;at<tn.length;at++)Pn(tn[at]);it.trigger(lt.TEARDOWN_COMPLETE)}function Pn(at){try{Ct[kt.cancelKeyRequest](jt.systemString,at.sessionId)}catch(qt){it.trigger(lt.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+at.sessionId+") "+qt.message})}}function Bt(at,qt){if(qt&&at){const Qt=at.length;for(let fn=0;fn<Qt;fn++)if(at[fn].sessionId==qt)return at[fn];return null}return null}function ct(){Ct.removeEventListener(kt.keyerror,un),Ct.removeEventListener(kt.needkey,un),Ct.removeEventListener(kt.keymessage,un),Ct.removeEventListener(kt.keyadded,un)}return Ft={getAllInitData:function(){const at=[];for(let qt=0;qt<Mt.length;qt++)at.push(Mt[qt].initData);for(let qt=0;qt<tn.length;qt++)at.push(tn[qt].initData);return at},getSessionTokens:function(){return tn.concat(Mt)},requestKeySystemAccess:function(at){return new Promise(((qt,Qt)=>{let fn=Ct;fn||(fn=document.createElement("video"));let Nn=!1;for(let Mn=0;Mn<at.length;Mn++){const ra=at[Mn].ks.systemString,qn=at[Mn].configs;let Xn=null,Se=null;for(let ia=0;ia<qn.length;ia++){const ca=qn[ia].videoCapabilities;if(ca&&ca.length!==0){Se=[];for(let da=0;da<ca.length;da++)fn.canPlayType(ca[da].contentType,ra)!==""&&Se.push(ca[da])}if(!Se||Xn||Se&&Se.length===0)continue;Nn=!0;const Da=new g(Xn,Se),sa=Yt.getKeySystemBySystemString(ra),Oa=new tt(sa,Da);it.trigger(lt.KEY_SYSTEM_ACCESS_COMPLETE,{data:Oa}),qt({data:Oa});break}}if(!Nn){const Mn="Key system access denied! -- No valid audio/video content configurations detected!";it.trigger(lt.KEY_SYSTEM_ACCESS_COMPLETE,{error:Mn}),Qt({error:Mn})}}))},selectKeySystem:function(at){return jt=at.keySystem,Promise.resolve(jt)},setMediaElement:function(at){if(Ct!==at){if(Ct){ct();for(var qt=0;qt<tn.length;qt++)Pn(tn[qt]);tn=[]}Ct=at,Ct&&(Ct.addEventListener(kt.keyerror,un),Ct.addEventListener(kt.needkey,un),Ct.addEventListener(kt.keymessage,un),Ct.addEventListener(kt.keyadded,un),it.trigger(lt.VIDEO_ELEMENT_SELECTED))}},createKeySession:function(at){if(!jt)throw new Error("Can not create sessions until you have selected a key system");if(hn||tn.length===0){const qt={sessionId:null,keyId:at.keyId,normalizedKeyId:at&&at.keyId&&typeof at.keyId=="string"?at.keyId.replace(/-/g,"").toLowerCase():"",initData:at.initData,hasTriggeredKeyStatusMapUpdate:!1,getKeyId:function(){return this.keyId},getSessionId:function(){return this.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"},getKeyStatuses:function(){return{size:0,has:()=>!1,get:()=>{}}}};return Mt.push(qt),Ct[kt.generateKeyRequest](jt.systemString,new Uint8Array(at.initData)),qt}throw new Error("Multiple sessions not allowed!")},updateKeySession:function(at,qt){const Qt=at.sessionId;if(Yt.isClearKey(jt))for(let fn=0;fn<qt.keyPairs.length;fn++)Ct[kt.addKey](jt.systemString,qt.keyPairs[fn].key,qt.keyPairs[fn].keyID,Qt);else Ct[kt.addKey](jt.systemString,new Uint8Array(qt),new Uint8Array(at.initData),Qt);it.trigger(lt.KEY_SESSION_UPDATED)},closeKeySession:Pn,setServerCertificate:function(){return Promise.resolve()},loadKeySession:function(){},removeKeySession:function(){},stop:an,reset:an},It=ft.getLogger(Ft),Ct=null,jt=null,Mt=[],tn=[],Yt=qe(st).getInstance(),un={handleEvent:function(at){let qt=null;switch(at.type){case kt.needkey:let Qt=ArrayBuffer.isView(at.initData)?at.initData.buffer:at.initData;it.trigger(lt.NEED_KEY,{key:new Ue(Qt,r.default.INITIALIZATION_DATA_TYPE_CENC)});break;case kt.keyerror:if(qt=Bt(tn,at.sessionId),qt||(qt=Bt(Mt,at.sessionId)),qt){let fn=y.default.MEDIA_KEYERR_CODE,Nn="";switch(at.errorCode.code){case 1:fn=y.default.MEDIA_KEYERR_UNKNOWN_CODE,Nn+="MEDIA_KEYERR_UNKNOWN - "+y.default.MEDIA_KEYERR_UNKNOWN_MESSAGE;break;case 2:fn=y.default.MEDIA_KEYERR_CLIENT_CODE,Nn+="MEDIA_KEYERR_CLIENT - "+y.default.MEDIA_KEYERR_CLIENT_MESSAGE;break;case 3:fn=y.default.MEDIA_KEYERR_SERVICE_CODE,Nn+="MEDIA_KEYERR_SERVICE - "+y.default.MEDIA_KEYERR_SERVICE_MESSAGE;break;case 4:fn=y.default.MEDIA_KEYERR_OUTPUT_CODE,Nn+="MEDIA_KEYERR_OUTPUT - "+y.default.MEDIA_KEYERR_OUTPUT_MESSAGE;break;case 5:fn=y.default.MEDIA_KEYERR_HARDWARECHANGE_CODE,Nn+="MEDIA_KEYERR_HARDWARECHANGE - "+y.default.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE;break;case 6:fn=y.default.MEDIA_KEYERR_DOMAIN_CODE,Nn+="MEDIA_KEYERR_DOMAIN - "+y.default.MEDIA_KEYERR_DOMAIN_MESSAGE}Nn+="  System Code = "+at.systemCode,it.trigger(lt.KEY_ERROR,{error:new u.default(fn,Nn,qt)})}else It.error("No session token found for key error");break;case kt.keyadded:qt=Bt(tn,at.sessionId),qt||(qt=Bt(Mt,at.sessionId)),qt?(It.debug("DRM: Key added."),it.trigger(lt.KEY_ADDED,{data:qt})):It.debug("No session token found for key added");break;case kt.keymessage:if(hn=at.sessionId!==null&&at.sessionId!==void 0,hn?(qt=Bt(tn,at.sessionId),!qt&&Mt.length>0&&(qt=Mt.shift(),tn.push(qt),qt.sessionId=at.sessionId,it.trigger(lt.KEY_SESSION_CREATED,{data:qt}))):Mt.length>0&&(qt=Mt.shift(),tn.push(qt),Mt.length!==0&&Ot.error(new u.default(y.default.MEDIA_KEY_MESSAGE_ERROR_CODE,y.default.MEDIA_KEY_MESSAGE_ERROR_MESSAGE))),qt){let fn=ArrayBuffer.isView(at.message)?at.message.buffer:at.message;qt.keyMessage=fn,it.trigger(lt.INTERNAL_KEY_MESSAGE,{data:new Ke(qt,fn,at.defaultURL)})}else It.warn("No session token found for key message")}}},Ft}yt.__dashjs_factory_name="ProtectionModel_01b";var Zt=_.default.getClassFactory(yt);const _n=[{generateKeyRequest:"generateKeyRequest",addKey:"addKey",cancelKeyRequest:"cancelKeyRequest",needkey:"needkey",keyerror:"keyerror",keyadded:"keyadded",keymessage:"keymessage"},{generateKeyRequest:"webkitGenerateKeyRequest",addKey:"webkitAddKey",cancelKeyRequest:"webkitCancelKeyRequest",needkey:"webkitneedkey",keyerror:"webkitkeyerror",keyadded:"webkitkeyadded",keymessage:"webkitkeymessage"}],An=[{setMediaKeys:"setMediaKeys",MediaKeys:"MediaKeys",release:"close",needkey:"needkey",error:"keyerror",message:"keymessage",ready:"keyadded",close:"keyclose"},{setMediaKeys:"msSetMediaKeys",MediaKeys:"MSMediaKeys",release:"close",needkey:"msneedkey",error:"mskeyerror",message:"mskeymessage",ready:"mskeyadded",close:"mskeyclose"}];function Sn(){let mt;const st=this.context;function it(lt,ft){for(let kt=0;kt<ft.length;kt++){const Ot=ft[kt];if(typeof lt[Ot[Object.keys(Ot)[0]]]=="function")return Ot}return null}return mt={createProtectionSystem:function(lt){let ft=null;const kt=qe(st).getInstance();kt.setConfig({debug:lt.debug,BASE64:lt.BASE64,settings:lt.settings}),kt.initialize();let Ot=(function(Ft){const It=Ft.debug,Ct=It.getLogger(mt),jt=Ft.eventBus,Yt=Ft.errHandler,Mt=Ft.videoModel?Ft.videoModel.getElement():null;return Mt&&Mt.onencrypted===void 0||Mt&&Mt.mediaKeys===void 0?it(Mt,An)?(Ct.info("EME detected on this user agent! (ProtectionModel_3Feb2014)"),Tt(st).create({debug:It,eventBus:jt,events:Ft.events,api:it(Mt,An)})):it(Mt,_n)?(Ct.info("EME detected on this user agent! (ProtectionModel_01b)"),Zt(st).create({debug:It,eventBus:jt,errHandler:Yt,events:Ft.events,api:it(Mt,_n)})):(Ct.warn("No supported version of EME detected on this user agent! - Attempts to play encrypted content will fail!"),null):(Ct.info("EME detected on this user agent! (DefaultProtectionModel"),Gt(st).create({debug:It,eventBus:jt,events:Ft.events}))})(lt);return Ot&&(ft=R(st).create({BASE64:lt.BASE64,cmcdModel:lt.cmcdModel,constants:lt.constants,customParametersModel:lt.customParametersModel,debug:lt.debug,eventBus:lt.eventBus,events:lt.events,protectionKeyController:kt,protectionModel:Ot,settings:lt.settings}),lt.capabilities.setEncryptedMediaSupported(!0)),ft}},mt}Sn.__dashjs_factory_name="Protection";const wn=_.default.getClassFactory(Sn);wn.events=Fe.default,wn.errors=y.default,_.default.updateClassFactory(Sn.__dashjs_factory_name,wn);var Rn=wn},445:function(o,e,t){t.r(e);var n=t(7252);class r extends n.default{constructor(){super(),this.INTERNAL_KEY_MESSAGE="internalKeyMessage",this.INTERNAL_KEY_STATUSES_CHANGED="internalkeyStatusesChanged",this.KEY_ADDED="public_keyAdded",this.KEY_ERROR="public_keyError",this.KEY_MESSAGE="public_keyMessage",this.KEY_SESSION_CLOSED="public_keySessionClosed",this.KEY_SESSION_CREATED="public_keySessionCreated",this.KEY_SESSION_REMOVED="public_keySessionRemoved",this.KEY_STATUSES_CHANGED="public_keyStatusesChanged",this.KEY_STATUSES_MAP_UPDATED="keyStatusesMapUpdated",this.KEY_SYSTEM_ACCESS_COMPLETE="public_keySystemAccessComplete",this.KEY_SYSTEM_SELECTED="public_keySystemSelected",this.LICENSE_REQUEST_COMPLETE="public_licenseRequestComplete",this.LICENSE_REQUEST_SENDING="public_licenseRequestSending",this.NEED_KEY="needkey",this.PROTECTION_CREATED="public_protectioncreated",this.PROTECTION_DESTROYED="public_protectiondestroyed",this.SERVER_CERTIFICATE_UPDATED="serverCertificateUpdated",this.TEARDOWN_COMPLETE="protectionTeardownComplete",this.VIDEO_ELEMENT_SELECTED="videoElementSelected",this.KEY_SESSION_UPDATED="public_keySessionUpdated"}}let i=new r;e.default=i},1923:function(o,e,t){t.r(e);var n=t(8748);class r extends n.default{constructor(){super(),this.MEDIA_KEYERR_CODE=100,this.MEDIA_KEYERR_UNKNOWN_CODE=101,this.MEDIA_KEYERR_CLIENT_CODE=102,this.MEDIA_KEYERR_SERVICE_CODE=103,this.MEDIA_KEYERR_OUTPUT_CODE=104,this.MEDIA_KEYERR_HARDWARECHANGE_CODE=105,this.MEDIA_KEYERR_DOMAIN_CODE=106,this.MEDIA_KEY_MESSAGE_ERROR_CODE=107,this.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE=108,this.SERVER_CERTIFICATE_UPDATED_ERROR_CODE=109,this.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE=110,this.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE=111,this.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE=112,this.KEY_SESSION_CREATED_ERROR_CODE=113,this.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE=114,this.MEDIA_KEYERR_UNKNOWN_MESSAGE="An unspecified error occurred. This value is used for errors that don't match any of the other codes.",this.MEDIA_KEYERR_CLIENT_MESSAGE="The Key System could not be installed or updated.",this.MEDIA_KEYERR_SERVICE_MESSAGE="The message passed into update indicated an error from the license service.",this.MEDIA_KEYERR_OUTPUT_MESSAGE="There is no available output device with the required characteristics for the content protection system.",this.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE="A hardware configuration change caused a content protection error.",this.MEDIA_KEYERR_DOMAIN_MESSAGE="An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain.",this.MEDIA_KEY_MESSAGE_ERROR_MESSAGE="Multiple key sessions were creates with a user-agent that does not support sessionIDs!! Unpredictable behavior ahead!",this.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE="DRM: Empty key message from CDM",this.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE="Error updating server certificate -- ",this.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE="DRM: KeyStatusChange error! -- License has expired",this.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE="DRM: No license server URL specified!",this.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE="DRM: KeySystem Access Denied! -- ",this.KEY_SESSION_CREATED_ERROR_MESSAGE="DRM: unable to create session! --",this.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE="DRM: licenser error! --"}}let i=new r;e.default=i},4246:function(o,e,t){t.r(e);var n=t(138);const r={DEFAULT:.5,STRONG:1,WEAK:0};function i(h,f,g,y){let u,l,d,m,E;return l=h===void 0?null:h,d=(function(S){let _=r.DEFAULT;return S!==r.DEFAULT&&S!==r.STRONG&&S!==r.WEAK||(_=S),_})(g),m=f===void 0?null:f,E=y===void 0?null:y,u={representation:l,reason:m,rule:E,priority:d},u}i.__dashjs_factory_name="SwitchRequest";const c=n.default.getClassFactory(i);c.NO_CHANGE=null,c.PRIORITY=r,n.default.updateClassFactory(i.__dashjs_factory_name,c),e.default=c},559:function(o,e,t){t.r(e),t.d(e,{supportsMediaSource:function(){return f}});var n=t(138),r=t(5212),i=t(2861),c=t(7393),h=t(649);function f(){let y="ManagedMediaSource"in window,u="WebKitMediaSource"in window,l="MediaSource"in window;return y||u||l}function g(){let y,u,l,d,m,E;const S=this.context,_=(0,c.default)(S).getInstance();function M(Y,j){let se;j===r.default.VIDEO?se=(function(Ae){const ze={video:{}};return Ae&&(Ae.width&&(ze.video.width=Ae.width),Ae.height&&(ze.video.height=Ae.height),Ae.framerate&&(ze.video.framerate=parseFloat(Ae.framerate)),Ae.hdrMetadataType&&(ze.video.hdrMetadataType=Ae.hdrMetadataType),Ae.colorGamut&&(ze.video.colorGamut=Ae.colorGamut),Ae.transferFunction&&(ze.video.transferFunction=Ae.transferFunction)),ze})(Y):j===r.default.AUDIO&&(se=(function(Ae){const ze={audio:{}};return Ae.samplerate&&(ze.audio.samplerate=Ae.samplerate),Ae.channels&&(ze.audio.channels=Ae.channels),ze})(Y)),se[j].contentType=Y.codec,se[j].bitrate=parseInt(Y.bitrate),se.type="media-source";let Te=Y.codec;return Y.width&&Y.height&&(Te+=';width="'+Y.width+'";height="'+Y.height+'"'),se.mediaSourceCodecString=Te,(function(Ae,ze,de){if(!ze||!ze.keySystemsMetadata||ze.keySystemsMetadata.length===0)return[Ae];const we=[];return ze.keySystemsMetadata.forEach((ce=>{if(!ce.ks)return void we.push({...Ae});const he=ce.protData&&ce.protData.systemStringPriority?ce.protData.systemStringPriority:null;let Pe=ce.ks.systemString;(he||[Pe]).forEach(($e=>{const He={...Ae};He.keySystemConfiguration={},$e&&(He.keySystemConfiguration.keySystem=$e);let et="";ce.ks.systemString===i.default.WIDEVINE_KEYSTEM_STRING&&(et=i.default.ROBUSTNESS_STRINGS.WIDEVINE.SW_SECURE_CRYPTO);const Ve=ce.protData,Et=Ve&&Ve.audioRobustness&&Ve.audioRobustness.length>0?Ve.audioRobustness:et,Nt=Ve&&Ve.videoRobustness&&Ve.videoRobustness.length>0?Ve.videoRobustness:et;de===r.default.AUDIO?He.keySystemConfiguration[de]={robustness:Et}:de===r.default.VIDEO&&(He.keySystemConfiguration[de]={robustness:Nt}),we.push(He)}))})),we})(se,Y,j)}function R(Y){return u.get().streaming.enhancement.codecs.some((j=>Y.includes(j)))}function W(Y){if(d&&d.length!==0&&Y)return d.find((j=>{const se=fe(Y,j,r.default.AUDIO),Te=fe(Y,j,r.default.VIDEO),Ae=fe(Y,j,"keySystemConfiguration");return se&&Te&&Ae}))}function fe(Y,j,se){return!Y[se]&&!j[se]||!(!Y[se]||!j[se])&&_.areEqual(Y[se],j[se])}function ye(Y,j){return(Y=Y.filter((se=>!(se.schemeIdUri&&j.some((Te=>Te.schemeIdUri===se.schemeIdUri)))))).push(...j),Y}return y={areKeyIdsExpired:function(Y){return!!(l&&Y&&Y.normalizedKeyIds&&Y.normalizedKeyIds.size!==0)&&l.areKeyIdsExpired(Y.normalizedKeyIds)},areKeyIdsUsable:function(Y){return!(l&&Y&&Y.normalizedKeyIds&&Y.normalizedKeyIds.size!==0)||l.areKeyIdsUsable(Y.normalizedKeyIds)},isCodecSupportedBasedOnTestedConfigurations:function(Y,j){if(!Y||!Y.codec||Y.isSupported===!1)return!1;const se=M(Y,j).map((Te=>W(Te))).filter((Te=>Te!=null));return!(se&&se.length>0)||(function(Te){return Te.some((Ae=>Ae&&Ae.decodingInfo&&Ae.decodingInfo.supported))})(se)},isProtectionCompatible:function(Y,j){return!j||!(!Y.isEncrypted&&j.isEncrypted)},runCodecSupportCheck:function(Y,j){if(j!==r.default.AUDIO&&j!==r.default.VIDEO)return Promise.resolve();if(u.get().streaming.enhancement.enabled&&R(Y.codec))return d=d.filter((Te=>!R(Te.mediaSourceCodecString))),Promise.resolve(!0);const se=M(Y,j);return(function(Te,Ae){return u.get().streaming.capabilities.useMediaCapabilitiesApi&&navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo&&(Te.codec&&Ae===r.default.AUDIO||Ae===r.default.VIDEO&&Te.codec&&Te.width&&Te.height&&Te.bitrate&&Te.framerate)})(Y,j)?(function(Te){return new Promise((Ae=>{if(!Te||Te.length===0)return void Ae();const ze=Te.map((de=>(function(we){return new Promise((ce=>{W(we)?ce():navigator.mediaCapabilities.decodingInfo(we).then((he=>{we.decodingInfo=he,d.push(we),ce()})).catch((he=>{we.decodingInfo={supported:!1},d.push(we),E.error(he),ce()}))}))})(de)));Promise.allSettled(ze).then((()=>{Ae()})).catch((de=>{E.error(de),Ae()}))}))})(se):((function(Te){if(!Te||!Te.length)return;const Ae=Te[0];if(W(Ae))return;let ze={supported:!1};("ManagedMediaSource"in window&&ManagedMediaSource.isTypeSupported(Ae.mediaSourceCodecString)||"MediaSource"in window&&MediaSource.isTypeSupported(Ae.mediaSourceCodecString)||"WebKitMediaSource"in window&&WebKitMediaSource.isTypeSupported(Ae.mediaSourceCodecString))&&(ze.supported=!0),Ae.decodingInfo=ze,d.push(Ae)})(se),Promise.resolve())},setConfig:function(Y){Y&&(Y.settings&&(u=Y.settings),Y.protectionController&&(l=Y.protectionController))},setEncryptedMediaSupported:function(Y){m=Y},setProtectionController:function(Y){l=Y},supportsChangeType:function(){return!!window.SourceBuffer&&!!SourceBuffer.prototype&&!!SourceBuffer.prototype.changeType},supportsEncryptedMedia:function(){return m},supportsEssentialProperty:function(Y){let j=u.get().streaming.capabilities.supportedEssentialProperties;u.get().streaming.capabilities.useMediaCapabilitiesApi&&u.get().streaming.capabilities.filterVideoColorimetryEssentialProperties&&(j=ye(j,[{schemeIdUri:r.default.COLOUR_PRIMARIES_SCHEME_ID_URI},{schemeIdUri:r.default.MATRIX_COEFFICIENTS_SCHEME_ID_URI},{schemeIdUri:r.default.TRANSFER_CHARACTERISTICS_SCHEME_ID_URI}])),u.get().streaming.capabilities.useMediaCapabilitiesApi&&u.get().streaming.capabilities.filterHDRMetadataFormatEssentialProperties&&(j=ye(j,[{schemeIdUri:r.default.HDR_METADATA_FORMAT_SCHEME_ID_URI}]));try{return Y.inArray(j)}catch{return!0}},supportsMediaSource:f},m=!1,d=[],E=(0,h.default)(S).getInstance().getLogger(y),y}g.__dashjs_factory_name="Capabilities",e.default=n.default.getSingletonFactory(g)},7377:function(o,e,t){t.r(e);var n=t(138),r=t(656);function i(){return{customTimeRangeArray:[],length:0,add:function(c,h){let f;for(f=0;f<this.customTimeRangeArray.length&&c>this.customTimeRangeArray[f].start;f++);for(this.customTimeRangeArray.splice(f,0,{start:c,end:h}),f=0;f<this.customTimeRangeArray.length-1;f++)this.mergeRanges(f,f+1)&&f--;this.length=this.customTimeRangeArray.length},clear:function(){this.customTimeRangeArray=[],this.length=0},remove:function(c,h){for(let f=0;f<this.customTimeRangeArray.length;f++)if(c<=this.customTimeRangeArray[f].start&&h>=this.customTimeRangeArray[f].end)this.customTimeRangeArray.splice(f,1),f--;else{if(c>this.customTimeRangeArray[f].start&&h<this.customTimeRangeArray[f].end){this.customTimeRangeArray.splice(f+1,0,{start:h,end:this.customTimeRangeArray[f].end}),this.customTimeRangeArray[f].end=c;break}c>this.customTimeRangeArray[f].start&&c<this.customTimeRangeArray[f].end?this.customTimeRangeArray[f].end=c:h>this.customTimeRangeArray[f].start&&h<this.customTimeRangeArray[f].end&&(this.customTimeRangeArray[f].start=h)}this.length=this.customTimeRangeArray.length},mergeRanges:function(c,h){let f=this.customTimeRangeArray[c],g=this.customTimeRangeArray[h];return f.start<=g.start&&g.start<=f.end&&f.end<=g.end?(f.end=g.end,this.customTimeRangeArray.splice(h,1),!0):g.start<=f.start&&f.start<=g.end&&g.end<=f.end?(f.start=g.start,this.customTimeRangeArray.splice(h,1),!0):g.start<=f.start&&f.start<=g.end&&f.end<=g.end?(this.customTimeRangeArray.splice(c,1),!0):f.start<=g.start&&g.start<=f.end&&g.end<=f.end&&(this.customTimeRangeArray.splice(h,1),!0)},start:function(c){return(0,r.checkInteger)(c),c>=this.customTimeRangeArray.length||c<0?NaN:this.customTimeRangeArray[c].start},end:function(c){return(0,r.checkInteger)(c),c>=this.customTimeRangeArray.length||c<0?NaN:this.customTimeRangeArray[c].end}}}i.__dashjs_factory_name="CustomTimeRanges",e.default=n.default.getClassFactory(i)},7393:function(o,e,t){t.r(e);var n=t(138),r=t(7316);function i(){let c;return c={areEqual:function(h,f){return r(h,f)}},c}i.__dashjs_factory_name="ObjectUtils",e.default=n.default.getSingletonFactory(i)},656:function(o,e,t){t.r(e),t.d(e,{checkInteger:function(){return i},checkIsVideoOrAudioType:function(){return h},checkParameterType:function(){return r},checkRange:function(){return c}});var n=t(5212);function r(f,g){if(typeof f!==g)throw n.default.BAD_ARGUMENT_ERROR}function i(f){if(f===null||isNaN(f)||f%1!=0)throw n.default.BAD_ARGUMENT_ERROR+" : argument is not an integer"}function c(f,g,y){if(f<g||f>y)throw n.default.BAD_ARGUMENT_ERROR+" : argument out of range"}function h(f){if(typeof f!="string"||f!==n.default.AUDIO&&f!==n.default.VIDEO)throw n.default.BAD_ARGUMENT_ERROR}},1944:function(o,e,t){t.r(e),e.default=class{constructor(n,r,i){this.code=n||null,this.message=r||null,this.data=i||null}}},5560:function(o,e,t){t.r(e);var n=t(8854);e.default=class{constructor(r){this.id=r.id,this.url=r.url,this.language=r.language,this.mimeType=r.mimeType,this.bandwidth=r.bandwidth,this.periodId=r.periodId||null}serializeToMpdParserFormat(){return{tagName:n.default.ADAPTATION_SET,mimeType:this.mimeType,lang:this.language,Representation:[{tagName:n.default.REPRESENTATION,id:this.id,bandwidth:this.bandwidth,BaseURL:[{tagName:n.default.BASE_URL,__text:this.url}],mimeType:this.mimeType}]}}}},7568:function(o,e,t){t.r(e),t.d(e,{HTTPRequest:function(){return n},HTTPRequestTrace:function(){return r}});class n{constructor(){this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.responsecode=null,this.interval=null,this.trace=[],this.cmsd=null,this._stream=null,this._tfinish=null,this._mediaduration=null,this._responseHeaders=null,this._serviceLocation=null,this._fileLoaderType=null,this._resourceTimingValues=null}}class r{constructor(){this.s=null,this.d=null,this.b=[]}}n.GET="GET",n.HEAD="HEAD",n.MPD_TYPE="MPD",n.XLINK_EXPANSION_TYPE="XLinkExpansion",n.INIT_SEGMENT_TYPE="InitializationSegment",n.INDEX_SEGMENT_TYPE="IndexSegment",n.MEDIA_SEGMENT_TYPE="MediaSegment",n.BITSTREAM_SWITCHING_SEGMENT_TYPE="BitstreamSwitchingSegment",n.MSS_FRAGMENT_INFO_SEGMENT_TYPE="FragmentInfoSegment",n.DVB_REPORTING_TYPE="DVBReporting",n.LICENSE="license",n.CONTENT_STEERING_TYPE="ContentSteering",n.OTHER_TYPE="other"}},Id={};function ha(o){var e=Id[o];if(e!==void 0)return e.exports;var t=Id[o]={exports:{}};return oE[o].call(t.exports,t,t.exports,ha),t.exports}ha.amdO={},ha.d=function(o,e){for(var t in e)ha.o(e,t)&&!ha.o(o,t)&&Object.defineProperty(o,t,{enumerable:!0,get:e[t]})},ha.g=(function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}})(),ha.o=function(o,e){return Object.prototype.hasOwnProperty.call(o,e)},ha.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})};var Ha={};ha.r(Ha),ha.d(Ha,{Constants:function(){return Yf.default},Debug:function(){return Gf.default},ExternalSubtitle:function(){return $f.default},MediaPlayer:function(){return lE.MediaPlayer},MediaPlayerFactory:function(){return Hf},MetricsReporting:function(){return qf.default},Protection:function(){return jf.default},default:function(){return uE},supportsMediaSource:function(){return Kf.supportsMediaSource}});var lE=ha(5393),qf=ha(4469),jf=ha(3888),cE=ha(8200);let Rd,Is=(function(){const o="application/dash+xml";let e;function t(r,i,c){if(!r||!/^VIDEO$/i.test(r.nodeName))return null;if(r._dashjs_player)return r._dashjs_player;let h,f=r.id||r.name||"video element";if(!(i=i||[].slice.call(r.querySelectorAll("source")).filter((function(g){return g.type==o}))[0])&&r.src)(i=document.createElement("source")).src=r.src;else if(!i&&!r.src)return null;return c=c||{},h=(0,cE.default)(c).create(),h.initialize(r,i.src,r.autoplay),e||(e=h.getDebug().getLogger()),e.debug("Converted "+f+" to dash.js player and added content: "+i.src),r._dashjs_player=h,h}function n(r){return/^VIDEO$/i.test(r.nodeName)?r:n(r.parentNode)}return{create:t,createAll:function(r,i){let c=[];r=r||"[data-dashjs-player]";let h=(i=i||document).querySelectorAll(r);for(let g=0;g<h.length;g++){let y=t(h[g],null);c.push(y)}let f=i.querySelectorAll('source[type="'+o+'"]');for(let g=0;g<f.length;g++){let y=t(n(f[g]),null);c.push(y)}return c}}})();!(typeof window<"u"&&window&&window.dashjs&&window.dashjs.skipAutoCreate)&&typeof window<"u"&&window&&window.addEventListener&&(window.document.readyState==="complete"?window.dashjs?Is.createAll():Rd=window.setInterval((function(){window.dashjs&&(window.clearInterval(Rd),Is.createAll())}),500):window.addEventListener("load",(function o(){window.removeEventListener("load",o),Is.createAll()})));var Hf=Is,Gf=ha(649),Yf=ha(5212),Kf=ha(559),$f=ha(5560);dashjs.Protection=jf.default,dashjs.MetricsReporting=qf.default,dashjs.MediaPlayerFactory=Hf,dashjs.Debug=Gf.default,dashjs.supportsMediaSource=Kf.supportsMediaSource,dashjs.Constants=Yf.default,dashjs.ExternalSubtitle=$f.default;var uE=dashjs;(Ha=Ha.default).Constants;Ha.Debug;Ha.ExternalSubtitle;var dE=Ha.MediaPlayer;Ha.MediaPlayerFactory;Ha.MetricsReporting;Ha.Protection;Ha.default;Ha.supportsMediaSource;class fE{constructor(e,t,n="HI_RES_LOSSLESS"){this.audio=e,this.api=t,this.quality=n,this.queue=[],this.shuffledQueue=[],this.originalQueueBeforeShuffle=[],this.currentQueueIndex=-1,this.shuffleActive=!1,this.repeatMode=xa.OFF,this.preloadCache=new Map,this.preloadAbortController=null,this.currentTrack=null,this.currentRgValues=null,this.userVolume=parseFloat(localStorage.getItem("volume")||"0.7"),this.isFallbackRetry=!1,this.autoplayBlocked=!1,this.isIOS=typeof window<"u"&&window.__IS_IOS__===!0,this.isPwa=typeof window<"u"&&(window.matchMedia?.("(display-mode: standalone)")?.matches||window.navigator?.standalone===!0),this.sleepTimer=null,this.sleepTimerEndTime=null,this.sleepTimerInterval=null,this.dashPlayer=dE().create(),this.dashPlayer.updateSettings({streaming:{buffer:{fastSwitchEnabled:!0}}}),this.dashInitialized=!1,this.loadQueueState(),this.setupMediaSession(),window.addEventListener("beforeunload",()=>{this.saveQueueState()}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&!this.audio.paused&&(Zn.isReady()||Zn.init(this.audio),Zn.resume()),document.visibilityState==="visible"&&this.autoplayBlocked&&(this.autoplayBlocked=!1,this.audio.play().catch(()=>{}))})}setVolume(e){this.userVolume=Math.max(0,Math.min(1,e)),localStorage.setItem("volume",this.userVolume),this.applyReplayGain()}applyReplayGain(){const e=qo.getMode();let t=0,n=1;if(e!=="off"&&this.currentRgValues){const{trackReplayGain:h,trackPeakAmplitude:f,albumReplayGain:g,albumPeakAmplitude:y}=this.currentRgValues;e==="album"&&g!==void 0?(t=g,n=y||1):h!==void 0&&(t=h,n=f||1),t+=qo.getPreamp()}let r=Math.pow(10,t/20);r*n>1&&(r=1/n);const c=Bd.applyCurve(this.userVolume)*r;Zn.isReady()?(this.audio.volume=1,Zn.setVolume(c)):this.audio.volume=Math.max(0,Math.min(1,c))}applyAudioEffects(){const e=Ho.getSpeed();this.audio.playbackRate!==e&&(this.audio.playbackRate=e)}setPlaybackSpeed(e){const t=Math.max(.01,Math.min(100,parseFloat(e)||1));Ho.setSpeed(t),this.applyAudioEffects()}loadQueueState(){const e=Go.getQueue();if(e){this.queue=e.queue||[],this.shuffledQueue=e.shuffledQueue||[],this.originalQueueBeforeShuffle=e.originalQueueBeforeShuffle||[],this.currentQueueIndex=e.currentQueueIndex??-1,this.shuffleActive=e.shuffleActive||!1,this.repeatMode=e.repeatMode!==void 0?e.repeatMode:xa.OFF;const t=this.shuffleActive?this.shuffledQueue:this.queue;if(this.currentQueueIndex>=0&&this.currentQueueIndex<t.length){this.currentTrack=t[this.currentQueueIndex];const n=this.currentTrack,r=Ca(n),i=Ps(n),c=Ko(n),h=document.querySelector(".now-playing-bar .cover"),f=document.querySelector(".now-playing-bar .title"),g=document.querySelector(".now-playing-bar .album"),y=document.querySelector(".now-playing-bar .artist");if(h){const d=n.album?.videoCover?this.api.tidalAPI.getVideoCoverUrl(n.album.videoCover):null,m=d||this.api.getCoverUrl(n.album?.cover);if(d){if(h.tagName==="IMG"){const E=document.createElement("video");E.src=d,E.autoplay=!0,E.loop=!0,E.muted=!0,E.playsInline=!0,E.className=h.className,E.id=h.id,h.replaceWith(E)}}else if(h.tagName==="VIDEO"){const E=document.createElement("img");E.src=m,E.className=h.className,E.id=h.id,h.replaceWith(E)}else h.src=m}if(f){const d=Or(n);f.innerHTML=`${en(r)} ${d}`}if(g){const d=n.album?.title||"";d&&d!==r?(g.textContent=d,g.style.display="block"):(g.textContent="",g.style.display="none")}y&&(y.innerHTML=i+c),!c&&n.album?.id&&this.loadAlbumYear(n,i,y);const u=document.getElementById("now-playing-mix-btn");u&&(u.style.display=n.mixes&&n.mixes.TRACK_MIX?"flex":"none");const l=document.getElementById("total-duration");l&&(l.textContent=Ma(n.duration)),document.title=`${r} â€¢ ${wa(n)}`,this.updatePlayingTrackIndicator(),this.updateMediaSession(n)}}}saveQueueState(){Go.saveQueue({queue:this.queue,shuffledQueue:this.shuffledQueue,originalQueueBeforeShuffle:this.originalQueueBeforeShuffle,currentQueueIndex:this.currentQueueIndex,shuffleActive:this.shuffleActive,repeatMode:this.repeatMode}),window.renderQueueFunction&&window.renderQueueFunction()}setupMediaSession(){"mediaSession"in navigator&&(navigator.mediaSession.setActionHandler("play",async()=>{Zn.isReady()||(Zn.init(this.audio),this.applyReplayGain()),await Zn.resume();try{await this.audio.play()}catch(e){console.error("MediaSession play failed:",e),this.handlePlayPause()}}),navigator.mediaSession.setActionHandler("pause",()=>{this.audio.pause()}),navigator.mediaSession.setActionHandler("previoustrack",async()=>{Zn.isReady()||(Zn.init(this.audio),this.applyReplayGain()),await Zn.resume(),this.playPrev()}),navigator.mediaSession.setActionHandler("nexttrack",async()=>{Zn.isReady()||(Zn.init(this.audio),this.applyReplayGain()),await Zn.resume(),this.playNext()}),navigator.mediaSession.setActionHandler("seekbackward",e=>{const t=e.seekOffset||10;this.seekBackward(t)}),navigator.mediaSession.setActionHandler("seekforward",e=>{const t=e.seekOffset||10;this.seekForward(t)}),navigator.mediaSession.setActionHandler("seekto",e=>{e.seekTime!==void 0&&(this.audio.currentTime=Math.max(0,e.seekTime),this.updateMediaSessionPositionState())}),navigator.mediaSession.setActionHandler("stop",()=>{this.audio.pause(),this.audio.currentTime=0,this.updateMediaSessionPlaybackState()}))}setQuality(e){this.quality=e}async preloadNextTracks(){this.preloadAbortController&&this.preloadAbortController.abort(),this.preloadAbortController=new AbortController;const e=this.shuffleActive?this.shuffledQueue:this.queue,t=[];for(let n=1;n<=2;n++){const r=this.currentQueueIndex+n;r<e.length&&t.push({track:e[r],index:r})}for(const{track:n}of t){if(this.preloadCache.has(n.id))continue;const r=n.isTracker||n.id&&String(n.id).startsWith("tracker-");if(!(n.isLocal||r||n.audioUrl&&!n.isLocal))try{const i=await this.api.getStreamUrl(n.id,this.quality);if(this.preloadAbortController.signal.aborted)break;this.preloadCache.set(n.id,i),i.startsWith("blob:")||fetch(i,{method:"HEAD",signal:this.preloadAbortController.signal}).catch(()=>{})}catch(i){i.name}}}async playTrackFromQueue(e=0,t=0){const n=this.shuffleActive?this.shuffledQueue:this.queue;if(this.currentQueueIndex<0||this.currentQueueIndex>=n.length)return;const r=n[this.currentQueueIndex];if(r.isUnavailable){console.warn(`Attempted to play unavailable track: ${r.title}. Skipping...`),this.playNext();return}const{contentBlockingSettings:i}=await ta(async()=>{const{contentBlockingSettings:d}=await Promise.resolve().then(()=>ya);return{contentBlockingSettings:d}},void 0,import.meta.url);if(i.shouldHideTrack(r)){console.warn(`Attempted to play blocked track: ${r.title}. Skipping...`),this.playNext();return}this.saveQueueState(),this.currentTrack=r;const c=Ca(r),h=Ps(r),f=Ko(r),g=document.querySelector(".now-playing-bar .cover");if(g){const d=r.album?.videoCover?this.api.tidalAPI.getVideoCoverUrl(r.album.videoCover):null,m=d||this.api.getCoverUrl(r.album?.cover);if(d){if(g.tagName==="IMG"){const E=document.createElement("video");E.src=d,E.autoplay=!0,E.loop=!0,E.muted=!0,E.playsInline=!0,E.className=g.className,E.id=g.id,g.replaceWith(E)}}else if(g.tagName==="VIDEO"){const E=document.createElement("img");E.src=m,E.className=g.className,E.id=g.id,g.replaceWith(E)}else g.src=m}document.querySelector(".now-playing-bar .title").innerHTML=`${en(c)} ${Or(r)}`;const y=document.querySelector(".now-playing-bar .album");if(y){const d=r.album?.title||"";d&&d!==c?(y.textContent=d,y.style.display="block"):(y.textContent="",y.style.display="none")}const u=document.querySelector(".now-playing-bar .artist");u.innerHTML=h+f,!f&&r.album?.id&&this.loadAlbumYear(r,h,u);const l=document.getElementById("now-playing-mix-btn");l&&(l.style.display=r.mixes&&r.mixes.TRACK_MIX?"flex":"none"),document.title=`${c} â€¢ ${wa(r)}`,this.updatePlayingTrackIndicator(),this.updateMediaSession(r),this.updateMediaSessionPlaybackState(),this.updateNativeWindow(r);try{let d;const m=r.isTracker||r.id&&String(r.id).startsWith("tracker-");if(m||r.audioUrl&&!r.isLocal){if(this.dashInitialized&&(this.dashPlayer.reset(),this.dashInitialized=!1),d=r.audioUrl,(!d||typeof d=="string"&&d.startsWith("blob:"))&&r.remoteUrl&&(d=r.remoteUrl),!d){console.warn(`Track ${c} audio URL is missing. Skipping.`),r.isUnavailable=!0,this.playNext();return}if(m&&!d.startsWith("blob:")&&d.startsWith("http"))try{const _=await fetch(d);if(_.ok){const M=await _.blob();d=URL.createObjectURL(M)}}catch(_){console.warn("Failed to fetch tracker blob, trying direct link",_)}if(this.currentRgValues=null,this.applyReplayGain(),this.audio.src=d,this.applyAudioEffects(),!await this.waitForCanPlayOrTimeout()||(e>0&&(this.audio.currentTime=e),!await this.safePlay()))return}else if(r.isLocal&&r.file){if(this.dashInitialized&&(this.dashPlayer.reset(),this.dashInitialized=!1),d=URL.createObjectURL(r.file),this.currentRgValues=null,this.applyReplayGain(),this.audio.src=d,this.applyAudioEffects(),!await this.waitForCanPlayOrTimeout()||(e>0&&(this.audio.currentTime=e),!await this.safePlay()))return}else{if(String(r.id).startsWith("q:"))this.currentRgValues=null,this.applyReplayGain(),this.preloadCache.has(r.id)?d=this.preloadCache.get(r.id):d=await this.api.getStreamUrl(r.id,this.quality);else{const S=await this.api.getTrack(r.id,this.quality);S&&S.info?this.currentRgValues={trackReplayGain:S.info.trackReplayGain,trackPeakAmplitude:S.info.trackPeakAmplitude,albumReplayGain:S.info.albumReplayGain,albumPeakAmplitude:S.info.albumPeakAmplitude}:this.currentRgValues=null,this.applyReplayGain(),this.preloadCache.has(r.id)?d=this.preloadCache.get(r.id):S.originalTrackUrl?d=S.originalTrackUrl:S.info?.manifest?d=this.api.extractStreamUrlFromManifest(S.info.manifest):d=await this.api.getStreamUrl(r.id,this.quality)}if(d&&d.startsWith("blob:")&&!r.isLocal)this.dashInitialized?this.dashPlayer.attachSource(d):(this.dashPlayer.initialize(this.audio,d,!0),this.dashInitialized=!0),this.applyAudioEffects(),e>0&&this.dashPlayer.seek(e);else if(this.dashInitialized&&(this.dashPlayer.reset(),this.dashInitialized=!1),this.audio.src=d,this.applyAudioEffects(),!await this.waitForCanPlayOrTimeout()||(e>0&&(this.audio.currentTime=e),!await this.safePlay()))return}this.preloadNextTracks()}catch(d){if(d&&(d.name==="NotAllowedError"||d.name==="AbortError")){this.autoplayBlocked=!0;return}console.error(`Could not play track: ${c}`,d),t<n.length&&setTimeout(()=>this.playNext(t+1),1e3)}}playAtIndex(e){const t=this.shuffleActive?this.shuffledQueue:this.queue;e>=0&&e<t.length&&(this.currentQueueIndex=e,this.playTrackFromQueue(0,0))}playNext(e=0){const t=this.shuffleActive?this.shuffledQueue:this.queue,n=this.currentQueueIndex>=t.length-1;if(e>t.length){console.error("All tracks in queue are unavailable or blocked."),this.audio.pause();return}ta(async()=>{const{contentBlockingSettings:r}=await Promise.resolve().then(()=>ya);return{contentBlockingSettings:r}},void 0,import.meta.url).then(({contentBlockingSettings:r})=>{if(this.repeatMode===xa.ONE&&!t[this.currentQueueIndex]?.isUnavailable&&!r.shouldHideTrack(t[this.currentQueueIndex])){this.playTrackFromQueue(0,e);return}if(n)if(this.repeatMode===xa.ALL){this.currentQueueIndex=0;const i=t[this.currentQueueIndex];if(i?.isUnavailable||r.shouldHideTrack(i))return this.playNext(e+1)}else return;else{this.currentQueueIndex++;const i=t[this.currentQueueIndex];if(i?.isUnavailable||r.shouldHideTrack(i))return this.playNext(e+1)}this.playTrackFromQueue(0,e)})}playPrev(e=0){if(this.audio.currentTime>3)this.audio.currentTime=0,this.updateMediaSessionPositionState();else if(this.currentQueueIndex>0){this.currentQueueIndex--;const t=this.shuffleActive?this.shuffledQueue:this.queue;if(e>t.length){console.error("All tracks in queue are unavailable or blocked."),this.audio.pause();return}ta(async()=>{const{contentBlockingSettings:n}=await Promise.resolve().then(()=>ya);return{contentBlockingSettings:n}},void 0,import.meta.url).then(({contentBlockingSettings:n})=>{const r=t[this.currentQueueIndex];if(r?.isUnavailable||n.shouldHideTrack(r))return this.playPrev(e+1);this.playTrackFromQueue(0,e)})}}handlePlayPause(){if(!this.audio.src||this.audio.error){this.currentTrack&&this.playTrackFromQueue(0,0);return}this.audio.paused?this.safePlay().catch(e=>{e.name==="NotAllowedError"||e.name==="AbortError"||(console.error("Play failed, reloading track:",e),this.currentTrack&&this.playTrackFromQueue(0,0))}):(this.audio.pause(),this.saveQueueState())}seekBackward(e=10){const t=Math.max(0,this.audio.currentTime-e);this.audio.currentTime=t,this.updateMediaSessionPositionState()}seekForward(e=10){const t=this.audio.duration||0,n=Math.min(t,this.audio.currentTime+e);this.audio.currentTime=n,this.updateMediaSessionPositionState()}toggleShuffle(){if(this.shuffleActive=!this.shuffleActive,this.shuffleActive){this.originalQueueBeforeShuffle=[...this.queue];const e=this.queue[this.currentQueueIndex],t=[...this.queue];e&&this.currentQueueIndex>=0&&t.splice(this.currentQueueIndex,1);for(let n=t.length-1;n>0;n--){const r=Math.floor(Math.random()*(n+1));[t[n],t[r]]=[t[r],t[n]]}e?(this.shuffledQueue=[e,...t],this.currentQueueIndex=0):(this.shuffledQueue=t,this.currentQueueIndex=-1)}else{const e=this.shuffledQueue[this.currentQueueIndex];this.queue=[...this.originalQueueBeforeShuffle],this.currentQueueIndex=this.queue.findIndex(t=>t.id===e?.id)}this.preloadCache.clear(),this.preloadNextTracks(),this.saveQueueState()}toggleRepeat(){return this.repeatMode=(this.repeatMode+1)%3,this.saveQueueState(),this.repeatMode}setQueue(e,t=0){this.queue=e,this.currentQueueIndex=t,this.shuffleActive=!1,this.preloadCache.clear(),this.saveQueueState()}addToQueue(e){const t=Array.isArray(e)?e:[e];this.queue.push(...t),this.shuffleActive&&(this.shuffledQueue.push(...t),this.originalQueueBeforeShuffle.push(...t)),(!this.currentTrack||this.currentQueueIndex===-1)&&(this.currentQueueIndex=this.getCurrentQueue().length-t.length,this.playTrackFromQueue(0,0)),this.saveQueueState()}addNextToQueue(e){const t=Array.isArray(e)?e:[e],n=this.shuffleActive?this.shuffledQueue:this.queue,r=this.currentQueueIndex+1;n.splice(r,0,...t),this.shuffleActive&&this.originalQueueBeforeShuffle.push(...t),this.saveQueueState(),this.preloadNextTracks()}removeFromQueue(e){const t=this.shuffleActive?this.shuffledQueue:this.queue;this.currentQueueIndex,e<this.currentQueueIndex&&this.currentQueueIndex--;const n=t.splice(e,1)[0];if(this.shuffleActive){const r=this.originalQueueBeforeShuffle.findIndex(i=>i.id===n.id);r!==-1&&this.originalQueueBeforeShuffle.splice(r,1)}this.saveQueueState(),this.preloadNextTracks()}clearQueue(){this.currentTrack?(this.queue=[this.currentTrack],this.shuffleActive?(this.shuffledQueue=[this.currentTrack],this.originalQueueBeforeShuffle=[this.currentTrack]):(this.shuffledQueue=[],this.originalQueueBeforeShuffle=[]),this.currentQueueIndex=0):(this.queue=[],this.shuffledQueue=[],this.originalQueueBeforeShuffle=[],this.currentQueueIndex=-1),this.preloadCache.clear(),this.saveQueueState()}moveInQueue(e,t){const n=this.shuffleActive?this.shuffledQueue:this.queue;if(e<0||e>=n.length||t<0||t>=n.length)return;const[r]=n.splice(e,1);n.splice(t,0,r),this.currentQueueIndex===e?this.currentQueueIndex=t:e<this.currentQueueIndex&&t>=this.currentQueueIndex?this.currentQueueIndex--:e>this.currentQueueIndex&&t<=this.currentQueueIndex&&this.currentQueueIndex++,this.saveQueueState()}getCurrentQueue(){return this.shuffleActive?this.shuffledQueue:this.queue}getNextTrack(){const e=this.getCurrentQueue();if(this.currentQueueIndex===-1||e.length===0)return null;const t=this.currentQueueIndex+1;return t<e.length?e[t]:this.repeatMode===xa.ALL?e[0]:null}loadAlbumYear(e,t,n){Ds.useAlbumYear()&&this.api.getAlbum(e.album.id).then(({album:r})=>{if(r?.releaseDate&&this.currentTrack?.id===e.id){e.album.releaseDate=r.releaseDate;const i=new Date(r.releaseDate).getFullYear();!isNaN(i)&&n&&(n.innerHTML=`${t} â€¢ ${i}`)}}).catch(()=>{})}updatePlayingTrackIndicator(){const e=this.getCurrentQueue()[this.currentQueueIndex];document.querySelectorAll(".track-item").forEach(t=>{t.classList.toggle("playing",e&&t.dataset.trackId==e.id)}),document.querySelectorAll(".queue-track-item").forEach(t=>{const n=parseInt(t.dataset.queueIndex);t.classList.toggle("playing",n===this.currentQueueIndex)})}updateMediaSession(e){if(!("mediaSession"in navigator))return;navigator.mediaSession.metadata=null;const t=[],n=["320"],r=e.album?.cover,i=Ca(e);r&&n.forEach(c=>{t.push({src:this.api.getCoverUrl(r,c),sizes:`${c}x${c}`,type:"image/jpeg"})}),navigator.mediaSession.metadata=new MediaMetadata({title:i||"Unknown Title",artist:wa(e)||"Unknown Artist",album:e.album?.title||"Unknown Album",artwork:t.length>0?t:void 0}),this.updateMediaSessionPlaybackState(),this.updateMediaSessionPositionState()}updateMediaSessionPlaybackState(){"mediaSession"in navigator&&(navigator.mediaSession.playbackState=this.audio.paused?"paused":"playing")}updateMediaSessionPositionState(){if(!("mediaSession"in navigator)||!("setPositionState"in navigator.mediaSession))return;const e=this.audio.duration;if(!(!e||isNaN(e)||!isFinite(e)))try{navigator.mediaSession.setPositionState({duration:e,playbackRate:this.audio.playbackRate||1,position:Math.min(this.audio.currentTime,e)})}catch(t){console.log("Failed to update Media Session position:",t)}}async safePlay(){try{return await this.audio.play(),this.autoplayBlocked=!1,!0}catch(e){if(e&&(e.name==="NotAllowedError"||e.name==="AbortError"))return this.autoplayBlocked=!0,!1;throw e}}async waitForCanPlayOrTimeout(e=1e4){return this.audio.readyState>=2?!0:await new Promise((t,n)=>{const r=()=>{this.audio.removeEventListener("canplay",r),this.audio.removeEventListener("error",i),t(!0)},i=c=>{this.audio.removeEventListener("canplay",r),this.audio.removeEventListener("error",i),n(c)};this.audio.addEventListener("canplay",r),this.audio.addEventListener("error",i),setTimeout(()=>{if(this.audio.removeEventListener("canplay",r),this.audio.removeEventListener("error",i),document.visibilityState==="hidden"||this.isIOS&&this.isPwa){this.autoplayBlocked=!0,t(!1);return}n(new Error("Timeout waiting for audio to load"))},e)})}setSleepTimer(e){this.clearSleepTimer(),this.sleepTimerEndTime=Date.now()+e*60*1e3,this.sleepTimer=setTimeout(()=>{this.audio.pause(),this.clearSleepTimer(),this.updateSleepTimerUI()},e*60*1e3),this.sleepTimerInterval=setInterval(()=>{this.updateSleepTimerUI()},1e3),this.updateSleepTimerUI()}clearSleepTimer(){this.sleepTimer&&(clearTimeout(this.sleepTimer),this.sleepTimer=null),this.sleepTimerInterval&&(clearInterval(this.sleepTimerInterval),this.sleepTimerInterval=null),this.sleepTimerEndTime=null,this.updateSleepTimerUI()}getSleepTimerRemaining(){if(!this.sleepTimerEndTime)return null;const e=Math.max(0,this.sleepTimerEndTime-Date.now());return Math.ceil(e/1e3)}isSleepTimerActive(){return this.sleepTimer!==null}updateSleepTimerUI(){const e=document.getElementById("sleep-timer-btn"),t=document.getElementById("sleep-timer-btn-desktop"),n=r=>{if(r)if(this.isSleepTimerActive()){const i=this.getSleepTimerRemaining();if(i>0){const c=Math.floor(i/60),h=i%60;r.innerHTML=`<span style="font-size: 12px; font-weight: bold;">${c}:${h.toString().padStart(2,"0")}</span>`,r.title=`Sleep Timer: ${c}:${h.toString().padStart(2,"0")} remaining`,r.classList.add("active"),r.style.color="var(--primary)"}else r.innerHTML=`
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12,6 12,12 16,14"/>
                        </svg>
                    `,r.title="Sleep Timer",r.classList.remove("active"),r.style.color=""}else r.innerHTML=`
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"/>
                        <polyline points="12,6 12,12 16,14"/>
                    </svg>
                `,r.title="Sleep Timer",r.classList.remove("active"),r.style.color=""};n(e),n(t)}async updateNativeWindow(e){if(!window.Neutralino)return;const t=Ca(e),n=wa(e);try{await Neutralino.window.setTitle(`${t} â€¢ ${n}`)}catch(r){console.error("Failed to set window title:",r)}}}class hE{constructor(){this.DEFAULT_API_KEY="85214f5abbc730e78770f27784b9bdf7",this.DEFAULT_API_SECRET="2c2c37fd86739191860db810dd063292",this.API_URL="https://ws.audioscrobbler.com/2.0/",this.sessionKey=null,this.username=null,this.currentTrack=null,this.scrobbleTimer=null,this.scrobbleThreshold=0,this.hasScrobbled=!1,this.isScrobbling=!1,this.loadCredentials(),this.loadSession()}loadCredentials(){Xa.useCustomCredentials()?(this.API_KEY=Xa.getCustomApiKey()||this.DEFAULT_API_KEY,this.API_SECRET=Xa.getCustomApiSecret()||this.DEFAULT_API_SECRET):(this.API_KEY=this.DEFAULT_API_KEY,this.API_SECRET=this.DEFAULT_API_SECRET)}reloadCredentials(){this.loadCredentials()}loadSession(){try{const e=localStorage.getItem("lastfm-session");if(e){const t=JSON.parse(e);this.sessionKey=t.key,this.username=t.name}}catch{console.error("Failed to load Last.fm session")}}saveSession(e,t){this.sessionKey=e,this.username=t,localStorage.setItem("lastfm-session",JSON.stringify({key:e,name:t}))}clearSession(){this.sessionKey=null,this.username=null,localStorage.removeItem("lastfm-session")}isAuthenticated(){return!!this.sessionKey&&Xa.isEnabled()}_getScrobbleArtist(e){if(!e)return"Unknown Artist";let t="Unknown Artist";if(e.artist?.name)t=e.artist.name;else if(typeof e.artist=="string")t=e.artist;else if(e.artists&&e.artists.length>0){const n=e.artists[0];t=typeof n=="string"?n:n.name||"Unknown Artist"}return typeof t!="string"?"Unknown Artist":(t=t.split(/\s*[&]\s*|\s+feat\.?\s+|\s+ft\.?\s+|\s+featuring\s+|\s+with\s+|\s+x\s+/i)[0].trim(),t||"Unknown Artist")}async generateSignature(e){const t={...e};delete t.format,delete t.callback;const r=Object.keys(t).sort().map(i=>`${i}${t[i]}`).join("")+this.API_SECRET;console.log("Signature string:",r);try{const{default:i}=await ta(async()=>{const{default:c}=await import("./md5-C6HA0SOy.js");return{default:c}},[],import.meta.url);return i(r)}catch(i){throw console.error("MD5 library not available",i),new Error("MD5 library required for Last.fm")}}async makeRequest(e,t={},n=!1){const r={method:e,api_key:this.API_KEY,...t};n&&this.sessionKey&&(r.sk=this.sessionKey);const i=await this.generateSignature(r),c=new URLSearchParams({...r,api_sig:i,format:"json"});try{const f=await(await fetch(this.API_URL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c})).json();if(f.error)throw new Error(f.message||"Last.fm API error");return f}catch(h){throw console.error("Last.fm API request failed:",h),h}}async getAuthUrl(){try{const t=(await this.makeRequest("auth.getToken")).token;return{token:t,url:`https://www.last.fm/api/auth/?api_key=${this.API_KEY}&token=${t}`}}catch(e){throw console.error("Failed to get auth URL:",e),e}}async completeAuthentication(e){try{const t=await this.makeRequest("auth.getSession",{token:e});if(t.session)return this.saveSession(t.session.key,t.session.name),{success:!0,username:t.session.name};throw new Error("No session returned")}catch(t){throw console.error("Authentication failed:",t),t}}async authenticateWithCredentials(e,t){try{const n={username:e,password:t,api_key:this.API_KEY,method:"auth.getMobileSession"},r=await this.generateSignature(n),i=new URLSearchParams({username:e,password:t,api_key:this.API_KEY,method:"auth.getMobileSession",api_sig:r,format:"json"}),h=await(await fetch(this.API_URL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i})).json();if(h.error)throw new Error(h.message||"Last.fm authentication error");if(h.session)return this.saveSession(h.session.key,h.session.name),{success:!0,username:h.session.name};throw new Error("No session returned")}catch(n){throw console.error("Mobile authentication failed:",n),n}}async updateNowPlaying(e){if(this.isAuthenticated()){this.currentTrack=e,this.isScrobbling||(this.hasScrobbled=!1),this.clearScrobbleTimer();try{const t=e.cleanTitle||e.title,n={artist:this._getScrobbleArtist(e),track:t};e.album?.title&&(n.album=e.album.title),e.duration&&(n.duration=Math.floor(e.duration)),e.trackNumber&&(n.trackNumber=e.trackNumber),await this.makeRequest("track.updateNowPlaying",n,!0),console.log("Now playing updated:",t);const r=Xa.getScrobblePercentage()/100;this.scrobbleThreshold=Math.min(e.duration*r,240),this.scheduleScrobble(this.scrobbleThreshold*1e3)}catch(t){console.error("Failed to update now playing:",t)}}}scheduleScrobble(e){this.clearScrobbleTimer(),this.scrobbleTimer=setTimeout(()=>{this.scrobbleCurrentTrack()},e)}clearScrobbleTimer(){this.scrobbleTimer&&(clearTimeout(this.scrobbleTimer),this.scrobbleTimer=null)}async scrobbleCurrentTrack(){if(!(!this.isAuthenticated()||!this.currentTrack||this.hasScrobbled)){this.isScrobbling=!0;try{const e=Math.floor(Date.now()/1e3),t=this.currentTrack.cleanTitle||this.currentTrack.title,n={artist:this._getScrobbleArtist(this.currentTrack),track:t,timestamp:e};this.currentTrack.album?.title&&(n.album=this.currentTrack.album.title),this.currentTrack.duration&&(n.duration=Math.floor(this.currentTrack.duration)),this.currentTrack.trackNumber&&(n.trackNumber=this.currentTrack.trackNumber),await this.makeRequest("track.scrobble",n,!0),this.hasScrobbled=!0,console.log("Scrobbled:",this.currentTrack.cleanTitle||this.currentTrack.title)}catch(e){console.error("Failed to scrobble:",e)}finally{this.isScrobbling=!1}}}async loveTrack(e){if(this.isAuthenticated())try{const t={artist:this._getScrobbleArtist(e),track:e.title};await this.makeRequest("track.love",t,!0),console.log("Loved track on Last.fm:",e.title)}catch(t){console.error("Failed to love track on Last.fm:",t)}}onTrackChange(e){this.isAuthenticated()&&this.updateNowPlaying(e)}onPlaybackStop(){this.clearScrobbleTimer()}disconnect(){this.clearSession(),this.clearScrobbleTimer(),this.currentTrack=null}}class mE{constructor(){this.DEFAULT_API_URL="https://api.listenbrainz.org/1",this.currentTrack=null,this.scrobbleTimer=null,this.scrobbleThreshold=0,this.hasScrobbled=!1,this.isScrobbling=!1}getApiUrl(){return Oi.getCustomUrl()||this.DEFAULT_API_URL}isEnabled(){return Oi.isEnabled()&&!!Oi.getToken()}getToken(){return Oi.getToken()}_getMetadata(e){if(!e)return null;let t="Unknown Artist";if(e.artist?.name)t=e.artist.name;else if(typeof e.artist=="string")t=e.artist;else if(e.artists&&e.artists.length>0){const r=e.artists[0];t=typeof r=="string"?r:r.name||"Unknown Artist"}typeof t=="string"&&(t=t.split(/\s*[&]\s*|\s+feat\.?\s+|\s+ft\.?\s+|\s+featuring\s+|\s+with\s+|\s+x\s+/i)[0].trim());const n={artist_name:t,track_name:e.cleanTitle||e.title,additional_info:{submission_client:"Monochrome",submission_client_version:"1.0.0"}};return e.album?.title&&(n.release_name=e.album.title),e.duration&&(n.additional_info.duration=Math.floor(e.duration)),e.trackNumber&&(n.additional_info.track_number=e.trackNumber),e.isLocal&&(n.additional_info.is_local=!0),n}async submitListen(e,t,n=null){if(!this.isEnabled())return;const r=this._getMetadata(t);if(!r)return;const i=[{track_metadata:r}];n&&(i[0].listened_at=n);const c={listen_type:e,payload:i};try{const h=this.getApiUrl(),f=await fetch(`${h}/submit-listens`,{method:"POST",headers:{Authorization:`Token ${this.getToken()}`,"Content-Type":"application/json"},body:JSON.stringify(c)});if(!f.ok){const g=await f.text();throw new Error(`ListenBrainz API Error ${f.status}: ${g}`)}console.log(`[ListenBrainz] Submitted ${e}: ${r.track_name}`)}catch(h){console.error("[ListenBrainz] Submission failed:",h)}}async updateNowPlaying(e){if(!this.isEnabled())return;this.currentTrack=e,this.isScrobbling||(this.hasScrobbled=!1),this.clearScrobbleTimer(),await this.submitListen("playing_now",e);const t=Xa.getScrobblePercentage()/100;this.scrobbleThreshold=Math.min(e.duration*t,240),this.scheduleScrobble(this.scrobbleThreshold*1e3)}scheduleScrobble(e){this.clearScrobbleTimer(),this.scrobbleTimer=setTimeout(()=>{this.scrobbleCurrentTrack()},e)}clearScrobbleTimer(){this.scrobbleTimer&&(clearTimeout(this.scrobbleTimer),this.scrobbleTimer=null)}async scrobbleCurrentTrack(){if(!(!this.isEnabled()||!this.currentTrack||this.hasScrobbled)){this.isScrobbling=!0;try{const e=Math.floor(Date.now()/1e3);await this.submitListen("single",this.currentTrack,e),this.hasScrobbled=!0}finally{this.isScrobbling=!1}}}onTrackChange(e){this.updateNowPlaying(e)}onPlaybackStop(){this.clearScrobbleTimer()}disconnect(){this.clearScrobbleTimer(),this.currentTrack=null}}class gE{constructor(){this.currentTrack=null,this.scrobbleTimer=null,this.scrobbleThreshold=0,this.hasScrobbled=!1,this.isScrobbling=!1}getApiUrl(){const e=zi.getCustomUrl();return e?e.replace(/\/$/,""):""}isEnabled(){return zi.isEnabled()&&!!zi.getToken()&&!!this.getApiUrl()}getApiKey(){return zi.getToken()}_getScrobbleArtist(e){if(!e)return"Unknown Artist";let t="Unknown Artist";if(e.artist?.name)t=e.artist.name;else if(typeof e.artist=="string")t=e.artist;else if(e.artists&&e.artists.length>0){const n=e.artists[0];t=typeof n=="string"?n:n.name||"Unknown Artist"}return typeof t!="string"?"Unknown Artist":(t=t.split(/\s*[&]\s*|\s+feat\.?\s+|\s+ft\.?\s+|\s+featuring\s+|\s+with\s+|\s+x\s+/i)[0].trim(),t||"Unknown Artist")}async submitScrobble(e,t=null){if(!this.isEnabled())return;const n=this.getApiUrl(),r=this.getApiKey();if(!n||!r)return;const i=this._getScrobbleArtist(e),c=e.cleanTitle||e.title,h={artist:i,title:c,key:r};e.album?.title&&(h.album=e.album.title),e.duration&&(h.duration=Math.floor(e.duration)),e.trackNumber&&(h.track_number=e.trackNumber),t&&(h.time=t);try{let f=await fetch(`${n}/apis/mlj_1/newscrobble`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(h)});if(f.ok||(f=await fetch(`${n}/apis/native/newscrobble`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(h)})),!f.ok){const g=await f.text();throw new Error(`Maloja API Error ${f.status}: ${g}`)}console.log(`[Maloja] Submitted scrobble: ${c} by ${i}`)}catch(f){console.error("[Maloja] Submission failed:",f)}}async updateNowPlaying(e){if(!this.isEnabled())return;this.currentTrack=e,this.isScrobbling||(this.hasScrobbled=!1),this.clearScrobbleTimer();const t=Xa.getScrobblePercentage()/100;this.scrobbleThreshold=Math.min(e.duration*t,240),this.scheduleScrobble(this.scrobbleThreshold*1e3)}scheduleScrobble(e){this.clearScrobbleTimer(),this.scrobbleTimer=setTimeout(()=>{this.scrobbleCurrentTrack()},e)}clearScrobbleTimer(){this.scrobbleTimer&&(clearTimeout(this.scrobbleTimer),this.scrobbleTimer=null)}async scrobbleCurrentTrack(){if(!(!this.isEnabled()||!this.currentTrack||this.hasScrobbled)){this.isScrobbling=!0;try{const e=Math.floor(Date.now()/1e3);await this.submitScrobble(this.currentTrack,e),this.hasScrobbled=!0}finally{this.isScrobbling=!1}}}onTrackChange(e){this.updateNowPlaying(e)}onPlaybackStop(){this.clearScrobbleTimer()}disconnect(){this.clearScrobbleTimer(),this.currentTrack=null}}class pE{constructor(){this.API_KEY="monochrome_music_app",this.API_SECRET="monochrome_music_secret_2024",this.API_URL="https://libre.fm/2.0/",this.sessionKey=null,this.username=null,this.currentTrack=null,this.scrobbleTimer=null,this.scrobbleThreshold=0,this.hasScrobbled=!1,this.isScrobbling=!1,this.loadSession()}loadSession(){try{const e=localStorage.getItem("librefm-session");if(e){const t=JSON.parse(e);this.sessionKey=t.key,this.username=t.name}}catch{console.error("Failed to load Libre.fm session")}}saveSession(e,t){this.sessionKey=e,this.username=t,localStorage.setItem("librefm-session",JSON.stringify({key:e,name:t}))}clearSession(){this.sessionKey=null,this.username=null,localStorage.removeItem("librefm-session")}isAuthenticated(){return!!this.sessionKey&&Cs.isEnabled()}_getScrobbleArtist(e){if(!e)return"Unknown Artist";let t="Unknown Artist";if(e.artist?.name)t=e.artist.name;else if(typeof e.artist=="string")t=e.artist;else if(e.artists&&e.artists.length>0){const n=e.artists[0];t=typeof n=="string"?n:n.name||"Unknown Artist"}return typeof t!="string"?"Unknown Artist":(t=t.split(/\s*[&]\s*|\s+feat\.?\s+|\s+ft\.?\s+|\s+featuring\s+|\s+with\s+|\s+x\s+/i)[0].trim(),t||"Unknown Artist")}async generateSignature(e){const t={...e};delete t.format,delete t.callback;const r=Object.keys(t).sort().map(i=>`${i}${t[i]}`).join("")+this.API_SECRET;try{const{default:i}=await ta(async()=>{const{default:c}=await import("./md5-C6HA0SOy.js");return{default:c}},[],import.meta.url);return i(r)}catch{throw console.error("MD5 library not available"),new Error("MD5 library required for Libre.fm")}}async makeRequest(e,t={},n=!1){const r={method:e,api_key:this.API_KEY,...t};n&&this.sessionKey&&(r.sk=this.sessionKey);const i=await this.generateSignature(r),c=new URLSearchParams({...r,api_sig:i,format:"json"});try{const f=await(await fetch(this.API_URL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c})).json();if(f.error)throw new Error(f.message||"Libre.fm API error");return f}catch(h){throw console.error("Libre.fm API request failed:",h),h}}async getAuthUrl(){try{const t=(await this.makeRequest("auth.getToken")).token;return localStorage.setItem("librefm-pending-token",t),{token:t,url:`https://libre.fm/api/auth/?api_key=${this.API_KEY}&token=${t}`}}catch(e){throw console.error("Failed to get auth URL:",e),e}}async completeAuthentication(e){try{const t=await this.makeRequest("auth.getSession",{token:e});if(t.session)return this.saveSession(t.session.key,t.session.name),localStorage.removeItem("librefm-pending-token"),{success:!0,username:t.session.name};throw new Error("No session returned")}catch(t){throw console.error("Authentication failed:",t),t}}async updateNowPlaying(e){if(this.isAuthenticated()){this.currentTrack=e,this.isScrobbling||(this.hasScrobbled=!1),this.clearScrobbleTimer();try{const t=e.cleanTitle||e.title,n={artist:this._getScrobbleArtist(e),track:t};e.album?.title&&(n.album=e.album.title),e.duration&&(n.duration=Math.floor(e.duration)),e.trackNumber&&(n.trackNumber=e.trackNumber),await this.makeRequest("track.updateNowPlaying",n,!0),console.log("[Libre.fm] Now playing updated:",t);const r=Xa.getScrobblePercentage()/100;this.scrobbleThreshold=Math.min(e.duration*r,240),this.scheduleScrobble(this.scrobbleThreshold*1e3)}catch(t){console.error("[Libre.fm] Failed to update now playing:",t)}}}scheduleScrobble(e){this.clearScrobbleTimer(),this.scrobbleTimer=setTimeout(()=>{this.scrobbleCurrentTrack()},e)}clearScrobbleTimer(){this.scrobbleTimer&&(clearTimeout(this.scrobbleTimer),this.scrobbleTimer=null)}async scrobbleCurrentTrack(){if(!(!this.isAuthenticated()||!this.currentTrack||this.hasScrobbled)){this.isScrobbling=!0;try{const e=Math.floor(Date.now()/1e3),t=this.currentTrack.cleanTitle||this.currentTrack.title,n={artist:this._getScrobbleArtist(this.currentTrack),track:t,timestamp:e};this.currentTrack.album?.title&&(n.album=this.currentTrack.album.title),this.currentTrack.duration&&(n.duration=Math.floor(this.currentTrack.duration)),this.currentTrack.trackNumber&&(n.trackNumber=this.currentTrack.trackNumber),await this.makeRequest("track.scrobble",n,!0),this.hasScrobbled=!0,console.log("[Libre.fm] Scrobbled:",this.currentTrack.cleanTitle||this.currentTrack.title)}catch(e){console.error("[Libre.fm] Failed to scrobble:",e)}finally{this.isScrobbling=!1}}}async loveTrack(e){if(this.isAuthenticated())try{const t={artist:this._getScrobbleArtist(e),track:e.title};await this.makeRequest("track.love",t,!0),console.log("[Libre.fm] Loved track:",e.title)}catch(t){console.error("[Libre.fm] Failed to love track:",t)}}onTrackChange(e){this.isAuthenticated()&&this.updateNowPlaying(e)}onPlaybackStop(){this.clearScrobbleTimer()}disconnect(){this.clearSession(),this.clearScrobbleTimer(),this.currentTrack=null}}class yE{constructor(){this.lastfm=new hE,this.listenbrainz=new mE,this.maloja=new gE,this.librefm=new pE}getLastFM(){return this.lastfm}getLibreFm(){return this.librefm}isAuthenticated(){return this.lastfm.isAuthenticated()||this.listenbrainz.isEnabled()||this.maloja.isEnabled()||this.librefm.isAuthenticated()}updateNowPlaying(e){this.lastfm.updateNowPlaying(e),this.listenbrainz.updateNowPlaying(e),this.maloja.updateNowPlaying(e),this.librefm.updateNowPlaying(e)}onTrackChange(e){this.lastfm.onTrackChange(e),this.listenbrainz.onTrackChange(e),this.maloja.onTrackChange(e),this.librefm.onTrackChange(e)}onPlaybackStop(){this.lastfm.onPlaybackStop(),this.listenbrainz.onPlaybackStop(),this.maloja.onPlaybackStop(),this.librefm.onPlaybackStop()}async loveTrack(e){await this.lastfm.loveTrack(e),await this.librefm.loveTrack(e)}}class bE{constructor(){this.audioContext=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,1,44100),this.cache=new Map}async getWaveform(e,t){if(this.cache.has(t))return this.cache.get(t);try{const r=await(await fetch(e)).arrayBuffer(),i=await this.audioContext.decodeAudioData(r),h={peaks:this.extractPeaks(i),duration:i.duration};return this.cache.set(t,h),h}catch(n){return console.error("Waveform generation failed:",n),null}}extractPeaks(e){const{length:t,duration:n}=e,r=Math.min(Math.floor(4*n),1e3),i=new Float32Array(r),c=e.getChannelData(0),h=Math.floor(t/r),f=8;for(let y=0;y<r;y++){let u=0;const l=y*h,d=l+h;for(let m=l;m<d;m+=f){const E=c[m];E>u?u=E:-E>u&&(u=-E)}i[y]=u}let g=0;for(let y=0;y<r;y++)i[y]>g&&(g=i[y]);if(g>0)for(let y=0;y<r;y++)i[y]/=g;return i}drawWaveform(e,t){if(!e||!t)return;const n=e.getContext("2d"),r=e.width,i=e.height;n.clearRect(0,0,r,i);const c=r/t.length,h=i/2;n.fillStyle="#000",n.beginPath(),n.moveTo(0,h);for(let f=0;f<t.length;f++){const g=t[f],y=Math.max(1.5,g*i*.9);n.lineTo(f*c,h-y/2)}for(let f=t.length-1;f>=0;f--){const g=t[f],y=Math.max(1.5,g*i*.9);n.lineTo(f*c,h+y/2)}n.closePath(),n.fill()}}const xd=new bE;let ws=null;function EE(o,e,t,n){const r=document.querySelector(".now-playing-bar .play-pause-btn"),i=document.getElementById("next-btn"),c=document.getElementById("prev-btn"),h=document.getElementById("shuffle-btn"),f=document.getElementById("repeat-btn"),g=document.getElementById("sleep-timer-btn-desktop"),y=document.getElementById("sleep-timer-btn");let u=null;e.addEventListener("loadstart",()=>{u=null}),o.shuffleActive&&h.classList.add("active"),o.repeatMode&&o.repeatMode!==xa.OFF?(f.classList.add("active"),o.repeatMode===xa.ONE&&f.classList.add("repeat-one"),f.title=o.repeatMode===xa.ALL?"Repeat Queue":"Repeat One"):f.title="Repeat",e.addEventListener("play",()=>{Zn.isReady()||Zn.init(e),Zn.resume(),o.currentTrack&&(Up(o.currentTrack),t.isAuthenticated()&&t.updateNowPlaying(o.currentTrack),E()),r.innerHTML=Vg,o.updateMediaSessionPlaybackState(),o.updateMediaSessionPositionState(),rl(o)}),e.addEventListener("playing",()=>{o.updateMediaSessionPlaybackState(),o.updateMediaSessionPositionState()}),e.addEventListener("pause",()=>{o.currentTrack&&Bp(o.currentTrack),r.innerHTML=cr,o.updateMediaSessionPlaybackState(),o.updateMediaSessionPositionState()}),e.addEventListener("ended",()=>{o.playNext()}),e.addEventListener("timeupdate",async()=>{const{currentTime:R,duration:W}=e;if(W){const fe=document.getElementById("progress-fill"),ye=document.getElementById("current-time");if(fe.style.width=`${R/W*100}%`,ye.textContent=Ma(R),R>=10&&o.currentTrack&&o.currentTrack.id!==u){u=o.currentTrack.id;const Y=await nn.addToHistory(o.currentTrack);On.syncHistoryItem(Y),window.location.hash==="#recent"&&n.renderRecentPage()}}}),e.addEventListener("loadedmetadata",()=>{const R=document.getElementById("total-duration");R.textContent=Ma(e.duration),o.updateMediaSessionPositionState()}),e.addEventListener("error",async R=>{console.error("Audio playback error:",R),r.innerHTML=cr;const W=o.quality;if(o.currentTrack&&W==="HI_RES_LOSSLESS"&&!o.currentTrack.isLocal&&!o.currentTrack.isTracker&&!o.isFallbackRetry){console.warn("Playback failed, attempting fallback to LOSSLESS quality..."),o.isFallbackRetry=!0;try{const fe=o.currentTrack.id,ye=await o.api.getStreamUrl(fe,"LOSSLESS");if(ye){o.dashInitialized&&(o.dashPlayer.reset(),o.dashInitialized=!1),e.src=ye,e.load(),await e.play(),setTimeout(()=>{o.isFallbackRetry=!1},5e3);return}}catch(fe){console.error("Fallback failed:",fe)}}o.isFallbackRetry=!1,o.currentTrack&&(console.warn("Skipping to next track due to playback error"),setTimeout(()=>o.playNext(),1e3))}),r.addEventListener("click",()=>o.handlePlayPause()),i.addEventListener("click",()=>{ld(o.currentTrack,"next"),o.playNext()}),c.addEventListener("click",()=>{ld(o.currentTrack,"previous"),o.playPrev()}),h.addEventListener("click",()=>{o.toggleShuffle(),Fp(o.shuffleActive),h.classList.toggle("active",o.shuffleActive),window.renderQueueFunction&&window.renderQueueFunction()}),f.addEventListener("click",()=>{const R=o.toggleRepeat();qp(R===xa.OFF?"off":R===xa.ALL?"all":"one"),f.classList.toggle("active",R!==xa.OFF),f.classList.toggle("repeat-one",R===xa.ONE),f.title=R===xa.OFF?"Repeat":R===xa.ALL?"Repeat Queue":"Repeat One"}),g&&g.addEventListener("click",()=>{o.isSleepTimerActive()?(o.clearSleepTimer(),dd(),Dn("Sleep timer cancelled")):Cd(o)}),y&&y.addEventListener("click",()=>{o.isSleepTimerActive()?(o.clearSleepTimer(),dd(),Dn("Sleep timer cancelled")):Cd(o)});const l=document.getElementById("volume-bar"),d=document.getElementById("volume-fill"),m=document.getElementById("volume-btn"),E=async()=>{const R=document.getElementById("progress-bar"),W=document.querySelector(".player-controls"),fe=o.currentTrack&&(o.currentTrack.isTracker||o.currentTrack.id&&String(o.currentTrack.id).startsWith("tracker-"));if(!Od.isEnabled()||!o.currentTrack||fe){R&&(R.style.webkitMaskImage="",R.style.maskImage="",R.classList.remove("has-waveform","waveform-loaded")),W&&W.classList.remove("waveform-loaded"),ws=null;return}if(R&&ws!==o.currentTrack.id){ws=o.currentTrack.id,R.classList.add("has-waveform"),R.classList.remove("waveform-loaded"),W&&W.classList.remove("waveform-loaded"),R.style.webkitMaskImage="",R.style.maskImage="";try{const ye=await o.api.getStreamUrl(o.currentTrack.id,"LOW"),Y=await xd.getWaveform(ye,o.currentTrack.id);if(Y&&ws===o.currentTrack.id){let{peaks:j,duration:se}=Y;const Te=o.currentTrack.duration;if(Te&&se&&se<Te){const we=Te-se;if(we>.5){const ce=j.length/se,he=Math.floor(we*ce);if(he>0){const Pe=new Float32Array(j.length+he);Pe.set(j,he),j=Pe}}}const Ae=document.createElement("canvas"),ze=R.getBoundingClientRect();Ae.width=ze.width||500,Ae.height=28,xd.drawWaveform(Ae,j);const de=Ae.toDataURL();R.style.webkitMaskImage=`url(${de})`,R.style.webkitMaskSize="100% 100%",R.style.webkitMaskRepeat="no-repeat",R.style.maskImage=`url(${de})`,R.style.maskSize="100% 100%",R.style.maskRepeat="no-repeat",R.classList.add("waveform-loaded"),W&&W.classList.add("waveform-loaded")}}catch(ye){console.error("Failed to load waveform mask:",ye)}}};window.addEventListener("waveform-toggle",R=>{if(!R.detail.enabled){const W=document.getElementById("progress-bar"),fe=document.querySelector(".player-controls");W&&(W.style.webkitMaskImage="",W.style.maskImage="",W.classList.remove("has-waveform","waveform-loaded")),fe&&fe.classList.remove("waveform-loaded")}E()});const S=()=>{const{muted:R}=e,W=o.userVolume;m.innerHTML=R||W===0?Yd:Gd;const fe=R?0:W*100;d.style.setProperty("--volume-level",`${fe}%`),d.style.width=`${fe}%`};m.addEventListener("click",()=>{e.muted=!e.muted,localStorage.setItem("muted",e.muted)}),e.addEventListener("volumechange",S);const _=parseFloat(localStorage.getItem("volume")||"0.7"),M=localStorage.getItem("muted")==="true";o.setVolume(_),e.muted=M,d.style.width=`${_*100}%`,l.style.setProperty("--volume-level",`${_*100}%`),S(),vE(e,o)}function vE(o,e){const t=document.getElementById("progress-bar"),n=document.getElementById("progress-fill"),r=document.getElementById("current-time"),i=document.getElementById("volume-bar"),c=document.getElementById("volume-fill"),h=document.getElementById("volume-btn");let f=!1,g=!1,y=!1,u=0;const l=(m,E,S)=>{const _=m.getBoundingClientRect(),M=Math.max(0,Math.min(1,(E.clientX-_.left)/_.width));S(M)},d=m=>{isNaN(o.duration)||(n.style.width=`${m*100}%`,r&&(r.textContent=Ma(m*o.duration)))};t.addEventListener("mousedown",m=>{f=!0,g=!o.paused,g&&o.pause(),l(t,m,E=>{u=E,d(E)})}),t.addEventListener("touchstart",m=>{m.preventDefault(),f=!0,g=!o.paused,g&&o.pause();const E=m.touches[0],S=t.getBoundingClientRect(),_=Math.max(0,Math.min(1,(E.clientX-S.left)/S.width));u=_,d(_)}),document.addEventListener("mousemove",m=>{f&&l(t,m,E=>{u=E,d(E)}),y&&l(i,m,E=>{o.muted&&(o.muted=!1,localStorage.setItem("muted",!1)),e.setVolume(E),c.style.width=`${E*100}%`,i.style.setProperty("--volume-level",`${E*100}%`)})}),document.addEventListener("touchmove",m=>{if(f){const E=m.touches[0],S=t.getBoundingClientRect(),_=Math.max(0,Math.min(1,(E.clientX-S.left)/S.width));u=_,d(_)}if(y){const E=m.touches[0],S=i.getBoundingClientRect(),_=Math.max(0,Math.min(1,(E.clientX-S.left)/S.width));o.muted&&(o.muted=!1,localStorage.setItem("muted",!1)),e.setVolume(_),c.style.width=`${_*100}%`,i.style.setProperty("--volume-level",`${_*100}%`)}}),document.addEventListener("mouseup",()=>{f&&(isNaN(o.duration)||(o.currentTime=u*o.duration,e.updateMediaSessionPositionState(),g&&o.play()),f=!1),y&&(y=!1)}),document.addEventListener("touchend",()=>{f&&(isNaN(o.duration)||(o.currentTime=u*o.duration,e.updateMediaSessionPositionState(),g&&o.play()),f=!1),y&&(y=!1)}),t.addEventListener("click",m=>{f||l(t,m,E=>{if(!isNaN(o.duration)&&o.duration>0&&o.duration!==1/0)o.currentTime=E*o.duration,e.updateMediaSessionPositionState();else if(e.currentTrack&&e.currentTrack.duration){const S=E*e.currentTrack.duration,_=document.querySelector(".progress-fill");_&&(_.style.width=`${E*100}%`),e.playTrackFromQueue(S)}})}),i.addEventListener("mousedown",m=>{y=!0,l(i,m,E=>{o.muted&&(o.muted=!1,localStorage.setItem("muted",!1)),e.setVolume(E),c.style.width=`${E*100}%`,i.style.setProperty("--volume-level",`${E*100}%`)})}),i.addEventListener("touchstart",m=>{m.preventDefault(),y=!0;const E=m.touches[0],S=i.getBoundingClientRect(),_=Math.max(0,Math.min(1,(E.clientX-S.left)/S.width));o.muted&&(o.muted=!1,localStorage.setItem("muted",!1)),e.setVolume(_),c.style.width=`${_*100}%`,i.style.setProperty("--volume-level",`${_*100}%`)}),i.addEventListener("click",m=>{y||l(i,m,E=>{o.muted&&(o.muted=!1,localStorage.setItem("muted",!1)),e.setVolume(E),c.style.width=`${E*100}%`,i.style.setProperty("--volume-level",`${E*100}%`)})}),i.addEventListener("wheel",m=>{m.preventDefault();const E=m.deltaY>0?-.05:.05,S=Math.max(0,Math.min(1,e.userVolume+E));E>0&&o.muted&&(o.muted=!1,localStorage.setItem("muted",!1)),e.setVolume(S),c.style.width=`${S*100}%`,i.style.setProperty("--volume-level",`${S*100}%`)},{passive:!1}),h?.addEventListener("wheel",m=>{m.preventDefault();const E=m.deltaY>0?-.05:.05,S=Math.max(0,Math.min(1,e.userVolume+E));E>0&&o.muted&&(o.muted=!1,localStorage.setItem("muted",!1)),e.setVolume(S),c.style.width=`${S*100}%`,i.style.setProperty("--volume-level",`${S*100}%`)},{passive:!1})}async function Xr(o,e,t,n,r,i="track",c=null,h=null,f=null){if(!e)return;const g=["add-to-queue","play-next","track-mix","download"];if(e.isUnavailable&&g.includes(o)){Dn("This track is unavailable.");return}if(o==="track-mix"&&i==="track"){e.mixes&&e.mixes.TRACK_MIX&&Bn(`/mix/${e.mixes.TRACK_MIX}`);return}if(["album","playlist","user-playlist","mix"].includes(i)&&["play-card","shuffle-play-card","add-to-queue","play-next","download","start-mix"].includes(o)){try{const{contentBlockingSettings:d}=await ta(async()=>{const{contentBlockingSettings:_}=await Promise.resolve().then(()=>ya);return{contentBlockingSettings:_}},void 0,import.meta.url);if(i==="album"&&d.shouldHideAlbum(e)){Dn("This album is blocked");return}let m=[],E=e;if(i==="album"){const _=await n.getAlbum(e.id);m=_.tracks,E=_.album||e}else if(i==="playlist"){const _=await n.getPlaylist(e.uuid);m=_.tracks,E=_.playlist||e}else if(i==="user-playlist"){let _=await nn.getPlaylist(e.id);if(!_)try{_=await On.getPublicPlaylist(e.id)}catch{}m=_?_.tracks:e.tracks||[],E=_||e}else if(i==="mix"){const _=await n.getMix(e.id);m=_.tracks,E=_.mix||e}if(m.length===0&&o!=="start-mix"){Dn(`No tracks found in this ${i}`);return}if(o==="download"){i==="album"?await cf(E,m,n,Ja.getQuality(),r):await uf(E,m,n,Ja.getQuality(),r);return}if(m=d.filterTracks(m),o==="add-to-queue"){t.addToQueue(m),window.renderQueueFunction&&window.renderQueueFunction(),Dn(`Added ${m.length} tracks to queue`);return}if(o==="play-next"){t.addNextToQueue(m),window.renderQueueFunction&&window.renderQueueFunction(),Dn(`Playing next: ${m.length} tracks`);return}if(o==="start-mix"){if(i==="album"&&E.artist?.id){const _=await n.getArtist(E.artist.id);if(_.mixes?.ARTIST_MIX){Bn(`/mix/${_.mixes.ARTIST_MIX}`);return}}m.length>0&&m[0].mixes?.TRACK_MIX?Bn(`/mix/${m[0].mixes.TRACK_MIX}`):Bn(`/${i.replace("user-","")}/${e.id||e.uuid}`);return}if(o==="shuffle-play-card"){t.shuffleActive=!0;const _=[...m];_.sort(()=>Math.random()-.5),t.setQueue(_,0);const M=document.getElementById("shuffle-btn");M&&M.classList.add("active")}else{t.setQueue(m,0);const _=document.getElementById("shuffle-btn");_&&_.classList.remove("active")}t.playAtIndex(0);const S=i==="user-playlist"?E.name:E.title;Dn(`Playing ${i.replace("user-","")}: ${S}`)}catch(d){console.error("Failed to handle collection action:",d),Dn(`Failed to process ${i} action`)}return}if(o==="toggle-pin"){const d=await nn.togglePinned(e,i);Dn(d?"Pinned to sidebar":"Unpinned from sidebar"),c&&typeof c.renderPinnedItems=="function"&&c.renderPinnedItems()}const{contentBlockingSettings:l}=await ta(async()=>{const{contentBlockingSettings:d}=await Promise.resolve().then(()=>ya);return{contentBlockingSettings:d}},void 0,import.meta.url);if(i==="track"&&l.shouldHideTrack(e)){Dn("This track is blocked");return}if(o==="add-to-queue")ny(e,"end"),t.addToQueue(e),window.renderQueueFunction&&window.renderQueueFunction(),Dn(`Added to queue: ${e.title}`);else if(o==="play-next")ay(e),t.addNextToQueue(e),window.renderQueueFunction&&window.renderQueueFunction(),Dn(`Playing next: ${e.title}`);else if(o==="play-card")t.setQueue([e],0),t.playAtIndex(0),Dn(`Playing track: ${e.title}`);else if(o==="start-mix")Sy(i,e),e.mixes?.TRACK_MIX?Bn(`/mix/${e.mixes.TRACK_MIX}`):Dn("No mix available for this track");else if(o==="download")ty(e,Ja.getQuality()),await ff(e,Ja.getQuality(),n,r);else if(o==="toggle-like"){const d=await nn.toggleFavorite(i,e);On.syncLibraryItem(i,e,d),d?i==="track"?Yp(e):i==="album"?$p(e):i==="artist"?Wp(e):(i==="playlist"||i==="user-playlist")&&Xp(e):i==="track"?Kp(e):i==="album"?Vp(e):i==="artist"?Qp(e):(i==="playlist"||i==="user-playlist")&&Jp(e),d&&i==="track"&&h&&(Xa.isEnabled()&&Xa.shouldLoveOnLike()&&h.loveTrack(e),Cs.isEnabled()&&Cs.shouldLoveOnLike()&&h.loveTrack(e));const m=i==="playlist"?e.uuid:e.id,E=i==="track"?`[data-track-id="${m}"] .like-btn`:`.card[data-${i}-id="${m}"] .like-btn, .card[data-playlist-id="${m}"] .like-btn`,S=document.getElementById(`like-${i}-btn`),_=[...document.querySelectorAll(E)];S&&_.push(S);const M=document.getElementById("now-playing-like-btn");M&&i==="track"&&t?.currentTrack?.id===e.id&&_.push(M);const R=document.getElementById("fs-like-btn");if(R&&i==="track"&&t?.currentTrack?.id===e.id&&_.push(R),_.forEach(W=>{const fe=W.querySelector("svg");fe&&(fe.classList.toggle("filled",d),fe.hasAttribute("fill")&&fe.setAttribute("fill",d?"currentColor":"none")),W.classList.toggle("active",d),W.title=d?"Remove from Favorites":"Add to Favorites"}),window.location.hash==="#library"){const W=i==="track"?`.track-item[data-track-id="${m}"]`:`.card[data-${i}-id="${m}"], .card[data-playlist-id="${m}"]`,fe=document.querySelector(W);if(!d&&fe){const ye=fe.parentElement;if(fe.remove(),ye&&ye.children.length===0){const Y=i==="track"?"No liked tracks yet.":`No liked ${i}s yet.`;ye.innerHTML=`<div class="placeholder-text">${Y}</div>`}}else if(d&&!fe&&c&&i==="track"){const ye=document.getElementById("library-tracks-container");if(ye){const Y=ye.querySelector(".placeholder-text");Y&&Y.remove();const j=ye.children.length,se=c.createTrackItemHTML(e,j,!0,!1),Te=document.createElement("div");Te.innerHTML=se;const Ae=Te.firstElementChild;Ae&&(ye.appendChild(Ae),Hn.set(Ae,e),c.updateLikeState(Ae,"track",e.id))}}}}else if(o==="add-to-playlist"){const d=document.getElementById("playlist-select-modal"),m=document.getElementById("playlist-select-list"),E=document.getElementById("playlist-select-cancel"),S=d.querySelector(".modal-overlay"),_=async()=>{const fe=await nn.getPlaylists(!0),ye=e.id,Y=new Set;for(const j of fe)j.tracks&&j.tracks.some(se=>se.id==ye)&&Y.add(j.id);return m.innerHTML=`
                <div class="modal-option create-new-option" style="border-bottom: 1px solid var(--border); margin-bottom: 0.5rem;">
                    <span style="font-weight: 600; color: var(--primary);">+ Create New Playlist</span>
                </div>
            `+fe.map(j=>{const se=Y.has(j.id);return`
                    <div class="modal-option ${se?"already-contains":""}" data-id="${j.id}">
                        <span>${j.name}</span>
                        ${se?`<button class="remove-from-playlist-btn-modal" title="Remove from playlist" style="background: transparent; border: none; color: inherit; cursor: pointer; padding: 4px; display: flex; align-items: center;">${Kd}</button>`:""}
                    </div>
                `}).join(""),!0};if(!await _())return;const M=()=>{d.classList.remove("active"),W()},R=async fe=>{const ye=fe.target.closest(".remove-from-playlist-btn-modal"),Y=fe.target.closest(".modal-option");if(!Y)return;if(Y.classList.contains("create-new-option")){M();const se=document.getElementById("playlist-modal");document.getElementById("playlist-modal-title").textContent="Create Playlist",document.getElementById("playlist-name-input").value="",document.getElementById("playlist-cover-input").value="",document.getElementById("playlist-cover-file-input").value="",document.getElementById("playlist-description-input").value="",se.dataset.editingId="",document.getElementById("import-section").style.display="none";const Te=document.getElementById("playlist-cover-upload-btn"),Ae=document.getElementById("playlist-cover-input"),ze=document.getElementById("playlist-cover-toggle-url-btn");Te&&(Te.style.flex="1",Te.style.display="flex"),Ae&&(Ae.style.display="none"),ze&&(ze.textContent="or URL",ze.title="Switch to URL input"),se._pendingTracks=[e],se.classList.add("active"),document.getElementById("playlist-name-input").focus();return}const j=Y.dataset.id;if(ye){fe.stopPropagation(),await nn.removeTrackFromPlaylist(j,e.id);const se=await nn.getPlaylist(j);On.syncUserPlaylist(se,"update"),Dn(`Removed from playlist: ${Y.querySelector("span").textContent}`),await _()}else{if(Y.classList.contains("already-contains"))return;await nn.addTrackToPlaylist(j,e);const se=await nn.getPlaylist(j);On.syncUserPlaylist(se,"update"),Dn(`Added to playlist: ${Y.querySelector("span").textContent}`),M()}},W=()=>{E.removeEventListener("click",M),S.removeEventListener("click",M),m.removeEventListener("click",R)};E.addEventListener("click",M),S.addEventListener("click",M),m.addEventListener("click",R),d.classList.add("active")}else if(o==="go-to-artist"){const d=f?.artistId||e.artist?.id||e.artists?.[0]?.id,m=f?.trackerSheetId||(e.isTracker?e.trackerInfo?.sheetId:null);m?Bn(`/unreleased/${m}`):d&&Bn(`/artist/${d}`)}else if(o==="go-to-album")e.album?.id&&Bn(`/album/${e.album.id}`);else if(o==="copy-link"||o==="share"){const m=document.getElementById("context-menu")?._contextHref,E=Ns(m||`/track/${e.id||e.uuid}`);dy(i,e.id||e.uuid),navigator.clipboard.writeText(E).then(()=>{Dn("Link copied to clipboard!")})}else if(o==="open-in-new-tab"){const m=document.getElementById("context-menu")?._contextHref,E=m?`${window.location.origin}${m}`:`${window.location.origin}/track/${e.id||e.uuid}`;fy(i,e.id||e.uuid),window.open(E,"_blank")}else if(o==="track-info"){const d=e.isTracker;let m="";if(d&&e.trackerInfo){const _=e.trackerInfo.releaseDate||e.streamStartDate,M=_?new Date(_).toLocaleDateString():"Unknown",R=e.trackerInfo.addedDate?new Date(e.trackerInfo.addedDate).toLocaleDateString():"Unknown";m=`
                <div style="padding: 1.5rem; max-width: 500px; max-height: 80vh; overflow-y: auto;">
                    <h3 style="margin-bottom: 1rem; font-size: 1.3rem; font-weight: 600;">${en(e.title)}</h3>
                    <div style="color: var(--muted-foreground); font-size: 0.9rem; line-height: 1.8;">
                        <div style="margin-bottom: 1rem; padding: 0.75rem; background: var(--accent); border-radius: 8px;">
                            <p style="color: var(--primary); font-weight: 500;">Unreleased Track</p>
                        </div>
                        
                        <div style="display: grid; gap: 0.5rem;">
                            ${e.artists?`<p><strong style="color: var(--foreground);">Artist:</strong> ${en(Array.isArray(e.artists)?e.artists.map(W=>W.name||W).join(", "):e.artists)}</p>`:""}
                            ${e.trackerInfo.artist?`<p><strong style="color: var(--foreground);">Tracked Artist:</strong> ${en(e.trackerInfo.artist)}</p>`:""}
                            ${e.trackerInfo.project?`<p><strong style="color: var(--foreground);">Project:</strong> ${en(e.trackerInfo.project)}</p>`:""}
                            ${e.trackerInfo.era?`<p><strong style="color: var(--foreground);">Era:</strong> ${en(e.trackerInfo.era)}</p>`:""}
                            ${e.trackerInfo.timeline?`<p><strong style="color: var(--foreground);">Timeline:</strong> ${en(e.trackerInfo.timeline)}</p>`:""}
                            ${e.trackerInfo.category?`<p><strong style="color: var(--foreground);">Category:</strong> ${en(e.trackerInfo.category)}</p>`:""}
                            ${e.trackerInfo.trackNumber?`<p><strong style="color: var(--foreground);">Track Number:</strong> ${en(String(e.trackerInfo.trackNumber))}</p>`:""}
                            <p><strong style="color: var(--foreground);">Duration:</strong> ${en(Ma(e.duration))}</p>
                            ${_!=="Unknown"?`<p><strong style="color: var(--foreground);">Release Date:</strong> ${en(M)}</p>`:""}
                            ${e.trackerInfo.addedDate?`<p><strong style="color: var(--foreground);">Added to Tracker:</strong> ${en(R)}</p>`:""}
                            ${e.trackerInfo.leakedDate?`<p><strong style="color: var(--foreground);">Leak Date:</strong> ${en(new Date(e.trackerInfo.leakedDate).toLocaleDateString())}</p>`:""}
                            ${e.trackerInfo.recordingDate?`<p><strong style="color: var(--foreground);">Recording Date:</strong> ${en(new Date(e.trackerInfo.recordingDate).toLocaleDateString())}</p>`:""}
                        </div>
                        
                        ${e.trackerInfo.description?`
                            <div style="margin-top: 1rem; padding: 0.75rem; background: var(--accent); border-radius: 8px;">
                                <p style="color: var(--foreground); font-weight: 500; margin-bottom: 0.5rem;">Description</p>
                                <p style="font-size: 0.85rem; line-height: 1.6;">${en(e.trackerInfo.description)}</p>
                            </div>
                        `:""}
                        
                        ${e.trackerInfo.notes?`
                            <div style="margin-top: 1rem; padding: 0.75rem; background: var(--accent); border-radius: 8px;">
                                <p style="color: var(--foreground); font-weight: 500; margin-bottom: 0.5rem;">Notes</p>
                                <p style="font-size: 0.85rem; line-height: 1.6;">${en(e.trackerInfo.notes)}</p>
                            </div>
                        `:""}
                        
                        ${e.trackerInfo.sourceUrl?`
                            <div style="margin-top: 1rem;">
                                <p style="margin-bottom: 0.5rem;"><strong style="color: var(--foreground);">Source URL:</strong></p>
                                <a href="${en(e.trackerInfo.sourceUrl)}" target="_blank" style="color: var(--primary); word-break: break-all; font-size: 0.85rem; display: block; padding: 0.5rem; background: var(--accent); border-radius: 6px; text-decoration: none;">
                                    ${en(e.trackerInfo.sourceUrl)}
                                </a>
                            </div>
                        `:""}
                        
                        ${e.id?`<p style="margin-top: 1rem; font-size: 0.8rem; color: var(--muted);"><strong>Track ID:</strong> ${en(e.id)}</p>`:""}
                    </div>
                    <button class="btn-primary track-info-close-btn" style="margin-top: 1.5rem; width: 100%;">Close</button>
                </div>
            `}else{const _=e.album?.releaseDate||e.streamStartDate,M=_?new Date(_).toLocaleDateString():"Unknown",R=e.audioQuality||"Unknown",W=e.bitrate?`${e.bitrate} kbps`:"";m=`
                <div style="padding: 1.5rem; max-width: 500px; max-height: 80vh; overflow-y: auto;">
                    <h3 style="margin-bottom: 1rem; font-size: 1.3rem; font-weight: 600;">${en(e.title)}</h3>
                    <div style="color: var(--muted-foreground); font-size: 0.9rem; line-height: 1.8;">
                        <div style="display: grid; gap: 0.5rem;">
                            <p><strong style="color: var(--foreground);">Artist:</strong> ${en(wa(e))}</p>
                            <p><strong style="color: var(--foreground);">Album:</strong> ${en(e.album?.title||"Unknown")}</p>
                            ${e.album?.artist?.name?`<p><strong style="color: var(--foreground);">Album Artist:</strong> ${en(e.album.artist.name)}</p>`:""}
                            <p><strong style="color: var(--foreground);">Release Date:</strong> ${en(M)}</p>
                            <p><strong style="color: var(--foreground);">Duration:</strong> ${en(Ma(e.duration))}</p>
                            ${e.trackNumber?`<p><strong style="color: var(--foreground);">Track Number:</strong> ${en(String(e.trackNumber))}</p>`:""}
                            ${e.discNumber?`<p><strong style="color: var(--foreground);">Disc Number:</strong> ${en(String(e.discNumber))}</p>`:""}
                            ${e.version?`<p><strong style="color: var(--foreground);">Version:</strong> ${en(e.version)}</p>`:""}
                            ${e.explicit?'<p><strong style="color: var(--foreground);">Explicit:</strong> Yes</p>':""}
                            <p><strong style="color: var(--foreground);">Quality:</strong> ${en(R)} ${W?`(${en(W)})`:""}</p>
                        </div>
                        
                        ${e.credits&&e.credits.length>0?`
                            <div style="margin-top: 1rem; padding: 0.75rem; background: var(--accent); border-radius: 8px;">
                                <p style="color: var(--foreground); font-weight: 500; margin-bottom: 0.5rem;">Credits</p>
                                <div style="font-size: 0.85rem; line-height: 1.6;">
                                    ${e.credits.map(fe=>`<p>${en(fe.type)}: ${en(fe.name)}</p>`).join("")}
                                </div>
                            </div>
                        `:""}
                        
                        ${e.composers&&e.composers.length>0?`
                            <p style="margin-top: 0.5rem;"><strong style="color: var(--foreground);">Composers:</strong> ${en(e.composers.map(fe=>fe.name).join(", "))}</p>
                        `:""}
                        
                        ${e.lyrics?.text?`
                            <div style="margin-top: 1rem; padding: 0.75rem; background: var(--accent); border-radius: 8px;">
                                <p style="color: var(--foreground); font-weight: 500; margin-bottom: 0.5rem;">Has Lyrics</p>
                            </div>
                        `:""}
                        
                        ${e.id?`<p style="margin-top: 1rem; font-size: 0.8rem; color: var(--muted);"><strong>Track ID:</strong> ${en(e.id)}</p>`:""}
                        ${e.album?.id?`<p style="font-size: 0.8rem; color: var(--muted);"><strong>Album ID:</strong> ${en(e.album.id)}</p>`:""}
                    </div>
                    <button class="btn-primary track-info-close-btn" style="margin-top: 1.5rem; width: 100%;">Close</button>
                </div>
            `}const E=document.createElement("div");E.className="modal-overlay",E.style.cssText="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000;",E.innerHTML=m,E.onclick=_=>{_.target===E&&E.remove()};const S=E.querySelector(".track-info-close-btn");S&&(S.onclick=()=>E.remove()),document.body.appendChild(E)}else if(o==="open-original-url"){let d=null;e.isTracker&&e.trackerInfo&&e.trackerInfo.sourceUrl?d=e.trackerInfo.sourceUrl:e.remoteUrl&&(d=e.remoteUrl),d?window.open(d,"_blank"):Dn("No original URL available for this track.")}else if(o==="block-track"){const{contentBlockingSettings:d}=await ta(async()=>{const{contentBlockingSettings:m}=await Promise.resolve().then(()=>ya);return{contentBlockingSettings:m}},void 0,import.meta.url);d.isTrackBlocked(e.id)?(d.unblockTrack(e.id),sy(e),Dn(`Unblocked track: ${e.title}`)):(d.blockTrack(e),iy(e),Dn(`Blocked track: ${e.title}`))}else if(o==="block-album"){const{contentBlockingSettings:d}=await ta(async()=>{const{contentBlockingSettings:M}=await Promise.resolve().then(()=>ya);return{contentBlockingSettings:M}},void 0,import.meta.url),m=i==="album"?e.id:e.album?.id,E=i==="album"?e.title:e.album?.title,S=i==="album"?e.artist:e.album?.artist;if(!m){Dn("No album information available");return}const _={id:m,title:E,artist:S};d.isAlbumBlocked(m)?(d.unblockAlbum(m),ly(_),Dn(`Unblocked album: ${E||"Unknown Album"}`)):(d.blockAlbum(_),oy(_),Dn(`Blocked album: ${E||"Unknown Album"}`))}else if(o==="block-artist"){const{contentBlockingSettings:d}=await ta(async()=>{const{contentBlockingSettings:_}=await Promise.resolve().then(()=>ya);return{contentBlockingSettings:_}},void 0,import.meta.url),m=e.artist?.id||e.artists?.[0]?.id,E=e.artist?.name||e.artists?.[0]?.name||e.name;if(!m){Dn("No artist information available");return}const S={id:m,name:E};d.isArtistBlocked(m)?(d.unblockArtist(m),uy(S),Dn(`Unblocked artist: ${E||"Unknown Artist"}`)):(d.blockArtist(S),cy(S),Dn(`Blocked artist: ${E||"Unknown Artist"}`))}}async function Ni(o,e){if(!o||!e)return;const t=o.querySelector('li[data-action="toggle-like"]');if(t){const l=await nn.isFavorite("track",e.id);t.textContent=l?"Unlike":"Like"}const n=o.querySelector('li[data-action="toggle-pin"]');if(n){const l=await nn.isPinned(e.id||e.uuid);n.textContent=l?"Unpin":"Pin"}const r=o.querySelector('li[data-action="track-mix"]');if(r){const l=e.mixes&&e.mixes.TRACK_MIX;r.style.display=l?"block":"none"}const i=o.querySelector('li[data-action="open-original-url"]');if(i){const l=e.isTracker||e.trackerInfo&&e.trackerInfo.sourceUrl;i.style.display=l?"block":"none"}const{contentBlockingSettings:c}=await ta(async()=>{const{contentBlockingSettings:l}=await Promise.resolve().then(()=>ya);return{contentBlockingSettings:l}},void 0,import.meta.url),h=o._contextType||"track",f=o.querySelector('li[data-action="block-track"]');if(f){const l=c.isTrackBlocked(e.id);f.textContent=l?f.dataset.labelUnblock||"Unblock track":f.dataset.labelBlock||"Block track"}const g=o.querySelector('li[data-action="block-album"]');if(g){const l=h==="album"?e.id:e.album?.id,d=l?c.isAlbumBlocked(l):!1;g.textContent=d?g.dataset.labelUnblock||"Unblock album":g.dataset.labelBlock||"Block album"}const y=o.querySelector('li[data-action="block-artist"]');if(y){const l=e.artist?.id||e.artists?.[0]?.id,d=l?c.isArtistBlocked(l):!1;y.textContent=d?y.dataset.labelUnblock||"Unblock artist":y.dataset.labelBlock||"Block artist"}o.querySelectorAll("li[data-action]").forEach(l=>{const d=l.dataset.typeFilter;if(d){const m=d.split(",");l.style.display=m.includes(h)?"block":"none"}else l.style.display="block";if(l.dataset.action==="toggle-like"){const m=`label${h.charAt(0).toUpperCase()+h.slice(1).replace("User-playlist","Playlist")}`,E=l.dataset[m]||l.dataset.labelTrack||"Like";l.textContent=E}});const u=o.querySelector('li[data-action="go-to-artist"]');if(u){const l=Array.isArray(e.artists)?e.artists:e.artist?[e.artist]:[],d=h==="track"||h==="album";if(l.length>1&&d)u.style.display="block",u.textContent="Go to artists",u.dataset.hasMultipleArtists="true";else{const m=l.length>0;u.style.display=m&&d?"block":"none",u.dataset.hasMultipleArtists="false",u.textContent=l.length>1?"Go to artists":"Go to artist",delete u.dataset.artistId,delete u.dataset.trackerSheetId}}}function TE(o,e,t,n,r,i,c){let h=null;t.addEventListener("click",async l=>{const d=l.target.closest(".track-action-btn, .like-btn, .play-btn");if(d&&d.dataset.action){l.preventDefault(),l.stopPropagation();const R=d.closest(".track-item, .card"),W=d.dataset.action,fe=d.dataset.type||"track";let ye=R?Hn.get(R):Hn.get(d);if(!ye&&W==="toggle-like"){const Y=window.location.pathname.split("/")[2];if(Y)try{fe==="album"?ye=(await e.getAlbum(Y)).album:fe==="artist"?ye=await e.getArtist(Y):fe==="playlist"?ye=(await e.getPlaylist(Y)).playlist:fe==="mix"?ye=(await e.getMix(Y)).mix:fe==="track"&&(ye=(await e.getTrack(Y)).track)}catch(j){console.error(j)}}ye&&await Xr(W,ye,o,e,r,fe,i,c);return}const m=l.target.closest(".card-menu-btn");if(m){l.stopPropagation();const R=m.closest(".card"),W=m.dataset.type,fe=m.dataset.id;let ye=R?Hn.get(R):null;ye||(ye={id:fe,uuid:fe,title:R.querySelector(".card-title")?.textContent||"Item"}),n._originalHTML&&(n.innerHTML=n._originalHTML,n._originalHTML=null),h=ye,n._contextTrack=ye,n._contextType=W,await Ni(n,ye);const Y=m.getBoundingClientRect();Bi(n,Y.left,Y.bottom+5,Y);return}const E=l.target.closest(".track-menu-btn");if(E){l.stopPropagation();const R=E.closest(".track-item");if(R&&!R.dataset.queueIndex){const W=Hn.get(R);if(W&&W.isLocal)return;if(n.style.display==="block"&&h&&W&&h.id===W.id){n._originalHTML&&(n.innerHTML=n._originalHTML),n.style.display="none",n._contextType=null,n._originalHTML=null;return}if(h=W,h){n._originalHTML&&(n.innerHTML=n._originalHTML,n._originalHTML=null),n._contextTrack=h,n._contextType="track",await Ni(n,h);const fe=E.getBoundingClientRect();Bi(n,fe.left,fe.bottom+5,fe)}}return}const S=l.target.closest(".track-item");if(S&&(S.classList.contains("unavailable")||S.classList.contains("blocked")))return;if(S&&!S.dataset.queueIndex&&!l.target.closest(".remove-from-playlist-btn")&&!l.target.closest(".artist-link")){const R=S.dataset.trackId;if(window.location.pathname.startsWith("/search/")){const fe=Hn.get(S);fe&&(o.setQueue([fe],0),document.getElementById("shuffle-btn").classList.remove("active"),o.playTrackFromQueue(),e.getTrackRecommendations(fe.id).then(ye=>{ye&&ye.length>0&&o.addToQueue(ye)}))}else{const fe=S.closest(".track-list"),Y=Array.from(fe.querySelectorAll(".track-item")).map(j=>Hn.get(j)).filter(Boolean);if(Y.length>0){const j=Y.findIndex(se=>se.id==R);o.setQueue(Y,j),document.getElementById("shuffle-btn").classList.remove("active"),o.playTrackFromQueue()}}}const _=l.target.closest(".artist-link");if(_){l.stopPropagation();const R=_.dataset.artistId,W=_.dataset.trackerSheetId;W?Bn(`/unreleased/${W}`):R&&Bn(`/artist/${R}`);return}const M=l.target.closest(".card");if(M){if(M.classList.contains("blocked")&&!l.target.closest(".card-menu-btn")||l.target.closest(".edit-playlist-btn")||l.target.closest(".delete-playlist-btn"))return;const R=M.dataset.href;if(R){if(l.target.closest("a"))return;l.preventDefault(),Bn(R)}}}),t.addEventListener("contextmenu",async l=>{const d=l.target.closest(".track-item, .queue-track-item"),m=l.target.closest(".card");if(d){if(l.preventDefault(),d.classList.contains("queue-track-item")){const E=parseInt(d.dataset.queueIndex);h=o.getCurrentQueue()[E]}else h=Hn.get(d);if(h){if(h.isLocal)return;n._originalHTML&&(n.innerHTML=n._originalHTML,n._originalHTML=null);const E=["play-next","add-to-queue","download","track-mix"];n.querySelectorAll("[data-action]").forEach(S=>{E.includes(S.dataset.action)&&(S.style.display=h.isUnavailable?"none":"block")}),n._contextTrack=h,n._contextType="track",await Ni(n,h),Bi(n,l.clientX,l.clientY)}}else if(m){l.preventDefault();const E=m.dataset.albumId?"album":m.dataset.playlistId?"playlist":m.dataset.mixId?"mix":m.dataset.href?m.dataset.href.split("/")[1]:"item",S=m.dataset.albumId||m.dataset.playlistId||m.dataset.mixId,_=Hn.get(m)||{id:S,uuid:S,title:m.querySelector(".card-title")?.textContent};n._originalHTML&&(n.innerHTML=n._originalHTML,n._originalHTML=null),h=_,n._contextTrack=_,n._contextType=E.replace("userplaylist","user-playlist"),n._contextHref=m.dataset.href,await Ni(n,_),Bi(n,l.clientX,l.clientY)}}),document.addEventListener("click",()=>{n.style.display==="block"&&(n._originalHTML&&(n.innerHTML=n._originalHTML),n.style.display="none",n._contextType=null,n._originalHTML=null)}),n.addEventListener("click",async l=>{l.stopPropagation();const d=l.target.closest("[data-action]");if(!d)return;const m=d.dataset.action,E=n._contextTrack||h,S=n._contextType||"track";if(m==="go-to-artists"||m==="go-to-artist"&&d.dataset.hasMultipleArtists==="true"){const _=Array.isArray(E.artists)?E.artists:E.artist?[E.artist]:[];if(_.length>1){n._originalHTML||(n._originalHTML=n.innerHTML);let M='<li data-action="back-to-main-menu" style="font-weight: bold; border-bottom: 1px solid var(--border); margin-bottom: 0.5rem; padding: 0.75rem 1rem; cursor: pointer;">â† Back</li>';_.forEach(R=>{M+=`<li data-action="go-to-artist" data-artist-id="${R.id}" style="padding: 0.75rem 1rem; cursor: pointer;">${en(R.name||"Unknown Artist")}</li>`}),n.innerHTML=`<ul>${M}</ul>`;return}}if(m==="back-to-main-menu"){n._originalHTML&&(n.innerHTML=n._originalHTML,n._originalHTML=null,await Ni(n,E));return}m&&E&&(ry(m,S,E),await Xr(m,E,o,e,r,S,i,c,d.dataset)),n._originalHTML&&(n.innerHTML=n._originalHTML,n._originalHTML=null),n.style.display="none",n._contextType=null}),document.querySelector(".now-playing-bar .title").addEventListener("click",()=>{const l=o.currentTrack;l?.album?.id&&Bn(`/album/${l.album.id}`)}),document.querySelector(".now-playing-bar .album").addEventListener("click",()=>{const l=o.currentTrack;l?.album?.id&&Bn(`/album/${l.album.id}`)}),document.querySelector(".now-playing-bar .artist").addEventListener("click",l=>{const d=l.target.closest(".artist-link");if(d){l.stopPropagation();const E=d.dataset.artistId,S=d.dataset.trackerSheetId;S?Bn(`/unreleased/${S}`):E&&Bn(`/artist/${E}`);return}const m=o.currentTrack;m&&((m.isTracker||m.id&&String(m.id).startsWith("tracker-"))&&m.trackerInfo?.sheetId?Bn(`/unreleased/${m.trackerInfo.sheetId}`):m.artist?.id&&Bn(`/artist/${m.artist.id}`))});const f=document.getElementById("now-playing-like-btn");f&&f.addEventListener("click",async l=>{l.stopPropagation(),o.currentTrack&&await Xr("toggle-like",o.currentTrack,o,e,r,"track",i,c)});const g=document.getElementById("now-playing-mix-btn");g&&g.addEventListener("click",async l=>{l.stopPropagation(),o.currentTrack&&await Xr("track-mix",o.currentTrack,o,e,r,"track",i,c)});const y=document.getElementById("now-playing-add-playlist-btn");y&&y.addEventListener("click",async l=>{l.stopPropagation(),o.currentTrack&&await Xr("add-to-playlist",o.currentTrack,o,e,r,"track",i,c)});const u=document.getElementById("mobile-add-playlist-btn");u&&u.addEventListener("click",async l=>{l.stopPropagation(),o.currentTrack&&await Xr("add-to-playlist",o.currentTrack,o,e,r,"track",i,c)})}function Cd(o){const e=document.getElementById("sleep-timer-modal");if(!e)return;const t=()=>{e.classList.remove("active"),i()},n=c=>{const h=c.target.closest(".timer-option");if(h){let f;if(h.id==="custom-timer-btn"){const g=document.getElementById("custom-minutes");if(f=parseInt(g.value),!f||f<1){Dn("Please enter a valid number of minutes");return}}else f=parseInt(h.dataset.minutes);f&&(o.setSleepTimer(f),Ty(f),Dn(`Sleep timer set for ${f} minute${f===1?"":"s"}`),t())}},r=c=>{(c.target.id==="cancel-sleep-timer"||c.target.classList.contains("modal-overlay"))&&t()},i=()=>{e.removeEventListener("click",n),e.removeEventListener("click",r)};e.addEventListener("click",n),e.addEventListener("click",r),e.classList.add("active")}function wE(o,e,t){const n=document.querySelector(".sidebar"),r=document.getElementById("sidebar-overlay"),i=document.getElementById("hamburger-btn"),c=document.getElementById("queue-btn"),h=document.getElementById("page-library");if(h){h.addEventListener("dragstart",W=>{const fe=W.target.closest(".card.user-playlist");fe&&(W.dataTransfer.setData("text/playlist-id",fe.dataset.userPlaylistId),W.dataTransfer.effectAllowed="move")});const _=W=>{const fe=W.target.closest(".card[data-folder-id]");fe&&W.dataTransfer.types.includes("text/playlist-id")&&(W.preventDefault(),fe.classList.add("drag-over"))},M=W=>{const fe=W.target.closest(".card[data-folder-id]");fe&&fe.classList.remove("drag-over")},R=async W=>{W.preventDefault();const fe=W.target.closest(".card[data-folder-id]");if(fe){fe.classList.remove("drag-over");const ye=W.dataTransfer.getData("text/playlist-id"),Y=fe.dataset.folderId;if(ye&&Y){const j=await nn.addPlaylistToFolder(Y,ye);On.syncUserFolder(j,"update");const se=fe.querySelector(".card-subtitle");se&&(se.textContent=`${j.playlists.length} playlists`),Dn("Playlist added to folder")}}};h.addEventListener("dragover",_),h.addEventListener("dragleave",M),h.addEventListener("drop",R)}let f=null;i.addEventListener("click",()=>{n.classList.add("is-open"),r.classList.add("is-visible")});const g=()=>{n.classList.remove("is-open"),r.classList.remove("is-visible")};r.addEventListener("click",g),n.addEventListener("click",_=>{_.target.closest("a")&&g()});const y=_=>{const M=o.getCurrentQueue(),R=M.length>0;_.innerHTML=`
            <button id="download-queue-btn" class="btn-icon" title="Download Queue" style="display: ${R?"flex":"none"}">
                ${Ui}
            </button>
            <button id="like-queue-btn" class="btn-icon" title="Add Queue to Liked" style="display: ${R?"flex":"none"}">
                ${yr}
            </button>
            <button id="add-queue-to-playlist-btn" class="btn-icon" title="Add Queue to Playlist" style="display: ${R?"flex":"none"}">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                </svg>
            </button>
            <button id="clear-queue-btn" class="btn-icon" title="Clear Queue" style="display: ${R?"flex":"none"}">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
            </button>
            <button id="close-side-panel-btn" class="btn-icon" title="Close">
                ${Os}
            </button>
        `,_.querySelector("#close-side-panel-btn").addEventListener("click",()=>{ea.close()});const W=_.querySelector("#download-queue-btn");W&&W.addEventListener("click",async()=>{lf(M,e,Ja.getQuality())});const fe=_.querySelector("#like-queue-btn");fe&&fe.addEventListener("click",async()=>{let j=0;for(const se of M)await nn.toggleFavorite("track",se)&&(On.syncLibraryItem("track",se,!0),j++);j>0?Dn(`Added ${j} track${j>1?"s":""} to Liked`):Dn("All tracks in queue are already liked"),l()});const ye=_.querySelector("#add-queue-to-playlist-btn");ye&&ye.addEventListener("click",async()=>{const j=await nn.getPlaylists();if(j.length===0){Dn("No playlists yet. Create one first.");return}const se=document.createElement("div");se.className="modal active",se.innerHTML=`
                    <div class="modal-overlay"></div>
                    <div class="modal-content">
                        <h3>Add Queue to Playlist</h3>
                        <div class="modal-list">
                            ${j.map(Ae=>`
                                <div class="modal-option" data-id="${Ae.id}">${en(Ae.name)}</div>
                            `).join("")}
                        </div>
                        <div class="modal-actions">
                            <button class="btn-secondary cancel-btn">Cancel</button>
                        </div>
                    </div>
                `,document.body.appendChild(se);const Te=()=>{se.remove()};se.addEventListener("click",async Ae=>{if(Ae.target.classList.contains("modal-overlay")||Ae.target.classList.contains("cancel-btn")){Te();return}const ze=Ae.target.closest(".modal-option");if(ze){const de=ze.dataset.id,we=ze.textContent;try{let ce=0;for(const Pe of M)await nn.addTrackToPlaylist(de,Pe),ce++;const he=await nn.getPlaylist(de);On.syncUserPlaylist(he,"update"),Dn(`Added ${ce} tracks to playlist: ${we}`)}catch(ce){console.error("Failed to add tracks to playlist:",ce),Dn("Failed to add tracks to playlist")}Te()}})});const Y=_.querySelector("#clear-queue-btn");Y&&Y.addEventListener("click",()=>{o.clearQueue(),l()})},u=_=>{const M=o.getCurrentQueue();if(M.length===0){_.innerHTML='<div class="placeholder-text">Queue is empty.</div>';return}const R=M.map((W,fe)=>{const ye=fe===o.currentQueueIndex,Y=or?.shouldHideTrack(W),j=Ca(W),se=wa(W,{fallback:"Unknown"}),Te=Or(W),Ae=Y?`title="Blocked: ${or.isTrackBlocked(W.id)?"Track blocked":or.isArtistBlocked(W.artist?.id)?"Artist blocked":"Album blocked"}"`:"";return`
                <div class="queue-track-item ${ye?"playing":""} ${Y?"blocked":""}" data-queue-index="${fe}" data-track-id="${W.id}" draggable="${Y?"false":"true"}" ${Ae}>
                    <div class="drag-handle">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="5" y1="8" x2="19" y2="8"></line>
                            <line x1="5" y1="16" x2="19" y2="16"></line>
                        </svg>
                    </div>
                    <div class="track-item-info">
                        <img src="${e.getCoverUrl(W.album?.cover)}"
                             class="track-item-cover" loading="lazy">
                        <div class="track-item-details">
                            <div class="title">${en(j)} ${Te}</div>
                            <div class="artist">${en(se)}</div>
                        </div>
                    </div>
                    <div class="track-item-duration">${Y?"--:--":Ma(W.duration)}</div>
                    <button class="queue-like-btn" data-action="toggle-like" title="Add to Liked">
                        ${yr}
                    </button>
                    <button class="queue-remove-btn" data-track-index="${fe}" title="Remove from queue">
                        ${Kd}
                    </button>
                </div>
            `}).join("");_.innerHTML=R,_.querySelectorAll(".queue-track-item").forEach(async W=>{const fe=parseInt(W.dataset.queueIndex),ye=o.getCurrentQueue()[fe],Y=W.querySelector(".queue-like-btn");if(Y&&ye){const j=await nn.isFavorite("track",ye.id);Y.classList.toggle("active",j),Y.innerHTML=j?yr.replace('class="heart-icon"','class="heart-icon filled"'):yr}W.addEventListener("click",async j=>{if(j.target.closest(".queue-remove-btn")){j.stopPropagation(),o.removeFromQueue(fe),l();return}const Te=j.target.closest(".queue-like-btn");if(Te&&Te.dataset.action==="toggle-like"){j.stopPropagation();const Ae=o.getCurrentQueue()[fe];if(Ae){const ze=await nn.toggleFavorite("track",Ae);On.syncLibraryItem("track",Ae,ze),Te.classList.toggle("active",ze),Te.innerHTML=ze?yr.replace('class="heart-icon"','class="heart-icon filled"'):yr,Dn(ze?`Added to Liked: ${Ae.title}`:`Removed from Liked: ${Ae.title}`)}return}W.classList.contains("blocked")||(o.playAtIndex(fe),l())}),W.addEventListener("contextmenu",async j=>{j.preventDefault();const se=document.getElementById("context-menu");if(se){const Te=o.getCurrentQueue()[fe];if(Te){const Ae=await nn.isFavorite("track",Te.id),ze=se.querySelector('li[data-action="toggle-like"]');ze&&(ze.textContent=Ae?"Unlike":"Like");const de=se.querySelector('li[data-action="track-mix"]');if(de){const we=Te.mixes&&Te.mixes.TRACK_MIX;de.style.display=we?"block":"none"}Bi(se,j.clientX,j.clientY),se._contextTrack=Te}}}),W.addEventListener("dragstart",()=>{f=fe,W.style.opacity="0.5"}),W.addEventListener("dragend",()=>{W.style.opacity="1"}),W.addEventListener("dragover",j=>{j.preventDefault()}),W.addEventListener("drop",j=>{j.preventDefault(),f!==null&&f!==fe&&(o.moveInQueue(f,fe),l())})})},l=()=>{ea.refresh("queue",y,u)},d=()=>{_y(),ea.open("queue","Queue",y,u)};c.addEventListener("click",d),window.renderQueueFunction=()=>{ea.isActive("queue")&&l();const _=document.getElementById("fullscreen-cover-overlay");_&&getComputedStyle(_).display!=="none"&&t.updateFullscreenMetadata(o.currentTrack,o.getNextTrack())};const m=document.getElementById("page-folder");m&&(m.addEventListener("dragover",_=>{_.dataTransfer.types.includes("text/playlist-id")&&(_.preventDefault(),m.classList.add("drag-over-folder-page"))}),m.addEventListener("dragleave",()=>{m.classList.remove("drag-over-folder-page")}),m.addEventListener("drop",async _=>{_.preventDefault(),m.classList.remove("drag-over-folder-page");const M=_.dataTransfer.getData("text/playlist-id"),R=window.location.pathname.split("/")[2];if(M&&R)try{const W=await nn.addPlaylistToFolder(R,M);On.syncUserFolder(W,"update"),window.dispatchEvent(new HashChangeEvent("hashchange")),Dn("Playlist added to folder")}catch(W){console.error("Failed to add playlist to folder:",W),Dn("Failed to add playlist to folder")}})),document.querySelectorAll(".search-tab").forEach(_=>{_.addEventListener("click",()=>{const M=_.closest(".page");if(!M)return;Hp(_.dataset.tab),M.querySelectorAll(".search-tab").forEach(fe=>fe.classList.remove("active")),M.querySelectorAll(".search-tab-content").forEach(fe=>fe.classList.remove("active")),_.classList.add("active");const W=`${M.id==="page-library"?"library-tab-":"search-tab-"}${_.dataset.tab}`;document.getElementById(W)?.classList.add("active")})}),document.querySelectorAll(".settings-tab").forEach(_=>{_.addEventListener("click",()=>{document.querySelectorAll(".settings-tab").forEach(R=>R.classList.remove("active")),document.querySelectorAll(".settings-tab-content").forEach(R=>R.classList.remove("active")),_.classList.add("active");const M=`settings-tab-${_.dataset.tab}`;document.getElementById(M)?.classList.add("active"),ta(async()=>{const{settingsUiState:R}=await Promise.resolve().then(()=>ya);return{settingsUiState:R}},void 0,import.meta.url).then(({settingsUiState:R})=>{R.setActiveTab(_.dataset.tab)})})});const E=window.matchMedia("(hover: hover) and (pointer: fine)").matches;let S=null;if(E){S=document.getElementById("custom-tooltip"),S||(S=document.createElement("div"),S.id="custom-tooltip",document.body.appendChild(S));const _=M=>{const R=M.clientX+15,W=M.clientY+15,fe=S.getBoundingClientRect(),ye=window.innerWidth,Y=window.innerHeight;let j=R,se=W;R+fe.width>ye&&(j=M.clientX-fe.width-10),W+fe.height>Y&&(se=M.clientY-fe.height-10),j<5&&(j=5),se<5&&(se=5),j+fe.width>ye-5&&(j=ye-fe.width-5),se+fe.height>Y-5&&(se=Y-fe.height-5),S.style.transform=`translate(${j}px, ${se}px)`,S.style.top="0",S.style.left="0"};document.body.addEventListener("mouseover",M=>{const W=M.target.closest(".card-title, .card-subtitle, .track-item-details .title, .track-item-details .artist, .now-playing-bar .title, .now-playing-bar .artist, .now-playing-bar .album, .pinned-item-name");if(W&&(W.hasAttribute("title")&&W.removeAttribute("title"),W.scrollWidth>W.clientWidth)){S.innerHTML=W.innerHTML.trim(),S.classList.add("visible"),_(M);const fe=Y=>{_(Y)},ye=()=>{S.classList.remove("visible"),W.removeEventListener("mousemove",fe),W.removeEventListener("mouseleave",ye),W.removeEventListener("click",ye)};W.addEventListener("mousemove",fe),W.addEventListener("mouseleave",ye),W.addEventListener("click",ye)}})}document.addEventListener("mousedown",_=>{S&&S.classList.remove("visible");const M=document.getElementById("context-menu");M&&M.style.display==="block"&&!M.contains(_.target)&&(M.style.display="none")})}function _E(o={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:n,onRegistered:r,onRegisteredSW:i,onRegisterError:c}=o;let h,f,g;const y=async(l=!0)=>{await f,g?.()};async function u(){if("serviceWorker"in navigator){if(h=await ta(async()=>{const{Workbox:l}=await import("./workbox-window.prod.es5-BIl4cyR9.js");return{Workbox:l}},[],import.meta.url).then(({Workbox:l})=>new l("./sw.js",{scope:"./",type:"classic"})).catch(l=>{c?.(l)}),!h)return;g=()=>{h?.messageSkipWaiting()};{let l=!1;const d=()=>{l=!0,h?.addEventListener("controlling",m=>{m.isUpdate&&window.location.reload()}),t?.()};h.addEventListener("installed",m=>{typeof m.isUpdate>"u"?typeof m.isExternal<"u"&&m.isExternal?d():!l&&n?.():m.isUpdate||n?.()}),h.addEventListener("waiting",d)}h.register({immediate:e}).then(l=>{i?i("./sw.js",l):r?.(l)}).catch(l=>{c?.(l)})}}return f=u(),y}let Zr=null,_s=!1,Mi=!1;async function AE(){if(_s)return!0;if(Mi)return new Promise(o=>{const e=setInterval(()=>{Mi||(clearInterval(e),o(_s))},100)});Mi=!0;try{return await new Promise((o,e)=>{const t=document.createElement("script");t.src="https://unpkg.com/@studio-freight/lenis",t.onload=o,t.onerror=e,document.head.appendChild(t)}),_s=!0,Mi=!1,console.log("âœ“ Lenis loaded successfully"),!0}catch(o){return console.error("âœ— Failed to load Lenis:",o),_s=!1,Mi=!1,!1}}async function Ld(){if(Zr||!await AE())return;Zr=new window.Lenis({wrapper:document.querySelector(".main-content"),content:document.querySelector(".main-content"),lerp:.1,smoothWheel:!0,smoothTouch:!1,normalizeWheel:!0,wheelMultiplier:.8});function e(t){Zr&&(Zr.raf(t),requestAnimationFrame(e))}requestAnimationFrame(e)}function SE(){Zr&&(Zr.destroy(),Zr=null)}async function Pd(){zd.isEnabled()&&await Ld(),window.addEventListener("smooth-scrolling-toggle",async function(e){e.detail.enabled?await Ld():SE()})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Pd):Pd();class kE{constructor(){this.pb=On.pb,this.modal=document.getElementById("theme-store-modal"),this.grid=document.getElementById("community-themes-grid"),this.uploadForm=document.getElementById("theme-upload-form"),this.searchInput=document.getElementById("theme-store-search"),this.loadingIndicator=document.getElementById("theme-store-loading"),this._isCheckingAuth=!1,this.previewShadow=null,this.init()}init(){document.getElementById("open-theme-store-btn")?.addEventListener("click",()=>{this.modal.classList.add("active"),this.loadThemes()}),this.modal?.querySelector(".close-modal-btn")?.addEventListener("click",()=>{this.modal.classList.remove("active")});const e=this.modal?.querySelectorAll(".search-tab");e?.forEach(n=>{n.addEventListener("click",()=>{e.forEach(i=>i.classList.remove("active")),this.modal.querySelectorAll(".search-tab-content").forEach(i=>i.classList.remove("active")),n.classList.add("active");const r=n.dataset.tab==="browse"?"theme-store-browse":"theme-store-upload";document.getElementById(r)?.classList.add("active"),n.dataset.tab==="upload"&&this.checkAuth()})});let t;this.searchInput?.addEventListener("input",n=>{clearTimeout(t),t=setTimeout(()=>this.loadThemes(n.target.value),300)}),this.uploadForm?.addEventListener("submit",n=>this.handleUpload(n)),la&&la.onAuthStateChanged(()=>{this.modal.classList.contains("active")&&this.checkAuth()}),document.getElementById("theme-store-login-btn")?.addEventListener("click",()=>{this.modal.classList.remove("active"),document.getElementById("email-auth-modal")?.classList.add("active")}),this.setupEditorTools(),document.getElementById("theme-details-back-btn")?.addEventListener("click",()=>{this.closeThemeDetails()}),this.applySavedTheme()}applySavedTheme(){const e=localStorage.getItem("monochrome-theme"),t=localStorage.getItem("custom_theme_css");if(e==="custom"&&t){const n=localStorage.getItem("community-theme");let r=null;if(n)try{r=JSON.parse(n)}catch(i){console.warn(i)}r?this.applyTheme({css:t,id:r.id,name:r.name,authorName:r.author}):this.applyTheme(t)}}async loadThemes(e=""){if(!this.grid)return;this.grid.innerHTML="",this.loadingIndicator.style.display="block";let t=null;if(la.user)try{t=(await On._getUserRecord(la.user.uid))?.id}catch(n){console.warn("Failed to resolve user ID for theme ownership check",n)}try{const n=await this.pb.collection("themes").getList(1,50,{sort:"-created",filter:e?`name ~ "${e}" || description ~ "${e}"`:"",expand:"author"});if(this.loadingIndicator.style.display="none",n.items.length===0){this.grid.innerHTML='<div class="empty-state">No themes found.</div>';return}n.items.forEach(r=>{this.grid.appendChild(this.createThemeCard(r,t))})}catch(n){console.error("Failed to load themes:",n),this.loadingIndicator.style.display="none",this.grid.innerHTML='<div class="empty-state">Failed to load themes.</div>'}}createThemeCard(e,t){const n=document.createElement("div");n.className="card theme-card";const r=e.expand?.author?.username||e.expand?.author?.display_name||e.authorName||"Unknown",i=e.description?e.description.length>80?e.description.substring(0,80)+"...":e.description:"";let c=this.escapeHtml(r),h=!1;e.expand?.author?.username?(h=!0,c=`<span class="author-link" style="cursor: pointer; text-decoration: underline;">${this.escapeHtml(r)}</span>`):e.authorUrl&&(c=`<a href="${this.escapeHtml(e.authorUrl)}" target="_blank" style="color: inherit; text-decoration: underline;" onclick="event.stopPropagation();">${this.escapeHtml(r)}</a>`);let f="";t&&e.author===t&&(f=`
                <button class="btn-icon delete-theme-btn" title="Delete Theme" style="position: absolute; top: 0.5rem; right: 0.5rem; background: rgba(0,0,0,0.6); color: white; border-radius: 50%; padding: 0.25rem; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; border: none; cursor: pointer; z-index: 10;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                </button>
            `);const y=`
            <div class="theme-card-preview" style="${this.extractPreviewStyles(e.css)}; height: 140px; position: relative;">
                <div class="theme-card-preview-header" style="background-color: var(--card); border-bottom: 1px solid var(--border);"></div>
                <div class="theme-card-preview-body" style="background-color: var(--background);">
                    <div class="theme-card-preview-line" style="background-color: var(--foreground); width: 80%;"></div>
                    <div class="theme-card-preview-line" style="background-color: var(--muted-foreground); width: 60%;"></div>
                    <div class="theme-card-preview-line" style="background-color: var(--primary); width: 40%; margin-top: auto;"></div>
                </div>
            </div>`;return n.innerHTML=`
            <div style="position: relative;">
                ${f}
                ${y}
            </div>
            <div class="card-info" style="margin-top: 0.75rem;">
                <div class="card-title">${this.escapeHtml(e.name)}</div>
                <div class="card-subtitle">by ${c}</div>
                <p style="font-size: 0.8rem; color: var(--muted-foreground); margin-top: 0.25rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                    ${this.escapeHtml(i)}
                </p>
            </div>
        `,n.addEventListener("click",u=>{if(u.target.closest(".delete-theme-btn")){u.stopPropagation(),this.deleteTheme(e.id);return}this.openThemeDetails(e)}),h&&n.querySelector(".author-link")?.addEventListener("click",l=>{l.stopPropagation(),this.modal.classList.remove("active"),Bn(`/user/@${e.expand.author.username}`)}),n}async deleteTheme(e){if(confirm("Are you sure you want to delete this theme?"))try{const t=la.user;if(!t)throw new Error("Not authenticated");await this.pb.collection("themes").delete(e,{f_id:t.uid}),alert("Theme deleted successfully."),this.loadThemes()}catch(t){console.error("Failed to delete theme:",t),alert("Failed to delete theme. You might not have permission.")}}openThemeDetails(e){const t=document.getElementById("theme-store-details"),n=document.getElementById("theme-store-browse"),r=this.modal.querySelector(".search-tabs");document.getElementById("theme-details-name").textContent=e.name;const i=e.expand?.author?.username||e.expand?.author?.display_name||e.authorName||"Unknown",c=document.getElementById("theme-details-author");e.expand?.author?.username?(c.innerHTML=`by <span style="cursor: pointer; text-decoration: underline; color: var(--primary);">${this.escapeHtml(i)}</span>`,c.querySelector("span").onclick=()=>{this.modal.classList.remove("active"),Bn(`/user/@${e.expand.author.username}`)}):c.textContent=`by ${i}`,document.getElementById("theme-details-created").textContent=new Date(e.created).toLocaleDateString(),document.getElementById("theme-details-updated").textContent=new Date(e.updated).toLocaleDateString(),document.getElementById("theme-details-installs").textContent=e.installs||0,document.getElementById("theme-details-desc").textContent=e.description||"No description provided.";const h=document.getElementById("theme-details-apply-btn");h.onclick=async()=>{this.applyTheme(e),this.modal.classList.remove("active");try{const l=await this.pb.collection("themes").getOne(e.id);await this.pb.collection("themes").update(e.id,{installs:(l.installs||0)+1})}catch(l){console.warn("Failed to update theme installs:",l)}};const f=document.getElementById("theme-details-preview-container");f.innerHTML="",this.detailsPreviewShadow=f.attachShadow({mode:"open"});const g=document.createElement("link");g.rel="stylesheet",g.href="/styles.css",this.detailsPreviewShadow.appendChild(g);const y=document.createElement("style");y.textContent=e.css.replace(/:root/g,":host"),this.detailsPreviewShadow.appendChild(y);const u=document.createElement("div");u.className="preview-content",u.style.padding="1rem",u.style.height="100%",u.style.background="var(--background)",u.style.color="var(--foreground)",u.style.overflow="hidden",u.innerHTML=`
            <div class="card" style="margin-bottom: 1rem;">
                <div style="height: 60px; background: var(--muted); border-radius: var(--radius); margin-bottom: 0.5rem;"></div>
                <div class="card-title">Preview</div>
                <div class="card-subtitle">Subtitle</div>
            </div>
            <button class="btn-primary" style="margin-bottom: 0.5rem; width: 100%;">Button</button>
        `,this.detailsPreviewShadow.appendChild(u),n.style.display="none",r.style.display="none",t.style.display="flex"}closeThemeDetails(){const e=document.getElementById("theme-store-details"),t=document.getElementById("theme-store-browse"),n=this.modal.querySelector(".search-tabs");e.style.display="none",t.style.display="block",n.style.display="flex",document.getElementById("theme-details-preview-container").innerHTML=""}extractPreviewStyles(e){const t=["--background","--foreground","--primary","--card","--border","--muted-foreground"];let n="";return t.forEach(r=>{const i=new RegExp(`${r}\\s*:\\s*([^;]+)`),c=e.match(i);c&&(n+=`${r}: ${c[1]}; `)}),n}applyTheme(e){let t=e.css;!t&&typeof e=="string"&&(t=e,e={name:"Custom Theme",authorName:"Unknown"}),localStorage.setItem("custom_theme_css",t),localStorage.setItem("monochrome-theme","custom");const n={id:e.id,name:e.name,author:e.authorName||e.expand?.author?.username||e.expand?.author?.display_name||"Unknown"};localStorage.setItem("community-theme",JSON.stringify(n));let r=document.getElementById("custom-theme-style");r||(r=document.createElement("style"),r.id="custom-theme-style",document.head.appendChild(r));const i=t.match(/--font-family:\s*([^;}]+)/),c=t.match(/--font-url:\s*([^;}]+)/);if(i&&i[1]){const g=i[1].trim().split(",")[0].trim().replace(/['"]/g,"");if(!["serif","sans-serif","monospace","cursive","fantasy","system-ui","inter","ibm plex mono","roboto","open sans","lato","montserrat","poppins","apple music","sf pro display","courier new","times new roman","arial","helvetica","verdana","tahoma","trebuchet ms","impact","gill sans"].some(l=>g.toLowerCase()===l)){const l="monochrome-dynamic-font";let d=document.getElementById(l);if(c&&c[1]){const m=c[1].trim().replace(/['"]/g,"");console.log(`Applying custom font URL: ${m}`),m.match(/\.(css)$/i)||m.includes("fonts.googleapis.com")?(d||(d=document.createElement("link"),d.id=l,d.rel="stylesheet",document.head.appendChild(d)),d.href=m):(d&&d.remove(),t=`
@font-face {
    font-family: '${g}';
    src: url('${m}');
    font-weight: 100 900;
    font-display: swap;
}
`+t)}else{console.log(`Applying custom font from theme (Google Fonts): ${g}`);const E=`https://fonts.googleapis.com/css2?family=${encodeURIComponent(g)}:wght@100;200;300;400;500;600;700;800;900&display=swap`;d||(d=document.createElement("link"),d.id=l,d.rel="stylesheet",document.head.appendChild(d)),d.href=E}}}r.textContent=t;const h=document.documentElement;["background","foreground","primary","secondary","muted","border","highlight","font-family"].forEach(f=>{h.style.removeProperty(`--${f}`)}),h.setAttribute("data-theme","custom"),document.querySelectorAll(".theme-option").forEach(f=>f.classList.remove("active")),document.querySelector('[data-theme="custom"]')?.classList.add("active"),document.documentElement.style.display="none",document.documentElement.offsetHeight,document.documentElement.style.display="",window.dispatchEvent(new CustomEvent("theme-changed",{detail:{theme:"custom"}}))}async checkAuth(){if(this._isCheckingAuth)return;this._isCheckingAuth=!0;const e=!!la?.user,t=document.getElementById("theme-upload-auth-message"),n=document.getElementById("theme-upload-form"),i=document.getElementById("theme-upload-website")?.parentElement;if(e){t.style.display="none",n.style.display="block";try{(await On.getUserData())?.profile?.username&&i?i.style.display="none":i&&(i.style.display="block")}catch(c){console.warn("Failed to check profile for website input visibility",c)}}else t.style.display="flex",n.style.display="none";this._isCheckingAuth=!1}async handleUpload(e){e.preventDefault();const t=document.getElementById("theme-upload-name").value,n=document.getElementById("theme-upload-desc").value,r=document.getElementById("theme-upload-css").value,i=document.getElementById("theme-upload-website").value,c=la?.user;if(!c){alert("You must be logged in to upload themes.");return}let h=null,f=null;try{const g=await On._getUserRecord(c.uid);if(!g)throw new Error("Could not find or create your user record. Please try again.");if(h=g.id,f=g.username||g.display_name||c.email,h.length!==15)throw new Error(`Your user ID is corrupted (${h.length} chars, expected 15). Please go to Settings > System > Clear Cloud Data, then log out and back in.`);console.log("Uploading theme:",{name:t,author:h,authorName:f});const y=new FormData;y.append("name",t),y.append("description",n),y.append("css",r),y.append("author",h),y.append("authorName",f),i&&y.append("authorUrl",i),await this.pb.collection("themes").create(y,{f_id:c.uid}),alert("Theme uploaded successfully!"),e.target.reset();const u=document.getElementById("theme-preview-window"),l=document.getElementById("te-toggle-preview");u&&(u.style.display="none"),l&&(l.textContent="Preview",l.classList.remove("active")),this.modal.querySelector('[data-tab="browse"]').click(),this.loadThemes()}catch(g){console.error("Upload failed:",g),console.error("Response data:",g.data);const y=g.data?.data||{};if(Object.keys(y).length>0){let u=`Failed to upload theme:
`;for(const[l,d]of Object.entries(y))u+=`â€¢ ${l}: ${d.message}
`;alert(u)}else{const u=g.message||g.data?.message||"Unknown error",l=`

Debug: User ID: ${h} (${h?.length} chars) | Status: ${g.status}`;alert(`Failed to upload theme: ${u}${l}`)}}}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}setupEditorTools(){const e=document.getElementById("theme-upload-css"),t=document.getElementById("te-insert-template"),n=document.getElementById("te-toggle-preview"),r=document.getElementById("theme-preview-window");Object.entries({"te-bg-color":"--background","te-fg-color":"--foreground","te-primary-color":"--primary","te-sec-color":"--secondary","te-accent-color":"--highlight","te-card-color":"--card","te-border-color":"--border","te-muted-color":"--muted-foreground"}).forEach(([h,f])=>{document.getElementById(h)?.addEventListener("input",g=>{this.updateCssVariable(e,f,g.target.value),this.updatePreview()})}),Object.entries({"te-font-family":"--font-family","te-radius":"--radius"}).forEach(([h,f])=>{document.getElementById(h)?.addEventListener("change",g=>{g.target.value&&(this.updateCssVariable(e,f,g.target.value),this.updatePreview(),g.target.value="")})}),document.getElementById("te-font-custom")?.addEventListener("input",h=>{this.updateCssVariable(e,"--font-family",h.target.value),this.updatePreview()}),t?.addEventListener("click",()=>{e.value.trim()&&!confirm("Overwrite current CSS with template?")||(e.value=`:root {
    /* Base Colors */
    --background: #0a0a0a;
    --foreground: #ededed;
    
    /* UI Elements */
    --card: #1a1a1a;
    --card-foreground: #ededed;
    --border: #2a2a2a;
    
    /* Accents */
    --primary: #3b82f6;
    --primary-foreground: #ffffff;
    --secondary: #2a2a2a;
    --secondary-foreground: #ededed;
    
    /* Text */
    --muted: #2a2a2a;
    --muted-foreground: #a0a0a0;
    
    /* Special */
    --highlight: #3b82f6;
    --ring: #3b82f6;
    --radius: 8px;
    --font-family: 'Inter', sans-serif;
    --font-size-scale: 100%;
}`,this.updatePreview())}),n?.addEventListener("click",()=>{r.style.display!=="none"?(r.style.display="none",n.textContent="Preview",n.classList.remove("active")):(r.style.display="flex",n.textContent="Close Preview",n.classList.add("active"),this.initPreviewWindow(),this.updatePreview())}),e?.addEventListener("input",()=>this.updatePreview())}updateCssVariable(e,t,n){let r=e.value;const i=new RegExp(`${t}:\\s*[^;\\}]+(?:;|(?=\\}))`,"g"),c=`${t}: ${n};`;i.test(r)?r=r.replace(i,c):r.includes(":root {")?r=r.replace(":root {",`:root {
    ${c}`):r+=`
:root {
    ${c}
}`,e.value=r}initPreviewWindow(){const e=document.getElementById("theme-preview-window");if(!this.previewShadow){this.previewShadow=e.attachShadow({mode:"open"});const t=document.createElement("link");t.rel="stylesheet",t.href="/styles.css",this.previewShadow.appendChild(t),this.previewStyleTag=document.createElement("style"),this.previewShadow.appendChild(this.previewStyleTag);const n=document.createElement("div");n.className="preview-content",n.style.padding="1rem",n.style.height="100%",n.style.background="var(--background)",n.style.color="var(--foreground)",n.style.overflow="auto",n.innerHTML=`
                <h3 style="margin-top: 0;">Preview</h3>
                <div class="card" style="margin-bottom: 1rem;">
                    <div style="height: 100px; background: var(--muted); border-radius: var(--radius); margin-bottom: 0.5rem;"></div>
                    <div class="card-title">Card Title</div>
                    <div class="card-subtitle">Subtitle</div>
                </div>
                <button class="btn-primary" style="margin-bottom: 0.5rem;">Primary Button</button>
                <button class="btn-secondary">Secondary Button</button>
                <p style="color: var(--muted-foreground);">Muted text example.</p>
            `,this.previewShadow.appendChild(n)}}updatePreview(){if(!this.previewShadow||!this.previewStyleTag)return;const t=document.getElementById("theme-upload-css").value.replace(/:root/g,":host");this.previewStyleTag.textContent=t}}const IE={track:["track name","title","song","name","track","track title"],artist:["artist name(s)","artist name","artist","artists","creator","artist names"],album:["album","album name"],type:["type","category","kind"],isrc:["isrc","isrc code"],spotifyId:["spotify - id","spotify id","spotify_id","spotifyid"],playlistName:["playlist name","playlist","playlist title"],duration:["duration","length","time"]};function RE(o){return o.toLowerCase().trim().replace(/[_\s]+/g," ")}function xE(o){const e={};return o.forEach((t,n)=>{const r=RE(t);for(const[i,c]of Object.entries(IE))if(c.includes(r)){e[i]=n;break}}),e}function CE(o){const e=o.type!==void 0,t=o.track!==void 0,n=o.artist!==void 0,r=o.album!==void 0;return t&&n?{format:"library",hasMultipleTypes:e,supportsTracks:!0,supportsAlbums:r,supportsArtists:n&&!t}:n&&!t?{format:"artists",hasMultipleTypes:!1,supportsTracks:!1,supportsAlbums:!1,supportsArtists:!0}:{format:"playlist",hasMultipleTypes:!1,supportsTracks:!0,supportsAlbums:!1,supportsArtists:!1}}async function LE(o,e,t){const n=o.trim().split(`
`);if(n.length<2)return{format:"unknown",tracks:[],albums:[],artists:[],missingItems:[],playlists:{}};const r=S=>{const _=[];let M="",R=!1;for(let W=0;W<S.length;W++){const fe=S[W];fe==='"'?R=!R:fe===","&&!R?(_.push(M),M=""):M+=fe}return _.push(M),_.map(W=>W.trim().replace(/^"|"$/g,"").replace(/""/g,'"').trim())},i=r(n[0]),c=xE(i),h=CE(c),f=n.slice(1),g=[],y=[],u=[],l=[],d={},m=f.length,E=S=>{if(c.type!==void 0){const W=S[c.type]?.toLowerCase().trim();if(W==="album"||W==="favorite album")return"album";if(W==="artist"||W==="favorite artist")return"artist";if(W==="track"||W==="favorite"||W==="favorite track")return"track"}const _=c.track!==void 0&&S[c.track],M=c.artist!==void 0&&S[c.artist],R=c.album!==void 0&&S[c.album];return _&&M?"track":R&&M&&!_?"album":M&&!_&&!R?"artist":"track"};for(let S=0;S<f.length;S++){const _=f[S];if(!_.trim())continue;const M=r(_),R=E(M),W=c.track!==void 0?M[c.track]:"",fe=c.artist!==void 0?M[c.artist]:"",ye=c.album!==void 0?M[c.album]:"",Y=c.isrc!==void 0?M[c.isrc]:"",j=c.playlistName!==void 0?M[c.playlistName]:"";t&&t({current:S,total:m,currentItem:W||fe||ye||"Unknown item",type:R}),await new Promise(se=>setTimeout(se,300));try{if(R==="track"){let se=null;if(Y){const Te=await e.searchTracks(`isrc:${Y}`);Te.items&&Te.items.length>0&&(se=Te.items.find(Ae=>Ae.isrc===Y)||Te.items[0])}if(!se&&W&&fe){const Te=`"${W}" ${fe}`.trim(),Ae=await e.searchTracks(Te);Ae.items&&Ae.items.length>0&&(se=Ae.items[0])}se?(g.push(se),j&&(d[j]||(d[j]=[]),d[j].push(se))):l.push({type:"track",title:W,artist:fe,album:ye,isrc:Y})}else if(R==="album"){let se=null;if(fe&&ye){const Te=`"${ye}" ${fe}`.trim(),Ae=await e.searchAlbums(Te);Ae.items&&Ae.items.length>0&&(se=Ae.items[0])}se?y.push(se):l.push({type:"album",title:ye,artist:fe})}else if(R==="artist"){let se=null;if(fe){const Te=await e.searchArtists(fe);Te.items&&Te.items.length>0&&(se=Te.items[0])}se?u.push(se):l.push({type:"artist",name:fe})}}catch{l.push({type:R,title:W||ye,artist:fe})}}return{format:h.format,tracks:g,albums:y,artists:u,missingItems:l,playlists:d,stats:{totalItems:m,tracksFound:g.length,albumsFound:y.length,artistsFound:u.length,missingCount:l.length,playlistCount:Object.keys(d).length}}}async function PE(o,e,t){const n={tracks:{added:0,failed:0},albums:{added:0,failed:0},artists:{added:0,failed:0},playlists:{created:0,tracksAdded:0}},r=new Set,i=new Set,c=new Set;for(const h of o.tracks){if(!r.has(h.id))try{await e.toggleFavorite("track",h),r.add(h.id),n.tracks.added++}catch{n.tracks.failed++}t&&t({action:"track",item:h.title})}for(const h of o.albums){if(!i.has(h.id))try{await e.toggleFavorite("album",h),i.add(h.id),n.albums.added++}catch{n.albums.failed++}t&&t({action:"album",item:h.title})}for(const h of o.artists){if(!c.has(h.id))try{await e.toggleFavorite("artist",h),c.add(h.id),n.artists.added++}catch{n.artists.failed++}t&&t({action:"artist",item:h.name})}for(const[h,f]of Object.entries(o.playlists)){if(f.length>0)try{await e.createPlaylist(h,f),n.playlists.created++,n.playlists.tracksAdded+=f.length}catch{console.warn(`Failed to create playlist: ${h}`)}t&&t({action:"playlist",item:h})}return n}async function NE(o,e,t){const n=o.trim().split(`
`);if(n.length<2)return{tracks:[],missingTracks:[]};const r=y=>{const u=[];let l="",d=!1;for(let m=0;m<y.length;m++){const E=y[m];E==='"'?d=!d:E===","&&!d?(u.push(l),l=""):l+=E}return u.push(l),u.map(m=>m.trim().replace(/^"|"$/g,"").replace(/""/g,'"').trim())},i=r(n[0]),c=n.slice(1),h=[],f=[],g=c.length;for(let y=0;y<c.length;y++){const u=c[y];if(!u.trim())continue;const l=r(u);if(l.length>=i.length){let d="",m="",E="";if(i.forEach((S,_)=>{const M=l[_];if(M)switch(S.toLowerCase()){case"track name":case"title":case"song":case"name":d=M;break;case"artist name(s)":case"artist name":case"artist":case"artists":case"creator":m=M;break;case"album":case"album name":E=M;break}}),t&&t({current:y,total:g,currentTrack:d||"Unknown track",currentArtist:m||""}),d&&m){await new Promise(S=>setTimeout(S,300));try{const S=`"${d}" ${m}`.trim(),_=await e.searchTracks(S);_.items&&_.items.length>0?h.push(_.items[0]):f.push({title:d,artist:m,album:E})}catch{f.push({title:d,artist:m,album:E})}}}}return{tracks:h,missingTracks:f}}async function ME(o,e,t){try{const n=JSON.parse(o);if(!n.playlist||!Array.isArray(n.playlist.track))throw new Error("Invalid JSPF format: missing playlist or track array");const r=n.playlist,i=[],c=[],h=r.track.length;for(let f=0;f<r.track.length;f++){const g=r.track[f],y=g.title,u=g.creator,l=g.album;if(t&&t({current:f,total:h,currentTrack:y||"Unknown track",currentArtist:u||""}),y&&u){await new Promise(d=>setTimeout(d,300));try{const d=`${y} ${u}`,m=await e.searchTracks(d);m.items&&m.items.length>0?i.push(m.items[0]):c.push({title:y,artist:u,album:l})}catch{c.push({title:y,artist:u,album:l})}}}return{tracks:i,missingTracks:c}}catch(n){throw new Error("Failed to parse JSPF: "+n.message)}}async function DE(o,e,t){if(!o||typeof o!="string"||o.length>10*1024*1024)throw new Error("Invalid XSPF content");if(o.includes("<!ENTITY")||o.includes("<!DOCTYPE"))throw new Error("XSPF content contains potentially dangerous declarations");const i=new DOMParser().parseFromString(o,"application/xml").getElementsByTagName("track"),c=[],h=[],f=i.length;for(let g=0;g<i.length;g++){const y=i[g],u=y.getElementsByTagName("title")[0]?.textContent||"",l=y.getElementsByTagName("creator")[0]?.textContent||"",d=y.getElementsByTagName("album")[0]?.textContent||"";if(t&&t({current:g,total:f,currentTrack:u||"Unknown track",currentArtist:l||""}),u&&l){await new Promise(m=>setTimeout(m,300));try{const m=`${u} ${l}`,E=await e.searchTracks(m);E.items&&E.items.length>0?c.push(E.items[0]):h.push({title:u,artist:l,album:d})}catch{h.push({title:u,artist:l,album:d})}}}return{tracks:c,missingTracks:h}}async function OE(o,e,t){if(!o||typeof o!="string"||o.length>10*1024*1024)throw new Error("Invalid XML content");if(o.includes("<!ENTITY")||o.includes("<!DOCTYPE"))throw new Error("XML content contains potentially dangerous declarations");const r=new DOMParser().parseFromString(o,"application/xml");let i=r.getElementsByTagName("track");i.length===0&&(i=r.getElementsByTagName("song")),i.length===0&&(i=r.getElementsByTagName("item"));const c=[],h=[],f=i.length;for(let g=0;g<i.length;g++){const y=i[g],u=y.getElementsByTagName("title")[0]?.textContent||y.getElementsByTagName("name")[0]?.textContent||"",l=y.getElementsByTagName("artist")[0]?.textContent||y.getElementsByTagName("creator")[0]?.textContent||y.getElementsByTagName("performer")[0]?.textContent||"",d=y.getElementsByTagName("album")[0]?.textContent||"";if(t&&t({current:g,total:f,currentTrack:u||"Unknown track",currentArtist:l||""}),u&&l){await new Promise(m=>setTimeout(m,300));try{const m=`${u} ${l}`,E=await e.searchTracks(m);E.items&&E.items.length>0?c.push(E.items[0]):h.push({title:u,artist:l,album:d})}catch{h.push({title:u,artist:l,album:d})}}}return{tracks:c,missingTracks:h}}async function zE(o,e,t){const n=o.trim().split(`
`),r=[],i=[],c=[];let h=null;for(const g of n){const y=g.trim();if(!(!y||y.startsWith("#EXTM3U")))if(y.startsWith("#EXTINF:")){const u=y.match(/#EXTINF:(-?\d+)?,(.+)/);if(u){const l=u[2],d=l.split(" - ");h={title:d.length>1?d.slice(1).join(" - "):l,artist:d.length>1?d[0]:""}}}else y.startsWith("#")||h&&(c.push(h),h=null)}const f=c.length;for(let g=0;g<c.length;g++){const y=c[g];if(t&&t({current:g,total:f,currentTrack:y.title||"Unknown track",currentArtist:y.artist||""}),y.title){await new Promise(u=>setTimeout(u,300));try{const u=y.artist?`${y.title} ${y.artist}`:y.title,l=await e.searchTracks(u);l.items&&l.items.length>0?r.push(l.items[0]):i.push({title:y.title,artist:y.artist,album:""})}catch{i.push({title:y.title,artist:y.artist,album:""})}}}return{tracks:r,missingTracks:i}}let Uo=null,Bo=null,Fo=null;async function UE(){return Uo||(Uo=await ta(()=>import("./settings-DhcVzUFa.js"),[],import.meta.url)),Uo}async function va(){return Bo||(Bo=await ta(()=>Promise.resolve().then(()=>zp),void 0,import.meta.url)),Bo}async function BE(){return Fo||(Fo=await ta(()=>Promise.resolve().then(()=>Ap),void 0,import.meta.url)),Fo}function FE(o,e){e&&("remote"in o?(o.remote.watchAvailability(t=>{t&&(e.style.display="flex",e.classList.add("available"))}).catch(t=>{console.log("Remote playback not available:",t),window.innerWidth>768&&(e.style.display="flex")}),e.addEventListener("click",()=>{if(!o.src){alert("Please play a track first to enable casting.");return}o.remote.prompt().catch(t=>{if(t.name!=="NotAllowedError"){if(t.name==="NotFoundError"){alert("No remote playback devices (Chromecast/AirPlay) were found on your network.");return}console.log("Cast prompt error:",t)}})}),o.addEventListener("playing",()=>{o.remote&&o.remote.state==="connected"&&e.classList.add("connected")}),o.addEventListener("pause",()=>{o.remote&&o.remote.state==="disconnected"&&e.classList.remove("connected")})):o.webkitShowPlaybackTargetPicker?(e.style.display="flex",e.classList.add("available"),e.addEventListener("click",()=>{o.webkitShowPlaybackTargetPicker()}),o.addEventListener("webkitplaybacktargetavailabilitychanged",t=>{t.availability==="available"&&e.classList.add("available")}),o.addEventListener("webkitcurrentplaybacktargetiswirelesschanged",()=>{o.webkitCurrentPlaybackTargetIsWireless?e.classList.add("connected"):e.classList.remove("connected")})):window.innerWidth>768&&(e.style.display="flex",e.addEventListener("click",()=>{alert("Casting is not supported in this browser. Try Chrome for Chromecast or Safari for AirPlay.")})))}function qE(o,e){document.addEventListener("keydown",t=>{if(!t.target.matches("input, textarea"))switch(t.key.toLowerCase()){case" ":t.preventDefault(),Ra("Space"),o.handlePlayPause();break;case"arrowright":t.shiftKey?(Ra("Shift+Right"),o.playNext()):(Ra("Right"),e.currentTime=Math.min(e.duration,e.currentTime+10));break;case"arrowleft":t.shiftKey?(Ra("Shift+Left"),o.playPrev()):(Ra("Left"),e.currentTime=Math.max(0,e.currentTime-10));break;case"arrowup":t.preventDefault(),Ra("Up"),o.setVolume(o.userVolume+.1);break;case"arrowdown":t.preventDefault(),Ra("Down"),o.setVolume(o.userVolume-.1);break;case"m":Ra("M"),e.muted=!e.muted;break;case"s":Ra("S"),document.getElementById("shuffle-btn")?.click();break;case"r":Ra("R"),document.getElementById("repeat-btn")?.click();break;case"q":Ra("Q"),document.getElementById("queue-btn")?.click();break;case"/":t.preventDefault(),Ra("/"),document.getElementById("search-input")?.focus();break;case"escape":Ra("Escape"),document.getElementById("search-input")?.blur(),ea.close(),Gi(e,ea.panel);break;case"l":Ra("L"),document.querySelector(".now-playing-bar .cover")?.click();break}})}function jE(){const o=document.createElement("div");o.className="offline-notification",o.innerHTML=`
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
            <line x1="12" y1="9" x2="12" y2="13"/>
            <line x1="12" y1="17" x2="12.01" y2="17"/>
        </svg>
        <span>You are offline. Some features may not work.</span>
    `,document.body.appendChild(o),setTimeout(()=>{o.style.animation="slide-out 0.3s ease forwards",setTimeout(()=>o.remove(),300)},5e3)}function HE(){const o=document.querySelector(".offline-notification");o&&(o.style.animation="slide-out 0.3s ease forwards",setTimeout(()=>o.remove(),300))}async function GE(){if("serviceWorker"in navigator){try{const o=await navigator.serviceWorker.getRegistrations();await Promise.all(o.map(e=>e.unregister()))}catch(o){console.warn("Failed to unregister service workers:",o)}if("caches"in window)try{const o=await caches.keys();await Promise.all(o.map(e=>caches.delete(e)))}catch(o){console.warn("Failed to clear caches:",o)}}}async function YE(o){try{const e=new FormData;e.append("file",o);const t=await fetch("/upload",{method:"POST",body:e});if(!t.ok){const r=await t.json();throw new Error(r.error||`Upload failed: ${t.status}`)}return(await t.json()).url}catch(e){throw console.error("Cover upload error:",e),e}}document.addEventListener("DOMContentLoaded",async()=>{xy(),new kE;const o=new nf(ol),e=document.getElementById("audio-player"),t=typeof window<"u"&&window.__IS_IOS__===!0,n=navigator.userAgent.toLowerCase(),r=n.includes("safari")&&!n.includes("chrome")&&!n.includes("crios")&&!n.includes("android");if(t||r){const Ie=document.getElementById("streaming-quality-setting"),pe=document.getElementById("download-quality-setting"),Be=z=>{if(!z)return;const k=z.querySelector('option[value="HI_RES_LOSSLESS"]');k&&k.remove()};Be(Ie),Be(pe);const O=localStorage.getItem("playback-quality");(!O||O==="HI_RES_LOSSLESS")&&localStorage.setItem("playback-quality","LOSSLESS")}const i=localStorage.getItem("playback-quality")||"HI_RES_LOSSLESS",c=new fE(e,o,i);if(window.monochromePlayer=c,Qb(c),window.NL_MODE&&ta(async()=>{const{events:Ie}=await import("./neutralino-bridge-BEOSBy1d.js");return{events:Ie}},[],import.meta.url).then(({events:Ie})=>{Ie.on("mediaNext",()=>c.playNext()),Ie.on("mediaPrevious",()=>c.playPrev()),Ie.on("mediaPlayPause",()=>c.handlePlayPause()),Ie.on("mediaStop",()=>{c.audio.pause(),c.audio.currentTime=0}),console.log("Media keys initialized via bridge")}),typeof window<"u"&&(window.NL_MODE||window.location.search.includes("mode=neutralino")||window.location.search.includes("nl_port="))){window.NL_MODE=!0;try{await(await ta(()=>import("./desktop-DTNmE_4h.js"),__vite__mapDeps([0,1]),import.meta.url)).initDesktop(c)}catch(Ie){console.error("Failed to load desktop module:",Ie)}}const h=document.getElementById("cast-btn");FE(e,h);const f=new sE(o,c),g=new yE,y=new pf(o),u=document.getElementById("select-local-folder-btn"),l=document.getElementById("local-browser-warning");if(u&&l){const Ie=navigator.userAgent,pe=(Ie.indexOf("Chrome")>-1||Ie.indexOf("Edg")>-1)&&!/Mobile|Android/.test(Ie),Be="showDirectoryPicker"in window,O=window.NL_MODE||window.location.search.includes("mode=neutralino")||window.location.search.includes("nl_port=");!O&&(!pe||!Be)?(u.style.display="none",l.style.display="block"):O&&(u.style.display="flex",l.style.display="none")}const d=Rs.getTheme();Rs.setTheme(d),Yo.restoreState(),await f.renderPinnedItems();const{initializeSettings:m}=await UE();m(g,c,o,f),document.querySelectorAll(".sidebar-nav a").forEach(Ie=>{Ie.addEventListener("click",()=>{const pe=Ie.getAttribute("href");if(pe&&!pe.startsWith("http")){const Be=Ie.querySelector("span")?.textContent||pe;Gp(Be)}})}),EE(c,e,g,f),TE(c,o,document.querySelector(".main-content"),document.getElementById("context-menu"),y,f,g),wE(c,o,f),qE(c,e),c.currentTrack&&f.setCurrentTrack(c.currentTrack),document.querySelector(".now-playing-bar").addEventListener("click",async Ie=>{if(!Ie.target.closest(".cover"))return;if(!c.currentTrack){alert("No track is currently playing");return}const pe=Nd.getMode();if(pe==="lyrics")ea.isActive("lyrics")?mf(c.currentTrack):hy(c.currentTrack);else if(pe==="cover"){const Be=document.getElementById("fullscreen-cover-overlay");Be&&Be.style.display==="flex"?cd():my(c.currentTrack)}if(pe==="lyrics")ea.isActive("lyrics")?(ea.close(),Gi(e,ea.panel)):ks(c.currentTrack,e,y);else if(pe==="cover"){const Be=document.getElementById("fullscreen-cover-overlay");if(Be&&Be.style.display==="flex")window.location.hash==="#fullscreen"?window.history.back():f.closeFullscreenCover();else{const O=c.getNextTrack();f.showFullscreenCover(c.currentTrack,O,y,e)}}else c.currentTrack.album?.id&&Bn(`/album/${c.currentTrack.album.id}`)}),document.getElementById("playlist-public-toggle")?.addEventListener("change",Ie=>{const pe=document.getElementById("playlist-share-btn");pe&&(pe.style.display=Ie.target.checked?"flex":"none")}),document.getElementById("close-fullscreen-cover-btn")?.addEventListener("click",()=>{cd(),window.location.hash==="#fullscreen"?window.history.back():f.closeFullscreenCover()}),document.getElementById("fullscreen-cover-image")?.addEventListener("click",()=>{window.location.hash==="#fullscreen"?window.history.back():f.closeFullscreenCover()}),document.getElementById("sidebar-toggle")?.addEventListener("click",()=>{document.body.classList.toggle("sidebar-collapsed");const Ie=document.body.classList.contains("sidebar-collapsed"),pe=document.getElementById("sidebar-toggle");pe&&(pe.innerHTML=Ie?'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>'),Yo.setCollapsed(Ie)}),document.querySelectorAll(".import-tab").forEach(Ie=>{Ie.addEventListener("click",()=>{const pe=Ie.dataset.importType;document.querySelectorAll(".import-tab").forEach(Be=>{Be.classList.remove("active"),Be.style.opacity="0.7"}),Ie.classList.add("active"),Ie.style.opacity="1",document.getElementById("csv-import-panel").style.display=pe==="csv"?"block":"none",document.getElementById("jspf-import-panel").style.display=pe==="jspf"?"block":"none",document.getElementById("xspf-import-panel").style.display=pe==="xspf"?"block":"none",document.getElementById("xml-import-panel").style.display=pe==="xml"?"block":"none",document.getElementById("m3u-import-panel").style.display=pe==="m3u"?"block":"none",document.getElementById("csv-file-input").value=pe==="csv"?document.getElementById("csv-file-input").value:"",document.getElementById("jspf-file-input").value=pe==="jspf"?document.getElementById("jspf-file-input").value:"",document.getElementById("xspf-file-input").value=pe==="xspf"?document.getElementById("xspf-file-input").value:"",document.getElementById("xml-file-input").value=pe==="xml"?document.getElementById("xml-file-input").value:"",document.getElementById("m3u-file-input").value=pe==="m3u"?document.getElementById("m3u-file-input").value:""})});const E=document.getElementById("csv-spotify-btn"),S=document.getElementById("csv-apple-btn"),_=document.getElementById("csv-ytm-btn"),M=document.getElementById("csv-spotify-guide"),R=document.getElementById("csv-apple-guide"),W=document.getElementById("csv-ytm-guide"),fe=document.getElementById("csv-input-container");E&&S&&_&&(E.addEventListener("click",()=>{E.classList.remove("btn-secondary"),E.classList.add("btn-primary"),E.style.opacity="1",S.classList.remove("btn-primary"),S.classList.add("btn-secondary"),S.style.opacity="0.7",_.classList.remove("btn-primary"),_.classList.add("btn-secondary"),_.style.opacity="0.7",M.style.display="block",R.style.display="none",W.style.display="none",fe.style.display="block"}),S.addEventListener("click",()=>{S.classList.remove("btn-secondary"),S.classList.add("btn-primary"),S.style.opacity="1",E.classList.remove("btn-primary"),E.classList.add("btn-secondary"),E.style.opacity="0.7",_.classList.remove("btn-primary"),_.classList.add("btn-secondary"),_.style.opacity="0.7",R.style.display="block",M.style.display="none",W.style.display="none",fe.style.display="block"}),_.addEventListener("click",()=>{_.classList.remove("btn-secondary"),_.classList.add("btn-primary"),_.style.opacity="1",E.classList.remove("btn-primary"),E.classList.add("btn-secondary"),E.style.opacity="0.7",S.classList.remove("btn-primary"),S.classList.add("btn-secondary"),S.style.opacity="0.7",W.style.display="block",M.style.display="none",R.style.display="none",fe.style.display="none"}));const ye=document.getElementById("playlist-cover-upload-btn"),Y=document.getElementById("playlist-cover-file-input"),j=document.getElementById("playlist-cover-toggle-url-btn"),se=document.getElementById("playlist-cover-input"),Te=document.getElementById("playlist-cover-upload-status"),Ae=document.getElementById("playlist-cover-upload-text");let ze=!1;ye?.addEventListener("click",()=>{ze||Y?.click()}),Y?.addEventListener("change",async Ie=>{const pe=Ie.target.files?.[0];if(pe){if(!pe.type.startsWith("image/")){alert("Please select an image file");return}Te.style.display="block",Ae.textContent="Uploading...",ye.disabled=!0;try{const Be=await YE(pe);se.value=Be,Ae.textContent="Done!",Ae.style.color="var(--success)",setTimeout(()=>{Te.style.display="none"},2e3)}catch(Be){Ae.textContent="Failed - try URL",Ae.style.color="var(--error)",console.error("Upload failed:",Be)}finally{ye.disabled=!1}}}),j?.addEventListener("click",()=>{ze=!ze,ze?(ye.style.flex="0 0 auto",ye.style.display="none",se.style.display="block",j.textContent="Upload",j.title="Switch to file upload"):(ye.style.flex="1",ye.style.display="flex",se.style.display="none",j.textContent="or URL",j.title="Switch to URL input")}),document.getElementById("nav-back")?.addEventListener("click",()=>{window.history.back()}),document.getElementById("nav-forward")?.addEventListener("click",()=>{window.history.forward()}),document.getElementById("toggle-lyrics-btn")?.addEventListener("click",async Ie=>{if(Ie.stopPropagation(),!c.currentTrack){alert("No track is currently playing");return}ea.isActive("lyrics")?(ea.close(),Gi(e,ea.panel)):ks(c.currentTrack,e,y)}),document.getElementById("download-current-btn")?.addEventListener("click",()=>{c.currentTrack&&Xr("download",c.currentTrack,c,o,y,"track",f)});let de=null;e.addEventListener("play",async()=>{if(!c.currentTrack)return;f.setCurrentTrack(c.currentTrack),c.updateMediaSession(c.currentTrack);const Ie=c.currentTrack.id;if(Ie===de)return;de=Ie,ea.isActive("lyrics")&&ks(c.currentTrack,e,y,!0);const pe=document.getElementById("fullscreen-cover-overlay");if(pe&&getComputedStyle(pe).display!=="none"){const O=c.getNextTrack();f.showFullscreenCover(c.currentTrack,O,y,e)}if(new URLSearchParams(window.location.search).get("fullscreen")==="1"&&pe&&getComputedStyle(pe).display==="none"){const O=c.getNextTrack();f.showFullscreenCover(c.currentTrack,O,y,e)}}),document.addEventListener("click",async Ie=>{if(Ie.target.closest("#play-album-btn")){if(Ie.target.closest("#play-album-btn").disabled)return;const Be=window.location.pathname.split("/"),O=Be.indexOf("album");let z=O!==-1?Be[O+1]:null;if(z==="t"&&(z=Be[O+2]),!z)return;try{const{tracks:k}=await o.getAlbum(z);if(k&&k.length>0){const L=[...k].sort((H,De)=>{const Ye=H.volumeNumber??H.discNumber??1,qe=De.volumeNumber??De.discNumber??1;return Ye!==qe?Ye-qe:H.trackNumber-De.trackNumber});c.setQueue(L,0);const ne=document.getElementById("shuffle-btn");ne&&ne.classList.remove("active"),c.shuffleActive=!1,c.playTrackFromQueue()}}catch(k){console.error("Failed to play album:",k);const{showNotification:L}=await va();L("Failed to play album")}}if(Ie.target.closest("#shuffle-album-btn")){if(Ie.target.closest("#shuffle-album-btn").disabled)return;const Be=window.location.pathname.split("/"),O=Be.indexOf("album");let z=O!==-1?Be[O+1]:null;if(z==="t"&&(z=Be[O+2]),!z)return;try{const{tracks:k}=await o.getAlbum(z);if(k&&k.length>0){const L=[...k].sort(()=>Math.random()-.5);c.setQueue(L,0);const ne=document.getElementById("shuffle-btn");ne&&ne.classList.remove("active"),c.shuffleActive=!1,c.playTrackFromQueue();const{showNotification:H}=await va();H("Shuffling album")}}catch(k){console.error("Failed to shuffle album:",k);const{showNotification:L}=await va();L("Failed to shuffle album")}}if(Ie.target.closest("#shuffle-artist-btn")){const pe=Ie.target.closest("#shuffle-artist-btn");if(pe.disabled)return;const Be=window.location.pathname.split("/")[2];if(!Be)return;pe.disabled=!0;const O=pe.innerHTML;pe.innerHTML='<svg class="animate-spin" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle></svg><span>Shuffling...</span>';try{const z=await o.getArtist(Be),k=[...z.albums||[],...z.eps||[]],L=new Set,ne=[],H=8;for(let Fe=0;Fe<k.length;Fe+=H){const Ue=k.slice(Fe,Fe+H);await Promise.all(Ue.map(async Ke=>{try{const{tracks:tt}=await o.getAlbum(Ke.id);tt.forEach(nt=>{L.has(nt.id)||(L.add(nt.id),ne.push(nt))})}catch(tt){console.warn(`Failed to fetch tracks for album ${Ke.title}:`,tt)}}))}if(ne.length===0&&Array.isArray(z.tracks)&&z.tracks.forEach(Fe=>{L.has(Fe.id)||(L.add(Fe.id),ne.push(Fe))}),ne.length===0)throw new Error("No tracks found for this artist");const De=[...ne].sort(()=>Math.random()-.5);c.setQueue(De,0);const Ye=document.getElementById("shuffle-btn");Ye&&Ye.classList.remove("active"),c.shuffleActive=!1,c.playTrackFromQueue();const{showNotification:qe}=await va();qe("Shuffling artist discography")}catch(z){console.error("Failed to shuffle artist tracks:",z);const{showNotification:k}=await va();k("Failed to shuffle artist tracks")}finally{document.body.contains(pe)&&(pe.disabled=!1,pe.innerHTML=O)}}if(Ie.target.closest("#download-mix-btn")){const pe=Ie.target.closest("#download-mix-btn");if(pe.disabled)return;const Be=window.location.pathname.split("/")[2];if(!Be)return;pe.disabled=!0;const O=pe.innerHTML;pe.innerHTML='<svg class="animate-spin" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle></svg><span>Downloading...</span>';try{const{mix:z,tracks:k}=await o.getMix(Be),{downloadPlaylistAsZip:L}=await va();await L(z,k,o,Ja.getQuality(),y)}catch(z){console.error("Mix download failed:",z),alert("Failed to download mix: "+z.message)}finally{pe.disabled=!1,pe.innerHTML=O}}if(Ie.target.closest("#download-playlist-btn")){const pe=Ie.target.closest("#download-playlist-btn");if(pe.disabled)return;const Be=window.location.pathname.split("/")[2];if(!Be)return;pe.disabled=!0;const O=pe.innerHTML;pe.innerHTML='<svg class="animate-spin" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle></svg><span>Downloading...</span>';try{let z,k,L=await nn.getPlaylist(Be);if(!L)try{L=await On.getPublicPlaylist(Be)}catch{}if(L)z={...L,title:L.name||L.title},k=L.tracks||[];else{const H=await o.getPlaylist(Be);z=H.playlist,k=H.tracks}const{downloadPlaylistAsZip:ne}=await va();await ne(z,k,o,Ja.getQuality(),y)}catch(z){console.error("Playlist download failed:",z),alert("Failed to download playlist: "+z.message)}finally{pe.disabled=!1,pe.innerHTML=O}}if(Ie.target.closest("#create-playlist-btn")){hd("Create Playlist");const pe=document.getElementById("playlist-modal");document.getElementById("playlist-modal-title").textContent="Create Playlist",document.getElementById("playlist-name-input").value="",document.getElementById("playlist-cover-input").value="",document.getElementById("playlist-cover-file-input").value="",document.getElementById("playlist-description-input").value="",pe.dataset.editingId="",document.getElementById("import-section").style.display="block",document.getElementById("csv-file-input").value="",document.getElementById("ytm-url-input").value="",document.getElementById("ytm-status").textContent="",document.getElementById("jspf-file-input").value="",document.getElementById("xspf-file-input").value="",document.getElementById("xml-file-input").value="",document.getElementById("m3u-file-input").value="",document.querySelectorAll(".import-tab").forEach(H=>{H.classList.toggle("active",H.dataset.importType==="csv")}),document.getElementById("csv-import-panel").style.display="block",document.getElementById("jspf-import-panel").style.display="none",document.getElementById("xspf-import-panel").style.display="none",document.getElementById("xml-import-panel").style.display="none",document.getElementById("m3u-import-panel").style.display="none";const Be=document.getElementById("playlist-public-toggle"),O=document.getElementById("playlist-share-btn");Be&&(Be.checked=!1),O&&(O.style.display="none");const z=document.getElementById("playlist-cover-upload-btn"),k=document.getElementById("playlist-cover-input"),L=document.getElementById("playlist-cover-upload-status"),ne=document.getElementById("playlist-cover-toggle-url-btn");z&&(z.style.flex="1",z.style.display="flex"),k&&(k.style.display="none"),L&&(L.style.display="none"),ne&&(ne.textContent="or URL",ne.title="Switch to URL input"),pe.classList.add("active"),document.getElementById("playlist-name-input").focus()}if(Ie.target.closest("#create-folder-btn")){hd("Create Folder");const pe=document.getElementById("folder-modal");document.getElementById("folder-name-input").value="",document.getElementById("folder-cover-input").value="",pe.classList.add("active"),document.getElementById("folder-name-input").focus()}if(Ie.target.closest("#folder-modal-save")){const pe=document.getElementById("folder-name-input").value.trim(),Be=document.getElementById("folder-cover-input").value.trim();if(pe){const O=await nn.createFolder(pe,Be);ey(O),await On.syncUserFolder(O,"create"),f.renderLibraryPage(),document.getElementById("folder-modal").classList.remove("active"),md("Create Folder")}}if(Ie.target.closest("#folder-modal-cancel")&&document.getElementById("folder-modal").classList.remove("active"),Ie.target.closest("#delete-folder-btn")){const pe=window.location.pathname.split("/")[2];pe&&confirm("Are you sure you want to delete this folder?")&&(await nn.deleteFolder(pe),await On.syncUserFolder({id:pe},"delete"),Bn("/library"))}if(Ie.target.closest("#playlist-modal-save")){let pe=document.getElementById("playlist-name-input").value.trim(),Be=document.getElementById("playlist-description-input").value.trim();const O=document.getElementById("playlist-public-toggle")?.checked;if(pe){const z=document.getElementById("playlist-modal"),k=z.dataset.editingId,L=async ne=>{if(ne.isPublic=O,O)try{await On.publishPlaylist(ne)}catch(H){console.error("Failed to publish playlist:",H),alert("Failed to publish playlist. Please ensure you are logged in.")}else try{await On.unpublishPlaylist(ne.id)}catch{}return ne};if(k){const ne=document.getElementById("playlist-cover-input").value.trim();nn.getPlaylist(k).then(async H=>{H&&(H.name=pe,H.cover=ne,H.description=Be,await L(H),await nn.performTransaction("user_playlists","readwrite",De=>De.put(H)),On.syncUserPlaylist(H,"update"),f.renderLibraryPage(),window.location.pathname===`/userplaylist/${k}`&&f.renderPlaylistPage(k,"user"),z.classList.remove("active"),delete z.dataset.editingId)})}else{const ne=document.getElementById("csv-file-input"),H=document.getElementById("jspf-file-input"),De=document.getElementById("xspf-file-input"),Ye=document.getElementById("xml-file-input"),qe=document.getElementById("m3u-file-input");let Fe=[],Ue="manual",Ke=document.getElementById("playlist-cover-input").value.trim();const tt=()=>{const vt=document.getElementById("csv-import-progress"),Tt=document.getElementById("csv-progress-fill"),yt=document.getElementById("csv-progress-current"),Zt=document.getElementById("csv-progress-total"),_n=vt.querySelector(".current-track"),An=vt.querySelector(".current-artist");return{progressElement:vt,progressFill:Tt,progressCurrent:yt,progressTotal:Zt,currentTrackElement:_n,currentArtistElement:An}},nt=document.getElementById("csv-ytm-btn")?.classList.contains("btn-primary"),dt=document.getElementById("ytm-url-input");if(nt&&dt.value.trim()){Ue="ytm_import";const Tt=dt.value.trim().split("list=")[1]?.split("&")[0],yt=`https://ytmimport.samidy.workers.dev?playlistId=${Tt}`;if(!Tt){alert("Invalid URL. Make sure it has 'list=' in it.");return}const{progressElement:Zt,progressFill:_n,progressCurrent:An,progressTotal:Sn,currentTrackElement:wn,currentArtistElement:Rn}=tt();try{Zt.style.display="block",_n.style.width="0%",An.textContent="0",wn.textContent="Fetching from YouTube...",Rn&&(Rn.textContent="");const st=await(await fetch(yt)).json();if(st.error)throw new Error(st.error);wn.textContent=`Processing ${st.length} songs...`;const lt=`Title,Artist,URL
`+st.map(Ft=>`"${Ft.title.replace(/"/g,'""')}","${Ft.artist.replace(/"/g,'""')}","${Ft.url}"`).join(`
`),ft=st.length;Sn.textContent=ft.toString();const kt=await NE(lt,o,Ft=>{const It=ft>0?Ft.current/ft*100:0;_n.style.width=`${Math.min(It,100)}%`,An.textContent=Ft.current.toString(),wn.textContent=Ft.currentTrack,Rn&&(Rn.textContent=Ft.currentArtist||"")});Fe=kt.tracks;const Ot=kt.missingTracks;if(Fe.length===0){alert("No valid tracks found in the YouTube playlist!"),Zt.style.display="none";return}console.log(`Imported ${Fe.length} tracks from YouTube`),ud(pe||"Untitled",Fe.length,Ot.length),Ot.length>0&&setTimeout(()=>{mi(Ot)},500)}catch(mt){console.error("YTM Import Error:",mt),alert(`Error importing from YouTube: ${mt.message}`),Zt.style.display="none";return}finally{setTimeout(()=>{Zt.style.display="none"},1e3)}}else if(H.files.length>0){Ue="jspf_import";const vt=H.files[0],{progressElement:Tt,progressFill:yt,progressCurrent:Zt,progressTotal:_n,currentTrackElement:An,currentArtistElement:Sn}=tt();try{Tt.style.display="block",yt.style.width="0%",Zt.textContent="0",An.textContent="Reading JSPF file...",Sn&&(Sn.textContent="");const wn=await vt.text(),Rn=await ME(wn,o,ft=>{const kt=ft.total>0?ft.current/ft.total*100:0;yt.style.width=`${Math.min(kt,100)}%`,Zt.textContent=ft.current.toString(),_n.textContent=ft.total.toString(),An.textContent=ft.currentTrack,Sn&&(Sn.textContent=ft.currentArtist||"")});Fe=Rn.tracks;const mt=Rn.missingTracks;if(Fe.length===0){alert("No valid tracks found in the JSPF file! Please check the format."),Tt.style.display="none";return}console.log(`Imported ${Fe.length} tracks from JSPF`);const st=Rn.jspfData;if(st&&st.playlist){const ft=st.playlist;!pe&&ft.title&&(pe=ft.title),!Be&&ft.annotation&&(Be=ft.annotation),!Ke&&ft.image&&(Ke=ft.image)}const it=Rn.jspfData?.playlist,lt=it?.creator||it?.extension?.["https://musicbrainz.org/doc/jspf#playlist"]?.creator||"unknown";yy(pe||it?.title||"Untitled",Fe.length,mt.length,lt),mt.length>0&&setTimeout(()=>{mi(mt)},500)}catch(wn){console.error("Failed to parse JSPF!",wn),alert("Failed to parse JSPF file! "+wn.message),Tt.style.display="none";return}finally{setTimeout(()=>{Tt.style.display="none"},1e3)}}else if(ne.files.length>0){const vt=ne.files[0],{progressElement:Tt,progressFill:yt,progressCurrent:Zt,progressTotal:_n,currentTrackElement:An,currentArtistElement:Sn}=tt();try{Tt.style.display="block",yt.style.width="0%",Zt.textContent="0",An.textContent="Reading CSV file...",Sn&&(Sn.textContent="");const wn=await vt.text(),Rn=wn.trim().split(`
`),mt=Math.max(0,Rn.length-1);_n.textContent=mt.toString();const st=await LE(wn,o,ft=>{const kt=mt>0?ft.current/mt*100:0;yt.style.width=`${Math.min(kt,100)}%`,Zt.textContent=ft.current.toString(),An.textContent=ft.currentItem,Sn&&(Sn.textContent=ft.type?`Importing ${ft.type}...`:"")});if(st.tracks.length>0&&(st.albums.length>0||st.artists.length>0)){An.textContent="Adding to library...";const ft=await PE(st,nn,Ot=>{Ot.action==="playlist"?An.textContent=`Creating playlist: ${Ot.item}`:An.textContent=`Adding ${Ot.action}: ${Ot.item}`});console.log("Import results:",ft);const kt=[];ft.tracks.added>0&&kt.push(`${ft.tracks.added} tracks`),ft.albums.added>0&&kt.push(`${ft.albums.added} albums`),ft.artists.added>0&&kt.push(`${ft.artists.added} artists`),ft.playlists.created>0&&kt.push(`${ft.playlists.created} playlists`),alert(`Imported to library:
${kt.join(", ")}

${st.missingItems.length>0?`${st.missingItems.length} items could not be found.`:""}`),Tt.style.display="none";return}Fe=st.tracks;const lt=st.missingItems.filter(ft=>ft.type==="track");if(Fe.length===0){alert("No valid tracks found in the CSV file! Please check the format."),Tt.style.display="none";return}console.log(`Imported ${Fe.length} tracks from CSV`),ud(pe||"Untitled",Fe.length,lt.length),lt.length>0&&setTimeout(()=>{mi(lt)},500)}catch(wn){console.error("Failed to parse CSV!",wn),alert("Failed to parse CSV file! "+wn.message),Tt.style.display="none";return}finally{setTimeout(()=>{Tt.style.display="none"},1e3)}}else if(De.files.length>0){Ue="xspf_import";const vt=De.files[0],{progressElement:Tt,progressFill:yt,progressCurrent:Zt,progressTotal:_n,currentTrackElement:An,currentArtistElement:Sn}=tt();try{Tt.style.display="block",yt.style.width="0%",Zt.textContent="0",An.textContent="Reading XSPF file...",Sn&&(Sn.textContent="");const wn=await vt.text(),Rn=await DE(wn,o,st=>{const it=st.total>0?st.current/st.total*100:0;yt.style.width=`${Math.min(it,100)}%`,Zt.textContent=st.current.toString(),_n.textContent=st.total.toString(),An.textContent=st.currentTrack,Sn&&(Sn.textContent=st.currentArtist||"")});Fe=Rn.tracks;const mt=Rn.missingTracks;if(Fe.length===0){alert("No valid tracks found in the XSPF file! Please check the format."),Tt.style.display="none";return}console.log(`Imported ${Fe.length} tracks from XSPF`),by(pe||"Untitled",Fe.length,mt.length),mt.length>0&&setTimeout(()=>{mi(mt)},500)}catch(wn){console.error("Failed to parse XSPF!",wn),alert("Failed to parse XSPF file! "+wn.message),Tt.style.display="none";return}finally{setTimeout(()=>{Tt.style.display="none"},1e3)}}else if(Ye.files.length>0){Ue="xml_import";const vt=Ye.files[0],{progressElement:Tt,progressFill:yt,progressCurrent:Zt,progressTotal:_n,currentTrackElement:An,currentArtistElement:Sn}=tt();try{Tt.style.display="block",yt.style.width="0%",Zt.textContent="0",An.textContent="Reading XML file...",Sn&&(Sn.textContent="");const wn=await vt.text(),Rn=await OE(wn,o,st=>{const it=st.total>0?st.current/st.total*100:0;yt.style.width=`${Math.min(it,100)}%`,Zt.textContent=st.current.toString(),_n.textContent=st.total.toString(),An.textContent=st.currentTrack,Sn&&(Sn.textContent=st.currentArtist||"")});Fe=Rn.tracks;const mt=Rn.missingTracks;if(Fe.length===0){alert("No valid tracks found in the XML file! Please check the format."),Tt.style.display="none";return}console.log(`Imported ${Fe.length} tracks from XML`),Ey(pe||"Untitled",Fe.length,mt.length),mt.length>0&&setTimeout(()=>{mi(mt)},500)}catch(wn){console.error("Failed to parse XML!",wn),alert("Failed to parse XML file! "+wn.message),Tt.style.display="none";return}finally{setTimeout(()=>{Tt.style.display="none"},1e3)}}else if(qe.files.length>0){Ue="m3u_import";const vt=qe.files[0],{progressElement:Tt,progressFill:yt,progressCurrent:Zt,progressTotal:_n,currentTrackElement:An,currentArtistElement:Sn}=tt();try{Tt.style.display="block",yt.style.width="0%",Zt.textContent="0",An.textContent="Reading M3U file...",Sn&&(Sn.textContent="");const wn=await vt.text(),Rn=await zE(wn,o,st=>{const it=st.total>0?st.current/st.total*100:0;yt.style.width=`${Math.min(it,100)}%`,Zt.textContent=st.current.toString(),_n.textContent=st.total.toString(),An.textContent=st.currentTrack,Sn&&(Sn.textContent=st.currentArtist||"")});Fe=Rn.tracks;const mt=Rn.missingTracks;if(Fe.length===0){alert("No valid tracks found in the M3U file! Please check the format."),Tt.style.display="none";return}console.log(`Imported ${Fe.length} tracks from M3U`),vy(pe||"Untitled",Fe.length,mt.length),mt.length>0&&setTimeout(()=>{mi(mt)},500)}catch(wn){console.error("Failed to parse M3U!",wn),alert("Failed to parse M3U file! "+wn.message),Tt.style.display="none";return}finally{setTimeout(()=>{Tt.style.display="none"},1e3)}}const Gt=document.getElementById("playlist-modal");Gt._pendingTracks&&Array.isArray(Gt._pendingTracks)&&(Fe=[...Fe,...Gt._pendingTracks],delete Gt._pendingTracks,console.log(`Added ${Fe.length} tracks (including pending)`)),nn.createPlaylist(pe,Fe,Ke,Be).then(async vt=>{await L(vt),await nn.performTransaction("user_playlists","readwrite",Tt=>Tt.put(vt)),await On.syncUserPlaylist(vt,"create"),Zp(vt,Ue),f.renderLibraryPage(),Gt.classList.remove("active"),md("Create Playlist")})}}}if(Ie.target.closest("#playlist-modal-cancel")&&document.getElementById("playlist-modal").classList.remove("active"),Ie.target.closest(".edit-playlist-btn")){const Be=Ie.target.closest(".user-playlist").dataset.userPlaylistId;nn.getPlaylist(Be).then(async O=>{if(O){const z=document.getElementById("playlist-modal");document.getElementById("playlist-modal-title").textContent="Edit Playlist",document.getElementById("playlist-name-input").value=O.name,document.getElementById("playlist-cover-input").value=O.cover||"",document.getElementById("playlist-description-input").value=O.description||"";const k=document.getElementById("playlist-public-toggle"),L=document.getElementById("playlist-share-btn");k&&(k.checked=!!O.isPublic),L&&(L.style.display=O.isPublic?"flex":"none",L.onclick=()=>{const Ye=Ns(`/userplaylist/${O.id}`);navigator.clipboard.writeText(Ye).then(()=>alert("Link copied to clipboard!"))});const ne=document.getElementById("playlist-cover-upload-btn"),H=document.getElementById("playlist-cover-input"),De=document.getElementById("playlist-cover-toggle-url-btn");O.cover?(ne&&(ne.style.display="none"),H&&(H.style.display="block"),De&&(De.textContent="Upload",De.title="Switch to file upload")):(ne&&(ne.style.flex="1",ne.style.display="flex"),H&&(H.style.display="none"),De&&(De.textContent="or URL",De.title="Switch to URL input")),z.dataset.editingId=Be,document.getElementById("import-section").style.display="none",z.classList.add("active"),document.getElementById("playlist-name-input").focus()}})}if(Ie.target.closest(".delete-playlist-btn")){const Be=Ie.target.closest(".user-playlist").dataset.userPlaylistId;confirm("Are you sure you want to delete this playlist?")&&nn.deletePlaylist(Be).then(()=>{On.syncUserPlaylist({id:Be},"delete"),f.renderLibraryPage()})}if(Ie.target.closest("#edit-playlist-btn")){const pe=window.location.pathname.split("/")[2];nn.getPlaylist(pe).then(Be=>{if(Be){const O=document.getElementById("playlist-modal");document.getElementById("playlist-modal-title").textContent="Edit Playlist",document.getElementById("playlist-name-input").value=Be.name,document.getElementById("playlist-cover-input").value=Be.cover||"",document.getElementById("playlist-description-input").value=Be.description||"";const z=document.getElementById("playlist-public-toggle"),k=document.getElementById("playlist-share-btn");z&&(z.checked=!!Be.isPublic),k&&(k.style.display=Be.isPublic?"flex":"none",k.onclick=()=>{const De=Ns(`/userplaylist/${Be.id}`);navigator.clipboard.writeText(De).then(()=>alert("Link copied to clipboard!"))});const L=document.getElementById("playlist-cover-upload-btn"),ne=document.getElementById("playlist-cover-input"),H=document.getElementById("playlist-cover-toggle-url-btn");Be.cover?(L&&(L.style.display="none"),ne&&(ne.style.display="block"),H&&(H.textContent="Upload",H.title="Switch to file upload")):(L&&(L.style.flex="1",L.style.display="flex"),ne&&(ne.style.display="none"),H&&(H.textContent="or URL",H.title="Switch to URL input")),O.dataset.editingId=pe,document.getElementById("import-section").style.display="none",O.classList.add("active"),document.getElementById("playlist-name-input").focus()}})}if(Ie.target.closest("#delete-playlist-btn")){const pe=window.location.pathname.split("/")[2];confirm("Are you sure you want to delete this playlist?")&&nn.deletePlaylist(pe).then(()=>{On.syncUserPlaylist({id:pe},"delete"),Bn("/library")})}if(Ie.target.closest(".remove-from-playlist-btn")){Ie.stopPropagation();const pe=Ie.target.closest(".remove-from-playlist-btn"),Be=window.location.pathname.split("/")[2];nn.getPlaylist(Be).then(async O=>{let z=null;if(pe.dataset.trackId)z=pe.dataset.trackId;else if(pe.dataset.trackIndex){const k=parseInt(pe.dataset.trackIndex);O&&O.tracks[k]&&(z=O.tracks[k].id)}if(z){const k=await nn.removeTrackFromPlaylist(Be,z);On.syncUserPlaylist(k,"update");const L=document.querySelector(".main-content").scrollTop;await f.renderPlaylistPage(Be,"user"),document.querySelector(".main-content").scrollTop=L}})}if(Ie.target.closest("#play-playlist-btn")){if(Ie.target.closest("#play-playlist-btn").disabled)return;const Be=window.location.pathname.split("/")[2];if(!Be)return;try{let O;const z=await nn.getPlaylist(Be);if(z)O=z.tracks;else try{const{tracks:k}=await o.getPlaylist(Be);O=k}catch(k){const L=await On.getPublicPlaylist(Be);if(L)O=L.tracks;else throw k}O.length>0&&(c.setQueue(O,0),document.getElementById("shuffle-btn").classList.remove("active"),c.playTrackFromQueue())}catch(O){console.error("Failed to play playlist:",O),alert("Failed to play playlist: "+O.message)}}if(Ie.target.closest("#download-album-btn")){const pe=Ie.target.closest("#download-album-btn");if(pe.disabled)return;const Be=window.location.pathname.split("/")[2];if(!Be)return;pe.disabled=!0;const O=pe.innerHTML;pe.innerHTML='<svg class="animate-spin" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle></svg><span>Downloading...</span>';try{const{album:z,tracks:k}=await o.getAlbum(Be),{downloadAlbumAsZip:L}=await va();await L(z,k,o,Ja.getQuality(),y)}catch(z){console.error("Album download failed:",z),alert("Failed to download album: "+z.message)}finally{pe.disabled=!1,pe.innerHTML=O}}if(Ie.target.closest("#add-album-to-playlist-btn")){if(Ie.target.closest("#add-album-to-playlist-btn").disabled)return;const Be=window.location.pathname.split("/")[2];if(!Be)return;try{const{tracks:O}=await o.getAlbum(Be);if(!O||O.length===0){const{showNotification:Fe}=await va();Fe("No tracks found in this album.");return}const z=document.getElementById("playlist-select-modal"),k=document.getElementById("playlist-select-list"),L=document.getElementById("playlist-select-cancel"),ne=z.querySelector(".modal-overlay"),H=await nn.getPlaylists(!1);k.innerHTML=`
                    <div class="modal-option create-new-option" style="border-bottom: 1px solid var(--border); margin-bottom: 0.5rem;">
                        <span style="font-weight: 600; color: var(--primary);">+ Create New Playlist</span>
                    </div>
                `+H.map(Fe=>`
                    <div class="modal-option" data-id="${Fe.id}">
                        <span>${Fe.name}</span>
                    </div>
                `).join("");const De=()=>{z.classList.remove("active"),qe()},Ye=async Fe=>{const Ue=Fe.target.closest(".modal-option");if(!Ue)return;if(Ue.classList.contains("create-new-option")){De();const tt=document.getElementById("playlist-modal");document.getElementById("playlist-modal-title").textContent="Create Playlist",document.getElementById("playlist-name-input").value="",document.getElementById("playlist-cover-input").value="",tt.dataset.editingId="",document.getElementById("import-section").style.display="none",tt._pendingTracks=O,tt.classList.add("active"),document.getElementById("playlist-name-input").focus();return}const Ke=Ue.dataset.id;try{await nn.addTracksToPlaylist(Ke,O);const tt=await nn.getPlaylist(Ke);await On.syncUserPlaylist(tt,"update");const{showNotification:nt}=await va();nt(`Added ${O.length} tracks to playlist.`),De()}catch(tt){console.error(tt);const{showNotification:nt}=await va();nt("Failed to add tracks.")}},qe=()=>{L.removeEventListener("click",De),ne.removeEventListener("click",De),k.removeEventListener("click",Ye)};L.addEventListener("click",De),ne.addEventListener("click",De),k.addEventListener("click",Ye),z.classList.add("active")}catch(O){console.error("Failed to prepare album for playlist:",O);const{showNotification:z}=await va();z("Failed to load album tracks.")}}if(Ie.target.closest("#play-artist-radio-btn")){const pe=Ie.target.closest("#play-artist-radio-btn");if(pe.disabled)return;const Be=window.location.pathname.split("/")[2];if(!Be)return;pe.disabled=!0;const O=pe.innerHTML;pe.innerHTML='<svg class="animate-spin" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle></svg><span>Loading...</span>';try{const z=await o.getArtist(Be),k=[...z.albums||[],...z.eps||[]];if(k.length===0)throw new Error("No albums or EPs found for this artist");const L=new Set,ne=[],H=[],De=3,Ye=k;for(let qe=0;qe<Ye.length;qe+=De)H.push(Ye.slice(qe,qe+De));for(const qe of H)await Promise.all(qe.map(async Fe=>{try{const{tracks:Ue}=await o.getAlbum(Fe.id);Ue.forEach(Ke=>{L.has(Ke.id)||(L.add(Ke.id),ne.push(Ke))})}catch(Ue){console.warn(`Failed to fetch tracks for album ${Fe.title}:`,Ue)}}));if(ne.length>0){for(let qe=ne.length-1;qe>0;qe--){const Fe=Math.floor(Math.random()*(qe+1));[ne[qe],ne[Fe]]=[ne[Fe],ne[qe]]}c.setQueue(ne,0),c.playTrackFromQueue()}else throw new Error("No tracks found across all albums")}catch(z){console.error("Artist radio failed:",z),alert("Failed to start artist radio: "+z.message)}finally{document.body.contains(pe)&&(pe.disabled=!1,pe.innerHTML=O)}}if(Ie.target.closest("#shuffle-liked-tracks-btn")){if(Ie.target.closest("#shuffle-liked-tracks-btn").disabled)return;try{const Be=await nn.getFavorites("track");if(Be.length>0){for(let O=Be.length-1;O>0;O--){const z=Math.floor(Math.random()*(O+1));[Be[O],Be[z]]=[Be[z],Be[O]]}c.setQueue(Be,0),document.getElementById("shuffle-btn").classList.remove("active"),c.playTrackFromQueue()}}catch(Be){console.error("Failed to shuffle liked tracks:",Be)}}if(Ie.target.closest("#download-liked-tracks-btn")){const pe=Ie.target.closest("#download-liked-tracks-btn");if(pe.disabled)return;pe.disabled=!0;const Be=pe.innerHTML;pe.innerHTML='<svg class="animate-spin" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle></svg>';try{const O=await nn.getFavorites("track");if(O.length===0){alert("No liked tracks to download.");return}const{downloadLikedTracks:z}=await va();await z(O,o,Ja.getQuality(),y)}catch(O){console.error("Liked tracks download failed:",O),alert("Failed to download liked tracks: "+O.message)}finally{pe.disabled=!1,pe.innerHTML=Be}}if(Ie.target.closest("#download-discography-btn")){const pe=Ie.target.closest("#download-discography-btn");if(pe.disabled)return;const Be=window.location.pathname.split("/")[2];if(!Be)return;try{const O=await o.getArtist(Be);VE(O,o,Ja.getQuality(),y,pe)}catch(O){console.error("Failed to load artist for discography download:",O),alert("Failed to load artist: "+O.message)}}if(Ie.target.closest("#select-local-folder-btn")||Ie.target.closest("#change-local-folder-btn")){const pe=Ie.target.closest("#change-local-folder-btn")!==null;try{const Be=window.Neutralino&&(window.NL_MODE||window.location.search.includes("mode=neutralino"));let O,z;if(Be){if(z=await window.Neutralino.os.showFolderDialog("Select Music Folder"),!z)return;O={name:z.split(/[/\\]/).pop()||z,isNeutralino:!0,path:z}}else O=await window.showDirectoryPicker({id:"music-folder",mode:"read"});await nn.saveSetting("local_folder_handle",O),pe&&py();const k=document.getElementById("select-local-folder-btn"),L=document.getElementById("select-local-folder-text");k&&(L?L.textContent="Scanning...":k.textContent="Scanning...",k.disabled=!0);const ne=[];let H=0;const{readTrackMetadata:De}=await BE();if(Be){async function Ye(qe){const Fe=await window.Neutralino.filesystem.readDirectory(qe);for(const Ue of Fe){if(Ue.entry==="."||Ue.entry==="..")continue;const Ke=`${qe}/${Ue.entry}`;if(Ue.type==="FILE"){const tt=Ue.entry.toLowerCase();if(tt.endsWith(".flac")||tt.endsWith(".mp3")||tt.endsWith(".m4a")||tt.endsWith(".wav")||tt.endsWith(".ogg"))try{const nt=await window.Neutralino.filesystem.readBinaryFile(Ke),dt=await window.Neutralino.filesystem.getStats(Ke),Gt=new File([nt],Ue.entry,{lastModified:dt.mtime}),vt=await De(Gt);vt.id=`local-${H++}-${Ue.entry}`,ne.push(vt)}catch(nt){console.error("Failed to read file:",Ke,nt)}}else Ue.type==="DIRECTORY"&&await Ye(Ke)}}await Ye(z)}else{async function Ye(qe){for await(const Fe of qe.values())if(Fe.kind==="file"){const Ue=Fe.name.toLowerCase();if(Ue.endsWith(".flac")||Ue.endsWith(".mp3")||Ue.endsWith(".m4a")||Ue.endsWith(".wav")||Ue.endsWith(".ogg")){const Ke=await Fe.getFile(),tt=await De(Ke);tt.id=`local-${H++}-${Ke.name}`,ne.push(tt)}}else Fe.kind==="directory"&&await Ye(Fe)}await Ye(O)}ne.sort((Ye,qe)=>{const Fe=Ye.artist.name||"",Ue=qe.artist.name||"";return Fe.localeCompare(Ue)}),window.localFilesCache=ne,gy(ne.length),f.renderLibraryPage()}catch(Be){Be.name!=="AbortError"&&(console.error("Error selecting folder:",Be),alert("Failed to access folder. Please try again."));const O=document.getElementById("select-local-folder-btn"),z=document.getElementById("select-local-folder-text");O&&(z?z.textContent="Select Music Folder":O.textContent="Select Music Folder",O.disabled=!1)}}});const we=document.getElementById("search-form"),ce=document.getElementById("search-input");f.setupSearchClearButton(ce);const he=cl(Ie=>{Ie&&Bn(`/search/${encodeURIComponent(Ie)}`)},300);ce.addEventListener("input",Ie=>{const pe=Ie.target.value.trim();pe.length>2&&he(pe)}),ce.addEventListener("change",Ie=>{const pe=Ie.target.value.trim();pe.length>2&&f.addToSearchHistory(pe)}),ce.addEventListener("focus",()=>{f.renderSearchHistory()}),ce.addEventListener("click",()=>{f.renderSearchHistory()}),document.addEventListener("click",Ie=>{if(!Ie.target.closest(".search-bar")){const pe=document.getElementById("search-history");pe&&(pe.style.display="none")}}),we.addEventListener("submit",Ie=>{Ie.preventDefault();const pe=ce.value.trim();if(pe){f.addToSearchHistory(pe),Bn(`/search/${encodeURIComponent(pe)}`);const Be=document.getElementById("search-history");Be&&(Be.style.display="none")}}),window.addEventListener("online",()=>{HE(),console.log("Back online")}),window.addEventListener("offline",()=>{jE(),console.log("Gone offline")}),document.querySelector(".now-playing-bar .play-pause-btn").innerHTML=cr;const Pe=Fb(f),$e=async Ie=>{const pe=document.getElementById("fullscreen-cover-overlay");if(pe&&getComputedStyle(pe).display==="flex"&&window.location.hash!=="#fullscreen"&&f.closeFullscreenCover(),Ie&&Ie.state&&Ie.state.exitTrap){const{showNotification:O}=await va();O("Press back again to exit"),setTimeout(()=>{history.state&&history.state.exitTrap&&history.pushState({app:!0},"",window.location.pathname)},2e3);return}if(Ie&&gi.shouldInterceptBackToClose()&&gi.hasOpenModalsOrPanels()){ea.close(),gi.closeAllModals(),history.pushState(history.state||{app:!0},"",window.location.pathname);return}gi.shouldCloseOnNavigation()&&(ea.close(),gi.closeAllModals()),await Pe(),rl(c)};if(await $e(),window.addEventListener("popstate",$e),document.body.addEventListener("click",Ie=>{const pe=Ie.target.closest("a");pe&&pe.origin===window.location.origin&&pe.target!=="_blank"&&!pe.hasAttribute("download")&&(Ie.preventDefault(),Bn(pe.pathname))}),e.addEventListener("play",()=>{rl(c)}),window.__AUTH_GATE__)GE();else{const Ie=_E({onNeedRefresh(){qd.isAutoUpdateEnabled()?(fd(),Ie(!0)):KE(()=>{fd(),Ie(!0)})},onOfflineReady(){console.log("App ready to work offline")}})}document.getElementById("show-shortcuts-btn")?.addEventListener("click",()=>{WE()});const He=document.getElementById("font-select");if(He){const Ie=localStorage.getItem("monochrome-font");Ie&&(He.value=Ie),He.addEventListener("change",pe=>{const Be=pe.target.value;document.documentElement.style.setProperty("--font-family",Be),localStorage.setItem("monochrome-font",Be)})}window.addEventListener("library-changed",()=>{const Ie=window.location.pathname;if(Ie==="/library")f.renderLibraryPage();else if(Ie==="/"||Ie==="/home")f.renderHomePage();else if(Ie.startsWith("/userplaylist/")){const pe=Ie.split("/")[2],Be=document.querySelector(".main-content"),O=Be?Be.scrollTop:0;f.renderPlaylistPage(pe,"user").then(()=>{Be&&(Be.scrollTop=O)})}}),window.addEventListener("history-changed",()=>{window.location.pathname==="/recent"&&f.renderRecentPage()});const et=document.getElementById("context-menu");et&&new MutationObserver(pe=>{pe.forEach(Be=>{if(Be.type==="attributes"&&Be.attributeName==="style"&&et.style.display==="block"){const O=et._contextTrack,z=et.querySelector('[data-action="go-to-album"]');if(O&&z){let k="album";const L=O.album?.type?.toUpperCase(),ne=O.album?.numberOfTracks;L==="SINGLE"||ne===1?k="single":(L==="EP"||ne&&ne<=6)&&(k="EP"),z.textContent=`Go to ${k}`,z.style.display=O.album?"block":"none"}}})}).observe(et,{attributes:!0});const Ve=document.getElementById("header-account-btn"),Et=document.getElementById("header-account-dropdown"),Nt=document.getElementById("header-account-img"),$t=document.getElementById("header-account-icon");if(Ve&&Et){Ve.addEventListener("click",pe=>{pe.stopPropagation(),Et.classList.toggle("active"),Ie()}),document.addEventListener("click",pe=>{!Ve.contains(pe.target)&&!Et.contains(pe.target)&&Et.classList.remove("active")});async function Ie(){const pe=la?.user;if(Et.innerHTML="",!pe)Et.innerHTML=`
                    <button class="btn-secondary" id="header-google-auth">Connect with Google</button>
                    <button class="btn-secondary" id="header-email-auth">Connect with Email</button>
                `,document.getElementById("header-google-auth").onclick=()=>la.signInWithGoogle(),document.getElementById("header-email-auth").onclick=()=>{document.getElementById("email-auth-modal").classList.add("active"),Et.classList.remove("active")};else{const Be=await On.getUserData();Be&&Be.profile&&Be.profile.username?(Et.innerHTML=`
                        <button class="btn-secondary" id="header-view-profile">My Profile</button>
                        <button class="btn-secondary danger" id="header-sign-out">Sign Out</button>
                    `,document.getElementById("header-view-profile").onclick=()=>{Bn(`/user/@${Be.profile.username}`),Et.classList.remove("active")}):(Et.innerHTML=`
                        <button class="btn-primary" id="header-create-profile">Create Profile</button>
                        <button class="btn-secondary danger" id="header-sign-out">Sign Out</button>
                    `,document.getElementById("header-create-profile").onclick=()=>{bl(),Et.classList.remove("active")}),document.getElementById("header-sign-out").onclick=()=>la.signOut()}}la.onAuthStateChanged(async pe=>{if(pe){const Be=await On.getUserData();if(Be&&Be.profile&&Be.profile.avatar_url){Nt.src=Be.profile.avatar_url,Nt.style.display="block",$t.style.display="none";return}}Nt.style.display="none",$t.style.display="block"})}});function KE(o){const e=document.querySelector(".update-notification");e&&e.remove();const t=document.createElement("div");t.className="update-notification",t.innerHTML=`
        <div>
            <strong>Update Available</strong>
            <p>A new version of Monochrome is available.</p>
        </div>
        <div class="update-notification-actions">
            <button class="btn-primary" id="update-now-btn">Update Now</button>
            <button class="btn-icon" id="dismiss-update-btn" title="Dismiss">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
    `,document.body.appendChild(t),document.getElementById("update-now-btn").addEventListener("click",()=>{typeof o=="function"?o():o&&o.postMessage?o.postMessage({action:"skipWaiting"}):window.location.reload()}),document.getElementById("dismiss-update-btn").addEventListener("click",()=>{ky(),t.remove()})}function $E(o){const e=document.createElement("div");return e.textContent=o,e.innerHTML}function mi(o){const e=document.getElementById("missing-tracks-modal"),t=document.getElementById("missing-tracks-list-ul");t.innerHTML=o.map(i=>{const c=typeof i=="string"?i:`${i.artist?i.artist+" - ":""}${i.title}`;return`<li>${$E(c)}</li>`}).join("");const n=()=>e.classList.remove("active"),r=i=>{(i.target===e||i.target.closest(".close-missing-tracks")||i.target.id==="close-missing-tracks-btn"||i.target.classList.contains("modal-overlay"))&&(n(),e.removeEventListener("click",r))};e.addEventListener("click",r),e.classList.add("active")}function VE(o,e,t,n,r){const i=document.getElementById("discography-download-modal");document.getElementById("discography-artist-name").textContent=o.name,document.getElementById("albums-count").textContent=o.albums?.length||0,document.getElementById("eps-count").textContent=(o.eps||[]).filter(f=>f.type==="EP").length,document.getElementById("singles-count").textContent=(o.eps||[]).filter(f=>f.type==="SINGLE").length,document.getElementById("download-albums").checked=!0,document.getElementById("download-eps").checked=!0,document.getElementById("download-singles").checked=!0;const c=()=>{i.classList.remove("active")},h=f=>{(f.target===i||f.target.classList.contains("modal-overlay")||f.target.closest(".close-modal-btn")||f.target.id==="cancel-discography-download")&&c()};i.addEventListener("click",h),document.getElementById("start-discography-download").onclick=async()=>{const f=document.getElementById("download-albums").checked,g=document.getElementById("download-eps").checked,y=document.getElementById("download-singles").checked;if(!f&&!g&&!y){alert("Please select at least one type of release to download.");return}c();let u=[];f&&(u=u.concat(o.albums||[])),g&&(u=u.concat((o.eps||[]).filter(d=>d.type==="EP"))),y&&(u=u.concat((o.eps||[]).filter(d=>d.type==="SINGLE"))),r.disabled=!0;const l=r.innerHTML;r.innerHTML='<svg class="animate-spin" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle></svg><span>Downloading...</span>';try{const{downloadDiscography:d}=await va();await d(o,u,e,t,n)}catch(d){console.error("Discography download failed:",d),alert("Failed to download discography: "+d.message)}finally{r.disabled=!1,r.innerHTML=l}},i.classList.add("active")}function WE(){const o=document.getElementById("shortcuts-modal"),e=()=>{o.classList.remove("active"),o.removeEventListener("click",t)},t=n=>{(n.target===o||n.target.classList.contains("close-shortcuts")||n.target.classList.contains("modal-overlay"))&&e()};o.addEventListener("click",t),o.classList.add("active")}export{zd as A,br as B,Vr as C,Yg as D,tv as E,na as F,On as G,nn as H,ZE as I,ev as J,qd as K,Fd as L,nv as M,ll as N,or as O,wa as P,Ca as Q,la as a,Oi as b,Cs as c,jd as d,Ja as e,Dd as f,Ds as g,xs as h,jo as i,Zn as j,Bd as k,Xa as l,zi as m,Ho as n,aa as o,Nd as p,Ud as q,qo as r,Gg as s,Rs as t,gi as u,Mr as v,ni as w,Di as x,Md as y,Od as z};
